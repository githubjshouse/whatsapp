console.log("[override] bootstrap_qr.79aba964bea38dbcc501.js",new Date().toLocaleString());/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[9209],{63509:(e,t,r)=>{var n={"./f00.png":31213,"./f01.png":8750,"./f02.png":48738,"./f03.png":15494,"./f04.png":15885,"./f05.png":5851,"./f06.png":68540,"./f07.png":30293,"./f08.png":91131,"./f09.png":27879,"./f10.png":8610,"./f11.png":32641,"./f12.png":98479,"./f13.png":25670,"./f14.png":759,"./f15.png":52264,"./f16.png":86035,"./f17.png":94878,"./f18.png":67514,"./f19.png":23533,"./f20.png":86319,"./f21.png":65664,"./f22.png":10191,"./f23.png":48850,"./f24.png":92553,"./f25.png":53453,"./f26.png":78691,"./f27.png":17430,"./f28.png":40610,"./f29.png":78643,"./f30.png":73434,"./f31.png":54981,"./f32.png":86488,"./f33.png":28881,"./f34.png":71199,"./f35.png":97836,"./f36.png":77985,"./f37.png":73570,"./f38.png":42949,"./f39.png":21404,"./f40.png":21792,"./f41.png":86197,"./f42.png":79685,"./f43.png":39346,"./f44.png":89128,"./f45.png":86904,"./f46.png":86906,"./f47.png":63265,"./f48.png":7029,"./f49.png":39871,"./f50.png":58360,"./f51.png":35277,"./f52.png":63418,"./f53.png":58235,"./f54.png":132,"./f55.png":33417,"./f56.png":50407,"./f57.png":29423,"./f58.png":32176,"./f59.png":50874,"./f60.png":21578,"./f61.png":22129,"./f62.png":33819,"./f63.png":97359,"./f64.png":39887,"./f65.png":38275,"./f66.png":71673,"./f67.png":21264,"./f68.png":96007,"./f69.png":59163,"./f70.png":91732,"./f71.png":3913,"./f72.png":92293,"./f73.png":51577,"./f74.png":26347,"./f75.png":70345,"./f76.png":60318,"./f77.png":86426,"./f78.png":62002,"./f79.png":49889,"./f80.png":24324,"./f81.png":59354,"./f82.png":74992,"./f83.png":80502,"./f84.png":74260,"./f85.png":64108,"./f86.png":71042,"./f87.png":95563,"./f88.png":64594,"./f89.png":68005,"./f90.png":16888,"./f91.png":52943,"./f92.png":24613,"./f93.png":94922,"./f94.png":18725,"./f95.png":82950,"./f96.png":7251,"./f97.png":17978,"./f98.png":86273,"./f99.png":31666,"./favicon-error.png":10331,"./favicon-error2.png":72174,"./favicon.png":68431};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id=63509},76554:(e,t,r)=>{var n={"./f00.png":95203,"./f01.png":66574,"./f02.png":19833,"./f03.png":39974,"./f04.png":86727,"./f05.png":78808,"./f06.png":71258,"./f07.png":64497,"./f08.png":66114,"./f09.png":12430,"./f10.png":29809,"./f11.png":41191,"./f12.png":87642,"./f13.png":26841,"./f14.png":7967,"./f15.png":38817,"./f16.png":65587,"./f17.png":38297,"./f18.png":61665,"./f19.png":16962,"./f20.png":42387,"./f21.png":74420,"./f22.png":84319,"./f23.png":43302,"./f24.png":34444,"./f25.png":14231,"./f26.png":15842,"./f27.png":25925,"./f28.png":10149,"./f29.png":90154,"./f30.png":701,"./f31.png":27707,"./f32.png":95169,"./f33.png":77763,"./f34.png":98593,"./f35.png":16569,"./f36.png":35807,"./f37.png":82439,"./f38.png":41360,"./f39.png":93127,"./f40.png":62369,"./f41.png":55876,"./f42.png":31990,"./f43.png":36009,"./f44.png":24580,"./f45.png":61400,"./f46.png":78354,"./f47.png":27020,"./f48.png":27961,"./f49.png":8725,"./f50.png":25129,"./f51.png":33690,"./f52.png":15722,"./f53.png":94416,"./f54.png":59965,"./f55.png":97937,"./f56.png":91425,"./f57.png":40564,"./f58.png":35705,"./f59.png":1474,"./f60.png":5285,"./f61.png":60792,"./f62.png":1219,"./f63.png":66899,"./f64.png":14772,"./f65.png":61160,"./f66.png":26671,"./f67.png":18327,"./f68.png":8659,"./f69.png":80157,"./f70.png":14440,"./f71.png":90805,"./f72.png":39619,"./f73.png":30472,"./f74.png":60325,"./f75.png":59019,"./f76.png":69536,"./f77.png":71717,"./f78.png":35033,"./f79.png":62003,"./f80.png":65263,"./f81.png":39681,"./f82.png":61422,"./f83.png":50966,"./f84.png":60408,"./f85.png":69738,"./f86.png":87724,"./f87.png":93370,"./f88.png":63963,"./f89.png":13976,"./f90.png":26034,"./f91.png":41727,"./f92.png":54257,"./f93.png":61109,"./f94.png":2801,"./f95.png":11318,"./f96.png":25889,"./f97.png":30341,"./f98.png":51222,"./f99.png":53279,"./favicon-error.png":81740,"./favicon-error2.png":5079,"./favicon.png":49420};function i(e){var t=a(e);return r(t)}function a(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=a,e.exports=i,i.id=76554},23098:module=>{var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);function ba(e){eval.call(null,e)}for(l in e.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},"undefined"!=typeof arguments&&(e.arguments=arguments),"undefined"!=typeof console?(e.print||(e.print=function(e){console.log(e)}),e.printErr||(e.printErr=function(e){console.log(e)})):e.print||(e.print=function(){}),void 0===e.setWindowTitle&&(e.setWindowTitle=function(e){document.title=e}),!e.load&&e.read&&(e.load=function(t){ba(e.read(t))}),e.print||(e.print=function(){}),e.printErr||(e.printErr=e.print),e.arguments||(e.arguments=[]),e.thisProgram||(e.thisProgram="./this.program"),e.print=e.print,e.S=e.printErr,e.preRun=[],e.postRun=[],aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(e){ca=e},Ua:function(){return ca},na:function(){return m},X:function(e){m=e},Aa:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return"*"===e[e.length-1]?n.H:"i"===e[0]?(assert(0==(e=parseInt(e.substr(1)))%8),e/8):0}},Ta:function(e){return Math.max(n.Aa(e),n.H)},dd:16,Bd:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},od:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?n.Ta(e):0),n.H):Math.min(t,8):8},J:function(t,r,n){return n&&n.length?(n.splice||(n=Array.prototype.slice.call(n)),n.splice(0,0,r),e["dynCall_"+t].apply(null,n)):e["dynCall_"+t].call(null,r)},U:[],Ma:function(e){for(var t=0;t<n.U.length;t++)if(!n.U[t])return n.U[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(e){n.U[(e-2)/2]=null},M:function(t){n.M.ma||(n.M.ma={}),n.M.ma[t]||(n.M.ma[t]=1,e.S(t))},ha:{},rd:function(e,t){assert(t),n.ha[t]||(n.ha[t]={});var r=n.ha[t];return r[e]||(r[e]=function(){return n.J(t,e,arguments)}),r[e]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(e){var t=m;return m=(m=m+e|0)+15&-16,t},Ia:function(e){var t=p;return p=(p=p+e|0)+15&-16,t},P:function(e){var t=v;return(e=(v=(v=v+e|0)+15&-16)>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),e=!0),e?(v=t,0):t},ea:function(e,t){return Math.ceil(e/(t||16))*(t||16)},xd:function(e,t,r){return r?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},La:8,H:4,ed:0};e.Runtime=n,n.addFunction=n.Ma,n.removeFunction=n.$a;var A=!1,da,fa,ca,ha,ia,buffer;function assert(e,t){e||z("Assertion failed: "+t)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(e){}return assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)"),b}function ma(e,t,r){switch("*"===(r=r||"i8").charAt(r.length-1)&&(r="i32"),r){case"i1":case"i8":D[e>>0]=t;break;case"i16":E[e>>1]=t;break;case"i32":F[e>>2]=t;break;case"i64":fa=[t>>>0,(da=t,1<=+na(da)?0<da?(0|oa(+pa(da/4294967296),4294967295))>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)],F[e>>2]=fa[0],F[e+4>>2]=fa[1];break;case"float":ra[e>>2]=t;break;case"double":sa[e>>3]=t;break;default:z("invalid type for setValue: "+r)}}function ta(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return D[e>>0];case"i16":return E[e>>1];case"i32":case"i64":return F[e>>2];case"float":return ra[e>>2];case"double":return sa[e>>3];default:z("invalid type for setValue: "+t)}return null}function G(e,t,r,i){var a,o;"number"==typeof e?(a=!0,o=e):(a=!1,o=e.length);var s,l,c="string"==typeof t?t:null;if(r=4==r?i:[ua,n.W,n.Ia,n.P][void 0===r?2:r](Math.max(o,c?1:t.length)),a){for(i=r,assert(0==(3&r)),e=r+(-4&o);i<e;i+=4)F[i>>2]=0;for(e=r+o;i<e;)D[i++>>0]=0;return r}if("i8"===c)return e.subarray||e.slice?H.set(e,r):H.set(new Uint8Array(e),r),r;for(i=0;i<o;){var d=e[i];"function"==typeof d&&(d=n.sd(d)),0===(a=c||t[i])?i++:("i64"==a&&(a="i32"),ma(r+i,d,a),l!==a&&(s=n.Aa(a),l=a),i+=s)}return r}function la(t,r){if(0===r||!t)return"";for(var n,i=0,a=0;(i|=n=H[t+a>>0],0!=n||r)&&(a++,!r||a!=r););if(r||(r=a),n="",128>i){for(;0<r;)i=String.fromCharCode.apply(String,H.subarray(t,t+Math.min(r,1024))),n=n?n+i:i,t+=1024,r-=1024;return n}return e.UTF8ToString(t)}function za(e,t){for(var r,n,i,a,o,s="";;){if(!(r=e[t++]))return s;128&r?(n=63&e[t++],192==(224&r)?s+=String.fromCharCode((31&r)<<6|n):(i=63&e[t++],224==(240&r)?r=(15&r)<<12|n<<6|i:(a=63&e[t++],240==(248&r)?r=(7&r)<<18|n<<12|i<<6|a:(o=63&e[t++],248==(252&r)?r=(3&r)<<24|n<<18|i<<12|a<<6|o:r=(1&r)<<30|n<<24|i<<18|a<<12|o<<6|63&e[t++])),65536>r?s+=String.fromCharCode(r):(r-=65536,s+=String.fromCharCode(55296|r>>10,56320|1023&r)))):s+=String.fromCharCode(r)}}function Aa(e,t,r,n){if(!(0<n))return 0;var i=r;n=r+n-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(r>=n)break;t[r++]=o}else{if(2047>=o){if(r+1>=n)break;t[r++]=192|o>>6}else{if(65535>=o){if(r+2>=n)break;t[r++]=224|o>>12}else{if(2097151>=o){if(r+3>=n)break;t[r++]=240|o>>18}else{if(67108863>=o){if(r+4>=n)break;t[r++]=248|o>>24}else{if(r+5>=n)break;t[r++]=252|o>>30,t[r++]=128|o>>24&63}t[r++]=128|o>>18&63}t[r++]=128|o>>12&63}t[r++]=128|o>>6&63}t[r++]=128|63&o}}return t[r]=0,r-i}function Ba(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),127>=n?++t:t=2047>=n?t+2:65535>=n?t+3:2097151>=n?t+4:67108863>=n?t+5:t+6}return t}function Ca(t){var r=!!e.___cxa_demangle;if(r)try{var i=ua(t.length);ka(t.substr(1),i);var a=ua(4),o=e.___cxa_demangle(i,0,0,a);if(0===ta(a,"i32")&&o)return la(o)}catch(e){}finally{i&&Da(i),a&&Da(a),o&&Da(o)}var s=3,l={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},c=[],d=!0;i=t;try{if("Object._main"==t||"_main"==t)return"main()";if("number"==typeof t&&(t=la(t)),"_"!==t[0]||"_"!==t[1]||"Z"!==t[2])return t;switch(t[3]){case"n":return"operator new()";case"d":return"operator delete()"}i=function e(r,n,i){n=n||1/0;var a,o="",u=[];if("N"===t[s]){for(s++,"K"===t[s]&&s++,a=[];"E"!==t[s];)if("S"===t[s]){s++;var p=t.indexOf("_",s);a.push(c[t.substring(s,p)||0]||"?"),s=p+1}else if("C"===t[s])a.push(a[a.length-1]),s+=2;else{var f=(p=parseInt(t.substr(s))).toString().length;if(!p||!f){s--;break}var _=t.substr(s+f,p);a.push(_),c.push(_),s+=f+p}if(s++,a=a.join("::"),0==--n)return r?[a]:a}else("K"===t[s]||d&&"L"===t[s])&&s++,(p=parseInt(t.substr(s)))&&(f=p.toString().length,a=t.substr(s+f,p),s+=f+p);d=!1,"I"===t[s]?(s++,p=e(!0),o+=(f=e(!0,1,!0))[0]+" "+a+"<"+p.join(", ")+">"):o=a;e:for(;s<t.length&&0<n--;)if(a=t[s++],a in l)u.push(l[a]);else switch(a){case"P":u.push(e(!0,1,!0)[0]+"*");break;case"R":u.push(e(!0,1,!0)[0]+"&");break;case"L":s++,p=t.indexOf("E",s)-s,u.push(t.substr(s,p)),s+=p+2;break;case"A":if(p=parseInt(t.substr(s)),s+=p.toString().length,"_"!==t[s])throw"?";s++,u.push(e(!0,1,!0)[0]+" ["+p+"]");break;case"E":break e;default:o+="?"+a;break e}return i||1!==u.length||"void"!==u[0]||(u=[]),r?(o&&u.push(o+"?"),u):o+"("+u.join(", ")+")"}()}catch(e){i+="?"}return 0<=i.indexOf("?")&&!r&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),i}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,(function(e){var t=Ca(e);return e===t?e:e+" ["+t+"]"}))}function Fa(){var e=Error();if(!e.stack){try{throw Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function Ga(){var e=v;return 0<e%4096&&(e+=4096-e%4096),e}(function(){function a(e){return{arguments:(e=e.toString().match(d).slice(1))[0],body:e[1],returnValue:e[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(e){var t=n.W(e.length);return ja(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&ka(e,t=n.W(1+(e.length<<2))),t}},c={string:b.stringToC,array:b.arrayToC};ia=function(e,t,r,i,a){e=ga(e);var o=[],s=0;if(i)for(var l=0;l<i.length;l++){var d=c[r[l]];d?(0===s&&(s=n.na()),o[l]=d(i[l])):o[l]=i[l]}if(r=e.apply(null,o),"string"===t&&(r=la(r)),0!==s){if(a&&a.async)return void EmterpreterAsync.hd.push((function(){n.X(s)}));n.X(s)}return r};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every((function(e){return"number"===e}));var u="string"!==c;if(u&&b)return h;var q=d.map((function(e,t){return"$"+t}));c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];"number"!==ea&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}return d=a((function(){return h})).returnValue,c+="var ret = "+d+"("+q.join(",")+");",u||(d=a((function(){return la})).returnValue,c+="ret = "+d+"(ret);"),b||(c+=f.stackRestore.body.replace("()","(stack)")+";"),eval(c+"return ret})")}})(),e.ccall=ia,e.cwrap=ha,e.setValue=ma,e.getValue=ta,e.ALLOC_NORMAL=0,e.ALLOC_STACK=1,e.ALLOC_STATIC=2,e.ALLOC_DYNAMIC=3,e.ALLOC_NONE=4,e.allocate=G,e.getMemory=function(e){return va?void 0!==wa&&!wa.C||!xa?n.P(e):ua(e):n.Ia(e)},e.Pointer_stringify=la,e.AsciiToString=function(e){for(var t="";;){var r=D[e++>>0];if(!r)return t;t+=String.fromCharCode(r)}},e.stringToAscii=function(e,t){return ya(e,t,!1)},e.UTF8ArrayToString=za,e.UTF8ToString=function(e){return za(H,e)},e.stringToUTF8Array=Aa,e.stringToUTF8=function(e,t,r){return Aa(e,H,t,r)},e.lengthBytesUTF8=Ba,e.UTF16ToString=function(e){for(var t=0,r="";;){var n=E[e+2*t>>1];if(0==n)return r;++t,r+=String.fromCharCode(n)}},e.stringToUTF16=function(e,t,r){if(void 0===r&&(r=2147483647),2>r)return 0;var n=t;r=(r-=2)<2*e.length?r/2:e.length;for(var i=0;i<r;++i)E[t>>1]=e.charCodeAt(i),t+=2;return E[t>>1]=0,t-n},e.lengthBytesUTF16=function(e){return 2*e.length},e.UTF32ToString=function(e){for(var t=0,r="";;){var n=F[e+4*t>>2];if(0==n)return r;++t,65536<=n?(n-=65536,r+=String.fromCharCode(55296|n>>10,56320|1023&n)):r+=String.fromCharCode(n)}},e.stringToUTF32=function(e,t,r){if(void 0===r&&(r=2147483647),4>r)return 0;var n=t;r=n+r-4;for(var i=0;i<e.length;++i){if(55296<=(a=e.charCodeAt(i))&&57343>=a)var a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i);if(F[t>>2]=a,(t+=4)+4>r)break}return F[t>>2]=0,t-n},e.lengthBytesUTF32=function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);55296<=n&&57343>=n&&++r,t+=4}return t},e.stackTrace=function(){return Ea()};for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||5242880,w=e.TOTAL_MEMORY||16777216,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;function Oa(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t();else{var r=t.Qa;"number"==typeof r?void 0===t.T?n.J("v",r):n.J("vi",r,[t.T]):r(void 0===t.T?null:t.T)}}}I!==w&&(w=I),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(w),D=new Int8Array(buffer),E=new Int16Array(buffer),F=new Int32Array(buffer),H=new Uint8Array(buffer),Ha=new Uint16Array(buffer),Ia=new Uint32Array(buffer),ra=new Float32Array(buffer),sa=new Float64Array(buffer),F[0]=255,assert(255===H[0]&&0===H[3],"Typed arrays 2 must be run on a little-endian system"),e.HEAP=void 0,e.buffer=buffer,e.HEAP8=D,e.HEAP16=E,e.HEAP32=F,e.HEAPU8=H,e.HEAPU16=Ha,e.HEAPU32=Ia,e.HEAPF32=ra,e.HEAPF64=sa;var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(e){Pa.unshift(e)}function Ua(e){Sa.unshift(e)}function Va(e,t,r){return e=Aa(e,r=Array(0<r?r:Ba(e)+1),0,r.length),t&&(r.length=e),r}function ka(e,t,r){for(e=Va(e,r),r=0;r<e.length;)D[t+r>>0]=e[r],r+=1}function ja(e,t){for(var r=0;r<e.length;r++)D[t++>>0]=e[r]}function ya(e,t,r){for(var n=0;n<e.length;++n)D[t++>>0]=e.charCodeAt(n);r||(D[t>>0]=0)}e.addOnPreRun=Ta,e.addOnInit=function(e){Qa.unshift(e)},e.addOnPreMain=function(e){Ra.unshift(e)},e.addOnExit=function(e){K.unshift(e)},e.addOnPostRun=Ua,e.intArrayFromString=Va,e.intArrayToString=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];255<n&&(n&=255),t.push(String.fromCharCode(n))}return t.join("")},e.writeStringToMemory=ka,e.writeArrayToMemory=ja,e.writeAsciiToMemory=ya,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var r=65535&e,n=65535&t;return r*n+((e>>>16)*n+r*(t>>>16)<<16)|0}),Math.td=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;32>t;t++)if(e&1<<31-t)return t;return 32}),Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}function Za(){if(L--,e.monitorRunDependencies&&e.monitorRunDependencies(L),0==L&&(null!==Wa&&(clearInterval(Wa),Wa=null),Xa)){var t=Xa;Xa=null,t()}}e.addRunDependency=Ya,e.removeRunDependency=Za,e.preloadedImages={},e.preloadedAudios={},Ja=8,p=Ja+1696,Qa.push(),G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);function eb(e,t){K.push((function(){n.J("vi",e,[t])})),eb.level=K.length}assert(0==$a%8),e._bitshift64Ashr=ab,e._i64Subtract=bb,e._i64Add=cb,e._memset=db,e._bitshift64Lshr=fb,e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(t){return e.___errno_location&&(F[e.___errno_location()>>2]=t),t}function jb(e,t){for(var r=0,n=e.length-1;0<=n;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function N(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e}function kb(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function lb(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)}function mb(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){if("string"!=typeof(t=0<=r?arguments[r]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var nb=[];function ob(e,t){nb[e]={input:[],output:[],L:t},pb(e,qb)}var qb={open:function(e){var t=nb[e.g.rdev];if(!t)throw new O(M.ba);e.tty=t,e.seekable=!1},close:function(e){e.tty.L.flush(e.tty)},flush:function(e){e.tty.L.flush(e.tty)},read:function(e,t,r,n){if(!e.tty||!e.tty.L.Ba)throw new O(M.sa);for(var i=0,a=0;a<n;a++){var o;try{o=e.tty.L.Ba(e.tty)}catch(e){throw new O(M.F)}if(void 0===o&&0===i)throw new O(M.oa);if(null==o)break;i++,t[r+a]=o}return i&&(e.g.timestamp=Date.now()),i},write:function(e,t,r,n){if(!e.tty||!e.tty.L.ja)throw new O(M.sa);for(var i=0;i<n;i++)try{e.tty.L.ja(e.tty,t[r+i])}catch(e){throw new O(M.F)}return n&&(e.g.timestamp=Date.now()),i}},rb={Ba:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&(null!==(t=readline())&&(t+="\n")),!t)return null;e.input=Va(t,!0)}return e.input.shift()},ja:function(t,r){null===r||10===r?(e.print(za(t.output,0)),t.output=[]):0!=r&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.print(za(t.output,0)),t.output=[])}},sb={ja:function(t,r){null===r||10===r?(e.printErr(za(t.output,0)),t.output=[]):0!=r&&t.output.push(r)},flush:function(t){t.output&&0<t.output.length&&(e.printErr(za(t.output,0)),t.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(24576==(61440&r)||4096==(61440&r))throw new O(M.G);return P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}}),16384==(61440&(r=ub(e,t,r,n)).mode)?(r.k=P.q.dir.g,r.n=P.q.dir.stream,r.e={}):32768==(61440&r.mode)?(r.k=P.q.file.g,r.n=P.q.file.stream,r.o=0,r.e=null):40960==(61440&r.mode)?(r.k=P.q.link.g,r.n=P.q.link.stream):8192==(61440&r.mode)&&(r.k=P.q.va.g,r.n=P.q.va.stream),r.timestamp=Date.now(),e&&(e.e[t]=r),r},Sa:function(e){if(e.e&&e.e.subarray){for(var t=[],r=0;r<e.o;++r)t.push(e.e[r]);return t}return e.e},qd:function(e){return e.e?e.e.subarray?e.e.subarray(0,e.o):new Uint8Array(e.e):new Uint8Array},ya:function(e,t){if(e.e&&e.e.subarray&&t>e.e.length&&(e.e=P.Sa(e),e.o=e.e.length),!e.e||e.e.subarray){var r=e.e?e.e.buffer.byteLength:0;r>=t||(t=Math.max(t,r*(1048576>r?2:1.125)|0),0!=r&&(t=Math.max(t,256)),r=e.e,e.e=new Uint8Array(t),0<e.o&&e.e.set(r.subarray(0,e.o),0))}else for(!e.e&&0<t&&(e.e=[]);e.e.length<t;)e.e.push(0)},ab:function(e,t){if(e.o!=t)if(0==t)e.e=null,e.o=0;else{if(!e.e||e.e.subarray){var r=e.e;e.e=new Uint8Array(new ArrayBuffer(t)),r&&e.e.set(r.subarray(0,Math.min(t,e.o)))}else if(e.e||(e.e=[]),e.e.length>t)e.e.length=t;else for(;e.e.length<t;)e.e.push(0);e.o=t}},k:{D:function(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.o:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Pa=4096,t.blocks=Math.ceil(t.size/t.Pa),t},p:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&P.ab(e,t.size)},lookup:function(){throw vb[M.B]},V:function(e,t,r,n){return P.createNode(e,t,r,n)},rename:function(e,t,r){if(16384==(61440&e.mode)){var n;try{n=wb(t,r)}catch(e){}if(n)for(var i in n.e)throw new O(M.ra)}delete e.parent.e[e.name],e.name=r,t.e[r]=e,e.parent=t},unlink:function(e,t){delete e.e[t]},rmdir:function(e,t){var r,n=wb(e,t);for(r in n.e)throw new O(M.ra);delete e.e[t]},readdir:function(e){var t,r=[".",".."];for(t in e.e)e.e.hasOwnProperty(t)&&r.push(t);return r},symlink:function(e,t,r){return(e=P.createNode(e,t,41471,0)).link=r,e},readlink:function(e){if(40960!=(61440&e.mode))throw new O(M.u);return e.link}},n:{read:function(e,t,r,n,i){var a=e.g.e;if(i>=e.g.o)return 0;if(assert(0<=(e=Math.min(e.g.o-i,n))),8<e&&a.subarray)t.set(a.subarray(i,i+e),r);else for(n=0;n<e;n++)t[r+n]=a[i+n];return e},write:function(e,t,r,n,i,a){if(!n)return 0;if((e=e.g).timestamp=Date.now(),t.subarray&&(!e.e||e.e.subarray)){if(a)return e.e=t.subarray(r,r+n),e.o=n;if(0===e.o&&0===i)return e.e=new Uint8Array(t.subarray(r,r+n)),e.o=n;if(i+n<=e.o)return e.e.set(t.subarray(r,r+n),i),n}if(P.ya(e,i+n),e.e.subarray&&t.subarray)e.e.set(t.subarray(r,r+n),i);else for(a=0;a<n;a++)e.e[i+a]=t[r+a];return e.o=Math.max(e.o,i+n),n},I:function(e,t,r){if(1===r?t+=e.position:2===r&&32768==(61440&e.g.mode)&&(t+=e.g.o),0>t)throw new O(M.u);return t},ta:function(e,t,r){P.ya(e.g,t+r),e.g.o=Math.max(e.g.o,t+r)},Ea:function(e,t,r,n,i,a,o){if(32768!=(61440&e.g.mode))throw new O(M.ba);if(r=e.g.e,2&o||r.buffer!==t&&r.buffer!==t.buffer){if((0<i||i+n<e.g.o)&&(r=r.subarray?r.subarray(i,i+n):Array.prototype.slice.call(r,i,i+n)),e=!0,!(n=ua(n)))throw new O(M.Ka);t.set(r,n)}else e=!1,n=r.byteOffset;return{Cd:n,gd:e}},Ga:function(e,t,r,n,i){if(32768!=(61440&e.g.mode))throw new O(M.ba);return 2&i||P.n.write(e,t,0,n,r,!1),0}}};G(1,"i32*",2),G(1,"i32*",2),G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(e,t){if(t=t||{},!(e=mb("/",e)))return{path:"",g:null};var r,n={za:!0,ka:0};for(r in n)void 0===t[r]&&(t[r]=n[r]);if(8<t.ka)throw new O(M.aa);n=jb(e.split("/").filter((function(e){return!!e})),!1);var i=xb;r="/";for(var a=0;a<n.length;a++){var o=a===n.length-1;if(o&&t.parent)break;if(i=wb(i,n[a]),r=N(r+"/"+n[a]),i.R&&(!o||o&&t.za)&&(i=i.R.root),!o||t.ga)for(o=0;40960==(61440&i.mode);)if(i=Db(r),i=T(r=mb(kb(r),i),{ka:t.ka}).g,40<o++)throw new O(M.aa)}return{path:r,g:i}}function U(e){for(var t;;){if(e===e.parent)return e=e.A.Fa,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function Eb(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%R.length}function Fb(e){var t=Eb(e.parent.id,e.name);e.K=R[t],R[t]=e}function wb(e,t){var r;if(r=(r=Gb(e,"x"))?r:e.k.lookup?0:M.Y)throw new O(r,e);for(r=R[Eb(e.id,t)];r;r=r.K){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return e.k.lookup(e,t)}function ub(e,t,r,n){return Hb||((Hb=function(e,t,r,n){e||(e=this),this.parent=e,this.A=e.A,this.R=null,this.id=Ab++,this.name=t,this.mode=r,this.k={},this.n={},this.rdev=n}).prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return 16384==(61440&this.mode)}},Ca:{get:function(){return 8192==(61440&this.mode)}}})),Fb(e=new Hb(e,t,r,n)),e}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(e,t){return Cb||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:M.Y}function Jb(e,t){try{return wb(e,t),M.pa}catch(e){}return Gb(e,"wx")}function Kb(){for(var e=0;e<=4096;e++)if(!zb[e])return e;throw new O(M.Ja)}function Lb(e){Mb||((Mb=function(){}).prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(e){this.g=e}},vd:{get:function(){return 1!=(2097155&this.flags)}},wd:{get:function(){return 0!=(2097155&this.flags)}},ud:{get:function(){return 1024&this.flags}}}));var t,r=new Mb;for(t in e)r[t]=e[t];return e=r,r=Kb(),e.fd=r,zb[r]=e}var tb={open:function(e){e.n=yb[e.g.rdev].n,e.n.open&&e.n.open(e)},I:function(){throw new O(M.da)}},Zb;function pb(e,t){yb[e]={n:t}}function Nb(e,t){var r,n="/"===t,i=!t;if(n&&xb)throw new O(M.$);if(!n&&!i){if(t=(r=T(t,{za:!1})).path,(r=r.g).R)throw new O(M.$);if(16384!=(61440&r.mode))throw new O(M.qa)}i={type:e,Ad:{},Fa:t,Ya:[]};var a=e.A(i);a.A=i,i.root=a,n?xb=a:r&&(r.R=i,r.A&&r.A.Ya.push(i))}function Ob(e,t,r){var n=T(e,{parent:!0}).g;if(!(e=lb(e))||"."===e||".."===e)throw new O(M.u);var i=Jb(n,e);if(i)throw new O(i);if(!n.k.V)throw new O(M.G);return n.k.V(n,e,t,r)}function Pb(e,t){return t=4095&(void 0!==t?t:438),Ob(e,t|=32768,0)}function V(e,t){return t=1023&(void 0!==t?t:511),Ob(e,t|=16384,0)}function Qb(e,t,r){return void 0===r&&(r=t,t=438),Ob(e,8192|t,r)}function Rb(e,t){if(!mb(e))throw new O(M.B);var r=T(t,{parent:!0}).g;if(!r)throw new O(M.B);var n=lb(t),i=Jb(r,n);if(i)throw new O(i);if(!r.k.symlink)throw new O(M.G);return r.k.symlink(r,n,e)}function Db(e){if(!(e=T(e).g))throw new O(M.B);if(!e.k.readlink)throw new O(M.u);return mb(U(e.parent),e.k.readlink(e))}function Sb(e,t){var r;if(!(r="string"==typeof e?T(e,{ga:!0}).g:e).k.p)throw new O(M.G);r.k.p(r,{mode:4095&t|-4096&r.mode,timestamp:Date.now()})}function Tb(t,r){var n,i,a;if(""===t)throw new O(M.B);if("string"==typeof r){if(void 0===(i=Ib[r]))throw Error("Unknown file open mode: "+r)}else i=r;if(n=64&(r=i)?4095&(void 0===n?438:n)|32768:0,"object"==typeof t)a=t;else{t=N(t);try{a=T(t,{ga:!(131072&r)}).g}catch(e){}}if(i=!1,64&r)if(a){if(128&r)throw new O(M.pa)}else a=Ob(t,n,0),i=!0;if(!a)throw new O(M.B);if(8192==(61440&a.mode)&&(r&=-513),65536&r&&16384!=(61440&a.mode))throw new O(M.qa);if(!i&&(a?40960==(61440&a.mode)?n=M.aa:16384==(61440&a.mode)&&(0!=(2097155&r)||512&r)?n=M.N:(n=["r","w","rw"][3&r],512&r&&(n+="w"),n=Gb(a,n)):n=M.B,n))throw new O(n);if(512&r){var o;if(!(o="string"==typeof(n=a)?T(n,{ga:!0}).g:n).k.p)throw new O(M.G);if(16384==(61440&o.mode))throw new O(M.N);if(32768!=(61440&o.mode))throw new O(M.u);if(n=Gb(o,"w"))throw new O(n);o.k.p(o,{size:0,timestamp:Date.now()})}r&=-641,(a=Lb({g:a,path:U(a),flags:r,seekable:!0,position:0,n:a.n,eb:[],error:!1})).n.open&&a.n.open(a),!e.logReadFiles||1&r||(Ub||(Ub={}),t in Ub||(Ub[t]=1,e.printErr("read file: "+t)));try{S.onOpenFile&&(o=0,1!=(2097155&r)&&(o|=1),0!=(2097155&r)&&(o|=2),S.onOpenFile(t,o))}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return a}function Vb(e){e.ia&&(e.ia=null);try{e.n.close&&e.n.close(e)}catch(e){throw e}finally{zb[e.fd]=null}}function Wb(e,t,r){if(!e.seekable||!e.n.I)throw new O(M.da);e.position=e.n.I(e,t,r),e.eb=[]}function Xb(e,t,r,n,i,a){if(0>n||0>i)throw new O(M.u);if(0==(2097155&e.flags))throw new O(M.Z);if(16384==(61440&e.g.mode))throw new O(M.N);if(!e.n.write)throw new O(M.u);1024&e.flags&&Wb(e,0,2);var o=!0;if(void 0===i)i=e.position,o=!1;else if(!e.seekable)throw new O(M.da);t=e.n.write(e,t,r,n,i,a),o||(e.position+=t);try{e.path&&S.onWriteToFile&&S.onWriteToFile(e.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+path+"') threw an exception: "+e.message)}return t}function Yb(){O||((O=function(e,t){this.g=t,this.bb=function(e){for(var t in this.Q=e,M)if(M[t]===e){this.code=t;break}},this.bb(e),this.message=hb[e]}).prototype=Error(),O.prototype.constructor=O,[M.B].forEach((function(e){vb[e]=new O(e),vb[e].stack="<generic error, no stack>"})))}function $b(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r}function ac(e,t,r,n){return Pb(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(r,n))}function bc(e,t,r,n,i,a){if(i=Pb(e=t?N(("string"==typeof e?e:U(e))+"/"+t):e,n=$b(n,i)),r){if("string"==typeof r){e=Array(r.length),t=0;for(var o=r.length;t<o;++t)e[t]=r.charCodeAt(t);r=e}Sb(i,146|n),Xb(e=Tb(i,"w"),r,0,r.length,0,a),Vb(e),Sb(i,n)}return i}function W(e,t,r,n){e=N(("string"==typeof e?e:U(e))+"/"+t),t=$b(!!r,!!n),W.Da||(W.Da=64);var i=W.Da++<<8|0;return pb(i,{open:function(e){e.seekable=!1},close:function(){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,i){for(var a=0,o=0;o<i;o++){var s;try{s=r()}catch(e){throw new O(M.F)}if(void 0===s&&0===a)throw new O(M.oa);if(null==s)break;a++,t[n+o]=s}return a&&(e.g.timestamp=Date.now()),a},write:function(e,t,r,i){for(var a=0;a<i;a++)try{n(t[r+a])}catch(e){throw new O(M.F)}return i&&(e.g.timestamp=Date.now()),a}}),Qb(e,t,i)}function cc(t){if(t.Ca||t.Xa||t.link||t.e)return!0;var r=!0;if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!e.read)throw Error("Cannot load without read() or XMLHttpRequest.");try{t.e=Va(e.read(t.url),!0),t.o=t.e.length}catch(e){r=!1}return r||ib(M.F),r}var dc={},Hb,Mb,Ub,ec=0;function X(){return F[(ec+=4)-4>>2]}function fc(){var e;if(e=X(),!(e=zb[e]))throw new O(M.Z);return e}function wa(e){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var t=v;return 0==e||wa.Ra(e)?t:4294967295}function hc(e,t){if(ic=e,jc=t,!kc)return 1;if(0==e)Y=function(){setTimeout(lc,t)},mc="timeout";else if(1==e)Y=function(){nc(lc)},mc="rAF";else if(2==e){if(!window.setImmediate){var r=[];window.addEventListener("message",(function(e){e.source===window&&"__emcc"===e.data&&(e.stopPropagation(),r.shift()())}),!0),window.setImmediate=function(e){r.push(e),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)},mc="immediate"}return 0}function oc(t,r,i,a,o){e.noExitRuntime=!0,assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),kc=t,pc=a;var s=qc;if(lc=function(){if(!A)if(0<rc.length){var r=Date.now(),i=rc.shift();if(i.Qa(i.T),sc){var o=sc,l=0==o%1?o-1:Math.floor(o);sc=i.ld?l:(8*o+(l+.5))/9}console.log('main loop blocker "'+i.name+'" took '+(Date.now()-r)+" ms"),tc(),setTimeout(lc,0)}else s<qc||(uc=uc+1|0,1==ic&&1<jc&&0!=uc%jc?Y():("timeout"===mc&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc((function(){void 0!==a?n.J("vi",t,[a]):n.J("v",t)})),s<qc||("object"==typeof SDL&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))},o||(r&&0<r?hc(0,1e3/r):hc(1,1),Y()),i)throw"SimulateInfiniteLoop"}e._memcpy=gc;var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var t=e.statusMessage||"Please wait...",r=sc,n=wc.nd;r?r<n?e.setStatus(t+" ("+(n-r)+"/"+n+")"):e.setStatus(t):e.setStatus("")}}function vc(t){if(!(A||e.preMainLoop&&!1===e.preMainLoop())){try{t()}catch(t){if(t instanceof xc)return;throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function t(){zc=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}if(e.preloadPlugins||(e.preloadPlugins=[]),!Cc){Cc=!0;try{Dc=!0}catch(e){Dc=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Ec="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dc?null:console.log("warning: no BlobBuilder"),Fc="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,e.Ha||void 0!==Fc||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.Ha=!0),e.preloadPlugins.push({canHandle:function(t){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},handle:function(t,r,i,a){var o=null;if(Dc)try{(o=new Blob([t],{type:Gc(r)})).size!==t.length&&(o=new Blob([new Uint8Array(t).buffer],{type:Gc(r)}))}catch(e){n.M("Blob constructor present but fails: "+e+"; falling back to blob builder")}o||((o=new Ec).append(new Uint8Array(t).buffer),o=o.getBlob());var s=Fc.createObjectURL(o),l=new Image;l.onload=function(){assert(l.complete,"Image "+r+" could not be decoded");var n=document.createElement("canvas");n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=n,Fc.revokeObjectURL(s),i&&i(t)},l.onerror=function(){console.log("Image "+s+" could not be decoded"),a&&a()},l.src=s}}),e.preloadPlugins.push({canHandle:function(t){return!e.zd&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(t,r,n,i){function a(i){s||(s=!0,e.preloadedAudios[r]=i,n&&n(t))}function o(){s||(s=!0,e.preloadedAudios[r]=new Audio,i&&i())}var s=!1;if(!Dc)return o();try{var l=new Blob([t],{type:Gc(r)})}catch(e){return o()}l=Fc.createObjectURL(l);var c=new Audio;c.addEventListener("canplaythrough",(function(){a(c)}),!1),c.onerror=function(){if(!s){console.log("warning: browser could not fully decode audio "+r+", trying slower base64 approach");for(var e="",n=0,i=0,o=0;o<t.length;o++)for(n=n<<8|t[o],i+=8;6<=i;){var l=n>>i-6&63;i=i-6,e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==i?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&n)<<4],e+="=="):4==i&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&n)<<2],e+="="),c.src="data:audio/x-"+r.substr(-3)+";base64,"+e,a(c)}},c.src=l,Hc((function(){a(c)}))}});var r=e.canvas;r&&(r.la=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.wa=r.wa.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),e.elementPointerLock&&r.addEventListener("click",(function(e){!zc&&r.la&&(r.la(),e.preventDefault())}),!1))}}function Ic(t,r,n,i){if(r&&e.fa&&t==e.canvas)return e.fa;var a,o;if(r){if(o={antialias:!1,alpha:!1},i)for(var s in i)o[s]=i[s];(o=GL.createContext(t,o))&&(a=GL.getContext(o).cd),t.style.backgroundColor="black"}else a=t.getContext("2d");return a?(n&&(r||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=a,r&&GL.yd(o),e.Dd=r,Ac.forEach((function(e){e()})),Bc()),a):null}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(t,r,n){function i(){yc=!1;var t=a.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t?(a.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},a.ua=a.ua.bind(document),Kc&&a.la(),yc=!0,Lc&&Nc()):(t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t),Lc&&Oc()),e.onFullScreen&&e.onFullScreen(yc),Pc(a)}void 0===(Kc=t)&&(Kc=!0),void 0===(Lc=r)&&(Lc=!1),void 0===(Qc=n)&&(Qc=null);var a=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var o=document.createElement("div");a.parentNode.insertBefore(o,a),o.appendChild(a),o.C=o.requestFullScreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n?o.C({Ed:n}):o.C()}var Rc=0;function Sc(e){var t=Date.now();if(0===Rc)Rc=t+1e3/60;else for(;t+2>=Rc;)Rc+=1e3/60;t=Math.max(Rc-t,0),setTimeout(e,t)}function nc(e){"undefined"==typeof window?Sc(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(e))}function Hc(t){e.noExitRuntime=!0,setTimeout((function(){A||t()}),1e4)}function Gc(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function Tc(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)}function Uc(e,t,r){Tc(e,(function(r){assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),Za()}),(function(){if(!r)throw'Loading data file "'+e+'" failed.';r()})),Ya()}var Vc=[],Cc,Dc,Ec,Fc,Qc;function Wc(){var t=e.canvas;Vc.forEach((function(e){e(t.width,t.height)}))}function Nc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=8388608|e}Wc()}function Oc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=-8388609&e}Wc()}function Pc(t,r,n){r&&n?(t.fb=r,t.Va=n):(r=t.fb,n=t.Va);var i=r,a=n;if(e.forcedAspectRatio&&0<e.forcedAspectRatio&&(i/a<e.forcedAspectRatio?i=Math.round(a*e.forcedAspectRatio):a=Math.round(i/e.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/i,screen.height/a);i=Math.round(i*o),a=Math.round(a*o)}Lc?(t.width!=i&&(t.width=i),t.height!=a&&(t.height=a),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=r&&(t.width=r),t.height!=n&&(t.height=n),void 0!==t.style&&(i!=r||a!=n?(t.style.setProperty("width",i+"px","important"),t.style.setProperty("height",a+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))}Yb(),R=Array(4096),Nb(P,"/"),V("/tmp"),V("/home"),V("/home/web_user"),function(){var e;if(V("/dev"),pb(259,{read:function(){return 0},write:function(e,t,r,n){return n}}),Qb("/dev/null",259),ob(1280,rb),ob(1536,sb),Qb("/dev/tty",1280),Qb("/dev/tty1",1536),"undefined"!=typeof crypto){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}else e=function(){return 256*Math.random()|0};W("/dev","random",e),W("/dev","urandom",e),V("/dev/shm"),V("/dev/shm/tmp")}(),V("/proc"),V("/proc/self"),V("/proc/self/fd"),Nb({A:function(){var e=ub("/proc/self","fd",16895,73);return e.k={lookup:function(e,t){var r=zb[+t];if(!r)throw new O(M.Z);var n={parent:null,A:{Fa:"fake"},k:{readlink:function(){return r.path}}};return n.parent=n}},e}},"/proc/self/fd"),Qa.unshift((function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),Zb=!0,Yb(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin"),e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout"),e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var t=Tb("/dev/stdin","r");assert(0===t.fd,"invalid handle for stdin ("+t.fd+")"),assert(1===(t=Tb("/dev/stdout","w")).fd,"invalid handle for stdout ("+t.fd+")"),assert(2===(t=Tb("/dev/stderr","w")).fd,"invalid handle for stderr ("+t.fd+")")}})),Ra.push((function(){Cb=!1})),K.push((function(){Zb=!1;var t=e._fflush;for(t&&t(0),t=0;t<zb.length;t++){var r=zb[t];r&&Vb(r)}})),e.FS_createFolder=function(e,t,r,n){return V(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(r,n))},e.FS_createPath=function(e,t){e="string"==typeof e?e:U(e);for(var r=t.split("/").reverse();r.length;){var n=r.pop();if(n){var i=N(e+"/"+n);try{V(i)}catch(e){}e=i}}return i},e.FS_createDataFile=bc,e.FS_createPreloadedFile=function(t,r,n,i,a,o,s,l,c,d){function u(n){function u(e){d&&d(),l||bc(t,r,e,i,a,c),o&&o(),Za()}var f=!1;e.preloadPlugins.forEach((function(e){!f&&e.canHandle(p)&&(e.handle(n,p,u,(function(){s&&s(),Za()})),f=!0)})),f||u(n)}Bc();var p=r?mb(N(t+"/"+r)):t;Ya(),"string"==typeof n?Uc(n,(function(e){u(e)}),s):u(n)},e.FS_createLazyFile=function(e,t,r,n,i){if("undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";r={Ca:!1,url:r};var a=ac(e,t,n,i);r.e?a.e=r.e:r.url&&(a.e=null,a.url=r.url),Object.defineProperty(a,"usedBytes",{get:function(){return this.e.length}});var o={};return Object.keys(a.n).forEach((function(e){var t=a.n[e];o[e]=function(){if(!cc(a))throw new O(M.F);return t.apply(null,arguments)}})),o.read=function(e,t,r,n,i){if(!cc(a))throw new O(M.F);if(i>=(e=e.g.e).length)return 0;if(assert(0<=(n=Math.min(e.length-i,n))),e.slice)for(var o=0;o<n;o++)t[r+o]=e[i+o];else for(o=0;o<n;o++)t[r+o]=e.get(i+o);return n},a.n=o,a},e.FS_createLink=function(e,t,r){return Rb(r,e=N(("string"==typeof e?e:U(e))+"/"+t))},e.FS_createDevice=W,e.FS_unlink=function(e){var t,r=T(e,{parent:!0}).g,n=lb(e),i=wb(r,n);e:{try{t=wb(r,n)}catch(e){t=e.Q;break e}var a=Gb(r,"wx");t=a||(16384==(61440&t.mode)?M.N:0)}if(t)throw t===M.N&&(t=M.G),new O(t);if(!r.k.unlink)throw new O(M.G);if(i.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(e)}catch(t){console.log("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}if(r.k.unlink(r,n),r=Eb(i.parent.id,i.name),R[r]===i)R[r]=i.K;else for(r=R[r];r;){if(r.K===i){r.K=i.K;break}r=r.K}try{S.onDeletePath&&S.onDeletePath(e)}catch(t){console.log("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},Qa.unshift((function(){})),K.push((function(){})),e.requestFullScreen=function(e,t,r){Mc(e,t,r)},e.requestAnimationFrame=function(e){nc(e)},e.setCanvasSize=function(t,r,n){Pc(e.canvas,t,r),n||Wc()},e.pauseMainLoop=function(){Y=null,qc++},e.resumeMainLoop=function(){qc++;var e=ic,t=jc,r=kc;kc=null,oc(r,0,!1,pc,!0),hc(e,t),Y()},e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)},e.createContext=function(e,t,r,n){return Ic(e,t,r,n)},Ka=m=n.ea(p),va=!0,La=Ka+Na,Ma=v=n.ea(La),assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array,NaN:NaN,Infinity:1/0},e.Oa={abort:z,assert,invoke_ii:function(t,r){try{return e.dynCall_ii(t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_iiii:function(t,r,n,i){try{return e.dynCall_iiii(t,r,n,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_vi:function(t,r){try{e.dynCall_vi(t,r)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(e,t){ec=t;try{return Vb(fc()),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(e){var t=Date.now()/1e3|0;return e&&(F[e>>2]=t),t},___setErrNo:ib,_emscripten_memcpy_big:function(e,t,r){return H.set(H.subarray(t,t+r),e),e},___syscall54:function(e,t){ec=t;try{var r=fc(),n=X();switch(n){case 21505:case 21506:return r.tty?0:-M.O;case 21519:if(!r.tty)return-M.O;var i=X();return F[i>>2]=0;case 21520:return r.tty?-M.u:-M.O;case 21531:if(i=X(),!r.n.Wa)throw new O(M.O);return r.n.Wa(r,n,i);default:z("bad ioctl syscall "+n)}}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},___unlock:function(){},___syscall140:function(e,t){ec=t;try{var r=fc(),n=X(),i=X(),a=X(),o=X();return assert(0===n),Wb(r,i,o),F[a>>2]=r.position,r.ia&&0===i&&0===o&&(r.ia=null),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_pthread_cleanup_push:eb,_sysconf:function(e){switch(e){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ib(M.u),-1},___syscall146:function(e,t){ec=t;try{var r,n=fc(),i=X();e:{for(var a=X(),o=0,s=0;s<a;s++){var l=Xb(n,D,F[i+8*s>>2],F[i+(8*s+4)>>2],void 0);if(0>l){r=-1;break e}o+=l}r=o}return r}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=function(e,t,r){var n=new e.Int8Array(r),i=(new e.Int16Array(r),new e.Int32Array(r)),a=new e.Uint8Array(r),o=(new e.Uint16Array(r),new e.Uint32Array(r),new e.Float32Array(r),new e.Float64Array(r),0|t.STACKTOP),s=(t.STACK_MAX,t.tempDoublePtr,t.ABORT,t.cttz_i8,0),l=(e.NaN,e.Infinity,0),c=(e.Math.floor,e.Math.abs,e.Math.sqrt,e.Math.pow,e.Math.cos,e.Math.sin,e.Math.tan,e.Math.acos,e.Math.asin,e.Math.atan,e.Math.atan2,e.Math.exp,e.Math.log,e.Math.ceil,e.Math.imul),d=(e.Math.min,e.Math.clz32,t.abort),u=(t.assert,t.invoke_ii,t.invoke_iiii,t.invoke_vi,t._pthread_cleanup_pop),p=t.___lock,f=(t._emscripten_set_main_loop,t._pthread_self),_=t.___syscall6,h=(t._emscripten_set_main_loop_timing,t._abort),g=t._sbrk,m=t._time,y=(t.___setErrNo,t._emscripten_memcpy_big),E=t.___syscall54,S=t.___unlock,v=t.___syscall140,T=t._pthread_cleanup_push,C=t._sysconf,A=t.___syscall146;function b(e,t,r){e|=0;var n,a=0,s=0,c=0,d=0,u=0,p=0,f=0,_=0,h=0,g=0,m=0;n=o,o=o+160|0,P(a=n,t|=0,r|=0),t=0|i[(r=a+144|0)>>2],s=0|i[r+4>>2],d=0|i[(c=r=a+64|0)>>2],u=0|i[c+4>>2],c=0|B(0|t,0|s,18,0),p=l,f=0|G(0|d,0|u,0|t,0|s),s=0|G(0|f,0|l,0|c,0|p),i[(p=r)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+136|0)>>2],r=0|i[p+4>>2],f=0|i[(c=p=a+56|0)>>2],t=0|i[c+4>>2],c=0|B(0|s,0|r,18,0),u=l,d=0|G(0|f,0|t,0|s,0|r),r=0|G(0|d,0|l,0|c,0|u),i[(u=p)>>2]=r,i[u+4>>2]=l,r=0|i[(u=a+128|0)>>2],p=0|i[u+4>>2],d=0|i[(c=u=a+48|0)>>2],s=0|i[c+4>>2],c=0|B(0|r,0|p,18,0),t=l,f=0|G(0|d,0|s,0|r,0|p),p=0|G(0|f,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,p=0|i[(t=a+120|0)>>2],u=0|i[t+4>>2],f=0|i[(c=t=a+40|0)>>2],r=0|i[c+4>>2],c=0|B(0|p,0|u,18,0),s=l,d=0|G(0|f,0|r,0|p,0|u),u=0|G(0|d,0|l,0|c,0|s),i[(s=t)>>2]=u,i[s+4>>2]=l,u=0|i[(s=a+112|0)>>2],t=0|i[s+4>>2],d=0|i[(c=s=a+32|0)>>2],p=0|i[c+4>>2],c=0|B(0|u,0|t,18,0),r=l,f=0|G(0|d,0|p,0|u,0|t),t=0|G(0|f,0|l,0|c,0|r),i[(r=s)>>2]=t,i[r+4>>2]=l,t=0|i[(r=a+104|0)>>2],s=0|i[r+4>>2],f=0|i[(c=r=a+24|0)>>2],u=0|i[c+4>>2],c=0|B(0|t,0|s,18,0),p=l,d=0|G(0|f,0|u,0|t,0|s),s=0|G(0|d,0|l,0|c,0|p),i[(p=r)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+96|0)>>2],r=0|i[p+4>>2],d=0|i[(c=p=a+16|0)>>2],t=0|i[c+4>>2],c=0|B(0|s,0|r,18,0),u=l,f=0|G(0|d,0|t,0|s,0|r),r=0|G(0|f,0|l,0|c,0|u),i[(u=p)>>2]=r,i[u+4>>2]=l,r=0|i[(u=a+88|0)>>2],p=0|i[u+4>>2],f=0|i[(c=u=a+8|0)>>2],s=0|i[c+4>>2],c=0|B(0|r,0|p,18,0),t=l,d=0|G(0|f,0|s,0|r,0|p),p=0|G(0|d,0|l,0|c,0|t),i[(t=u)>>2]=p,i[t+4>>2]=l,c=0|i[(p=t=a+80|0)>>2],d=0|i[p+4>>2],r=0|i[(p=a)>>2],s=0|i[p+4>>2],p=0|B(0|c,0|d,18,0),f=l,_=0|G(0|r,0|s,0|c,0|d),d=0|G(0|_,0|l,0|p,0|f),f=l,i[(p=a)>>2]=d,i[p+4>>2]=f,i[(p=t)>>2]=0,i[p+4>>2]=0,p=f,f=d,d=0;do{r=0|k(0|f,0|p,0|(s=0|x(0|(c=0|L(0|(_=0|G(p>>31>>>6|0,0,0|f,0|p)),0|l,26)),0|(_=l),26)),0|l),i[(s=a+(d<<3)|0)>>2]=r,i[s+4>>2]=l,m=0|k(0|(h=0|G(0|c,0|_,0|i[(r=s=a+((1|d)<<3)|0)>>2],0|i[r+4>>2])),0|(r=l),0|(g=0|x(0|(c=0|L(0|(_=0|G(r>>31>>>7|0,0,0|h,0|r)),0|l,25)),0|(_=l),25)),0|l),i[(g=s)>>2]=m,i[g+4>>2]=l,f=0|G(0|c,0|_,0|i[(m=g=a+((d=d+2|0)<<3)|0)>>2],0|i[m+4>>2]),p=l,i[(m=g)>>2]=f,i[m+4>>2]=p}while(d>>>0<10);p=0|i[(d=t)>>2],f=0|i[d+4>>2],m=0|i[(d=a)>>2],g=0|i[d+4>>2],d=0|B(0|p,0|f,18,0),_=l,c=0|G(0|m,0|g,0|p,0|f),f=0|G(0|c,0|l,0|d,0|_),_=l,i[(d=t)>>2]=0,i[d+4>>2]=0,p=0|k(0|f,0|_,0|(c=0|x(0|(t=0|L(0|(d=0|G(_>>31>>>6|0,0,0|f,0|_)),0|l,26)),0|(d=l),26)),0|l),i[(c=a)>>2]=p,i[c+4>>2]=l,p=0|G(0|t,0|d,0|i[(c=u)>>2],0|i[c+4>>2]),i[(c=u)>>2]=p,i[c+4>>2]=l,c=e,e=a,a=c+80|0;do{i[c>>2]=i[e>>2],c=c+4|0,e=e+4|0}while((0|c)<(0|a));o=n}function P(e,t,r){e|=0,r|=0;var n=0,a=0,o=0,s=0,c=0,d=0,u=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,b=0,P=0,M=0;n=0|L(0,0|i[(t|=0)>>2],32),a=l,s=0|B(0|(o=0|L(0,0|i[r>>2],32)),0|l,0|n,0|a),i[(a=e)>>2]=s,i[a+4>>2]=l,a=0|L(0,0|i[t>>2],32),s=l,c=0|B(0|(o=0|L(0,0|i[(n=r+8|0)>>2],32)),0|l,0|a,0|s),s=l,o=0|L(0,0|i[(a=t+8|0)>>2],32),d=l,d=0|G(0|(p=0|B(0|(u=0|L(0,0|i[r>>2],32)),0|l,0|o,0|d)),0|l,0|c,0|s),i[(s=e+8|0)>>2]=d,i[s+4>>2]=l,s=0|L(0,0|i[a>>2],31),d=l,p=0|B(0|(c=0|L(0,0|i[n>>2],32)),0|l,0|s,0|d),d=l,s=0|L(0,0|i[t>>2],32),c=l,c=0|G(0|(f=0|B(0|(u=0|L(0,0|i[(o=r+16|0)>>2],32)),0|l,0|s,0|c)),0|l,0|p,0|d),d=l,f=0|L(0,0|i[(p=t+16|0)>>2],32),s=l,s=0|G(0|c,0|d,0|(_=0|B(0|(u=0|L(0,0|i[r>>2],32)),0|l,0|f,0|s)),0|l),i[(_=e+16|0)>>2]=s,i[_+4>>2]=l,_=0|L(0,0|i[a>>2],32),s=l,c=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|_,0|s),s=l,_=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|(u=0|B(0|(f=0|L(0,0|i[n>>2],32)),0|l,0|_,0|d)),0|l,0|c,0|s),s=l,c=0|L(0,0|i[t>>2],32),u=l,u=0|G(0|d,0|s,0|(h=0|B(0|(f=0|L(0,0|i[(_=r+24|0)>>2],32)),0|l,0|c,0|u)),0|l),h=l,d=0|L(0,0|i[(s=t+24|0)>>2],32),c=l,c=0|G(0|u,0|h,0|(g=0|B(0|(f=0|L(0,0|i[r>>2],32)),0|l,0|d,0|c)),0|l),i[(g=e+24|0)>>2]=c,i[g+4>>2]=l,g=0|L(0,0|i[p>>2],32),c=l,u=0|B(0|(h=0|L(0,0|i[o>>2],32)),0|l,0|g,0|c),c=l,g=0|L(0,0|i[a>>2],32),h=l,f=0|B(0|(d=0|L(0,0|i[_>>2],32)),0|l,0|g,0|h),h=l,g=0|L(0,0|i[s>>2],32),d=l,d=0|G(0|(y=0|B(0|(m=0|L(0,0|i[n>>2],32)),0|l,0|g,0|d)),0|l,0|f,0|h),d=0|G(0|(h=0|x(0|d,0|l,1)),0|l,0|u,0|c),c=l,u=0|L(0,0|i[t>>2],32),h=l,h=0|G(0|d,0|c,0|(g=0|B(0|(y=0|L(0,0|i[(f=r+32|0)>>2],32)),0|l,0|u,0|h)),0|l),g=l,d=0|L(0,0|i[(c=t+32|0)>>2],32),u=l,u=0|G(0|h,0|g,0|(m=0|B(0|(y=0|L(0,0|i[r>>2],32)),0|l,0|d,0|u)),0|l),i[(m=e+32|0)>>2]=u,i[m+4>>2]=l,m=0|L(0,0|i[p>>2],32),u=l,h=0|B(0|(g=0|L(0,0|i[_>>2],32)),0|l,0|m,0|u),u=l,m=0|L(0,0|i[s>>2],32),g=l,g=0|G(0|(y=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|m,0|g)),0|l,0|h,0|u),u=l,h=0|L(0,0|i[a>>2],32),y=l,y=0|G(0|g,0|u,0|(d=0|B(0|(m=0|L(0,0|i[f>>2],32)),0|l,0|h,0|y)),0|l),d=l,u=0|L(0,0|i[c>>2],32),g=l,g=0|G(0|y,0|d,0|(m=0|B(0|(h=0|L(0,0|i[n>>2],32)),0|l,0|u,0|g)),0|l),m=l,d=0|L(0,0|i[t>>2],32),y=l,y=0|G(0|g,0|m,0|(E=0|B(0|(h=0|L(0,0|i[(u=r+40|0)>>2],32)),0|l,0|d,0|y)),0|l),E=l,g=0|L(0,0|i[(m=t+40|0)>>2],32),d=l,d=0|G(0|y,0|E,0|(S=0|B(0|(h=0|L(0,0|i[r>>2],32)),0|l,0|g,0|d)),0|l),i[(S=e+40|0)>>2]=d,i[S+4>>2]=l,S=0|L(0,0|i[s>>2],32),d=l,y=0|B(0|(E=0|L(0,0|i[_>>2],32)),0|l,0|S,0|d),d=l,S=0|L(0,0|i[a>>2],32),E=l,E=0|G(0|(h=0|B(0|(g=0|L(0,0|i[u>>2],32)),0|l,0|S,0|E)),0|l,0|y,0|d),d=l,y=0|L(0,0|i[m>>2],32),h=l,g=0|x(0|(h=0|G(0|E,0|d,0|(g=0|B(0|(S=0|L(0,0|i[n>>2],32)),0|l,0|y,0|h)),0|l)),0|l,1),h=l,d=0|L(0,0|i[p>>2],32),E=l,E=0|G(0|g,0|h,0|(S=0|B(0|(y=0|L(0,0|i[f>>2],32)),0|l,0|d,0|E)),0|l),S=l,h=0|L(0,0|i[c>>2],32),g=l,g=0|G(0|E,0|S,0|(y=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|h,0|g)),0|l),y=l,S=0|L(0,0|i[t>>2],32),E=l,E=0|G(0|g,0|y,0|(v=0|B(0|(d=0|L(0,0|i[(h=r+48|0)>>2],32)),0|l,0|S,0|E)),0|l),v=l,g=0|L(0,0|i[(y=t+48|0)>>2],32),S=l,S=0|G(0|E,0|v,0|(T=0|B(0|(d=0|L(0,0|i[r>>2],32)),0|l,0|g,0|S)),0|l),i[(T=e+48|0)>>2]=S,i[T+4>>2]=l,T=0|L(0,0|i[s>>2],32),S=l,E=0|B(0|(v=0|L(0,0|i[f>>2],32)),0|l,0|T,0|S),S=l,T=0|L(0,0|i[c>>2],32),v=l,v=0|G(0|(d=0|B(0|(g=0|L(0,0|i[_>>2],32)),0|l,0|T,0|v)),0|l,0|E,0|S),S=l,E=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|v,0|S,0|(g=0|B(0|(T=0|L(0,0|i[u>>2],32)),0|l,0|E,0|d)),0|l),g=l,S=0|L(0,0|i[m>>2],32),v=l,v=0|G(0|d,0|g,0|(T=0|B(0|(E=0|L(0,0|i[o>>2],32)),0|l,0|S,0|v)),0|l),T=l,g=0|L(0,0|i[a>>2],32),d=l,d=0|G(0|v,0|T,0|(E=0|B(0|(S=0|L(0,0|i[h>>2],32)),0|l,0|g,0|d)),0|l),E=l,T=0|L(0,0|i[y>>2],32),v=l,v=0|G(0|d,0|E,0|(S=0|B(0|(g=0|L(0,0|i[n>>2],32)),0|l,0|T,0|v)),0|l),S=l,E=0|L(0,0|i[t>>2],32),d=l,d=0|G(0|v,0|S,0|(C=0|B(0|(g=0|L(0,0|i[(T=r+56|0)>>2],32)),0|l,0|E,0|d)),0|l),C=l,v=0|L(0,0|i[(S=t+56|0)>>2],32),E=l,E=0|G(0|d,0|C,0|(A=0|B(0|(g=0|L(0,0|i[r>>2],32)),0|l,0|v,0|E)),0|l),i[(A=e+56|0)>>2]=E,i[A+4>>2]=l,A=0|L(0,0|i[c>>2],32),E=l,d=0|B(0|(C=0|L(0,0|i[f>>2],32)),0|l,0|A,0|E),E=l,A=0|L(0,0|i[s>>2],32),C=l,g=0|B(0|(v=0|L(0,0|i[u>>2],32)),0|l,0|A,0|C),C=l,A=0|L(0,0|i[m>>2],32),v=l,v=0|G(0|(P=0|B(0|(b=0|L(0,0|i[_>>2],32)),0|l,0|A,0|v)),0|l,0|g,0|C),C=l,g=0|L(0,0|i[a>>2],32),P=l,P=0|G(0|v,0|C,0|(b=0|B(0|(A=0|L(0,0|i[T>>2],32)),0|l,0|g,0|P)),0|l),b=l,C=0|L(0,0|i[S>>2],32),v=l,v=0|G(0|P,0|b,0|(A=0|B(0|(g=0|L(0,0|i[n>>2],32)),0|l,0|C,0|v)),0|l),v=0|G(0|(A=0|x(0|v,0|l,1)),0|l,0|d,0|E),E=l,d=0|L(0,0|i[p>>2],32),A=l,A=0|G(0|v,0|E,0|(P=0|B(0|(b=0|L(0,0|i[h>>2],32)),0|l,0|d,0|A)),0|l),P=l,E=0|L(0,0|i[y>>2],32),v=l,v=0|G(0|A,0|P,0|(b=0|B(0|(d=0|L(0,0|i[o>>2],32)),0|l,0|E,0|v)),0|l),b=l,P=0|L(0,0|i[t>>2],32),A=l,A=0|G(0|v,0|b,0|(C=0|B(0|(d=0|L(0,0|i[(E=r+64|0)>>2],32)),0|l,0|P,0|A)),0|l),C=l,v=0|L(0,0|i[(b=t+64|0)>>2],32),P=l,P=0|G(0|A,0|C,0|(g=0|B(0|(d=0|L(0,0|i[r>>2],32)),0|l,0|v,0|P)),0|l),i[(g=e+64|0)>>2]=P,i[g+4>>2]=l,g=0|L(0,0|i[c>>2],32),P=l,A=0|B(0|(C=0|L(0,0|i[u>>2],32)),0|l,0|g,0|P),P=l,g=0|L(0,0|i[m>>2],32),C=l,C=0|G(0|(d=0|B(0|(v=0|L(0,0|i[f>>2],32)),0|l,0|g,0|C)),0|l,0|A,0|P),P=l,A=0|L(0,0|i[s>>2],32),d=l,d=0|G(0|C,0|P,0|(v=0|B(0|(g=0|L(0,0|i[h>>2],32)),0|l,0|A,0|d)),0|l),v=l,P=0|L(0,0|i[y>>2],32),C=l,C=0|G(0|d,0|v,0|(g=0|B(0|(A=0|L(0,0|i[_>>2],32)),0|l,0|P,0|C)),0|l),g=l,v=0|L(0,0|i[p>>2],32),d=l,d=0|G(0|C,0|g,0|(A=0|B(0|(P=0|L(0,0|i[T>>2],32)),0|l,0|v,0|d)),0|l),A=l,g=0|L(0,0|i[S>>2],32),C=l,C=0|G(0|d,0|A,0|(P=0|B(0|(v=0|L(0,0|i[o>>2],32)),0|l,0|g,0|C)),0|l),P=l,A=0|L(0,0|i[a>>2],32),d=l,d=0|G(0|C,0|P,0|(v=0|B(0|(g=0|L(0,0|i[E>>2],32)),0|l,0|A,0|d)),0|l),v=l,P=0|L(0,0|i[b>>2],32),C=l,C=0|G(0|d,0|v,0|(g=0|B(0|(A=0|L(0,0|i[n>>2],32)),0|l,0|P,0|C)),0|l),g=l,v=0|L(0,0|i[t>>2],32),d=l,d=0|G(0|C,0|g,0|(M=0|B(0|(A=0|L(0,0|i[(P=r+72|0)>>2],32)),0|l,0|v,0|d)),0|l),M=l,t=0|L(0,0|i[(g=t+72|0)>>2],32),C=l,C=0|G(0|d,0|M,0|(r=0|B(0|(v=0|L(0,0|i[r>>2],32)),0|l,0|t,0|C)),0|l),i[(r=e+72|0)>>2]=C,i[r+4>>2]=l,r=0|L(0,0|i[m>>2],32),C=l,d=0|B(0|(M=0|L(0,0|i[u>>2],32)),0|l,0|r,0|C),C=l,r=0|L(0,0|i[s>>2],32),M=l,M=0|G(0|(v=0|B(0|(t=0|L(0,0|i[T>>2],32)),0|l,0|r,0|M)),0|l,0|d,0|C),C=l,d=0|L(0,0|i[S>>2],32),v=l,v=0|G(0|M,0|C,0|(t=0|B(0|(r=0|L(0,0|i[_>>2],32)),0|l,0|d,0|v)),0|l),t=l,C=0|L(0,0|i[a>>2],32),a=l,a=0|G(0|v,0|t,0|(d=0|B(0|(M=0|L(0,0|i[P>>2],32)),0|l,0|C,0|a)),0|l),d=l,t=0|L(0,0|i[g>>2],32),v=l,n=0|x(0|(v=0|G(0|a,0|d,0|(n=0|B(0|(C=0|L(0,0|i[n>>2],32)),0|l,0|t,0|v)),0|l)),0|l,1),v=l,d=0|L(0,0|i[c>>2],32),a=l,a=0|G(0|n,0|v,0|(C=0|B(0|(t=0|L(0,0|i[h>>2],32)),0|l,0|d,0|a)),0|l),C=l,v=0|L(0,0|i[y>>2],32),n=l,n=0|G(0|a,0|C,0|(t=0|B(0|(d=0|L(0,0|i[f>>2],32)),0|l,0|v,0|n)),0|l),t=l,C=0|L(0,0|i[p>>2],32),a=l,a=0|G(0|n,0|t,0|(d=0|B(0|(v=0|L(0,0|i[E>>2],32)),0|l,0|C,0|a)),0|l),d=l,t=0|L(0,0|i[b>>2],32),n=l,n=0|G(0|a,0|d,0|(v=0|B(0|(C=0|L(0,0|i[o>>2],32)),0|l,0|t,0|n)),0|l),i[(v=e+80|0)>>2]=n,i[v+4>>2]=l,v=0|L(0,0|i[m>>2],32),n=l,a=0|B(0|(d=0|L(0,0|i[h>>2],32)),0|l,0|v,0|n),n=l,v=0|L(0,0|i[y>>2],32),d=l,d=0|G(0|(C=0|B(0|(t=0|L(0,0|i[u>>2],32)),0|l,0|v,0|d)),0|l,0|a,0|n),n=l,a=0|L(0,0|i[c>>2],32),C=l,C=0|G(0|d,0|n,0|(t=0|B(0|(v=0|L(0,0|i[T>>2],32)),0|l,0|a,0|C)),0|l),t=l,n=0|L(0,0|i[S>>2],32),d=l,d=0|G(0|C,0|t,0|(v=0|B(0|(a=0|L(0,0|i[f>>2],32)),0|l,0|n,0|d)),0|l),v=l,t=0|L(0,0|i[s>>2],32),C=l,C=0|G(0|d,0|v,0|(a=0|B(0|(n=0|L(0,0|i[E>>2],32)),0|l,0|t,0|C)),0|l),a=l,v=0|L(0,0|i[b>>2],32),d=l,d=0|G(0|C,0|a,0|(n=0|B(0|(t=0|L(0,0|i[_>>2],32)),0|l,0|v,0|d)),0|l),n=l,a=0|L(0,0|i[p>>2],32),p=l,p=0|G(0|d,0|n,0|(v=0|B(0|(C=0|L(0,0|i[P>>2],32)),0|l,0|a,0|p)),0|l),v=l,n=0|L(0,0|i[g>>2],32),d=l,d=0|G(0|p,0|v,0|(o=0|B(0|(a=0|L(0,0|i[o>>2],32)),0|l,0|n,0|d)),0|l),i[(o=e+88|0)>>2]=d,i[o+4>>2]=l,o=0|L(0,0|i[y>>2],32),d=l,p=0|B(0|(v=0|L(0,0|i[h>>2],32)),0|l,0|o,0|d),d=l,o=0|L(0,0|i[m>>2],32),v=l,a=0|B(0|(n=0|L(0,0|i[T>>2],32)),0|l,0|o,0|v),v=l,o=0|L(0,0|i[S>>2],32),n=l,n=0|G(0|(t=0|B(0|(C=0|L(0,0|i[u>>2],32)),0|l,0|o,0|n)),0|l,0|a,0|v),v=l,a=0|L(0,0|i[s>>2],32),s=l,s=0|G(0|n,0|v,0|(o=0|B(0|(t=0|L(0,0|i[P>>2],32)),0|l,0|a,0|s)),0|l),o=l,v=0|L(0,0|i[g>>2],32),n=l,n=0|G(0|s,0|o,0|(_=0|B(0|(a=0|L(0,0|i[_>>2],32)),0|l,0|v,0|n)),0|l),n=0|G(0|(_=0|x(0|n,0|l,1)),0|l,0|p,0|d),d=l,p=0|L(0,0|i[c>>2],32),_=l,_=0|G(0|n,0|d,0|(s=0|B(0|(o=0|L(0,0|i[E>>2],32)),0|l,0|p,0|_)),0|l),s=l,d=0|L(0,0|i[b>>2],32),n=l,n=0|G(0|_,0|s,0|(o=0|B(0|(p=0|L(0,0|i[f>>2],32)),0|l,0|d,0|n)),0|l),i[(o=e+96|0)>>2]=n,i[o+4>>2]=l,o=0|L(0,0|i[y>>2],32),n=l,_=0|B(0|(s=0|L(0,0|i[T>>2],32)),0|l,0|o,0|n),n=l,o=0|L(0,0|i[S>>2],32),s=l,s=0|G(0|(p=0|B(0|(d=0|L(0,0|i[h>>2],32)),0|l,0|o,0|s)),0|l,0|_,0|n),n=l,_=0|L(0,0|i[m>>2],32),p=l,p=0|G(0|s,0|n,0|(d=0|B(0|(o=0|L(0,0|i[E>>2],32)),0|l,0|_,0|p)),0|l),d=l,n=0|L(0,0|i[b>>2],32),s=l,s=0|G(0|p,0|d,0|(o=0|B(0|(_=0|L(0,0|i[u>>2],32)),0|l,0|n,0|s)),0|l),o=l,d=0|L(0,0|i[c>>2],32),c=l,c=0|G(0|s,0|o,0|(n=0|B(0|(p=0|L(0,0|i[P>>2],32)),0|l,0|d,0|c)),0|l),n=l,o=0|L(0,0|i[g>>2],32),s=l,s=0|G(0|c,0|n,0|(f=0|B(0|(d=0|L(0,0|i[f>>2],32)),0|l,0|o,0|s)),0|l),i[(f=e+104|0)>>2]=s,i[f+4>>2]=l,f=0|L(0,0|i[S>>2],32),s=l,c=0|B(0|(n=0|L(0,0|i[T>>2],32)),0|l,0|f,0|s),s=l,f=0|L(0,0|i[m>>2],32),m=l,m=0|G(0|(o=0|B(0|(n=0|L(0,0|i[P>>2],32)),0|l,0|f,0|m)),0|l,0|c,0|s),s=l,c=0|L(0,0|i[g>>2],32),o=l,u=0|x(0|(o=0|G(0|m,0|s,0|(u=0|B(0|(f=0|L(0,0|i[u>>2],32)),0|l,0|c,0|o)),0|l)),0|l,1),o=l,s=0|L(0,0|i[y>>2],32),m=l,m=0|G(0|u,0|o,0|(f=0|B(0|(c=0|L(0,0|i[E>>2],32)),0|l,0|s,0|m)),0|l),f=l,o=0|L(0,0|i[b>>2],32),u=l,u=0|G(0|m,0|f,0|(c=0|B(0|(s=0|L(0,0|i[h>>2],32)),0|l,0|o,0|u)),0|l),i[(c=e+112|0)>>2]=u,i[c+4>>2]=l,c=0|L(0,0|i[S>>2],32),u=l,m=0|B(0|(f=0|L(0,0|i[E>>2],32)),0|l,0|c,0|u),u=l,c=0|L(0,0|i[b>>2],32),f=l,f=0|G(0|(s=0|B(0|(o=0|L(0,0|i[T>>2],32)),0|l,0|c,0|f)),0|l,0|m,0|u),u=l,m=0|L(0,0|i[y>>2],32),y=l,y=0|G(0|f,0|u,0|(c=0|B(0|(s=0|L(0,0|i[P>>2],32)),0|l,0|m,0|y)),0|l),c=l,u=0|L(0,0|i[g>>2],32),f=l,f=0|G(0|y,0|c,0|(h=0|B(0|(m=0|L(0,0|i[h>>2],32)),0|l,0|u,0|f)),0|l),i[(h=e+120|0)>>2]=f,i[h+4>>2]=l,h=0|L(0,0|i[b>>2],32),f=l,y=0|B(0|(c=0|L(0,0|i[E>>2],32)),0|l,0|h,0|f),f=l,h=0|L(0,0|i[S>>2],32),S=l,u=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|h,0|S),S=l,h=0|L(0,0|i[g>>2],32),c=l,c=0|G(0|(T=0|B(0|(m=0|L(0,0|i[T>>2],32)),0|l,0|h,0|c)),0|l,0|u,0|S),c=0|G(0|(S=0|x(0|c,0|l,1)),0|l,0|y,0|f),i[(f=e+128|0)>>2]=c,i[f+4>>2]=l,f=0|L(0,0|i[b>>2],32),b=l,y=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|f,0|b),b=l,f=0|L(0,0|i[g>>2],32),c=l,c=0|G(0|(E=0|B(0|(S=0|L(0,0|i[E>>2],32)),0|l,0|f,0|c)),0|l,0|y,0|b),i[(b=e+136|0)>>2]=c,i[b+4>>2]=l,b=0|L(0,0|i[g>>2],31),g=l,P=0|B(0|(c=0|L(0,0|i[P>>2],32)),0|l,0|b,0|g),i[(g=e+144|0)>>2]=P,i[g+4>>2]=l}function M(e,t){e|=0;var r,n,a,s=0,c=0,d=0,u=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,b=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,N=0,U=0,F=0,K=0,j=0,Y=0,W=0,H=0,V=0,$=0,z=0,q=0;r=o,o=o+160|0,s=r,u=0|B(0|(n=0|L(0,0|(c=0|i[(t|=0)>>2]),32)),0|(d=l),0|n,0|d),i[(p=s)>>2]=u,i[p+4>>2]=l,p=0|L(0,0|c,31),c=l,g=0|B(0|(_=0|L(0,0|(f=0|i[(u=t+8|0)>>2]),32)),0|(h=l),0|p,0|c),i[(m=a=s+8|0)>>2]=g,i[m+4>>2]=l,m=0|B(0|_,0|h,0|_,0|h),g=l,g=0|x(0|(T=0|G(0|(v=0|B(0|(E=0|L(0,0|i[(y=t+16|0)>>2],32)),0|(S=l),0|n,0|d)),0|l,0|m,0|g)),0|l,1),i[(m=T=s+16|0)>>2]=g,i[m+4>>2]=l,m=0|B(0|E,0|S,0|_,0|h),g=l,g=0|x(0|(P=0|G(0|(b=0|B(0|(C=0|L(0,0|i[(v=t+24|0)>>2],32)),0|(A=l),0|n,0|d)),0|l,0|m,0|g)),0|l,1),i[(m=P=s+24|0)>>2]=g,i[m+4>>2]=l,m=0|B(0|E,0|S,0|E,0|S),g=l,b=0|G(0|(M=0|B(0|C,0|A,0|(b=0|L(0,0|f,30)),0|l)),0|l,0|m,0|g),c=0|G(0|b,0|(g=l),0|(I=0|B(0|(M=0|L(0,0|i[(m=t+32|0)>>2],32)),0|(O=l),0|p,0|c)),0|l),i[(g=I=s+32|0)>>2]=c,i[g+4>>2]=l,g=0|B(0|C,0|A,0|E,0|S),c=l,p=0|G(0|(b=0|B(0|M,0|O,0|_,0|h)),0|l,0|g,0|c),R=0|x(0|(D=0|G(0|p,0|(c=l),0|(R=0|B(0|(b=0|L(0,0|i[(g=t+40|0)>>2],32)),0|(w=l),0|n,0|d)),0|l)),0|l,1),i[(c=D=s+40|0)>>2]=R,i[c+4>>2]=l,c=0|B(0|C,0|A,0|C,0|A),R=l,N=0|G(0|(p=0|B(0|M,0|O,0|E,0|S)),0|l,0|c,0|R),K=0|G(0|N,0|(R=l),0|(F=0|B(0|(p=0|L(0,0|i[(c=t+48|0)>>2],32)),0|(U=l),0|n,0|d)),0|l),f=0|x(0|(R=0|G(0|K,0|(F=l),0|(f=0|B(0|b,0|w,0|(R=0|L(0,0|f,31)),0|l)),0|l)),0|l,1),i[(F=R=s+48|0)>>2]=f,i[F+4>>2]=l,F=0|B(0|M,0|O,0|C,0|A),f=l,N=0|G(0|(K=0|B(0|b,0|w,0|E,0|S)),0|l,0|F,0|f),K=0|G(0|N,0|(f=l),0|(F=0|B(0|p,0|U,0|_,0|h)),0|l),Y=0|x(0|(W=0|G(0|K,0|(F=l),0|(Y=0|B(0|(N=0|L(0,0|i[(f=t+56|0)>>2],32)),0|(j=l),0|n,0|d)),0|l)),0|l,1),i[(F=W=s+56|0)>>2]=Y,i[F+4>>2]=l,F=0|B(0|M,0|O,0|M,0|O),Y=l,K=0|B(0|p,0|U,0|E,0|S),H=l,d=0|G(0|(q=0|B(0|($=0|L(0,0|i[(V=t+64|0)>>2],32)),0|(z=l),0|n,0|d)),0|l,0|K,0|H),H=l,K=0|B(0|N,0|j,0|_,0|h),h=l,q=0|G(0|(_=0|B(0|b,0|w,0|C,0|A)),0|l,0|K,0|h),q=0|G(0|d,0|H,0|(h=0|x(0|q,0|l,1)),0|l),q=0|G(0|(h=0|x(0|q,0|l,1)),0|l,0|F,0|Y),i[(F=Y=s+64|0)>>2]=q,i[F+4>>2]=l,F=0|B(0|b,0|w,0|M,0|O),q=l,A=0|G(0|(h=0|B(0|p,0|U,0|C,0|A)),0|l,0|F,0|q),S=0|G(0|A,0|(q=l),0|(F=0|B(0|N,0|j,0|E,0|S)),0|l),E=0|G(0|S,0|(F=l),0|(A=0|B(0|$,0|z,0|(q=0|L(0,0|i[u>>2],32)),0|(u=l))),0|l),A=l,F=0|L(0,0|i[t>>2],32),S=l,H=0|x(0|(S=0|G(0|E,0|A,0|(H=0|B(0|(t=0|L(0,0|(h=0|i[t+72>>2]),32)),0|(C=l),0|F,0|S)),0|l)),0|l,1),i[(S=s+72|0)>>2]=H,i[S+4>>2]=l,S=0|B(0|b,0|w,0|b,0|w),H=l,O=0|G(0|(A=0|B(0|p,0|U,0|M,0|O)),0|l,0|S,0|H),M=0|G(0|O,0|(H=l),0|(A=0|B(0|$,0|z,0|(S=0|L(0,0|i[y>>2],32)),0|(y=l))),0|l),A=l,O=0|B(0|N,0|j,0|(H=0|L(0,0|i[v>>2],32)),0|(v=l)),E=l,E=0|x(0|(u=0|G(0|(F=0|B(0|t,0|C,0|q,0|u)),0|l,0|O,0|E)),0|l,1),E=0|x(0|(u=0|G(0|M,0|A,0|E,0|l)),0|l,1),i[(A=u=s+80|0)>>2]=E,i[A+4>>2]=l,A=0|B(0|p,0|U,0|b,0|w),w=l,M=0|G(0|(E=0|B(0|N,0|j,0|(b=0|L(0,0|i[m>>2],32)),0|(m=l))),0|l,0|A,0|w),E=0|G(0|M,0|(w=l),0|(A=0|B(0|$,0|z,0|H,0|v)),0|l),A=0|x(0|(y=0|G(0|E,0|(A=l),0|(w=0|B(0|t,0|C,0|S,0|y)),0|l)),0|(w=l),1),E=l,i[(S=s+88|0)>>2]=A,i[S+4>>2]=E,S=0|B(0|p,0|U,0|p,0|U),U=l,p=0|B(0|$,0|z,0|b,0|m),M=l,q=0|B(0|N,0|j,0|(g=0|L(0,0|(O=0|i[g>>2]),32)),0|(F=l)),d=l,v=0|G(0|(K=0|B(0|t,0|C,0|H,0|v)),0|l,0|q,0|d),v=0|G(0|(d=0|x(0|v,0|l,1)),0|l,0|p,0|M),v=0|G(0|(M=0|x(0|v,0|l,1)),0|l,0|S,0|U),U=l,i[(S=s+96|0)>>2]=v,i[S+4>>2]=U,M=0|B(0|N,0|j,0|(S=0|L(0,0|i[c>>2],32)),0|(c=l)),j=l,F=0|G(0|(N=0|B(0|$,0|z,0|g,0|F)),0|l,0|M,0|j),j=0|x(0|(m=0|G(0|F,0|(j=l),0|(M=0|B(0|t,0|C,0|b,0|m)),0|l)),0|(M=l),1),F=l,i[(b=s+104|0)>>2]=j,i[b+4>>2]=F,g=0|B(0|(f=0|L(0,0|(b=0|i[f>>2]),32)),0|(N=l),0|f,0|N),p=l,z=0|G(0|(d=0|B(0|$,0|z,0|S,0|c)),0|l,0|g,0|p),p=0|x(0|(g=0|G(0|z,0|(p=l),0|(O=0|B(0|t,0|C,0|(g=0|L(0,0|O,31)),0|l)),0|l)),0|(O=l),1),z=l,i[(d=s+112|0)>>2]=p,i[d+4>>2]=z,q=0|B(0|(V=0|L(0,0|(d=0|i[V>>2]),32)),0|($=l),0|f,0|N),N=l,q=0|x(0|(c=0|G(0|(f=0|B(0|t,0|C,0|S,0|c)),0|l,0|q,0|N)),0|(N=l),1),f=l,i[(S=s+120|0)>>2]=q,i[S+4>>2]=f,S=0|B(0|V,0|$,0|V,0|$),$=l,V=0|G(0|(b=0|B(0|t,0|C,0|(V=0|L(0,0|b,30)),0|l)),0|l,0|S,0|$),$=l,i[(S=s+128|0)>>2]=V,i[S+4>>2]=$,d=0|B(0|t,0|C,0|(S=0|L(0,0|d,31)),0|l),S=l,i[(b=s+136|0)>>2]=d,i[b+4>>2]=S,h=0|B(0|(b=0|L(0,0|h,31)),0|l,0|t,0|C),C=l,i[(t=s+144|0)>>2]=h,i[t+4>>2]=C,b=0|i[(t=Y)>>2],K=0|i[t+4>>2],t=0|B(0|h,0|C,18,0),H=l,_=0|G(0|h,0|C,0|b,0|K),K=0|G(0|_,0|l,0|t,0|H),i[(H=Y)>>2]=K,i[H+4>>2]=l,K=0|i[(H=W)>>2],Y=0|i[H+4>>2],H=0|B(0|d,0|S,18,0),t=l,_=0|G(0|K,0|Y,0|d,0|S),S=0|G(0|_,0|l,0|H,0|t),i[(t=W)>>2]=S,i[t+4>>2]=l,S=0|i[(t=R)>>2],W=0|i[t+4>>2],t=0|B(0|V,0|$,18,0),H=l,_=0|G(0|S,0|W,0|V,0|$),$=0|G(0|_,0|l,0|t,0|H),i[(H=R)>>2]=$,i[H+4>>2]=l,$=0|i[(H=D)>>2],R=0|i[H+4>>2],H=0|B(0|c,0|N,36,0),N=l,c=0|G(0|$,0|R,0|q,0|f),f=0|G(0|c,0|l,0|H,0|N),i[(N=D)>>2]=f,i[N+4>>2]=l,f=0|i[(N=I)>>2],D=0|i[N+4>>2],N=0|B(0|g,0|O,36,0),O=l,g=0|G(0|f,0|D,0|p,0|z),z=0|G(0|g,0|l,0|N,0|O),i[(O=I)>>2]=z,i[O+4>>2]=l,z=0|i[(O=P)>>2],I=0|i[O+4>>2],O=0|B(0|m,0|M,36,0),M=l,m=0|G(0|z,0|I,0|j,0|F),F=0|G(0|m,0|l,0|O,0|M),i[(M=P)>>2]=F,i[M+4>>2]=l,F=0|i[(M=T)>>2],P=0|i[M+4>>2],M=0|B(0|v,0|U,18,0),O=l,m=0|G(0|F,0|P,0|v,0|U),U=0|G(0|m,0|l,0|M,0|O),i[(O=T)>>2]=U,i[O+4>>2]=l,U=0|i[(O=a)>>2],T=0|i[O+4>>2],O=0|B(0|y,0|w,36,0),w=l,y=0|G(0|U,0|T,0|A,0|E),E=0|G(0|y,0|l,0|O,0|w),i[(w=a)>>2]=E,i[w+4>>2]=l,E=0|i[(w=u)>>2],O=0|i[w+4>>2],y=0|i[(w=s)>>2],A=0|i[w+4>>2],w=0|B(0|E,0|O,18,0),T=l,U=0|G(0|y,0|A,0|E,0|O),O=0|G(0|U,0|l,0|w,0|T),T=l,i[(w=s)>>2]=O,i[w+4>>2]=T,i[(w=u)>>2]=0,i[w+4>>2]=0,w=T,T=O,O=0;do{y=0|k(0|T,0|w,0|(A=0|x(0|(E=0|L(0|(U=0|G(w>>31>>>6|0,0,0|T,0|w)),0|l,26)),0|(U=l),26)),0|l),i[(A=s+(O<<3)|0)>>2]=y,i[A+4>>2]=l,v=0|k(0|(M=0|G(0|E,0|U,0|i[(y=A=s+((1|O)<<3)|0)>>2],0|i[y+4>>2])),0|(y=l),0|(m=0|x(0|(E=0|L(0|(U=0|G(y>>31>>>7|0,0,0|M,0|y)),0|l,25)),0|(U=l),25)),0|l),i[(m=A)>>2]=v,i[m+4>>2]=l,T=0|G(0|E,0|U,0|i[(v=m=s+((O=O+2|0)<<3)|0)>>2],0|i[v+4>>2]),w=l,i[(v=m)>>2]=T,i[v+4>>2]=w}while(O>>>0<10);w=0|i[(O=u)>>2],T=0|i[O+4>>2],v=0|i[(O=s)>>2],m=0|i[O+4>>2],O=0|B(0|w,0|T,18,0),U=l,E=0|G(0|v,0|m,0|w,0|T),T=0|G(0|E,0|l,0|O,0|U),U=l,i[(O=u)>>2]=0,i[O+4>>2]=0,w=0|k(0|T,0|U,0|(E=0|x(0|(u=0|L(0|(O=0|G(U>>31>>>6|0,0,0|T,0|U)),0|l,26)),0|(O=l),26)),0|l),i[(E=s)>>2]=w,i[E+4>>2]=l,w=0|G(0|u,0|O,0|i[(E=a)>>2],0|i[E+4>>2]),i[(E=a)>>2]=w,i[E+4>>2]=l,E=e,e=s,s=E+80|0;do{i[E>>2]=i[e>>2],E=E+4|0,e=e+4|0}while((0|E)<(0|s));o=r}function O(){return 0|(0|i[2]?0|i[60+(0|f())>>2]:56)}function I(e){var t=0;return(e|=0)>>>0>4294963200?(i[(0|O())>>2]=0-e,t=-1):t=e,0|t}function w(e){return 0,0}function R(e){0}function D(e,t,r){t|=0,r|=0;var n,a,s,l,c,d=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,E=0,S=0,v=0,C=0,b=0,P=0,M=0,O=0;for(n=o,o=o+48|0,a=n+16|0,s=n,d=n+32|0,p=0|i[(l=(e|=0)+28|0)>>2],i[d>>2]=p,f=(0|i[(c=e+20|0)>>2])-p|0,i[d+4>>2]=f,i[d+8>>2]=t,i[d+12>>2]=r,t=e+60|0,p=e+44|0,_=d,d=2,h=f+r|0;;){if(0|i[2]?(T(1,0|e),i[s>>2]=i[t>>2],i[s+4>>2]=_,i[s+8>>2]=d,f=0|I(0|A(146,0|s)),u(0),g=f):(i[a>>2]=i[t>>2],i[a+4>>2]=_,i[a+8>>2]=d,g=0|I(0|A(146,0|a))),(0|h)==(0|g)){m=6;break}if((0|g)<0){y=_,E=d,m=8;break}f=h-g|0,g>>>0<=(S=0|i[_+4>>2])>>>0?2==(0|d)?(i[l>>2]=(0|i[l>>2])+g,v=S,C=g,b=_,P=2):(v=S,C=g,b=_,P=d):(M=0|i[p>>2],i[l>>2]=M,i[c>>2]=M,v=0|i[_+12>>2],C=g-S|0,b=_+8|0,P=d+-1|0),i[b>>2]=(0|i[b>>2])+C,i[b+4>>2]=v-C,_=b,d=P,h=f}return 6==(0|m)?(h=0|i[p>>2],i[e+16>>2]=h+(0|i[e+48>>2]),p=h,i[l>>2]=p,i[c>>2]=p,O=r):8==(0|m)&&(i[e+16>>2]=0,i[l>>2]=0,i[c>>2]=0,i[e>>2]=32|i[e>>2],O=2==(0|E)?0:r-(0|i[y+4>>2])|0),o=n,0|O}function N(e){var t,r,n=0,a=0,o=0,s=0,l=0;return r=(e|=0)+28|0,(0|i[(t=e+20|0)>>2])>>>0>(0|i[r>>2])>>>0&&(j[3&i[e+36>>2]](e,0,0),0==(0|i[t>>2]))?n=-1:((o=0|i[(a=e+4|0)>>2])>>>0<(l=0|i[(s=e+8|0)>>2])>>>0&&j[3&i[e+40>>2]](e,o-l|0,1),i[e+16>>2]=0,i[r>>2]=0,i[t>>2]=0,i[s>>2]=0,i[a>>2]=0,n=0),0|n}function L(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t>>r,e>>>r|(t&(1<<r)-1)<<32-r):(l=(0|t)<0?-1:0,t>>r-32|0)}function k(e,t,r,n){return(t|=0)-(n|=0)>>>0,0|(l=t-n-((r|=0)>>>0>(e|=0)>>>0|0)>>>0,e-r>>>0|0)}function G(e,t,r,n){var i;return 0|(l=(t|=0)+(n|=0)+((i=(e|=0)+(r|=0)>>>0)>>>0<e>>>0|0)>>>0,0|i)}function U(e,t,r){t|=0;var a,o=0,s=0,l=0;if(a=(e|=0)+(r|=0)|0,(0|r)>=20){if(s=(t&=255)|t<<8|t<<16|t<<24,l=-4&a,o=3&e)for(o=e+4-o|0;(0|e)<(0|o);)n[e>>0]=t,e=e+1|0;for(;(0|e)<(0|l);)i[e>>2]=s,e=e+4|0}for(;(0|e)<(0|a);)n[e>>0]=t,e=e+1|0;return e-r|0}function F(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t>>>r,e>>>r|(t&(1<<r)-1)<<32-r):(l=0,t>>>r-32|0)}function x(e,t,r){return e|=0,t|=0,(0|(r|=0))<32?(l=t<<r|(e&(1<<r)-1<<32-r)>>>32-r,e<<r):(l=e<<r-32,0)}function B(e,t,r,n){t|=0,n|=0;var i,a;return r=0|function(e,t){var r,n,i,a=0;return e=((n=0|c(a=65535&(t|=0),r=65535&(e|=0)))>>>16)+(0|c(a,i=e>>>16))|0,t=0|c(a=t>>>16,r),0|(l=(e>>>16)+(0|c(a,i))+(((65535&e)+t|0)>>>16)|0,e+t<<16|65535&n|0)}(i=e|=0,e=r|=0),a=l,0|(l=(0|c(t,e))+(0|c(n,i))+a|0&a,0|r)}var K=[function(e){return 0,d(0),0},function(e){var t,r;return e|=0,t=o,o=o+16|0,i[(r=t)>>2]=i[e+60>>2],e=0|I(0|_(6,0|r)),o=t,0|e}],j=[function(e,t,r){return 0,0,0,d(1),0},function(e,t,r){t|=0,r|=0;var a,s=0;return a=o,o=o+80|0,s=a,i[(e|=0)+36>>2]=3,0==(64&i[e>>2]|0)&&(i[s>>2]=i[e+60>>2],i[s+4>>2]=21505,i[s+8>>2]=a+12,0!=(0|E(54,0|s)))&&(n[e+75>>0]=-1),s=0|D(e,t,r),o=a,0|s},function(e,t,r){e|=0,t|=0,r|=0;var n,a,s,l=0;return n=o,o=o+32|0,s=n+20|0,i[(a=n)>>2]=i[e+60>>2],i[a+4>>2]=0,i[a+8>>2]=t,i[a+12>>2]=s,i[a+16>>2]=r,(0|I(0|v(140,0|a)))<0?(i[s>>2]=-1,l=-1):l=0|i[s>>2],o=n,0|l},D],Y=[function(e){d(2)},function(e){0|i[(e|=0)+68>>2]||R()}];return{_curve25519_donna:function(e,t,r){e|=0,r|=0;var s,d,u,p,f,_,h,g,m,y,E,S,v,T,C,A,O,I,w,R,D,N,K,j,Y,W,H,V,$,z,q,J,Q,X,Z,ee,te,re,ne,ie,ae,oe,se,le,ce,de,ue,pe,fe,_e,he,ge,me,ye,Ee,Se,ve,Te,Ce,Ae=0,be=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Ne=0,Le=0,ke=0,Ge=0,Ue=0,Fe=0,xe=0,Be=0,Ke=0,je=0,Ye=0,We=0,He=0,Ve=0,$e=0,ze=0,qe=0,Je=0,Qe=0,Xe=0,Ze=0,et=0,tt=0,rt=0,nt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,dt=0,ut=0,pt=0,ft=0,_t=0,ht=0,gt=0,mt=0,yt=0,Et=0,St=0,vt=0,Tt=0,Ct=0,At=0,bt=0,Pt=0,Mt=0,Ot=0,It=0,wt=0,Rt=0,Dt=0,Nt=0,Lt=0,kt=0,Gt=0,Ut=0,Ft=0,xt=0,Bt=0,Kt=0,jt=0,Yt=0,Wt=0,Ht=0,Vt=0,$t=0,zt=0,qt=0,Jt=0,Qt=0,Xt=0,Zt=0,er=0,tr=0,rr=0,nr=0,ir=0,ar=0,or=0,sr=0,lr=0,cr=0,dr=0,ur=0,pr=0,fr=0,_r=0,hr=0,gr=0,mr=0,yr=0,Er=0,Sr=0,vr=0,Tr=0,Cr=0,Ar=0,br=0,Pr=0,Mr=0,Or=0,Ir=0,wr=0,Rr=0,Dr=0,Nr=0;s=o,o=o+2640|0,Ae=s+2456|0,be=s+2304|0,Pe=s+2152|0,Me=s+2e3|0,Oe=s+1848|0,Ie=s+1696|0,we=s+1544|0,Re=s+1392|0,De=s+1240|0,Ne=s+1088|0,Le=s+936|0,ke=s+784|0,Ge=s+632|0,Ue=s+480|0,Fe=s+328|0,d=s+248|0,xe=s+168|0,Be=s+80|0,Ke=s,Ye=t|=0,t=(je=u=s+2608|0)+32|0;do{n[je>>0]=0|n[Ye>>0],je=je+1|0,Ye=Ye+1|0}while((0|je)<(0|t));n[u>>0]=248&(0|a[u>>0]),n[(We=u+31|0)>>0]=63&(0|a[We>>0])|64,We=0|a[r>>0],He=0|x(0|a[r+1>>0],0,8),Ve=l,$e=0|x(0|a[r+2>>0],0,16),ze=Ve|l,qe=0|x(0|(Ve=0|a[r+3>>0]),0,24),i[(Je=d)>>2]=He|We|$e|50331648&qe,i[Je+4>>2]=ze,ze=0|x(0|a[r+4>>0],0,8),Je=l,qe=0|x(0|a[r+5>>0],0,16),$e=Je|l,He=0|F(ze|Ve|qe|(We=0|x(0|(Je=0|a[r+6>>0]),0,24))|0,$e|l|0,2),i[($e=d+8|0)>>2]=33554431&He,i[$e+4>>2]=0,$e=0|x(0|a[r+7>>0],0,8),He=l,We=0|x(0|a[r+8>>0],0,16),qe=He|l,ze=0|F($e|Je|We|(Ve=0|x(0|(He=0|a[r+9>>0]),0,24))|0,qe|l|0,3),i[(qe=d+16|0)>>2]=67108863&ze,i[qe+4>>2]=0,qe=0|x(0|a[r+10>>0],0,8),ze=l,Ve=0|x(0|a[r+11>>0],0,16),We=ze|l,$e=0|F(qe|He|Ve|(Je=0|x(0|(ze=0|a[r+12>>0]),0,24))|0,We|l|0,5),i[(We=d+24|0)>>2]=33554431&$e,i[We+4>>2]=0,We=0|x(0|a[r+13>>0],0,8),$e=l,Je=0|x(0|a[r+14>>0],0,16),Ve=$e|l,He=0|F(We|ze|Je|($e=0|x(0|a[r+15>>0],0,24))|0,Ve|l|0,6),i[(Ve=d+32|0)>>2]=67108863&He,i[Ve+4>>2]=0,Ve=0|a[r+16>>0],He=0|x(0|a[r+17>>0],0,8),$e=l,Je=0|x(0|a[r+18>>0],0,16),ze=$e|l,We=0|x(0|($e=0|a[r+19>>0]),0,24),i[(qe=d+40|0)>>2]=He|Ve|Je|16777216&We,i[qe+4>>2]=ze,ze=0|x(0|a[r+20>>0],0,8),qe=l,We=0|x(0|a[r+21>>0],0,16),Je=qe|l,He=0|F(ze|$e|We|(Ve=0|x(0|(qe=0|a[r+22>>0]),0,24))|0,Je|l|0,1),i[(Je=d+48|0)>>2]=67108863&He,i[Je+4>>2]=0,Je=0|x(0|a[r+23>>0],0,8),He=l,Ve=0|x(0|a[r+24>>0],0,16),We=He|l,ze=0|F(Je|qe|Ve|($e=0|x(0|(He=0|a[r+25>>0]),0,24))|0,We|l|0,3),i[(We=d+56|0)>>2]=33554431&ze,i[We+4>>2]=0,We=0|x(0|a[r+26>>0],0,8),ze=l,$e=0|x(0|a[r+27>>0],0,16),Ve=ze|l,Je=0|F(We|He|$e|(qe=0|x(0|(ze=0|a[r+28>>0]),0,24))|0,Ve|l|0,4),i[(Ve=d+64|0)>>2]=67108863&Je,i[Ve+4>>2]=0,Ve=0|x(0|a[r+29>>0],0,8),Je=l,qe=0|x(0|a[r+30>>0],0,16),$e=Je|l,r=0|F(Ve|ze|qe|(Je=0|x(0|a[r+31>>0],0,24))|0,$e|l|0,6),i[($e=d+72|0)>>2]=33554431&r,i[$e+4>>2]=0,U(0|De,0,152),i[($e=De)>>2]=1,i[$e+4>>2]=0,U(0|Ne,0,152),i[($e=Ne)>>2]=1,i[$e+4>>2]=0,U(0|Le,0,152),U(0|ke,0,152),U(0|Ge,0,152),i[($e=Ge)>>2]=1,i[$e+4>>2]=0,U(0|Ue,0,152),U(0|Fe,0,152),i[($e=Fe)>>2]=1,i[$e+4>>2]=0,t=(je=Re+80|0)+72|0;do{i[je>>2]=0,je=je+4|0}while((0|je)<(0|t));Ye=d,t=(je=Re)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));for($e=Me+144|0,r=Me+64|0,Je=Me+136|0,qe=Me+56|0,ze=Me+128|0,Ve=Me+48|0,He=Me+120|0,We=Me+40|0,p=Me+112|0,f=Me+32|0,_=Me+104|0,h=Me+24|0,g=Me+96|0,m=Me+16|0,y=Me+88|0,E=Me+8|0,S=Me+80|0,v=Oe+144|0,T=Oe+64|0,C=Oe+136|0,A=Oe+56|0,O=Oe+128|0,I=Oe+48|0,w=Oe+120|0,R=Oe+40|0,D=Oe+112|0,N=Oe+32|0,K=Oe+104|0,j=Oe+24|0,Y=Oe+96|0,W=Oe+16|0,H=Oe+88|0,V=Oe+8|0,$=Oe+80|0,z=Me+72|0,q=Oe+72|0,J=be+8|0,Q=Pe+8|0,X=be+16|0,Z=Pe+16|0,ee=be+24|0,te=Pe+24|0,re=be+32|0,ne=Pe+32|0,ie=be+40|0,ae=Pe+40|0,oe=be+48|0,se=Pe+48|0,le=be+56|0,ce=Pe+56|0,de=be+64|0,ue=Pe+64|0,pe=be+72|0,fe=Pe+72|0,_e=Ae+80|0,he=Ae+8|0,ge=Ae+16|0,me=Ae+24|0,ye=Ae+32|0,Ee=Ae+40|0,Se=Ae+48|0,ve=Ae+56|0,Te=Ae+64|0,Ce=Ae+72|0,Qe=0,Xe=Re,Ze=ke,ke=De,et=Ge,Ge=Ne,tt=Ue,Ue=Le,Le=Fe;;){for(Fe=0|n[u+(31-Qe)>>0],rt=0,nt=Xe,it=Ze,at=ke,ot=et,st=Ge,lt=tt,ct=Ue,dt=Le;;){pt=0|k(0,0,(ut=255&Fe)>>>7|0,0),ft=l,_t=0;do{mt=0|i[(gt=ht=st+(_t<<3)|0)>>2],yt=0|i[gt+4>>2],St=0|i[(Et=gt=nt+(_t<<3)|0)>>2],Tt=((vt=0|i[Et+4>>2])^yt)&ft,yt=0|L(0,(Et=(St^mt)&pt)^mt|0,32),i[(mt=ht)>>2]=yt,i[mt+4>>2]=l,mt=0|L(0,Et^St|0,32),i[(St=gt)>>2]=mt,i[St+4>>2]=l,_t=_t+1|0}while(10!=(0|_t));Ct=0;do{mt=0|i[(St=_t=ct+(Ct<<3)|0)>>2],gt=0|i[St+4>>2],yt=0|i[(Et=St=at+(Ct<<3)|0)>>2],vt=((ht=0|i[Et+4>>2])^gt)&ft,gt=0|L(0,(Et=(yt^mt)&pt)^mt|0,32),i[(mt=_t)>>2]=gt,i[mt+4>>2]=l,mt=0|L(0,Et^yt|0,32),i[(yt=St)>>2]=mt,i[yt+4>>2]=l,Ct=Ct+1|0}while(10!=(0|Ct));mt=0|i[(yt=st)>>2],St=0|i[yt+4>>2],gt=0|i[(Et=yt=st+8|0)>>2],_t=0|i[Et+4>>2],vt=0|i[(ht=Et=st+16|0)>>2],Tt=0|i[ht+4>>2],bt=0|i[(At=ht=st+24|0)>>2],Pt=0|i[At+4>>2],Ot=0|i[(Mt=At=st+32|0)>>2],It=0|i[Mt+4>>2],Rt=0|i[(wt=Mt=st+40|0)>>2],Dt=0|i[wt+4>>2],Lt=0|i[(Nt=wt=st+48|0)>>2],kt=0|i[Nt+4>>2],Ut=0|i[(Gt=Nt=st+56|0)>>2],Ft=0|i[Gt+4>>2],Bt=0|i[(xt=Gt=st+64|0)>>2],Kt=0|i[xt+4>>2],Yt=0|i[(jt=xt=st+72|0)>>2],Wt=0|i[jt+4>>2],jt=0|G(0|(Ht=0|i[(jt=ct)>>2]),0|(Vt=0|i[jt+4>>2]),0|mt,0|St),i[($t=st)>>2]=jt,i[$t+4>>2]=l,jt=0|G(0|(zt=0|i[(jt=$t=ct+8|0)>>2]),0|(qt=0|i[jt+4>>2]),0|gt,0|_t),i[(Jt=yt)>>2]=jt,i[Jt+4>>2]=l,jt=0|G(0|(yt=0|i[(jt=Jt=ct+16|0)>>2]),0|(Qt=0|i[jt+4>>2]),0|vt,0|Tt),i[(Xt=Et)>>2]=jt,i[Xt+4>>2]=l,jt=0|G(0|(Et=0|i[(jt=Xt=ct+24|0)>>2]),0|(Zt=0|i[jt+4>>2]),0|bt,0|Pt),i[(er=ht)>>2]=jt,i[er+4>>2]=l,jt=0|G(0|(ht=0|i[(jt=er=ct+32|0)>>2]),0|(tr=0|i[jt+4>>2]),0|Ot,0|It),i[(rr=At)>>2]=jt,i[rr+4>>2]=l,jt=0|G(0|(At=0|i[(jt=rr=ct+40|0)>>2]),0|(nr=0|i[jt+4>>2]),0|Rt,0|Dt),i[(ir=Mt)>>2]=jt,i[ir+4>>2]=l,jt=0|G(0|(Mt=0|i[(jt=ir=ct+48|0)>>2]),0|(ar=0|i[jt+4>>2]),0|Lt,0|kt),i[(or=wt)>>2]=jt,i[or+4>>2]=l,jt=0|G(0|(wt=0|i[(jt=or=ct+56|0)>>2]),0|(sr=0|i[jt+4>>2]),0|Ut,0|Ft),i[(lr=Nt)>>2]=jt,i[lr+4>>2]=l,jt=0|G(0|(Nt=0|i[(jt=lr=ct+64|0)>>2]),0|(cr=0|i[jt+4>>2]),0|Bt,0|Kt),i[(dr=Gt)>>2]=jt,i[dr+4>>2]=l,jt=0|G(0|(Gt=0|i[(jt=dr=ct+72|0)>>2]),0|(ur=0|i[jt+4>>2]),0|Yt,0|Wt),i[(pr=xt)>>2]=jt,i[pr+4>>2]=l,pr=0|k(0|mt,0|St,0|Ht,0|Vt),i[(Vt=ct)>>2]=pr,i[Vt+4>>2]=l,Vt=0|k(0|gt,0|_t,0|zt,0|qt),i[(qt=$t)>>2]=Vt,i[qt+4>>2]=l,qt=0|k(0|vt,0|Tt,0|yt,0|Qt),i[(Qt=Jt)>>2]=qt,i[Qt+4>>2]=l,Qt=0|k(0|bt,0|Pt,0|Et,0|Zt),i[(Zt=Xt)>>2]=Qt,i[Zt+4>>2]=l,Zt=0|k(0|Ot,0|It,0|ht,0|tr),i[(tr=er)>>2]=Zt,i[tr+4>>2]=l,tr=0|k(0|Rt,0|Dt,0|At,0|nr),i[(nr=rr)>>2]=tr,i[nr+4>>2]=l,nr=0|k(0|Lt,0|kt,0|Mt,0|ar),i[(ar=ir)>>2]=nr,i[ar+4>>2]=l,ar=0|k(0|Ut,0|Ft,0|wt,0|sr),i[(sr=or)>>2]=ar,i[sr+4>>2]=l,sr=0|k(0|Bt,0|Kt,0|Nt,0|cr),i[(cr=lr)>>2]=sr,i[cr+4>>2]=l,cr=0|k(0|Yt,0|Wt,0|Gt,0|ur),i[(ur=dr)>>2]=cr,i[ur+4>>2]=l,cr=0|i[(ur=nt)>>2],dr=0|i[ur+4>>2],Wt=0|i[(Gt=ur=nt+8|0)>>2],Yt=0|i[Gt+4>>2],lr=0|i[(sr=Gt=nt+16|0)>>2],Nt=0|i[sr+4>>2],Bt=0|i[(Kt=sr=nt+24|0)>>2],ar=0|i[Kt+4>>2],wt=0|i[(or=Kt=nt+32|0)>>2],Ft=0|i[or+4>>2],nr=0|i[(Ut=or=nt+40|0)>>2],ir=0|i[Ut+4>>2],kt=0|i[(Mt=Ut=nt+48|0)>>2],Lt=0|i[Mt+4>>2],rr=0|i[(tr=Mt=nt+56|0)>>2],At=0|i[tr+4>>2],Rt=0|i[(Dt=tr=nt+64|0)>>2],Zt=0|i[Dt+4>>2],ht=0|i[(er=Dt=nt+72|0)>>2],It=0|i[er+4>>2],er=0|G(0|(Ot=0|i[(er=at)>>2]),0|(Qt=0|i[er+4>>2]),0|cr,0|dr),i[(Xt=nt)>>2]=er,i[Xt+4>>2]=l,er=0|G(0|(Et=0|i[(er=Xt=at+8|0)>>2]),0|(Pt=0|i[er+4>>2]),0|Wt,0|Yt),i[(bt=ur)>>2]=er,i[bt+4>>2]=l,er=0|G(0|(ur=0|i[(er=bt=at+16|0)>>2]),0|(qt=0|i[er+4>>2]),0|lr,0|Nt),i[(Jt=Gt)>>2]=er,i[Jt+4>>2]=l,er=0|G(0|(Gt=0|i[(er=Jt=at+24|0)>>2]),0|(yt=0|i[er+4>>2]),0|Bt,0|ar),i[(Tt=sr)>>2]=er,i[Tt+4>>2]=l,er=0|G(0|(sr=0|i[(er=Tt=at+32|0)>>2]),0|(vt=0|i[er+4>>2]),0|wt,0|Ft),i[(Vt=Kt)>>2]=er,i[Vt+4>>2]=l,er=0|G(0|(Kt=0|i[(er=Vt=at+40|0)>>2]),0|($t=0|i[er+4>>2]),0|nr,0|ir),i[(zt=or)>>2]=er,i[zt+4>>2]=l,er=0|G(0|(or=0|i[(er=zt=at+48|0)>>2]),0|(_t=0|i[er+4>>2]),0|kt,0|Lt),i[(gt=Ut)>>2]=er,i[gt+4>>2]=l,er=0|G(0|(Ut=0|i[(er=gt=at+56|0)>>2]),0|(pr=0|i[er+4>>2]),0|rr,0|At),i[(Ht=Mt)>>2]=er,i[Ht+4>>2]=l,er=0|G(0|(Mt=0|i[(er=Ht=at+64|0)>>2]),0|(St=0|i[er+4>>2]),0|Rt,0|Zt),i[(mt=tr)>>2]=er,i[mt+4>>2]=l,er=0|G(0|(tr=0|i[(er=mt=at+72|0)>>2]),0|(jt=0|i[er+4>>2]),0|ht,0|It),i[(xt=Dt)>>2]=er,i[xt+4>>2]=l,xt=0|k(0|cr,0|dr,0|Ot,0|Qt),i[(Qt=at)>>2]=xt,i[Qt+4>>2]=l,Qt=0|k(0|Wt,0|Yt,0|Et,0|Pt),i[(Pt=Xt)>>2]=Qt,i[Pt+4>>2]=l,Pt=0|k(0|lr,0|Nt,0|ur,0|qt),i[(qt=bt)>>2]=Pt,i[qt+4>>2]=l,qt=0|k(0|Bt,0|ar,0|Gt,0|yt),i[(yt=Jt)>>2]=qt,i[yt+4>>2]=l,yt=0|k(0|wt,0|Ft,0|sr,0|vt),i[(vt=Tt)>>2]=yt,i[vt+4>>2]=l,vt=0|k(0|nr,0|ir,0|Kt,0|$t),i[($t=Vt)>>2]=vt,i[$t+4>>2]=l,$t=0|k(0|kt,0|Lt,0|or,0|_t),i[(_t=zt)>>2]=$t,i[_t+4>>2]=l,_t=0|k(0|rr,0|At,0|Ut,0|pr),i[(pr=gt)>>2]=_t,i[pr+4>>2]=l,pr=0|k(0|Rt,0|Zt,0|Mt,0|St),i[(St=Ht)>>2]=pr,i[St+4>>2]=l,St=0|k(0|ht,0|It,0|tr,0|jt),i[(jt=mt)>>2]=St,i[jt+4>>2]=l,P(Me,nt,ct),P(Oe,st,at),St=0|i[(jt=$e)>>2],mt=0|i[jt+4>>2],tr=0|i[(jt=r)>>2],It=0|i[jt+4>>2],jt=0|B(0|St,0|mt,18,0),ht=l,pr=0|G(0|tr,0|It,0|St,0|mt),mt=0|G(0|pr,0|l,0|jt,0|ht),i[(ht=r)>>2]=mt,i[ht+4>>2]=l,mt=0|i[(ht=Je)>>2],jt=0|i[ht+4>>2],pr=0|i[(ht=qe)>>2],St=0|i[ht+4>>2],ht=0|B(0|mt,0|jt,18,0),It=l,tr=0|G(0|pr,0|St,0|mt,0|jt),jt=0|G(0|tr,0|l,0|ht,0|It),i[(It=qe)>>2]=jt,i[It+4>>2]=l,jt=0|i[(It=ze)>>2],ht=0|i[It+4>>2],tr=0|i[(It=Ve)>>2],mt=0|i[It+4>>2],It=0|B(0|jt,0|ht,18,0),St=l,pr=0|G(0|tr,0|mt,0|jt,0|ht),ht=0|G(0|pr,0|l,0|It,0|St),i[(St=Ve)>>2]=ht,i[St+4>>2]=l,ht=0|i[(St=He)>>2],It=0|i[St+4>>2],pr=0|i[(St=We)>>2],jt=0|i[St+4>>2],St=0|B(0|ht,0|It,18,0),mt=l,tr=0|G(0|pr,0|jt,0|ht,0|It),It=0|G(0|tr,0|l,0|St,0|mt),i[(mt=We)>>2]=It,i[mt+4>>2]=l,It=0|i[(mt=p)>>2],St=0|i[mt+4>>2],tr=0|i[(mt=f)>>2],ht=0|i[mt+4>>2],mt=0|B(0|It,0|St,18,0),jt=l,pr=0|G(0|tr,0|ht,0|It,0|St),St=0|G(0|pr,0|l,0|mt,0|jt),i[(jt=f)>>2]=St,i[jt+4>>2]=l,St=0|i[(jt=_)>>2],mt=0|i[jt+4>>2],pr=0|i[(jt=h)>>2],It=0|i[jt+4>>2],jt=0|B(0|St,0|mt,18,0),ht=l,tr=0|G(0|pr,0|It,0|St,0|mt),mt=0|G(0|tr,0|l,0|jt,0|ht),i[(ht=h)>>2]=mt,i[ht+4>>2]=l,mt=0|i[(ht=g)>>2],jt=0|i[ht+4>>2],tr=0|i[(ht=m)>>2],St=0|i[ht+4>>2],ht=0|B(0|mt,0|jt,18,0),It=l,pr=0|G(0|tr,0|St,0|mt,0|jt),jt=0|G(0|pr,0|l,0|ht,0|It),i[(It=m)>>2]=jt,i[It+4>>2]=l,jt=0|i[(It=y)>>2],ht=0|i[It+4>>2],pr=0|i[(It=E)>>2],mt=0|i[It+4>>2],It=0|B(0|jt,0|ht,18,0),St=l,tr=0|G(0|pr,0|mt,0|jt,0|ht),ht=0|G(0|tr,0|l,0|It,0|St),i[(St=E)>>2]=ht,i[St+4>>2]=l,ht=0|i[(St=S)>>2],It=0|i[St+4>>2],tr=0|i[(St=Me)>>2],jt=0|i[St+4>>2],St=0|B(0|ht,0|It,18,0),mt=l,pr=0|G(0|tr,0|jt,0|ht,0|It),It=0|G(0|pr,0|l,0|St,0|mt),mt=l,i[(St=Me)>>2]=It,i[St+4>>2]=mt,i[(St=S)>>2]=0,i[St+4>>2]=0,St=mt,mt=It,It=0;do{tr=0|k(0|mt,0|St,0|(jt=0|x(0|(ht=0|L(0|(pr=0|G(St>>31>>>6|0,0,0|mt,0|St)),0|l,26)),0|(pr=l),26)),0|l),i[(jt=Me+(It<<3)|0)>>2]=tr,i[jt+4>>2]=l,Zt=0|k(0|(Ht=0|G(0|ht,0|pr,0|i[(tr=jt=Me+((1|It)<<3)|0)>>2],0|i[tr+4>>2])),0|(tr=l),0|(Mt=0|x(0|(ht=0|L(0|(pr=0|G(tr>>31>>>7|0,0,0|Ht,0|tr)),0|l,25)),0|(pr=l),25)),0|l),i[(Mt=jt)>>2]=Zt,i[Mt+4>>2]=l,mt=0|G(0|ht,0|pr,0|i[(Zt=Mt=Me+((It=It+2|0)<<3)|0)>>2],0|i[Zt+4>>2]),St=l,i[(Zt=Mt)>>2]=mt,i[Zt+4>>2]=St}while(It>>>0<10);St=0|i[(It=S)>>2],mt=0|i[It+4>>2],Zt=0|i[(It=Me)>>2],Mt=0|i[It+4>>2],It=0|B(0|St,0|mt,18,0),pr=l,ht=0|G(0|Zt,0|Mt,0|St,0|mt),mt=0|G(0|ht,0|l,0|It,0|pr),pr=l,i[(It=S)>>2]=0,i[It+4>>2]=0,Mt=0|k(0|mt,0|pr,0|(St=0|x(0|(ht=0|L(0|(It=0|G(pr>>31>>>6|0,0,0|mt,0|pr)),0|l,26)),0|(It=l),26)),0|l),St=l,i[(pr=Me)>>2]=Mt,i[pr+4>>2]=St,mt=0|G(0|ht,0|It,0|i[(pr=E)>>2],0|i[pr+4>>2]),pr=l,i[(It=E)>>2]=mt,i[It+4>>2]=pr,ht=0|i[(It=v)>>2],Zt=0|i[It+4>>2],jt=0|i[(It=T)>>2],tr=0|i[It+4>>2],It=0|B(0|ht,0|Zt,18,0),Ht=l,Rt=0|G(0|jt,0|tr,0|ht,0|Zt),Zt=0|G(0|Rt,0|l,0|It,0|Ht),i[(Ht=T)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=C)>>2],It=0|i[Ht+4>>2],Rt=0|i[(Ht=A)>>2],ht=0|i[Ht+4>>2],Ht=0|B(0|Zt,0|It,18,0),tr=l,jt=0|G(0|Rt,0|ht,0|Zt,0|It),It=0|G(0|jt,0|l,0|Ht,0|tr),i[(tr=A)>>2]=It,i[tr+4>>2]=l,It=0|i[(tr=O)>>2],Ht=0|i[tr+4>>2],jt=0|i[(tr=I)>>2],Zt=0|i[tr+4>>2],tr=0|B(0|It,0|Ht,18,0),ht=l,Rt=0|G(0|jt,0|Zt,0|It,0|Ht),Ht=0|G(0|Rt,0|l,0|tr,0|ht),i[(ht=I)>>2]=Ht,i[ht+4>>2]=l,Ht=0|i[(ht=w)>>2],tr=0|i[ht+4>>2],Rt=0|i[(ht=R)>>2],It=0|i[ht+4>>2],ht=0|B(0|Ht,0|tr,18,0),Zt=l,jt=0|G(0|Rt,0|It,0|Ht,0|tr),tr=0|G(0|jt,0|l,0|ht,0|Zt),i[(Zt=R)>>2]=tr,i[Zt+4>>2]=l,tr=0|i[(Zt=D)>>2],ht=0|i[Zt+4>>2],jt=0|i[(Zt=N)>>2],Ht=0|i[Zt+4>>2],Zt=0|B(0|tr,0|ht,18,0),It=l,Rt=0|G(0|jt,0|Ht,0|tr,0|ht),ht=0|G(0|Rt,0|l,0|Zt,0|It),i[(It=N)>>2]=ht,i[It+4>>2]=l,ht=0|i[(It=K)>>2],Zt=0|i[It+4>>2],Rt=0|i[(It=j)>>2],tr=0|i[It+4>>2],It=0|B(0|ht,0|Zt,18,0),Ht=l,jt=0|G(0|Rt,0|tr,0|ht,0|Zt),Zt=0|G(0|jt,0|l,0|It,0|Ht),i[(Ht=j)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=Y)>>2],It=0|i[Ht+4>>2],jt=0|i[(Ht=W)>>2],ht=0|i[Ht+4>>2],Ht=0|B(0|Zt,0|It,18,0),tr=l,Rt=0|G(0|jt,0|ht,0|Zt,0|It),It=0|G(0|Rt,0|l,0|Ht,0|tr),i[(tr=W)>>2]=It,i[tr+4>>2]=l,It=0|i[(tr=H)>>2],Ht=0|i[tr+4>>2],Rt=0|i[(tr=V)>>2],Zt=0|i[tr+4>>2],tr=0|B(0|It,0|Ht,18,0),ht=l,jt=0|G(0|Rt,0|Zt,0|It,0|Ht),Ht=0|G(0|jt,0|l,0|tr,0|ht),i[(ht=V)>>2]=Ht,i[ht+4>>2]=l,Ht=0|i[(ht=$)>>2],tr=0|i[ht+4>>2],jt=0|i[(ht=Oe)>>2],It=0|i[ht+4>>2],ht=0|B(0|Ht,0|tr,18,0),Zt=l,Rt=0|G(0|jt,0|It,0|Ht,0|tr),tr=0|G(0|Rt,0|l,0|ht,0|Zt),Zt=l,i[(ht=Oe)>>2]=tr,i[ht+4>>2]=Zt,i[(ht=$)>>2]=0,i[ht+4>>2]=0,ht=Zt,Zt=tr,tr=0;do{jt=0|k(0|Zt,0|ht,0|(It=0|x(0|(Ht=0|L(0|(Rt=0|G(ht>>31>>>6|0,0,0|Zt,0|ht)),0|l,26)),0|(Rt=l),26)),0|l),i[(It=Oe+(tr<<3)|0)>>2]=jt,i[It+4>>2]=l,Ut=0|k(0|(_t=0|G(0|Ht,0|Rt,0|i[(jt=It=Oe+((1|tr)<<3)|0)>>2],0|i[jt+4>>2])),0|(jt=l),0|(gt=0|x(0|(Ht=0|L(0|(Rt=0|G(jt>>31>>>7|0,0,0|_t,0|jt)),0|l,25)),0|(Rt=l),25)),0|l),i[(gt=It)>>2]=Ut,i[gt+4>>2]=l,Zt=0|G(0|Ht,0|Rt,0|i[(Ut=gt=Oe+((tr=tr+2|0)<<3)|0)>>2],0|i[Ut+4>>2]),ht=l,i[(Ut=gt)>>2]=Zt,i[Ut+4>>2]=ht}while(tr>>>0<10);ht=0|i[(tr=$)>>2],Zt=0|i[tr+4>>2],Ut=0|i[(tr=Oe)>>2],gt=0|i[tr+4>>2],tr=0|B(0|ht,0|Zt,18,0),Rt=l,Ht=0|G(0|Ut,0|gt,0|ht,0|Zt),Zt=0|G(0|Ht,0|l,0|tr,0|Rt),Rt=l,i[(tr=$)>>2]=0,i[tr+4>>2]=0,gt=0|k(0|Zt,0|Rt,0|(ht=0|x(0|(Ht=0|L(0|(tr=0|G(Rt>>31>>>6|0,0,0|Zt,0|Rt)),0|l,26)),0|(tr=l),26)),0|l),ht=l,Zt=0|G(0|Ht,0|tr,0|i[(Rt=V)>>2],0|i[Rt+4>>2]),Rt=l,Ht=0|i[(tr=m)>>2],Ut=0|i[tr+4>>2],It=0|i[(tr=h)>>2],jt=0|i[tr+4>>2],_t=0|i[(tr=f)>>2],At=0|i[tr+4>>2],rr=0|i[(tr=We)>>2],$t=0|i[tr+4>>2],zt=0|i[(tr=Ve)>>2],or=0|i[tr+4>>2],Lt=0|i[(tr=qe)>>2],kt=0|i[tr+4>>2],vt=0|i[(tr=r)>>2],Vt=0|i[tr+4>>2],Kt=0|i[(tr=z)>>2],ir=0|i[tr+4>>2],tr=0|G(0|gt,0|ht,0|Mt,0|St),i[(nr=Me)>>2]=tr,i[nr+4>>2]=l,nr=0|G(0|Zt,0|Rt,0|mt,0|pr),i[(tr=E)>>2]=nr,i[tr+4>>2]=l,tr=0|G(0|(nr=0|i[(tr=W)>>2]),0|(yt=0|i[tr+4>>2]),0|Ht,0|Ut),i[(Tt=m)>>2]=tr,i[Tt+4>>2]=l,Tt=0|G(0|(tr=0|i[(Tt=j)>>2]),0|(sr=0|i[Tt+4>>2]),0|It,0|jt),i[(Ft=h)>>2]=Tt,i[Ft+4>>2]=l,Ft=0|G(0|(Tt=0|i[(Ft=N)>>2]),0|(wt=0|i[Ft+4>>2]),0|_t,0|At),i[(qt=f)>>2]=Ft,i[qt+4>>2]=l,qt=0|G(0|(Ft=0|i[(qt=R)>>2]),0|(Jt=0|i[qt+4>>2]),0|rr,0|$t),i[(Gt=We)>>2]=qt,i[Gt+4>>2]=l,Gt=0|G(0|(qt=0|i[(Gt=I)>>2]),0|(ar=0|i[Gt+4>>2]),0|zt,0|or),i[(Bt=Ve)>>2]=Gt,i[Bt+4>>2]=l,Bt=0|G(0|(Gt=0|i[(Bt=A)>>2]),0|(Pt=0|i[Bt+4>>2]),0|Lt,0|kt),i[(bt=qe)>>2]=Bt,i[bt+4>>2]=l,bt=0|G(0|(Bt=0|i[(bt=T)>>2]),0|(ur=0|i[bt+4>>2]),0|vt,0|Vt),i[(Nt=r)>>2]=bt,i[Nt+4>>2]=l,Nt=0|G(0|(bt=0|i[(Nt=q)>>2]),0|(lr=0|i[Nt+4>>2]),0|Kt,0|ir),i[(Qt=z)>>2]=Nt,i[Qt+4>>2]=l,Qt=0|k(0|Mt,0|St,0|gt,0|ht),i[(ht=Oe)>>2]=Qt,i[ht+4>>2]=l,ht=0|k(0|mt,0|pr,0|Zt,0|Rt),i[(Rt=V)>>2]=ht,i[Rt+4>>2]=l,Rt=0|k(0|Ht,0|Ut,0|nr,0|yt),i[(yt=W)>>2]=Rt,i[yt+4>>2]=l,yt=0|k(0|It,0|jt,0|tr,0|sr),i[(sr=j)>>2]=yt,i[sr+4>>2]=l,sr=0|k(0|_t,0|At,0|Tt,0|wt),i[(wt=N)>>2]=sr,i[wt+4>>2]=l,wt=0|k(0|rr,0|$t,0|Ft,0|Jt),i[(Jt=R)>>2]=wt,i[Jt+4>>2]=l,Jt=0|k(0|zt,0|or,0|qt,0|ar),i[(ar=I)>>2]=Jt,i[ar+4>>2]=l,ar=0|k(0|Lt,0|kt,0|Gt,0|Pt),i[(Pt=A)>>2]=ar,i[Pt+4>>2]=l,Pt=0|k(0|vt,0|Vt,0|Bt,0|ur),i[(ur=T)>>2]=Pt,i[ur+4>>2]=l,ur=0|k(0|Kt,0|ir,0|bt,0|lr),i[(lr=q)>>2]=ur,i[lr+4>>2]=l,M(we,Me),M(Ie,Oe),P(Oe,Ie,d),ur=0|i[(lr=v)>>2],bt=0|i[lr+4>>2],ir=0|i[(lr=T)>>2],Kt=0|i[lr+4>>2],lr=0|B(0|ur,0|bt,18,0),Pt=l,Bt=0|G(0|ir,0|Kt,0|ur,0|bt),bt=0|G(0|Bt,0|l,0|lr,0|Pt),i[(Pt=T)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=C)>>2],lr=0|i[Pt+4>>2],Bt=0|i[(Pt=A)>>2],ur=0|i[Pt+4>>2],Pt=0|B(0|bt,0|lr,18,0),Kt=l,ir=0|G(0|Bt,0|ur,0|bt,0|lr),lr=0|G(0|ir,0|l,0|Pt,0|Kt),i[(Kt=A)>>2]=lr,i[Kt+4>>2]=l,lr=0|i[(Kt=O)>>2],Pt=0|i[Kt+4>>2],ir=0|i[(Kt=I)>>2],bt=0|i[Kt+4>>2],Kt=0|B(0|lr,0|Pt,18,0),ur=l,Bt=0|G(0|ir,0|bt,0|lr,0|Pt),Pt=0|G(0|Bt,0|l,0|Kt,0|ur),i[(ur=I)>>2]=Pt,i[ur+4>>2]=l,Pt=0|i[(ur=w)>>2],Kt=0|i[ur+4>>2],Bt=0|i[(ur=R)>>2],lr=0|i[ur+4>>2],ur=0|B(0|Pt,0|Kt,18,0),bt=l,ir=0|G(0|Bt,0|lr,0|Pt,0|Kt),Kt=0|G(0|ir,0|l,0|ur,0|bt),i[(bt=R)>>2]=Kt,i[bt+4>>2]=l,Kt=0|i[(bt=D)>>2],ur=0|i[bt+4>>2],ir=0|i[(bt=N)>>2],Pt=0|i[bt+4>>2],bt=0|B(0|Kt,0|ur,18,0),lr=l,Bt=0|G(0|ir,0|Pt,0|Kt,0|ur),ur=0|G(0|Bt,0|l,0|bt,0|lr),i[(lr=N)>>2]=ur,i[lr+4>>2]=l,ur=0|i[(lr=K)>>2],bt=0|i[lr+4>>2],Bt=0|i[(lr=j)>>2],Kt=0|i[lr+4>>2],lr=0|B(0|ur,0|bt,18,0),Pt=l,ir=0|G(0|Bt,0|Kt,0|ur,0|bt),bt=0|G(0|ir,0|l,0|lr,0|Pt),i[(Pt=j)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=Y)>>2],lr=0|i[Pt+4>>2],ir=0|i[(Pt=W)>>2],ur=0|i[Pt+4>>2],Pt=0|B(0|bt,0|lr,18,0),Kt=l,Bt=0|G(0|ir,0|ur,0|bt,0|lr),lr=0|G(0|Bt,0|l,0|Pt,0|Kt),i[(Kt=W)>>2]=lr,i[Kt+4>>2]=l,lr=0|i[(Kt=H)>>2],Pt=0|i[Kt+4>>2],Bt=0|i[(Kt=V)>>2],bt=0|i[Kt+4>>2],Kt=0|B(0|lr,0|Pt,18,0),ur=l,ir=0|G(0|Bt,0|bt,0|lr,0|Pt),Pt=0|G(0|ir,0|l,0|Kt,0|ur),i[(ur=V)>>2]=Pt,i[ur+4>>2]=l,Pt=0|i[(ur=$)>>2],Kt=0|i[ur+4>>2],ir=0|i[(ur=Oe)>>2],lr=0|i[ur+4>>2],ur=0|B(0|Pt,0|Kt,18,0),bt=l,Bt=0|G(0|ir,0|lr,0|Pt,0|Kt),Kt=0|G(0|Bt,0|l,0|ur,0|bt),bt=l,i[(ur=Oe)>>2]=Kt,i[ur+4>>2]=bt,i[(ur=$)>>2]=0,i[ur+4>>2]=0,ur=bt,bt=Kt,Kt=0;do{ir=0|k(0|bt,0|ur,0|(lr=0|x(0|(Pt=0|L(0|(Bt=0|G(ur>>31>>>6|0,0,0|bt,0|ur)),0|l,26)),0|(Bt=l),26)),0|l),i[(lr=Oe+(Kt<<3)|0)>>2]=ir,i[lr+4>>2]=l,ar=0|k(0|(Vt=0|G(0|Pt,0|Bt,0|i[(ir=lr=Oe+((1|Kt)<<3)|0)>>2],0|i[ir+4>>2])),0|(ir=l),0|(vt=0|x(0|(Pt=0|L(0|(Bt=0|G(ir>>31>>>7|0,0,0|Vt,0|ir)),0|l,25)),0|(Bt=l),25)),0|l),i[(vt=lr)>>2]=ar,i[vt+4>>2]=l,bt=0|G(0|Pt,0|Bt,0|i[(ar=vt=Oe+((Kt=Kt+2|0)<<3)|0)>>2],0|i[ar+4>>2]),ur=l,i[(ar=vt)>>2]=bt,i[ar+4>>2]=ur}while(Kt>>>0<10);ur=0|i[(Kt=$)>>2],bt=0|i[Kt+4>>2],pr=0|i[(Kt=Oe)>>2],mt=0|i[Kt+4>>2],Kt=0|B(0|ur,0|bt,18,0),St=l,Mt=0|G(0|pr,0|mt,0|ur,0|bt),bt=0|G(0|Mt,0|l,0|Kt,0|St),St=l,i[(Kt=$)>>2]=0,i[Kt+4>>2]=0,mt=0|k(0|bt,0|St,0|(ur=0|x(0|(Mt=0|L(0|(Kt=0|G(St>>31>>>6|0,0,0|bt,0|St)),0|l,26)),0|(Kt=l),26)),0|l),i[(ur=Oe)>>2]=mt,i[ur+4>>2]=l,mt=0|G(0|Mt,0|Kt,0|i[(ur=V)>>2],0|i[ur+4>>2]),i[(ur=V)>>2]=mt,i[ur+4>>2]=l,Ye=we,t=(je=it)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));Ye=Oe,t=(je=ot)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));M(be,st),M(Pe,ct),P(lt,be,Pe),mt=0|i[(ur=lt+144|0)>>2],Kt=0|i[ur+4>>2],St=0|i[(Mt=ur=lt+64|0)>>2],bt=0|i[Mt+4>>2],Mt=0|B(0|mt,0|Kt,18,0),pr=l,ar=0|G(0|St,0|bt,0|mt,0|Kt),Kt=0|G(0|ar,0|l,0|Mt,0|pr),i[(pr=ur)>>2]=Kt,i[pr+4>>2]=l,Kt=0|i[(pr=lt+136|0)>>2],ur=0|i[pr+4>>2],ar=0|i[(Mt=pr=lt+56|0)>>2],mt=0|i[Mt+4>>2],Mt=0|B(0|Kt,0|ur,18,0),bt=l,St=0|G(0|ar,0|mt,0|Kt,0|ur),ur=0|G(0|St,0|l,0|Mt,0|bt),i[(bt=pr)>>2]=ur,i[bt+4>>2]=l,ur=0|i[(bt=lt+128|0)>>2],pr=0|i[bt+4>>2],St=0|i[(Mt=bt=lt+48|0)>>2],Kt=0|i[Mt+4>>2],Mt=0|B(0|ur,0|pr,18,0),mt=l,ar=0|G(0|St,0|Kt,0|ur,0|pr),pr=0|G(0|ar,0|l,0|Mt,0|mt),i[(mt=bt)>>2]=pr,i[mt+4>>2]=l,pr=0|i[(mt=lt+120|0)>>2],bt=0|i[mt+4>>2],ar=0|i[(Mt=mt=lt+40|0)>>2],ur=0|i[Mt+4>>2],Mt=0|B(0|pr,0|bt,18,0),Kt=l,St=0|G(0|ar,0|ur,0|pr,0|bt),bt=0|G(0|St,0|l,0|Mt,0|Kt),i[(Kt=mt)>>2]=bt,i[Kt+4>>2]=l,bt=0|i[(Kt=lt+112|0)>>2],mt=0|i[Kt+4>>2],St=0|i[(Mt=Kt=lt+32|0)>>2],pr=0|i[Mt+4>>2],Mt=0|B(0|bt,0|mt,18,0),ur=l,ar=0|G(0|St,0|pr,0|bt,0|mt),mt=0|G(0|ar,0|l,0|Mt,0|ur),i[(ur=Kt)>>2]=mt,i[ur+4>>2]=l,mt=0|i[(ur=lt+104|0)>>2],Kt=0|i[ur+4>>2],ar=0|i[(Mt=ur=lt+24|0)>>2],bt=0|i[Mt+4>>2],Mt=0|B(0|mt,0|Kt,18,0),pr=l,St=0|G(0|ar,0|bt,0|mt,0|Kt),Kt=0|G(0|St,0|l,0|Mt,0|pr),i[(pr=ur)>>2]=Kt,i[pr+4>>2]=l,Kt=0|i[(pr=lt+96|0)>>2],ur=0|i[pr+4>>2],St=0|i[(Mt=pr=lt+16|0)>>2],mt=0|i[Mt+4>>2],Mt=0|B(0|Kt,0|ur,18,0),bt=l,ar=0|G(0|St,0|mt,0|Kt,0|ur),ur=0|G(0|ar,0|l,0|Mt,0|bt),i[(bt=pr)>>2]=ur,i[bt+4>>2]=l,ur=0|i[(bt=lt+88|0)>>2],pr=0|i[bt+4>>2],ar=0|i[(Mt=bt=lt+8|0)>>2],Kt=0|i[Mt+4>>2],Mt=0|B(0|ur,0|pr,18,0),mt=l,St=0|G(0|ar,0|Kt,0|ur,0|pr),pr=0|G(0|St,0|l,0|Mt,0|mt),i[(mt=bt)>>2]=pr,i[mt+4>>2]=l,Mt=0|i[(pr=mt=lt+80|0)>>2],St=0|i[pr+4>>2],ur=0|i[(pr=lt)>>2],Kt=0|i[pr+4>>2],pr=0|B(0|Mt,0|St,18,0),ar=l,vt=0|G(0|ur,0|Kt,0|Mt,0|St),St=0|G(0|vt,0|l,0|pr,0|ar),ar=l,i[(pr=lt)>>2]=St,i[pr+4>>2]=ar,i[(pr=mt)>>2]=0,i[pr+4>>2]=0,pr=ar,ar=St,St=0;do{ur=0|k(0|ar,0|pr,0|(Kt=0|x(0|(Mt=0|L(0|(vt=0|G(pr>>31>>>6|0,0,0|ar,0|pr)),0|l,26)),0|(vt=l),26)),0|l),i[(Kt=lt+(St<<3)|0)>>2]=ur,i[Kt+4>>2]=l,lr=0|k(0|(Bt=0|G(0|Mt,0|vt,0|i[(ur=Kt=lt+((1|St)<<3)|0)>>2],0|i[ur+4>>2])),0|(ur=l),0|(Pt=0|x(0|(Mt=0|L(0|(vt=0|G(ur>>31>>>7|0,0,0|Bt,0|ur)),0|l,25)),0|(vt=l),25)),0|l),i[(Pt=Kt)>>2]=lr,i[Pt+4>>2]=l,ar=0|G(0|Mt,0|vt,0|i[(lr=Pt=lt+((St=St+2|0)<<3)|0)>>2],0|i[lr+4>>2]),pr=l,i[(lr=Pt)>>2]=ar,i[lr+4>>2]=pr}while(St>>>0<10);pr=0|i[(St=mt)>>2],ar=0|i[St+4>>2],lr=0|i[(St=lt)>>2],Pt=0|i[St+4>>2],St=0|B(0|pr,0|ar,18,0),vt=l,Mt=0|G(0|lr,0|Pt,0|pr,0|ar),ar=0|G(0|Mt,0|l,0|St,0|vt),vt=l,i[(St=mt)>>2]=0,i[St+4>>2]=0,Pt=0|k(0|ar,0|vt,0|(pr=0|x(0|(Mt=0|L(0|(St=0|G(vt>>31>>>6|0,0,0|ar,0|vt)),0|l,26)),0|(St=l),26)),0|l),i[(pr=lt)>>2]=Pt,i[pr+4>>2]=l,Pt=0|G(0|Mt,0|St,0|i[(pr=bt)>>2],0|i[pr+4>>2]),i[(pr=bt)>>2]=Pt,i[pr+4>>2]=l,Mt=0|k(0|(Pt=0|i[(pr=be)>>2]),0|(St=0|i[pr+4>>2]),0|i[(pr=Pe)>>2],0|i[pr+4>>2]),pr=l,i[(vt=Pe)>>2]=Mt,i[vt+4>>2]=pr,Kt=0|k(0|(ar=0|i[(vt=J)>>2]),0|(lr=0|i[vt+4>>2]),0|i[(vt=Q)>>2],0|i[vt+4>>2]),vt=l,i[(ur=Q)>>2]=Kt,i[ur+4>>2]=vt,Vt=0|k(0|(Bt=0|i[(ur=X)>>2]),0|(ir=0|i[ur+4>>2]),0|i[(ur=Z)>>2],0|i[ur+4>>2]),ur=l,i[(Gt=Z)>>2]=Vt,i[Gt+4>>2]=ur,Jt=0|k(0|(kt=0|i[(Gt=ee)>>2]),0|(Lt=0|i[Gt+4>>2]),0|i[(Gt=te)>>2],0|i[Gt+4>>2]),Gt=l,i[(qt=te)>>2]=Jt,i[qt+4>>2]=Gt,wt=0|k(0|(or=0|i[(qt=re)>>2]),0|(zt=0|i[qt+4>>2]),0|i[(qt=ne)>>2],0|i[qt+4>>2]),qt=l,i[(Ft=ne)>>2]=wt,i[Ft+4>>2]=qt,sr=0|k(0|($t=0|i[(Ft=ie)>>2]),0|(rr=0|i[Ft+4>>2]),0|i[(Ft=ae)>>2],0|i[Ft+4>>2]),Ft=l,i[(Tt=ae)>>2]=sr,i[Tt+4>>2]=Ft,yt=0|k(0|(At=0|i[(Tt=oe)>>2]),0|(_t=0|i[Tt+4>>2]),0|i[(Tt=se)>>2],0|i[Tt+4>>2]),Tt=l,i[(tr=se)>>2]=yt,i[tr+4>>2]=Tt,Rt=0|k(0|(jt=0|i[(tr=le)>>2]),0|(It=0|i[tr+4>>2]),0|i[(tr=ce)>>2],0|i[tr+4>>2]),tr=l,i[(nr=ce)>>2]=Rt,i[nr+4>>2]=tr,ht=0|k(0|(Ut=0|i[(nr=de)>>2]),0|(Ht=0|i[nr+4>>2]),0|i[(nr=ue)>>2],0|i[nr+4>>2]),nr=l,i[(Zt=ue)>>2]=ht,i[Zt+4>>2]=nr,Nt=0|k(0|(Qt=0|i[(Zt=pe)>>2]),0|(gt=0|i[Zt+4>>2]),0|i[(Zt=fe)>>2],0|i[Zt+4>>2]),Zt=l,i[(Xt=fe)>>2]=Nt,i[Xt+4>>2]=Zt,t=(je=_e)+72|0;do{i[je>>2]=0,je=je+4|0}while((0|je)<(0|t));bt=0|B(0|Mt,0|pr,121665,0),mt=l,i[(Xt=Ae)>>2]=bt,i[Xt+4>>2]=mt,Xt=0|B(0|Kt,0|vt,121665,0),i[(Et=he)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|Vt,0|ur,121665,0),i[(Xt=ge)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Jt,0|Gt,121665,0),i[(Et=me)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|wt,0|qt,121665,0),i[(Xt=ye)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|sr,0|Ft,121665,0),i[(Et=Ee)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|yt,0|Tt,121665,0),i[(Xt=Se)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Rt,0|tr,121665,0),i[(Et=ve)>>2]=Xt,i[Et+4>>2]=l,Et=0|B(0|ht,0|nr,121665,0),i[(Xt=Te)>>2]=Et,i[Xt+4>>2]=l,Xt=0|B(0|Nt,0|Zt,121665,0),i[(Et=Ce)>>2]=Xt,i[Et+4>>2]=l,i[(Et=_e)>>2]=0,i[Et+4>>2]=0,Et=mt,mt=bt,bt=0;do{xt=0|k(0|mt,0|Et,0|(Wt=0|x(0|(Yt=0|L(0|(Xt=0|G(Et>>31>>>6|0,0,0|mt,0|Et)),0|l,26)),0|(Xt=l),26)),0|l),i[(Wt=Ae+(bt<<3)|0)>>2]=xt,i[Wt+4>>2]=l,cr=0|k(0|(Ot=0|G(0|Yt,0|Xt,0|i[(xt=Wt=Ae+((1|bt)<<3)|0)>>2],0|i[xt+4>>2])),0|(xt=l),0|(dr=0|x(0|(Yt=0|L(0|(Xt=0|G(xt>>31>>>7|0,0,0|Ot,0|xt)),0|l,25)),0|(Xt=l),25)),0|l),i[(dr=Wt)>>2]=cr,i[dr+4>>2]=l,mt=0|G(0|Yt,0|Xt,0|i[(cr=dr=Ae+((bt=bt+2|0)<<3)|0)>>2],0|i[cr+4>>2]),Et=l,i[(cr=dr)>>2]=mt,i[cr+4>>2]=Et}while(bt>>>0<10);Et=0|i[(bt=_e)>>2],mt=0|i[bt+4>>2],Zt=0|i[(bt=Ae)>>2],Nt=0|i[bt+4>>2],bt=0|B(0|Et,0|mt,18,0),nr=l,ht=0|G(0|Zt,0|Nt,0|Et,0|mt),mt=0|G(0|ht,0|l,0|bt,0|nr),nr=l,i[(bt=_e)>>2]=0,i[bt+4>>2]=0,Et=0|x(0|(ht=0|L(0|(bt=0|G(nr>>31>>>6|0,0,0|mt,0|nr)),0|l,26)),0|(bt=l),26),Nt=l,tr=0|i[(Zt=he)>>2],Rt=0|i[Zt+4>>2],nr=0|k(0|(Zt=0|G(0|mt,0|nr,0|Pt,0|St)),0|l,0|Et,0|Nt),i[(Nt=Ae)>>2]=nr,i[Nt+4>>2]=l,Nt=0|G(0|tr,0|Rt,0|ar,0|lr),Rt=0|G(0|Nt,0|l,0|ht,0|bt),i[(bt=he)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ge)>>2],0|i[bt+4>>2],0|Bt,0|ir),i[(bt=ge)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=me)>>2],0|i[bt+4>>2],0|kt,0|Lt),i[(bt=me)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ye)>>2],0|i[bt+4>>2],0|or,0|zt),i[(bt=ye)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Ee)>>2],0|i[bt+4>>2],0|$t,0|rr),i[(bt=Ee)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Se)>>2],0|i[bt+4>>2],0|At,0|_t),i[(bt=Se)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=ve)>>2],0|i[bt+4>>2],0|jt,0|It),i[(bt=ve)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Te)>>2],0|i[bt+4>>2],0|Ut,0|Ht),i[(bt=Te)>>2]=Rt,i[bt+4>>2]=l,Rt=0|G(0|i[(bt=Ce)>>2],0|i[bt+4>>2],0|Qt,0|gt),i[(bt=Ce)>>2]=Rt,i[bt+4>>2]=l,P(dt,Pe,Ae),Rt=0|i[(bt=dt+144|0)>>2],ht=0|i[bt+4>>2],tr=0|i[(Nt=bt=dt+64|0)>>2],nr=0|i[Nt+4>>2],Nt=0|B(0|Rt,0|ht,18,0),Et=l,Zt=0|G(0|tr,0|nr,0|Rt,0|ht),ht=0|G(0|Zt,0|l,0|Nt,0|Et),i[(Et=bt)>>2]=ht,i[Et+4>>2]=l,ht=0|i[(Et=dt+136|0)>>2],bt=0|i[Et+4>>2],Zt=0|i[(Nt=Et=dt+56|0)>>2],Rt=0|i[Nt+4>>2],Nt=0|B(0|ht,0|bt,18,0),nr=l,tr=0|G(0|Zt,0|Rt,0|ht,0|bt),bt=0|G(0|tr,0|l,0|Nt,0|nr),i[(nr=Et)>>2]=bt,i[nr+4>>2]=l,bt=0|i[(nr=dt+128|0)>>2],Et=0|i[nr+4>>2],tr=0|i[(Nt=nr=dt+48|0)>>2],ht=0|i[Nt+4>>2],Nt=0|B(0|bt,0|Et,18,0),Rt=l,Zt=0|G(0|tr,0|ht,0|bt,0|Et),Et=0|G(0|Zt,0|l,0|Nt,0|Rt),i[(Rt=nr)>>2]=Et,i[Rt+4>>2]=l,Et=0|i[(Rt=dt+120|0)>>2],nr=0|i[Rt+4>>2],Zt=0|i[(Nt=Rt=dt+40|0)>>2],bt=0|i[Nt+4>>2],Nt=0|B(0|Et,0|nr,18,0),ht=l,tr=0|G(0|Zt,0|bt,0|Et,0|nr),nr=0|G(0|tr,0|l,0|Nt,0|ht),i[(ht=Rt)>>2]=nr,i[ht+4>>2]=l,nr=0|i[(ht=dt+112|0)>>2],Rt=0|i[ht+4>>2],tr=0|i[(Nt=ht=dt+32|0)>>2],Et=0|i[Nt+4>>2],Nt=0|B(0|nr,0|Rt,18,0),bt=l,Zt=0|G(0|tr,0|Et,0|nr,0|Rt),Rt=0|G(0|Zt,0|l,0|Nt,0|bt),i[(bt=ht)>>2]=Rt,i[bt+4>>2]=l,Rt=0|i[(bt=dt+104|0)>>2],ht=0|i[bt+4>>2],Zt=0|i[(Nt=bt=dt+24|0)>>2],nr=0|i[Nt+4>>2],Nt=0|B(0|Rt,0|ht,18,0),Et=l,tr=0|G(0|Zt,0|nr,0|Rt,0|ht),ht=0|G(0|tr,0|l,0|Nt,0|Et),i[(Et=bt)>>2]=ht,i[Et+4>>2]=l,ht=0|i[(Et=dt+96|0)>>2],bt=0|i[Et+4>>2],tr=0|i[(Nt=Et=dt+16|0)>>2],Rt=0|i[Nt+4>>2],Nt=0|B(0|ht,0|bt,18,0),nr=l,Zt=0|G(0|tr,0|Rt,0|ht,0|bt),bt=0|G(0|Zt,0|l,0|Nt,0|nr),i[(nr=Et)>>2]=bt,i[nr+4>>2]=l,bt=0|i[(nr=dt+88|0)>>2],Et=0|i[nr+4>>2],Zt=0|i[(Nt=nr=dt+8|0)>>2],ht=0|i[Nt+4>>2],Nt=0|B(0|bt,0|Et,18,0),Rt=l,tr=0|G(0|Zt,0|ht,0|bt,0|Et),Et=0|G(0|tr,0|l,0|Nt,0|Rt),i[(Rt=nr)>>2]=Et,i[Rt+4>>2]=l,Nt=0|i[(Et=Rt=dt+80|0)>>2],tr=0|i[Et+4>>2],bt=0|i[(Et=dt)>>2],ht=0|i[Et+4>>2],Et=0|B(0|Nt,0|tr,18,0),Zt=l,mt=0|G(0|bt,0|ht,0|Nt,0|tr),tr=0|G(0|mt,0|l,0|Et,0|Zt),Zt=l,i[(Et=dt)>>2]=tr,i[Et+4>>2]=Zt,i[(Et=Rt)>>2]=0,i[Et+4>>2]=0,Et=Zt,Zt=tr,tr=0;do{bt=0|k(0|Zt,0|Et,0|(ht=0|x(0|(Nt=0|L(0|(mt=0|G(Et>>31>>>6|0,0,0|Zt,0|Et)),0|l,26)),0|(mt=l),26)),0|l),i[(ht=dt+(tr<<3)|0)>>2]=bt,i[ht+4>>2]=l,Ft=0|k(0|(Tt=0|G(0|Nt,0|mt,0|i[(bt=ht=dt+((1|tr)<<3)|0)>>2],0|i[bt+4>>2])),0|(bt=l),0|(yt=0|x(0|(Nt=0|L(0|(mt=0|G(bt>>31>>>7|0,0,0|Tt,0|bt)),0|l,25)),0|(mt=l),25)),0|l),i[(yt=ht)>>2]=Ft,i[yt+4>>2]=l,Zt=0|G(0|Nt,0|mt,0|i[(Ft=yt=dt+((tr=tr+2|0)<<3)|0)>>2],0|i[Ft+4>>2]),Et=l,i[(Ft=yt)>>2]=Zt,i[Ft+4>>2]=Et}while(tr>>>0<10);Et=0|i[(tr=Rt)>>2],Zt=0|i[tr+4>>2],gt=0|i[(tr=dt)>>2],Qt=0|i[tr+4>>2],tr=0|B(0|Et,0|Zt,18,0),Ht=l,Ut=0|G(0|gt,0|Qt,0|Et,0|Zt),Zt=0|G(0|Ut,0|l,0|tr,0|Ht),Ht=l,i[(tr=Rt)>>2]=0,i[tr+4>>2]=0,Qt=0|k(0|Zt,0|Ht,0|(Et=0|x(0|(Ut=0|L(0|(tr=0|G(Ht>>31>>>6|0,0,0|Zt,0|Ht)),0|l,26)),0|(tr=l),26)),0|l),i[(Et=dt)>>2]=Qt,i[Et+4>>2]=l,Qt=0|G(0|Ut,0|tr,0|i[(Et=nr)>>2],0|i[Et+4>>2]),i[(Et=nr)>>2]=Qt,i[Et+4>>2]=l,Et=0;do{Ut=0|i[(tr=Qt=lt+(Et<<3)|0)>>2],Ht=0|i[tr+4>>2],gt=0|i[(Zt=tr=it+(Et<<3)|0)>>2],jt=((It=0|i[Zt+4>>2])^Ht)&ft,Ht=0|L(0,(Zt=(gt^Ut)&pt)^Ut|0,32),i[(Ut=Qt)>>2]=Ht,i[Ut+4>>2]=l,Ut=0|L(0,Zt^gt|0,32),i[(gt=tr)>>2]=Ut,i[gt+4>>2]=l,Et=Et+1|0}while(10!=(0|Et));fr=0;do{Rt=0|i[(nr=Et=dt+(fr<<3)|0)>>2],gt=0|i[nr+4>>2],tr=0|i[(Ut=nr=ot+(fr<<3)|0)>>2],Ht=((Zt=0|i[Ut+4>>2])^gt)&ft,gt=0|L(0,(Ut=(tr^Rt)&pt)^Rt|0,32),i[(Rt=Et)>>2]=gt,i[Rt+4>>2]=l,Rt=0|L(0,Ut^tr|0,32),i[(tr=nr)>>2]=Rt,i[tr+4>>2]=l,fr=fr+1|0}while(10!=(0|fr));if(8==(0|(rt=rt+1|0))){_r=nt,hr=it,gr=at,mr=ot,yr=st,Er=lt,Sr=ct,vr=dt;break}ft=dt,pt=lt,tr=ot,Rt=it,Fe=ut<<1&255,dt=ct,ct=ft,lt=st,st=pt,ot=at,at=tr,it=nt,nt=Rt}if(32==(0|(nt=Qe+1|0))){Tr=Er,Cr=vr;break}Qe=nt,Xe=hr,Ze=_r,ke=mr,et=gr,Ge=Er,tt=yr,Ue=vr,Le=Sr}Ye=Tr,t=(je=xe)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));Ye=Cr,t=(je=Be)+80|0;do{i[je>>2]=i[Ye>>2],je=je+4|0,Ye=Ye+4|0}while((0|je)<(0|t));M(Ae,Be),M(Ne,Ae),M(De,Ne),b(be,De,Be),b(Pe,be,Ae),M(De,Pe),b(Me,De,be),M(De,Me),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),b(Oe,De,Me),M(De,Oe),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(Ie,Ne,Oe),M(De,Ie),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(De,Ne,Ie),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),b(we,De,Oe),M(De,we),M(Ne,De),Oe=2;do{M(De,Ne),M(Ne,De),Oe=Oe+2|0}while((0|Oe)<50);b(Re,Ne,we),M(Ne,Re),M(De,Ne),Oe=2;do{M(Ne,De),M(De,Ne),Oe=Oe+2|0}while((0|Oe)<100);b(Ne,De,Re),M(De,Ne),M(Ne,De),Re=2;do{M(De,Ne),M(Ne,De),Re=Re+2|0}while((0|Re)<50);for(b(De,Ne,we),M(Ne,De),M(De,Ne),M(Ne,De),M(De,Ne),M(Ne,De),b(Ke,Ne,Pe),b(Be,xe,Ke),Ke=0|i[Be>>2],i[Ae>>2]=Ke,i[(xe=Ae+4|0)>>2]=i[Be+8>>2],i[(Pe=Ae+8|0)>>2]=i[Be+16>>2],i[(Ne=Ae+12|0)>>2]=i[Be+24>>2],i[(De=Ae+16|0)>>2]=i[Be+32>>2],i[(we=Ae+20|0)>>2]=i[Be+40>>2],i[(Re=Ae+24|0)>>2]=i[Be+48>>2],i[(Oe=Ae+28|0)>>2]=i[Be+56>>2],i[(Ie=Ae+32|0)>>2]=i[Be+64>>2],i[(Me=Ae+36|0)>>2]=i[Be+72>>2],Be=Ke,Ke=0;be=Ae+(Ke<<2)|0,Ye=Be>>31&Be,1&Ke?(t=Ye>>25,i[be>>2]=(0|c(t,-33554432))+Be,Tr=(0|i[(Ye=Ae+((be=Ke+1|0)<<2)|0)>>2])+t|0,i[Ye>>2]=Tr,Ar=Tr,br=be):(je=Ye>>26,i[be>>2]=(0|c(je,-67108864))+Be,Tr=(0|i[(Cr=Ae+((t=Ke+1|0)<<2)|0)>>2])+je|0,i[Cr>>2]=Tr,Ar=Tr,br=t),9!=(0|br);)Be=Ar,Ke=br;for(Ke=((br=0|i[Me>>2])>>31&br)>>25,i[Me>>2]=(0|c(Ke,-33554432))+br,br=(19*Ke|0)+(0|i[Ae>>2])|0,i[Ae>>2]=br,Ke=br,br=0;Ar=Ae+(br<<2)|0,Be=Ke>>31&Ke,1&br?(t=Be>>25,i[Ar>>2]=(0|c(t,-33554432))+Ke,Tr=(0|i[(Be=Ae+((Ar=br+1|0)<<2)|0)>>2])+t|0,i[Be>>2]=Tr,Pr=Ar,Mr=Tr):(be=Be>>26,i[Ar>>2]=(0|c(be,-67108864))+Ke,t=(0|i[(Ye=Ae+((Tr=br+1|0)<<2)|0)>>2])+be|0,i[Ye>>2]=t,Pr=Tr,Mr=t),9!=(0|Pr);)Ke=Mr,br=Pr;for(br=((Pr=0|i[Me>>2])>>31&Pr)>>25,i[Me>>2]=(0|c(br,-33554432))+Pr,Pr=(19*br|0)+(0|i[Ae>>2])|0,Mr=(0|c(br=(Pr>>31&Pr)>>26,-67108864))+Pr|0,i[Ae>>2]=Mr,i[xe>>2]=br+(0|i[xe>>2]),br=Mr,Mr=0;Pr=Ae+(Mr<<2)|0,1&Mr?(i[Pr>>2]=33554431&br,Ke=(0|i[(Ar=Ae+((Pr=Mr+1|0)<<2)|0)>>2])+(br>>25)|0,i[Ar>>2]=Ke,Or=Pr,Ir=Ke):(i[Pr>>2]=67108863&br,Ar=(0|i[(Tr=Ae+((Ke=Mr+1|0)<<2)|0)>>2])+(br>>26)|0,i[Tr>>2]=Ar,Or=Ke,Ir=Ar),9!=(0|Or);)br=Ir,Mr=Or;for(Or=0|i[Me>>2],i[Me>>2]=33554431&Or,Mr=(19*(Or>>25)|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Mr,Or=Mr,Mr=0;Ir=Ae+(Mr<<2)|0,1&Mr?(i[Ir>>2]=33554431&Or,br=(0|i[(Pr=Ae+((Ir=Mr+1|0)<<2)|0)>>2])+(Or>>25)|0,i[Pr>>2]=br,wr=Ir,Rr=br):(i[Ir>>2]=67108863&Or,Pr=(0|i[(Ke=Ae+((br=Mr+1|0)<<2)|0)>>2])+(Or>>26)|0,i[Ke>>2]=Pr,wr=br,Rr=Pr),9!=(0|wr);)Or=Rr,Mr=wr;for(Mr=33554431&(wr=0|i[Me>>2]),i[Me>>2]=Mr,Rr=(19*(wr>>25)|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Rr,wr=1,Or=~(Rr+-67108845>>31);;){if(br=0|i[Ae+(wr<<2)>>2],Dr=1&wr?(br=(Pr=(br=(Pr=br<<16&(-33554432^br))<<8&Pr)<<4&br)<<2&Pr)<<1&br:(Pr=(Ir=(Pr=(Ir=br<<16&(-67108864^br))<<8&Ir)<<4&Pr)<<2&Ir)<<1&Pr,br=Dr>>31&Or,10==(0|(wr=wr+1|0))){Nr=br;break}Or=br}return Or=Rr-(67108845&Nr)|0,i[Ae>>2]=Or,Ae=67108863&Nr,Rr=33554431&Nr,Dr=(wr=(0|i[xe>>2])-Rr|0)<<2,Pr=(br=(0|i[Pe>>2])-Ae|0)<<3,Ke=(Ir=(0|i[Ne>>2])-Rr|0)<<5,Nr=(Ar=(0|i[De>>2])-Nr|0)<<6,Tr=(0|i[we>>2])-Rr|0,i[we>>2]=Tr,Be=(we=(0|i[Re>>2])-Ae|0)<<1,Ye=(t=(0|i[Oe>>2])-Rr|0)<<3,be=(0|i[Ie>>2])-Ae<<4,i[xe>>2]=Dr,i[Pe>>2]=Pr,i[Ne>>2]=Ke,i[De>>2]=Nr,i[Re>>2]=Be,i[Oe>>2]=Ye,i[Ie>>2]=be,i[Me>>2]=Mr-Rr<<6,n[e>>0]=Or,n[e+1>>0]=Or>>>8,n[e+2>>0]=Or>>>16,n[e+3>>0]=Dr|Or>>>24,n[e+4>>0]=wr>>>6,n[e+5>>0]=wr>>>14,n[e+6>>0]=Pr|wr>>>22,n[e+7>>0]=br>>>5,n[e+8>>0]=br>>>13,n[e+9>>0]=Ke|br>>>21,n[e+10>>0]=Ir>>>3,n[e+11>>0]=Ir>>>11,n[e+12>>0]=Nr|Ir>>>19,n[e+13>>0]=Ar>>>2,n[e+14>>0]=Ar>>>10,n[e+15>>0]=Ar>>>18,n[e+16>>0]=Tr,n[e+17>>0]=Tr>>>8,n[e+18>>0]=Tr>>>16,n[e+19>>0]=Tr>>>24|Be,n[e+20>>0]=we>>>7,n[e+21>>0]=we>>>15,n[e+22>>0]=we>>>23|Ye,n[e+23>>0]=t>>>5,n[e+24>>0]=t>>>13,Ye=0|i[Ie>>2],n[e+25>>0]=t>>>21|Ye,n[e+26>>0]=Ye>>>8,n[e+27>>0]=Ye>>>16,t=0|i[Me>>2],n[e+28>>0]=Ye>>>24|t,n[e+29>>0]=t>>>8,n[e+30>>0]=t>>>16,n[e+31>>0]=t>>>24,o=s,0},_free:function(e){var t,r,n=0,a=0,o=0,s=0,l=0,c=0,d=0,u=0,p=0,f=0,_=0,g=0,m=0,y=0,E=0,S=0,v=0,T=0,C=0,A=0,b=0,P=0,M=0,O=0,I=0,w=0,R=0,D=0,N=0,L=0,k=0,G=0,U=0,F=0;if(e|=0){(n=e+-8|0)>>>0<(a=0|i[47])>>>0&&h(),1==(0|(e=3&(t=0|i[e+-4>>2])))&&h(),r=n+(o=-8&t)|0;do{if(1&t)p=n,f=o;else{if(s=0|i[n>>2],!e)return;if(c=s+o|0,(l=n+(0-s)|0)>>>0<a>>>0&&h(),(0|l)==(0|i[48])){if(3!=(3&(u=0|i[(d=r+4|0)>>2])|0)){p=l,f=c;break}return i[45]=c,i[d>>2]=-2&u,i[l+4>>2]=1|c,void(i[l+c>>2]=c)}if(u=s>>>3,s>>>0<256){if(s=0|i[l+8>>2],d=0|i[l+12>>2],(0|s)!=(0|(_=212+(u<<1<<2)|0))&&(s>>>0<a>>>0&&h(),(0|i[s+12>>2])!=(0|l)&&h()),(0|d)==(0|s)){i[43]=i[43]&~(1<<u),p=l,f=c;break}(0|d)!=(0|_)?(d>>>0<a>>>0&&h(),(0|i[(_=d+8|0)>>2])==(0|l)?g=_:h()):g=d+8|0,i[s+12>>2]=d,i[g>>2]=s,p=l,f=c;break}s=0|i[l+24>>2],d=0|i[l+12>>2];do{if((0|d)==(0|l)){if(m=0|i[(u=(_=l+16|0)+4|0)>>2])S=m,v=u;else{if(!(y=0|i[_>>2])){E=0;break}S=y,v=_}for(;;)if(m=0|i[(u=S+20|0)>>2])S=m,v=u;else{if(!(m=0|i[(u=S+16|0)>>2])){T=S,C=v;break}S=m,v=u}if(!(C>>>0<a>>>0)){i[C>>2]=0,E=T;break}h()}else{if((u=0|i[l+8>>2])>>>0<a>>>0&&h(),(0|i[(m=u+12|0)>>2])!=(0|l)&&h(),(0|i[(_=d+8|0)>>2])==(0|l)){i[m>>2]=d,i[_>>2]=u,E=d;break}h()}}while(0);if(s){if(d=0|i[l+28>>2],(0|l)==(0|i[(u=476+(d<<2)|0)>>2])){if(i[u>>2]=E,!E){i[44]=i[44]&~(1<<d),p=l,f=c;break}}else if(s>>>0<(0|i[47])>>>0&&h(),(0|i[(d=s+16|0)>>2])==(0|l)?i[d>>2]=E:i[s+20>>2]=E,!E){p=l,f=c;break}E>>>0<(d=0|i[47])>>>0&&h(),i[E+24>>2]=s,_=0|i[(u=l+16|0)>>2];do{if(_){if(!(_>>>0<d>>>0)){i[E+16>>2]=_,i[_+24>>2]=E;break}h()}}while(0);if(_=0|i[u+4>>2]){if(!(_>>>0<(0|i[47])>>>0)){i[E+20>>2]=_,i[_+24>>2]=E,p=l,f=c;break}h()}else p=l,f=c}else p=l,f=c}}while(0);if(p>>>0>=r>>>0&&h(),1&(n=0|i[(o=r+4|0)>>2])||h(),2&n)i[o>>2]=-2&n,i[p+4>>2]=1|f,i[p+f>>2]=f,w=f;else{if((0|r)==(0|i[49])){if(E=(0|i[46])+f|0,i[46]=E,i[49]=p,i[p+4>>2]=1|E,(0|p)!=(0|i[48]))return;return i[48]=0,void(i[45]=0)}if((0|r)==(0|i[48]))return E=(0|i[45])+f|0,i[45]=E,i[48]=p,i[p+4>>2]=1|E,void(i[p+E>>2]=E);E=(-8&n)+f|0,a=n>>>3;do{if(n>>>0>=256){T=0|i[r+24>>2],C=0|i[r+12>>2];do{if((0|C)==(0|r)){if(g=0|i[(S=(v=r+16|0)+4|0)>>2])b=g,P=S;else{if(!(e=0|i[v>>2])){A=0;break}b=e,P=v}for(;;)if(g=0|i[(S=b+20|0)>>2])b=g,P=S;else{if(!(g=0|i[(S=b+16|0)>>2])){M=b,O=P;break}b=g,P=S}if(!(O>>>0<(0|i[47])>>>0)){i[O>>2]=0,A=M;break}h()}else{if((S=0|i[r+8>>2])>>>0<(0|i[47])>>>0&&h(),(0|i[(g=S+12|0)>>2])!=(0|r)&&h(),(0|i[(v=C+8|0)>>2])==(0|r)){i[g>>2]=C,i[v>>2]=S,A=C;break}h()}}while(0);if(T){if(C=0|i[r+28>>2],(0|r)==(0|i[(c=476+(C<<2)|0)>>2])){if(i[c>>2]=A,!A){i[44]=i[44]&~(1<<C);break}}else if(T>>>0<(0|i[47])>>>0&&h(),(0|i[(C=T+16|0)>>2])==(0|r)?i[C>>2]=A:i[T+20>>2]=A,!A)break;A>>>0<(C=0|i[47])>>>0&&h(),i[A+24>>2]=T,l=0|i[(c=r+16|0)>>2];do{if(l){if(!(l>>>0<C>>>0)){i[A+16>>2]=l,i[l+24>>2]=A;break}h()}}while(0);if(l=0|i[c+4>>2]){if(!(l>>>0<(0|i[47])>>>0)){i[A+20>>2]=l,i[l+24>>2]=A;break}h()}}}else{if(l=0|i[r+8>>2],C=0|i[r+12>>2],(0|l)!=(0|(T=212+(a<<1<<2)|0))&&(l>>>0<(0|i[47])>>>0&&h(),(0|i[l+12>>2])!=(0|r)&&h()),(0|C)==(0|l)){i[43]=i[43]&~(1<<a);break}(0|C)!=(0|T)?(C>>>0<(0|i[47])>>>0&&h(),(0|i[(T=C+8|0)>>2])==(0|r)?I=T:h()):I=C+8|0,i[l+12>>2]=C,i[I>>2]=l}}while(0);if(i[p+4>>2]=1|E,i[p+E>>2]=E,(0|p)==(0|i[48]))return void(i[45]=E);w=E}if(f=w>>>3,w>>>0<256)return n=212+(f<<1<<2)|0,(o=0|i[43])&(E=1<<f)?(I=0|i[(f=n+8|0)>>2])>>>0<(0|i[47])>>>0?h():(R=f,D=I):(i[43]=o|E,R=n+8|0,D=n),i[R>>2]=p,i[D+12>>2]=p,i[p+8>>2]=D,void(i[p+12>>2]=n);N=(n=w>>>8)?w>>>0>16777215?31:w>>>((o=14-((n=((R=n<<(D=(n+1048320|0)>>>16&8))+520192|0)>>>16&4)|D|(R=((E=R<<n)+245760|0)>>>16&2))+(E<<R>>>15)|0)+7|0)&1|o<<1:0,o=476+(N<<2)|0,i[p+28>>2]=N,i[p+20>>2]=0,i[p+16>>2]=0,R=0|i[44],E=1<<N;do{if(R&E){for(D=w<<(31==(0|N)?0:25-(N>>>1)|0),n=0|i[o>>2];;){if((-8&i[n+4>>2]|0)==(0|w)){L=n,k=130;break}if(!(f=0|i[(I=n+16+(D>>>31<<2)|0)>>2])){G=I,U=n,k=127;break}D<<=1,n=f}if(127==(0|k)){if(!(G>>>0<(0|i[47])>>>0)){i[G>>2]=p,i[p+24>>2]=U,i[p+12>>2]=p,i[p+8>>2]=p;break}h()}else if(130==(0|k)){if((D=0|i[(n=L+8|0)>>2])>>>0>=(c=0|i[47])>>>0&L>>>0>=c>>>0){i[D+12>>2]=p,i[n>>2]=p,i[p+8>>2]=D,i[p+12>>2]=L,i[p+24>>2]=0;break}h()}}else i[44]=R|E,i[o>>2]=p,i[p+24>>2]=o,i[p+12>>2]=p,i[p+8>>2]=p}while(0);if(p=(0|i[51])-1|0,i[51]=p,!p){for(F=628;p=0|i[F>>2];)F=p+8|0;i[51]=-1}}},_i64Add:G,_bitshift64Ashr:L,_i64Subtract:k,_memset:U,_malloc:function(e){e|=0;var t=0,r=0,n=0,a=0,o=0,s=0,l=0,c=0,d=0,u=0,p=0,f=0,_=0,y=0,E=0,S=0,v=0,T=0,A=0,b=0,P=0,M=0,I=0,w=0,R=0,D=0,N=0,L=0,k=0,G=0,U=0,F=0,x=0,B=0,K=0,j=0,Y=0,W=0,H=0,V=0,$=0,z=0,q=0,J=0,Q=0,X=0,Z=0,ee=0,te=0,re=0,ne=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,de=0,ue=0,pe=0,fe=0,_e=0,he=0,ge=0,me=0,ye=0,Ee=0,Se=0,ve=0,Te=0,Ce=0,Ae=0,be=0,Pe=0,Me=0,Oe=0,Ie=0,we=0,Re=0,De=0,Ne=0,Le=0,ke=0,Ge=0,Ue=0,Fe=0,xe=0,Be=0,Ke=0,je=0;do{if(e>>>0<245){if(r=(t=e>>>0<11?16:e+11&-8)>>>3,3&(a=(n=0|i[43])>>>r)){c=0|i[(l=(s=212+((o=(1&a^1)+r|0)<<1<<2)|0)+8|0)>>2],u=0|i[(d=c+8|0)>>2];do{if((0|s)!=(0|u)){if(u>>>0<(0|i[47])>>>0&&h(),(0|i[(p=u+12|0)>>2])==(0|c)){i[p>>2]=s,i[l>>2]=u;break}h()}else i[43]=n&~(1<<o)}while(0);return u=o<<3,i[c+4>>2]=3|u,i[(l=c+u+4|0)>>2]=1|i[l>>2],0|d}if(t>>>0>(l=0|i[45])>>>0){if(a){f=0|i[(y=(_=212+((E=((u=(p=(u=((s=a<<r&((u=2<<r)|0-u))&0-s)-1|0)>>>(s=u>>>12&16))>>>5&8)|s|(p=(f=p>>>u)>>>2&4)|(f=(_=f>>>p)>>>1&2)|(_=(y=_>>>f)>>>1&1))+(y>>>_)|0)<<1<<2)|0)+8|0)>>2],s=0|i[(p=f+8|0)>>2];do{if((0|_)!=(0|s)){if(s>>>0<(0|i[47])>>>0&&h(),(0|i[(u=s+12|0)>>2])==(0|f)){i[u>>2]=_,i[y>>2]=s,S=0|i[45];break}h()}else i[43]=n&~(1<<E),S=l}while(0);return l=(E<<3)-t|0,i[f+4>>2]=3|t,i[(n=f+t|0)+4>>2]=1|l,i[n+l>>2]=l,S&&(s=0|i[48],_=212+((y=S>>>3)<<1<<2)|0,(r=0|i[43])&(a=1<<y)?(d=0|i[(y=_+8|0)>>2])>>>0<(0|i[47])>>>0?h():(v=y,T=d):(i[43]=r|a,v=_+8|0,T=_),i[v>>2]=s,i[T+12>>2]=s,i[s+8>>2]=T,i[s+12>>2]=_),i[45]=l,i[48]=n,0|p}if(n=0|i[44]){for(d=0|i[476+(((l=(_=(l=(n&0-n)-1|0)>>>(n=l>>>12&16))>>>5&8)|n|(_=(s=_>>>l)>>>2&4)|(s=(a=s>>>_)>>>1&2)|(a=(r=a>>>s)>>>1&1))+(r>>>a)<<2)>>2],a=(-8&i[d+4>>2])-t|0,r=d,s=d;;){if(d=0|i[r+16>>2])P=d;else{if(!(_=0|i[r+20>>2])){A=a,b=s;break}P=_}a=(_=(d=(-8&i[P+4>>2])-t|0)>>>0<a>>>0)?d:a,r=P,s=_?P:s}b>>>0<(s=0|i[47])>>>0&&h(),b>>>0>=(r=b+t|0)>>>0&&h(),a=0|i[b+24>>2],p=0|i[b+12>>2];do{if((0|p)==(0|b)){if(E=0|i[(f=b+20|0)>>2])I=E,w=f;else{if(!(d=0|i[(_=b+16|0)>>2])){M=0;break}I=d,w=_}for(;;)if(E=0|i[(f=I+20|0)>>2])I=E,w=f;else{if(!(E=0|i[(f=I+16|0)>>2])){R=I,D=w;break}I=E,w=f}if(!(D>>>0<s>>>0)){i[D>>2]=0,M=R;break}h()}else{if((f=0|i[b+8>>2])>>>0<s>>>0&&h(),(0|i[(E=f+12|0)>>2])!=(0|b)&&h(),(0|i[(_=p+8|0)>>2])==(0|b)){i[E>>2]=p,i[_>>2]=f,M=p;break}h()}}while(0);do{if(a){if(p=0|i[b+28>>2],(0|b)==(0|i[(s=476+(p<<2)|0)>>2])){if(i[s>>2]=M,!M){i[44]=i[44]&~(1<<p);break}}else if(a>>>0<(0|i[47])>>>0&&h(),(0|i[(p=a+16|0)>>2])==(0|b)?i[p>>2]=M:i[a+20>>2]=M,!M)break;M>>>0<(p=0|i[47])>>>0&&h(),i[M+24>>2]=a,s=0|i[b+16>>2];do{if(s){if(!(s>>>0<p>>>0)){i[M+16>>2]=s,i[s+24>>2]=M;break}h()}}while(0);if(s=0|i[b+20>>2]){if(!(s>>>0<(0|i[47])>>>0)){i[M+20>>2]=s,i[s+24>>2]=M;break}h()}}}while(0);return A>>>0<16?(a=A+t|0,i[b+4>>2]=3|a,i[(s=b+a+4|0)>>2]=1|i[s>>2]):(i[b+4>>2]=3|t,i[r+4>>2]=1|A,i[r+A>>2]=A,(s=0|i[45])&&(a=0|i[48],s=212+((p=s>>>3)<<1<<2)|0,(f=0|i[43])&(_=1<<p)?(E=0|i[(p=s+8|0)>>2])>>>0<(0|i[47])>>>0?h():(N=p,L=E):(i[43]=f|_,N=s+8|0,L=s),i[N>>2]=a,i[L+12>>2]=a,i[a+8>>2]=L,i[a+12>>2]=s),i[45]=A,i[48]=r),0|(b+8|0)}k=t}else k=t}else if(e>>>0<=4294967231)if(a=-8&(s=e+11|0),_=0|i[44]){f=0-a|0,G=(E=s>>>8)?a>>>0>16777215?31:a>>>((n=14-((E=((p=E<<(s=(E+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(p=((d=p<<E)+245760|0)>>>16&2))+(d<<p>>>15)|0)+7|0)&1|n<<1:0,n=0|i[476+(G<<2)>>2];e:do{if(n)for(p=f,d=0,s=a<<(31==(0|G)?0:25-(G>>>1)|0),E=n,l=0;;){if((c=(y=-8&i[E+4>>2])-a|0)>>>0<p>>>0){if((0|y)==(0|a)){K=c,j=E,Y=E,B=90;break e}W=c,H=E}else W=p,H=l;if(y=0==(0|(c=0|i[E+20>>2]))|(0|c)==(0|(E=0|i[E+16+(s>>>31<<2)>>2]))?d:c,c=0==(0|E)){U=W,F=y,x=H,B=86;break}p=W,d=y,s<<=1&c^1,l=H}else U=f,F=0,x=0,B=86}while(0);if(86==(0|B)){if(0==(0|F)&0==(0|x)){if(!(f=_&((n=2<<G)|0-n))){k=a;break}V=0|i[476+(((n=(t=(n=(f&0-f)-1|0)>>>(f=n>>>12&16))>>>5&8)|f|(t=(r=t>>>n)>>>2&4)|(r=(l=r>>>t)>>>1&2)|(l=(s=l>>>r)>>>1&1))+(s>>>l)<<2)>>2]}else V=F;V?(K=U,j=V,Y=x,B=90):($=U,z=x)}if(90==(0|B))for(;;)if(B=0,r=(s=(l=(-8&i[j+4>>2])-a|0)>>>0<K>>>0)?l:K,l=s?j:Y,s=0|i[j+16>>2])K=r,j=s,Y=l,B=90;else{if(!(j=0|i[j+20>>2])){$=r,z=l;break}K=r,Y=l,B=90}if(0!=(0|z)&&$>>>0<((0|i[45])-a|0)>>>0){z>>>0<(_=0|i[47])>>>0&&h(),z>>>0>=(l=z+a|0)>>>0&&h(),r=0|i[z+24>>2],s=0|i[z+12>>2];do{if((0|s)==(0|z)){if(f=0|i[(t=z+20|0)>>2])J=f,Q=t;else{if(!(d=0|i[(n=z+16|0)>>2])){q=0;break}J=d,Q=n}for(;;)if(f=0|i[(t=J+20|0)>>2])J=f,Q=t;else{if(!(f=0|i[(t=J+16|0)>>2])){X=J,Z=Q;break}J=f,Q=t}if(!(Z>>>0<_>>>0)){i[Z>>2]=0,q=X;break}h()}else{if((t=0|i[z+8>>2])>>>0<_>>>0&&h(),(0|i[(f=t+12|0)>>2])!=(0|z)&&h(),(0|i[(n=s+8|0)>>2])==(0|z)){i[f>>2]=s,i[n>>2]=t,q=s;break}h()}}while(0);do{if(r){if(s=0|i[z+28>>2],(0|z)==(0|i[(_=476+(s<<2)|0)>>2])){if(i[_>>2]=q,!q){i[44]=i[44]&~(1<<s);break}}else if(r>>>0<(0|i[47])>>>0&&h(),(0|i[(s=r+16|0)>>2])==(0|z)?i[s>>2]=q:i[r+20>>2]=q,!q)break;q>>>0<(s=0|i[47])>>>0&&h(),i[q+24>>2]=r,_=0|i[z+16>>2];do{if(_){if(!(_>>>0<s>>>0)){i[q+16>>2]=_,i[_+24>>2]=q;break}h()}}while(0);if(_=0|i[z+20>>2]){if(!(_>>>0<(0|i[47])>>>0)){i[q+20>>2]=_,i[_+24>>2]=q;break}h()}}}while(0);do{if($>>>0>=16){if(i[z+4>>2]=3|a,i[l+4>>2]=1|$,i[l+$>>2]=$,r=$>>>3,$>>>0<256){_=212+(r<<1<<2)|0,(s=0|i[43])&(t=1<<r)?(n=0|i[(r=_+8|0)>>2])>>>0<(0|i[47])>>>0?h():(ee=r,te=n):(i[43]=s|t,ee=_+8|0,te=_),i[ee>>2]=l,i[te+12>>2]=l,i[l+8>>2]=te,i[l+12>>2]=_;break}if(re=(_=$>>>8)?$>>>0>16777215?31:$>>>((r=14-((_=((s=_<<(t=(_+1048320|0)>>>16&8))+520192|0)>>>16&4)|t|(s=((n=s<<_)+245760|0)>>>16&2))+(n<<s>>>15)|0)+7|0)&1|r<<1:0,r=476+(re<<2)|0,i[l+28>>2]=re,i[(s=l+16|0)+4>>2]=0,i[s>>2]=0,!((s=0|i[44])&(n=1<<re))){i[44]=s|n,i[r>>2]=l,i[l+24>>2]=r,i[l+12>>2]=l,i[l+8>>2]=l;break}for(n=$<<(31==(0|re)?0:25-(re>>>1)|0),s=0|i[r>>2];;){if((-8&i[s+4>>2]|0)==(0|$)){ne=s,B=148;break}if(!(t=0|i[(r=s+16+(n>>>31<<2)|0)>>2])){ie=r,ae=s,B=145;break}n<<=1,s=t}if(145==(0|B)){if(!(ie>>>0<(0|i[47])>>>0)){i[ie>>2]=l,i[l+24>>2]=ae,i[l+12>>2]=l,i[l+8>>2]=l;break}h()}else if(148==(0|B)){if((n=0|i[(s=ne+8|0)>>2])>>>0>=(t=0|i[47])>>>0&ne>>>0>=t>>>0){i[n+12>>2]=l,i[s>>2]=l,i[l+8>>2]=n,i[l+12>>2]=ne,i[l+24>>2]=0;break}h()}}else n=$+a|0,i[z+4>>2]=3|n,i[(s=z+n+4|0)>>2]=1|i[s>>2]}while(0);return 0|(z+8|0)}k=a}else k=a;else k=-1}while(0);if((z=0|i[45])>>>0>=k>>>0)return $=z-k|0,ne=0|i[48],$>>>0>15?(ae=ne+k|0,i[48]=ae,i[45]=$,i[ae+4>>2]=1|$,i[ae+$>>2]=$,i[ne+4>>2]=3|k):(i[45]=0,i[48]=0,i[ne+4>>2]=3|z,i[($=ne+z+4|0)>>2]=1|i[$>>2]),0|(ne+8|0);if((ne=0|i[46])>>>0>k>>>0)return $=ne-k|0,i[46]=$,z=(ne=0|i[49])+k|0,i[49]=z,i[z+4>>2]=1|$,i[ne+4>>2]=3|k,0|(ne+8|0);do{if(!(0|i[161])){if(!((ne=0|C(30))+-1&ne)){i[163]=ne,i[162]=ne,i[164]=-1,i[165]=-1,i[166]=0,i[154]=0,i[161]=-16&(0|m(0))^1431655768;break}h()}}while(0);if(ne=k+48|0,($=(ae=($=0|i[163])+(z=k+47|0)|0)&(ie=0-$|0))>>>0<=k>>>0)return 0|0;if(0!=(0|(re=0|i[153]))&&(ee=(te=0|i[151])+$|0)>>>0<=te>>>0|ee>>>0>re>>>0)return 0|0;e:do{if(4&i[154])B=190;else{re=0|i[49];t:do{if(re){for(ee=620;;){if((te=0|i[ee>>2])>>>0<=re>>>0&&(te+(0|i[(q=ee+4|0)>>2])|0)>>>0>re>>>0){oe=ee,se=q;break}if(!(ee=0|i[ee+8>>2])){B=173;break t}}if((ee=ae-(0|i[46])&ie)>>>0<2147483647)if((0|(q=0|g(0|ee)))==((0|i[oe>>2])+(0|i[se>>2])|0)){if(-1!=(0|q)){le=q,ce=ee,B=193;break e}}else de=q,ue=ee,B=183}else B=173}while(0);do{if(173==(0|B)&&-1!=(0|(re=0|g(0)))&&(a=re,pe=(q=(ee=0|i[162])+-1|0)&a?$-a+(q+a&0-ee)|0:$,a=(ee=0|i[151])+pe|0,pe>>>0>k>>>0&pe>>>0<2147483647)){if(0!=(0|(q=0|i[153]))&&a>>>0<=ee>>>0|a>>>0>q>>>0)break;if((0|(q=0|g(0|pe)))==(0|re)){le=re,ce=pe,B=193;break e}de=q,ue=pe,B=183}}while(0);t:do{if(183==(0|B)){q=0-ue|0;do{if(ne>>>0>ue>>>0&ue>>>0<2147483647&-1!=(0|de)&&(a=z-ue+(re=0|i[163])&0-re)>>>0<2147483647){if(-1==(0|g(0|a))){g(0|q);break t}fe=a+ue|0;break}fe=ue}while(0);if(-1!=(0|de)){le=de,ce=fe,B=193;break e}}}while(0);i[154]=4|i[154],B=190}}while(0);if(190==(0|B)&&$>>>0<2147483647&&(fe=0|g(0|$))>>>0<($=0|g(0))>>>0&-1!=(0|fe)&-1!=(0|$)&&(de=$-fe|0)>>>0>(k+40|0)>>>0&&(le=fe,ce=de,B=193),193==(0|B)){de=(0|i[151])+ce|0,i[151]=de,de>>>0>(0|i[152])>>>0&&(i[152]=de),de=0|i[49];do{if(de){fe=620;do{if((0|le)==(($=0|i[fe>>2])+(z=0|i[(ue=fe+4|0)>>2])|0)){_e=$,he=ue,ge=z,me=fe,B=203;break}fe=0|i[fe+8>>2]}while(0!=(0|fe));if(203==(0|B)&&0==(8&i[me+12>>2]|0)&&de>>>0<le>>>0&de>>>0>=_e>>>0){i[he>>2]=ge+ce,fe=de+(z=0==(7&(fe=de+8|0)|0)?0:0-fe&7)|0,ue=ce-z+(0|i[46])|0,i[49]=fe,i[46]=ue,i[fe+4>>2]=1|ue,i[fe+ue+4>>2]=40,i[50]=i[165];break}for(le>>>0<(ue=0|i[47])>>>0?(i[47]=le,ye=le):ye=ue,ue=le+ce|0,fe=620;;){if((0|i[fe>>2])==(0|ue)){Ee=fe,Se=fe,B=211;break}if(!(fe=0|i[fe+8>>2])){ve=620;break}}if(211==(0|B)){if(!(8&i[Se+12>>2])){i[Ee>>2]=le,i[(fe=Se+4|0)>>2]=(0|i[fe>>2])+ce,z=le+(0==(7&(fe=le+8|0)|0)?0:0-fe&7)|0,$=ue+(0==(7&(fe=ue+8|0)|0)?0:0-fe&7)|0,fe=z+k|0,ne=$-z-k|0,i[z+4>>2]=3|k;do{if((0|$)!=(0|de)){if((0|$)==(0|i[48])){pe=(0|i[45])+ne|0,i[45]=pe,i[48]=fe,i[fe+4>>2]=1|pe,i[fe+pe>>2]=pe;break}if(1==(3&(pe=0|i[$+4>>2])|0)){se=-8&pe,oe=pe>>>3;e:do{if(pe>>>0>=256){ie=0|i[$+24>>2],ae=0|i[$+12>>2];do{if((0|ae)==(0|$)){if(re=0|i[(a=(q=$+16|0)+4|0)>>2])Ce=re,Ae=a;else{if(!(ee=0|i[q>>2])){Te=0;break}Ce=ee,Ae=q}for(;;)if(re=0|i[(a=Ce+20|0)>>2])Ce=re,Ae=a;else{if(!(re=0|i[(a=Ce+16|0)>>2])){be=Ce,Pe=Ae;break}Ce=re,Ae=a}if(!(Pe>>>0<ye>>>0)){i[Pe>>2]=0,Te=be;break}h()}else{if((a=0|i[$+8>>2])>>>0<ye>>>0&&h(),(0|i[(re=a+12|0)>>2])!=(0|$)&&h(),(0|i[(q=ae+8|0)>>2])==(0|$)){i[re>>2]=ae,i[q>>2]=a,Te=ae;break}h()}}while(0);if(!ie)break;a=476+((ae=0|i[$+28>>2])<<2)|0;do{if((0|$)==(0|i[a>>2])){if(i[a>>2]=Te,Te)break;i[44]=i[44]&~(1<<ae);break e}if(ie>>>0<(0|i[47])>>>0&&h(),(0|i[(q=ie+16|0)>>2])==(0|$)?i[q>>2]=Te:i[ie+20>>2]=Te,!Te)break e}while(0);Te>>>0<(ae=0|i[47])>>>0&&h(),i[Te+24>>2]=ie,q=0|i[(a=$+16|0)>>2];do{if(q){if(!(q>>>0<ae>>>0)){i[Te+16>>2]=q,i[q+24>>2]=Te;break}h()}}while(0);if(!(q=0|i[a+4>>2]))break;if(!(q>>>0<(0|i[47])>>>0)){i[Te+20>>2]=q,i[q+24>>2]=Te;break}h()}else{q=0|i[$+8>>2],ae=0|i[$+12>>2],ie=212+(oe<<1<<2)|0;do{if((0|q)!=(0|ie)){if(q>>>0<ye>>>0&&h(),(0|i[q+12>>2])==(0|$))break;h()}}while(0);if((0|ae)==(0|q)){i[43]=i[43]&~(1<<oe);break}do{if((0|ae)==(0|ie))Me=ae+8|0;else{if(ae>>>0<ye>>>0&&h(),(0|i[(a=ae+8|0)>>2])==(0|$)){Me=a;break}h()}}while(0);i[q+12>>2]=ae,i[Me>>2]=q}}while(0);Oe=$+se|0,Ie=se+ne|0}else Oe=$,Ie=ne;if(i[(oe=Oe+4|0)>>2]=-2&i[oe>>2],i[fe+4>>2]=1|Ie,i[fe+Ie>>2]=Ie,oe=Ie>>>3,Ie>>>0<256){pe=212+(oe<<1<<2)|0,ie=0|i[43],a=1<<oe;do{if(ie&a){if((re=0|i[(oe=pe+8|0)>>2])>>>0>=(0|i[47])>>>0){we=oe,Re=re;break}h()}else i[43]=ie|a,we=pe+8|0,Re=pe}while(0);i[we>>2]=fe,i[Re+12>>2]=fe,i[fe+8>>2]=Re,i[fe+12>>2]=pe;break}a=Ie>>>8;do{if(a){if(Ie>>>0>16777215){De=31;break}De=Ie>>>((ee=14-((re=((se=a<<(ie=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|ie|(se=((oe=se<<re)+245760|0)>>>16&2))+(oe<<se>>>15)|0)+7|0)&1|ee<<1}else De=0}while(0);if(a=476+(De<<2)|0,i[fe+28>>2]=De,i[(pe=fe+16|0)+4>>2]=0,i[pe>>2]=0,!((pe=0|i[44])&(ee=1<<De))){i[44]=pe|ee,i[a>>2]=fe,i[fe+24>>2]=a,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}for(ee=Ie<<(31==(0|De)?0:25-(De>>>1)|0),pe=0|i[a>>2];;){if((-8&i[pe+4>>2]|0)==(0|Ie)){Ne=pe,B=281;break}if(!(se=0|i[(a=pe+16+(ee>>>31<<2)|0)>>2])){Le=a,ke=pe,B=278;break}ee<<=1,pe=se}if(278==(0|B)){if(!(Le>>>0<(0|i[47])>>>0)){i[Le>>2]=fe,i[fe+24>>2]=ke,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}h()}else if(281==(0|B)){if((ee=0|i[(pe=Ne+8|0)>>2])>>>0>=(se=0|i[47])>>>0&Ne>>>0>=se>>>0){i[ee+12>>2]=fe,i[pe>>2]=fe,i[fe+8>>2]=ee,i[fe+12>>2]=Ne,i[fe+24>>2]=0;break}h()}}else ee=(0|i[46])+ne|0,i[46]=ee,i[49]=fe,i[fe+4>>2]=1|ee}while(0);return 0|(z+8|0)}ve=620}for(;;){if((fe=0|i[ve>>2])>>>0<=de>>>0&&(ne=fe+(0|i[ve+4>>2])|0)>>>0>de>>>0){Ge=ne;break}ve=0|i[ve+8>>2]}fe=(z=(fe=(z=Ge+-47|0)+(0==(7&(ne=z+8|0)|0)?0:0-ne&7)|0)>>>0<(ne=de+16|0)>>>0?de:fe)+8|0,$=le+(ue=0==(7&($=le+8|0)|0)?0:0-$&7)|0,ee=ce+-40-ue|0,i[49]=$,i[46]=ee,i[$+4>>2]=1|ee,i[$+ee+4>>2]=40,i[50]=i[165],i[(ee=z+4|0)>>2]=27,i[fe>>2]=i[155],i[fe+4>>2]=i[156],i[fe+8>>2]=i[157],i[fe+12>>2]=i[158],i[155]=le,i[156]=ce,i[158]=0,i[157]=fe,fe=z+24|0;do{i[(fe=fe+4|0)>>2]=7}while((fe+4|0)>>>0<Ge>>>0);if((0|z)!=(0|de)){if(fe=z-de|0,i[ee>>2]=-2&i[ee>>2],i[de+4>>2]=1|fe,i[z>>2]=fe,$=fe>>>3,fe>>>0<256){ue=212+($<<1<<2)|0,(pe=0|i[43])&(se=1<<$)?(a=0|i[($=ue+8|0)>>2])>>>0<(0|i[47])>>>0?h():(Ue=$,Fe=a):(i[43]=pe|se,Ue=ue+8|0,Fe=ue),i[Ue>>2]=de,i[Fe+12>>2]=de,i[de+8>>2]=Fe,i[de+12>>2]=ue;break}if(xe=(ue=fe>>>8)?fe>>>0>16777215?31:fe>>>(($=14-((ue=((pe=ue<<(se=(ue+1048320|0)>>>16&8))+520192|0)>>>16&4)|se|(pe=((a=pe<<ue)+245760|0)>>>16&2))+(a<<pe>>>15)|0)+7|0)&1|$<<1:0,$=476+(xe<<2)|0,i[de+28>>2]=xe,i[de+20>>2]=0,i[ne>>2]=0,!((pe=0|i[44])&(a=1<<xe))){i[44]=pe|a,i[$>>2]=de,i[de+24>>2]=$,i[de+12>>2]=de,i[de+8>>2]=de;break}for(a=fe<<(31==(0|xe)?0:25-(xe>>>1)|0),pe=0|i[$>>2];;){if((-8&i[pe+4>>2]|0)==(0|fe)){Be=pe,B=307;break}if(!(se=0|i[($=pe+16+(a>>>31<<2)|0)>>2])){Ke=$,je=pe,B=304;break}a<<=1,pe=se}if(304==(0|B)){if(!(Ke>>>0<(0|i[47])>>>0)){i[Ke>>2]=de,i[de+24>>2]=je,i[de+12>>2]=de,i[de+8>>2]=de;break}h()}else if(307==(0|B)){if((a=0|i[(pe=Be+8|0)>>2])>>>0>=(fe=0|i[47])>>>0&Be>>>0>=fe>>>0){i[a+12>>2]=de,i[pe>>2]=de,i[de+8>>2]=a,i[de+12>>2]=Be,i[de+24>>2]=0;break}h()}}}else{0==(0|(a=0|i[47]))|le>>>0<a>>>0&&(i[47]=le),i[155]=le,i[156]=ce,i[158]=0,i[52]=i[161],i[51]=-1,a=0;do{i[(pe=212+(a<<1<<2)|0)+12>>2]=pe,i[pe+8>>2]=pe,a=a+1|0}while(32!=(0|a));a=le+(pe=0==(7&(a=le+8|0)|0)?0:0-a&7)|0,fe=ce+-40-pe|0,i[49]=a,i[46]=fe,i[a+4>>2]=1|fe,i[a+fe+4>>2]=40,i[50]=i[165]}}while(0);if((ce=0|i[46])>>>0>k>>>0)return le=ce-k|0,i[46]=le,de=(ce=0|i[49])+k|0,i[49]=de,i[de+4>>2]=1|le,i[ce+4>>2]=3|k,0|(ce+8|0)}return i[(0|O())>>2]=12,0|0},_memcpy:function(e,t,r){var a;if(e|=0,t|=0,(0|(r|=0))>=4096)return 0|y(0|e,0|t,0|r);if(a=0|e,(3&e)==(3&t)){for(;3&e;){if(!r)return 0|a;n[e>>0]=0|n[t>>0],e=e+1|0,t=t+1|0,r=r-1|0}for(;(0|r)>=4;)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0,r=r-4|0}for(;(0|r)>0;)n[e>>0]=0|n[t>>0],e=e+1|0,t=t+1|0,r=r-1|0;return 0|a},_bitshift64Lshr:F,_fflush:function e(t){t|=0;var r=0,n=0,a=0,o=0,s=0,l=0,c=0;do{if(t){if((0|i[t+76>>2])<=-1){r=0|N(t);break}n=0==(0|w()),a=0|N(t),n||R(),r=a}else{if(o=0|i[13]?0|e(0|i[13]):0,p(36),a=0|i[8])for(n=a,a=o;;){if(l=(0|i[n+76>>2])>-1?0|w():0,c=(0|i[n+20>>2])>>>0>(0|i[n+28>>2])>>>0?0|N(n)|a:a,l&&R(),!(n=0|i[n+56>>2])){s=c;break}a=c}else s=o;S(36),r=s}}while(0);return 0|r},___errno_location:O,_bitshift64Shl:x,runPostSets:function(){},stackAlloc:function(e){var t;return t=o,o=(o=o+(e|=0)|0)+15&-16,0|t},stackSave:function(){return 0|o},stackRestore:function(e){o=e|=0},establishStackSpace:function(e,t){o=e|=0,t|=0},setThrew:function(e,t){e|=0,t|=0,s||(s=e,t)},setTempRet0:function(e){l=e|=0},getTempRet0:function(){return 0|l},dynCall_ii:function(e,t){return t|=0,0|K[1&(e|=0)](0|t)},dynCall_iiii:function(e,t,r,n){return t|=0,r|=0,n|=0,0|j[3&(e|=0)](0|t,0|r,0|n)},dynCall_vi:function(e,t){t|=0,Y[1&(e|=0)](0|t)}}}(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush,e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;function xc(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}e.dynCall_ii=Z.dynCall_ii,e.dynCall_iiii=Z.dynCall_iiii,e.dynCall_vi=Z.dynCall_vi,n.W=Z.stackAlloc,n.na=Z.stackSave,n.X=Z.stackRestore,n.md=Z.establishStackSpace,n.cb=Z.setTempRet0,n.Ua=Z.getTempRet0,xc.prototype=Error(),xc.prototype.constructor=xc;var Yc=null,Xa=function t(){e.calledRun||$c(),e.calledRun||(Xa=t)};function $c(t){function r(){if(!e.calledRun&&(e.calledRun=!0,!A)){if(xa||(xa=!0,Oa(Qa)),Oa(Ra),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e._main&&bd&&e.callMain(t),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}if(t=t||e.arguments,null===Yc&&(Yc=Date.now()),!(0<L)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa),0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),r()}),1)):r())}}function ad(t,r){if(!r||!e.noExitRuntime)throw!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(t),new xc(t)}e.callMain=e.jd=function(t){function r(){for(var e=0;3>e;e++)i.push(0)}assert(0==L,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==Pa.length,"cannot call main when preRun functions remain to be called"),t=t||[],xa||(xa=!0,Oa(Qa));var n=t.length+1,i=[G(Va(e.thisProgram),"i8",0)];r();for(var a=0;a<n-1;a+=1)i.push(G(Va(t[a]),"i8",0)),r();i.push(0),i=G(i,"i32",0);try{ad(e._main(n,i,0),!0)}catch(t){if(!(t instanceof xc)){if("SimulateInfiniteLoop"!=t)throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t;e.noExitRuntime=!0}}},e.run=e.run=$c,e.exit=e.exit=ad;var cd=[];function z(t){void 0!==t?(e.print(t),e.S(t),t=JSON.stringify(t)):t="",A=!0;var r="abort("+t+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw cd&&cd.forEach((function(e){r=e(r,t)})),r}if(e.abort=e.abort=z,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1),$c(),module.exports=e},94114:()=>{
/*! modernizr 3.11.8 (Custom Build) | MIT *
 * https://modernizr.com/download/?-adownload-cssanimations-csstransitions-exiforientation-serviceworker-webp-domprefixes-hasevent-prefixed-prefixes-setclasses-testallprops-testprop !*/
!function(e,t,r,n){function i(e,t){return typeof e===t}function a(e){var t=v.className,r=E._config.classPrefix||"";if(T&&(t=t.baseVal),E._config.enableJSClass){var n=new RegExp("(^|\\s)"+r+"no-js(\\s|$)");t=t.replace(n,"$1"+r+"js$2")}E._config.enableClasses&&(e.length>0&&(t+=" "+r+e.join(" "+r)),T?v.className.baseVal=t:v.className=t)}function o(){return"function"!=typeof r.createElement?r.createElement(arguments[0]):T?r.createElementNS.call(r,"http://www.w3.org/2000/svg",arguments[0]):r.createElement.apply(r,arguments)}function s(e,t){return!!~(""+e).indexOf(t)}function l(e,t,n,i){var a,s,l,c,d="modernizr",u=o("div"),p=function(){var e=r.body;return e||((e=o(T?"svg":"body")).fake=!0),e}();if(parseInt(n,10))for(;n--;)(l=o("div")).id=i?i[n]:d+(n+1),u.appendChild(l);return(a=o("style")).type="text/css",a.id="s"+d,(p.fake?p:u).appendChild(a),p.appendChild(u),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(r.createTextNode(e)),u.id=d,p.fake&&(p.style.background="",p.style.overflow="hidden",c=v.style.overflow,v.style.overflow="hidden",v.appendChild(p)),s=t(u,e),p.fake&&p.parentNode?(p.parentNode.removeChild(p),v.style.overflow=c,v.offsetHeight):u.parentNode.removeChild(u),!!s}function c(e){return e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()})).replace(/^ms-/,"-ms-")}function d(e,r){var i=e.length;if("CSS"in t&&"supports"in t.CSS){for(;i--;)if(t.CSS.supports(c(e[i]),r))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];i--;)a.push("("+c(e[i])+":"+r+")");return l("@supports ("+(a=a.join(" or "))+") { #modernizr { position: absolute; } }",(function(e){return"absolute"===function(e,r,n){var i;if("getComputedStyle"in t){i=getComputedStyle.call(t,e,r);var a=t.console;null!==i?n&&(i=i.getPropertyValue(n)):a&&a[a.error?"error":"log"].call(a,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}else i=!r&&e.currentStyle&&e.currentStyle[n];return i}(e,null,"position")}))}return n}function u(e){return e.replace(/([a-z])-([a-z])/g,(function(e,t,r){return t+r.toUpperCase()})).replace(/^-/,"")}function p(e,t,r,a){function l(){p&&(delete I.style,delete I.modElem)}if(a=!i(a,"undefined")&&a,!i(r,"undefined")){var c=d(e,r);if(!i(c,"undefined"))return c}for(var p,f,_,h,g,m=["modernizr","tspan","samp"];!I.style&&m.length;)p=!0,I.modElem=o(m.shift()),I.style=I.modElem.style;for(_=e.length,f=0;f<_;f++)if(h=e[f],g=I.style[h],s(h,"-")&&(h=u(h)),I.style[h]!==n){if(a||i(r,"undefined"))return l(),"pfx"!==t||h;try{I.style[h]=r}catch(e){}if(I.style[h]!==g)return l(),"pfx"!==t||h}return l(),!1}function f(e,t){return function(){return e.apply(t,arguments)}}function _(e,t,r,n,a){var o=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+M.join(o+" ")+o).split(" ");return i(t,"string")||i(t,"undefined")?p(s,t,n,a):function(e,t,r){var n;for(var a in e)if(e[a]in t)return!1===r?e[a]:i(n=t[e[a]],"function")?f(n,r||t):n;return!1}(s=(e+" "+A.join(o+" ")+o).split(" "),t,r)}function h(e,t,r){return _(e,n,n,t,r)}function g(e,t){if("object"==typeof e)for(var r in e)w(e,r)&&g(r,e[r]);else{var n=(e=e.toLowerCase()).split("."),i=E[n[0]];if(2===n.length&&(i=i[n[1]]),void 0!==i)return E;t="function"==typeof t?t():t,1===n.length?E[n[0]]=t:(!E[n[0]]||E[n[0]]instanceof Boolean||(E[n[0]]=new Boolean(E[n[0]])),E[n[0]][n[1]]=t),a([(t&&!1!==t?"":"no-")+n.join("-")]),E._trigger(e,t)}return E}var m=[],y={_version:"3.11.8",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var r=this;setTimeout((function(){t(r[e])}),0)},addTest:function(e,t,r){m.push({name:e,fn:t,options:r})},addAsyncTest:function(e){m.push({name:null,fn:e})}},E=function(){};E.prototype=y,E=new E;var S=[],v=r.documentElement,T="svg"===v.nodeName.toLowerCase(),C="Moz O ms Webkit",A=y._config.usePrefixes?C.toLowerCase().split(" "):[];y._domPrefixes=A;var b=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];y._prefixes=b;var P=function(){var e=!("onblur"in v);return function(t,r){var i;return!!t&&(r&&"string"!=typeof r||(r=o(r||"div")),!(i=(t="on"+t)in r)&&e&&(r.setAttribute||(r=o("div")),r.setAttribute(t,""),i="function"==typeof r[t],r[t]!==n&&(r[t]=n),r.removeAttribute(t)),i)}}();y.hasEvent=P;var M=y._config.usePrefixes?C.split(" "):[];y._cssomPrefixes=M;var O={elem:o("modernizr")};E._q.push((function(){delete O.elem}));var I={style:O.elem.style};E._q.unshift((function(){delete I.style})),y.testAllProps=_;var w,R=function(e){var r,i=b.length,a=t.CSSRule;if(void 0===a)return n;if(!e)return!1;if((r=(e=e.replace(/^@/,"")).replace(/-/g,"_").toUpperCase()+"_RULE")in a)return"@"+e;for(var o=0;o<i;o++){var s=b[o];if(s.toUpperCase()+"_"+r in a)return"@-"+s.toLowerCase()+"-"+e}return!1};y.atRule=R,y.prefixed=function(e,t,r){return 0===e.indexOf("@")?R(e):(-1!==e.indexOf("-")&&(e=u(e)),t?_(e,t,r):_(e,"pfx"))},y.testAllProps=h,y.testProp=function(e,t,r){return p([e],n,t,r)},function(){var e={}.hasOwnProperty;w=i(e,"undefined")||i(e.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(t,r){return e.call(t,r)}}(),y._l={},y.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),E.hasOwnProperty(e)&&setTimeout((function(){E._trigger(e,E[e])}),0)},y._trigger=function(e,t){if(this._l[e]){var r=this._l[e];setTimeout((function(){var e;for(e=0;e<r.length;e++)(0,r[e])(t)}),0),delete this._l[e]}},E._q.push((function(){y.addTest=g})),E.addAsyncTest((function(){function e(e,t,r){function n(t){var n=!(!t||"load"!==t.type)&&1===i.width;g(e,"webp"===e&&n?new Boolean(n):n),r&&r(t)}var i=new Image;i.onerror=n,i.onload=n,i.src=t}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],r=t.shift();e(r.name,r.uri,(function(r){if(r&&"load"===r.type)for(var n=0;n<t.length;n++)e(t[n].name,t[n].uri)}))})),E.addTest("serviceworker","serviceWorker"in navigator),E.addAsyncTest((function(){var e=new Image;e.onerror=function(){g("exiforientation",!1)},e.onload=function(){g("exiforientation",2!==e.width)},e.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAiRXhpZgAASUkqAAgAAAABABIBAwABAAAABgASAAAAAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+/iiiigD/2Q=="})),E.addTest("adownload",!t.externalHost&&"download"in o("a")),E.addTest("cssanimations",h("animationName","a",!0)),E.addTest("csstransitions",h("transition","all",!0)),function(){var e,t,r,n,a,o;for(var s in m)if(m.hasOwnProperty(s)){if(e=[],(t=m[s]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(r=0;r<t.options.aliases.length;r++)e.push(t.options.aliases[r].toLowerCase());for(n=i(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)1===(o=e[a].split(".")).length?E[o[0]]=n:(E[o[0]]&&(!E[o[0]]||E[o[0]]instanceof Boolean)||(E[o[0]]=new Boolean(E[o[0]])),E[o[0]][o[1]]=n),S.push((n?"":"no-")+o.join("-"))}}(),a(S),delete y.addTest,delete y.addAsyncTest;for(var D=0;D<E._q.length;D++)E._q[D]();e.Modernizr=E}(window,window,document)},37360:e=>{var t;!function(){function e(e){if(this.mode=n.MODE_8BIT_BYTE,this.data=e,this.parsedData=[],e instanceof ArrayBuffer)this.parsedData=new Int8Array(e);else{for(var t=0,r=this.data.length;t<r;t++){var i=[],a=this.data.charCodeAt(t);a>65536?(i[0]=240|(1835008&a)>>>18,i[1]=128|(258048&a)>>>12,i[2]=128|(4032&a)>>>6,i[3]=128|63&a):a>2048?(i[0]=224|(61440&a)>>>12,i[1]=128|(4032&a)>>>6,i[2]=128|63&a):a>128?(i[0]=192|(1984&a)>>>6,i[1]=128|63&a):i[0]=a,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}}function r(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,r=this.parsedData.length;t<r;t++)e.put(this.parsedData[t],8)}},r.prototype={addData:function(t){var r=new e(t);this.dataList.push(r),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=r.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))for(var n=-1;n<=7;n++)t+n<=-1||this.moduleCount<=t+n||(this.modules[e+r][t+n]=0<=r&&r<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var e=0,t=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=f.getLostPoint(this);(0==r||e>n)&&(e=n,t=r)}return t},createMovieClip:function(e,t,r){var n=e.createEmptyMovieClip(t,r);this.make();for(var i=0;i<this.modules.length;i++)for(var a=1*i,o=0;o<this.modules[i].length;o++){var s=1*o;this.modules[i][o]&&(n.beginFill(0,100),n.moveTo(s,a),n.lineTo(s+1,a),n.lineTo(s+1,a+1),n.lineTo(s,a+1),n.endFill())}return n},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var r=0;r<e.length;r++){var n=e[t],i=e[r];if(null==this.modules[n][i])for(var a=-2;a<=2;a++)for(var o=-2;o<=2;o++)this.modules[n+a][i+o]=-2==a||2==a||-2==o||2==o||0==a&&0==o}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),r=0;r<18;r++){var n=!e&&1==(t>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(r=0;r<18;r++){n=!e&&1==(t>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},setupTypeInfo:function(e,t){for(var r=this.errorCorrectLevel<<3|t,n=f.getBCHTypeInfo(r),i=0;i<15;i++){var a=!e&&1==(n>>i&1);i<6?this.modules[i][8]=a:i<8?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(i=0;i<15;i++){a=!e&&1==(n>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=a:i<9?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var r=-1,n=this.moduleCount-1,i=7,a=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var s=0;s<2;s++)if(null==this.modules[n][o-s]){var l=!1;a<e.length&&(l=1==(e[a]>>>i&1)),f.getMask(t,n,o-s)&&(l=!l),this.modules[n][o-s]=l,-1==--i&&(a++,i=7)}if((n+=r)<0||this.moduleCount<=n){n-=r,r=-r;break}}}},r.PAD0=236,r.PAD1=17,r.createData=function(e,t,n){for(var i=m.getRSBlocks(e,t),a=new y,o=0;o<n.length;o++){var s=n[o];a.put(s.mode,4),a.put(s.getLength(),f.getLengthInBits(s.mode,e)),s.write(a)}var l=0;for(o=0;o<i.length;o++)l+=i[o].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");for(a.getLengthInBits()+4<=8*l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*l||(a.put(r.PAD0,8),a.getLengthInBits()>=8*l));)a.put(r.PAD1,8);return r.createBytes(a,i)},r.createBytes=function(e,t){for(var r=0,n=0,i=0,a=new Array(t.length),o=new Array(t.length),s=0;s<t.length;s++){var l=t[s].dataCount,c=t[s].totalCount-l;n=Math.max(n,l),i=Math.max(i,c),a[s]=new Array(l);for(var d=0;d<a[s].length;d++)a[s][d]=255&e.buffer[d+r];r+=l;var u=f.getErrorCorrectPolynomial(c),p=new g(a[s],u.getLength()-1).mod(u);o[s]=new Array(u.getLength()-1);for(d=0;d<o[s].length;d++){var _=d+p.getLength()-o[s].length;o[s][d]=_>=0?p.get(_):0}}var h=0;for(d=0;d<t.length;d++)h+=t[d].totalCount;var m=new Array(h),y=0;for(d=0;d<n;d++)for(s=0;s<t.length;s++)d<a[s].length&&(m[y++]=a[s][d]);for(d=0;d<i;d++)for(s=0;s<t.length;s++)d<o[s].length&&(m[y++]=o[s][d]);return m};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},a=0,o=1,s=2,l=3,c=4,d=5,u=6,p=7,f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;f.getBCHDigit(t)-f.getBCHDigit(f.G15)>=0;)t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15);return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;f.getBCHDigit(t)-f.getBCHDigit(f.G18)>=0;)t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,r){switch(e){case a:return(t+r)%2==0;case o:return t%2==0;case s:return r%3==0;case l:return(t+r)%3==0;case c:return(Math.floor(t/2)+Math.floor(r/3))%2==0;case d:return t*r%2+t*r%3==0;case u:return(t*r%2+t*r%3)%2==0;case p:return(t*r%3+(t+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new g([1],0),r=0;r<e;r++)t=t.multiply(new g([1,_.gexp(r)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:case n.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),r=0,n=0;n<t;n++)for(var i=0;i<t;i++){for(var a=0,o=e.isDark(n,i),s=-1;s<=1;s++)if(!(n+s<0||t<=n+s))for(var l=-1;l<=1;l++)i+l<0||t<=i+l||0==s&&0==l||o==e.isDark(n+s,i+l)&&a++;a>5&&(r+=3+a-5)}for(n=0;n<t-1;n++)for(i=0;i<t-1;i++){var c=0;e.isDark(n,i)&&c++,e.isDark(n+1,i)&&c++,e.isDark(n,i+1)&&c++,e.isDark(n+1,i+1)&&c++,0!=c&&4!=c||(r+=3)}for(n=0;n<t;n++)for(i=0;i<t-6;i++)e.isDark(n,i)&&!e.isDark(n,i+1)&&e.isDark(n,i+2)&&e.isDark(n,i+3)&&e.isDark(n,i+4)&&!e.isDark(n,i+5)&&e.isDark(n,i+6)&&(r+=40);for(i=0;i<t;i++)for(n=0;n<t-6;n++)e.isDark(n,i)&&!e.isDark(n+1,i)&&e.isDark(n+2,i)&&e.isDark(n+3,i)&&e.isDark(n+4,i)&&!e.isDark(n+5,i)&&e.isDark(n+6,i)&&(r+=40);var d=0;for(i=0;i<t;i++)for(n=0;n<t;n++)e.isDark(n,i)&&d++;return r+=10*(Math.abs(100*d/t/t-50)/5)}},_={glog:function(e){if(e<1)throw new Error("glog("+e+")");return _.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return _.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;h<8;h++)_.EXP_TABLE[h]=1<<h;for(h=8;h<256;h++)_.EXP_TABLE[h]=_.EXP_TABLE[h-4]^_.EXP_TABLE[h-5]^_.EXP_TABLE[h-6]^_.EXP_TABLE[h-8];for(h=0;h<255;h++)_.LOG_TABLE[_.EXP_TABLE[h]]=h;function g(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var r=0;r<e.length&&0==e[r];)r++;this.num=new Array(e.length-r+t);for(var n=0;n<e.length-r;n++)this.num[n]=e[n+r]}function m(e,t){this.totalCount=e,this.dataCount=t}function y(){this.buffer=[],this.length=0}g.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var n=0;n<e.getLength();n++)t[r+n]^=_.gexp(_.glog(this.get(r))+_.glog(e.get(n)));return new g(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=_.glog(this.get(0))-_.glog(e.get(0)),r=new Array(this.getLength()),n=0;n<this.getLength();n++)r[n]=this.get(n);for(n=0;n<e.getLength();n++)r[n]^=_.gexp(_.glog(e.get(n))+t);return new g(r,0).mod(e)}},m.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],m.getRSBlocks=function(e,t){var r=m.getRsBlockTable(e,t);if(null==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var n=r.length/3,i=[],a=0;a<n;a++)for(var o=r[3*a+0],s=r[3*a+1],l=r[3*a+2],c=0;c<o;c++)i.push(new m(s,l));return i},m.getRsBlockTable=function(e,t){switch(t){case i.L:return m.RS_BLOCK_TABLE[4*(e-1)+0];case i.M:return m.RS_BLOCK_TABLE[4*(e-1)+1];case i.Q:return m.RS_BLOCK_TABLE[4*(e-1)+2];case i.H:return m.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},y.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var r=0;r<t;r++)this.putBit(1==(e>>>t-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var E=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],S=function(e,t){this._bIsPainted=!1,this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,this._elCanvas.setAttribute("aria-label","Scan me!"),this._elCanvas.setAttribute("role","img"),e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};function v(e,t){for(var r=1,n=e instanceof ArrayBuffer?e.byteLength:function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e.length?3:0)}(e),a=0,o=E.length;a<=o;a++){var s=0;switch(t){case i.L:s=E[a][0];break;case i.M:s=E[a][1];break;case i.Q:s=E[a][2];break;case i.H:s=E[a][3]}if(n<=s)break;r++}if(r>E.length)throw new Error("Too long data");return r}S.prototype.draw=function(e){var t=this._oContext,r=this._htOption,n=e.getModuleCount(),i=r.width/n,a=r.height/n,o=Math.round(i),s=Math.round(a);this.clear();for(var l=0;l<n;l++)for(var c=0;c<n;c++){var d=e.isDark(l,c),u=c*i,p=l*a;t.strokeStyle=d?r.colorDark:r.colorLight,t.lineWidth=1,t.fillStyle=d?r.colorDark:r.colorLight,t.fillRect(u,p,i,a),t.strokeRect(Math.floor(u)+.5,Math.floor(p)+.5,o,s),t.strokeRect(Math.ceil(u)-.5,Math.ceil(p)-.5,o,s)}this._bIsPainted=!0},S.prototype.isPainted=function(){return this._bIsPainted},S.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},S.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},(t=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof t&&(t={text:t}),t)for(var r in t)this._htOption[r]=t[r];"string"==typeof e&&(e=document.getElementById(e)),this._el=e,this._oQRCode=null,this._oDrawing=new S(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new r(v(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode)},t.prototype.clear=function(){this._oDrawing.clear()},t.CorrectLevel=i}(),e.exports=t},6906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleSheet=t.StyleXSheet=void 0;var n,i=(n=r(41143))&&n.__esModule?n:{default:n};function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const o="__fb-light-mode",s="__fb-dark-mode";function l(e,t){const r=[];r.push("".concat(e," {"));for(const e in t){const n=t[e];r.push("  --".concat(e,": ").concat(n,";"))}return r.push("}"),r.join("\n")}const c=/var\(--(.*?)\)/g;class d{constructor(e){var t;a(this,"rootTheme",void 0),a(this,"rootDarkTheme",void 0),a(this,"supportsVariables",void 0),a(this,"rules",void 0),a(this,"injected",void 0),a(this,"tag",void 0),a(this,"ruleForPriority",void 0),this.tag=null,this.injected=!1,this.ruleForPriority=new Map,this.rules=[],this.rootTheme=e.rootTheme,this.rootDarkTheme=e.rootDarkTheme,this.supportsVariables=null!==(t=e.supportsVariables)&&void 0!==t?t:null!=r.g.CSS&&null!=r.g.CSS.supports&&r.g.CSS.supports("--fake-var:0")}getVariableMatch(){return c}isHeadless(){var e,t;return null==this.tag||null==(null===(e=r.g)||void 0===e||null===(t=e.document)||void 0===t?void 0:t.body)}getTag(){const{tag:e}=this;return(0,i.default)(null!=e,"expected tag"),e}getCSS(){return this.rules.join("\n")}getRulePosition(e){return this.rules.indexOf(e)}getRuleCount(){return this.rules.length}inject(){var e;this.injected||(this.injected=!0,null!=(null===(e=r.g.document)||void 0===e?void 0:e.body)?(this.tag=function(){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-styled","true"),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}(),this.injectTheme()):this.injectTheme())}injectTheme(){null!=this.rootTheme&&this.insert(l(":root, .".concat(o),this.rootTheme),0),null!=this.rootDarkTheme&&this.insert(l(".".concat(s,":root, .").concat(s),this.rootDarkTheme),0)}__injectCustomThemeForTesting(e,t){null!=t&&this.insert(l(e,t),0)}delete(e){const t=this.rules.indexOf(e);if((0,i.default)(t>=0,"Couldn't find the index for rule %s",e),this.rules.splice(t,1),this.isHeadless())return;const r=this.getTag().sheet;(0,i.default)(r,"expected sheet"),r.deleteRule(t)}normalizeRule(e){const{rootTheme:t}=this;return this.supportsVariables||null==t?e:e.replace(c,((e,r)=>t[r]))}getInsertPositionForPriority(e){const t=this.ruleForPriority.get(e);if(null!=t)return this.rules.indexOf(t)+1;const r=Array.from(this.ruleForPriority.keys()).sort(((e,t)=>t-e)).filter((t=>t>e?1:0));if(0===r.length)return this.getRuleCount();const n=r.pop();return this.rules.indexOf(this.ruleForPriority.get(n))}insert(e,t,r){if(!1===this.injected&&this.inject(),null!=r)return this.insert(u(e,"html:not([dir='rtl'])"),t),void this.insert(u(r,"html[dir='rtl']"),t);const n=e;if(this.rules.includes(n))return;const i=this.normalizeRule(n),a=this.getInsertPositionForPriority(t);if(this.rules.splice(a,0,i),this.ruleForPriority.set(t,i),this.isHeadless())return;const o=this.getTag().sheet;if(null!=o)try{o.insertRule(i,a)}catch(e){}}}function u(e,t){if(!e.startsWith("@"))return"".concat(t," ").concat(e);const r=e.indexOf("{"),n=e.slice(0,r+1),i=e.slice(r+1);return"".concat(n).concat(t," ").concat(i)}t.StyleXSheet=d,a(d,"LIGHT_MODE_CLASS_NAME",o),a(d,"DARK_MODE_CLASS_NAME",s);const p=new d({supportsVariables:!0,rootTheme:{},rootDarkTheme:{}});t.styleSheet=p},56720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(6906);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){for(var t=e.reverse(),r={};t.length;){var n=t.pop();if(Array.isArray(n))for(var i=n.length-1;i>=0;i--)t.push(n[i]);else{var a=n;if(null!=a&&"object"==typeof a)for(var o in a){var s=a[o];if("string"==typeof s)r[o]=s;else if("object"==typeof s){var l;r[o]=null!==(l=r[o])&&void 0!==l?l:{},Object.assign(r[o],s)}}}}return r}function l(...e){var t=s(e),r="";for(var n in t)if(Boolean(t[n]))if("string"==typeof t[n])r+=r?" "+t[n]:t[n];else if("object"==typeof t[n]){var i=t[n];for(var a in i){var o=i[a];r+=r?" "+o:o}}return r}l.compose=function(...e){return s(e)},l.create=function(e){throw new Error("stylex.create should never be called. It should be compiled away.")},l.keyframes=e=>{throw new Error("stylex.keyframes should never be called")},l.inject=(e,t,r=null)=>{n.styleSheet.insert(e,t,r)},l.dedupe=(...e)=>l(...e),l.absoluteFill={bottom:0,boxSizing:"border-box",end:0,position:"absolute",start:0,top:0},l.absoluteCenter={boxSizing:"border-box",left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"},l.blockBase={borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"block",flexGrow:1,flexShrink:1,margin:0,padding:0,position:"relative",zIndex:0},l.inlineBase=a(a({},l.blockBase),{},{display:"inline"}),l.buttonBase={appearance:"none",backgroundColor:"transparent",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",margin:0,padding:0,position:"relative",textAlign:"inherit",zIndex:0},l.flexBase={alignItems:"stretch",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"flex",flexDirection:"column",flexGrow:1,flexShrink:1,justifyContent:"space-between",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",zIndex:0},l.flexInlineBase=a(a({},l.flexBase),{},{display:"inline-flex"}),l.linkBase={backgroundColor:"transparent",backgroundImage:"none",boxSizing:"border-box",color:"inherit",cursor:"pointer",position:"relative",textDecoration:"none",zIndex:0},l.listBase={boxSizing:"border-box",listStyle:"none",marginBottom:0,marginTop:0,paddingStart:0},l.visuallyHidden={clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",width:1};var c=l;t.default=c},29127:(e,t,r)=>{var n={"./af.json":[88789,8288],"./ar.json":[58854,8801],"./az.json":[48758,1967],"./bg.json":[60624,1234],"./bn.json":[93511,677],"./ca.json":[98922,4451],"./cs.json":[40097,3539],"./da.json":[36117,9626],"./de.json":[3313,88],"./el.json":[24689,3004],"./en.json":[90084,7494],"./es.json":[96598,4739],"./et.json":[57633,9599],"./fa.json":[41076,4853],"./fi.json":[51701,9789],"./fil.json":[46387,3565],"./fr.json":[12785,7334],"./gu.json":[50387,1244],"./he.json":[62603,2422],"./hi.json":[27605,8606],"./hr.json":[54047,3853],"./hu.json":[92922,1389],"./id.json":[75608,4132],"./it.json":[54800,5881],"./ja.json":[66189,5608],"./kk.json":[47681,4260],"./kn.json":[78930,6700],"./ko.json":[28076,7020],"./lt.json":[37885,4169],"./lv.json":[22798,7938],"./mk.json":[79265,1592],"./ml.json":[7208,4794],"./mr.json":[30163,2771],"./ms.json":[13390,9911],"./nb.json":[49057,4046],"./nl.json":[23129,7055],"./pa.json":[66384,6032],"./pl.json":[75495,9566],"./pt.json":[8897,1992],"./ro.json":[64267,8945],"./ru.json":[34813,887],"./sk.json":[75785,7163],"./sl.json":[65608,7626],"./sq.json":[55915,6098],"./sr.json":[95742,2967],"./sv.json":[81244,4768],"./sw.json":[78923,6606],"./ta.json":[17574,3721],"./te.json":[96564,4771],"./th.json":[38728,5955],"./tr.json":[38704,8962],"./uk.json":[95304,5282],"./ur.json":[27814,2619],"./uz.json":[18192,7654],"./vi.json":[22521,5315],"./zh-CN.json":[59978,4680],"./zh-HK.json":[17133,7920],"./zh-TW.json":[37439,3421]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r.t(i,3)))}i.keys=()=>Object.keys(n),i.id=29127,e.exports=i},26299:(e,t,r)=>{var n={"./af":[50164,6365],"./af.js":[50164,6365],"./ar":[89511,8054],"./ar-XB":[12326,9995],"./ar-XB.js":[12326,9995],"./ar.js":[89511,8054],"./az":[4345,7072],"./az.js":[4345,7072],"./bg":[74774,7102],"./bg.js":[74774,7102],"./bn":[74342,8700],"./bn.js":[74342,8700],"./ca":[654,5632],"./ca.js":[654,5632],"./cs":[64654,165],"./cs.js":[64654,165],"./da":[3435,1628],"./da.js":[3435,1628],"./de":[55170,7216],"./de.js":[55170,7216],"./el":[31977,1204],"./el.js":[31977,1204],"./en":[77407,6933],"./en.js":[77407,6933],"./es":[82834,673],"./es.js":[82834,673],"./et":[65644,792],"./et.js":[65644,792],"./fa":[32949,9999],"./fa.js":[32949,9999],"./fi":[70971,9613],"./fi.js":[70971,9613],"./fil":[94399,907],"./fil.js":[94399,907],"./fr":[61945,6293],"./fr.js":[61945,6293],"./gu":[96432,6038],"./gu.js":[96432,6038],"./he":[44756,5729],"./he.js":[44756,5729],"./hi":[27135,3722],"./hi.js":[27135,3722],"./hr":[66762,5708],"./hr.js":[66762,5708],"./hu":[10728,2556],"./hu.js":[10728,2556],"./id":[18626,5128],"./id.js":[18626,5128],"./it":[47959,2830],"./it.js":[47959,2830],"./ja":[34101,5182],"./ja.js":[34101,5182],"./kk":[85821,9719],"./kk.js":[85821,9719],"./kn":[37038,155],"./kn.js":[37038,155],"./ko":[68736,820],"./ko.js":[68736,820],"./lt":[78935,1529],"./lt.js":[78935,1529],"./lv":[23480,4708],"./lv.js":[23480,4708],"./mk":[32209,6651],"./mk.js":[32209,6651],"./ml":[27102,6655],"./ml.js":[27102,6655],"./mr":[23268,1248],"./mr.js":[23268,1248],"./ms":[84545,5443],"./ms.js":[84545,5443],"./nb":[15070,7749],"./nb.js":[15070,7749],"./nl":[64606,9750],"./nl.js":[64606,9750],"./pa":[31818,9815],"./pa.js":[31818,9815],"./pl":[98120,8628],"./pl.js":[98120,8628],"./pt":[93710,6953],"./pt-BR":[70626,2091],"./pt-BR.js":[70626,2091],"./pt.js":[93710,6953],"./ro":[49526,7162],"./ro.js":[49526,7162],"./ru":[38976,8292],"./ru.js":[38976,8292],"./sk":[24928,1770],"./sk.js":[24928,1770],"./sl":[65516,4259],"./sl.js":[65516,4259],"./sq":[25177,9737],"./sq.js":[25177,9737],"./sr":[24165,6331],"./sr.js":[24165,6331],"./sv":[23012,2944],"./sv.js":[23012,2944],"./sw":[56916,3998],"./sw.js":[56916,3998],"./ta":[11227,2739],"./ta.js":[11227,2739],"./te":[24939,5650],"./te.js":[24939,5650],"./th":[34086,2135],"./th.js":[34086,2135],"./tr":[38953,248],"./tr.js":[38953,248],"./uk":[54945,906],"./uk.js":[54945,906],"./ur":[67882,4361],"./ur.js":[67882,4361],"./uz":[37754,4873],"./uz.js":[37754,4873],"./vi":[79973,8598],"./vi.js":[79973,8598],"./zh-CN":[98537,6483],"./zh-CN.js":[98537,6483],"./zh-HK":[72511,1081],"./zh-HK.js":[72511,1081],"./zh-TW":[70468,7542],"./zh-TW.js":[70468,7542]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=26299,e.exports=i},19922:(e,t,r)=>{var n={"./af":[36249,3748],"./af.js":[36249,3748],"./ar":[96951,1473],"./ar-DZ":[31883,6884],"./ar-DZ.js":[31883,6884],"./ar-KW":[85371,6282],"./ar-KW.js":[85371,6282],"./ar-LY":[25108,5671],"./ar-LY.js":[25108,5671],"./ar-MA":[22992,2966],"./ar-MA.js":[22992,2966],"./ar-SA":[14344,9646],"./ar-SA.js":[14344,9646],"./ar-TN":[60476,9289],"./ar-TN.js":[60476,9289],"./ar-XB":[61547,3934],"./ar-XB.js":[61547,3934],"./ar.js":[96951,1473],"./az":[58317,5740],"./az.js":[58317,5740],"./bn":[79307,7728],"./bn.js":[79307,7728],"./ca":[72669,9817],"./ca.js":[72669,9817],"./cs":[4388,2023],"./cs.js":[4388,2023],"./da":[82098,7315],"./da.js":[82098,7315],"./de":[96264,5862],"./de.js":[96264,5862],"./el":[57882,1055],"./el.js":[57882,1055],"./en-AU":[82248,8678],"./en-AU.js":[82248,8678],"./en-CA":[18526,4616],"./en-CA.js":[18526,4616],"./en-GB":[87123,9227],"./en-GB.js":[87123,9227],"./en-IE":[40296,2979],"./en-IE.js":[40296,2979],"./en-NZ":[66060,3892],"./en-NZ.js":[66060,3892],"./es":[71689,1791],"./es-DO":[68592,2394],"./es-DO.js":[68592,2394],"./es.js":[71689,1791],"./et":[73429,4473],"./et.js":[73429,4473],"./fa":[6940,7662],"./fa.js":[6940,7662],"./fi":[63191,7386],"./fi.js":[63191,7386],"./fr":[81189,2445],"./fr-CA":[7908,9765],"./fr-CA.js":[7908,9765],"./fr-CH":[9925,8799],"./fr-CH.js":[9925,8799],"./fr.js":[81189,2445],"./gu":[62021,4468],"./gu.js":[62021,4468],"./he":[55897,5027],"./he.js":[55897,5027],"./hi":[55467,6709],"./hi.js":[55467,6709],"./hr":[23077,1381],"./hr.js":[23077,1381],"./hu":[85678,4339],"./hu.js":[85678,4339],"./id":[37827,6511],"./id.js":[37827,6511],"./it":[22365,5247],"./it.js":[22365,5247],"./kk":[65897,7074],"./kk.js":[65897,7074],"./kn":[23124,6568],"./kn.js":[23124,6568],"./ko":[77096,4818],"./ko.js":[77096,4818],"./lt":[66191,6920],"./lt.js":[66191,6920],"./mk":[4942,9545],"./mk.js":[4942,9545],"./ml":[28472,3113],"./ml.js":[28472,3113],"./mr":[84561,3422],"./mr.js":[84561,3422],"./ms":[95938,7739],"./ms-MY":[65012,1520],"./ms-MY.js":[65012,1520],"./ms.js":[95938,7739],"./nb":[98457,5959],"./nb.js":[98457,5959],"./nl":[68623,319],"./nl.js":[68623,319],"./pa-IN":[30837,8132],"./pa-IN.js":[30837,8132],"./pl":[40938,4980],"./pl.js":[40938,4980],"./pt":[80432,9116],"./pt-BR":[40725,6547],"./pt-BR.js":[40725,6547],"./pt.js":[80432,9116],"./ro":[46828,3569],"./ro.js":[46828,3569],"./ru":[84381,2957],"./ru.js":[84381,2957],"./sk":[31453,5965],"./sk.js":[31453,5965],"./sl":[96918,3501],"./sl.js":[96918,3501],"./sq":[46987,6496],"./sq.js":[46987,6496],"./sr":[7467,5170],"./sr-CYRL":[5879,5790],"./sr-CYRL.js":[5879,5790],"./sr.js":[7467,5170],"./sv":[38312,1069],"./sv.js":[38312,1069],"./sw":[47638,2017],"./sw.js":[47638,2017],"./ta":[50995,8634],"./ta.js":[50995,8634],"./te":[70008,3370],"./te.js":[70008,3370],"./th":[8448,951],"./th.js":[8448,951],"./tr":[47120,9313],"./tr.js":[47120,9313],"./uk":[75997,9682],"./uk.js":[75997,9682],"./ur":[98563,6163],"./ur.js":[98563,6163],"./uz":[16183,3017],"./uz-LATN":[75,8117],"./uz-LATN.js":[75,8117],"./uz.js":[16183,3017],"./zh-CN":[83718,3047],"./zh-CN.js":[83718,3047],"./zh-TW":[57924,5125],"./zh-TW.js":[57924,5125]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return r.e(t[1]).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=19922,e.exports=i},47466:e=>{"use strict";e.exports=JSON.parse('{"application/":{"applixware":"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{"capability":"cdmia","container":"cdmic","domain":"cdmid","object":"cdmio","queue":"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","ecmascript":"ecma","emma+xml":"emma","epub+zip":"epub","exi":"exi","font-":{"tdpfr":"pfr","woff":"woff"},"gml+xml":"gml","gpx+xml":"gpx","gxf":"gxf","hyperstudio":"stk","inkml+xml":["ink","inkml"],"ipfix":"ipfix","java-":{"archive":"jar","vm":"class","serialized-object":"ser"},"javascript":"js","json":"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{"binhex40":"hqx","compactpro":"cpt"},"mads+xml":"mads","marc":"mrc","marcxml+xml":"mrcx","mathematica":["ma","nb","mb"],"mathml+xml":"mathml","mbox":"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods","mp21":["m21","mp21"],"mp4":"mp4s","msword":["doc","dot"],"mxf":"mxf","oda":"oda","ogg":"ogx","omdoc+xml":"omdoc","onenote":["onetoc","onetoc2","onetmp","onepkg"],"oxps":"oxps","pdf":"pdf","pgp-":{"encrypted":"pgp","signature":["asc","sig"]},"pkcs10":"p10","pkcs7-":{"mime":["p7m","p7c"],"signature":"p7s"},"pkcs8":"p8","pkix-":{"cert":"cer","crl":"crl","pkipath":"pkipath","attr-cert":"ac"},"pkixcmp":"pki","pls+xml":"pls","postscript":["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{"ghostbusters":"gbr","manifest":"mft","roa":"roa"},"rsd+xml":"rsd","rss+xml":"rss","rtf":"rtf","sbml+xml":"sbml","scvp-":{"cv-":{"request":"scq","response":"scs"},"vp-":{"request":"spq","response":"spp"}},"sdp":"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{"query":"rq","results+xml":"srx"},"srgs":"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{"acucobol":"acu","acucorp":["atc","acutc"],"adobe.":{"fxp":["fxp","fxpl"],"xdp+xml":"xdp","xfdf":"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg","mpegurl":"m3u8"},"audiograph":"aep","bmi":"bmi","businessobjects":"rep","chemdraw+xml":"cdxml","cinderella":"cdy","claymore":"cla","commonspace":"csp","cosmocaller":"cmc","crick.":{"clicker":"clkx","clicker.":{"keyboard":"clkk","palette":"clkp","template":"clkt","wordbank":"clkw"}},"curl.":{"car":"car","pcurl":"pcurl"},"dart":"dart","dece.":{"data":["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],"unspecified":["uvx","uvvx"],"zip":["uvz","uvvz"]},"dna":"dna","dpgraph":"dpg","dreamfactory":"dfac","dvb.":{"ait":"ait","service":"svc"},"dynageo":"geo","enliven":"nml","epson.":{"esf":"esf","msf":"msf","quickanime":"qam","salt":"slt","ssf":"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{"album":"ez2","package":"ez3"},"fdf":"fdf","fdsn.":{"mseed":"mseed","seed":["seed","dataless"]},"flographit":"gph","framemaker":["fm","frame","maker","book"],"frogans.":{"fnc":"fnc","ltf":"ltf"},"fujitsu.":{"oasys":"oas","oasys2":"oa2","oasys3":"oa3","oasysgp":"fg5","oasysprs":"bh2"},"fujixerox.":{"ddd":"ddd","docuworks":"xdw","docuworks.binder":"xbd"},"fuzzysheet":"fzs","geogebra.":{"file":"ggb","tool":"ggt"},"geonext":"gxt","geoplan":"g2w","geospace":"g3w","gmx":"gmx","grafeq":["gqf","gqs"],"groove-":{"account":"gac","help":"ghf","injector":"grv","tool-":{"message":"gtm","template":"tpl"},"vcard":"vcg","identity-message":"gim"},"hal+xml":"hal","hbci":"hbci","hp-":{"hpgl":"hpgl","hpid":"hpid","hps":"hps","jlyt":"jlt","pcl":"pcl","pclxl":"pclxl"},"ibm.":{"minipay":"mpy","modcap":["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},"iccprofile":["icc","icm"],"igloader":"igl","immervision-":{"ivp":"ivp","ivu":"ivu"},"intergeo":"i2g","intu.":{"qbo":"qbo","qfx":"qfx"},"jam":"jam","jisp":"jisp","kahootz":["ktz","ktr"],"kde.":{"karbon":"karbon","kchart":"chrt","kformula":"kfo","kivio":"flw","kontour":"kon","kpresenter":["kpr","kpt"],"kspread":"ksp","kword":["kwd","kwt"]},"kenameaapp":"htke","kidspiration":"kia","kinar":["kne","knp"],"koan":["skp","skd","skt","skm"],"lotus-":{"approach":"apr","freelance":"pre","notes":"nsf","organizer":"org","screencam":"scm","wordpro":"lwp","1-2-3":"123"},"mcd":"mcd","medcalcdata":"mc1","mfer":"mwf","mfmp":"mfm","micrografx.":{"flo":"flo","igx":"igx"},"mif":"mif","mobius.":{"daf":"daf","dis":"dis","mbk":"mbk","mqy":"mqy","msl":"msl","plc":"plc","txf":"txf"},"mophun.":{"application":"mpn","certificate":"mpc"},"ms-":{"artgalry":"cil","excel":["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},"fontobject":"eot","htmlhelp":"chm","ims":"ims","lrm":"lrm","outlook":"msg","officetheme":"thmx","pki.":{"seccat":"cat","stl":"stl"},"powerpoint":["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},"project":["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},"works":["wps","wks","wcm","wdb"],"wpl":"wpl","xpsdocument":"xps","cab-compressed":"cab"},"mseq":"mseq","musician":"mus","mynfc":"taglet","nitf":["ntf","nitf"],"noblenet-":{"directory":"nnd","sealer":"nns","web":"nnw"},"nokia.":{"radio-":{"preset":"rpst","presets":"rpss"},"n-gage.":{"data":"ngdat","symbian.install":"n-gage"}},"novadigm.":{"edm":"edm","edx":"edx","ext":"ext"},"osgi.":{"dp":"dp","subsystem":"esa"},"palm":["pdb","pqa","oprc"],"pawaafile":"paw","pg.":{"format":"str","osasli":"ei6"},"picsel":"efif","pocketlearn":"plf","powerbuilder6":"pbd","recordare.":{"musicxml":"mxl","musicxml+xml":"musicxml"},"rn-":{"realmedia":"rm","realmedia-vbr":"rmvb"},"seemail":"see","sema":"sema","semd":"semd","semf":"semf","smaf":"mmf","spotfire.":{"dxp":"dxp","sfs":"sfs"},"stardivision.":{"calc":"sdc","draw":"sda","impress":"sdd","math":"smf","writer":["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip","stepchart":"sm"},"svd":"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},"trueapp":"tra","ufdl":["ufd","ufdl"],"umajin":"umj","unity":"unityweb","uoml+xml":"uoml","vcx":"vcx","visio":["vsd","vst","vss","vsw"],"visionary":"vis","vsf":"vsf","Webd.":{"wbxml":"wbxml","wmlc":"wmlc","wmlscriptc":"wmlsc"},"webturbo":"wtb","wordperfect":"wpd","wqd":"wqd","xara":"xar","xfdl":"xfdl","yamaha.":{"hv-":{"dic":"hvd","script":"hvs","voice":"hvp"},"openscoreformat":"osf","smaf-":{"audio":"saf","phrase":"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},"zul":["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{"aso":"aso","imp":"imp"},"ahead.space":"ahead","airzip.filesecure.":{"azf":"azf","azs":"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{"config":"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml","kmz":"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{"chart":"odc","database":"odb","formula":"odf","graphics":"odg","image":"odi","presentation":"odp","spreadsheet":"ods","text":"odt","text-":{"master":"odm","template":"ott","web":"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{"presentation":"pptx","slide":"sldx","slideshow":"ppsx","template":"potx"},"spreadsheetml.":{"sheet":"xlsx","template":"xltx"},"wordprocessingml.":{"document":"docx","template":"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{"formdata":"ifm","formtemplate":"itp","interchange":"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{"calc":"sxc","draw":"sxd","impress":"sxi","math":"sxm","writer":"sxw","writer.":{"global":"sxg","template":"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{"large":"plb","small":"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{"desktop":"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml","widget":"wgt","winhlp":"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{"abiword":"abw","authorware-":{"bin":["aab","x32","u32","vox"],"map":"aam","seg":"aas"},"bcpio":"bcpio","bittorrent":"torrent","blorb":["blb","blorb"],"bzip":"bz","bzip2":["bz2","boz"],"cbr":["cbr","cba","cbt","cbz","cb7"],"cdlink":"vcd","chat":"chat","conference":"nsc","cpio":"cpio","csh":"csh","director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"doom":"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res","dvi":"dvi","envoy":"evy","eva":"eva","font-":{"bdf":"bdf","ghostscript":"gsf","otf":"otf","pcf":"pcf","snf":"snf","ttf":["ttf","ttc"],"type1":["pfa","pfb","pfm","afm"],"linux-psf":"psf"},"freearc":"arc","futuresplash":"spl","glulx":"ulx","gnumeric":"gnumeric","gtar":"gtar","hdf":"hdf","latex":"latex","mie":"mie","ms-":{"application":"application","shortcut":"lnk","wmd":"wmd","wmz":"wmz","xbap":"xbap"},"msaccess":"mdb","msbinder":"obd","mscardfile":"crd","msclip":"clp","msdownload":["exe","dll","com","bat","msi"],"msmediaview":["mvb","m13","m14"],"msmetafile":["wmf","wmz","emf","emz"],"msmoney":"mny","mspublisher":"pub","msschedule":"scd","msterminal":"trm","mswrite":"wri","netcdf":["nc","cdf"],"nzb":"nzb","pkcs12":["p12","pfx"],"pkcs7-":{"certificates":["p7b","spc"],"certreqresp":"p7r"},"sh":"sh","shar":"shar","sql":"sql","stuffit":"sit","stuffitx":"sitx","subrip":"srt","sv4cpio":"sv4cpio","sv4crc":"sv4crc","tads":"gam","tar":"tar","tcl":"tcl","tex":"tex","texinfo":["texinfo","texi"],"tgif":"obj","ustar":"ustar","xfig":"fig","xliff+xml":"xlf","xpinstall":"xpi","xz":"xz","zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],"xml":["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],"yang":"yang","yin+xml":"yin","zip":"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{"adpcm":"adp","basic":["au","snd"],"midi":["mid","midi","kar","rmi"],"mp4":["m4a","mp4a"],"mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"ogg":["oga","ogg","spx"],"s3m":"s3m","silk":"sil","vnd.":{"dra":"dra","dts":"dts","nuera.":{"ecelp4800":"ecelp4800","ecelp7470":"ecelp7470","ecelp9600":"ecelp9600"},"rip":"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},"webm":"weba","x-":{"aac":"aac","aiff":["aif","aiff","aifc"],"caf":"caf","flac":"flac","matroska":"mka","mpegurl":"m3u","ms-":{"wax":"wax","wma":"wma"},"pn-":{"realaudio":["ram","ra"],"realaudio-plugin":"rmp"},"wav":"wav"},"xm":"xm"},"image/":{"bmp":"bmp","cgm":"cgm","g3fax":"g3","gif":"gif","ief":"ief","jpeg":["jpeg","jpg","jpe"],"ktx":"ktx","png":"png","sgi":"sgi","svg+xml":["svg","svgz"],"tiff":["tiff","tif"],"vnd.":{"djvu":["djvu","djv"],"dwg":"dwg","dxf":"dxf","fastbidsheet":"fbs","fpx":"fpx","fst":"fst","ms-":{"modi":"mdi","photo":"wdp"},"xiff":"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{"mmr":"mmr","rlc":"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},"webp":"webp","x-":{"3ds":"3ds","cmx":"cmx","freehand":["fh","fhc","fh4","fh5","fh7"],"icon":"ico","pcx":"pcx","pict":["pic","pct"],"portable-":{"anymap":"pnm","bitmap":"pbm","graymap":"pgm","pixmap":"ppm"},"rgb":"rgb","tga":"tga","xbitmap":"xbm","xpixmap":"xpm","xwindowdump":"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{"iges":["igs","iges"],"mesh":["msh","mesh","silo"],"vnd.":{"collada+xml":"dae","dwf":"dwf","gdl":"gdl","gtw":"gtw","mts":"mts","vtu":"vtu"},"vrml":["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{"calendar":["ics","ifb"],"css":"css","csv":"csv","html":["html","htm"],"n3":"n3","plain":["txt","text","conf","def","list","log","in"],"richtext":"rtx","sgml":["sgml","sgm"],"troff":["t","tr","roff","man","me","ms"],"turtle":"ttl","vcard":"vcard","vnd.":{"curl":"curl","curl.":{"dcurl":"dcurl","mcurl":"mcurl","scurl":"scurl"},"fly":"fly","graphviz":"gv","in3d.":{"3dml":"3dml","spot":"spot"},"wap.":{"wml":"wml","wmlscript":"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{"asm":["s","asm"],"c":["c","cc","cxx","cpp","h","hh","dic"],"fortran":["f","for","f77","f90"],"nfo":"nfo","opml":"opml","pascal":["p","pas"],"setext":"etx","sfv":"sfv","uuencode":"uu","vcalendar":"vcs","vcard":"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2","h261":"h261","h263":"h263","h264":"h264","jpeg":"jpgv","jpm":["jpm","jpgm"],"mj2":["mj2","mjp2"],"mp4":["mp4","mp4v","mpg4"],"mpeg":["mpeg","mpg","mpe","m1v","m2v"],"ogg":"ogv","quicktime":["qt","mov"],"vnd.":{"dece.":{"hd":["uvh","uvvh"],"mobile":["uvm","uvvm"],"pd":["uvp","uvvp"],"sd":["uvs","uvvs"],"video":["uvv","uvvv"]},"fvt":"fvt","mpegurl":["mxu","m4u"],"vivo":"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},"webm":"webm","x-":{"f4v":"f4v","fli":"fli","flv":"flv","m4v":"m4v","matroska":["mkv","mk3d","mks"],"mng":"mng","ms-":{"asf":["asf","asx"],"vob":"vob","wm":"wm","wmv":"wmv","wmx":"wmx","wvx":"wvx"},"msvideo":"avi","smv":"smv","sgi-movie":"movie"}},"chemical/x-":{"cdx":"cdx","cif":"cif","cmdf":"cmdf","cml":"cml","csml":"csml","xyz":"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}')},62129:e=>{"use strict";e.exports=JSON.parse('{"prefixHash":"ca4d318e0a1519cffe6030ba0fbd2bf1"}')},35613:e=>{"use strict";e.exports=JSON.parse('{"":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}')},43756:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n=[["","Open the product context menu","Turn off send as sticker","Turn on send as sticker","__count__ @ message","Changing __count__ label","The label could not be updated","__count__ label changed","Couldn't block __participant__","__participant__ blocked","Blocking __participant__","Couldn't delete broadcast list.","Broadcast list deleted","Deleting broadcast list","Couldn't archive chat.","Chat archived","Archiving chat","Couldn't clear chat.","Chat cleared","Clearing chat","Couldn't delete chat.","Chat deleted","Deleting chat","Couldn't mark chat as read.","Couldn't mark chat as unread.","Marked as read","Marked as unread","Marking as read","Marking as unread","Couldn't mute chat.","Chat muted","Muting chat","Couldn't pin chat","You can only pin up to 3 chats.","Chat pinned","Pinning chat","Couldn't unarchive chat.","Chat unarchived","Unarchiving chat","Unmute","Couldn't unmute chat.","Chat unmuted","Unmuting chat","Couldn't unpin chat","Chat unpinned","Unpinning chat","Deleting label: __labelName__","Couldn't create group.","Please enter a shorter subject.","Can't add more than __max__ participants","Created group","Creating group","Couldn't delete group.","Group deleted","Deleting group","Couldn't exit group.","Exited group","Exiting group","Couldn't remove group icon.","Group icon removed","Removing group icon","Group icon set","Couldn't set group icon.","Setting group icon","Couldn't mute group.","Group muted","Muting group","Couldn't rename group.","Group renamed to __subject__","Renaming group","Group subject can't be empty","Couldn't unmute group.","Group unmuted","Unmuting group","Stop sharing live location with __name__?","Stop sharing live location with __name__?","Marking as not spam","Couldn't mark as not spam","Marked as not spam","Couldn't delete message because the message may have expired","Couldn't delete message","__count__ message deleted","Deleting message","Couldn't star message because the message may have expired","Couldn't star message","__count__ message starred","Starring message","Couldn't unstar all messages","Couldn't unstar message because the message may have expired","Couldn't unstar message","__count__ message unstarred","All messages unstarred","Unstarring message","Unstarring all messages","Failed to add label: __labelName__","Label: __labelName__ added successfully","Couldn't add __participantNames__.","You added __participantNames__.","Adding __participantNames__.","Removing __participantNames__ as an admin failed.","You can't dismiss __participant__ as admin because they created this group.","__participantNames__ is no longer a group admin.","Removing __participantNames__ as a group admin.","They are no longer in this group.","You can't add this participant because they left the group recently.","Couldn't make __participantNames__ an admin.","__participantNames__ is now a group admin.","Making __participantNames__ a group admin.","Couldn't remove __participantNames__.","You can't remove __participant__ because they created this group.","You removed __participantNames__.","Removing __participantNames__.","Couldn't remove profile photo.","Profile photo removed","Removing profile photo","Profile photo set","Couldn't set profile photo.","Setting profile photo","Your name can't be empty","Your name changed","Couldn't change your name.","Changing your name","Reporting spam","Couldn't report spam","Reported spam","About can't be empty","About changed","Couldn't change About.","Changing About","Try again.","Couldn't unblock __participant__","__participant__ unblocked","Unblocking __participant__","Undo","Add a caption","Blocked contacts will no longer be able to call you or send you messages","Add blocked contact","Add to a group","Add group icon","Add profile photo","Drag the image to adjust","Only __admins__ can send messages","Archive chat","No archived chats","Archived chats","Document","__count__ Page","Contact","__number__ audio file you tried adding has no content.","Your browser doesnt support audio playback.","__number__ audio you tried adding is larger than the __maxSize__ limit.","Using __deviceName__ as your __deviceType__ for your WhatsApp calls",'"__businessName__" registered as a business account, but WhatsApp hasnt verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This official business account changed its name to "__businessName__". Click for more info.','WhatsApp has verified that this official business account changed its name and now uses the name "__businessName__".',"__businessName__ used other companies to store and manage this message.","__businessName__ used Facebook and other companies to store and manage this message.","This message was delivered directly from __businessName__.","This message was delivered directly to __businessName__.","__businessName__ used Facebook to store and manage this message.",'"__businessName__" registered as a business account, but WhatsApp hasnt verified their name yet.','This chat is with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','WhatsApp has verified that this is the official business account of "__businessName__". This account is saved with a different name in your address book.','This chat is now with the official business account of "__businessName__". Click for more info.','WhatsApp has verified that this is the official business account of "__businessName__".','This chat is no longer with the official business account of "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the official business account of "__businessName__".',"Block","Block __contact__? Blocked contacts will no longer be able to call you or send you messages.","List of contacts that you have blocked","No blocked contacts yet","Blocked contacts","WhatsApp secures messages while they're being delivered to and from the companies that store and manage this chat for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__. Contact __businessName__ for more information on their privacy practices.","WhatsApp secures messages while they're being delivered to and from Facebook, where this chat is stored and managed for __businessName__.","__businessName__ is registered as a business account.","__businessName__ is registered as an official business account.","__businessName__ is registered as an official business account. The business is saved as a different name in your contacts.","This chat is with the official business account of __businessName__.","This chat is with the official business account of __businessName__. The business is saved as a different name in your contacts.","__businessName__ is now registered as a business account, instead of an official business account.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook or other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now only uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook or other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ no longer uses other companies to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses other companies to manage its WhatsApp conversations. Click to learn more.","__businessName__ is now registered as a business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as a business account. Click to learn more.","__businessName__ now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ no longer uses Facebook to manage its WhatsApp conversations.","__businessName__ is now registered as an official business account. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business now uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. This business no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","This chat is with the official business account of __businessName__. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official business account of __businessName__, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__, but it's saved as a different name in your contacts. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","This chat is with the official account of __businessName__. This account uses Facebook to manage its WhatsApp conversations. Click to learn more about privacy in this chat.","__businessName__ is no longer an official business account. This business uses other companies instead of Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it no longer uses Facebook to manage its WhatsApp conversations. Click to learn more.","__businessName__ now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","This chat is with the official business account of __businessName__. Click to learn more.","__businessName__ now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as a business account.","__businessName__ now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account that uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account, but it's saved as a different name in your contacts. This business uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is now registered as an official business account. Click to learn more.","__businessName__ is no longer an official business account. This business now uses Facebook and other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses other companies to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer an official business account and it now uses Facebook to manage its WhatsApp conversations. Click to learn how this changes privacy in this chat.","__businessName__ is no longer registered as an official business account. Click to learn more.","Broadcast list deleted","Browser not supported","__closed__, opens at __time__","End Time","Start Time","__open__ 24 hours","__openTime__ - __closeTime__ and __additionalOpenTime__ - __additionalCloseTime__","__open__ by appointment only","__open__ until __time__","__open__ until __time__, __additionalOpenTime__ - __additionalCloseTime__","This verified business is not in your contact list.","__streetAddress__, __city__","__streetAddress__, __city__ __zipCode__","Confirmed as __businessName__","End Time","This name will be visible to your WhatsApp customers and can be edited from the app on your mobile device.","Something went wrong","An error occurred while saving.  Please try again.","__verified__ as __businessName__","Use Here","__count__ message couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.","__count__ message couldn't be forwarded because the file is missing.","__count__ message couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.","Can't Load WhatsApp","Qty __quantity__","Received cart","__updated__ Item Updated","By using this feature, you're using a __fb_product_link__ and agree that the __fb_commerce_link__ and __wa_commerce_policy_link__ apply.","If you feel this is not correct, you can __request_review_link__.","We reviewed this item again and found it didn't follow product or service guidelines. __learn_more_link__.","This item wasn't approved because it doesn't follow our product or service guidelines. __learn_more_link__.","This item is being reviewed. If its been approved, your customers will be able to see it on your profile. __learn_more_link__.","This item is being reviewed. You hid it, so customers wont see it in your catalog when its approved. __learn_more_link__.","Turn this on to let customers add items to a cart when shopping in your catalog. Turning this off won't affect carts you've already received. __learn_more_link__","View __catalogOwnerName__'s Catalog on WhatsApp","__productName__ from __catalogOwnerName__ on WhatsApp.","View all","Change group icon","__name__ changed their phone number. You're currently chatting with their new number.","__name__ changed their phone number to a new number.","__name__ changed their phone number to a new number. Click to message the new number.","Change profile photo","Charge your phone to keep using WhatsApp","Archived","You are not an admin","Search for messages within __chatName__.","No Internet connection","Clear messages","click here for group info","click here for contact info","Update WhatsApp","Click to reload QR code","Click to save, ESC to cancel","Click to update WhatsApp","Close chat","__count__ item","This collection wasn't approved because its name violates __collections_rejected_policy_adult__","This collection wasn't approved because its name violates __collections_rejected_policy_alcohol__","This collection wasn't approved because its name violates __collections_rejected_policy_animals__","This collection wasn't approved because its name violates __collections_rejected_policy_body_parts_fluids__","This collection wasn't approved because its name violates __collections_rejected_policy_community_standards__","This collection wasn't approved because its name violates __collections_rejected_policy_digital_services_products__","This collection wasn't approved because its name violates __collections_rejected_policy_discrimination__","This collection wasn't approved because its name violates __collections_rejected_policy_drugs__","This collection wasn't approved because its name violates __collections_rejected_policy_gambling__","This collection wasn't approved because its name violates __collections_rejected_policy_hazardous_goods_and_materials__","This collection wasn't approved because its name violates __collections_rejected_policy_healthcare__","This collection wasn't approved because its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__","This collection wasn't approved because its name violates __collections_rejected_policy_illegal_products__","This collection wasn't approved because its name violates __collections_rejected_policy_misleading__","You can __rename_collection_link__ or __request_another_review_link__.","This collection wasn't approved because its name violates __collections_rejected_policy_other_violation__","This collection wasn't approved because its name violates __collections_rejected_policy_overtly_sexualized_positioning__","This collection wasn't approved because its name violates __collections_rejected_policy_real_fake_currency__","This collection wasn't approved because its name violates __collections_rejected_policy_stolen_goods__","This collection wasn't approved because its name violates __collections_rejected_policy_supplements__","This collection wasn't approved because its name violates __collections_rejected_policy_thrid_party_infringements__","This collection wasn't approved because its name violates __collections_rejected_policy_tobacco__","This collection wasn't approved because its name violates __collections_rejected_policy_unauthorized_media__","This collection wasn't approved because its name violates __collections_rejected_policy_weapons__","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_adult__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_alcohol__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_animals__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_body_parts_fluids__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_community_standards__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_digital_services_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_discrimination__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_drugs__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_gambling__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_hazardous_goods_and_materials__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_healthcare__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_human_exploitation_and_sexual_services__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_illegal_products__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_misleading__.","You can __rename_collection_link__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_other_violation__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_overtly_sexualized_positioning__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_real_fake_currency__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_stolen_goods__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_supplements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_thrid_party_infringements__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_tobacco__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_unauthorized_media__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_weapons__.","","Add __participant__ to __subject__ group?","Add __participants__ to __subject__ group?","You are closing WhatsApp.","Some messages cant be forwarded, do you want to forward rest of the messages?","Can't forward all messages","Forward to __chat__?","Log out?","Make __participant__ an admin for __subject__ group?","Remove __participant__ from __subject__ group?","Send __count__ contact to __chat__?","Send __count__ contact to __chat__?","Send __count__ contact to __chat__?","Unblock __chat__ and forward messages?","Unblock __contact__","Unmute this chat?","Unmute this group?","Connecting","Connecting to WhatsApp","Connecting","Block __contact__","__number__ group in common","About and phone number","Unblock __contact__","Loading About","View contact","__number__ contact that you tried to add has no content.","The contact that you tried to add is larger than the __maxSize__ limit.","Older messages may be available","Use WhatsApp on your phone to search messages from before __date__.","Use WhatsApp on your phone to see the complete chat history.","Search for messages with __chatName__.","WhatsApp message","Default","Delete chat","Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete this label?","Delete message","Delete message?","Tell us about your issue","Please Update WhatsApp","New version available","Desktop Settings","Update","To continue using WhatsApp, click Update and install the latest version.","Couldn't Update Automatically","Downloading an update to WhatsApp. This may take several minutes. WhatsApp will automatically update and restart when the download finishes.","Updating WhatsApp","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after theyre sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after theyre sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after theyre sent. Click to learn more.","Dismiss","Docs","__count__ Doc","__name__ downloaded.","__number__ document you tried adding has no content.","__number__ document you tried adding is larger than the __maxSize__ limit.","End-to-end encrypted","Edit","Add text to your image","Turn on desktop notifications","& ","  ",", ","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","__name__ turned off disappearing messages.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","__name__ turned off disappearing messages. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","Turning on this setting will make new messages disappear from this chat after 7 days. Recipients can still save these messages elsewhere.","Turning on this setting will make new messages disappear from this chat after a selected amount of time. Recipients can still save these messages elsewhere.","All new messages will disappear from this chat __number__ day after they're sent.","All new messages will disappear from this chat __number__ hour after they're sent.","All new messages will disappear from this chat __number__ minute after they're sent.","All new messages will disappear from this chat __number__ second after they're sent.","Anyone in this chat can change this setting.","Group admins control who can change this setting.","This message will disappear from this chat __number__ day after they're sent.","This message will disappear from this chat __number__ hour after they're sent.","This message will disappear from this chat __number__ minute after they're sent.","This message will disappear from this chat __number__ second after they're sent.","Off","On","__number__ day","__number__ hour","__number__ minute","__number__ second","Wait until the message finishes sending and displays a checkmark before forwarding.","Wait until this message is fully delivered before forwarding.","Unable to forward unsent message.","Cant Forward","__number__ file you tried adding has no content.","__count__ file failed to be downloaded because it's no longer on your phone.","__number__ file could not be added.","__number__ file you tried adding is not supported.","__number__ file you tried adding is larger than the __maxSize__ limit.","B","GB","kB","MB","Forward","You can only share with up to __count__ chat","Forwarded many times. You can only share with up to __count__ chat.","Forward message","Forward message to","Forwarded __count__ time","Found a contact card for this number. View contact card?","Older results may be available","Microsoft Edge","Google Chrome","Mozilla Firefox","Opera","Safari (macOS 11+ Only)","Custom GIF animations are currently not supported. Please use provided GIF selection feature.","Incoming calls off. Click to restore.","Alerts and sounds off. Click to restore.","Notifications enabled","You were added by someone who's not in your contacts","Group deleted","Cancel","Checking invite link","__count__ contact","Join group","Anyone with WhatsApp can follow this link to join this group. Only share it with people you trust.","__count__ participant","You can't view this group's invite link because you're not an admin.","This invite link doesn't match any WhatsApp groups.","Are you sure you want to reset the invite link for __groupName__? If you reset the link, no one will be able to use it to join this group.","Resetting the invite link for __groupName__.","Send link to","Joining group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Joining group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't join group","Viewing and revoking group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Viewing and revoking group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't view group invite details",'"__A__"','__A__"__B__" & "__C__"','"__A__," __B__','"__A__" & "__B__"',"Group muted","Type contact name","__count__ other","View all (__more__)","__count__ more","Group Subject","__number__ invited","Couldn't add __participant__. You can invite them privately to join this group.","Reset invite for __participant__? If you reset the invite, __participant__ won't be able to use it to join this group.","To take photos, WhatsApp needs access to your computer's camera. Click __chrome_media_error__ in the URL bar and choose Always allow web.whatsapp.com to access your camera.","To take photos, WhatsApp needs access to your computers camera. Click __firefox_lock__ in the URL bar and set Use the Camera to Allow.","To take photos, WhatsApp needs access to your computers camera. Click __opera_media__ in the URL bar and click Clear This Setting and Reload.","You cant take a photo because it looks like your computer doesnt have a camera. Try connecting one or if you have one connected, try restarting your browser.","Camera Not Found","Allow camera","To record Voice Messages, WhatsApp needs access to your microphone. Click __chrome_media_error__ in the URL bar and choose Always allow web.whatsapp.com to access your microphone.","To record Voice Messages, WhatsApp needs access to your computers microphone. Click __firefox_lock__ in the URL bar and set Use the Microphone to Allow.","To record Voice Messages, WhatsApp needs access to your computers microphone. Click __opera_media__ in the URL bar and click Clear This Setting and Reload.","You cant record a Voice Message because it looks like your computer doesnt have a microphone. Try connecting one or if you have one connected, try restarting your browser.","Microphone Not Found","Allow microphone","Help","Message from __author__","__unreadCount__ New Message","You'll be logged out after several minutes of inactivity","__number__ image you tried adding has no content.","__number__ image you tried adding is larger than the __maxSize__ limit.","Check your phone to answer","WhatsApp group video call from __name__","WhatsApp group voice call from __name__","WhatsApp video call from __name__","WhatsApp voice call from __name__","WhatsApp connects to your phone to sync messages. To reduce data usage, connect your phone to Wi-Fi.","With this update, your phone wont need to stay online to use WhatsApp on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","With this update, your phone wont need to stay online to use WhatsApp Business on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","WhatsApp is available for Mac. __get_it_here__.","Make calls from desktop with WhatsApp for Mac. __get_it_here__.","WhatsApp is available for Windows. __get_it_here__.","Make calls from desktop with WhatsApp for Windows. __get_it_here__.","Keep your phone connected","Expires at __time__","Expires in __number__ day","__count__ item","Price __currencySymbol__ (Optional)","Search in __labelName__...","Learn more","Links","__count__ Link","Accurate to __accuracy__ M","__count__ people","Last updated __date__ at __time__","Last updated today at __time__","Last updated __date__ at __time__","Last updated yesterday at __time__","Live until __time__","__hours__h left","__hours__h __minutes__m left","__minutes__m left","__sharers__ is sharing live location","__name__ is sharing live location","__count__ person is sharing live location","You are sharing live location","You and __name__ are sharing live location","You and __count__ other person are sharing live location","__name__ stopped sharing","Updated __hours__h ago","Updated __hours__h __minutes__m ago","Updated __minutes__m ago","load earlier messages","load recent messages","Loading","loading messages","Log in","Menu __android_menu_icon__","Need help to get started?","Settings __iphone_settings_icon__","Tap __android_menu__ or __iphone_settings__ and select __whatsapp_web_menu_item__","Tap on __login_step_3_md_link_device__","WhatsApp Web","More than 1GB storage usage detected. Please be aware that remaining storage is low.","Low storage warning","Make sure your computer has an active Internet connection.","Manage","Mark as read","Mark as unread","Downloading messages: __progress__%","This version will expire today at __time__. Update to use WhatsApp Web without keeping your phone online.","This version will expire today at __time__. Update to use WhatsApp Desktop without keeping your phone online.","Media","Add a caption","This file was changed from original.","Blocked","Help","Keep me signed in","Log out","Make group admin","Notifications","Profile","Profile","Remove","Settings","Attach","Menu","This audio is too large. You can send audio up to __maxSize__.","Message __author__","This document is too large. You can send documents up to __maxSize__.","This file is too large. You can send files up to __maxSize__.","This image is too large. You can send images up to __maxSize__.","Message info","Delivered","Delivered to","Played","Played by","Read","Read by","__count__ remaining","Couldn't find message","The message youre pasting is too long. Try shortening it or sending it in multiple parts.","Message Too Long","This video is too large. You can send videos up to __maxSize__.","Cant play this Voice Message because it's no longer on your phone.","Voice Message Unavailable","Cant download this document because it's no longer on your phone.","Document Unavailable","Cant view this GIF because it's no longer on your phone.","GIF Unavailable","Media Message Unavailable","Cant view this photo because it's no longer on your phone.","Photo Unavailable","Cant play this video because it's no longer on your phone.","Video Unavailable","Phone number shared via url is invalid.","Send message to","__contactName__ and __count__ other contact","__count__ contact","You can only send up to __count__ contact","Mute __name__ for","__A__, __B__","__A__, and __B__","__A__, __B__","__A__ and __B__","Archive Chat","WhatsApp needed to restart because of a problem.","Problem Detected","Delete Chat","Delete Group","Exit Group","Log Out","Mark as Read","Mark as Unread","Chat","Help","Terms and Privacy Policy","Next Chat","Previous Chat","Window","Bring All to Front","Minimize","Zoom","Mute","New Chat","New Group","Profile and About","Unarchive Chat","Cancel Mute","This video is unavailable. Please try again.","New chat","New group","Next","No contacts","No Docs","No groups","No Links","No Media","No result found for '__labelName__'","No starred messages","Not spam","Notifications","__number__ of __totalNumber__","+__number__","OK, got it","Start WhatsApp at Login","Desktop Alerts","Show Previews","Display message text in desktop alerts","Sounds","Order Detail","Your Order","__subtotal__ (estimated)","Qty __quantity__","__total__ (estimated total)","Already blocked","Order #__order__","Update now to use WhatsApp Web on other devices without keeping your phone online.","WhatsApp is open on another computer or browser. Click Use Here to use WhatsApp in this window.","Pin chat","Waiting for this message. This may take a while.","Previous","__count__ contact excluded","__count__ Product","This photo is too small. Please select a photo with height and width of at least __size__ pixel.","Couldn't send this Voice Message.","","This is not your username or pin. This name will be visible to your WhatsApp contacts.","__pinEmoji__ __address__","Group  __groupName__","All","Reconnect","Remove","Remove this group's icon?",'Remove label "__labelName__" from __count__ item',"Remove photo","Remove your profile photo?","Report __contactInfo__","Report spam","Click to resend","Retry Now","Retrying","Retrying in __duration__","Retrying in __number__ second","Save","Scan Database Usage","Search","Search contacts","Search Emoji","Search GIFs via __service__","Search groups","Search Messages","No chats, contacts or messages found","No contacts found","No groups found","No messages found","No results found for '__keyword__'","Search or start new chat","Looking for chats, contacts or messages","Looking for messages","Learn which chats are end to end encrypted","Show security notifications","See __count__ archived chat","__count__ selected","Photo set to send as sticker","Send contact","Send contacts","send","Feedback/Question about WhatsApp","Email address","Confirm email address","Please enter a valid email address","The email addresses do not match","Subject","Feedback sent","Please enter a subject.","Contact us","__count__ Screenshot Maximum","Please add more to your description","To verify, send a message to __name__ and try again.","The sender is not in your contact list","Settings","__days__d","__hours__h","__minutes__m","__seconds__s","Some of your messages are still sending.","Star message","No starred messages","Starred messages","Created by __name__","Subject","This group is no longer available. Please contact __support__ for help.","__count__ suspicious link","Take photo","You'll be able to use WhatsApp again in __duration__","You're temporarily banned from WhatsApp because you sent too many messages to people who dont have __phone__ in their address books.","You're temporarily banned from WhatsApp because you created too many groups with people who dont have __phone__ in their address books.","__time__ left","Maximum number of files uploaded. __number__ file has been ignored.","Trying to reach phone","Turn off all desktop notifications for:","Unarchive chat","Unblock","Unblock __contact__?","Unblock Contact","Unpin chat","__count__ @ message not synced","__count__ unread message","Unstar","Unstar all messages?","Unstar message","Until __date__ at __time__","Until today at __time__","Until tomorrow at __time__","Until __day__ at __time__","Untitled","Download Microsoft Edge","Update Google Chrome","Update Mozilla Firefox","Update Safari","WhatsApp is out of date. Updating now","Updating","Your phone will no longer need to stay online to use WhatsApp on web, desktop or other devices. __learn_more__","Your phone will no longer need to stay online to use WhatsApp Business on web, desktop or other devices. __learn_more__","Upload photo","__participants__ joined using your invite","You invited __participants__","Version __version__","__number__ video you tried adding has no content.","Your browser doesnt support video playback.","__number__ video you tried adding is larger than the __maxSize__ limit.","View Contact Card","This view once photo has expired. Please ask __name__ to re-send it.","This view once video has expired. Please ask __name__ to re-send it.","View photo","Viewed by __count__","Stop screen sharing","Start screen sharing","You can turn on your camera after __callee__ answers","Your call will end in a few seconds because your microphone and sound output device were disconnected.","Your call will end in a few seconds because your microphone was disconnected.","__name__'s camera and mic are off","__name__'s camera is off","__name__'s mic is muted","__name__ is requesting to switch to a video call","Your call will end in a few seconds because your sound output device was disconnected.","You can turn off your camera after __callee__ answers","Please contact us with the make and model of your camera. ","Call cannot be placed for more than __count__ participant","You can only call up to __count__ contact","__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.","__count__ others","__callee__ is in a country where WhatsApp Calling is unavailable","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is unable to receive WhatsApp calls at this time.","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is not registered on WhatsApp","Couldn't place call: __callee__ is unable to receive WhatsApp video calls at this time.","WhatsApp will use your computer's camera for video calls and taking photos. You can always change this later in your computer's settings.","WhatsApp will use your computer's microphone for calls and voice messages. You can always change this later in your computer's settings.","__contactName__ - WhatsApp voice call","__contactName__ - WhatsApp video call","Chat wallpaper set","Set Chat Wallpaper","Your security code with __contactName__ changed because there was a login on a new device of theirs.","Your security code with __contactName__ changed because you logged into a new device.","Your security code with __contactName__ changed because there was a login on a new device of yours.","Your security code with __contactName__ changed because there was a login on this device.",'WhatsApp has verified that this is the official business account of "__businessName__".',"WhatsApp has verified that this is the official business account of __businessName__. This account is saved with a different name in your contacts.","Your security code could not be verified with __contactName__. Click to learn more.","Verify your security code with __contactName__ because there was an error with their list of linked devices.","You can't send messages to this group because you're no longer a participant.","Can't send a message to blocked contact __contact__.","Your security code with __contactName__ changed because there was a login or logout from one or more of their devices.","Your security code with __contactName__ changed because there was a login or logout from one or more of your devices.","Muted","Messages to this chat are secured with end-to-end encryption. __businessName__ may use another company to store, read and respond to your messages. Click to learn more.","online","last seen __date__ at __time__","last seen today at __time__","last seen __date__ at __time__","last seen yesterday at __time__","__participant__ is typing","__participant__ is recording audio","Audio","Contact","__count__ page","Document","Photo","Location","Video","Voice message","Delete group","Delete broadcast list","Download __name__","Exit","Frequently Contacted","__name__ changed this group's settings to allow all participants to send messages to this group.","__name__ changed this group's settings to allow only admins to send messages to this group.","__name__ created group __subject__","__name__ created this group","An admin created group __subject__","You created group __subject__","You created this group","Created __date__ at __time__","Created __date__ at __time__","Group created by __name__, on __date__ at __time__","Group created by you, on __date__ at __time__","Created today at __time__","Created today at __time__","Group created by __name__, today at __time__","Group created by you, today at __time__","Created __day__ at __time__","Created __day__ at __time__","Created yesterday at __time__","Created yesterday at __time__","Group created by __name__, yesterday at __time__","Group created by you, yesterday at __time__","__name__ changed the group description. Click to view.","__name__ changed the group description.","__name__ reset this group's invite link. Click to view the new invite link.","__name__ changed this group's settings to allow messages that have been forwarded many times.","__name__ changed this group's settings to not allow messages that have been forwarded many times.","__name__ was added","__name__ changed their phone number to a new number.","__name__ changed to __new_number__","__participants__ is no longer an admin","__name__ joined via an invite link","You joined via an invite link","__name__ left","__participants__ is now an admin","__name__ was removed","__name__ added __participants__","__name__ added you","__name__ removed __participants__","__name__ removed you","A participant added __participants__","A participant removed __participants__","You added __participants__","You removed __participants__","__name__ changed this group's settings to allow all participants to edit this group's info.","__name__ changed this group's settings to allow only admins to edit this group's info.","__name__ changed the subject to __subject__","A participant changed the subject to __subject__","You changed the subject to __subject__","__num__ invite sent","Groups","Groups in common","Messages to this chat and calls are secured with end-to-end encryption, which means that WhatsApp and third parties cant read or listen to them. __businessName__ may use a service to store, read and respond to your messages and calls. Contact __businessName__ for information on their privacy practices.","__name__ added to the list","__name__ removed from the list","__name__ and possibly other group participants are using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message this group.","__name__ is using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message them.","This happened likely because __contactName__ or you recently changed which devices you use WhatsApp on. Please verify the security code again.","Your security code with __contactName__ changed","To verify that messages and calls with __contactName__ are end-to-end encrypted, open this screen on your phone, and follow the instructions.","To verify that messages and calls with __contactName__ are end-to-end encrypted, scan or upload this code on their device. You can also compare the number above instead.","About","Messages","Missed group video call at __time__","Missed group voice call at __time__","Missed video call","Missed video call at __time__","Missed voice call","Missed voice call at __time__","The business account for __businessName__ has registered as a standard user account and may no longer belong to the business.","Other contacts","__count__ participant","To receive a payment from __senderName__, set up your payment account on your phone.","__contactName__ canceled their payment request for __currencyAndAmount__","You canceled your payment request to __contactName__ for __currencyAndAmount__","__contactName__ declined your payment request for __currencyAndAmount__.","You declined __contactName__'s payment request for __currencyAndAmount__.","__senderName__'s payment request for __currencyAndAmount__ to you expired.","Your payment request to __receiverName__ for __currencyAndAmount__ expired.","You notified __receiverName__ that you are trying to send a payment.","You can now send __receiverName__ a payment.","__invitee__ has set up payments","You invited __otherUser__ to use payments","__otherUser__ invited you to use payments","Requested from __receiverName__","Requested __amount__ from You","__senderName__ requested __amount__ from You","__senderName__ requested __amount__ from __receiverName__","Sent __amount__ to You","__senderName__ sent __amount__ to You","__senderName__ sent __amount__ to __receiverName__","Sent to __receiverName__","Pending (expires __timeSpan__)","__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.","__senderName__'s payment __relativeTime__ is complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__  was refunded __relativeTime__.","on __date__","__name__ changed this group's icon","You changed this group's icon","__name__ deleted this group's icon","You deleted this group's icon","Preview","OFFICIAL ANNOUNCEMENTS","Recent chats","__count__ recipient","Your security code with __contactName__ changed because there was a logout from one of their devices.","Your security code with __contactName__ changed because there was a logout from one of your devices.","Your security code with __contactName__ changed. Click to learn more.","Your security code with __name__ changed because there was a registration on a new device of theirs.","Your security code with __name__ changed because there was a registration on a new device of yours.","Select messages",'WhatsApp has verified that this is the official business account of "__businessName__". This business uses WhatsApp Business, which allows them to add their opening hours, address, website and catalog of products or services.','This chat is with the verified business account for "__businessName__". Click for more info.','This chat is with the business account for "__businessName__". Click for more info.',"__businessName__ may be a business account, but WhatsApp hasnt verified their name yet.",'The business account youre chatting with is now verified as "__businessName__". Click for more info.','The business account youre chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account youre chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account youre chatting with is no longer confirmed as "__businessName__". Click for more info.','WhatsApp is no longer able to confirm that this is the account for "__businessName__".','This account has registered as a business account and WhatsApp has confirmed that this is the account for "__businessName__".',"__businessName__ registered as a business account, but WhatsApp hasnt verified their name yet.",'The business account you\'re chatting with belongs to "__businessName__".',"To chat with __contact__, review and accept WhatsApps updated terms and privacy policy on your phone.","__date__ at __time__","today at __time__","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.",'You opened "Verify security code" for the wrong phone number. Open it for the correct number to verify __contact__.','__contact__ opened "Verify security code" for the wrong phone number. Ask __contact__ to open it for your phone number.',"yesterday at __time__","You","You created a broadcast list with __count__ recipient","To use WhatsApp, update __chrome_update__ or use __firefox_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Google Chrome __min_version_chrome__+","To use WhatsApp, update __edge_homepage__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","WhatsApp works with Microsoft Edge __min_version_edge__+","To use WhatsApp, update __firefox_update__ or use __chrome_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Mozilla Firefox __min_version_firefox__+","WhatsApp group invite","WhatsApp","To use WhatsApp, update __safari_update__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","To use all of WhatsApp's features like photo capturing and Voice Message recording, we recommend using __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","Using Safari","WhatsApp works with Safari __min_version_safari__+","WhatsApp","Send and receive WhatsApp messages right from your computer.","WhatsApp is open in another window. Click Use Here to use WhatsApp in this window.","Quickly send and receive WhatsApp messages right from your computer.","We recommend using WhatsApp with one of the following browsers:","WhatsApp also supports:","You can't add more than __count__ labels","Go to Commerce Manager to update your shop."],{4:"__count__ @ messages",5:"Changing __count__ labels",6:"Some labels could not be updated",7:"__count__ labels changed",79:"Couldn't delete __count__ messages because the messages may have expired",80:"Couldn't delete messages",81:"__count__ messages deleted",82:"Deleting messages",83:"Couldn't star messages because the messages may have expired",84:"Couldn't star messages",85:"__count__ messages starred",86:"Starring messages",88:"Couldn't unstar messages because the messages may have expired",89:"Couldn't unstar messages",90:"__count__ messages unstarred",92:"Unstarring messages",96:"Couldn't add __participantNames__.",97:"You added __participantNames__.",98:"Adding __participantNames__.",99:"Removing __participantNames__ as admins failed.",101:"__participantNames__ are no longer group admins.",102:"Removing __participantNames__ as group admins.",103:"They are no longer in this group.",104:"You can't add these participants because they left the group recently.",105:"Couldn't make __participantNames__ admins.",106:"__participantNames__ are now group admins.",107:"Making __participantNames__ group admins.",108:"Couldn't remove __participantNames__.",110:"You removed __participantNames__.",111:"Removing __participantNames__.",146:"__count__ Pages",148:"__number__ audio files you tried adding have no content.",150:"__number__ audio files you tried adding are larger than the __maxSize__ limit.",254:"__count__ messages couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.",256:"__count__ messages couldn't be forwarded because the file is missing.",257:"__count__ messages couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.",262:"__updated__ Items Updated",291:"__count__ items",350:"Send __count__ contacts to __chat__?",351:"Send __count__ contacts to __chat__?",352:"Send __count__ contacts to __chat__?",361:"__number__ groups in common",366:"__number__ contacts that you tried to add have no content.",367:"The contacts that you tried to add are larger than the __maxSize__ limit.",375:"Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete these labels?",376:"Delete messages",377:"Delete messages?",387:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after theyre sent. Click to learn more.",388:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after theyre sent. Click to learn more.",389:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after theyre sent. Click to learn more.",390:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after theyre sent. Click to learn more.",391:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after theyre sent. Click to learn more.",392:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after theyre sent. Click to learn more.",393:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after theyre sent. Click to learn more.",394:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after theyre sent. Click to learn more.",397:"__count__ Docs",399:"__number__ documents you tried adding have no content.",400:"__number__ documents you tried adding are larger than the __maxSize__ limit.",408:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent.",409:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent.",410:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent.",411:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent.",412:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",413:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",414:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",415:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",417:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",418:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",419:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",420:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",421:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",422:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",423:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",424:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",425:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",426:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",427:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",428:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",430:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",431:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",432:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",433:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",436:"All new messages will disappear from this chat __number__ days after they're sent.",437:"All new messages will disappear from this chat __number__ hours after they're sent.",438:"All new messages will disappear from this chat __number__ minutes after they're sent.",439:"All new messages will disappear from this chat __number__ seconds after they're sent.",442:"This message will disappear from this chat __number__ days after they're sent.",443:"This message will disappear from this chat __number__ hours after they're sent.",444:"This message will disappear from this chat __number__ minutes after they're sent.",445:"This message will disappear from this chat __number__ seconds after they're sent.",448:"__number__ days",449:"__number__ hours",450:"__number__ minutes",451:"__number__ seconds",452:"Wait until the messages finish sending and displays a checkmark before forwarding.",456:"__number__ files you tried adding have no content.",457:"__count__ files failed to be downloaded because they are no longer on your phone.",458:"__number__ files could not be added.",459:"__number__ files you tried adding are not supported.",460:"__number__ files you tried adding are larger than the __maxSize__ limit.",466:"You can only share with up to __count__ chats",467:"Forwarded many times. You can only share with up to __count__ chats.",468:"Forward messages",469:"Forward messages to",470:"Forwarded __count__ times",471:"Found contact cards for this number. View contact cards?",486:"__count__ contacts",489:"__count__ participants",507:"__count__ others",509:"__count__ more",512:"Couldn't add __participant__. You can invite them privately to join this group.",528:"__unreadCount__ New Messages",530:"__number__ images you tried adding have no content.",531:"__number__ images you tried adding are larger than the __maxSize__ limit.",540:"This version expires in __num_days__ days. With the update, your phone wont need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",541:"This version expires in __num_days__ days. With the update, your phone wont need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",550:"Expires in __number__ days",551:"__count__ items",556:"__count__ Links",557:"Accurate to __accuracy__ M",558:"__count__ people",563:"Live until __time__",564:"__hours__h left",566:"__minutes__m left",567:"__sharers__ are sharing live location",569:"__count__ people are sharing live location",572:"You and __count__ others are sharing live location",574:"Updated __hours__h ago",576:"Updated __minutes__m ago",624:"__count__ remaining",642:"__contactName__ and __count__ other contacts",643:"__count__ contacts",644:"You can only send up to __count__ contacts",707:"__count__ contacts excluded",708:"__count__ Products",709:"This photo is too small. Please select a photo with height and width of at least __size__ pixels.",715:"All",719:'Remove label "__labelName__" from __count__ items',728:"Retrying in __number__ seconds",747:"See __count__ archived chats",748:"__count__ selected",762:"__count__ Screenshots Maximum",767:"__days__d",768:"__hours__h",769:"__minutes__m",770:"__seconds__s",772:"Star messages",778:"__count__ suspicious links",783:"__time__ left",784:"Maximum number of files uploaded. __number__ files have been ignored.",792:"__count__ @ messages not synced",793:"__count__ unread messages",796:"Unstar messages",811:"__participants__ joined using your invite",812:"You invited __participants__",814:"__number__ videos you tried adding have no content.",816:"__number__ videos you tried adding are larger than the __maxSize__ limit.",817:"View Contact Cards",834:"Call cannot be placed for more than __count__ participants",835:"You can only call up to __count__ contacts",836:"__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.",837:"__count__ others",873:"__count__ pages",913:"__participants__ are no longer admins",917:"__participants__ are now admins",932:"__num__ invites sent",936:"__name__ were added to the list",937:"__name__ were removed from the list",946:"Missed group video call at __time__",947:"Missed group voice call at __time__",949:"Missed video call at __time__",951:"Missed voice call at __time__",954:"__count__ participants",956:"__contactName__ canceled their payment request for __currencyAndAmount__",957:"You canceled your payment request to __contactName__ for __currencyAndAmount__",958:"__contactName__ declined your payment request for __currencyAndAmount__.",959:"You declined __contactName__'s payment request for __currencyAndAmount__.",960:"__senderName__'s payment request for __currencyAndAmount__ to you expired.",961:"Your payment request to __receiverName__ for __currencyAndAmount__ expired.",968:"Requested __amount__ from You",969:"__senderName__ requested __amount__ from You",970:"__senderName__ requested __amount__ from __receiverName__",971:"Sent __amount__ to You",972:"__senderName__ sent __amount__ to You",973:"__senderName__ sent __amount__ to __receiverName__",976:"__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.",989:"__count__ recipients",1021:"You created a broadcast list with __count__ recipients"}]},11609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Offline=t.Disconnected=void 0;var n=r(40265);const i=(0,n.customError)("Disconnected",!1);t.Disconnected=i;const a=(0,n.customError)("Offline",!1,i);t.Offline=a},48338:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AckParser=void 0,t.ackMatchesTemplate=function(e,t){return e.id===t.id&&(void 0===t.class||e.class===t.class)&&(void 0===t.type||e.type===t.type)&&(void 0===t.from||o(e.from,t.from))&&(void 0===t.participant||e.participant===t.participant)&&(void 0===t.ts||e.ts===t.ts)},t.fromJidsAreEqual=o;var n=r(74391),i=r(52230);const a=new(r(71914).WapParser)("ack",(e=>(e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null})));function o(e,t){if((0,i.extractFromJid)(e)===t)return!0;const{defaultDeviceJidForUser:r}=(0,n.getJidUtilsApi)();return e.userJid?r(e.userJid)===t:!!e.deviceJid&&(0===(0,i.extractDeviceId)(e.deviceJid)&&(0,i.extractUserJid)(e.deviceJid)===t)}t.AckParser=a},36184:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){_&&_.deadSocketTimer.cancel()},t.castStanza=function(e){const t=A("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=A("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.forceResetSocketLoop=function(){A("forceResetSocketLoop").socketLoop.reset()},t.isSocketConnected=E,t.maybeResetSocketLoop=function(){E()||A("maybeResetSocketLoop").socketLoop.reset()},t.onStreamErrorReceived=function(){A("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=y,t.resetStateForTests=function(){_=null,h=new u.Resolvable,g=1},t.sendIq=function(e,t){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqErrorParser=function(e,t,r){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendIqIfConnectedWithin=function(e,t,r){return T(e,!1,r).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqIfConnectedWithinErrorParser=function(e,t,r,n){return T(e,!1,r).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendIqWithoutRetry=function(e,t){return T(e,!0).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqWithoutRetryErrorParser=function(e,t,r){return T(e,!0).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendPing=function(){return C.apply(this,arguments)},t.sendSmaxIq=function(e,t){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendSmaxIqErrorParser=function(e,t,r){return T(e,!1).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendStanzaAndReturnAck=v,t.sendStanzaAndWaitForAck=function(e,t){return v(e,t).then((()=>{}))},t.singletonOrThrowIfUninitialized=A,t.socketLoopIteration=S,t.startComms=function(e,t,r,n){if(_)return;_=new m(e,t,r,n),setTimeout(y,0)},t.startHandlingRequests=function(){return A("startHandlingRequests").startHandlingRequests()},t.stopComms=function(){const e=A("stopComms");e.socketLoop.endWithValue(),e.socket&&e.socket.close()},t.waitForConnection=function(){return A("waitForConnection").sendPing(),h.promise};var i=n(r(11504)),a=r(48338),o=r(47151),s=r(11609),l=r(20221),c=r(37329),d=r(72287),u=r(88156),p=r(57319),f=r(31914);r(71914);let _=null,h=new u.Resolvable,g=1;class m{constructor(e,t,r,n){var i,a;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new u.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.handleStanza=(e,t,r)=>{_wext.ohs(e,t,r);const n=b(e);if(null!=n){const t=this.pendingIqs.get(n);t?(this.pendingIqs.delete(n),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${n}`}else{if("ack"!==e.tag)return"failure"===e.tag&&this.config.shouldBlockReceivingUntilSuccess?this._handleStanza(e,t,r):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,r)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new p.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new p.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.onConnectionChange=(0,l.notifyConnectionChangeFactory)(null!==(i=r.handlers.onConnectionChange)&&void 0!==i?i:()=>{},null!==(a=r.handlers.onOptimisticConnectionChange)&&void 0!==a?a:()=>{}),this.gzipInflate=n,this.config=r,this.socketLoop=new d.PromiseRetryLoop({name:"MainSocketLoop",code:S,timer:{jitter:.1,max:r.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function r(r){e(r)&&t.push(r)}return this.pendingIqs.forEach(r),this.ackHandlers.forEach(r),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{var r,n;null===(r=(n=this.config.handlers).onCastStanza)||void 0===r||r.call(n,e),t.sendFrame((0,f.encodeStanza)(e))}catch(e){__LOG__(4,void 0,new Error)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){return __LOG__(2)`Comms.startHandlingRequests`,this._recvBlocker.resolve(),this._recvBlocker.promise.then((()=>{}))}parseAndHandleStanza(e,t){e===this.socketId&&(this.deadSocketTimer.cancel(),h.resolveWasCalled()||h.resolve());const r=(0,f.decodeStanza)(t,this.gzipInflate).catch((e=>{throw __LOG__(4,void 0,new Error)`Failure parsing stanza!`,e})).then((r=>{var n,i;null===(n=(i=this.config.handlers).onHandleStanza)||void 0===n||n.call(i,r,e,t.byteLength);const a=this.activePing;return a&&a.socketId===e&&a.stanzaId===b(r)?(this.activePing=null,a.handler.resolve(r),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(r,e,t.byteLength)})).then((t=>{if(e===this.socketId){if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:this.castStanza(t);return"NO_ACK"}}));this._pending.add(r),r.finally((()=>{this._pending.delete(r)}))}handleAck(e){const t=this.ackHandlers;let r=-1,n=null;for(;!n&&++r<t.length;)n=t[r].parseAndTest(e);if(n){var i,a;const s=t[r];(0,o.removeIndexWithoutPreservingOrder)(t,r),null===(i=(a=this.config.handlers).onHandleAck)||void 0===i||i.call(a,e),s.resolve(n),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,o.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new s.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}function y(){A("openSocketLoop").socketLoop.start()}function E(){var e;return!!(null===(e=_)||void 0===e?void 0:e.socket)}function S(){var e,t;const r=A("socketLoopIteration"),n=r.nextSocketId++;return __LOG__(2)`Comms: Socket ${n} opening`,null===(e=(t=r.config.handlers).onSocketLoopIteration)||void 0===e||e.call(t),r.config.openChatSocket((()=>{r.onConnectionChange("in_handshake")})).then((e=>{var t,i,a,o;null===(t=(i=r.config.handlers).onSocketOpen)||void 0===t||t.call(i);const s=new u.Resolvable;return __LOG__(2)`Comms: Socket ${n} opened`,r.socketId=n,r.socket=e,r.softCloseSocket=()=>{r.softCloseSocket=null,r.socket&&r.config.shouldCloseStaleSocket&&(r.socket.close(),r.socket=null),s.resolve()},r.socketLoop.resetTimeoutAfter(1e4),r.deadSocketTimer.cancel(),r.maybeScheduleHealthCheck(),e.setOnFrame((e=>r.parseAndHandleStanza(n,e))),e.setOnClose((()=>{var e,t;__LOG__(2)`Comms: Socket ${n} closed`,r.activePing&&n===r.activePing.socketId&&(r.activePing.handler.resolve(),r.activePing=null),r.filterPending((e=>e.attachedToSocketId===n)).forEach((e=>{r.removeHandler(e)})),n===r.socketId&&(r.socketId=0,r.socket=null,r.onConnectionChange("disconnected"),null===(e=(t=r.config.handlers).onDisconnect)||void 0===e||e.call(t),s.resolve(),h=new u.Resolvable)})),r.onConnectionChange("connected"),null===(a=(o=r.config.handlers).onConnect)||void 0===a||a.call(o),r.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((e=>{"iq"===e.type?r.sendPendingIq(e):r.callStanza(e.stanza)})),s.promise})).catch((e=>{e instanceof s.Disconnected?__LOG__(2)`socketLoopIteration socket closed while in noise handshake`:__LOG__(4,void 0,new Error)`socketLoopIteration failed ${e}`}))}function v(e,t){return new Promise((r=>{const n=A("sendStanzaAndWaitForAck");n.ackHandlers.push({type:"ack",parseAndTest:e=>{const r=a.AckParser.parse(e);return!r.error&&(0,a.ackMatchesTemplate)(r.success,t)?e:null},resolve:r,stanza:e,attachedToSocketId:0,orderedId:g++}),n.socket?n.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((n=>{var i,a;const o=A("sendIq"),l=e.attrs.id;if(!l||"string"!=typeof l)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const c=o.socketId;if(t&&!c)return void n(Promise.reject(new s.Offline));let d;r>0&&(d=setTimeout((()=>{const e=o.pendingIqs.get(l);e?o.removeHandler(e):n(Promise.reject(new Error(`Comms:_sendIq unexisting stanza to be cancelled: ${l}`)))}),1e3*r));const u={type:"iq",resolve:n,stanza:e,attachedToSocketId:t?c:0,orderedId:g++,timeoutId:d};o.pendingIqs.set(l,u),null===(i=(a=o.config.handlers).onSendIq)||void 0===i||i.call(a,e),o.socket?o.sendPendingIq(u):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}))}function C(){return(C=(0,i.default)((function*(e,t){const r=A("sendPing"),n=e.attrs.id;if(!n||"string"!=typeof n)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!r.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(r.activePing&&r.activePing.socketId===r.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();r.activePing&&r.activePing.handler.resolve();const i=new u.Resolvable;r.activePing={socketId:r.socketId,stanzaId:n,handler:i},r.callStanza(e);const a=yield i.promise;return a&&(0,c.parseIqResponse)(a,t)}))).apply(this,arguments)}function A(e){if(_)return _;throw new Error(`Comms::${e} called before startComms`)}function b(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,f.decodeAsString)(e.attrs.id)||null}return null}},20221:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifyConnectionChangeFactory=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;const n={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},i=()=>{const{optimismLevel:e,connectionStatus:i}=n;"optimist"===e?n.timeoutID=setTimeout((()=>{n.optimismLevel="realist",t(i)}),r):t(i)};return r=>{n.connectionStatus=r,"disconnected"===r||"in_handshake"===r?i():(null!=n.timeoutID&&(clearTimeout(n.timeoutID),n.timeoutID=null),t(r)),e(r)}}},34308:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmppParsingFailure=t.ParsableWapNode=void 0;var n=r(8584),i=r(74391),a=r(52230),o=r(8243),s=r(91560),l=r(17793),c=r(92844),d=r(31914),u=r(45506);class p{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmppParsingFailure: ${this.parser}: ${this.reason}`}}t.XmppParsingFailure=p;class f extends s.ParsableXmlNode{constructor(e,t){super(e,t)}assertFromServer(){const e=this.attrString("from");e!==a.WA_SERVER_DOMAIN&&this.throw(`to have "from"="s.whatsapp.net", but instead has "${e}"`)}attrUserJid(e){const t=this.attrString(e);return(0,a.interpretAndValidateJid)(t).userJid||this.throw(`to have "${e}"={UserJid}, but instead has "${t}"`)}attrPhoneUserJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"phoneUser"===r.jidType?r.userJid:this.throw(`to have "${e}"={PhoneUserJid}, but instead has "${t}"`)}maybeAttrUserJid(e){return this.hasAttr(e)?this.attrUserJid(e):null}maybeAttrPhoneUserJid(e){return this.hasAttr(e)?this.attrPhoneUserJid(e):null}attrGroupJid(e){const t=this.attrString(e);return(0,a.interpretAndValidateJid)(t).groupJid||this.throw(`to have "${e}"={GroupJid}, but instead has "${t}"`)}maybeAttrGroupJid(e){return this.hasAttr(e)?this.attrGroupJid(e):null}attrChatJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return r.userJid||r.groupJid||this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrPhoneChatJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"phoneUser"===r.jidType?r.userJid:"group"===r.jidType?r.groupJid:this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrDeviceJid(e){const{defaultDeviceJidForUser:t}=(0,i.getJidUtilsApi)(),r=this.attrString(e),n=(0,a.interpretAndValidateJid)(r);return n.deviceJid?n.deviceJid:n.userJid?t(n.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${r}"`)}attrPhoneDeviceJid(e){const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"phoneDevice"===r.jidType?r.deviceJid:"phoneUser"===r.jidType?(0,a.defaultPhoneDeviceJidForUser)(r.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${t}"`)}attrDeviceId(e){const t=this.attrInt(e);return(0,a.interpretAsDeviceId)(t)}attrFromJidChat(){const{defaultDeviceJidForUser:e}=(0,i.getJidUtilsApi)(),t=this.attrJidWithType();switch(t.jidType){case"msgrUser":{const r=t.userJid,n=e(r);return{type:"device",chat:r,deviceJid:n,author:n}}case"phoneUser":{const r=t.userJid,n=e(r);return{type:"device",chat:r,deviceJid:n,author:n}}case"lidUser":{const e=t.userJid,r=(0,a.defaultLidDeviceJidForLidUserJid)(e);return{type:"device",chat:e,deviceJid:r,author:r}}case"phoneDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"msgrDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"lidDevice":{const e=t.deviceJid;return{type:"device",chat:(0,a.extractUserJid)(e),deviceJid:e,author:e}}case"group":{const e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==e?this.throw("expected to have participant JID for group"):{type:"group",chat:t.groupJid,groupJid:t.groupJid,author:e}}case"broadcast":{const e=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==e?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:t.broadcastJid,chat:(0,a.extractUserJid)(e),author:e}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${t.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return t.jidType,this.throw("attrFromJidChat should not be used with a status jid")}}attrFromJidPhoneChat(){const e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{const t=e.userJid,r=(0,a.defaultPhoneDeviceJidForUser)(t);return{type:"device",chat:t,deviceJid:r,author:r}}case"phoneDevice":{const t=e.deviceJid;return{type:"device",chat:(0,a.extractPhoneUserJid)(t),deviceJid:t,author:t}}case"group":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:t}}case"broadcast":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:(0,a.extractPhoneUserJid)(t),author:t}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw(`attrFromJidChat should not be used with jid of type ${e.jidType}`)}}attrFromPhoneJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e?{type:"status",author:e}:this.throw("to have participant for status msg")}return this.attrFromJidPhoneChat()}attrFromJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return e?{type:"status",author:e}:this.throw("to have participant for status msg")}return this.attrFromJidChat()}attrJidWithType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"unknown"===r.jidType?this.throw(`to have "${e}"={Jid}, but instead has "${t}"`):r}attrWapJid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),r=(0,a.interpretAndValidateJid)(t);return"unknown"===r.jidType?u.WapJid.create(null,t):(0,d.JID)((0,a.extractFromJid)(r))}attrLongInt(e){const t=this.attrString(e);return(0,o.decimalStringToLongInt)(t)}attrTime(e){return(0,c.castToUnixTime)(this.attrInt(e))}attrFutureTime(e){const t=this.attrInt(e);return(0,c.futureUnixTime)(t)}contentString(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){const e=new n.Binary(this.contentBytes());return e.readString(e.size())}return this.throw("to have content")}decodeAsString(e){return(0,d.decodeAsString)(e)}contentSerializedPubKey(){return this.hasContent()?(0,l.serializeIdentity)(this.contentBytes()):this.throw("to have content")}throw(e){throw new p(this.name(),`expected <${this.tag()}> ${e}`)}}t.ParsableWapNode=f},37329:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIqResponse=function(e,t,r){const o=e.content;if(o&&Array.isArray(o)&&o[0]){const t=o[0];if("error"===t.tag){const o=t.attrs||{};let s;r&&(s=r instanceof i.WapParser?r.parseOrThrow(t):r(e));const l=s;return{success:!1,errorCode:parseInt(o.code,10),errorText:(0,n.decodeAsString)(o.text)||"",errorType:(0,n.decodeAsString)(o.type)||"",errorBackoff:parseInt(o.backoff,10),toString:a,customError:l}}}return t instanceof i.WapParser?{success:!0,result:t.parseOrThrow(e)}:{success:!0,result:t(e)}};var n=r(31914),i=r(71914);function a(){return`IqError ${this.errorCode}: ${this.errorText}`}},31914:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.BIG_ENDIAN_CONTENT=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=e;const n=new Uint8Array(t);for(let e=t-1;e>=0;e--)n[e]=255&r,r>>>=8;return n},t.BROADCAST_JID=function(e){return W(e)},t.CALL_JID=function(e){return W(e)},t.CUSTOM_STRING=function(e){return e},t.DEVICE_JID=function(e){return W(e)},t.DROP_ATTR=void 0,t.GROUP_JID=function(e){return W(e)},t.G_US=void 0,t.INT=function(e){return e.toString()},t.JID=W,t.LONG_INT=function(e){return(0,o.longIntToDecimalString)(e)},t.MAYBE_CUSTOM_STRING=function(e){if(null==e)return S;return e},t.PARTICIPANT_JID=function(e){return"status"===e.type||"group"===e.type||"broadcast"===e.type?W(e.author):S},t.S_WHATSAPP_NET=t.STATUS_BROADCAST=void 0,t.TO_JID=function(e){return W(Y(e))},t.TO_WAP_JID=function(e){return"phoneDevice"===e.jidType||"msgrDevice"===e.jidType||"lidDevice"===e.jidType?W(e.deviceJid):"phoneUser"===e.jidType||"msgrUser"===e.jidType||"lidUser"===e.jidType?W(e.userJid):"group"===e.jidType?W(e.groupJid):"status"===e.jidType?W(e.statusJid):"call"===e.jidType?W(e.callJid):(e.jidType,W(e.broadcastJid))},t.USER_JID=function(e){return W(e)},t.WapNode=void 0,t.decodeAsString=function(e){if(e instanceof l.WapJid)return e.toString();return e},t.decodeStanza=function(e,t){const r=new i.Binary(e);if(2&r.readUint8())return __LOG__(2)`Decoding compressed stanza`,t(r.readByteArray()).then((e=>x(new i.Binary(e))));return Promise.resolve(x(r))},t.encodeStanza=function(e){const t=e instanceof b?e:O(e),r=new i.Binary;I(t,r);const n=r.readByteArray(),a=new Uint8Array(1+n.length);return a[0]=0,a.set(n,1),a},t.extractParticipantJid=function(e){switch(e.type){case"group":case"status":case"broadcast":return e.author;default:return e.type,null}},t.extractToJid=Y,t.generateId=function(){if(!y){const e=new Uint16Array(2);self.crypto.getRandomValues(e),y=`${String(e[0])}.${String(e[1])}-`}return`${y}${E++}`},t.makeStanza=O,t.makeWapNode=P,t.wap=void 0;var i=r(8584),a=r(52230),o=r(8243),s=r(27498),l=r(45506),c=(n(r(17890)),r(74277));const d=a.MSGR_USER_DOMAIN.replace("@",""),u=a.WA_USER_DOMAIN.replace("@",""),p=a.LID_DOMAIN.replace("@",""),f=[236,237,238,239],_=248,h=249,g=["0","1","2","3","4","5","6","7","8","9","-",".","","","",""],m=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];let y="",E=1;const S={sentinel:"DROP_ATTR"};t.DROP_ATTR=S;const v=l.WapJid.create(null,"g.us");t.G_US=v;const T=l.WapJid.create(null,a.WA_SERVER_DOMAIN);t.S_WHATSAPP_NET=T;const C=l.WapJid.create("status","broadcast");t.STATUS_BROADCAST=C;const A={};class b{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=r}toString(){let e="<"+this.tag;e+=(0,c.attrsToString)(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:e+=t?`>${(0,c.uint8ArrayToDebugString)(t)}</${this.tag}>`:" />",e}}function P(e,t,r){let n=null;if(t&&null!=t.children)throw new Error('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(r))n=r.filter(Boolean);else if("string"==typeof r)n=i.Binary.build(r).readByteArray();else if(r instanceof ArrayBuffer)n=new Uint8Array(r);else if(r instanceof Uint8Array)n=r;else{const e=[];for(let t=2;t<arguments.length;t++){const r=arguments[t];r&&e.push(r)}n=e}Array.isArray(n)&&0===n.length&&(n=null);const a={};if(t){const r=t;Object.keys(r).forEach((t=>{const n=r[t];if(null==n)throw new Error(`Attr ${t} in <${e}> is null`);n!==S&&(a[t]=n)}))}return new b(e,a,n)}t.WapNode=b;const M=P;function O(e){let t=e.content;return Array.isArray(t)?t=t.map(O):"string"==typeof t&&(t=i.Binary.build(t).readByteArray()),new b(e.tag,e.attrs||A,t)}function I(e,t){if(null==e)t.writeUint8(0);else if(e instanceof b)w(e,t);else if(e instanceof l.WapJid)!function(e,t){const r=e.getInnerJid();if(r.type===l.WAP_JID_SUBTYPE.JID_AD){const{user:e,agent:n,device:i}=r;t.writeUint8(247),t.writeUint8(n),t.writeUint8(i),I(e,t)}else if(r.type===l.WAP_JID_SUBTYPE.JID_FB){const{user:e,device:n}=r;t.writeUint8(246),I(e,t),t.writeUint16(n),I(u,t)}else{const{user:e,server:n}=r;t.writeUint8(250),null!=e?I(e,t):t.writeUint8(0),I(n,t)}}(e,t);else if("string"==typeof e)L(e,t);else{if(!(e instanceof Uint8Array))throw new Error("Invalid payload type "+typeof e);!function(e,t){G(e.length,t),t.writeByteArray(e)}(e,t)}}function w(e,t){if(void 0===e.tag)return t.writeUint8(_),void t.writeUint8(0);let r=1;e.attrs&&(r+=2*Object.keys(e.attrs).length),e.content&&r++,r<256?(t.writeUint8(_),t.writeUint8(r)):r<65536&&(t.writeUint8(h),t.writeUint16(r)),I(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach((r=>{L(r,t),I(e.attrs[r],t)}));const n=e.content;if(Array.isArray(n)){n.length<256?(t.writeUint8(_),t.writeUint8(n.length)):n.length<65536&&(t.writeUint8(h),t.writeUint16(n.length));for(let e=0;e<n.length;e++)w(n[e],t)}else n&&I(n,t)}let R,D;function N(e){const t=new Map;for(let r=0;r<e.length;r++)t.set(e[r],r);return t}function L(e,t){if(""===e)return t.writeUint8(252),void t.writeUint8(0);null==R&&(R=N(s.SINGLE_BYTE_TOKEN));const r=R.get(e);if(null!=r)return void t.writeUint8(r+1);if(null==D){D=[];for(let e=0;e<s.DICTIONARIES.length;++e)D.push(N(s.DICTIONARIES[e]))}for(let r=0;r<D.length;++r){const n=D[r].get(e);if(null!=n)return t.writeUint8(f[r]),void t.writeUint8(n)}const n=(0,i.numUtf8Bytes)(e);if(n<128){if(!/[^0-9.-]+?/.exec(e))return void k(e,255,t);if(!/[^0-9A-F]+?/.exec(e))return void k(e,251,t)}G(n,t),t.writeString(e)}function k(e,t,r){const n=e.length%2==1;r.writeUint8(t);let i=Math.ceil(e.length/2);n&&(i|=128),r.writeUint8(i);let a=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);let o=null;if(48<=i&&i<=57?o=i-48:255===t?45===i?o=10:46===i&&(o=11):251===t&&65<=i&&i<=70&&(o=i-55),null==o)throw new Error(`Cannot nibble encode ${i}`);n%2==0?(a=o<<4,n===e.length-1&&(a|=15,r.writeUint8(a))):(a|=o,r.writeUint8(a))}}function G(e,t){if(e<256)t.writeUint8(252),t.writeUint8(e);else if(e<1048576)t.writeUint8(253),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(255&e);else{if(!(e<4294967296))throw new Error(`Binary with length ${e} is too big for WAP protocol`);t.writeUint8(254),t.writeUint32(e)}}function U(e,t){const r=e.readUint8();if(0===r)return null;if(r===_)return F(e,e.readUint8());if(r===h)return F(e,e.readUint16());if(252===r){const r=e.readUint8();return K(e,r,t)}if(253===r){const r=e.readUint8(),n=e.readUint8(),i=e.readUint8();return K(e,((15&r)<<16)+(n<<8)+i,t)}if(254===r){const r=e.readUint32();return K(e,r,t)}if(250===r)return function(e){const t=function(e){const t=U(e,!0);if(null!=t&&"string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}(e),r=B(e);return l.WapJid.create(t,r)}(e);if(246===r)return function(e){const t=B(e),r=e.readUint16();return B(e),l.WapJid.createFbJid(t,r)}(e);if(247===r)return function(e){const t=e.readUint8(),r=e.readUint8(),n=B(e);return l.WapJid.createAD(n,t,r)}(e);if(255===r){const t=e.readUint8();return j(e,g,t>>>7,127&t)}if(251===r){const t=e.readUint8();return j(e,m,t>>>7,127&t)}if(r<=0||r>=240)throw new Error("Unable to decode WAP buffer");if(r>=236&&r<=239){const t=r-236,n=s.DICTIONARIES[t];if(void 0===n)throw new Error(`Missing WAP dictionary ${t}`);const i=e.readUint8(),a=n[i];if(void 0===a)throw new Error(`Invalid value index ${i} in dict ${t}`);return a}const n=s.SINGLE_BYTE_TOKEN[r-1];if(void 0===n)throw new Error(`Undefined token with index ${r}`);return n}function F(e,t){const r=[];for(let n=0;n<t;n++)r.push(x(e));return r}function x(e){const t=e.readUint8();let r,n;if(t===_)r=e.readUint8();else{if(t!==h)throw new Error(`Failed to decode node since type byte ${String(t)} is invalid`);r=e.readUint16()}let i=null;if(0===r)throw new Error("Failed to decode node, list cannot be empty");const a=B(e);for(r-=1;r>1;){n||(n={});const t=B(e),i=U(e,!0);n[t]=i,r-=2}return 1===r&&(i=U(e,!1),i instanceof l.WapJid&&(i=String(i))),new b(a,n,i)}function B(e){const t=U(e,!0);if("string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}function K(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?e.readString(t):e.readByteArray(t)}function j(e,t,r,n){const i=new Array(2*n-r);for(let r=0;r<i.length-1;r+=2){const n=e.readUint8();i[r]=t[n>>>4],i[r+1]=t[15&n]}if(r){const r=e.readUint8();i[i.length-1]=t[r>>>4]}return i.join("")}function Y(e){switch(e.type){case"group":return e.groupJid;case"status":return a.STATUS_JID;case"device":return e.deviceJid;default:return e.type,e.broadcastJid}}function W(e){let[t,r]=e.split("@"),n=null,i=null;return r!==u&&r!==d&&r!==p||(-1!==t.indexOf(":")&&([t,i]=t.split(":"),i=parseInt(i,10)),-1!==t.indexOf(".")&&([t,n]=t.split("."),n=parseInt(n,10))),r===d?l.WapJid.createFbJid(t,i):null!=i&&0!==i||null!=n&&0!==n?l.WapJid.createAD(t,n,i):l.WapJid.create(t,r)}t.wap=M},27498:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SINGLE_BYTE_TOKEN=t.DICT_VERSION=t.DICTIONARY_3_TOKEN=t.DICTIONARY_2_TOKEN=t.DICTIONARY_1_TOKEN=t.DICTIONARY_0_TOKEN=t.DICTIONARIES=void 0;t.DICT_VERSION=2;t.SINGLE_BYTE_TOKEN=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","broadcast","status","message","notification","notify","to","jid","user","class","offline","g.us","result","mediatype","enc","skmsg","off_cnt","xmlns","presence","participants","ack","t","iq","device_hash","read","value","media","picture","chatstate","unavailable","text","urn:xmpp:whatsapp:push","devices","verified_name","contact","composing","edge_routing","routing_info","item","image","verified_level","get","fallback_hostname","2","media_conn","1","v","handshake","fallback_class","count","config","offline_preview","download_buckets","w:profile:picture","set","creation","location","fallback_ip4","msg","urn:xmpp:ping","fallback_ip6","call-creator","relaylatency","success","subscribe","video","business_hours_config","platform","hostname","version","unknown","0","ping","hash","edit","subject","max_buckets","download","delivery","props","sticker","name","last","contacts","business","primary","preview","w:p","pkmsg","call-id","retry","prop","call","auth_ttl","available","relay_id","last_id","day_of_week","w","host","seen","bits","list","atn","upload","is_new","w:stats","key","paused","specific_hours","multicast","stream:error","mmg.whatsapp.net","code","deny","played","profile","fna","device-list","close_time","latency","gcm","pop","audio","26","w:web","open_time","error","auth","ip4","update","profile_options","config_value","category","catalog_not_created","00","config_code","mode","catalog_status","ip6","blocklist","registration","7","web","fail","w:m","cart_enabled","ttl","gif","300","device_orientation","identity","query","401","media-gig2-1.cdn.whatsapp.net","in","3","te2","add","fallback","categories","ptt","encrypt","notice","thumbnail-document","item-not-found","12","thumbnail-image","stage","thumbnail-link","usync","out","thumbnail-video","8","01","context","sidelist","thumbnail-gif","terminate","not-authorized","orientation","dhash","capability","side_list","md-app-state","description","serial","readreceipts","te","business_hours","md-msg-hist","tag","attribute_padding","document","open_24h","delete","expiration","active","prev_v_id","true","passive","index","4","conflict","remove","w:gp2","config_expo_key","screen_height","replaced","02","screen_width","uploadfieldstat","2:47DEQpj8","media-bog1-1.cdn.whatsapp.net","encopt","url","catalog_exists","keygen","rate","offer","opus","media-mia3-1.cdn.whatsapp.net","privacy","media-mia3-2.cdn.whatsapp.net","signature","preaccept","token_id","media-eze1-1.cdn.whatsapp.net"];const r=["media-for1-1.cdn.whatsapp.net","relay","media-gru2-2.cdn.whatsapp.net","uncompressed","medium","voip_settings","device","reason","media-lim1-1.cdn.whatsapp.net","media-qro1-2.cdn.whatsapp.net","media-gru1-2.cdn.whatsapp.net","action","features","media-gru2-1.cdn.whatsapp.net","media-gru1-1.cdn.whatsapp.net","media-otp1-1.cdn.whatsapp.net","kyc-id","priority","phash","mute","token","100","media-qro1-1.cdn.whatsapp.net","none","media-mrs2-2.cdn.whatsapp.net","sign_credential","03","media-mrs2-1.cdn.whatsapp.net","protocol","timezone","transport","eph_setting","1080","original_dimensions","media-frx5-1.cdn.whatsapp.net","background","disable","original_image_url","5","transaction-id","direct_path","103","appointment_only","request_image_url","peer_pid","address","105","104","102","media-cdt1-1.cdn.whatsapp.net","101","109","110","106","background_location","v_id","sync","status-old","111","107","ppic","media-scl2-1.cdn.whatsapp.net","business_profile","108","invite","04","audio_duration","media-mct1-1.cdn.whatsapp.net","media-cdg2-1.cdn.whatsapp.net","media-los2-1.cdn.whatsapp.net","invis","net","voip_payload_type","status-revoke-delay","404","state","use_correct_order_for_hmac_sha1","ver","media-mad1-1.cdn.whatsapp.net","order","540","skey","blinded_credential","android","contact_remove","enable_downlink_relay_latency_only","duration","enable_vid_one_way_codec_nego","6","media-sof1-1.cdn.whatsapp.net","accept","all","signed_credential","media-atl3-1.cdn.whatsapp.net","media-lhr8-1.cdn.whatsapp.net","website","05","latitude","media-dfw5-1.cdn.whatsapp.net","forbidden","enable_audio_piggyback_network_mtu_fix","media-dfw5-2.cdn.whatsapp.net","note.m4r","media-atl3-2.cdn.whatsapp.net","jb_nack_discard_count_fix","longitude","Opening.m4r","media-arn2-1.cdn.whatsapp.net","email","timestamp","admin","media-pmo1-1.cdn.whatsapp.net","America/Sao_Paulo","contact_add","media-sin6-1.cdn.whatsapp.net","interactive","8000","acs_public_key","sigquit_anr_detector_release_rollover_percent","media.fmed1-2.fna.whatsapp.net","groupadd","enabled_for_video_upgrade","latency_update_threshold","media-frt3-2.cdn.whatsapp.net","calls_row_constraint_layout","media.fgbb2-1.fna.whatsapp.net","mms4_media_retry_notification_encryption_enabled","timeout","media-sin6-3.cdn.whatsapp.net","audio_nack_jitter_multiplier","jb_discard_count_adjust_pct_rc","audio_reserve_bps","delta","account_sync","default","media.fjed4-6.fna.whatsapp.net","06","lock_video_orientation","media-frt3-1.cdn.whatsapp.net","w:g2","media-sin6-2.cdn.whatsapp.net","audio_nack_algo_mask","media.fgbb2-2.fna.whatsapp.net","media.fmed1-1.fna.whatsapp.net","cond_range_target_bitrate","mms4_server_error_receipt_encryption_enabled","vid_rc_dyn","fri","cart_v1_1_order_message_changes_enabled","reg_push","jb_hist_deposit_value","privatestats","media.fist7-2.fna.whatsapp.net","thu","jb_discard_count_adjust_pct","mon","group_call_video_maximization_enabled","mms_cat_v1_forward_hot_override_enabled","audio_nack_new_rtt","media.fsub2-3.fna.whatsapp.net","media_upload_aggressive_retry_exponential_backoff_enabled","tue","wed","media.fruh4-2.fna.whatsapp.net","audio_nack_max_seq_req","max_rtp_audio_packet_resends","jb_hist_max_cdf_value","07","audio_nack_max_jb_delay","mms_forward_partially_downloaded_video","media-lcy1-1.cdn.whatsapp.net","resume","jb_inband_fec_aware","new_commerce_entry_point_enabled","480","payments_upi_generate_qr_amount_limit","sigquit_anr_detector_rollover_percent","media.fsdu2-1.fna.whatsapp.net","fbns","aud_pkt_reorder_pct","dec","stop_probing_before_accept_send","media_upload_max_aggressive_retries","edit_business_profile_new_mode_enabled","media.fhex4-1.fna.whatsapp.net","media.fjed4-3.fna.whatsapp.net","sigquit_anr_detector_64bit_rollover_percent","cond_range_ema_jb_last_delay","watls_enable_early_data_http_get","media.fsdu2-2.fna.whatsapp.net","message_qr_disambiguation_enabled","media-mxp1-1.cdn.whatsapp.net","sat","vertical","media.fruh4-5.fna.whatsapp.net","200","media-sof1-2.cdn.whatsapp.net","-1","height","product_catalog_hide_show_items_enabled","deep_copy_frm_last","tsoffline","vp8/h.264","media.fgye5-3.fna.whatsapp.net","media.ftuc1-2.fna.whatsapp.net","smb_upsell_chat_banner_enabled","canonical","08","9",".","media.fgyd4-4.fna.whatsapp.net","media.fsti4-1.fna.whatsapp.net","mms_vcache_aggregation_enabled","mms_hot_content_timespan_in_seconds","nse_ver","rte","third_party_sticker_web_sync","cond_range_target_total_bitrate","media_upload_aggressive_retry_enabled","instrument_spam_report_enabled","disable_reconnect_tone","move_media_folder_from_sister_app","one_tap_calling_in_group_chat_size","10","storage_mgmt_banner_threshold_mb","enable_backup_passive_mode","sharechat_inline_player_enabled","media.fcnq2-1.fna.whatsapp.net","media.fhex4-2.fna.whatsapp.net","media.fist6-3.fna.whatsapp.net","ephemeral_drop_column_stage","reconnecting_after_network_change_threshold_ms","media-lhr8-2.cdn.whatsapp.net","cond_jb_last_delay_ema_alpha","entry_point_block_logging_enabled","critical_event_upload_log_config","respect_initial_bitrate_estimate","smaller_image_thumbs_status_enabled","media.fbtz1-4.fna.whatsapp.net","media.fjed4-1.fna.whatsapp.net","width","720","enable_frame_dropper","enable_one_side_mode","urn:xmpp:whatsapp:dirty","new_sticker_animation_behavior_v2","media.flim3-2.fna.whatsapp.net","media.fuio6-2.fna.whatsapp.net","skip_forced_signaling","dleq_proof","status_video_max_bitrate","lazy_send_probing_req","enhanced_storage_management","android_privatestats_endpoint_dit_enabled","media.fscl13-2.fna.whatsapp.net","video_duration"];t.DICTIONARY_0_TOKEN=r;const n=["group_call_discoverability_enabled","media.faep9-2.fna.whatsapp.net","msgr","bloks_loggedin_access_app_id","db_status_migration_step","watls_prefer_ip6","jabber:iq:privacy","68","media.fsaw1-11.fna.whatsapp.net","mms4_media_conn_persist_enabled","animated_stickers_thread_clean_up","media.fcgk3-2.fna.whatsapp.net","media.fcgk4-6.fna.whatsapp.net","media.fgye5-2.fna.whatsapp.net","media.flpb1-1.fna.whatsapp.net","media.fsub2-1.fna.whatsapp.net","media.fuio6-3.fna.whatsapp.net","not-allowed","partial_pjpeg_bw_threshold","cap_estimated_bitrate","mms_chatd_resume_check_over_thrift","smb_upsell_business_profile_enabled","product_catalog_webclient","groups","sigquit_anr_detector_release_updated_rollout","syncd_key_rotation_enabled","media.fdmm2-1.fna.whatsapp.net","media-hou1-1.cdn.whatsapp.net","remove_old_chat_notifications","smb_biztools_deeplink_enabled","use_downloadable_filters_int","group_qr_codes_enabled","max_receipt_processing_time","optimistic_image_processing_enabled","smaller_video_thumbs_status_enabled","watls_early_data","reconnecting_before_relay_failover_threshold_ms","cond_range_packet_loss_pct","groups_privacy_blacklist","status-revoke-drop","stickers_animated_thumbnail_download","dedupe_transcode_shared_images","dedupe_transcode_shared_videos","media.fcnq2-2.fna.whatsapp.net","media.fgyd4-1.fna.whatsapp.net","media.fist7-1.fna.whatsapp.net","media.flim3-3.fna.whatsapp.net","add_contact_by_qr_enabled","https://faq.whatsapp.com/payments","multicast_limit_global","sticker_notification_preview","smb_better_catalog_list_adapters_enabled","bloks_use_minscript_android","pen_smoothing_enabled","media.fcgk4-5.fna.whatsapp.net","media.fevn1-3.fna.whatsapp.net","media.fpoj7-1.fna.whatsapp.net","media-arn2-2.cdn.whatsapp.net","reconnecting_before_network_change_threshold_ms","android_media_use_fresco_for_gifs","cond_in_congestion","status_image_max_edge","sticker_search_enabled","starred_stickers_web_sync","db_blank_me_jid_migration_step","media.fist6-2.fna.whatsapp.net","media.ftuc1-1.fna.whatsapp.net","09","anr_fast_logs_upload_rollout","camera_core_integration_enabled","11","third_party_sticker_caching","thread_dump_contact_support","wam_privatestats_enabled","vcard_as_document_size_kb","maxfpp","fbip","ephemeral_allow_group_members","media-bom1-2.cdn.whatsapp.net","media-xsp1-1.cdn.whatsapp.net","disable_prewarm","frequently_forwarded_max","media.fbtz1-5.fna.whatsapp.net","media.fevn7-1.fna.whatsapp.net","media.fgyd4-2.fna.whatsapp.net","sticker_tray_animation_fully_visible_items","green_alert_banner_duration","reconnecting_after_p2p_failover_threshold_ms","connected","share_biz_vcard_enabled","stickers_animation","0a","1200","WhatsApp","group_description_length","p_v_id","payments_upi_intent_transaction_limit","frequently_forwarded_messages","media-xsp1-2.cdn.whatsapp.net","media.faep8-1.fna.whatsapp.net","media.faep8-2.fna.whatsapp.net","media.faep9-1.fna.whatsapp.net","media.fdmm2-2.fna.whatsapp.net","media.fgzt3-1.fna.whatsapp.net","media.flim4-2.fna.whatsapp.net","media.frao1-1.fna.whatsapp.net","media.fscl9-2.fna.whatsapp.net","media.fsub2-2.fna.whatsapp.net","superadmin","media.fbog10-1.fna.whatsapp.net","media.fcgh28-1.fna.whatsapp.net","media.fjdo10-1.fna.whatsapp.net","third_party_animated_sticker_import","delay_fec","attachment_picker_refresh","android_linked_devices_re_auth_enabled","rc_dyn","green_alert_block_jitter","add_contact_logging_enabled","biz_message_logging_enabled","conversation_media_preview_v2","media-jnb1-1.cdn.whatsapp.net","ab_key","media.fcgk4-2.fna.whatsapp.net","media.fevn1-1.fna.whatsapp.net","media.fist6-1.fna.whatsapp.net","media.fruh4-4.fna.whatsapp.net","media.fsti4-2.fna.whatsapp.net","mms_vcard_autodownload_size_kb","watls_enabled","notif_ch_override_off","media.fsaw1-14.fna.whatsapp.net","media.fscl13-1.fna.whatsapp.net","db_group_participant_migration_step","1020","cond_range_sterm_rtt","invites_logging_enabled","triggered_block_enabled","group_call_max_participants","media-iad3-1.cdn.whatsapp.net","product_catalog_open_deeplink","shops_required_tos_version","image_max_kbytes","cond_low_quality_vid_mode","db_receipt_migration_step","jb_early_prob_hist_shrink","media.fdmm2-3.fna.whatsapp.net","media.fdmm2-4.fna.whatsapp.net","media.fruh4-1.fna.whatsapp.net","media.fsaw2-2.fna.whatsapp.net","remove_geolocation_videos","new_animation_behavior","fieldstats_beacon_chance","403","authkey_reset_on_ban","continuous_ptt_playback","reconnecting_after_relay_failover_threshold_ms","false","group","sun","conversation_swipe_to_reply","ephemeral_messages_setting","smaller_video_thumbs_enabled","md_device_sync_enabled","bloks_shops_pdp_url_regex","lasso_integration_enabled","media-bom1-1.cdn.whatsapp.net","new_backup_format_enabled","256","media.faep6-1.fna.whatsapp.net","media.fasr1-1.fna.whatsapp.net","media.fbtz1-7.fna.whatsapp.net","media.fesb4-1.fna.whatsapp.net","media.fjdo1-2.fna.whatsapp.net","media.frba2-1.fna.whatsapp.net","watls_no_dns","600","db_broadcast_me_jid_migration_step","new_wam_runtime_enabled","group_update","enhanced_block_enabled","sync_wifi_threshold_kb","mms_download_nc_cat","bloks_minification_enabled","ephemeral_messages_enabled","reject","voip_outgoing_xml_signaling","creator","dl_bw","payments_request_messages","target_bitrate","bloks_rendercore_enabled","media-hbe1-1.cdn.whatsapp.net","media-hel3-1.cdn.whatsapp.net","media-kut2-2.cdn.whatsapp.net","media-lax3-1.cdn.whatsapp.net","media-lax3-2.cdn.whatsapp.net","sticker_pack_deeplink_enabled","hq_image_bw_threshold","status_info","voip","dedupe_transcode_videos","grp_uii_cleanup","linked_device_max_count","media.flim1-1.fna.whatsapp.net","media.fsaw2-1.fna.whatsapp.net","reconnecting_after_call_active_threshold_ms","1140","catalog_pdp_new_design","media.fbtz1-10.fna.whatsapp.net","media.fsaw1-15.fna.whatsapp.net","0b","consumer_rc_provider","mms_async_fast_forward_ttl","jb_eff_size_fix","voip_incoming_xml_signaling","media_provider_share_by_uuid","suspicious_links","dedupe_transcode_images","green_alert_modal_start","media-cgk1-1.cdn.whatsapp.net","media-lga3-1.cdn.whatsapp.net","template_doc_mime_types","important_messages","user_add","vcard_max_size_kb","media.fada2-1.fna.whatsapp.net","media.fbog2-5.fna.whatsapp.net","media.fbtz1-3.fna.whatsapp.net","media.fcgk3-1.fna.whatsapp.net","media.fcgk7-1.fna.whatsapp.net","media.flim1-3.fna.whatsapp.net","media.fscl9-1.fna.whatsapp.net","ctwa_context_enterprise_enabled","media.fsaw1-13.fna.whatsapp.net","media.fuio11-2.fna.whatsapp.net","status_collapse_muted","db_migration_level_force","recent_stickers_web_sync","bloks_session_state","bloks_shops_enabled","green_alert_setting_deep_links_enabled","restrict_groups","battery","green_alert_block_start","refresh","ctwa_context_enabled","md_messaging_enabled","status_image_quality","md_blocklist_v2_server","media-del1-1.cdn.whatsapp.net","13","userrate","a_v_id","cond_rtt_ema_alpha","invalid"];t.DICTIONARY_1_TOKEN=n;const i=["media.fada1-1.fna.whatsapp.net","media.fadb3-2.fna.whatsapp.net","media.fbhz2-1.fna.whatsapp.net","media.fcor2-1.fna.whatsapp.net","media.fjed4-2.fna.whatsapp.net","media.flhe4-1.fna.whatsapp.net","media.frak1-2.fna.whatsapp.net","media.fsub6-3.fna.whatsapp.net","media.fsub6-7.fna.whatsapp.net","media.fvvi1-1.fna.whatsapp.net","search_v5_eligible","wam_real_time_enabled","report_disk_event","max_tx_rott_based_bitrate","product","media.fjdo10-2.fna.whatsapp.net","video_frame_crc_sample_interval","media_max_autodownload","15","h.264","wam_privatestats_buffer_count","md_phash_v2_enabled","account_transfer_enabled","business_product_catalog","enable_non_dyn_codec_param_fix","is_user_under_epd_jurisdiction","media.fbog2-4.fna.whatsapp.net","media.fbtz1-2.fna.whatsapp.net","media.fcfc1-1.fna.whatsapp.net","media.fjed4-5.fna.whatsapp.net","media.flhe4-2.fna.whatsapp.net","media.flim1-2.fna.whatsapp.net","media.flos5-1.fna.whatsapp.net","android_key_store_auth_ver","010","anr_process_monitor","delete_old_auth_key","media.fcor10-3.fna.whatsapp.net","storage_usage_enabled","android_camera2_support_level","dirty","consumer_content_provider","status_video_max_duration","0c","bloks_cache_enabled","media.fadb2-2.fna.whatsapp.net","media.fbko1-1.fna.whatsapp.net","media.fbtz1-9.fna.whatsapp.net","media.fcgk4-4.fna.whatsapp.net","media.fesb4-2.fna.whatsapp.net","media.fevn1-2.fna.whatsapp.net","media.fist2-4.fna.whatsapp.net","media.fjdo1-1.fna.whatsapp.net","media.fruh4-6.fna.whatsapp.net","media.fsrg5-1.fna.whatsapp.net","media.fsub6-6.fna.whatsapp.net","minfpp","5000","locales","video_max_bitrate","use_new_auth_key","bloks_http_enabled","heartbeat_interval","media.fbog11-1.fna.whatsapp.net","ephemeral_group_query_ts","fec_nack","search_in_storage_usage","c","media-amt2-1.cdn.whatsapp.net","linked_devices_ui_enabled","14","async_data_load_on_startup","voip_incoming_xml_ack","16","db_migration_step","init_bwe","max_participants","wam_buffer_count","media.fada2-2.fna.whatsapp.net","media.fadb3-1.fna.whatsapp.net","media.fcor2-2.fna.whatsapp.net","media.fdiy1-2.fna.whatsapp.net","media.frba3-2.fna.whatsapp.net","media.fsaw2-3.fna.whatsapp.net","1280","status_grid_enabled","w:biz","product_catalog_deeplink","media.fgye10-2.fna.whatsapp.net","media.fuio11-1.fna.whatsapp.net","optimistic_upload","work_manager_init","lc","catalog_message","cond_net_medium","enable_periodical_aud_rr_processing","cond_range_ema_rtt","media-tir2-1.cdn.whatsapp.net","frame_ms","group_invite_sending","payments_web_enabled","wallpapers_v2","0d","browser","hq_image_max_edge","image_edit_zoom","linked_devices_re_auth_enabled","media.faly3-2.fna.whatsapp.net","media.fdoh5-3.fna.whatsapp.net","media.fesb3-1.fna.whatsapp.net","media.fknu1-1.fna.whatsapp.net","media.fmex3-1.fna.whatsapp.net","media.fruh4-3.fna.whatsapp.net","255","web_upgrade_to_md_modal","audio_piggyback_timeout_msec","enable_audio_oob_fec_feature","from_ip","image_max_edge","message_qr_enabled","powersave","receipt_pre_acking","video_max_edge","full","011","012","enable_audio_oob_fec_for_sender","md_voip_enabled","enable_privatestats","max_fec_ratio","payments_cs_faq_url","media-xsp1-3.cdn.whatsapp.net","hq_image_quality","media.fasr1-2.fna.whatsapp.net","media.fbog3-1.fna.whatsapp.net","media.ffjr1-6.fna.whatsapp.net","media.fist2-3.fna.whatsapp.net","media.flim4-3.fna.whatsapp.net","media.fpbc2-4.fna.whatsapp.net","media.fpku1-1.fna.whatsapp.net","media.frba1-1.fna.whatsapp.net","media.fudi1-1.fna.whatsapp.net","media.fvvi1-2.fna.whatsapp.net","gcm_fg_service","enable_dec_ltr_size_check","clear","lg","media.fgru11-1.fna.whatsapp.net","18","media-lga3-2.cdn.whatsapp.net","pkey","0e","max_subject","cond_range_lterm_rtt","announcement_groups","biz_profile_options","s_t","media.fabv2-1.fna.whatsapp.net","media.fcai3-1.fna.whatsapp.net","media.fcgh1-1.fna.whatsapp.net","media.fctg1-4.fna.whatsapp.net","media.fdiy1-1.fna.whatsapp.net","media.fisb4-1.fna.whatsapp.net","media.fpku1-2.fna.whatsapp.net","media.fros9-1.fna.whatsapp.net","status_v3_text","usync_sidelist","17","announcement","...","md_group_notification","0f","animated_pack_in_store","013","America/Mexico_City","1260","media-ams4-1.cdn.whatsapp.net","media-cgk1-2.cdn.whatsapp.net","media-cpt1-1.cdn.whatsapp.net","media-maa2-1.cdn.whatsapp.net","media.fgye10-1.fna.whatsapp.net","e","catalog_cart","hfm_string_changes","init_bitrate","packless_hsm","group_info","America/Belem","50","960","cond_range_bwe","decode","encode","media.fada1-8.fna.whatsapp.net","media.fadb1-2.fna.whatsapp.net","media.fasu6-1.fna.whatsapp.net","media.fbog4-1.fna.whatsapp.net","media.fcgk9-2.fna.whatsapp.net","media.fdoh5-2.fna.whatsapp.net","media.ffjr1-2.fna.whatsapp.net","media.fgua1-1.fna.whatsapp.net","media.fgye1-1.fna.whatsapp.net","media.fist1-4.fna.whatsapp.net","media.fpbc2-2.fna.whatsapp.net","media.fres2-1.fna.whatsapp.net","media.fsdq1-2.fna.whatsapp.net","media.fsub6-5.fna.whatsapp.net","profilo_enabled","template_hsm","use_disorder_prefetching_timer","video_codec_priority","vpx_max_qp","ptt_reduce_recording_delay","25","iphone","Windows","s_o","Africa/Lagos","abt","media-kut2-1.cdn.whatsapp.net","media-mba1-1.cdn.whatsapp.net","media-mxp1-2.cdn.whatsapp.net","md_blocklist_v2","url_text","enable_short_offset","group_join_permissions","enable_audio_piggyback_feature","image_quality","media.fcgk7-2.fna.whatsapp.net","media.fcgk8-2.fna.whatsapp.net","media.fclo7-1.fna.whatsapp.net","media.fcmn1-1.fna.whatsapp.net","media.feoh1-1.fna.whatsapp.net","media.fgyd4-3.fna.whatsapp.net","media.fjed4-4.fna.whatsapp.net","media.flim1-4.fna.whatsapp.net","media.flim2-4.fna.whatsapp.net","media.fplu6-1.fna.whatsapp.net","media.frak1-1.fna.whatsapp.net","media.fsdq1-1.fna.whatsapp.net","to_ip","015","vp8","19","21","1320","auth_key_ver","message_processing_dedup","server-error","wap4_enabled","420","014","cond_range_rtt","ptt_fast_lock_enabled","media-ort2-1.cdn.whatsapp.net","fwd_ui_start_ts"];t.DICTIONARY_2_TOKEN=i;const a=["contact_blacklist","Asia/Jakarta","media.fepa10-1.fna.whatsapp.net","media.fmex10-3.fna.whatsapp.net","disorder_prefetching_start_when_empty","America/Bogota","use_local_probing_rx_bitrate","America/Argentina/Buenos_Aires","cross_post","media.fabb1-1.fna.whatsapp.net","media.fbog4-2.fna.whatsapp.net","media.fcgk9-1.fna.whatsapp.net","media.fcmn2-1.fna.whatsapp.net","media.fdel3-1.fna.whatsapp.net","media.ffjr1-1.fna.whatsapp.net","media.fgdl5-1.fna.whatsapp.net","media.flpb1-2.fna.whatsapp.net","media.fmex2-1.fna.whatsapp.net","media.frba2-2.fna.whatsapp.net","media.fros2-2.fna.whatsapp.net","media.fruh2-1.fna.whatsapp.net","media.fybz2-2.fna.whatsapp.net","options","20","a","017","018","mute_always","user_notice","Asia/Kolkata","gif_provider","locked","media-gua1-1.cdn.whatsapp.net","piggyback_exclude_force_flush","24","media.frec39-1.fna.whatsapp.net","user_remove","file_max_size","cond_packet_loss_pct_ema_alpha","media.facc1-1.fna.whatsapp.net","media.fadb2-1.fna.whatsapp.net","media.faly3-1.fna.whatsapp.net","media.fbdo6-2.fna.whatsapp.net","media.fcmn2-2.fna.whatsapp.net","media.fctg1-3.fna.whatsapp.net","media.ffez1-2.fna.whatsapp.net","media.fist1-3.fna.whatsapp.net","media.fist2-2.fna.whatsapp.net","media.flim2-2.fna.whatsapp.net","media.fmct2-3.fna.whatsapp.net","media.fpei3-1.fna.whatsapp.net","media.frba3-1.fna.whatsapp.net","media.fsdu8-2.fna.whatsapp.net","media.fstu2-1.fna.whatsapp.net","media_type","receipt_agg","016","enable_pli_for_crc_mismatch","live","enc_rekey","frskmsg","d","media.fdel11-2.fna.whatsapp.net","proto","2250","audio_piggyback_enable_cache","skip_nack_if_ltrp_sent","mark_dtx_jb_frames","web_service_delay","7282","catalog_send_all","outgoing","360","30","LIMITED","019","audio_picker","bpv2_phase","media.fada1-7.fna.whatsapp.net","media.faep7-1.fna.whatsapp.net","media.fbko1-2.fna.whatsapp.net","media.fbni1-2.fna.whatsapp.net","media.fbtz1-1.fna.whatsapp.net","media.fbtz1-8.fna.whatsapp.net","media.fcjs3-1.fna.whatsapp.net","media.fesb3-2.fna.whatsapp.net","media.fgdl5-4.fna.whatsapp.net","media.fist2-1.fna.whatsapp.net","media.flhe2-2.fna.whatsapp.net","media.flim2-1.fna.whatsapp.net","media.fmex1-1.fna.whatsapp.net","media.fpat3-2.fna.whatsapp.net","media.fpat3-3.fna.whatsapp.net","media.fros2-1.fna.whatsapp.net","media.fsdu8-1.fna.whatsapp.net","media.fsub3-2.fna.whatsapp.net","payments_chat_plugin","cond_congestion_no_rtcp_thr","green_alert","not-a-biz","..","shops_pdp_urls_config","source","media-dus1-1.cdn.whatsapp.net","mute_video","01b","currency","max_keys","resume_check","contact_array","qr_scanning","23","b","media.fbfh15-1.fna.whatsapp.net","media.flim22-1.fna.whatsapp.net","media.fsdu11-1.fna.whatsapp.net","media.fsdu15-1.fna.whatsapp.net","Chrome","fts_version","60","media.fada1-6.fna.whatsapp.net","media.faep4-2.fna.whatsapp.net","media.fbaq5-1.fna.whatsapp.net","media.fbni1-1.fna.whatsapp.net","media.fcai3-2.fna.whatsapp.net","media.fdel3-2.fna.whatsapp.net","media.fdmm3-2.fna.whatsapp.net","media.fhex3-1.fna.whatsapp.net","media.fisb4-2.fna.whatsapp.net","media.fkhi5-2.fna.whatsapp.net","media.flos2-1.fna.whatsapp.net","media.fmct2-1.fna.whatsapp.net","media.fntr7-1.fna.whatsapp.net","media.frak3-1.fna.whatsapp.net","media.fruh5-2.fna.whatsapp.net","media.fsub6-1.fna.whatsapp.net","media.fuab1-2.fna.whatsapp.net","media.fuio1-1.fna.whatsapp.net","media.fver1-1.fna.whatsapp.net","media.fymy1-1.fna.whatsapp.net","product_catalog","1380","audio_oob_fec_max_pkts","22","254","media-ort2-2.cdn.whatsapp.net","media-sjc3-1.cdn.whatsapp.net","1600","01a","01c","405","key_frame_interval","body","media.fcgh20-1.fna.whatsapp.net","media.fesb10-2.fna.whatsapp.net","125","2000","media.fbsb1-1.fna.whatsapp.net","media.fcmn3-2.fna.whatsapp.net","media.fcpq1-1.fna.whatsapp.net","media.fdel1-2.fna.whatsapp.net","media.ffor2-1.fna.whatsapp.net","media.fgdl1-4.fna.whatsapp.net","media.fhex2-1.fna.whatsapp.net","media.fist1-2.fna.whatsapp.net","media.fjed5-2.fna.whatsapp.net","media.flim6-4.fna.whatsapp.net","media.flos2-2.fna.whatsapp.net","media.fntr6-2.fna.whatsapp.net","media.fpku3-2.fna.whatsapp.net","media.fros8-1.fna.whatsapp.net","media.fymy1-2.fna.whatsapp.net","ul_bw","ltrp_qp_offset","request","nack","dtx_delay_state_reset","timeoffline","28","01f","32","enable_ltr_pool","wa_msys_crypto","01d","58","dtx_freeze_hg_update","nack_if_rpsi_throttled","253","840","media.famd15-1.fna.whatsapp.net","media.fbog17-2.fna.whatsapp.net","media.fcai19-2.fna.whatsapp.net","media.fcai21-4.fna.whatsapp.net","media.fesb10-4.fna.whatsapp.net","media.fesb10-5.fna.whatsapp.net","media.fmaa12-1.fna.whatsapp.net","media.fmex11-3.fna.whatsapp.net","media.fpoa33-1.fna.whatsapp.net","1050","021","clean","cond_range_ema_packet_loss_pct","media.fadb6-5.fna.whatsapp.net","media.faqp4-1.fna.whatsapp.net","media.fbaq3-1.fna.whatsapp.net","media.fbel2-1.fna.whatsapp.net","media.fblr4-2.fna.whatsapp.net","media.fclo8-1.fna.whatsapp.net","media.fcoo1-2.fna.whatsapp.net","media.ffjr1-4.fna.whatsapp.net","media.ffor9-1.fna.whatsapp.net","media.fisb3-1.fna.whatsapp.net","media.fkhi2-2.fna.whatsapp.net","media.fkhi4-1.fna.whatsapp.net","media.fpbc1-2.fna.whatsapp.net","media.fruh2-2.fna.whatsapp.net","media.fruh5-1.fna.whatsapp.net","media.fsub3-1.fna.whatsapp.net","payments_transaction_limit","252","27","29","tintagel","01e","237","780","callee_updated_payload","020","257","price","025","239","payments_cs_phone_number","mediaretry","w:auth:backup:token","Glass.caf","max_bitrate","240","251","660","media.fbog16-1.fna.whatsapp.net","media.fcgh21-1.fna.whatsapp.net","media.fkul19-2.fna.whatsapp.net","media.flim21-2.fna.whatsapp.net","media.fmex10-4.fna.whatsapp.net","64","33","34","35","interruption","media.fabv3-1.fna.whatsapp.net","media.fadb6-1.fna.whatsapp.net","media.fagr1-1.fna.whatsapp.net","media.famd1-1.fna.whatsapp.net","media.famm6-1.fna.whatsapp.net","media.faqp2-3.fna.whatsapp.net"];t.DICTIONARY_3_TOKEN=a;const o=[r,n,i,a];t.DICTIONARIES=o},45506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapJid=t.WAP_JID_SUBTYPE=void 0;var n=r(52230);const i={JID:0,JID_AD:1,JID_FB:3};t.WAP_JID_SUBTYPE=i;class a{constructor(e){this._jid=e}static createAD(e,t,r){return new a({type:i.JID_AD,user:e,device:null==r?0:r,agent:null==t?0:t})}static createFbJid(e,t){return new a({type:i.JID_FB,user:e,device:null==t?0:t})}static create(e,t){return new a({type:i.JID,user:e,server:t})}toString(){if(this._jid.type===i.JID_AD){const{user:e,agent:t,device:r}=this._jid,i=n.WA_USER_JID_SUFFIX;return 0===t&&0===r?`${e}@${i}`:0!==t&&0===r?`${e}.${t}@${i}`:0===t&&0!==r?`${e}:${r}@${i}`:`${e}.${t}:${r}@${i}`}if(this._jid.type===i.JID_FB){const{user:e,device:t}=this._jid;return`${e}:${t}@${n.MSGR_USER_JID_SUFFIX}`}{this._jid.type;const{user:e,server:t}=this._jid;return null!=e?`${e}@${t}`:t}}getInnerJid(){return this._jid}}t.WapJid=a},71914:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapParser=void 0;var n=r(34308);t.WapParser=class{constructor(e,t){this._name=e,this._parser=t}parse(e){const t=new n.ParsableWapNode(this._name,e);try{return{success:this._parser(t)}}catch(e){if(e instanceof n.XmppParsingFailure)return{error:e};throw e}}parseOrThrow(e){const t=this.parse(e);if(t.error)throw new Error(String(t.error));return t.success}}},61070:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_MEDIA_KEY_TTL=void 0,t.isMediaKeyReusable=function(e){const t=Math.floor(Math.random()*i);return null!=e&&(0,n.happenedWithin)(e,a+t)};var n=r(92844);const i=n.DAY_SECONDS,a=2*n.DAY_SECONDS;t.MMS_MEDIA_KEY_TTL=a},2555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_MEDIA=void 0,t.castToServerMediaType=function(e){switch(e){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":return e;default:return null}};t.SERVER_MEDIA=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image"]},71610:(e,t)=>{"use strict";function r(e){return 16*parseInt((e+15)/16,10)}Object.defineProperty(t,"__esModule",{value:!0}),t.alignChunkLengthsToMultipleOfAesBlockSize=function(e,t){const n=[];let i=0,a=0,o=0;for(let s=0;s<e.length;++s){if(i+=e[s],s===e.length-1&&null!=t){i>a?n.push(t-a):(n.pop(),n.push(t-o));break}if(i>a){const e=r(i-a);o=a,n.push(e),a+=e}}return n},t.alignChunkSizeToMultipleAesBlockSize=r},17525:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketClosed=t.FrameSocket=void 0;var n=r(8584);class i extends Error{constructor(e){const t="SocketClosed";super(null!=e?e:t),this.name=t}}t.SocketClosed=i;function a(e){if(e.size()<3)return!1;return o(e)<=e.size()}function o(e){return e.readUint8()<<16|e.readUint16()}t.FrameSocket=class{constructor(e,t){this._incoming=new n.Binary,this.closed=!1,this._draining=!1,this.onFrame=null,this.onClose=null,this._handleData=e=>{this._incoming.writeByteArray(e),this.convertBufferedToFrames()},this._handleClose=()=>{if(this._incoming.peek(a))return __LOG__(2)`FrameSocket closed, waiting for pending processing`,void(this._draining=!0);this._doClose()},this._doClose=()=>{if(this.closed)return;__LOG__(2)`FrameSocket closed`,this._draining=!1,this.closed=!0;const e=this.onClose;e&&e()},this._handleError=e=>{__LOG__(4,void 0,new Error)`FrameSocket error ${e}`},this._introToSend=t,this._socket=e,e.onData=this._handleData,e.onClose=this._handleClose,e.onError=this._handleError}sendFrame(e){if(this._draining)return;this.throwIfClosed();const t=this._introToSend,r=e.byteLength,n=this._socket.dataToSend;t?(this._introToSend=null,n.ensureAdditionalCapacity(t.length+3+r),n.writeByteArray(t)):n.ensureAdditionalCapacity(3+r),n.writeUint8(r>>16),n.writeUint16(65535&r),n.write(e),this._socket.requestSend()}convertBufferedToFrames(){const e=this._incoming;let t=this.onFrame;for(;t&&e.peek(a);){const r=o(e);__LOG__(2)`FrameSocket.onFrame(${r} bytes)`;t(e.readByteArray(r)),t=this.onFrame}this._draining&&!e.peek(a)&&this._doClose(),t&&e.size()&&__LOG__(2)`FrameSocket: queueing partial frame of ${e.size()} bytes`}throwIfClosed(){if(this.closed)throw new i}close(){this._socket.close()}}},10095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseHandshake=void 0;var n=r(8584),i=r(81576),a=r(73045),o=r(11609),s=r(43891),l=r(88156);const c=Promise.reject("UNINITIALIZED HANDSHAKE"),d=new Uint8Array(0);c.catch((()=>{}));function u(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["encrypt","decrypt"];return self.crypto.subtle.importKey("raw",new Uint8Array(e),"AES-GCM",!1,t)}function f(e,t){return(0,i.extractWithSaltAndExpand)(t,new Uint8Array(e),"",64).then((e=>[e.slice(0,32),e.slice(32)]))}function _(e){e.catch((()=>{}))}t.NoiseHandshake=class{constructor(e){this._hash=c,this._salt=c,this._cryptoKey=c,this._counter=0,this._socket=e,this._rejectOnClose=new l.Resolvable,e.onClose=()=>{this._rejectOnClose.reject(new o.Disconnected("NoiseHandshake: SocketClosed"))},_(this._rejectOnClose.promise)}start(e,t){const r=n.Binary.build(e).readBuffer(),i=32===r.byteLength?Promise.resolve(r):(0,a.sha256)(r);this._hash=i,this._salt=i,this._cryptoKey=i.then(p),this.authenticate(t)}sendAndReceive(e){const t=this._socket,r=new Promise((r=>{t.onFrame=e=>{t.onFrame=null,r(e)},t.sendFrame(e)}));return this._orRejectOnClose(r)}send(e){this._socket.sendFrame(e)}authenticate(e){this._hash=Promise.all([this._hash,e]).then((e=>{let[t,r]=e;const i=n.Binary.build(t,r).readByteArray();return(0,a.sha256)(i)}))}encrypt(e){const t=this._counter++,r=Promise.all([this._cryptoKey,this._hash,e]).then((e=>{let[r,n,i]=e;return function(e,t,r,n){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:u(t),additionalData:r?new Uint8Array(r):d},e,n)}(r,t,n,i)}));return this.authenticate(r),this._orRejectOnClose(r)}decrypt(e){const t=this._counter++,r=Promise.all([this._cryptoKey,this._hash]).then((r=>{let[n,i]=r;return function(e,t,r,n){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:u(t),additionalData:r?new Uint8Array(r):d},e,n)}(n,t,i,e)}));return this.authenticate(e),this._orRejectOnClose(r)}finish(){const e=this._salt.then((e=>f(e,new Uint8Array(0)))).then((e=>{let[t,r]=e;return Promise.all([p(t,["encrypt"]),p(r,["decrypt"])])})).then((e=>{let[t,r]=e;return new s.NoiseSocket(this._socket,t,r)}));return this._orRejectOnClose(e)}mixIntoKey(e){this._counter=0;const t=Promise.all([this._salt,e]).then((e=>{let[t,r]=e;return f(t,new Uint8Array(r))}));this._salt=t.then((e=>e[0])),this._cryptoKey=t.then((e=>p(e[1]))),_(this._salt),_(this._cryptoKey)}_orRejectOnClose(e){return Promise.race([e,this._rejectOnClose.promise]).then((e=>this._rejectOnClose.resolveWasCalled()?this._rejectOnClose.promise:e))}}},43891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseSocket=void 0;var n=r(27870);const i=Promise.reject("UNINITIALIZED HANDSHAKE"),a=new Uint8Array(0);i.catch((()=>{}));function o(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}t.NoiseSocket=class{constructor(e,t,r){this._incoming=[],this._readQueue=new n.PromiseQueue,this._sendQueue=new n.PromiseQueue,this._readCounter=0,this._writeCounter=0,this._draining=!1,this._sendCiphertextFrame=e=>{this._socket.closed?__LOG__(2)`NoiseSocket socket closed while encrypting frame`:this._socket.sendFrame(e)},this._handleCiphertext=e=>{const t=this._readCounter++;this._readQueue.enqueueHandlers(function(e,t,r,n){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:o(t),additionalData:r?new Uint8Array(r):a},e,n)}(this._readKey,t,void 0,e),this._handlePlaintext)},this._handleOnClose=()=>{this._draining=!0,this._readQueue.wait().then((()=>{this._draining=!1;const e=this._onClose;e&&e()}))},this._handlePlaintext=e=>{this._onFrame?this._onFrame(e):this._incoming.push(e)},this._socket=e,this._writeKey=t,this._readKey=r,e.onFrame=this._handleCiphertext,this._socket.onClose=this._handleOnClose,e.convertBufferedToFrames()}sendFrame(e){if(this._draining)return;this._socket.throwIfClosed();const t=this._writeCounter++;var r,n,i,s;this._sendQueue.enqueueHandlers((r=this._writeKey,n=t,i=void 0,s=e,self.crypto.subtle.encrypt({name:"AES-GCM",iv:o(n),additionalData:i?new Uint8Array(i):a},r,s)),this._sendCiphertextFrame)}setOnFrame(e){this._onFrame=e}setOnClose(e){this._onClose=e}close(){this._socket.close()}}},44396:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleError=function(e){return a.parse(e),"NO_ACK"};var n=r(71914);const i=479,a=new n.WapParser("errorParser",(e=>{e.assertTag("error");const t=e.attrInt("code");switch(t){case i:return __LOG__(4,void 0,new Error,!0)`Invalid stanza sent (smax-invalid)`,void SEND_LOGS("smax-invalid");default:return function(e){__LOG__(4,void 0,new Error,!0)`Unknown error code: ${e}`,SEND_LOGS("unknown-error-code")}(t)}}))},48095:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaConnParser=void 0;var n=r(2555);const i=new(r(71914).WapParser)("mediaConnParser",(e=>{var t,r;const n=e.child("media_conn");return{hosts:n.mapChildrenWithTag("host",o),authToken:n.attrString("auth"),authTTL:n.hasAttr("auth_ttl")?n.attrFutureTime("auth_ttl"):null,authExpires:n.attrFutureTime("ttl"),maxBuckets:n.hasAttr("max_buckets")?n.attrInt("max_buckets"):null,maxManualRetry:null!==(t=n.maybeAttrInt("max_manual_retry",0,4))&&void 0!==t?t:3,maxAutoDownloadRetry:null!==(r=n.maybeAttrInt("max_auto_download_retry",0,4))&&void 0!==r?r:3}}));function a(e){var t,r;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:null!==(t=e.maybeAttrString("fallback_ip4"))&&void 0!==t?t:void 0,ip6:null!==(r=e.maybeAttrString("fallback_ip6"))&&void 0!==r?r:void 0}}function o(e){var t,r,n,i;return{domain:e.attrString("hostname"),fallback:a(e),uploadable:s(e,"upload"),downloadable:s(e,"download"),isFallback:"fallback"===e.maybeAttrString("type"),downloadBuckets:null!==(t=null===(r=e.maybeChild("download_buckets"))||void 0===r?void 0:r.mapChildren((e=>parseInt(e.tag(),10))))&&void 0!==t?t:[],class:e.maybeAttrString("class"),ip4:null!==(n=e.maybeAttrString("ip4"))&&void 0!==n?n:void 0,ip6:null!==(i=e.maybeAttrString("ip6"))&&void 0!==i?i:void 0}}function s(e,t){return e.hasChild(t)?e.child(t).mapChildren((e=>{const t=e.tag();return(0,n.castToServerMediaType)(t)})).filter(Boolean):n.SERVER_MEDIA}t.mediaConnParser=i},50073:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionSpec=t.SyncdValueSpec=t.SyncdSnapshotSpec=t.SyncdRecordSpec=t.SyncdPatchSpec=t.SyncdMutationsSpec=t.SyncdMutationSyncdOperation=t.SyncdMutationSpec=t.SyncdIndexSpec=t.KeyIdSpec=t.ExternalBlobReferenceSpec=t.ExitCodeSpec=void 0;var n=r(1390);const i=r(54302)({SET:0,REMOVE:1});t.SyncdMutationSyncdOperation=i;const a={};t.SyncdVersionSpec=a;const o={};t.ExitCodeSpec=o;const s={};t.SyncdIndexSpec=s;const l={};t.SyncdValueSpec=l;const c={};t.KeyIdSpec=c;const d={};t.SyncdRecordSpec=d;const u={};t.ExternalBlobReferenceSpec=u;const p={};t.SyncdSnapshotSpec=p;const f={};t.SyncdMutationsSpec=f;const _={};t.SyncdMutationSpec=_;const h={};t.SyncdPatchSpec=h,a.internalSpec={version:[1,n.TYPES.UINT64]},o.internalSpec={code:[1,n.TYPES.UINT64],text:[2,n.TYPES.STRING]},s.internalSpec={blob:[1,n.TYPES.BYTES]},l.internalSpec={blob:[1,n.TYPES.BYTES]},c.internalSpec={id:[1,n.TYPES.BYTES]},d.internalSpec={index:[1,n.TYPES.MESSAGE,s],value:[2,n.TYPES.MESSAGE,l],keyId:[3,n.TYPES.MESSAGE,c]},u.internalSpec={mediaKey:[1,n.TYPES.BYTES],directPath:[2,n.TYPES.STRING],handle:[3,n.TYPES.STRING],fileSizeBytes:[4,n.TYPES.UINT64],fileSha256:[5,n.TYPES.BYTES],fileEncSha256:[6,n.TYPES.BYTES]},p.internalSpec={version:[1,n.TYPES.MESSAGE,a],records:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,d],mac:[3,n.TYPES.BYTES],keyId:[4,n.TYPES.MESSAGE,c]},f.internalSpec={mutations:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_]},_.internalSpec={operation:[1,n.TYPES.ENUM,i],record:[2,n.TYPES.MESSAGE,d]},h.internalSpec={version:[1,n.TYPES.MESSAGE,a],mutations:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_],externalMutations:[3,n.TYPES.MESSAGE,u],snapshotMac:[4,n.TYPES.BYTES],patchMac:[5,n.TYPES.BYTES],keyId:[6,n.TYPES.MESSAGE,c],exitCode:[7,n.TYPES.MESSAGE,o],deviceIndex:[8,n.TYPES.UINT32]}},381:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionValueSpec=t.SyncActionValue$UnarchiveChatsSettingSpec=t.SyncActionValue$SyncActionMessageSpec=t.SyncActionValue$SyncActionMessageRangeSpec=t.SyncActionValue$StarActionSpec=t.SyncActionValue$SecurityNotificationSettingSpec=t.SyncActionValue$RecentStickerWeightsActionSpec=t.SyncActionValue$RecentStickerMetadataSpec=t.SyncActionValue$RecentEmojiWeightsActionSpec=t.SyncActionValue$QuickReplyActionSpec=t.SyncActionValue$PushNameSettingSpec=t.SyncActionValue$PrimaryFeatureSpec=t.SyncActionValue$PinActionSpec=t.SyncActionValue$MuteActionSpec=t.SyncActionValue$MarkChatAsReadActionSpec=t.SyncActionValue$LocaleSettingSpec=t.SyncActionValue$LabelEditActionSpec=t.SyncActionValue$LabelAssociationActionSpec=t.SyncActionValue$KeyExpirationSpec=t.SyncActionValue$FavoriteStickerActionSpec=t.SyncActionValue$DeleteMessageForMeActionSpec=t.SyncActionValue$DeleteChatActionSpec=t.SyncActionValue$ContactActionSpec=t.SyncActionValue$ClearChatActionSpec=t.SyncActionValue$ArchiveChatActionSpec=t.SyncActionValue$AndroidUnsupportedActionsSpec=t.SyncActionDataSpec=t.RecentStickerWeightSpec=t.RecentEmojiWeightSpec=void 0;var n=r(1390),i=r(72493);const a={};t.RecentStickerWeightSpec=a;const o={};t.RecentEmojiWeightSpec=o;const s={};t.SyncActionValueSpec=s;const l={};t.SyncActionValue$AndroidUnsupportedActionsSpec=l;const c={};t.SyncActionValue$PrimaryFeatureSpec=c;const d={};t.SyncActionValue$KeyExpirationSpec=d;const u={};t.SyncActionValue$SyncActionMessageSpec=u;const p={};t.SyncActionValue$SyncActionMessageRangeSpec=p;const f={};t.SyncActionValue$UnarchiveChatsSettingSpec=f;const _={};t.SyncActionValue$DeleteChatActionSpec=_;const h={};t.SyncActionValue$ClearChatActionSpec=h;const g={};t.SyncActionValue$MarkChatAsReadActionSpec=g;const m={};t.SyncActionValue$DeleteMessageForMeActionSpec=m;const y={};t.SyncActionValue$ArchiveChatActionSpec=y;const E={};t.SyncActionValue$FavoriteStickerActionSpec=E;const S={};t.SyncActionValue$RecentEmojiWeightsActionSpec=S;const v={};t.SyncActionValue$RecentStickerMetadataSpec=v;const T={};t.SyncActionValue$RecentStickerWeightsActionSpec=T;const C={};t.SyncActionValue$LabelEditActionSpec=C;const A={};t.SyncActionValue$LabelAssociationActionSpec=A;const b={};t.SyncActionValue$QuickReplyActionSpec=b;const P={};t.SyncActionValue$LocaleSettingSpec=P;const M={};t.SyncActionValue$PushNameSettingSpec=M;const O={};t.SyncActionValue$SecurityNotificationSettingSpec=O;const I={};t.SyncActionValue$PinActionSpec=I;const w={};t.SyncActionValue$MuteActionSpec=w;const R={};t.SyncActionValue$ContactActionSpec=R;const D={};t.SyncActionValue$StarActionSpec=D;const N={};t.SyncActionDataSpec=N,a.internalSpec={filehash:[1,n.TYPES.STRING],weight:[2,n.TYPES.FLOAT]},o.internalSpec={emoji:[1,n.TYPES.STRING],weight:[2,n.TYPES.FLOAT]},s.internalSpec={timestamp:[1,n.TYPES.INT64],starAction:[2,n.TYPES.MESSAGE,D],contactAction:[3,n.TYPES.MESSAGE,R],muteAction:[4,n.TYPES.MESSAGE,w],pinAction:[5,n.TYPES.MESSAGE,I],securityNotificationSetting:[6,n.TYPES.MESSAGE,O],pushNameSetting:[7,n.TYPES.MESSAGE,M],quickReplyAction:[8,n.TYPES.MESSAGE,b],recentStickerWeightsAction:[9,n.TYPES.MESSAGE,T],recentStickerMetadata:[10,n.TYPES.MESSAGE,v],recentEmojiWeightsAction:[11,n.TYPES.MESSAGE,S],labelEditAction:[14,n.TYPES.MESSAGE,C],labelAssociationAction:[15,n.TYPES.MESSAGE,A],localeSetting:[16,n.TYPES.MESSAGE,P],archiveChatAction:[17,n.TYPES.MESSAGE,y],deleteMessageForMeAction:[18,n.TYPES.MESSAGE,m],keyExpiration:[19,n.TYPES.MESSAGE,d],markChatAsReadAction:[20,n.TYPES.MESSAGE,g],clearChatAction:[21,n.TYPES.MESSAGE,h],deleteChatAction:[22,n.TYPES.MESSAGE,_],unarchiveChatsSetting:[23,n.TYPES.MESSAGE,f],primaryFeature:[24,n.TYPES.MESSAGE,c],favoriteStickerAction:[25,n.TYPES.MESSAGE,E],androidUnsupportedActions:[26,n.TYPES.MESSAGE,l]},l.internalSpec={allowed:[1,n.TYPES.BOOL]},c.internalSpec={flags:[1,n.FLAGS.REPEATED|n.TYPES.STRING]},d.internalSpec={expiredKeyEpoch:[1,n.TYPES.INT32]},u.internalSpec={key:[1,n.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,n.TYPES.INT64]},p.internalSpec={lastMessageTimestamp:[1,n.TYPES.INT64],lastSystemMessageTimestamp:[2,n.TYPES.INT64],messages:[3,n.FLAGS.REPEATED|n.TYPES.MESSAGE,u]},f.internalSpec={unarchiveChats:[1,n.TYPES.BOOL]},_.internalSpec={messageRange:[1,n.TYPES.MESSAGE,p]},h.internalSpec={messageRange:[1,n.TYPES.MESSAGE,p]},g.internalSpec={read:[1,n.TYPES.BOOL],messageRange:[2,n.TYPES.MESSAGE,p]},m.internalSpec={deleteMedia:[1,n.TYPES.BOOL],messageTimestamp:[2,n.TYPES.INT64]},y.internalSpec={archived:[1,n.TYPES.BOOL],messageRange:[2,n.TYPES.MESSAGE,p]},E.internalSpec={directPath:[1,n.TYPES.STRING],lastUploadTimestamp:[2,n.TYPES.STRING],handle:[3,n.TYPES.STRING],encFilehash:[4,n.TYPES.STRING],stickerHashWithoutMeta:[5,n.TYPES.STRING],mediaKey:[6,n.TYPES.STRING],mediaKeyTimestamp:[7,n.TYPES.INT64],isFavorite:[8,n.TYPES.BOOL]},S.internalSpec={weights:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,o]},v.internalSpec={directPath:[1,n.TYPES.STRING],encFilehash:[2,n.TYPES.STRING],mediaKey:[3,n.TYPES.STRING],stanzaId:[4,n.TYPES.STRING],chatJid:[5,n.TYPES.STRING],participant:[6,n.TYPES.STRING],isSentByMe:[7,n.TYPES.BOOL]},T.internalSpec={weights:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,a]},C.internalSpec={name:[1,n.TYPES.STRING],color:[2,n.TYPES.INT32],predefinedId:[3,n.TYPES.INT32],deleted:[4,n.TYPES.BOOL]},A.internalSpec={labeled:[1,n.TYPES.BOOL]},b.internalSpec={shortcut:[1,n.TYPES.STRING],message:[2,n.TYPES.STRING],keywords:[3,n.FLAGS.REPEATED|n.TYPES.STRING],count:[4,n.TYPES.INT32],deleted:[5,n.TYPES.BOOL]},P.internalSpec={locale:[1,n.TYPES.STRING]},M.internalSpec={name:[1,n.TYPES.STRING]},O.internalSpec={showNotification:[1,n.TYPES.BOOL]},I.internalSpec={pinned:[1,n.TYPES.BOOL]},w.internalSpec={muted:[1,n.TYPES.BOOL],muteEndTimestamp:[2,n.TYPES.INT64]},R.internalSpec={fullName:[1,n.TYPES.STRING],firstName:[2,n.TYPES.STRING]},D.internalSpec={starred:[1,n.TYPES.BOOL]},N.internalSpec={index:[1,n.TYPES.BYTES],value:[2,n.TYPES.MESSAGE,s],padding:[3,n.TYPES.BYTES],version:[4,n.TYPES.INT32]}},62109:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decryptCipherText=function(e,t,r){return(0,i.aesCbcDecrypt)(t,e,r)},t.generateAssociatedData=function(e,t){let r;switch(e){case s.SyncdMutationSyncdOperation.SET:r=l.OPERATION_SET_HEX;break;case s.SyncdMutationSyncdOperation.REMOVE:r=l.OPERATION_REMOVE_HEX}if(r){r=new Uint8Array([parseInt(r,16)]).buffer;const e=r,n=new Uint8Array(r.byteLength+t.byteLength);return n.set(new Uint8Array(e)),n.set(new Uint8Array(t),e.byteLength),n.buffer}throw new Error("invalid mutation operation value")},t.generateCipherText=function(e,t,r){return(0,i.aesCbcEncrypt)(t,r,e)},t.generateEncryptionKeys=void 0,t.generateIndexMac=function(e,t){return(0,a.hmacSha256)(new Uint8Array(e),new Uint8Array(t))},t.generateMac=function(e,t,r){const n=new Uint8Array(l.OCTET_LENGTH);n.set([e.byteLength],n.byteLength-1);const i=(0,d.combine)([e,t,n.buffer]);return(0,a.hmacSha512)(r,i,l.MAC_LENGTH)},t.generatePadding=function(e,t){const r=Math.max(0,l.MAX_OF_MIN_DATA_LENGTH-e-t),n=new Uint8Array(r);return self.crypto.getRandomValues(n),n.buffer},t.generatePatchMac=function(e,t,r,n,i){return(0,a.hmacSha256)(e,(0,d.combine)([t,...r,n,i]))},t.generateSnapshotMac=function(e,t,r,n){return(0,a.hmacSha256)(e,(0,d.combine)([t,r,n]))},t.valueMacFromIndexAndValueCipherText=function(e){const t=e.byteLength;return new Uint8Array(e).slice(t-l.MAC_LENGTH).buffer};var n=r(15688),i=r(81484),a=r(11141),o=r(14950),s=r(50073),l=r(32458),c=r(40184),d=r(63109);const u=(0,o.memoizeWithArgs)(c.generateEncryptionKeysUnmemoized,n.encodeB64);t.generateEncryptionKeys=u},32458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_MAC_KEY_LENGTH=t.VALUE_MAC_KEY_END=t.VALUE_ENCRYPTION_KEY_LENGTH=t.VALUE_ENCRYPTION_KEY_END=t.SNAPSHOT_MAC_KEY_LENGTH=t.SNAPSHOT_MAC_KEY_END=t.PATCH_MAC_KEY_LENGTH=t.PATCH_MAC_KEY_END=t.OPERATION_SET_HEX=t.OPERATION_REMOVE_HEX=t.OCTET_LENGTH=t.MAX_OF_MIN_DATA_LENGTH=t.MAC_LENGTH=t.IV_LENGTH=t.INDEX_KEY_LENGTH=t.INDEX_KEY_END=t.HKDF_INFO=t.EMPTY_MUTATION_MAC=t.DERIVED_KEY_LENGTH=void 0;t.HKDF_INFO="WhatsApp Mutation Keys";t.DERIVED_KEY_LENGTH=160;t.INDEX_KEY_LENGTH=32;t.VALUE_ENCRYPTION_KEY_LENGTH=32;t.VALUE_MAC_KEY_LENGTH=32;t.SNAPSHOT_MAC_KEY_LENGTH=32;t.PATCH_MAC_KEY_LENGTH=32;t.INDEX_KEY_END=32;t.VALUE_ENCRYPTION_KEY_END=64;t.VALUE_MAC_KEY_END=96;t.SNAPSHOT_MAC_KEY_END=128;t.PATCH_MAC_KEY_END=160;t.OPERATION_SET_HEX="0x01";t.OPERATION_REMOVE_HEX="0x02";t.MAX_OF_MIN_DATA_LENGTH=0;t.MAC_LENGTH=32;t.OCTET_LENGTH=8;t.IV_LENGTH=16;const r=new ArrayBuffer(32);t.EMPTY_MUTATION_MAC=r},40184:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEncryptionKeysUnmemoized=function(){return s.apply(this,arguments)};var i=n(r(11504)),a=r(81576),o=r(32458);function s(){return(s=(0,i.default)((function*(e){const t=yield l(e);return{indexKey:t.slice(0,o.INDEX_KEY_END),valueEncryptionKey:t.slice(o.INDEX_KEY_END,o.VALUE_ENCRYPTION_KEY_END),valueMacKey:t.slice(o.VALUE_ENCRYPTION_KEY_END,o.VALUE_MAC_KEY_END),snapshotMacKey:t.slice(o.VALUE_MAC_KEY_END,o.SNAPSHOT_MAC_KEY_END),patchMacKey:t.slice(o.SNAPSHOT_MAC_KEY_END,o.PATCH_MAC_KEY_END)}}))).apply(this,arguments)}function l(e){return(0,a.extractAndExpand)(e,o.HKDF_INFO,o.DERIVED_KEY_LENGTH)}},63109:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16))).toString().replace(/,/g," ")},t.arrayBufferToHexPadded=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")},t.combine=function(e){if(0===e.length)throw new Error("buffers length is zero");if(1===e.length)return e[0];const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),r=new Uint8Array(t);let n,i=0;for(n=0;n<e.length;n++)r.set(new Uint8Array(e[n]),i),i+=e[n].byteLength;return r.buffer},t.hexToUint8Array=function(e){return Uint8Array.from(e.split(" ").map((e=>parseInt(e,16))))},t.split=function(e,t,r){if(t<0||r<0)throw new Error("buffers length is zero");const n=new Array(3),i=new Uint8Array(e);return n[0]=i.slice(0,t).buffer,n[1]=i.slice(t,t+r).buffer,n[2]=i.slice(t+r).buffer,n},t.to64BitNetworkOrder=function(e){const t=new ArrayBuffer(8);return new DataView(t).setUint32(4,e,!1),t},t.toUtf8=function(e){return r.encode(e)};const r=new TextEncoder},97245:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(e){return(0,u.redeemPrivateStatsToken)().then((t=>t?{result:t}:g(e).then((e=>{const t=(0,i.default)({},e),{result:r}=e;return r?(0,u.savePrivateStatsToken)(r).then((()=>t)):t}))))},t.issuePrivateStatsToken=g;var i=n(r(73982)),a=r(8584),o=r(36184),s=r(11609),l=r(72287),c=r(92844),d=r(47957),u=r(11562),p=r(31914),f=r(71914),_=r(14462);const h=new f.WapParser("issuePrivateStatsToken",(e=>{const t=e.child("sign_credential");return{signedCredential:t.child("signed_credential").contentBytes(),acsPublicKey:t.child("acs_public_key").contentBytes()}}));function g(e){const t=(0,c.monotonicTime)(),r={overallStartTime:t,retryStartTime:t,retryAttemptsLeft:3},n=new Uint8Array(32);self.crypto.getRandomValues(n);const u=new Uint8Array(32);self.crypto.getRandomValues(u);const f=(0,d.blindToken)(n,u),g=new l.PromiseRetryLoop({name:"issuePrivateStatsToken",timer:{algo:{type:"exponential",first:250},max:1e3},code:t=>{r.retryAttemptsLeft<3&&(r.retryStartTime=(0,c.monotonicTime)());const l=(0,p.wap)("iq",{xmlns:"privatestats",id:(0,p.generateId)(),type:"get",to:p.S_WHATSAPP_NET},(0,p.wap)("sign_credential",{version:"1"},(0,p.wap)("blinded_credential",null,f)));return(e||o.sendIqWithoutRetry)(l,h).then((e=>{if(!e.success){const n=function(e){switch(e.errorCode){case 400:return"bad-request";case 500:return"internal-server-error";case 501:return"feature-not-implemented";case 503:return"service-unavailable";default:return"unknown"}}(e);return __LOG__(3)`issuePrivateStatsToken: failed ${n}`,void("internal-server-error"!==n||r.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:n})}):r.retryAttemptsLeft--)}const{signedCredential:o,acsPublicKey:s}=e.result,l=(0,d.unblindToken)(o,u,s);if(null==l)return __LOG__(3)`issuePrivateStatsToken: failed to unblind the signed token`,void t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:"decryption-error"})});const c=a.Binary.build(n,l),p=(0,_.hash)(c.readByteArray());t({result:{token:n,sharedSecret:p},metric:(0,i.default)((0,i.default)({},r),{},{result:"success"})})})).catch((e=>{if(!(e instanceof s.Disconnected))return Promise.reject(e);__LOG__(3)`issuePrivateStatsToken: Disconnected`,r.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},r),{},{result:"disconnected"})}):r.retryAttemptsLeft--}))}});return g.start(),g.promise()}},14604:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFinishedPrivateStatsBuffers=function(e){return(0,c.getFinishedStreamBuffers)("private").then((t=>v(t,e)))},t.upload_UNSAFE_INTERNAL_DO_NOT_USE=v;var i=n(r(11504)),a=r(15688),o=r(11141),s=r(72287),l=r(92844),c=r(11562);const d="https://dit.whatsapp.net/deidentified_telemetry",u="245118376424571|3e7d275052f1522bf3200afcf53841a7",p="WAMEventBuffer.dat",f=111e3,_=3067002,h=3067003,g=3067004;function m(e){return{result:e.result,httpResponseCode:e.httpResponseCode,uploadTime:(0,l.monotonicTimeSince)(e.uploadStartTime)}}function y(){return(y=(0,i.default)((function*(e,t,r,n){if((yield(0,c.privateStatsKillSwitchGetBlockedToken)())===u)return __LOG__(2)`Removing private stats buffer without submitting it (kill switch)`,(0,c.removeBufferByKey)(r.key).then((()=>{e()}));const i=(0,l.monotonicTime)(),s=yield n();if(null==s)return __LOG__(4,void 0,new Error)`Couldn't get token to submit a private stats buffer`,void e();const f=new FormData;f.append("access_token",u);const _=yield(0,o.hmacSha256)(s.sharedSecret,r.content),h=(0,a.encodeB64UrlSafe)(s.token,!0),g=(0,a.encodeB64UrlSafe)(_,!0);let m;f.append("credential",`${h}+${g}`),f.append("message",new Blob([r.content],{type:"application/octet-stream"}),p),f.append("meta_data",JSON.stringify({t:(0,l.unixTime)(),p:0}));try{m=yield fetch(d,{method:"POST",body:f,"Content-Type":"multipart/form-data"})}catch(e){return __LOG__(3)`Upload of a private stats buffer failed: ${e}`,void t({uploadStartTime:i,result:"error-other"})}const y=m.status,S=t=>{e({uploadStartTime:i,httpResponseCode:y,result:t})},v=e=>{t({uploadStartTime:i,httpResponseCode:y,result:e})};switch(y){case 200:return(0,c.removeBufferByKey)(r.key).then((()=>{S("success")}));case 429:return void S("error-server-other");case 401:return Promise.all([(0,c.privateStatsKillSwitchSet)(u),(0,c.removeBufferByKey)(r.key)]).then((()=>{S("error-access-token")}));case 400:{const{result:r,shouldRetry:n}=yield E(m),a={uploadStartTime:i,httpResponseCode:y,result:r};return void("retry"===n?t(a):e(a))}case 500:return void v("error-server-other")}__LOG__(3)`Unsupported response status code from PrivateStats upload request: ${y}`,v("error-other")}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=yield e.json().catch((()=>{}));if("object"!=typeof t)return __LOG__(3)`Unable to parse error response 400 from PrivateStats upload request or parsed response is not an object`,{result:"error-other",shouldRetry:"retry"};const{error:r}=t;if("object"!=typeof r)return __LOG__(3)`Incorrect or missing error entry in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};const{code:n,error_subcode:i}=r;if("number"!=typeof n||"number"!=typeof i)return __LOG__(3)`Incorrect code or subcode in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};switch(n){case 9:return{result:"error-server-other",shouldRetry:"no-retry"};case f:switch(i){case _:return{result:"error-parsing",shouldRetry:"retry"};case h:return{result:"error-decoding",shouldRetry:"retry"};case g:return{result:"error-credential",shouldRetry:"retry"};default:return __LOG__(3)`Unsupported subcode value in the error response 400 from PrivateStats upload request: ${i}`,{result:"error-other",shouldRetry:"retry"}}default:return __LOG__(3)`Unsupported code value in the error response 400 from PrivateStats upload request: ${n}`,{result:"error-other",shouldRetry:"retry"}}}))).apply(this,arguments)}function v(e,t){const r=e.map((e=>{let r=3;const n=[],i=new s.PromiseRetryLoop({name:"uploadPrivateStatsBuffer",timer:{algo:{type:"exponential",first:250},max:1e3},code:i=>function(){return y.apply(this,arguments)}(i,(e=>{const t=m(e);n.push(t),r<=0?i():r--}),e,t)});return i.start(),i.promise().then((t=>{if(null!=t){const e=m(t);n.push(e)}return{uploadedBufferKey:"success"===(null==t?void 0:t.result)?e.key:null,metrics:n}}))}));return Promise.all(r).then((e=>{const t=e.reduce(((e,t)=>(e.push(...t.metrics),e)),[]);return{uploadedBufferKeys:e.reduce(((e,t)=>(null!=t.uploadedBufferKey&&e.push(t.uploadedBufferKey),e)),[]),metrics:t}}))}},2486:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_HANDLED=t.DynamicRouter=void 0;const r={sentinel:"RESPONSE_NAMESPACE"},n={sentinel:"NOT_HANDLED"};t.NOT_HANDLED=n;function i(e,t){const n=t.namespace;return n===r?a:e.get(n)}function a(e,t,r){r(t)}function o(e){if(null!=e&&("object"==typeof e||"function"==typeof e)){const t=e.then;return"function"==typeof t?t:null}return null}t.DynamicRouter=class{constructor(){var e=this;this._basePromise=Promise.resolve(),this._handlers=new Map,this._handlerChangeCount=0,this._firstRoute=null,this._nextRoute=null,this._lastRoute=null,this.fireAndForget=function(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e._schedule(t,r,n,null,i)},this.sendAndReceive=function(t,n,i){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise(((s,l)=>{e._schedule(t,n,i,(t=>{try{const n=o(t);n?n.call(t,(t=>{e._schedule(r,"",t,s,a)}),(t=>{e._schedule(r,"",t,l,!1)})):e._schedule(r,"",t,s,a)}catch(t){e._schedule(r,"",t,l,!1)}}),a)}))},this._run=()=>{let e=this._nextRoute;if(!e)return;const t=this._handlers;let r;for(;e&&!(r=i(t,e));)this._nextRoute=e=e.nextRoute;if(!e||!r)return;const a=this._runHandler(r,e);let o=!0;if(a!==n){const t=e.prevRoute,r=e.nextRoute;this._nextRoute===e&&(this._nextRoute=r),t?t.nextRoute=r:this._firstRoute=r,r?r.prevRoute=t:(o=!1,this._lastRoute=t)}return o&&this._basePromise.then(this._run),a}}hasHandlerForNamespace(e){return this._handlers.has(e)}getHandledNamespaces(){return Array.from(this._handlers.keys())}setNamespaceHandler(e,t){const r=this._handlers,n=r.get(e);if(n!==t&&(++this._handlerChangeCount,r.set(e,t),!n)){const e=this._firstRoute;e&&(this._nextRoute||this._basePromise.then(this._run),this._nextRoute=e)}}setHandlers(e,t){this.setNamespaceHandler(e,(function(e,r,n){const i=t[e](r);n&&n(i)}))}_schedule(e,t,r,n,a){const o=this._lastRoute,s={namespace:e,route:t,arg:r,resolver:n,prevRoute:o,nextRoute:null,silentLog:a};this._lastRoute=s;let l=!0;o?(o.nextRoute=s,l=!this._nextRoute):this._firstRoute=s,l&&i(this._handlers,s)&&(this._nextRoute=s,this._basePromise.then(this._run))}_runHandler(e,t){const{route:r,arg:i,resolver:a,silentLog:o}=t,s=this._handlerChangeCount;let l=null,c=null;try{l=e(r,i,a,o)}catch(e){c=Promise.reject(e)}if(l===n){if(s!==this._handlerChangeCount)return n;c=Promise.reject(new Error("DynamicRouter: NOT_HANDLED can only be used when updating handlers"))}if(!a)return c;c&&a(c)}}},81484:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.AesCbcStream=void 0,t.aesCbcDecrypt=_,t.aesCbcDecryptSplit=function(e,t){return Promise.resolve().then((()=>{const r=t.slice(0,16),n=t.slice(16);return _(e,r,n)}))},t.aesCbcEncrypt=function(e,t,r){return Promise.resolve().then((()=>{const n=p(r),i=d(n);return Promise.resolve(u(e)).then((e=>self.crypto.subtle.encrypt(i,e,t))).then((e=>(0,s.concatTypedArrays)(Uint8Array,[n,new Uint8Array(e)]).buffer))}))},t.aesCbcEncryptWithChunking=function(){return h.apply(this,arguments)};var i=n(r(11504)),a=r(8584),o=r(46269),s=r(60977);const l=16,c=16777216;function d(e){return{name:"AES-CBC",iv:(0,o.castTypedArrays)(Uint8Array,e)}}function u(e){return self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function p(e){if(e)return(0,o.castTypedArrays)(Uint8Array,e);const t=new Uint8Array(16);return self.crypto.getRandomValues(t),t}function f(e){const t=e.byteLength,r=l-t%l;return Number.isNaN(r)?t:t+r}function _(e,t,r){const n=d(t);return Promise.resolve(self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then((e=>self.crypto.subtle.decrypt(n,e,r)))}function h(){return(h=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;if(n%l!=0)throw new Error(`chunkSize must be a multiple of 16, ${n} received`);const i=yield u(e),a=new Uint8Array(t),o=Math.ceil(a.byteLength/n),s=p(r),_=new Uint8Array(f(a)+s.byteLength);_.set(s);for(let e,t,r=0,l=s;r<o;r++){const c=r===o-1,u=r*n;e=a.subarray(u,u+n),t=yield self.crypto.subtle.encrypt(d(l),i,e).then((e=>c?new Uint8Array(e):new Uint8Array(e).subarray(0,-16))),_.set(t,s.byteLength+r*n),l=t.slice(-16)}return _.buffer}))).apply(this,arguments)}t.AesCbcStream=class{constructor(e,t,r,n){this._input=null,this._finished=!1,this._output=e,this._type=t,this._rawKey=r;const i={name:"AES-CBC",iv:n};this._promise=self.crypto.subtle.importKey("raw",r,"AES-CBC",!1,[t]).then((e=>({algo:i,key:e})))}append(e){let t;this._throwIfFinished("append");const r=this._input;if(r)if(r.writeByteArray(e),r.size()>1024){const e=r.size()%l;t=r.readByteArray(r.size()-e),r.size()||(this._input=null)}else t=null;else if(e.length>1024){const r=e.length%l;r?(this._input=new a.Binary(e),t=this._input.readByteArray(e.length-r)):t=e}else this._input=new a.Binary(e),t=null;const n=t;return n&&(this._promise=this._promise.then((e=>{let{key:t,algo:r}=e;if("encrypt"===this._type)return self.crypto.subtle.encrypt(r,t,n).then((e=>(this._output.writeByteArray(new Uint8Array(e,0,e.byteLength-l)),new Uint8Array(e,e.byteLength-32,l))));{const e=n.slice(-16);return self.crypto.subtle.decrypt(r,t,n).then((t=>(this._output.writeBuffer(t),e)))}})).then((e=>{const t={name:"AES-CBC",iv:e};return self.crypto.subtle.importKey("raw",this._rawKey,"AES-CBC",!1,[this._type]).then((e=>({algo:t,key:e})))}))),this._promise.then((()=>{}))}finalize(e){let t;if(this._throwIfFinished("finalize"),this._input?(e&&this._input.writeByteArray(e),t=this._input.readByteArray(),this._input=null):e&&(t=e),t){const e=t;return this._promise.then((t=>{let{algo:r,key:n}=t;return"encrypt"===this._type?self.crypto.subtle.encrypt(r,n,e):self.crypto.subtle.decrypt(r,n,e)})).then((e=>{this._output.writeBuffer(e)}))}return this._promise.then((()=>{}))}_throwIfFinished(e){if(this._finished)throw new Error(`AesCbcStream.${e} called after finalize`)}}},30141:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allocate=o,t.elligator=C,t.fieldElement=s,t.hashSha512=function(e,t,r){n.lowlevel.crypto_hash(e,t,r)},t.hashToPoint=function(e){return a((()=>function(e){const{unpack25519:t}=n.lowlevel,r=(0,n.hash)(e),i=(128&r[31])>>7;r[31]&=127;const a=s();t(a,r);const l=s();C(l,a);const c=u();!function(e,t,r){const{unpack25519:i,M:a}=n.lowlevel,l=s();i(l,v);const c=s();!function(e,t){const{Z:r,A:i,M:a}=n.lowlevel,o=d(),l=s(),c=s(),u=s();r(l,t,o),i(c,t,o),b(u,c),a(e,l,u)}(c,t);const u=s();h(u,t);const p=s();!function(e,t){const{unpack25519:r,pow2523:i,M:a,S:o}=n.lowlevel,l=s();r(l,m);const c=s();i(c,t);const d=s();a(d,t,c);const u=s();o(u,d);const p=s();a(p,d,l),g(d,p,1^(f=u,_=t,P(f,_)?0:1)),e.set(d);var f,_}(p,u);const f=s();a(f,t,l);const _=s();b(_,p);const E=s();a(E,f,_);const S=s();y(S,E),g(E,S,function(e){const{pack25519:t}=n.lowlevel,r=o(Uint8Array,32);return t(r,e),1&r[0]}(E)^r),e[0].set(E),e[1].set(c),e[2].set(d()),a(e[3],e[0],e[1])}(c,l,i);const f=u();return function(e,t){const r=[s(),s(),s(),s()],i=p();(function(e,t){const r=p();(function(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])})(r,t),S(e,r)})(r,t),E(i,r),S(r,i),E(i,r),S(r,i),function(e,t){const{M:r}=n.lowlevel;r(e[0],t[0],t[3]),r(e[1],t[1],t[2]),r(e[2],t[2],t[3]),r(e[3],t[0],t[1])}(e,r)}(f,c),f}(e)))},t.inv25519=b,t.modL=l,t.p3Element=u,t.pack=A,t.reduce=function(e,t){for(let r=0;r<64;++r)t[r]=e[r],e[r]=0;l(e,t),t.fill(0)},t.runInAllocationScope=a,t.scalarmultBase=function(e,t){const r=[s(),s(),s(),s()];n.lowlevel.scalarbase(r,t),A(e,r)},t.unpack=function(e,t){const r=u();if(0!==M(r,t))return-1;return function(e,t){y(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),y(e[3],t[3])}(e,r),0},t.unpackneg=M;var n=r(14462);let i=null;function a(e){const t=i;i=[];try{return e()}finally{var r;(null!==(r=i)&&void 0!==r?r:[]).forEach((e=>{e.fill(0)})),i=t}}function o(e,t){if(null==i)throw new Error("allocate called outside of active scope");return new e(t)}function s(e){const t=o(Float64Array,16);if(e){if(e.length>16)throw new Error("Incorrect initialiser array provided to the fieldElement");for(let r=0;r<e.length;r++)t[r]=e[r]}return t}function l(e,t){n.lowlevel.modL(e,t)}const c=()=>s([0]),d=()=>s([1]);function u(){return[s(),s(),s(),s()]}function p(){return[s(),s(),s()]}function f(e,t){let r=0,n=t;for(;n>0;){const t=n%65536;e[r]=t,n=(n-t)/65536,r++}}function _(e,t){const{S:r,M:i}=n.lowlevel,a=s([2]),o=s();r(o,t),i(e,a,o)}function h(e,t){const{S:r,M:i,A:a}=n.lowlevel,o=c(),l=d(),u=s(),p=s(),_=s(),h=s();f(o,486662),r(u,t),i(p,o,t),a(_,u,p),a(h,_,l),i(e,t,h)}function g(e,t,r){1===r&&e.set(t)}const m=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function y(e,t){const{Z:r}=n.lowlevel;r(e,c(),t)}function E(e,t){const{M:r}=n.lowlevel;r(e[0],t[0],t[3]),r(e[1],t[1],t[2]),r(e[2],t[2],t[3])}function S(e,t){const{S:r,A:i,Z:a}=n.lowlevel;r(e[0],t[0]),r(e[2],t[1]),_(e[3],t[2]),i(e[1],t[0],t[1]);const o=s();r(o,e[1]),i(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],o,e[1]),a(e[3],e[3],e[2])}const v=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function T(e,t){const{M:r,A:i}=n.lowlevel,a=d(),o=c();f(o,486662);const l=s();_(l,t);const u=s();i(u,l,a);const p=s();b(p,u);const m=s();r(m,p,o);const E=s();y(E,m);const S=s();h(S,E);const v=function(e){const{S:t,M:r,pow2523:i,pack25519:a}=n.lowlevel,o=s(),l=s(),c=s(),d=s(),u=s();i(o,e),t(l,o),t(c,l),r(d,c,e),r(u,d,e);const p=new Uint8Array(32);return a(p,u),1&p[31]}(S),T=s([0]);g(T,o,v);const C=s();i(C,E,T);const A=s();y(A,C),g(C,A,v),e.set(C)}function C(e,t){return a((()=>T(e,t)))}function A(e,t){const r=s(),i=s(),a=s(),{M:o,pack25519:l}=n.lowlevel;b(a,t[2]),o(r,t[0],a),o(i,t[1],a),l(e,i);const c=new Uint8Array(32);l(c,r),e[31]^=(1&c[0])<<7}function b(e,t){const r=s();r.set(t);const{M:i,S:a}=n.lowlevel;for(let e=253;e>=0;--e)a(r,r),2!==e&&4!==e&&i(r,r,t);e.set(r)}function P(e,t){const{pack25519:r,crypto_verify_32:i}=n.lowlevel,a=new Uint8Array(32),o=new Uint8Array(32);return r(a,e),r(o,t),i(a,0,o,0)}function M(e,t){const{set25519:r,S:i,M:a,Z:o,A:l,D:u,unpack25519:p,pow2523:f}=n.lowlevel,_=s(),h=s(),g=s(),m=s(),y=s(),E=s(),S=s();return r(e[2],d()),p(e[1],t),i(g,e[1]),a(m,g,u),o(g,g,e[2]),l(m,e[2],m),i(y,m),i(E,y),a(S,E,y),a(_,S,g),a(_,_,m),f(_,_),a(_,_,g),a(_,_,m),a(_,_,m),a(e[0],_,m),i(h,e[0]),a(h,h,m),P(h,g)&&a(e[0],e[0],s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])),i(h,e[0]),a(h,h,m),P(h,g)?-1:(function(e){const{pack25519:t}=n.lowlevel,r=new Uint8Array(32);return t(r,e),1&r[0]}(e[0])===t[31]>>7&&o(e[0],c(),e[0]),a(e[3],e[0],e[1]),0)}},81576:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expand=o,t.extractAndExpand=function(e,t,r){return(0,i.extractSha256)(null,e).then((e=>o(new Uint8Array(e),t,r)))},t.extractWithSaltAndExpand=function(e,t,r,n){return(0,i.extractSha256)(t,e).then((e=>o(new Uint8Array(e),r,n)))};var n=r(8584),i=r(11141);const a=255*i.SHA256_BYTE_LENGTH;function o(e,t,r){if(r<0||r>a)return Promise.reject(new Error(`HKDF::expand given bad length ${r}`));let o;const s=Math.ceil(r/i.SHA256_BYTE_LENGTH),l=n.Binary.build(t).readByteArray(),c=new n.Binary;let d=(0,i.encodeKeySha256)(e).then((e=>(o=e,new Uint8Array(0))));for(let e=1;e<=s;e++)d=d.then((t=>(0,i.sign)(o,n.Binary.build(t,l,e).readByteArray()))).then((e=>{const t=new Uint8Array(e);return c.writeByteArray(t),t}));return d.then((()=>c.readBuffer(r)))}},11141:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHA256_BYTE_LENGTH=t.DEFAULT_SALT=void 0,t.encodeKeySha256=function(e){return l(a,e)},t.extractSha256=function(e,t){return l(a,null!=e?e:i).then((e=>c(e,t)))},t.hmacSha1=function(e,t,r){return l(s,e).then((e=>c(e,t,r)))},t.hmacSha256=function(e,t,r){return l(a,e).then((e=>c(e,t,r)))},t.hmacSha512=function(e,t,r){return l(o,e).then((e=>c(e,t,r)))},t.sign=c;var n=r(46269);t.SHA256_BYTE_LENGTH=32;const i=new Uint8Array(32);t.DEFAULT_SALT=i;const a={name:"HMAC",hash:"SHA-256"},o={name:"HMAC",hash:"SHA-512"},s={name:"HMAC",hash:"SHA-1"};function l(e,t){const r=(0,n.castTypedArrays)(Uint8Array,t);return self.crypto.subtle.importKey("raw",r,e,!1,["sign"]).then((t=>({key:t,algo:e})))}function c(e,t,r){let{key:n,algo:i}=e;return self.crypto.subtle.sign(i,n,t).then((e=>null!=r&&0!==r?e.slice(0,r):e))}},899:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.LtHash16=t.LT_HASH_ANTI_TAMPERING=t.KEY_LENGTH_BYTES=t.EMPTY_LT_HASH=void 0;var i=n(r(11504)),a=r(81576);const o=128;t.KEY_LENGTH_BYTES=o;const s=new ArrayBuffer(o);t.EMPTY_LT_HASH=s;class l{constructor(e){this.salt=e}add(e,t){var r=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return r._addSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtract(e,t){var r=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return r._subtractSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtractThenAdd(e,t,r){var n=this;return(0,i.default)((function*(){return n.add(yield n.subtract(e,r),t)}))()}_addSingle(e,t){var r=this;return(0,i.default)((function*(){const n=yield(0,a.extractAndExpand)(t,r.salt,o);return r.performPointwiseWithOverflow(e,n,((e,t)=>e+t))}))()}_subtractSingle(e,t){var r=this;return(0,i.default)((function*(){const n=yield(0,a.extractAndExpand)(t,r.salt,o);return r.performPointwiseWithOverflow(e,n,((e,t)=>e-t))}))()}performPointwiseWithOverflow(e,t,r){const n=new DataView(e),i=new DataView(t),a=new ArrayBuffer(n.byteLength),o=new DataView(a);for(let e=0;e<n.byteLength;e+=2)o.setUint16(e,r(n.getUint16(e,!0),i.getUint16(e,!0)),!0);return a}}t.LtHash16=l;const c=new l("WhatsApp Patch Integrity");t.LT_HASH_ANTI_TAMPERING=c},73045:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha256=i,t.sha256Base64=function(e){return Promise.resolve(i(e).then(n.encodeB64))};var n=r(15688);function i(e){return Promise.resolve(self.crypto.subtle.digest({name:"SHA-256"},e))}},7589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areBuffersEqual=function(e,t){return i(new Uint8Array(e),new Uint8Array(t))},t.areBytesEqual=i,t.randomNumberLessThan=function(e){if(e!==(0|e))throw new Error("bound must be int32");if(e<=0)throw new Error("bound must not be positive");const t=new Int32Array(1),r=e*Math.floor((-1>>>1)/e);let n=-1;for(;-1===n;){self.crypto.getRandomValues(t);const i=t[0]>>>1;i<r&&(n=i%e)}return n};var n=r(14462);function i(e,t){return 0===e.length&&0===t.length||(0,n.verify)(e,t)}},96573:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.addMessageIds=function(e,t){if(null!=t){const r=new Set;[e.ids,t].forEach((e=>e.forEach((e=>{r.has(e)||r.add(e)})))),e.ids=Array.from(r.values())}},t.buildEntry=function(e,t){if(!e||0===e.length)throw new Error("FtsIndexEntry: Expected non-empty blindIndices in constructor");return{ids:(0,i.default)(t,"ids"),prefixes:e,token:e[e.length-1]}};var i=n(r(45095))},44152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildEntry=function(e,t,r,n){return{id:e,chatId:t,token:r,timestamp:n}}},14056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildDBEntry=function(e,t,r,n,i){return{ftsRowId:e,id:t,chatId:r,timestamp:n,prefixes:i}},t.buildEntry=function(e,t,r,n){return{id:e,chatId:t,timestamp:r,prefixes:n}}},74391:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getJidUtilsApi=function(){return function(){if(null==i)throw new Error("Globals called before set");return i}().jidUtils},t.setGlobals=a;var n=r(52230);let i=null;function a(e){i=e}a({jidUtils:(0,n.createJidUtils)({platform:"whatsapp"})})},18269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsatisfiableJobRequirement=t.JobRequirement=void 0,t.joinRequirements=function(e,t){const r=e.filter((e=>!e.isSatisfiable()));if(r.length>0){const e=r.map((e=>e.name));return n=>(null==t||t("unsatisfiable",e,n),r[0].waitUntilSatisfied())}let n=e.map((()=>Promise.resolve())),i=Promise.resolve(),a=null;const o=()=>{if(n.every(((t,r)=>t===e[r].waitUntilSatisfied())))return void(a=null);const t=[],r=e.map((e=>{const r=e.waitUntilSatisfied();return e.isSatisfied()||(t.push(e.name),r.then((()=>{const r=t.indexOf(e.name);t.splice(r,1)}))),r}));return n=r,a=t,Promise.all(r).then(o)};return e=>{if(null==a){const e=o();null!=e&&(i=i.then((()=>e)))}return null==t||t(null==a?"satisfied":"unsatisfied",a,e),i}};class r{constructor(e){this._waitingOn=Promise.resolve(),this._satisfied=!0,this._newBlockers=null,this._blockersFinished=()=>{const e=this._newBlockers;if(null!=e)return this._newBlockers=null,Promise.all(e).then(this._blockersFinished);this._satisfied=!0},this.name=e}addBlocker(e){const t=e.catch((e=>{__LOG__(4,void 0,new Error,!0)`JobRequirement[${this.name}] blocker errored ${e}`,SEND_LOGS("job-blocker-rejected")}));if(this._satisfied)this._satisfied=!1,this._waitingOn=Promise.all([this._waitingOn,t]).then(this._blockersFinished);else{const e=this._newBlockers;null!=e?e.push(t):this._newBlockers=[t]}}waitUntilSatisfied(){return this._waitingOn}isSatisfied(){return this._satisfied}isSatisfiable(){return!0}}t.JobRequirement=r;t.UnsatisfiableJobRequirement=class extends r{constructor(e){super(e),super.addBlocker(new Promise((()=>{})))}addBlocker(){}isSatisfiable(){return!1}}},47901:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTARTED_JOB=t.RetryOnBackoff=t.RequiresPage=t.PersistedJobManager=t.InterruptJob=t.FINISHED_JOB=void 0;var i=n(r(11504)),a=r(18269),o=r(37178),s=r(92844);class l{constructor(e){this.feature=e}toString(){return`RequiresPage: ${this.feature}`}}t.RequiresPage=l;class c{constructor(e){this.backoffOptions=e}toString(){return"RetryOnBackoff"}}t.RetryOnBackoff=c;class d{constructor(e){this.result=e}}t.InterruptJob=d;const u="$unstarted";t.UNSTARTED_JOB=u;const p="$finished";t.FINISHED_JOB=p;function f(e){return`Job[${e.jobId}] (${e.type})`}function _(e){return`Job[${e.jobId}] (${e.type}.${e.step})`}function h(e,t,r){"unsatisfiable"===e?__LOG__(2)`${_(r)} halting because of ${t}`:"unsatisfied"===e&&__LOG__(2)`${_(r)} waiting on ${t}`}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{jobStartTime:e.startTime,afterCrash:t,interruptJob:m}}function m(e){return new d(e)}t.PersistedJobManager=class{constructor(e){const{isRestartAfterCrash:t,accessors:r,unfinishedJobEntries:n}=e,i=new Map,a=n.then((e=>{const n=[],a=[];return e.forEach((e=>{e.stepHardStartCountAfterTimeout>=5?n.push(e):a.push(e)})),Promise.all(n.map((e=>{var t;return __LOG__(4,void 0,new Error,!0)`${t=e,`[Job ${t.type}] `}: stuck on the step ${e.step}, aborting the job`,SEND_LOGS(`job-stuck-${e.type}`),r.deletePersistedJob(e.jobId)}))).then((()=>{a.forEach((e=>{i.has(e.jobId)||(__LOG__(2)`${f(e)}: restarting`,i.set(e.jobId,this._runJob(e,t)))}))}))}));this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=r,this.activeJobs=i,this.initialJobsPromise=a,this.listeners=e.listeners,this.deprecatedJobs=e.deprecatedJobs}loadAndRunJobFromId(e){const t=this.activeJobs.get(e);if(null!=t)return t;const r=this._loadAndRunJobFromId(e);return this.activeJobs.set(e,r),r}_loadAndRunJobFromId(e){var t=this;return(0,i.default)((function*(){const{initialJobsPromise:r,accessors:n}=t;yield r;const i=yield n.readPersistedJob(e);return i?t._runJob(i,!1):(__LOG__(4,void 0,new Error,!0)`No entry for job ${e}`,SEND_LOGS("missing-job-entry"),null)}))()}_getJobImplementation(e){const{implementations:t,implementationLoaders:r}=this,n=t.get(e);if(n)return n;const i=r.get(e);if(!i)return null;const a=i();return t.set(e,a),a}_waitForBlockers(e,t){if(null==t||0===t.length)return Promise.resolve();const{stepBlockers:r}=this;let n=r.get(t);return null==n&&(n=(0,a.joinRequirements)(t.map((e=>e())),h),r.set(t,n)),n(e)}_runRemainingSteps(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;const{step:i}=e,a=t.findIndex((e=>e.stepName===i)),{requirements:o,code:l}=t[a].info(e.current,e.original,g(e,r));let c=this._waitForBlockers(e,o);return n&&(c=c.then(n)),c.then((()=>(__LOG__(2)`${_(e)}: running step`,l(e.current,e.original,g(e,r))))).then((n=>{if(n instanceof d)return __LOG__(2)`${_(e)}: InterruptJob`,n.result;const i=a+1;if(i>=t.length)return n;const o=t[i];return e.step=o.stepName,e.current=n,e.stepHardStartCountAfterTimeout=0,e.stepFirstStartTime=(0,s.unixTime)(),e.stepUnexpectedErrorCount=0,e.waitUntil=null,e.backedOffCount=0,this.accessors.updatePersistedJob(e).then((()=>this._runRemainingSteps(e,t,r)))}))}_runJob(e,t){var r=this;return(0,i.default)((function*(){var n;const{accessors:a,activeJobs:d,deprecatedJobs:h,listeners:{onJobFinished:m,onJobStarted:y}}=r,E=yield r._getJobImplementation(e.type);if(!E)return h.includes(e.type)?__LOG__(3)`No implementation for deprecated ${e.type}, job deleted`:(__LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}. Maybe it should have been put to the deprecated list?`,SEND_LOGS("missing-job-implementation")),yield a.deletePersistedJob(e.jobId),null;h.includes(e.type);const S=null!==(n=e.stepFirstStartTime)&&void 0!==n?n:(0,s.unixTime)();if(e.stepFirstStartTime=S,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===p){let t=e.waitUntil;const n=(0,s.secondsUntil)(S);return null!=t&&(0,s.isInFuture)(t)&&n>0&&(__LOG__(2)`${f(e)}: skew detected, adjusting accordingly`,t=(0,s.castToUnixTime)(t-n),(0,s.isInFuture)(t)&&(e.stepFirstStartTime=(0,s.castToUnixTime)(S-n),e.waitUntil=t,yield r.accessors.updatePersistedJob(e))),null!=t&&(0,s.isInFuture)(t)||(__LOG__(2)`${f(e)}: removing completed, expired job from db`,yield a.deletePersistedJob(e.jobId)),d.delete(e.jobId),e.current}const v=e.step!==u?E.find((t=>t.stepName===e.step)):E[0];if(!v)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}.${e.step}`,SEND_LOGS("missing-job-step"),yield a.deletePersistedJob(e.jobId),null;e.step=v.stepName;const T=()=>{const n=e.waitUntil;let i=Promise.resolve();if(null!=n){const t=(0,s.futureUnixTime)(s.DAY_SECONDS);n>t?(__LOG__(2)`${_(e)}: trim wait from ${n} to ${t}`,e.waitUntil=t,i=r.accessors.updatePersistedJob(e).then((()=>(0,s.delayUntil)(t)))):(__LOG__(2)`${_(e)}: delaying until ${n}`,i=(0,s.delayUntil)(n))}return i.then((()=>r._runRemainingSteps(e,E,t,(()=>(e.waitUntil=null,(0,s.happenedWithin)(S,s.DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,r.accessors.updatePersistedJob(e)))).catch((t=>{if(t instanceof l)return __LOG__(2)`${_(e)}: requires page`,e.stepHardStartCountAfterTimeout>0&&(--e.stepHardStartCountAfterTimeout,r.accessors.updatePersistedJob(e)),new Promise((()=>{}));if(t instanceof c){__LOG__(2)`${_(e)}: RetryOnBackoff`;const n=(0,o.getDelay)(++e.backedOffCount,t.backoffOptions);return e.waitUntil=(0,s.futureUnixTime)(Math.ceil(n/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,r.accessors.updatePersistedJob(e).then(T)}if(e.stepUnexpectedErrorCount<1)return __LOG__(3)`${_(e)}: Unhandled exception. Tried ${e.stepUnexpectedErrorCount} times`,e.stepUnexpectedErrorCount++,r.accessors.updatePersistedJob(e).then(T);throw t}))))},C=T(),A=C.then(function(){var t=(0,i.default)((function*(t){__LOG__(2)`${_(e)}: finished job`;let n=null;try{n=m(e.jobId,e.type,e.original,t)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobFinished for ${e.type} threw exception ${t}`,SEND_LOGS("onJobFinished-threw")}null!=n&&n>0?(e.waitUntil=(0,s.futureUnixTime)(Math.ceil(n/1e3)),e.step=p,e.current=t,e.stepFirstStartTime=(0,s.unixTime)(),yield r.accessors.updatePersistedJob(e)):(yield a.deletePersistedJob(e.jobId),d.delete(e.jobId))}));return function(){return t.apply(this,arguments)}}(),function(){var r=(0,i.default)((function*(r){__LOG__(4,void 0,new Error,!0)`${e.type} failed with error ${r}`,SEND_LOGS(`job-threw-exception-${e.type}`);const n=E.find((t=>t.stepName===e.step));if(n){const r=n.info(e.current,e.original,g(e,t));null!=r.stopRetryIf&&(yield r.stopRetryIf.onStopRetry(e.current,e.original,g(e,t)))}else __LOG__(4,void 0,new Error)`${e.type}: ${e.step} step not found`;yield a.deletePersistedJob(e.jobId),d.delete(e.jobId)}));return function(){return r.apply(this,arguments)}}());try{y(e.jobId,e.type,e.original)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobStarted for ${e.type} threw exception ${t}`,SEND_LOGS("onJobStarted-threw")}return A.then((()=>C))}))()}addPersistedJobImplementation(e,t){const{implementationLoaders:r,deprecatedJobs:n}=this;if(r.has(e))return __LOG__(4,void 0,new Error,!0)`addPersistedJobImplementation called twice for ${e}`,void SEND_LOGS("repeat-job-loader");n&&n.includes(e),r.set(e,t)}fireAndForget(e){this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}waitUntilPersisted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;this.loadAndRunJobFromId(t)}))}waitUntilCompleted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}}},89385:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortError=t.ABORT_ERROR=void 0,t.catchAbort=function(e){return t=>{if(t.name===a)return e(t);throw t}};var n=r(40265);class i extends((0,n.customError)("AbortError")){}t.AbortError=i;const a="AbortError";t.ABORT_ERROR=a},52613:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncSleep=o,t.asyncSleepAfterGivenLoopIteration=function(){return a.apply(this,arguments)};var i=n(r(11504));function a(){return(a=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;e>0&&e%t==0&&(yield o(r))}))).apply(this,arguments)}function o(e){return new Promise((t=>setTimeout(t,e)))}},30844:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11504)),a=n(r(73982)),o=n(r(45095)),s=n(r(9006));t.default=class{constructor(e,t){this._concurrency=e,this._groupLimits=t,this._runningTasksByGroup=new Map,this._enqueuedTasksByGroup=new Map}clearQueue(){this._enqueuedTasksByGroup.clear(),this._runningTasksByGroup.clear()}enqueue(e,t){let r,n;const o=new Promise(((e,t)=>{r=e,n=t}));var s;return this._doEnqueue((0,a.default)((0,a.default)({},t),{},{run:(s=(0,i.default)((function*(){try{const t=yield e();r(t)}catch(e){n(e)}})),function(){return s.apply(this,arguments)})})),this._runTasks(),o}_doEnqueue(e){this._getOrCreatePriorityQueueForGroup(e.group).push(e)}_doDequeue(){return this._getHighestPriorityAmongGroups()}_runTasks(){for(;this._getRunningTasksCount()<this._concurrency;){const e=this._doDequeue();if(null==e)break;this._runTask(e)}}_runTask(e){var t=this;return(0,i.default)((function*(){const{run:r,signal:n,group:i}=e,a=t._getRunningTasksForGroup(i);if(null==n?void 0:n.aborted)setTimeout((()=>t._runTasks()),0);else{a.add(e);try{yield r()}finally{a.delete(e),setTimeout((()=>t._runTasks()),0)}}}))()}_getHighestPriorityAmongGroups(){var e;let t;for(const e of this._enqueuedTasksByGroup.values()){const r=e.peek();r&&(this._isFullOfGroup(r.group)||(!t||t.priority<r.priority)&&(t=e))}return null===(e=t)||void 0===e?void 0:e.pull()}_getRunningTasksCount(){let e=0;for(const t of this._runningTasksByGroup.values())e+=t.size;return e}getEnqueuedTasksCount(){let e=0;for(const t of this._enqueuedTasksByGroup.values())e+=t.size();return e}_getRunningTasksForGroup(e){if(!this._runningTasksByGroup.has(e)){const t=new Set;return this._runningTasksByGroup.set(e,t),t}return(0,o.default)(this._runningTasksByGroup.get(e),"this._runningTasksByGroup.get(group)")}_isFullOfGroup(e){const t=this._runningTasksByGroup.get(e);return null!=t&&t.size>=this._getLimitForGroup(e)}_getOrCreatePriorityQueueForGroup(e){if(!this._enqueuedTasksByGroup.has(e)){const t=new s.default((e=>e.priority));this._enqueuedTasksByGroup.set(e,t)}return(0,o.default)(this._enqueuedTasksByGroup.get(e),"this._enqueuedTasksByGroup.get(group)")}_getLimitForGroup(e){const t=this._groupLimits[e];return null==t?1/0:t}}},50796:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filteredCatch=function(e,t){return r=>{if(Array.isArray(e)?e.some((e=>r instanceof e)):r instanceof e)return t(r);throw r}}},856:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseAny=function(e){if(0===e.length)return Promise.reject(new n.AggregateError([]));return Promise.all(e.map(i)).then((e=>{throw new n.AggregateError(e)}),(e=>e))};var n=r(40265);function i(e){return new Promise(((t,r)=>Promise.resolve(e).then(r,t)))}},37178:(e,t)=>{"use strict";function r(e){const{relativeDelay:t=!1}=e;let r=null;const a=i(e.algo);return function(){if(null==r)return r=t?Date.now():0,0;let i=n(e,a());if(t){const e=Date.now(),t=e-r;t>0&&(i=Math.max(0,i-t)),r=e}return i}}function n(e,t){let{max:r,min:n,jitter:i=.1}=e,a=t;return null!=r&&a>r&&(a=r),null!=n&&a<n&&(a=n),0!==i&&(a=Math.ceil(a*(1+i*Math.random()))),a}function i(e){switch(e.type){case"fibonacci":return function(e){let t=e.second-e.first,r=e.first-t;return function(){const e=t+r;return r=t,t=e,e}}(e);case"exponential":return function(e){const{base:t=2}=e;let r=e.first;return function(){const e=r;return r*=t,e}}(e);case"constant":return function(e){const t=e.delay;return function(){return t}}(e);case"adjust":return function(e){const{toMs:t,backoff:r}=e,n=i(r);return function(){return t(n())}}(e);default:throw new Error(`makeTimeFunc unrecognized backoff ${e.type}`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseTimer=function(e){const t=r(e);return function(e){return new Promise((r=>{const n=t();n>0?setTimeout(r,n,e):r(e)}))}},t.createTimer=r,t.getDelay=function(e,t){if(0===e)return 0;const r=i(t.algo);for(let t=1;t<e;t++)r();return n(t,r())}},18569:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class r{constructor(e){this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()}}t.default=class{constructor(e,t){let{maxCached:r=10,maxAge:n=1/0,shouldCache:i}=t;this._cache={},this._maxCached=r,this._maxAge=n,this._createPromiseFunc=e,this._shouldCacheFunc=i}getOrRun(e){const t=this._cache;if(this._maxAge!==1/0){const e=Date.now()-this._maxAge,r=Object.keys(t);for(let n=0;n<r.length;n++){const i=r[n];t[i].createdTime<e&&delete t[i]}}const n=t[e];if(n)return n.lastUsedTime=+Date.now(),n.promise;const i=Object.keys(t);if(i.length>=this._maxCached){let e,r;for(let n=0;n<i.length;n++){const a=i[n],o=t[a];(null==r||o.lastUsedTime<r)&&(r=o.lastUsedTime,e=a)}e&&delete t[e]}for(var a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];const l=this._createPromiseFunc.apply(void 0,[e,...o]);return t[e]=new r(l),l.then((t=>{const r=this._shouldCacheFunc;r&&this._cache[e]===l&&!r(t)&&delete this._cache[e]})).catch((()=>{this._cache[e]===l&&delete this._cache[e]})),l}isCached(e){const t=this._cache[e];if(t){let e=!0;if(this._maxAge!==1/0){const r=Date.now()-this._maxAge;e=t.createdTime>=r}return e&&Boolean(t)}return!1}}},18412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseCallSync=function(e,t){try{for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return Promise.resolve(e.apply(t,n))}catch(e){return Promise.reject(e)}}},13959:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delayMs=function(e,t){return new Promise(((r,i)=>{if(null==t?void 0:t.aborted)throw new n.AbortError;const a=setTimeout((function(){null==t||t.removeEventListener("abort",o),r()}),e);function o(){null==t||t.removeEventListener("abort",o),clearTimeout(a),i(new n.AbortError)}null==t||t.addEventListener("abort",o)}))},t.withTimeout=function(e,t,r){return new Promise(((n,i)=>{const a=setTimeout((()=>{try{n(r())}catch(e){i(e)}}),t);e.then((e=>{clearTimeout(a),n(e)}),(e=>{clearTimeout(a),i(e)}))}))};var n=r(89385)},69719:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseEach=void 0;var i=n(r(11504));const a=function(){var e=(0,i.default)((function*(e,t){const r=[];for(let n=0;n<e.length;n++)r.push(yield t(e[n]));return r}));return function(){return e.apply(this,arguments)}}();t.promiseEach=a},4352:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseLoop=function(){return a.apply(this,arguments)};var i=n(r(11504));function a(){return(a=(0,i.default)((function*(e,t){let r,n=!1;const i=e=>{n=!0,r=e};let a=0,o=t;for(;!n;)o=yield e(i,o,a),a++;return r}))).apply(this,arguments)}},67602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseProps=function(e){const t=Object.keys(e);return Promise.all(t.map((t=>e[t]))).then((function(e){const r={};for(let n=0;n<e.length;n++)r[t[n]]=e[n];return r}))}},27870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueMap=t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._promise=Promise.resolve(),this._maxDelay=e}wait(){return this._promise}enqueueHandlers(e,t,n){const i=this._promise.then((()=>e)).then(t,n),a=i.then();return this._promise=r(i,this._maxDelay),a}enqueue(e){const t=this._promise.then(e),n=t.then();return this._promise=r(t,this._maxDelay),n}};function r(e,t){return t>=0?new Promise((r=>{const n=()=>{r()};e.then(n,n),setTimeout(n,t)})):e.then(n,n)}function n(){}t.PromiseQueueMap=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._map=new Map,this._maxDelay=e}waitIfPending(e){return this._map.get(e)}wait(e){return this._map.get(e)||Promise.resolve()}enqueueHandlers(e,t,r,n){const i=this.wait(e).then((()=>t)).then(r,n);return this._addToMap(e,i)}enqueue(e,t){const r=this.wait(e).then(t);return this._addToMap(e,r)}_addToMap(e,t){const n=t.then();let i;const a=()=>{this._map.get(e)===i&&this._map.delete(e)};return i=r(t,this._maxDelay).then(a,a),this._map.set(e,i),n}}},66751:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseReduce=void 0;var i=n(r(11504));const a=function(){var e=(0,i.default)((function*(e,t,r){let n=r;const i=e.length;for(let r=0;r<i;r++)n=yield t(n,e[r],r);return n}));return function(){return e.apply(this,arguments)}}();t.promiseReduce=a},72287:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseRetryLoop=void 0;var n=r(37178),i=r(13959),a=r(88156);t.PromiseRetryLoop=class{constructor(e){this._resolvable=new a.Resolvable,this._promise=null,this._resetTime=null,this._currentLoopIdentificator=0,this.endWithValue=e=>{this._currentLoopIdentificator++,this._resolvable.resolve(e)},this._options=e}resetTimeoutAfter(e){this._resetTime=Date.now()+e}cancelReset(){this._resetTime=null}reset(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: resetting ${this._options.name}`,this._currentLoopIdentificator++,this._runLoop())}start(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: starting ${this._options.name}`,0!==this._currentLoopIdentificator&&__LOG__(4,void 0,new Error)`PromiseRetryLoop was called several times. You may have race conditions`,this._currentLoopIdentificator++,this._runLoop())}_runLoop(){const e=this._options,t=this._currentLoopIdentificator;let r=(0,n.createTimer)(this._options.timer);r();const a=()=>{if(this._resolvable.resolveWasCalled())return;if(t!==this._currentLoopIdentificator)return;const o=Date.now();return this._promise=(0,e.code)(this.endWithValue).then((()=>{if(this._resolvable.resolveWasCalled())return;const{resetDelay:t}=e;(void 0!==t&&Date.now()>=o+t||null!=this._resetTime&&this._resetTime<=Date.now())&&(__LOG__(2)`PromiseRetryLoop: resetting ${e.name}`,r=(0,n.createTimer)(this._options.timer)),this._resetTime=null;const s=r();return __LOG__(2)`PromiseRetryLoop: retrying ${e.name} in ${s}ms`,(0,i.delayMs)(s).then(a)})),this._promise};this._promise=Promise.resolve().then(a)}promise(){return this._resolvable.resolveWasCalled()?this._resolvable.promise:this._promise?Promise.race([this._resolvable.promise,this._promise.then((()=>this._resolvable.promise))]):Promise.reject(new Error(`PromiseRetryLoop ${this._options.name} had promise() called before start()`))}}},38284:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseTimeout=void 0;var n=r(40265);t.promiseTimeout=(e,t,r)=>{let i=null,a=null;const o=new Promise(((e,o)=>{a=o,i=setTimeout((()=>{o(new n.TimeoutError(r)),clearTimeout(i)}),t)}));return Promise.race([e,o]).finally((()=>{a&&a(new Error),clearTimeout(i)}))}},20461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseWrapSync=function(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}},88156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resolvable=void 0;t.Resolvable=class{constructor(){this._isResolved=!1,this.promise=new Promise((e=>{this._resolve=e}))}resolve(e){this._isResolved=!0,this._resolve(e)}reject(e){this.resolve(Promise.reject(e))}resolveWasCalled(){return this._isResolved}}},97197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;t.Semaphore=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._count=0,this._queue=[],this._size=e}acquire(){return new Promise(((e,t)=>{this._performAcquisition(e,t)}))}availablePermits(){return this._size-this._count}_performRelease(){this._count--,this._dequeue()}_performAcquisition(e,t){if(this._count<this._size){this._count++;let t=!1;e({release:()=>{if(t)throw new Error("Permit has already been released");t=!0,this._performRelease()}})}else this._enqueue(e,t)}_enqueue(e,t){this._queue.push([e,t])}_dequeue(){if(0===this._queue.length)return;const[e,t]=this._queue.shift();this._performAcquisition(e,t)}}},74121:(e,t)=>{"use strict";t.Z=y;const r="undefined"!=typeof Promise?Promise:null,n="function"==typeof setImmediate?setImmediate:null;let i=0;const a=[],o=[],s=[],l={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},c={sentinel:"RETRY_ASYNCHRONOUSLY"},d={sentinel:"TO_STRING"},u={sentinel:"DID_ERROR"};let p=null;const f=[],_=64,h=128,g=512,m="undefined"==typeof self?void 0:self;function y(e,t){this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._thenableParent=null,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,t&&(this._context=t.this),"function"==typeof e&&(this._onFulfilled=e,this._flags|=4,this._flags|=256,j(e,this._context,(e=>R(this,0,!0,!1,e)),(e=>R(this,0,!1,!1,e))))}let E,S;function v(e){if(void 0===e)return E;if(I(e))return e;{const t=new y;return R(t,0,!0,!1,e),H(t,g),t}}function T(e){const t=new y;return t._value=e,H(t,514),f.push(t),t}function C(e){let t="";if(e._flags&h){t=(e._onFulfilled||e._onRejected).call(e._context,d)}else if(e._control)t=`.addRawControl(${e._control.name}, ${e._control.foo})`;else if(16&e._flags)t=`.endWithControls(${Object.keys(e.control)})`;else if(e._flags&g)t=1&e._flags?`Promise.resolve(${void 0===e._value?"":e._value})`:`Promise.reject(${void 0===e._value?"":e._value})`;else if(256&e._flags)switch(3&e._flags){case 2:case 0:case 1:t=`new Promise(${e._onFulfilled})`}else e._onFulfilled&&e._onRejected?t=`.then(${e._onFulfilled}, ${e._onRejected})`:e._onFulfilled?t=`.then(${e._onFulfilled})`:e._onRejected&&(t=`.catch(${e._onRejected})`);return t}function A(e){this.message=e,this.stack=new Error(e||this.name).stack}function b(){0===i&&(o.length||f.length)&&(i=1,S||(S=function(){let e,t,i=0;return"undefined"==typeof MutationObserver||m&&m.navigator&&m.navigator.standalone?r?function(){r.resolve().then(x)}:"function"==typeof n?function(){n(x)}:function(){setTimeout(x,0)}:(e=document.createTextNode(""),t=new MutationObserver(x),t.observe(e,{characterData:!0}),function(){e.data=i=1-i})}()),S())}function P(e,t){H(e,8),t._parent=e,e._children?e._children.push(t):e._child?(e._children=[e._child,t],e._child=void 0):e._child=t}function M(e){if(e&&("object"==typeof e||"function"==typeof e)){let t;try{t=e.then}catch(e){return p=e,u}if("function"==typeof t)return t}}function O(e){if(!e||I(e))return e;const t=M(e);if(t===u)return T(p);if(t){const r=new y((function(r,n){t.call(e,r,n)}));return r._thenableParent=e,r}return e}function I(e){return e instanceof y}function w(e,t,r){const n=I(e=O(e));let i,a,o,s,d=!1;if(n){if(!(3&e._flags))return H(e.then(t,r),32);H(e,8),d=!!(e._flags&_),o=e._context,i=1&e._flags?t:r,a=e._value}else i=t,a=e;if(!i)return v(e).then();if(a=W(i,o,a,!0),a===u)s=T(p);else{if(a===c)return v(e).then(t,r);if(a===l)return n?e.then():v(e);s=v(a)}return d&&(s=s.cancellable()),void 0!==o&&(s=s.then(),s._context=o),s}function R(e,t,r,n,i){if(t!==e._resolveLevel)return;const a=++e._resolveLevel;if(H(e,4),e._thenableParent=null,r)if(i===e)e._parent=void 0,G(e,!1,n,new TypeError("promise resolved to itself"));else if(I(i)){const t=3&i._flags;0===t?P(i,e):(e._parent=i,H(e,1024),H(i,8),G(e,1===t,n,i._value))}else{const t=M(i);t===u?(e._parent=void 0,G(e,!1,n,p)):t?(e._parent=void 0,e._thenableParent=i,j(t,i,(t=>R(e,a,!0,!1,t)),(t=>R(e,a,!1,!1,t)))):G(e,!0,n,i)}else G(e,!1,n,i)}function D(e,t,r,n,i){t===e._resolveLevel&&(N(e),R(e,t,r,n,i))}function N(e){if(e._parent){const t=e._parent;if(e._parent=void 0,t._child===e)t._child=void 0;else if(t._children){const r=t._children;for(let t=0;t<r.length;t++)if(r[t]===e){r.splice(t,1);break}0===r.length&&(t._children=void 0)}}}function L(e){if(null==e)throw new Error(`Invalid .catch guard ${e}`);if("function"==typeof e)return e;if("object"==typeof e)throw new Error("Object guards in .catch are currently unsupported");return function(t){return t===e}}function k(e,t){return function(r,n){return r===d?`.catch(..., ${t})`:e&&!function(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n===Error||n.prototype instanceof Error){if(t instanceof n)return!0}else if(n(t))return!0}return!1}(e,r)?l:n?c:t.call(this,r)}}function G(e,t,r,n){if(H(e,4|(t?1:2)),e._value=n,e._child)U(e._child,t,r,n),e._child=void 0;else if(e._children){const i=e._children;e._children=void 0;for(let e=0;e<i.length;e++)U(i[e],t,r,n)}else t||8&e._flags||f.push(e)}function U(e,t,r,n){e._resolveLevel++;const i=Y(e,t);if(i&&32&e._flags){H(e,4);const a=W(i,e._context,n,!0);if(a!==c)return void(a===u?(e._parent=void 0,G(e,!1,r,p)):a===l?G(e,t,r,n):(e._parent=void 0,R(e,e._resolveLevel,!0,r,a)));e._flags&=-5}i?((r?s:o).push(e),b()):G(e,t,r,n)}function F(e,t){for(;0!==e.length;)t.push(e.pop())}function x(){for(;0!==a.length||0!==o.length;){0===a.length&&F(o,a);const e=a.pop(),t=e._parent;let r=!!(t&&1&t._flags),n=t&&t._value;const i=Y(e,r);if(H(e,4),i){let t;do{t=W(i,e._context,n,!1)}while(t===c);t===u?(n=p,r=!1,e._parent=void 0):t!==l&&(n=t,r=!0,e._parent=void 0)}3&e._flags||(R(e,e._resolveLevel,r,!0,n),F(s,a))}for(i--;0!==f.length;){const e=f.pop();8&e._flags||K(e,e._value)}}y.resolve=v,y.reject=T,y.prototype.then=function(e,t){"function"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0);const r=new y;r._onFulfilled=e,r._onRejected=t,r._context=this._context,this._flags&_&&H(r,_);const n=3&this._flags;return 0===n?P(this,r):(H(this,8),(1===n?e:t)?(r._parent=this,o.push(r),b()):(r._parent=this,H(r,n),r._value=this._value,2===n&&f.push(r))),r},y.prototype.catch=function(e){const t=arguments.length-1;if(0===t)return this.then(void 0,e);const r=new Array(t);for(let e=0;e<t;e++)r[e]=L(arguments[e]);const n=k(r,arguments[t]),i=w(this,void 0,n);return i._onRejected&&H(i,h),i},y.all=function(e){return new y((function(t,r){let n=e.length;if(0===n)return void t([]);const i=new Array(e.length);function a(e){if(0==--n){const r=[];for(let t=0;t<i.length;t++){const n=i[t];r.push(n&&3&n._flags?n._value:e)}t(r)}return e}for(let t=0;t<e.length;t++)i[t]=w(e[t],a,r)}))},y.allSettled=function(e){return new y((function(t){const r=Array.from(e);let n=r.length;if(0===n)return void t([]);const i=new Array(r.length);function a(e){return function(r){const a=e?{status:"rejected",reason:r}:{status:"fulfilled",value:r};if(0==--n){const e=[];for(let t=0;t<i.length;t++){const r=i[t];e.push(r&&3&r._flags?r._value:a)}t(e)}return a}}const o=a(!1),s=a(!0);for(let e=0;e<r.length;e++)i[e]=w(r[e],o,s)}))},y.race=function(e){const t=O(e);if(I(t)){const e=t.then((e=>y.race(e)));return e._context=void 0,e._flags&=-65,e}return new y((function(e,r){for(let n=0;n<t.length;n++){const i=O(t[n]);if(!I(i)||3&i._flags)for(e(i),n++;n<t.length;n++){const e=t[n];I(e)&&H(e,8)}else i.then(e,r)}}))},y.prototype.toString=function(){const e=[];let t;for(let r=this,n=!1;r;r=r._parent){t=r,!n&&3&r._flags&&(n=!0,r._flags&g||(1&r._flags?e.push(`[resolved value: ${r._value}]`):e.push(`[rejected reason: ${r._value}]`)));let i=C(r);1024&r._flags&&(i=`~${i}`),e.push(i)}return e.reverse(),768&t._flags||(e[0]=`[Promise]${e[0]}`),e.join("\n")},y.prototype.finally=function(e){function t(t){return t===d?`.finally(${e})`:(e.call(this),l)}return H(this.then(t,t),h)},A.prototype=Object.create(Error.prototype,{name:{value:"AbortError"}}),y.CancellationError=A,y.prototype.cancellable=function(){return H(this.then(),_)},y.prototype.cancel=function(e){let t;for(let e=this;e&&!(3&e._flags);e=e._parent)e._flags&_&&(t=e);if(t)if(void 0===e&&(e=new A),Y(t,!1)){const r=new y;N(t),P(r,t),D(r,0,!1,!1,e)}else D(t,t._resolveLevel,!1,!1,e)};const B=null==(null==m?void 0:m.dispatchEvent)?null:class extends Event{constructor(e,t){super(e,{cancelable:!0}),Object.defineProperties(this,{promise:{value:t.promise,enumerable:!0},reason:{value:t.reason,enumerable:!0}})}};function K(e,t){if(null!=(null==m?void 0:m.dispatchEvent)){const r=new B("unhandledrejection",{promise:e,reason:t});if(m.dispatchEvent(r),!m.PromiseRejectionEvent&&m.onunhandledrejection)try{m.onunhandledrejection(r)}catch(e){}}else"undefined"!=typeof process&&null!=process.emit?process.emit("unhandledRejection",t,e):console.error(`StackPromise did not catch ${t}`,e,t)}function j(e,t,r,n){try{e.call(t,r,n)}catch(e){n(e)}}function Y(e,t){if(!(4&e._flags))return t?e._onFulfilled:e._onRejected}function W(e,t,r,n){try{return n?e.call(t,r,!0):e.call(t,r)}catch(e){return p=e,u}}function H(e,t){return e._flags|=t,e}E=new y,R(E,0,!0,!1,void 0)},8243:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decimalStringToLongInt=function(e){if(!/^-?\d+$/.test(e))throw __LOG__(2)`"${e}" is not a valid decimal string`,new Error("decimalStringToLongInt is given an invalid decimal string");const t="-"===e[0],r=e.replace(/^-?0*/,""),i=r.length;if(i<16||16===i&&r<="9007199254740991")return t?-Number(r):Number(r);if(i>20||20===i&&r>"18446744073709551615"||t&&(i>19||19===i&&r>"9223372036854775807"))throw __LOG__(2)`"${e}" is over 64 bits`,new Error("decimalStringToHexLong is given value over 64 bits");let a=0,o=0;for(let e=0;e<i;e++)a=10*a+Number(r[e]),o=10*o+Math.floor(a/4294967296),a%=4294967296;return(0,n.createHexLongFrom32Bits)(o,a,t)},t.isBiggerLongInt=function(e,t){if("number"==typeof e&&"number"==typeof t)return e>t;const r="number"==typeof e?(0,n.hexLongFromNumber)(e):e,i="number"==typeof t?(0,n.hexLongFromNumber)(t):t;return(0,n.isBiggerHexLong)(r,i)},t.longIntToDecimalString=function(e){if("number"==typeof e)return e.toString(10);const t=(0,n.hexLongToHex)(e),r=[0];let i=0;for(let e=0;e<t.length;e++){i=(0,n.hexAt)(t,e);for(let e=0;e<r.length;e++)r[e]=16*r[e]+i,i=r[e]/10|0,r[e]%=10;for(;i>0;)r.push(i%10),i=i/10|0}const a=r.reverse().join("");return(0,n.hexLongIsNegative)(e)?"-"+a:a},t.maybeNumberOrThrowIfTooLarge=void 0,t.numberOrThrowIfTooLarge=i;var n=r(87614);function i(e){if("number"!=typeof e)throw __LOG__(2)`${e} is not a safe integer`,new Error("numberOrThrowIfTooLarge is given a non-safe integer");return e}t.maybeNumberOrThrowIfTooLarge=e=>null==e?e:i(e)},42098:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spec=void 0,t.compileSpec=function(e){if(e.internalCompiledSpec)return e.internalCompiledSpec;const t=e.internalSpec;if(!t)throw new Error(`Message Class ${String(e)} does not have internalSpec`);const r=e.internalDefaults||{},o=Object.keys(t).filter((e=>e!==n.KEYS.ONEOF)),s=new Array(o.length),l=[],c=[],d=new Array(o.length),u=t[n.KEYS.ONEOF]||{};o.sort(((e,r)=>{const n=a(t,e),i=a(t,r);return n[0]-i[0]}));for(let e=0;e<o.length;e++){const i=o[e],u=a(t,i);d[e]=r[i];const p=u[1],f=u[0];if(l.push(f),c.push(p),(p&n.TYPE_MASK)===n.TYPES.MESSAGE)s[e]=u[2];else if((p&n.TYPE_MASK)===n.TYPES.ENUM){const t=u[2];if("function"==typeof t.cast)s[e]=t;else{let r,n=!0,i=0;for(const e in t)n&&e!==i++&&(n=!1);if(n){r=[];for(let e=0;e<i;e++)r.push(!0)}else{r={};for(const e in t)r[t[e]]=!0}s[e]=r}}else s[e]=null}const p={};for(const e in u)u[e].forEach((t=>{p[t]||(p[t]=[]),p[t].push(e)}));const f=t[n.KEYS.RESERVED]&&t[n.KEYS.RESERVED][n.KEYS.RESERVED_TAGS],_=t[n.KEYS.RESERVED]&&t[n.KEYS.RESERVED][n.KEYS.RESERVED_FIELDS],h=new i(o,l,c,d,s,u,p,f,_);return e.internalCompiledSpec=h,h};var n=r(1390);class i{constructor(e,t,r,n,i,a,o,s,l){this.names=e,this.fields=t,this.types=r,this.defaults=n,this.meta=i,this.oneofToFields=a,this.fieldToOneof=o,this.reservedTags=s?s.reduce(((e,t)=>(e[t]=!0,e)),{}):{},this.reservedFields=l?l.reduce(((e,t)=>(e[t]=!0,e)),{}):{}}}function a(e,t){const r=e[t];if(null==r)throw new Error(`fieldData of ${t} is missing`);return r}t.Spec=i},1390:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_MASK=t.TYPES=t.KEYS=t.FLAGS=t.ENC=void 0;t.FLAGS={REPEATED:64,PACKED:128,REQUIRED:256};t.TYPE_MASK=31;t.TYPES={INT32:1,INT64:2,UINT32:3,UINT64:4,SINT32:5,SINT64:6,BOOL:7,ENUM:8,FIXED64:9,SFIXED64:10,DOUBLE:11,STRING:12,BYTES:13,MESSAGE:14,FIXED32:15,SFIXED32:16,FLOAT:17};t.ENC={VARINT:0,BIT64:1,BINARY:2,BIT32:5};t.KEYS={ONEOF:"__oneofs__",RESERVED:"__reserved__",RESERVED_TAGS:"tags",RESERVED_FIELDS:"fields"}},72058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeToEncType=function(e){if(e&a.PACKED)return l.BINARY;const t=e&s;return t<=o.ENUM?l.VARINT:t<=o.DOUBLE?l.BIT64:t<=o.MESSAGE?l.BINARY:l.BIT32};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(1390));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}const{FLAGS:a,TYPES:o,TYPE_MASK:s,ENC:l}=n},49259:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequirements=l,t.checkValid=function(e,t){l(e,t);const r=h(t,e);if(r)throw r.path.reverse(),new TypeError(`Invalid value at ${r.path.join(".")}: ${r.error}`)};var i=n(r(33344)),a=r(42098),o=r(1390);const s=Number.MAX_SAFE_INTEGER;function l(e,t){const r=c(e,t);if(r)throw r.reverse(),new TypeError(`Message missing required value ${r.join(".")}`)}function c(e,t){const{names:r,types:n,meta:s}=(0,a.compileSpec)(e);let l;for(let e=0;e<n.length&&!l;e++){const a=n[e],d=r[e],u=(0,i.default)(t,d)?t[d]:void 0;if(a&o.FLAGS.REQUIRED&&null==u)l=[d];else if((a&o.TYPE_MASK)===o.TYPES.MESSAGE&&a&o.FLAGS.REPEATED&&null!=u){const t=s[e];let r;for(r=0;r<u.length&&!l;r++)l=c(t,u[r]);l&&l.push(`${d}[${r}]`)}else(a&o.TYPE_MASK)===o.TYPES.MESSAGE&&null!=u&&(l=c(s[e],u),l&&l.push(d))}return l}function d(e,t,r){return"string"==typeof e?!/^-?0x[0-9a-f]{16}$/i.test(e)&&(__LOG__(2)`"${f(e)}" is not a valid long`,{path:[],error:"value must be a hex string of the form '0x123...' or '-0x123...' where the tail is always 16 characters long"}):u(e,t,r)}function u(e,t,r){return"number"!=typeof e||e!=e||Math.floor(e)!==e?(__LOG__(2)`"${f(e)}" is not a valid int`,{path:[],error:"value must be an int"}):(e<t||e>=r)&&(__LOG__(2)`"${f(e)}" is out of range`,{path:[],error:"value is out of range"})}function p(e,t,r){return e?void 0:(__LOG__(2)`"${f(r)}" is not ${t}`,{path:[],error:"value is invalid"})}function f(e){return"string"==typeof e?`"${e}"`:Array.isArray(e)?`[${e.join(", ")}]`:`${e}`}const _=[void 0,e=>u(e,-2147483648,2147483648),e=>d(e,-s,s+1),e=>u(e,0,4294967296),e=>d(e,0,s+1),e=>u(e,-2147483648,2147483648),e=>d(e,-s,s+1),e=>p("boolean"==typeof e,"boolean",e),(e,t)=>p("number"==typeof e&&(t[e]||void 0!==t.cast(e)),"in enum",e),e=>d(e,0,s+1),e=>d(e,-s,s+1),e=>p("number"==typeof e,"number",e),e=>p("string"==typeof e,"string",e),e=>p(e instanceof ArrayBuffer||e instanceof Uint8Array,"ArrayBuffer or Uint8Array",e),h,e=>u(e,0,4294967296),e=>u(e,-2147483648,2147483648),e=>p("number"==typeof e,"number",e)];function h(e,t){const{names:r,fields:n,types:i,meta:s,oneofToFields:l,fieldToOneof:c,reservedTags:d,reservedFields:u}=(0,a.compileSpec)(t);let p;for(let t=0;t<r.length&&!p;t++){const a=r[t],h=i[t],g=e[a],m=h&o.TYPE_MASK,y=_[m];if(void 0===y)throw new Error(`Can not find the validator for type ${m}`);if(h&(o.FLAGS.PACKED|o.FLAGS.REPEATED)&&null!=g)if(Array.isArray(g)){const e=s[t];for(let t=0;t<g.length&&!p;t++)p=y(g[t],e),p&&p.path.push(`${a}[${t}]`)}else __LOG__(2)`"${f(g)}" is not an array`,p={path:[a],error:"repeated field must be array"};else if(null!=g){p=y(g,s[t]),p&&p.path.push(a);const r=c[a];r&&r.forEach((t=>{l[t].filter((e=>e!==a)).forEach((r=>{void 0!==e[r]&&(p={path:[t],error:`oneof has fields '${a}' and '${r}' set`})}))})),d[n[t]]&&(p={path:[a],error:`tag ${n[t]} is reserved`}),u[a]&&(p={path:[a],error:"field name is reserved"})}}return p}},84902:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtobuf=function(e,t){const r=new a.Binary(t),n=y(e,r,void 0,!1);return(0,u.checkRequirements)(e,n),n},t.decodeProtobufWithUnknowns=function(e,t){const r=new a.Binary(t),n=y(e,r,void 0,!0);return(0,u.checkRequirements)(e,n),n},t.getUnknownFields=function(e){return(0,o.default)(e,"unsafeUnknownFields")?e.unsafeUnknownFields:null};var i=n(r(73982)),a=r(8584),o=n(r(33344)),s=r(87614),l=r(42098),c=r(1390),d=r(72058),u=r(49259);function p(e,t,r){if(e!==(0,d.typeToEncType)(t))throw new Error(`FormatError: ${r} encoded with wire type ${e}`)}function f(e,t,r){switch(t){case c.TYPES.INT32:return _(r,-2147483648,2147483648,e,a.parseInt64OrThrow);case c.TYPES.INT64:return r.readVarInt(h);case c.TYPES.UINT32:return _(r,0,4294967296,e,a.parseUint64OrThrow);case c.TYPES.UINT64:return r.readVarInt(g);case c.TYPES.SINT32:{const t=_(r,0,4294967296,e,a.parseInt64OrThrow);return 1&t?~(t>>>1):t>>>1}case c.TYPES.SINT64:return r.readVarInt(m);case c.TYPES.BOOL:return!!_(r,0,2,e,a.parseUint64OrThrow);case c.TYPES.ENUM:return r.readVarInt(a.parseInt64OrThrow);case c.TYPES.FIXED64:return r.readLong(g,!0);case c.TYPES.SFIXED64:return r.readLong(h,!0);case c.TYPES.DOUBLE:return r.readFloat64(!0);case c.TYPES.STRING:return r.readString(r.readVarInt(a.parseUint64OrThrow));case c.TYPES.BYTES:return r.readBuffer(r.readVarInt(a.parseUint64OrThrow));case c.TYPES.FIXED32:return r.readUint32(!0);case c.TYPES.SFIXED32:return r.readInt32(!0);case c.TYPES.FLOAT:return r.readFloat32(!0)}}function _(e,t,r,n,i){const a=e.readVarInt(i);if(a<t||a>=r)throw new Error(`FormatError: ${n} encoded with out-of-range value ${a}`);return a}function h(e,t){if((0,a.longFitsInDouble)(!0,e,t)){return 4294967296*e+E(t)}{const r=e<0;let n;n=r?0===t?-e:~e:e;const i=r?-t:t;return(0,s.createHexLongFrom32Bits)(n,i,r)}}function g(e,t){if((0,a.longFitsInDouble)(!1,e,t)){return 4294967296*E(e)+E(t)}return(0,s.createHexLongFrom32Bits)(e,t)}function m(e,t){let r=e>>>1,n=e<<31|t>>>1;return 1&t&&(r=~r,n=~n),h(r,n)}function y(e,t,r,n){const{names:o,fields:s,types:d,meta:u,oneofToFields:h,fieldToOneof:g,reservedTags:m,reservedFields:E}=(0,l.compileSpec)(e),{internalDefaults:S}=e,v=r||(0,i.default)({},S)||{};for(let e=0;e<o.length;e++)d[e]&c.FLAGS.REPEATED&&(v[o[e]]=[]);let T=0,C=s[0];for(;t.size();){const e=_(t,0,4294967296,"field and enc type",a.parseInt64OrThrow),r=7&e,i=e>>>3;if(i!==C){const e=T;do{++T===s.length&&(T=0),C=s[T]}while(i!==C&&T!==e)}if(i===C){const e=o[T],s=d[T];p(r,s,e);const l=s&c.TYPE_MASK,_=u[T];if(s&c.FLAGS.PACKED){const r=t.readVarInt(a.parseUint64OrThrow),n=t.readBinary(r);for(;n.size();){const t=f(e,l,n);(l!==c.TYPES.ENUM||_[t]||void 0!==_.cast(t))&&v[e].push(t)}}else if(l===c.TYPES.MESSAGE){const r=t.readVarInt(a.parseUint64OrThrow),i=t.readBinary(r);if(s&c.FLAGS.REPEATED)v[e].push(y(_,i,void 0,n));else{const t=v[e];v[e]=y(_,i,t,n)}}else{const r=f(e,l,t);(l!==c.TYPES.ENUM||_[r]||void 0!==_.cast(r))&&(s&c.FLAGS.REPEATED?v[e].push(r):v[e]=r)}const S=g[e];S&&void 0!==v[e]&&S.forEach((t=>{h[t].filter((t=>t!==e)).forEach((e=>{delete v[e]}))})),(m[i]||E[e])&&delete v[e]}else if(n){let e;switch(v.unsafeUnknownFields||(v.unsafeUnknownFields={}),r){case c.ENC.VARINT:e=t.readVarInt(a.parseInt64OrThrow);break;case c.ENC.BIT64:e=t.readBinary(8);break;case c.ENC.BINARY:e=t.readBinary(t.readVarInt(a.parseUint64OrThrow));break;case c.ENC.BIT32:e=t.readBinary(4)}v.unsafeUnknownFields[i]=e}else r===c.ENC.VARINT?t.readVarInt(a.parseInt64OrThrow):r===c.ENC.BIT64?t.advance(8):r===c.ENC.BINARY?t.advance(t.readVarInt(a.parseUint64OrThrow)):r===c.ENC.BIT32&&t.advance(4)}return v}function E(e){return e>=0?e:4294967296+e}},60980:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeErrorInfo=function(){return void 0!==c?`Last encoded value for ${c}`:"No information known"},t.encodeProtobuf=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n.Binary;return(0,l.checkValid)(e,t),h(r,t,e),c=void 0,r};var n=r(8584),i=r(87614),a=r(42098),o=r(1390),s=r(72058),l=r(49259);let c;function d(e,t){e.writeVarInt(t)}function u(e,t){if("number"==typeof t&&t<4503599627370496&&t>=-4503599627370496)e.writeVarInt(t>=0?2*t:2*-t-1);else{const r=new n.Binary;let a;"number"==typeof t?(a=t<0,r.writeVarInt(a?-t:t)):(a=(0,i.hexLongIsNegative)(t),r.writeVarIntFromHexLong(a?(0,i.negateHexLong)(t):t));const o=r.peek((()=>r.readByteArray())),s=o.byteLength;if(a){let e,t=0;do{e=o[t],o[t]=128&e|(127&e)-1&127,t++}while(255===o[t-1])}let l=a?1:0;for(let e=0;e<s;e++){const t=o[e],r=128&t|(63&t)<<1|l;l=(64&t)>>6,o[e]=r}1===l&&(o[s-1]|=128,r.writeInt8(1)),e.writeBinary(r)}}function p(e,t){"number"==typeof t?e.writeVarInt(t):e.writeVarIntFromHexLong(t)}const f=[void 0,d,p,d,p,u,u,(e,t)=>{e.writeVarInt(t?1:0)},d,(e,t)=>{"number"==typeof t?e.writeUint64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{"number"==typeof t?e.writeInt64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{e.writeFloat64(t,!0)},function(e,t){e.writeVarInt((0,n.numUtf8Bytes)(t)),e.writeString(t)},function(e,t){e.writeVarInt(t.byteLength),e.writeBuffer(t)},function(e,t,r){e.writeWithVarIntLength(((e,t)=>h(e,t,r)),t)},(e,t)=>{e.writeUint32(t,!0)},(e,t)=>{e.writeInt32(t,!0)},(e,t)=>{e.writeFloat32(t,!0)}],_=f.map((e=>{if(null!=e)return(e,r)=>{e.writeWithVarIntLength(t,r)};function t(t,r){for(let n=0;n<r.length;n++)e(t,r[n])}}));function h(e,t,r){const{names:n,fields:i,types:l,meta:d}=(0,a.compileSpec)(r),{internalDefaults:u}=r;for(let r=0;r<n.length;r++){const a=n[r];let p=t[a];if(null==p&&u&&(p=u[a]),null!=p){c=a;const t=i[r],n=l[r],u=n&o.TYPE_MASK,h=d[r],g=8*t|(0,s.typeToEncType)(n);if(n&o.FLAGS.PACKED){if(p.length>0){e.writeVarInt(g);(0,_[u])(e,p,h)}}else if(n&o.FLAGS.REPEATED)for(let t=0;t<p.length;t++){e.writeVarInt(g);(0,f[u])(e,p[t],h)}else{e.writeVarInt(g);(0,f[u])(e,p,h)}}}}},17793:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_TYPE=void 0,t.castToPreKeyId=f,t.castToSerializedPubKey=_,t.deserializePreKey=function(e){try{const{id:t,publicKey:r,privateKey:o}=(0,a.decodeProtobuf)(n.PreKeyRecordStructureSpec,e);return null==t||null==r||null==o?null:{id:f(t),keyPair:d((0,i.toBytes)(o,32),_(new Uint8Array(r)))}}catch(e){return null}},t.ecdh=function(e,t){return(0,o.scalarMult)(e,t.subarray(1)).buffer},t.makeKeyPair=c,t.makeKeyPairFrom=function(e){const{publicKey:t,secretKey:r}=o.box.keyPair.fromSecretKey(e);return l((0,i.ensureSize)(t,32),(0,i.ensureSize)(r,32))},t.makeKeyPairFromArrayBuffers=function(e,t){return{publicKey:(0,i.toBytes)(e,32),privateKey:(0,i.toBytes)(t,32)}},t.makeKeyPairFromSerialized=d,t.makePreKeys=function(e,t){let r=(e-1)%s;r<=0&&(r+=s);const a=[];for(let e=0;e<t;e++){const e=r===s?1:r+1,t=c(),o=(0,i.encodeSignalProto)(n.PreKeyRecordStructureSpec,{id:e,publicKey:p(t),privateKey:t.privateKey});a.push({plainObject:{id:e,keyPair:t},record:o}),r=e}return a},t.makeRawSenderKey=function(){const e=(0,i.makeBytes)(32);return self.crypto.getRandomValues(e),e},t.makeSerializedKeyPair=function(){const e=c();return u(e.privateKey,p(e))},t.makeSerializedKeyPairFrom=u,t.serializeIdentity=function(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set((0,i.ensureSize)(e,32),1),t},t.serializePubKey=p,t.toSerializeKeyPair=function(e){return u(e.privateKey,p(e))};var n=r(93638),i=r(27764),a=r(84902),o=r(14462);t.KEY_TYPE=5;const s=16777215;function l(e,t){return{publicKey:e,privateKey:t}}function c(){const{publicKey:e,secretKey:t}=o.box.keyPair();return t[0]&=248,t[31]=64|63&t[31],l((0,i.ensureSize)(e,32),(0,i.ensureSize)(t,32))}function d(e,t){return l((0,i.sliceBytes)(t,1,32),e)}function u(e,t){return{serializedPubKey:t,privateKey:e}}function p(e){const t=(0,i.makeBytes)(33);return t[0]=5,t.set(e.publicKey,1),t}function f(e){return(0,i.ensureIntInRange)(e,1,s)}function _(e){if(0===e.length||5!==e[0])throw new Error("Unrecognized public key type");return(0,i.ensureSize)(e,33)}},27764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HMAC_SHA256=t.AES_CBC=void 0,t.castRegistrationId=function(e){return d(e)},t.castSenderKeyId=function(e){return d(e)},t.castToByteEncoded=function(e){return e},t.decodeSignalProto=function(e,t,r){return r((0,a.decodeProtobuf)(e,t))},t.encodeSignalProto=function(e,t){return(0,o.encodeProtobuf)(e,t).readByteArray()},t.ensureIntInRange=d,t.ensureSize=c,t.hkdf=function(e,t,r,i){return(0,n.extractWithSaltAndExpand)(e,t,r,i).then((e=>new Uint8Array(e)))},t.makeBytes=function(e){return new Uint8Array(e)},t.makeCryptoKey=function(e,t){let r,n;"hmac-sha256"===t?(r=l,n=["sign"]):(r=s,n=["encrypt","decrypt"]);return self.crypto.subtle.importKey("raw",e,r,!1,n)},t.makeRegistrationId=function(e){const t="extendedRange"===e?2147483646:16380;return(0,i.randomNumberLessThan)(t)+1},t.makeSenderKeyId=function(){return(0,i.randomNumberLessThan)(-1>>>1)+1},t.readBytes=function(e,t){return e.readByteArray(t)},t.sliceBytes=function(e,t,r){if(e.length-t<r)throw new Error(`Can not split off ${r} bytes from index ${t} of ${e.length} bytes`);return e.slice(t,t+r)},t.toBuffer=function(e){const t=e.buffer,r=e.byteOffset,n=e.length;return 0===r&&n===t.byteLength?t:t.slice(r,r+n)},t.toBytes=function(e,t){return c(new Uint8Array(e),t)};var n=r(81576),i=r(7589),a=r(84902),o=r(60980);const s={name:"AES-CBC"};t.AES_CBC=s;const l={name:"HMAC",hash:"SHA-256"};function c(e,t){if(e.length!==t)throw new Error(`Signal expected ${t} bytes, given ${e.length}`);return e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967296;if("number"==typeof e&&t<=e&&e<r&&Math.floor(e)===e)return e;throw new Error(`Expected integer in range [${t}, ${r}), given ${String(e)}`)}t.HMAC_SHA256=l},93638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignedPreKeyRecordStructureSpec=t.SessionStructureSpec=t.SenderSigningKeySpec=t.SenderMessageKeySpec=t.SenderKeyStateStructureSpec=t.SenderKeyRecordStructureSpec=t.SenderChainKeySpec=t.RecordStructureSpec=t.PreKeyRecordStructureSpec=t.PendingPreKeySpec=t.PendingKeyExchangeSpec=t.MessageKeySpec=t.IdentityKeyPairStructureSpec=t.ChainSpec=t.ChainKeySpec=void 0;var n=r(1390);const i={};t.SessionStructureSpec=i;const a={};t.PendingPreKeySpec=a;const o={};t.PendingKeyExchangeSpec=o;const s={};t.ChainSpec=s;const l={};t.MessageKeySpec=l;const c={};t.ChainKeySpec=c;const d={};t.RecordStructureSpec=d;const u={};t.PreKeyRecordStructureSpec=u;const p={};t.SignedPreKeyRecordStructureSpec=p;const f={};t.IdentityKeyPairStructureSpec=f;const _={};t.SenderKeyStateStructureSpec=_;const h={};t.SenderSigningKeySpec=h;const g={};t.SenderMessageKeySpec=g;const m={};t.SenderChainKeySpec=m;const y={};t.SenderKeyRecordStructureSpec=y,i.internalSpec={sessionVersion:[1,n.TYPES.UINT32],localIdentityPublic:[2,n.TYPES.BYTES],remoteIdentityPublic:[3,n.TYPES.BYTES],rootKey:[4,n.TYPES.BYTES],previousCounter:[5,n.TYPES.UINT32],senderChain:[6,n.TYPES.MESSAGE,s],receiverChains:[7,n.FLAGS.REPEATED|n.TYPES.MESSAGE,s],pendingKeyExchange:[8,n.TYPES.MESSAGE,o],pendingPreKey:[9,n.TYPES.MESSAGE,a],remoteRegistrationId:[10,n.TYPES.UINT32],localRegistrationId:[11,n.TYPES.UINT32],needsRefresh:[12,n.TYPES.BOOL],aliceBaseKey:[13,n.TYPES.BYTES]},a.internalSpec={preKeyId:[1,n.TYPES.UINT32],signedPreKeyId:[3,n.TYPES.INT32],baseKey:[2,n.TYPES.BYTES]},o.internalSpec={sequence:[1,n.TYPES.UINT32],localBaseKey:[2,n.TYPES.BYTES],localBaseKeyPrivate:[3,n.TYPES.BYTES],localRatchetKey:[4,n.TYPES.BYTES],localRatchetKeyPrivate:[5,n.TYPES.BYTES],localIdentityKey:[7,n.TYPES.BYTES],localIdentityKeyPrivate:[8,n.TYPES.BYTES]},s.internalSpec={senderRatchetKey:[1,n.TYPES.BYTES],senderRatchetKeyPrivate:[2,n.TYPES.BYTES],chainKey:[3,n.TYPES.MESSAGE,c],messageKeys:[4,n.FLAGS.REPEATED|n.TYPES.MESSAGE,l]},l.internalSpec={index:[1,n.TYPES.UINT32],cipherKey:[2,n.TYPES.BYTES],macKey:[3,n.TYPES.BYTES],iv:[4,n.TYPES.BYTES]},c.internalSpec={index:[1,n.TYPES.UINT32],key:[2,n.TYPES.BYTES]},d.internalSpec={currentSession:[1,n.TYPES.MESSAGE,i],previousSessions:[2,n.FLAGS.REPEATED|n.TYPES.MESSAGE,i]},u.internalSpec={id:[1,n.TYPES.UINT32],publicKey:[2,n.TYPES.BYTES],privateKey:[3,n.TYPES.BYTES]},p.internalSpec={id:[1,n.TYPES.UINT32],publicKey:[2,n.TYPES.BYTES],privateKey:[3,n.TYPES.BYTES],signature:[4,n.TYPES.BYTES],timestamp:[5,n.TYPES.FIXED64]},f.internalSpec={publicKey:[1,n.TYPES.BYTES],privateKey:[2,n.TYPES.BYTES]},_.internalSpec={senderKeyId:[1,n.TYPES.UINT32],senderChainKey:[2,n.TYPES.MESSAGE,m],senderSigningKey:[3,n.TYPES.MESSAGE,h],senderMessageKeys:[4,n.FLAGS.REPEATED|n.TYPES.MESSAGE,g]},h.internalSpec={public:[1,n.TYPES.BYTES],private:[2,n.TYPES.BYTES]},g.internalSpec={iteration:[1,n.TYPES.UINT32],seed:[2,n.TYPES.BYTES]},m.internalSpec={iteration:[1,n.TYPES.UINT32],seed:[2,n.TYPES.BYTES]},y.internalSpec={senderKeyStates:[1,n.FLAGS.REPEATED|n.TYPES.MESSAGE,_]}},4276:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseSuccess=function(e){const t=(0,s.assertTag)(e,"iq");if(!t.success)return t;const r=(0,o.parseIQResultResponse)(e);if(!r.success)return r;const n=(0,s.flattenedChildWithTag)(e,"props");if(!n.success)return n;const c=(0,s.assertAttr)(n.value,"protocol","1");if(!c.success)return c;const d=(0,s.optional)(s.attrString,n.value,"ab_key");if(!d.success)return d;const u=(0,s.optional)(s.attrString,n.value,"hash");if(!u.success)return u;const p=(0,s.optional)(s.attrIntRange,n.value,"refresh",0,void 0);if(!p.success)return p;const f=(0,s.optional)(s.attrIntRange,n.value,"refresh_id",0,void 0);if(!f.success)return f;const _=(0,s.mapChildrenWithTag)(n.value,"prop",0,1/0,l);return _.success?(0,a.makeSuccess)((0,i.default)((0,i.default)({},r.value),{},{propsAbKey:d.value,propsHash:u.value,propsRefresh:p.value,propsRefreshId:f.value,propsProp:_.value})):_},t.parseGetExperimentConfigResponseSuccessPropsProp=l;var i=n(r(73982)),a=r(87040),o=r(65363),s=r(8790);function l(e){const t=(0,s.assertTag)(e,"prop");if(!t.success)return t;const r=(0,s.mixinOr)(e,o.parseExperimentConfig,o.parseSamplingConfig,"ExperimentConfig","SamplingConfig");return r.success,r}},65363:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseExperimentConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"config_code",1,void 0);if(!r.success)return r;const a=(0,i.attrString)(e,"config_value");if(!a.success)return a;const o=(0,i.optional)(i.attrIntRange,e,"config_expo_key",0,void 0);return o.success?(0,n.makeSuccess)({configCode:r.value,configValue:a.value,configExpoKey:o.value}):o},t.parseIQErrorBadRequest=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","bad-request");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","400");return n.success?i.voidSuccess:n},t.parseIQErrorFeatureNotImplemented=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","feature-not-implemented");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","501");return n.success?i.voidSuccess:n},t.parseIQErrorInternalServerError=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const r=(0,i.assertAttr)(e,"text","internal-server-error");if(!r.success)return r;const n=(0,i.assertAttr)(e,"code","500");return n.success?i.voidSuccess:n},t.parseIQErrorResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const r=(0,i.assertAttr)(e,"type","error");return r.success?i.voidSuccess:r},t.parseIQResultResponse=function(e){const t=(0,i.assertTag)(e,"iq");if(!t.success)return t;const r=(0,i.assertAttr)(e,"type","result");return r.success?i.voidSuccess:r},t.parseSamplingConfig=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"event_code",1,void 0);if(!r.success)return r;const a=(0,i.attrIntRange)(e,"sampling_weight",-1e4,1e4);return a.success?(0,n.makeSuccess)({eventCode:r.value,samplingWeight:a.value}):a},t.parseServerNotification=function(e){const t=(0,i.assertTag)(e,"notification");if(!t.success)return t;const r=(0,i.attrIntRange)(e,"t",0,void 0);if(!r.success)return r;const a=(0,i.optional)(i.attrIntRange,e,"offline",0,1024);return a.success?(0,n.makeSuccess)({t:r.value,offline:a.value}):a};var n=r(87040),i=r(8790)},8790:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.SmaxParsingFailure=void 0,t.assertAttr=function(e,t,r){const n=c(e,t);if(!n.success)return n;if(n.value!==r)return _(e,`to have "${t}"="${r}", but instead has "${n.value}"`);return s},t.assertTag=function(e,t){if(e.tag!==t)return _(e,`to be <${t}>`);return s},t.attrInt=d,t.attrIntRange=function(e,t,r,n){const i=d(e,t);if(!i.success)return i;const a=i.value;if(void 0!==r&&a<r)return _(e,`to have "${t}"={at least ${r}} but has value ${a}`);if(void 0!==n&&a>=n)return _(e,`to have "${t}"={below ${n}} but has value ${a}`);return(0,o.makeSuccess)(a)},t.attrString=c,t.childWithTag=function(e,t,r){const n=p(e,t,r);if(!n.success)return n;const i=n.value;if(null==i)return _(e,`to have 1 child <${t}>, but found 0`);return(0,o.makeSuccess)(i)},t.countChildrenWithTag=function(e,t,r,n,i){const a=g(e,t,r,n);if(!a.success)return a;const s=a.value.length;for(let e=0;e<s;e++){const t=i(a.value[e]);if(!t.success)return t}return(0,o.makeSuccess)(s)},t.emptyObject=void 0,t.errorMixinDisjunction=function(e,t,r){const n=t.map(((e,t)=>`${e}: ${r[t].error}`));return _(e,[`to match any of following mixins: ${t.join(", ")}, but all mixins failed.`,...n].join(" "))},t.flattenedChildWithTag=function(e,t){const r=u(e,t);if(!r.success)return r;if(null==r.value)return _(e,`to have 1 child <${t}>, but found 0`);return(0,o.makeSuccess)(r.value)},t.hasLiteralAttr=function(e,t,r){const n=c(e,t);return n.success&&n.value===r},t.identity=function(e){return e},t.mapChildrenWithTag=function(e,t,r,n,i){const a=g(e,t,r,n);if(!a.success)return a;const s=[];for(let e=0;e<a.value.length;e++){const t=i(a.value[e]);if(!t.success)return t;s.push(t.value)}return(0,o.makeSuccess)(s)},t.mixinOr=function(e,t,r,n,a){const s=t(e);if(s.success)return(0,o.makeSuccess)((0,i.default)((0,i.default)({},s.value),{},{mixinName:n}));const l=r(e);if(l.success)return(0,o.makeSuccess)((0,i.default)((0,i.default)({},l.value),{},{mixinName:a}));return _(e,[`to match either ${n} or ${a}, but both mixins failed.`,`${n}: ${s.error}`,`${a}: ${l.error}`].join(" "))},t.optional=function(e,t,r,n,i){return f(t,r)?e(t,r,n,i):s},t.optionalChild=u,t.optionallChildWithTag=p,t.voidSuccess=void 0;var i=n(r(73982)),a=n(r(33344)),o=r(87040);const s=(0,o.makeSuccess)();t.voidSuccess=s;class l extends Error{constructor(){super(...arguments),this.name="SmaxParsingFailure"}}function c(e,t){return f(e,t)?function(e,t){if("string"!=typeof t)return _(e,`decodeAsString: attribute is ${typeof t} not a string: ${String(t)}`);return(0,o.makeSuccess)(t)}(e,e.attrs[t]):_(e,`to have attribute "${t}"`)}function d(e,t){const r=c(e,t);if(!r.success)return r;const n=parseInt(r.value,10);return Number.isNaN(n)?_(e,`to have "${t}"={integer} but has value "${r.value}"`):(0,o.makeSuccess)(n)}function u(e,t){const r=h(e);if(!r.success)return r;const n=r.value;if(null==n)return s;let i=null;for(let r=0;r<n.length;r++){const a=n[r];if(a.tag===t){if(null!=i)return _(e,`to have 1 child <${t}>, but found more than 1`);i=a}}return(0,o.makeSuccess)(i)}function p(e,t,r){const n=u(e,t);return n.success?null==n.value?s:r(n.value):n}function f(e,t){return(0,a.default)(e.attrs,t)}function _(e,t){return(0,o.makeError)(`expected <${e.tag}>: ${t}`)}function h(e){const t=e.content;return t instanceof Uint8Array?_(e,"to have children"):(0,o.makeSuccess)(t)}function g(e,t,r,n){const i=h(e);if(!i.success)return i;const a=i.value;if(null==a)return 0!==r?_(e,`to have at least ${r} <${t}> children, but found 0`):(0,o.makeSuccess)([]);const s=[];for(let e=0;e<a.length;e++){const r=a[e];r.tag===t&&s.push(r)}const l=s.length;return l<r?_(e,`to have at least ${r} <${t}> children, but found ${l}`):l>n?_(e,`to have at most ${n} <${t}> children, but found ${l}`):(0,o.makeSuccess)(s)}t.SmaxParsingFailure=l;t.emptyObject={}},72493:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var n=r(1390);const i={};t.MessageKeySpec=i,i.internalSpec={remoteJid:[1,n.TYPES.STRING],fromMe:[2,n.TYPES.BOOL],id:[3,n.TYPES.STRING],participant:[4,n.TYPES.STRING]}},76100:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferMod=function(e,t){const r=new Uint8Array(e);if(t>8388607)throw new Error("Divisor is too big");let n=0;for(let e=0;e<r.length;++e)n=((n<<8)+r[e])%t;return n},t.arrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},t.arrayBuffersEqualUNSAFE=function(e,t){const n=new Uint8Array(e),i=new Uint8Array(t);return r(n,i)},t.concatBuffers=function(e){const t=e.map((e=>new Uint8Array(e))),r=t.reduce(((e,t)=>e+t.byteLength),0),n=new Uint8Array(r);return t.reduce(((e,t)=>(n.set(t,e),e+t.byteLength)),0),n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)},t.largeStringToArrayBuffer=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e5;return new Promise((r=>{const n=e.length,i=new ArrayBuffer(n),a=new Uint8Array(i);let o=0;requestAnimationFrame((function s(){const l=Math.min(o+t,n);for(;o<l;)a[o]=e.charCodeAt(o),o++;if(o===n)return void r(i);requestAnimationFrame(s)}))}))},t.stringToArrayBuffer=function(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);let n,i;for(n=0,i=e.length;n<i;n++)r[n]=e.charCodeAt(n);return r.buffer},t.uint8ArraysEqualUNSAFE=r;function r(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r!==e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}},47151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeIndexWithoutPreservingOrder=function(e,t){const r=e.pop();t<e.length&&(e[t]=r)}},84973:e=>{e.exports=function(e){throw new Error(`Impossible value, the default statement should never be reached for value: ${e}`)}},15688:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BASE64_DATA_URL_SCHEME=void 0,t.decodeB64=function(e){const t=a(e,43,47,61);if(t)return t.buffer;throw new Error("Base64.decode given invalid string")},t.decodeB64ToJsArray=function(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):a(e,43,47,61);return t&&Array.from(t)},t.decodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=a(e,45,95,t?61:-1);if(r)return r.buffer;throw new Error("Base64.decode given invalid string")},t.encodeB64=function(e){return n(e,43,47,!0)},t.encodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n(e,45,95,t)},t.sizeWhenB64Decoded=function(e){return Math.floor(3*e.length/4)};const r=3e3;function n(e,t,n,a){const o=Array.isArray(e)||e instanceof ArrayBuffer?new Uint8Array(e):e;if(o.length<=r)return i(o,t,n,a);{const e=[];for(let s=0;s<o.length;s+=r)e.push(i(o.subarray(s,s+r),t,n,a));return e.join("")}}function i(e,t,r,n){const i=Math.ceil(4*e.length/3),a=4*Math.ceil(e.length/3),o=new Array(a);for(let t=0,r=0;t<a;t+=4,r+=3){const n=e[r]<<16|e[r+1]<<8|e[r+2];o[t]=n>>18,o[t+1]=n>>12&63,o[t+2]=n>>6&63,o[t+3]=63&n}for(let e=0;e<i;e++){const n=o[e];o[e]=n<26?65+n:n<52?71+n:n<62?n-4:62===n?t:r}for(let e=i;e<a;e++)o[e]=61;const s=String.fromCharCode.apply(String,o);return n?s:s.substring(0,i)}function a(e,t,r,n){let i=e.length;const a=new Int32Array(i+i%4);for(let o=0;o<i;o++){const s=e.charCodeAt(o);if(65<=s&&s<=90)a[o]=s-65;else if(97<=s&&s<=122)a[o]=s-71;else if(48<=s&&s<=57)a[o]=s+4;else if(s===t)a[o]=62;else{if(s!==r){if(s===n){i=o;break}return null!=self.ERROR&&__LOG__(4,void 0,new Error)`Found unexpected character code while decoding B64 at index ${o}, length ${i}: ${s}`,null}a[o]=63}}const o=a.length/4;for(let e=0,t=0;e<o;e++,t+=4)a[e]=a[t]<<18|a[t+1]<<12|a[t+2]<<6|a[t+3];const s=Math.floor(3*i/4),l=new Uint8Array(s);let c=0,d=0;for(;d+3<=s;c++,d+=3){const e=a[c];l[d]=e>>16,l[d+1]=e>>8&255,l[d+2]=255&e}switch(s-d){case 2:l[d]=a[c]>>16,l[d+1]=a[c]>>8&255;break;case 1:l[d]=a[c]>>16}return l}t.BASE64_DATA_URL_SCHEME="data:image/jpeg;base64,"},8584:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binary=void 0,t.longFitsInDouble=u,t.numUtf8Bytes=d,t.parseInt64OrThrow=Y,t.parseUint64OrThrow=W;var n=r(87614);const i=65533,a=new Uint8Array(10),o=new Uint8Array(0);class s{constructor(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.write=function(){for(let t=0;t<arguments.length;t++){const r=t<0||arguments.length<=t?void 0:arguments[t];"string"==typeof r?e.writeString(r):"number"==typeof r?e.writeUint8(r):r instanceof s?e.writeBinary(r):r instanceof ArrayBuffer?e.writeBuffer(r):r instanceof Uint8Array&&e.writeByteArray(r)}},t instanceof ArrayBuffer?(this._buffer=new Uint8Array(t),this._readEndIndex=this._writeIndex=t.byteLength):t instanceof Uint8Array&&(this._buffer=t,this._readEndIndex=this._writeIndex=t.length),this._bytesTrashed=0,this._earliestIndex=this._readIndex=0,this._view=null,this._littleEndian=r,this._hiddenReads=0,this._hiddenWrites=0}size(){return this._readEndIndex-this._readIndex}peek(e,t){this._hiddenReads++;const r=this._readIndex,n=this._bytesTrashed;try{return e(this,t)}finally{this._hiddenReads--,this._readIndex=r-(this._bytesTrashed-n)}}advance(e){this._shiftReadOrThrow(e)}readWithViewParser(e,t,r,n){return t(this._getView(),this._shiftReadOrThrow(e),e,r,n)}readWithBytesParser(e,t,r,n){return t(this._buffer,this._shiftReadOrThrow(e),e,r,n)}readUint8(){return p(this,1,_,!1)}readInt8(){return p(this,1,_,!0)}readUint16(){return p(this,2,h,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt32(){return p(this,4,g,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint32(){return p(this,4,m,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt64(){return p(this,8,y,Y,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint64(){return p(this,8,y,W,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readLong(e){return p(this,8,y,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}readFloat32(){return p(this,4,E,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readFloat64(){return p(this,8,S,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readVarInt(e){const t=f(this,0,v,this.size());return f(this,t,T,e)}readBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new ArrayBuffer(0):f(this,e,C)}readByteArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new Uint8Array(0):f(this,e,A)}readBinary(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;if(0===e)return new s(void 0,t);const r=f(this,e,A);return new s(r,t)}indexOf(e){if(0===e.length)return 0;const t=this._buffer,r=this._readEndIndex,n=this._readIndex;let i=0,a=n;for(let o=n;o<r;o++)if(t[o]===e[i]){if(0===i&&(a=o),i++,i===e.byteLength)return o-n-e.byteLength+1}else i>0&&(i=0,o=a);return-1}readString(e){return f(this,e,b)}ensureCapacity(e){this._maybeReallocate(this._readIndex+e)}ensureAdditionalCapacity(e){this._maybeReallocate(this._writeIndex+e)}writeToView(e,t,r,n){const i=this._shiftWriteMaybeReallocate(e);return t(this._getView(),i,e,r,n)}writeToBytes(e,t,r,n){const i=this._shiftWriteMaybeReallocate(e);return t(this._buffer,i,e,r,n)}writeUint8(e){K(e,0,256,"uint8"),M(this,1,O,e,!1)}writeInt8(e){K(e,-128,128,"signed int8"),M(this,1,O,e,!0)}writeUint16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,65536,"uint16"),P(this,2,I,e,t)}writeInt16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-32768,32768,"signed int16"),P(this,2,w,e,t)}writeUint32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,4294967296,"uint32"),P(this,4,R,e,t)}writeInt32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-2147483648,2147483648,"signed int32"),P(this,4,D,e,t)}writeUint64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,0,0x10000000000000000,"uint64"),P(this,8,N,e,t)}writeInt64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;K(e,-0x8000000000000000,0x8000000000000000,"signed int64"),P(this,8,N,e,t)}writeFloat32(e){P(this,4,L,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeFloat64(e){P(this,8,k,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeVarInt(e){K(e,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");const t=e<0,r=t?-e:e;let n=Math.floor(r/4294967296),i=r-4294967296*n;t&&(n=~n,0===i?n++:i=-i);M(this,B(n,i),G,n,i)}writeVarIntFromHexLong(e){const t=(0,n.hexLongIsNegative)(e),r=t?(0,n.negateHexLong)(e):e,i=(0,n.hexLongToHex)(r);let a=0,o=0;for(let e=0;e<n.NUM_HEX_IN_LONG;e++)a=a<<4|o>>>28,o=o<<4|(0,n.hexAt)(i,e);t&&(a=~a,0===o?a++:o=-o);M(this,B(a,o),G,a,o)}writeBinary(e){const t=e.peek((e=>e.readByteArray()));if(t.length){const e=this._shiftWriteMaybeReallocate(t.length);this._buffer.set(t,e)}}writeBuffer(e){this.writeByteArray(new Uint8Array(e))}writeByteArray(e){const t=this._shiftWriteMaybeReallocate(e.length);this._buffer.set(e,t)}writeBufferView(e){this.writeByteArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}writeString(e){M(this,d(e),U,e)}writeHexLong(e){P(this,8,F,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeBytes(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(let e=0;e<t.length;e++)K(t[e],0,256,"byte");M(this,t.length,x,t)}writeAtomically(e,t){this._hiddenWrites++;let r=this._writeIndex,n=this._bytesTrashed;try{const i=e(this,t);return r=this._writeIndex,n=this._bytesTrashed,i}finally{this._hiddenWrites--,this._writeIndex=r-(this._bytesTrashed-n)}}writeWithVarIntLength(e,t){const r=this._writeIndex,n=this.writeAtomically(e,t),i=this._writeIndex;this.writeVarInt(i-r);const o=this._writeIndex-i,s=this._buffer;for(let e=0;e<o;e++)a[e]=s[i+e];for(let e=i-1;e>=r;e--)s[e+o]=s[e];for(let e=0;e<o;e++)s[r+e]=a[e];return n}static build(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=0;for(let e=0;e<t.length;e++){const r=t[e];"string"==typeof r?n+=d(r):"number"==typeof r?n++:r instanceof s?n+=r.size():r instanceof ArrayBuffer?n+=r.byteLength:r instanceof Uint8Array&&(n+=r.length)}const i=new s;return i.ensureCapacity(n),i.write.apply(i,arguments),i}_getView(){return this._view||(this._view=new DataView(this._buffer.buffer,this._buffer.byteOffset))}_shiftReadOrThrow(e){if(e<0)throw new Error("ReadError: given negative number of bytes to read");const t=this._readIndex,r=t+e;if(r>this._readEndIndex)throw new Error(t===this._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return this._readIndex=r,this._hiddenReads||(this._earliestIndex=r),t}_maybeReallocate(e){const t=this._buffer;if(e<=t.length)return e;{const r=this._earliestIndex,n=e-r,i=Math.max(n,2*(t.length-r),64),a=new Uint8Array(i);return r?(a.set(t.subarray(r)),this._bytesTrashed+=r,this._readIndex-=r,this._readEndIndex-=r,this._writeIndex-=r,this._earliestIndex=0):a.set(t),this._buffer=a,this._view=null,n}}_shiftWriteMaybeReallocate(e){const t=this._maybeReallocate(this._writeIndex+e),r=this._writeIndex;return this._writeIndex=t,this._hiddenWrites||(this._readEndIndex=t),r}}t.Binary=s;let l="",c=0;function d(e){if(e===l)return c;const t=e.length;let r=0;for(let n=0;n<t;n++){const i=e.charCodeAt(n);if(i<128)r++;else if(i<2048)r+=2;else if(i<55296||57344<=i&&i<=65535)r+=3;else if(55296<=i&&i<56320&&n+1!==t){const t=e.charCodeAt(n+1);56320<=t&&t<57344?(n++,r+=4):r+=3}else r+=3}return l=e,c=r}function u(e,t,r){const n=t>>21;if(e){const e=Boolean(2097151&t||r);return 0===n||-1===n&&e}return 0===n}function p(e,t,r,n,i){return e.readWithViewParser(t,r,n,i)}function f(e,t,r,n,i){return e.readWithBytesParser(t,r,n,i)}function _(e,t,r,n){return n?e.getInt8(t):e.getUint8(t)}function h(e,t,r,n){return e.getUint16(t,n)}function g(e,t,r,n){return e.getInt32(t,n)}function m(e,t,r,n){return e.getUint32(t,n)}function y(e,t,r,n,i){return n(e.getInt32(i?t+4:t,i),e.getInt32(i?t:t+4,i))}function E(e,t,r,n){return e.getFloat32(t,n)}function S(e,t,r,n){return e.getFloat64(t,n)}function v(e,t,r,n){const i=Math.min(n,10);let a=0,o=128;for(;a<i&&128&o;)o=e[t+a++];if(10===a&&o>1)throw new Error("ParseError: varint exceeds 64 bits");return 128&o?a+1:a}function T(e,t,r,n){let i=0,a=0,o=r;10===r&&(o--,a=1&e[t+o]);for(let r=o-1;r>=0;r--)i=i<<7|a>>>25,a=a<<7|127&e[t+r];return n(i,a)}function C(e,t,r){const n=t+e.byteOffset,i=e.buffer;return 0===n&&r===i.byteLength?i:i.slice(n,n+r)}function A(e,t,r){return e.subarray(t,t+r)}function b(e,t,r){const n=t+r;let a=[],o=null;for(let r=t;r<n;r++){a.length>5e3&&(o||(o=[]),o.push(String.fromCharCode.apply(String,a)),a=[]);const t=0|e[r];if(0==(128&t))a.push(t);else if(192==(224&t)){const o=H(e,r+1,n);if(o){r++;const e=(31&t)<<6|63&o;e>=128?a.push(e):a.push(i)}else a.push(i)}else if(224==(240&t)){const o=H(e,r+1,n),s=H(e,r+2,n);if(o&&s){r+=2;const e=(15&t)<<12|(63&o)<<6|63&s;e>=2048&&!(55296<=e&&e<57344)?a.push(e):a.push(i)}else o?(r++,a.push(i)):a.push(i)}else if(240==(248&t)){const o=H(e,r+1,n),s=H(e,r+2,n),l=H(e,r+3,n);if(o&&s&&l){r+=3;const e=(7&t)<<18|(63&o)<<12|(63&s)<<6|63&l;if(e>=65536&&e<=1114111){const t=e-65536;a.push(55296|t>>10,56320|1023&t)}else a.push(i)}else o&&s?(r+=2,a.push(i)):o?(r++,a.push(i)):a.push(i)}else a.push(i)}const s=String.fromCharCode.apply(String,a);return o?(o.push(s),o.join("")):s}function P(e,t,r,n,i){return e.writeToView(t,r,n,i)}function M(e,t,r,n,i){return e.writeToBytes(t,r,n,i)}function O(e,t,r,n){e[t]=n}function I(e,t,r,n,i){e.setUint16(t,n,i)}function w(e,t,r,n,i){e.setInt16(t,n,i)}function R(e,t,r,n,i){e.setUint32(t,n,i)}function D(e,t,r,n,i){e.setInt32(t,n,i)}function N(e,t,r,n,i){const a=n<0,o=a?-n:n;let s=Math.floor(o/4294967296),l=o-4294967296*s;a&&(s=~s,0===l?s++:l=-l),e.setUint32(i?t+4:t,s,i),e.setUint32(i?t:t+4,l,i)}function L(e,t,r,n,i){e.setFloat32(t,n,i)}function k(e,t,r,n,i){e.setFloat64(t,n,i)}function G(e,t,r,n,i){let a=n,o=i;const s=t+r-1;for(let r=t;r<s;r++)e[r]=128|127&o,o=a<<25|o>>>7,a>>>=7;e[s]=o}function U(e,t,r,n){let i=t;const a=n.length;for(let t=0;t<a;t++){const r=n.charCodeAt(t);if(r<128)e[i++]=r;else if(r<2048)e[i++]=192|r>>6,e[i++]=128|63&r;else if(r<55296||57344<=r)e[i++]=224|r>>12,e[i++]=128|r>>6&63,e[i++]=128|63&r;else if(55296<=r&&r<56320&&t+1!==a){const a=n.charCodeAt(t+1);if(56320<=a&&a<57344){t++;const n=65536+((1023&r)<<10|1023&a);e[i++]=240|n>>18,e[i++]=128|n>>12&63,e[i++]=128|n>>6&63,e[i++]=128|63&n}else e[i++]=239,e[i++]=191,e[i++]=189}else e[i++]=239,e[i++]=191,e[i++]=189}}function F(e,t,r,i,a){const o=(0,n.hexLongIsNegative)(i),s=(0,n.hexLongToHex)(i);let l=0,c=0;for(let e=0;e<16;e++)l=l<<4|c>>>28,c=c<<4|(0,n.hexAt)(s,e);o&&(l=~l,0===c?l++:c=-c),e.setUint32(a?t+4:t,l,a),e.setUint32(a?t:t+4,c,a)}function x(e,t,r,n){for(let i=0;i<r;i++)e[t+i]=n[i]}function B(e,t){let r,n;for(e?(r=5,n=e>>>3):(r=1,n=t>>>7);n;)r++,n>>>=7;return r}function K(e,t,r,n){if("number"!=typeof e||e!=e||Math.floor(e)!==e||e<t||e>=r)throw new TypeError("string"==typeof e?`WriteError: string "${e}" is not a valid ${n}`:`WriteError: ${String(e)} is not a valid ${n}`)}function j(e,t,r){let n;n=t>=0||e?t:4294967296+t;const i=4294967296*n+(r>=0?r:4294967296+r);if(!u(e,t,r))throw new Error(`ReadError: integer exceeded 53 bits (${i})`);return i}function Y(e,t){return j(!0,e,t)}function W(e,t){return j(!1,e,t)}function H(e,t,r){if(t>=r)return 0;const n=0|e[t];return 128==(192&n)?n:0}},42341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=[];r[34]="ES",r[49]="DE",r[52]="MX",r[44]="GB",r[966]="SA",r[39]="IT",r[93]="AF",r[355]="AL",r[213]="DZ",r[376]="AD",r[244]="AO",r[54]="AR",r[374]="AM",r[297]="AW",r[61]="AU",r[43]="AT",r[994]="AZ",r[973]="BH",r[880]="BD",r[375]="BY",r[32]="BE",r[501]="BZ",r[229]="BJ",r[975]="BT",r[591]="BO",r[387]="BA",r[267]="BW",r[55]="BR",r[246]="IO",r[673]="BN",r[359]="BG",r[226]="BF",r[257]="BI",r[225]="CI",r[855]="KH",r[237]="CM",r[238]="CV",r[236]="CF",r[235]="TD",r[56]="CL",r[86]="CN",r[57]="CO",r[269]="KM",r[242]="CG",r[243]="CD",r[682]="CK",r[506]="CR",r[385]="HR",r[53]="CU",r[599]="CW",r[357]="CY",r[420]="CZ",r[45]="DK",r[253]="DJ",r[593]="EC",r[20]="EG",r[503]="SV",r[240]="GQ",r[291]="ER",r[372]="EE",r[251]="ET",r[298]="FO",r[679]="FJ",r[358]="FI",r[33]="FR",r[594]="GF",r[689]="PF",r[241]="GA",r[220]="GM",r[995]="GE",r[233]="GH",r[350]="GI",r[30]="GR",r[299]="GL",r[590]="GP",r[502]="GT",r[224]="GN",r[245]="GW",r[592]="GY",r[509]="HT",r[504]="HN",r[852]="HK",r[36]="HU",r[354]="IS",r[91]="IN",r[62]="ID",r[98]="IR",r[964]="IQ",r[353]="IE",r[972]="IL",r[81]="JP",r[962]="JO",r[254]="KE",r[965]="KW",r[996]="KG",r[856]="LA",r[371]="LV",r[961]="LB",r[266]="LS",r[231]="LR",r[218]="LY",r[423]="LI",r[370]="LT",r[352]="LU",r[853]="MO",r[389]="MK",r[261]="MG",r[265]="MW",r[60]="MY",r[960]="MV",r[223]="ML",r[356]="MT",r[692]="MH",r[596]="MQ",r[222]="MR",r[230]="MU",r[691]="FM",r[373]="MD",r[377]="MC",r[976]="MN",r[382]="ME",r[212]="MA",r[258]="MZ",r[95]="MM",r[264]="NA",r[674]="NR",r[977]="NP",r[31]="NL",r[687]="NC",r[64]="NZ",r[505]="NI",r[227]="NE",r[234]="NG",r[672]="NF",r[850]="KP",r[47]="NO",r[968]="OM",r[92]="PK",r[680]="PW",r[970]="PS",r[507]="PA",r[675]="PG",r[595]="PY",r[51]="PE",r[63]="PH",r[48]="PL",r[351]="PT",r[974]="QA",r[40]="RO",r[7]="RU",r[250]="RW",r[262]="RE",r[508]="PM",r[685]="WS",r[378]="SM",r[221]="SN",r[381]="RS",r[248]="SC",r[232]="SL",r[65]="SG",r[421]="SK",r[386]="SI",r[677]="SB",r[252]="SO",r[27]="ZA",r[82]="KR",r[211]="SS",r[94]="LK",r[249]="SD",r[597]="SR",r[268]="SZ",r[46]="SE",r[41]="CH",r[963]="SY",r[239]="ST",r[886]="TW",r[992]="TJ",r[255]="TZ",r[66]="TH",r[670]="TL",r[228]="TG",r[676]="TO",r[216]="TN",r[90]="TR",r[993]="TM",r[256]="UG",r[380]="UA",r[971]="AE",r[1]="US",r[598]="UY",r[998]="UZ",r[678]="VU",r[58]="VE",r[84]="VN",r[681]="WF",r[967]="YE",r[260]="ZM",r[263]="ZW",r[383]="XK";var n=r;t.default=n},81574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={1:'[334,-1,"($1) $2-$3"],10',20:'["Ah","[23]"],[334,"1[0125]|[89]00"],["Bg","1[35]|[4-6]|[89][2-9]"],[9,10]',211:"333,9",212:'["[5-7]BF","5(2[015-7]|3[0-4])|[67]",1],["[58]CE",["5(2[2-489]|3[5-9]|92)|892","5(2([2-48]|9[0-7])|3([5-79]|8[0-7])|924)|892"],1],["5DD",["5(29|38)","5(29|38)[89]"],1],["[5]BBBB","5(4[067]|5[03])"],["8[09];G","8(0|9[013-9])",1],9',213:'["[5-8]BBBB","[5-8]"],["9ACBB",9],9',216:"233,8",218:'[27,"[25-79]",1],9',220:"34,7",221:'[2322,"[379]"],[3222,8],9',222:'"[2-48]ABBB",8',223:'[2222,"[246-9]"],8',224:'[2222,3],[3222,"[67]"],[8,9]',225:"2222,8",226:'[2222,"[025-7]"],8',227:'[233,"08"],[2222,"[0289]"],8',228:'[2222,"[279]"],8',229:"2222,8",230:'[34,"[2-46]|8[013]"],[44,5],[7,8]',231:'[133,"[45]"],[233,2],[234,"[23578]"],[7,8,9]',232:"26,8",233:'[234,"[235]"],9',234:'["CCd","[7-9]"],["CDe","[78]"],["CEf","[78]"],10',235:"2222,8",236:"2222,8",237:'[2222,88],[12222,"[26]"],[8,9]',238:"322,7",239:"34,7",240:'[333,"[235]"],[36,"[89]"],9',241:"[2222,0],8",242:'[234,"[02]"],[144,8],9',243:'[234,1],[333,"[89]"],9',244:'[333,"[29]"],9',245:'[333,"44|9[567]"],[34,40],[7,9]',246:"[34,3],7",247:"5",248:'[133,"[246]"],7',249:'[234,"[19]"],9',250:'["2BCC",2],["[7-9]BCC","[7-9]"],9',251:'"[1-59]ACD",9',252:'[17,"24|[67]"],["BA{5,7}","15|28|6[1-35-9]|799|9[2-9]"],[333,"3[59]|4[89]|6[24-6]|79|8[08]|90"],[8,9]',253:"2222,8",254:'["BA{5,7}","[24-6]"],[36,7],["CCd","[89]"],9',255:'["[24]ACD","[24]"],["[67]BCC","[67]"],["[89]BBD","[89]"],9',256:'[45,[202,2024]],[36,"[27-9]|4(6[45]|[7-9])"],[27,"[34]"],9',257:"2222,8",258:'["[28]ACd","2|8[2-7]"],["80ACC",80],9',260:'["[29]AG","[29]"],["800;CC",8],9',261:'[2232,"[23]"],9',262:'"[268]BBBB",9',263:'["7ACd",7],["86BCC","86[24]"],["CCd","2(1[39]|2[0157]|6[14]|7[35]|84)|329"],["[235]ACd","[23]9|54"],["[25]CA{3,5}",["(25|54)8","258[23]|5483"]],["8CF",86],["80ACD",80],[9,10]',264:'["8ACD","8[1235]"],["6ACd",6],["870;CC",870],9',265:'["2BCC",2],[3222,"[1789]"],9',266:"44,8",267:'["7ACC",7],8',268:'[44,"[027]"],8',269:"322,7",27:'[333,860],[234,"[1-9]"],9',290:"[4,5]",291:"133,7",297:"34,7",298:"6,6",299:"222,6",30:'[244,"21|7"],[46,"2(2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])"],[334,"[2689]"],10',31:'["[1-578]ACD","1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[4578]"],["[1-5]BCC","1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],["6;H","6[0-57-9]"],["66;G",66],["[89]0AA{4,7}","80|9"],[9,11]',32:"[3222,4],9",33:'[3222,8],[12222,"[1-79]"],9',34:'["[89]00;CC","[89]00"],["[5-9]BBBB","[568]|[79][0-8]"],9',350:"[35,2],8",351:'["2ACD","2[12]"],["[2-46-9]BCC","2[3-9]|[346-9]"],9',352:'[2223,20],[333,6],["BBBBb","2([0367]|4[3-8])"],["BBBA{1,5}","[3-57]|8[13-9]|9(0[89]|[2-579])|(2|80)[2-9]"],9',353:'["AdD",1],["BCd","[2569]|4[1-69]|7[14]"],[333,70],[333,81],[234,"[78]"],[433,1],[2134,8],[244,4],9',354:'[34,"[4-9]"],["3BCC",3],[7,8,9]',355:'["6[6-9];CD",6],9',356:'[44,"[2357-9]"],8',357:"26,8",358:'["CA{3,7}","([1-3]00|[6-8]0)"],["116C",116],["BA{4,10}","[14]|2[09]|50|7[135]"],["AA{4,11}","[25689][1-8]|3"],[6,7,8,9,10,11]',359:'[333,999],["BCd","48|8[7-9]|9[08]"],9',36:'["BCd","[2-9]"],9',370:'[134,"52[0-79]"],[323,"[7-9]"],[26,"37|4([15]|6[1-8])"],[35,"[3-6]"],8',371:'[233,"[269]|8[01]"],8',372:'["[3-79]BD",["[369]|4[3-8]|5([0-2]|5[0-478]|6[45])|7[1-9]","[369]|4[3-8]|5([02]|1([0-8]|95)|5[0-478]|6(4[0-4]|5[1-589]))|7[1-9]"]],["70;BD",70],["8000;CC",[800,8000]],["[458]Cd",["40|5|8(00|[1-5])","40|5|8(00[1-9]|[1-5])"]],[7,8]',373:'[233,"22|3"],["[25-7]BBC","2[13-9]|[5-7]"],["[89]BE","[89]"],8',374:'[26,"1|47"],[26,"4[1349]|[5-7]|9[1-9]"],[35,"[23]"],[323,"8|90"],8',375:'[2322,["17[0-3589]|2[4-9]|[34]","17([02358]|1[0-2]|9[0189])|2[4-9]|[34]"],"$1 $2-$3-$4"],[3222,["1(5[24]|6[235]|7[467])|2(1[246]|2[25]|3[26])","1(5[24]|6(2|3[04-9]|5[0346-9])|7([46]|7[37-9]))|2(1[246]|2[25]|3[26])"],"$1 $2-$3-$4"],[423,["1(5[169]|6[3-5]|7[179])|2(1[35]|2[34]|3[3-5])","1(5[169]|6(3[1-3]|4|5[125])|7(1[3-9]|7[0-24-6]|9[2-7]))|2(1[35]|2[34]|3[3-5])"],"$1 $2-$3"],["[89]BCD","8[01]|9"],["82ADD",82],["800;BA{2,4}",800],9',376:'[33,"[135-9]"],[44,1],[333,6],[6,9]',377:'[2222,"[39]"],[233,4],["6;BBBB",6],[332,8],[8,9]',378:'[2222,"[5-7]"],["0549;F",0,"($1) $2"],8',379:"10",380:'[333,["6[12][29]|(3[1-8]|4[136-8]|5[12457]|6[49])2|(56|65)[24]","6[12][29]|(35|4[1378]|5[12457]|6[49])2|(56|65)[24]|(3[1-46-8]|46)2[013-9]"]],[234,["4[45][0-5]|5(0|6[37])|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]","4[45][0-5]|5(0|6(3[14-7]|7))|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]"]],[45,"[3-6]"],["CCd","[89]"],9',381:'["[23]BA{4,9}","(2[389]|39)0"],["[1-3]AA{5,10}","1|2([0-24-7]|[389][1-9])|3([0-8]|9[1-9])"],["6AA{6,8}",6],["[89]BA{3,9}","[89]"],["7[26];A{4,9}","7[26]"],["7[08]AA{4,9}","7[08]"],[8,9,10]',382:'[233,"[2-57-9]|6[036-9]"],[8,9]',383:'[233,"[23][89]|4[3-79]"],[35,"[89]00"],333,8',385:'["1;DC",1],["[2-5]ACd","[2-5]"],["9ACd",9],["[67]ACd","[67]"],["80[01];Bc",8],["80[01];CC",8],[8,9]',386:'[1322,"[12]|3[24-8]|4[24-8]|5[2-8]|7[3-8]"],["[3-7]ACC","[37][01]|4[0139]|51|6"],["[89][09];A{3,6}","[89][09]"],["[58]BE","59|8[1-3]"],8',387:'[233,"6[1-356]|[7-9]"],[233,"[3-5]","$1 $2-$3"],[2223,6],[8,9]',389:'["2;CD",2],["[347]ACC","[347]"],["[58]BABB","[58]"],8',39:'["BdD","0[26]|55"],["0[26];DE","0[26]"],["0BdD","0[13-57-9][0159]"],["CA{3,6}",["0[13-57-9][0159]|8(03|4[17]|9[245])","0[13-57-9][0159]|8(03|4[17]|9(2|[45][0-4]))"]],["0CCD","0[13-57-9][2-46-8]"],["0CA{2,6}","0[13-57-9][2-46-8]"],["CCd",["[13]|8(00|4[08]|9[59])","[13]|8(00|4[08]|9(5[5-9]|9))"]],[344,3],[9,10]',40:'[234,"[23]1"],[333,"[23][3-7]|[7-9]"],9',41:'["[2-9]ACBB","[2-7]|[89]1"],["[89]BCC","8[047]|90"],[32322,860],9',420:'["[2-9]BCC","[2-8]|9[015-7]"],["96ACCC",96],["9ACCC","9[36]"],9',421:'["2;CCB",2,"$1/$2 $3 $4"],["[3-5]ACBB","[3-5]","$1/$2 $3 $4"],["[689]BCC","[689]"],9',423:'[322,"[237-9]"],[234,69],[333,6],7',43:'["1;A{3,12}",1],["5ADA{4,7}","5[079]"],["CA{3,10}","316|46|51|732|6(5[0-3579]|[6-9])|7([28]0)|[89]"],["DA{3,9}","2|3(1[1-578]|[3-8])|4[2378]|5[2-6]|6([12]|4[1-9]|5[468])|7(2[1-8]|35|4[1-8]|[5-79])"],[10,11,12,13]',44:'["Ee",["1(38|5[23]|69|76|94)","1((38|69)7|5(24|39)|768|946)","1(3873|5(242|39[4-6])|(697|768)[347]|9467)"]],["Df","1([2-69][02-9]|[78])"],[244,["[25]|7(0|6[024-9])","[25]|7(0|6([04-9]|2[356]))"]],[46,7],[334,"[1389]"],10',45:"2222,8",46:'["8;ccB",8],["[1-69]AcBB","1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90"],[3222,"1[2457]|2([247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6([124-689]|7[0-2])|9([125-8]|3[0-5]|4[0-3])"],["7ACBB",7],["9[034]ABBC","9[034]"],[32322,"25[245]|67[3-6]"],9',47:'["[489]BBC","[489]"],["[235-7]ABBB","[235-7]"],8',48:'[2322,"[14]|2[0-57-9]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]"],[333,"26|39|5[0137]|6[0469]|7[02389]|8[08]"],9',49:'["BA{3,13}","3[02]|40|[68]9"],["CA{3,12}",["2(0[1-389]|1[124]|2[18]|3[14])|3([35-9][15]|4[015])|906|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(0[1-389]|12[0-8])|3([35-9][15]|4[015])|906|2([13][14]|2[18])|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"]],["DA{2,11}",["[24-6]|3([3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(3(0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(2[135]|4[13578]|9[1346])|5(0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(2[1-7]|4[145]|6[1-5]|7[1-4])|8(21|3[1468]|6|7[1467]|8[136])|9(0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(47|60)[1356]|3(3[46]|46|5[49])[1246]|3[4579]3[1357]"]],[34,138],["EA{2,10}",3],["CA{5,11}",181],["CAA{4,10}","1(3|80)|9"],["Ch","1[67]"],["CA{7,12}",8],[56,[185,1850,18500]],[344,7],[47,"18[68]"],[56,"15[0568]"],[47,"15[1279]"],[38,18],["CBh","1(6[023]|7)"],[427,"15[279]"],[328,15],[7,8,9,10,11,12]',500:"5",501:'[34,"[2-8]",1],["0;800;DC",0,1],7',502:'[44,"[2-7]"],[434,1],8',503:'[44,"[267]"],[344,"[89]"],8',504:'[44,"[237-9]",1],8',505:"44,8",506:'[44,"[24-7]|8[3-9]"],[334,"[89]0",1],8',507:"[44,6,1],8",508:'"[45]ABB",6',509:"224,8",51:"[333,9],9",52:'[244,"33|5[56]|81"],[334,"[2-9]"],[1244,"1(33|5[56]|81)"],[1334,1],[10,11]',53:'["Ag",7],["BA{4,6}","[2-4]"],[17,5],8',54:'[424,["2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(2[24-9]|3[1-59]|47)","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5[56][46]|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(4[35][56]|58[45]|8([38]5|54|76))[4-6]","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|58|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|54(4|5[13-7]|6[89])|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(454|85[56])[46]|3(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2-$3"],[244,1,"$1 $2-$3"],[334,"[23]","$1 $2-$3"],[334,"[68]",1],[1424,["9(2[2-469]|3[3-578])","9(2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(2[24-9]|3[1-59]|47)","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5([56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4[35][56]|58[45]|8([38]5|54|76))[4-6]","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|5(4[46]|8)|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|5(4(4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2 $3-$4"],[1244,91,"$1 $2 $3-$4"],[1334,9,"$1 $2 $3-$4"],[10,11]',55:'[244,"[1-9][1-9]","$1 $2-$3"],[254,"([14689][1-9]|2[12478]|3[1-578]|5[1-5]|7[13-579])9","$1 $2-$3"],["[3589]00;cD","[3589]00"],[10,11]',56:'[144,"2[23]"],[234,"[357]|4[1-35]|6[13-57]"],["9;DD",9],["44;CD",44],["[68]00;Cd","60|8"],["600;CBC",60],["1230;CD",1],[54,219],9',57:'[17,["1(8[2-9]|9[0-3]|[2-7])|[24-8]","1(8[2-9]|9(09|[1-3])|[2-7])|[24-8]"]],[37,3],["1;CG",["1(80|9[04])","1(800|9(0[01]|4[78]))"]],[8,10]',58:"[37,-1,1],10",590:'["[56]90;BD",-1,"$1 $2-$3"],9',591:'[17,"[23]|4[46]"],[8,"[67]"],[324,8],8',592:"34,7",593:'[134,"[247]|[356][2-8]",1],[234,9],["1800;Cd",1],[8,9]',594:"3222,9",595:'["BCd","([26]1|3[289]|4[124678]|7[123]|8[1236])"],["CA{3,6}","[2-9]0"],[36,"9[1-9]"],[234,8700],[333,"[2-8][1-9]"],9',596:"3222,9",597:'[34,"[6-8]",1],7',598:'[233,9],[44,"[24]"],8',599:'[34,"[13-7]"],["9;CD",9],[7,8]',60:'["3;DD",3,"$1-$2 $3"],["[18]ACd","1[02-46-9][1-9]|8","$1-$2 $3"],["1;[36-8]00;BD","1[36-8]0",1],["11;DD",11,"$1-$2 $3"],["15[49];CD",15,"$1-$2 $3"],[9,10]',61:'["BCA{2,4}",16],[333,"14|[45]"],[144,"[2378]"],[433,"1(30|[89])"],9',62:'["BA{5,9}","2[124]|[36]1"],["CA{5,7}",800],["CA{5,8}","[2-79]"],["CdC","8[1-35-9]",1],["CA{6,8}",1],[334,804],[3133,80],["CDe",8,1],[2434,0],[9,10,11,12]',63:'["DA{4,6}",["3(23|39|46)|4(2[3-6]|[35]9|4[26]|76)|544|88[245]|(52|64|86)2","3(230|397|461)|4(2(35|[46]4|51)|396|4(22|63)|59[347]|76[15])|5(221|446)|642[23]|8(622|8([24]2|5[13]))"]],[334,"[89]"],[434,1],["DbCD",1],10',64:'[323,"[89]0"],[134,"24|[346]|7[2-57-9]|9[2-9]","$1-$2 $3"],["CCd","2(10|74)|[59]|80"],["BdD","2[028]"],["BCA{3,5}","2([169]|7[0-35-9])|7|86"],[8,9,10]',65:'["[3689]CD","[369]|8[1-9]"],["1[89]00;CD","1[89]"],["7000;DC",70],["800;CD",80],8',66:'["BCd","14|[3-9]"],[433,1],9',670:"[44,7],8",672:"[24,1],[15,3],[5,6]",673:'"[2-578]BD",7',674:"34,7",675:'[34,"[13-689]|27"],[44,"20|7"],[7,8]',676:'[34,"7[5-9]|8[47-9]"],[43,0],7',677:'[25,"[7-9]"],7',678:'[34,"[579]"],7',679:'[34,"[35-9]"],[434,0],7',680:"34,7",681:"222,6",682:"23,5",683:"4",685:'["8Bd",8],["7AE",7],[6,7]',686:"8",687:'[222,"[2-46-9]|5[0-4]","$1.$2.$3"],6',688:"[6,7]",689:'[2222,"4[09]|8[79]"],[222,44],[6,8]',690:"[4,5,6,7]",691:"34,7",692:"[34,-1,1],7",7:'[4222,["7(1[0-8]|2[1-9])","7(1([0-6]2|7|8[27])|2(1[23]|[2-9]2))","7(1([0-6]2|7|8[27])|2(13[03-69]|62[013-9]))|72[1-57-9]2"]],[5122,["7(1[0-68]|2[1-9])","7(1([06][3-6]|[18]|2[35]|[3-5][3-5])|2([13][3-5]|[24-689]|7[457]))","7(1(0([356]|4[023])|[18]|2(3[013-9]|5)|3[45]|43[013-79]|5(3[1-8]|4[1-7]|5)|6(3[0-35-9]|[4-6]))|2(1(3[178]|[45])|[24-689]|3[35]|7[457]))|7(14|23)4[0-8]|71(33|45)[1-79]"]],[334,7],[3322,"[3489]","$1 $2-$3-$4"],10',81:'[334,800,1],["DBd","0077",1],[424,"0088",1],["DCd","00(37|66)",1],["DDe","00(37|66)",1],["DEf","00(37|66)",1],["DFg","00(37|66)",1],[244,"[2579]0|80[1-9]",1],10',82:'["AdD",2,1],[234,"60|8",1],["BdD","[1346]|5[1-5]",1],[244,"[57]",1],[533,["003","0030"]],[254,5,1],["EdD",0],[5234,0],[9,10]',84:'[244,"2[48]"],[343,"2[0-35-79]"],["[89]ACBB","8(8|9[89])|9"],["1[2689]ACD","1([26]|8[68]|99)"],["[3578]ACD","[357]|8[1-5]"],["86[89];CC","86[89]"],["1[89]00;A{4,6}",["1[89]0","1[89]00"]],[9,10]',850:"[334,1],10",852:'[44,"[235-7]|[89](0[1-9]|[1-9])"],["800;CC",800],["900;BCC",900],["900;A{2,5}",900],8',853:'"[268]CD",8',855:'["BCd","[1-9]"],[433,1],[8,9]',856:"[2233,2],10",86:'["21;DA{4,6}",21],[344,"3(11|7[179])|4([15]1|3[1-35])|5(1|2[37]|3[12]|51|7[13-79]|9[15])|7(31|5[457]|6[09]|91)|8([57]1|98)"],[434,[807,8078]],[344,"1[3-578]"],["10800;CD",[108,1080,10800]],["Ch",950],11',880:'["CA{3,7}","3([67]|8[013-9])|4(6[168]|7|[89][18])|5(6[128]|9)|6(28|4[14]|5)|7[2-589]|8(0[014-9]|[12])|9[358]|(3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(44|66)[01346-9]",1],["DA{3,6}","[13-9]",1],10',886:'["AdD","[25][2-8]|[346]|7[1-9]|8[237-9]"],[234,"[258]"],[333,9],[244,7],9',90:'[334,"512|8[0589]|90"],[3322,["5([0-59]|61)","5([0-59]|616)","5([0-59]|6161)"]],[3322,"[24][1-8]|3[1-9]"],10',91:'[55,["600|7([02-8]|19|9[037-9])|8(0[015-9]|[1-9]|20)|9","600|7([078]|19[0-5]|2([02356-9]|[14][017-9]|9[389])|3([025-9]|1[07-9]|[34][017-9])|4([0-35689]|[47][017-9])|5([02346-9]|1[017-9]|5[017-9])|6([02-9]|1[0-257-9])|9([089]|31|7[02-9]))|8(0([01589]|6[67]|7[02-9])|1([0-57-9]|6[07-9])|2(0[078]|[14][07-9]|[235-9])|3([0357-9]|[126][07-9]|4[1-9])|[45]|6([02457-9]|[136][07-9])|7([078][07-9]|[1-69])|8([0-25-9]|3[07-9]|4[047-9])|9([02-9]|1[027-9]))|9","600|7(0|19[0-5]|2([0235679]|[14][017-9]|8([0-569]|[78][089])|9[389])|3([05-8]|1([089]|7[5-9])|2([5-8]|[0-49][089])|3[017-9]|4([07-9]|11)|9([01689]|[2345][089]|40|7[0189]))|4([056]|1([0135-9]|[23][089]|2[089]|4[089])|2(0[089]|[1-7][089]|[89])|3([0-8][089]|9)|4([089]|11|7[02-8])|7([089]|11|7[02-8])|8([0-24-7][089]|[389])|9([0-7][089]|[89]))|5([0346-9]|1[017-9]|2([03-9]|[12][089])|5[017-9])|6([0346-9]|1[0-257-9]|2([0-4].|[5-9][089])|5([0-367][089]|[4589]))|7(0([02-9]|1[089])|[1-9])|8([0-79]|8(0[0189]|11|8[013-9]|9))|9([089]|313|7([02-8]|9[07-9])))|8(0([01589]|6[67]|7([02-8]|9[05-9]))|1([02-57-9]|1([0-35-9]|4[0-46-9])|6([089]|7[02-8]))|2(0([08]|7[02])|[14]([089]|7[02-8])|[235-9])|3([0357-9]|1([089]|7[02-6])|2([09]|77|8[0-689])|4[1-9]|6([089]|7[02-7]))|[45]|6([02457-9]|1([089]|7[02-8])|3([089]|7[02358])|6([08]|7[02-8]|9[01]))|7(0[07-9]|[1-69]|7([089]|7[02-8])|8([089]|7[02-8]))|8([0-25-9]|3([089]|7[02-8])|4([0489]|7[02-68]))|9([02-9]|1([0289]|7[2-6])))|9"]],[244,"11|2[02]|33|4[04]|79[1-9]|80[2-46]"],[334,"1(2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(1[025]|[36][25]|22|4[28]|5[12]|[78]1|9[15])|6(12|[2345]1|57|6[13]|7[14]|80)|7(12|2[14]|3[134]|4[47]|5[15]|[67]1|88)|8(16|2[014]|3[126]|6[136]|7[078]|8[34]|91)"],[433,"1([23579]|[468][1-9])|[2-8]"],[2343,"008"],[334,140],[424,[160,1600]],["DA{2,4};D",[180,1800]],["DdD",[186,1860]],[4333,"18[06]"],10',92:'["Bh","(2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],["Cg",["2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(2[3-8]|98)|(2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"]],[55,58],[37,3],[2333,"2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],[3333,"[24-9]"],10',93:'["[2-7]ACD","[2-7]"],9',94:'[234,7],[333,"[1-689]"],9',95:'["ACd","[12]"],["BCd","[4-7]|8[1-35]"],["ACA{4,6}","9(2[0-4]|[35-9]|4[137-9])"],[144,2],[334,8],[1333,92],[154,9],[8,9,10]',960:'[34,"[3467]|9([1-9]|0[1-9])",1],[334,"[89]00"],7',961:'[133,"[13-69]|7([2-57]|62|8[0-7]|9[04-9])|8[02-9]"],[233,"[7-9]"],[7,8]',962:'["7;DD","7[457-9]"],["Cf","70|8[0158]|9"],9',963:'["BCd","[1-5]"],["9BCC",9],9',964:'["BCd","[2-6]"],[334,7],[9,10]',965:'["Dd","[169]|2([235]|4[1-35-9])|52"],[35,"[25]"],8',966:'[45,9],[234,1],[234,5],["CCd",81],[334,8],9',967:'["7BCC","7[0137]"],9',968:'["CA{4,6}","[58]"],[26,2],[44,"[79]"],8',970:'["5[69]ACC",5],["1[78]00;CC","1[78]"],9',971:'["CA{2,9}","60|8"],[315,"[479]"],[234,5],9',972:'[234,"[57]",1],[433,12,1],[46,159,1],[1333,"1[7-9]",1],["CbCD",15,"$1-$2 $3-$4"],9',973:"44,8",974:'["[3-7]CD","[3-7]"],8',975:'[2222,"1|77"],8',976:'["[12]ABD","[12]1"],["[12]2Af","[12]2[1-3]"],["[12]CE",["[12](27|[3-5])","[12](27|[3-5].)2"]],[44,"[57-9]"],["[12]De",["[12](27|[3-5])","[12](27|[3-5].)[4-9]"]],8',977:'["9BG","9(6[013]|7[245]|8)",1],10',98:'[244,"[1-8]"],["CCd",9],10',992:'[612,[331,3317]],[324,"[34]7|91[78]"],[414,3],[234,"[457-9]"],9',993:'[2222,12,"$1 $2-$3-$4"],[26,6],[3122,"13|[2-5]","$1 $2-$3-$4"],8',994:'[3222,9],[2322,["[12]|365","[12]|365","[12]|365([0-46-9]|5[0-35-9])"]],[2322,"[3-8]"],9',995:'[3222,"[348]"],[333,7],[3222,5],9',996:'[45,"3(1[346]|[24-79])"],[333,"[235-79]"],["CCAc",8],9',998:'[2322,"[679]"],[7,8,9]'}},40265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedError=t.UnimplementedMethod=t.TimeoutError=t.HttpError=t.AggregateError=void 0,t.customError=n,t.hasSupressedQuotaExceededError=function(){return l},t.obtainErrorSummary=function(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))},t.supressQuotaExceededError=function(e){if(null==e||"QuotaExceededError"!==e.name)throw e;l=!0};const r=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function n(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;function i(r){const n=Error.call(this,r);this.message=r,n.name=e,this.name=e,t&&(this.stack=n.stack)}return i.prototype=Object.create(n?n.prototype:r),i.prototype.constructor=i,i}class i extends(n("AggregateError",!0)){constructor(e,t){super(null!=t&&t.length>0?t:function(e){return 0===e.length?"No errors":1===e.length?e[0].message:e.map((e=>"- "+e.message)).join("\n")}(e)),this.errors=e}}t.AggregateError=i;class a extends(n("TimeoutError",!1)){}t.TimeoutError=a;class o extends(n("HttpError",!1)){constructor(e,t){super(e),this.code=t}}t.HttpError=o;class s extends(n("UnimplementedMethod")){}t.UnimplementedMethod=s;let l=!1;class c extends Error{constructor(e,t){super(e),this.inner=t}}t.WrappedError=c},72651:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GzipWrapper=void 0,t.createDeflate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new i(e)},t.inflate=function(e){return(0,n.decompressSync)(e)};var n=r(56856);class i extends n.Gzip{constructor(e){super(e),this._chunks=[],this.ondata=(e,t)=>{if(this._chunks.push(e),!t)return;let r=0;this._chunks.forEach((e=>{r+=e.length}));const n=new Uint8Array(r);let i=0;this._chunks.forEach((e=>{n.set(e,i),i+=e.length})),this._result=n}}push(e,t){if(null!=this._result)throw new Error("Tried to push chunk to compressor after final block");e instanceof Uint8Array?super.push(e,t):e instanceof ArrayBuffer?super.push(new Uint8Array(e),t):super.push((0,n.strToU8)(e),t)}result(){if(null==this._result)throw new Error("Tried to access result before adding final block");return this._result}}t.GzipWrapper=i},33344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},92226:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null===e)return"null";switch(typeof e){case"undefined":return"undefined";case"number":return`n:${e}`;case"string":return`s:${e}`;case"boolean":return`b:${e.toString()}`;case"object":{let t=r.get(e);return null==t&&(t=n++,r.set(e,t)),`o:${t}`}default:throw new Error("Unsupported type")}};const r=new WeakMap;let n=0},87614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUM_HEX_IN_LONG=t.HEX_LOWER=void 0,t.bytesToBuffer=function(e){const t=e.buffer;return 0===e.byteOffset&&e.length===t.byteLength?t:t.slice(e.byteOffset,e.byteOffset+e.length)},t.bytesToDebugString=function(e){let t=!0,r=e.length;for(;t&&r;){const n=e[--r];t=32<=n&&n<127}return t?JSON.stringify(String.fromCharCode.apply(String,e)):i(e)},t.createHexLong=s,t.createHexLongFrom32Bits=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=p(e),i=p(t);return`${r?"-":""}0x${n}${i}`},t.hexAt=a,t.hexLongFromNumber=function(e){const t=e<0;return s(t?(-e).toString(16):e.toString(16),t)},t.hexLongIsNegative=d,t.hexLongToHex=c,t.hexOrThrow=o,t.isBiggerHexLong=function(e,t){const r=d(e),n=d(t);if(r!==n)return!r;const i=c(e)>c(t);return r?!i:i},t.negateHexLong=function(e){return d(e)?e.slice(1):"-"+e},t.parseHex=function(e){const t=o(e);if(t.length%2!=0)throw new Error(`parseHex given hex "${t}" which is not a multiple of 8-bits.`);const r=new Uint8Array(t.length>>1);for(let e=0,n=0;e<t.length;e+=2,n++)r[n]=a(t,e)<<4|a(t,e+1);return r.buffer},t.randomHex=function(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t),i(t)},t.toHex=i,t.toLowerCaseHex=function(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];t.push(n[i>>4],n[15&i])}return String.fromCharCode.apply(String,t)};t.NUM_HEX_IN_LONG=16;const r=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],n=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102];function i(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(r[i>>4],r[15&i])}return String.fromCharCode.apply(String,t)}function a(e,t){const r=e.charCodeAt(t);return r<=57?r-48:r<=70?10+r-65:10+r-97}function o(e){if(/[^0-9a-fA-F]/.test(e))throw new Error(`"${e}" is not a valid hex`);return e}function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=o(e);return u(r,16),`${t?"-":""}0x${l(r,16)}`}function l(e,t){const r=t-e.length;let n=e;for(let e=0;e<r;e++)n="0"+n;return n}function c(e){return e.substring(e.indexOf("0x")+2)}function d(e){return"-"===e[0]}function u(e,t){if(e.length>t)throw new Error(`"${e}" is longer than ${4*t} bits.`)}function p(e){if(e>4294967295||e<-4294967296)throw new Error("uint32ToLowerCaseHex given number over 32 bits");return l((e>=0?e:4294967296+e).toString(16),8)}t.HEX_LOWER=n},89181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inflatePhoneRegex=function(e){let t;t="number"==typeof e?String(e).split("").map((e=>".".repeat(Number(e)))).join(")("):e.replace(/;|[a-zA-Z]+/g,(e=>";"===e?")(":e.split("").map((e=>{const t=e.charCodeAt(0);return t>=97?".".repeat(t-96)+"?":".".repeat(t-64)})).join(")(")));return`(${t})`}},52230:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.WA_USER_JID_SUFFIX=t.WA_USER_DOMAIN=t.WA_SERVER_DOMAIN=t.SURVEY_USER_JID=t.STATUS_JID=t.MSGR_USER_JID_SUFFIX=t.MSGR_USER_DOMAIN=t.LID_DOMAIN=t.DEFAULT_DEVICE_ID=t.AUTHOR_SYSTEM=t.AUTHOR_ME=void 0,t.asChatJid=function(e){return e===s?null:e},t.asMulticastJid=function(e){return null==w(e)?e:null},t.asPhoneChatJid=function(e){return e===s?null:e},t.asStatusJid=function(e){return e===s?s:null},t.authorAsPhoneUserJid=function(e){if(e===a||e===o)return null;if(!e.endsWith(h))return null;return e},t.authorAsUserJid=function(e){if(e===a||e===o)return null;return e},t.authorToUserId=function(e,t){return e===a||e===o?t:M(e)},t.createJidUtils=function(e){let{platform:t}=e;const r="msgr"===t?d:h;return{toUserJid:function(e){return`${e}${r}`},toDeviceJid:function(e,t){return`${b(e)}:${t}${r}`},getUserDomain:function(){return r},getGroupCallDomain:function(){return"@call"},defaultDeviceJidForUser:function(e){return`${b(e)}:0${r}`}}},t.defaultLidDeviceJidForLidUserJid=function(e){return P(e,0)},t.defaultMsgrDeviceJidForUser=function(e){return`${b(e)}:0@msgr`},t.defaultPhoneDeviceJidForUser=function(e){return`${b(e)}:0@s.whatsapp.net`},t.extractDeviceIDParts=O,t.extractDeviceId=I,t.extractFromJid=L,t.extractJidFromJidWithType=function(e){return"phoneDevice"===e.jidType||"lidDevice"===e.jidType||"msgrDevice"===e.jidType?e.deviceJid:"lidUser"===e.jidType||"msgrUser"===e.jidType||"phoneUser"===e.jidType?e.userJid:"group"===e.jidType?e.groupJid:"status"===e.jidType?e.statusJid:"call"===e.jidType?e.callJid:(e.jidType,e.broadcastJid)},t.extractPhoneUserJid=function(e){return D(e)},t.extractUserId=M,t.extractUserJid=D,t.fullFormDeviceJidString=function(e){const{user:t,agent:r="0",device:n="0",server:i}=N(e);return`${t}.${r}:${n}@${i}`},t.getGroupDomain=function(){return l},t.getMsgrUserDomain=function(){return d},t.getServerDomain=function(){return"@s.whatsapp.net"},t.getWhatsappUserDomain=function(){return h},t.groupIdFromJid=function(e){if(e.endsWith(l))return e.slice(0,-l.length);throw new Error(`groupId called with non-group jid "${e}"`)},t.interpretAndValidateJid=k,t.interpretAsDeviceId=function(e){return e},t.interpretAsGroupJid=U,t.interpretAsNumber=function(e){return e},t.interpretAsPhoneUserJid=function(e){return e.endsWith(h)?e:null},t.interpretAsUserJid=w,t.isAuthorMe=function(e){return"@me"===e},t.isAuthorSystem=function(e){return"@system"===e},t.isPrimaryDevice=function(e){return 0===I(e)},t.lidFromLidUserJid=R,t.maybeSanitizeLogLineText=function(e){if(!e.includes("@"))return e;return e.replace(C,G)},t.parseJidParts=N,t.phoneNumberFromJid=function(e){if(!e.endsWith(h))throw new Error(`phoneNumberFromJid called with non-user jid "${e}"`);return e.slice(0,-h.length)},t.sanitizeJidForLogging=G,t.stripAgentIdFromPhoneDeviceJid=function(e){const{user:t,device:r="0",server:n}=N(e);return`${t}:${r}@${n}`},t.switchOnChatJidType=F,t.switchOnJidType=function(e,t){if(e===s)return t.status();return F(e,{phoneUser:t.phoneUser,msgrUser:t.msgrUser,lidUser:t.lidUser,group:t.group})},t.switchOnMsgrChatJidType=function(e,t){if(e.endsWith(d))return t.user(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)},t.switchOnMulticastJidType=function(e,t){if(e===s)return t.multicast(s);return x(e,{user:t.user,group:t.multicast})},t.switchOnPhoneChatJidType=x,t.switchOnPhoneJidType=function(e,t){if(e===s)return t.status();return x(e,{user:t.user,group:t.group})},t.toBroadcastJid=function(e){return`${e}@broadcast`},t.toGroupJid=function(e){if(e.endsWith(l))return e;return`${e}@g.us`},t.toLidDeviceJid=P,t.toMsgrDeviceJid=function(e,t){return`${b(e)}:${t}@msgr`},t.toMsgrUserJid=A,t.toPhoneDeviceJid=function(e,t){return`${b(e)}:${t}@s.whatsapp.net`},t.toPhoneUserJid=function(e){return`${e}@s.whatsapp.net`},t.unsafeCoerceToDeviceId=z,t.unsafeCoerceToDeviceJid=B,t.unsafeCoerceToGroupJid=$,t.unsafeCoerceToLidDeviceJid=Y,t.unsafeCoerceToMsgrDeviceJid=j,t.unsafeCoerceToMsgrUserJid=V,t.unsafeCoerceToPhoneDeviceJid=K,t.unsafeCoerceToPhoneUserJid=H,t.unsafeCoerceToUserJid=W,t.userIdFromJid=b;var i=n(r(84973));t.DEFAULT_DEVICE_ID=0;const a="@me";t.AUTHOR_ME=a;const o="@system";t.AUTHOR_SYSTEM=o;const s="status@broadcast";t.STATUS_JID=s;const l="@g.us",c=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,d="@msgr";t.MSGR_USER_DOMAIN=d;t.MSGR_USER_JID_SUFFIX="msgr";const u=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,p=/^([1-9][0-9]{0,19})@msgr$/,f=/^([1-9][0-9]{0,19}):0?@msgr$/,_="s.whatsapp.net";t.WA_SERVER_DOMAIN=_;const h="@s.whatsapp.net";t.WA_USER_DOMAIN=h;t.WA_USER_JID_SUFFIX="s.whatsapp.net";const g=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,m=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,y="@lid";t.LID_DOMAIN=y;const E=/^([1-9][0-9]{0,14})@lid$/,S=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,v=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,T=/^([0-9a-fA-F]{18,32})@call$/;t.SURVEY_USER_JID="16505361212@s.whatsapp.net";const C=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function A(e){return`${e}@msgr`}function b(e){if(e.endsWith(h))return e.slice(0,-h.length);if(e.endsWith(d))return e.slice(0,-d.length);if(e.endsWith(y))return e.slice(0,-y.length);throw new Error(`userIdFromJid called with non-user jid "${e}"`)}function P(e,t){return`${R(e)}:${t}@lid`}function M(e){return e.split("@")[0]}function O(e){const t=e.split("@")[0].split(":"),r=t[0],n=t[1];return{userId:r,deviceID:parseInt(n,10)}}function I(e){return O(e).deviceID}function w(e){return e.endsWith(h)||e.endsWith(d)||e.endsWith(y)?e:null}function R(e){if(!e.endsWith(y))throw new Error(`lidFromLidUserJid called with non-LidUserJid "${e}"`);return e.slice(0,-y.length)}function D(e){const t=e.split("@");let r=t[0];const n=t[1];return r=r.split(":")[0],r=r.split(".")[0],`${r}@${n}`}function N(e){const[t,r]=e.split("@"),[n,i]=t.split(":"),[a,o]=n.split(".");return{user:a,device:i,agent:o,server:r}}function L(e){switch(e.jidType){case"lidUser":case"msgrUser":case"phoneUser":return e.userJid;case"group":return e.groupJid;case"status":return e.statusJid;case"lidDevice":case"msgrDevice":case"phoneDevice":return e.deviceJid;case"broadcast":return e.broadcastJid;case"call":return e.callJid;default:return(0,i.default)(e.jidType)}}function k(e){if(e===s)return{jidType:"status",statusJid:s};if(m.test(e))return{jidType:"phoneUser",userJid:e};if(p.test(e))return{jidType:"msgrUser",userJid:e};if(f.test(e)){return{jidType:"msgrUser",userJid:A(e.substr(0,e.indexOf(":")))}}return g.test(e)?{jidType:"phoneDevice",deviceJid:e}:u.test(e)?{jidType:"msgrDevice",deviceJid:e}:c.test(e)?{jidType:"group",groupJid:e.endsWith(l)?e:`${e}@g.us`}:v.test(e)?{jidType:"broadcast",broadcastJid:e}:T.test(e)?{jidType:"call",callJid:e}:E.test(e)?{jidType:"lidUser",userJid:e}:S.test(e)?{jidType:"lidDevice",deviceJid:e}:{jidType:"unknown"}}function G(e){const t=k(e);return"unknown"===t.jidType?e:"status"===t.jidType?t.statusJid:(t.jidType,L(t).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3"))}function U(e){return e.endsWith(l)?e:null}function F(e,t){if(e.endsWith(h))return t.phoneUser(e);if(e.endsWith(d))return t.msgrUser(e);if(e.endsWith(y))return t.lidUser(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function x(e,t){if(e.endsWith(h))return t.user(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function B(e){return e}function K(e){return e}function j(e){return e}function Y(e){return e}function W(e){return e}function H(e){return e}function V(e){return e}function $(e){return e}function z(e){return e}},14950:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoizeCache=void 0,t.clearAllMemoizeCache=function(){r.forEach((e=>e.clear()))},t.memoizeWithArgs=function(e,t){let r;return function(){r||(r=new n);const i=t(...arguments);let a=r.get(i);return null==a&&(a=e(...arguments),r.set(i,a)),a}};const r=[];class n extends Map{constructor(){super(),r.push(this)}}t.MemoizeCache=n},45095:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(null==e)throw new Error(`Unexpected null or undefined: ${t}`);return e}},5298:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=r;const n=function(){if(t===r){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];t=e.call(this,...i)}return t};return n.reset=()=>{t=r},n};const r={}},40277:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDigits=function(e){const t=e.match(/\d+/g);return null!=t?t.join(""):""},t.findCC=p,t.formatPhone=f,t.formattedPhoneNumber=function(e){return f((0,o.phoneNumberFromJid)(e))},t.isPotentiallyPhoneNumber=function(e){return _.test(e)},t.isPotentiallyValid=function(e,t){if(!/^\d+$/.test(t))return!1;const r=d[e]||u(e);if(!r)return!1;return"number"==typeof r.lengths?r.lengths===t.length:r.lengths.includes(t.length)},t.phoneCC=function(e){return p(e)};var i=n(r(81574)),a=r(89181),o=r(52230);const s=/^(1|2[07]|3[0-469]|4[013-9]|5[1-8]|6[0-6]|7|8[1246]|9[0-58])/,l=new Map;class c{constructor(e){let t;if(Array.isArray(e)){t=e[0];let r=e[1];null!=r&&-1!==r&&(Array.isArray(r)||(r=[r]),this._leadins=r.map((function(e){return new RegExp("^("+e+")")}))),this._formatString=e[2]}else t=e;this._regex=new RegExp(`^${(0,a.inflatePhoneRegex)(t)}$`)}_testAndFormat(e){if(!this._regex.test(e)||!this._checkLeadins(e))return!1;if("string"==typeof this._formatString)return e.replace(this._regex,this._formatString);const t=this._regex.exec(e);return null!=t?t.slice(1).join(null!=this._formatString?"-":" "):void 0}_checkLeadins(e){return!this._leadins||this._leadins.some((function(t){return t.test(e)}))}}const d={};function u(e){const t=null!=i.default[e]?JSON.parse(`[${i.default[e]}]`):null;if(null==t)return null;const r=t.pop();return d[e]={lengths:r,formats:t.map((function(e){return new c(e)}))}}function p(e){const t=e.match(s);return t?t[0]:e.length>=3?e.substring(0,3):e}function f(e){let t=l.get(e);return null==t&&(t=function(e){const t=e.length>0&&"+"===e[0]?e.substring(1):e,r=p(t);if(!r)return t;const n=t.substring(r.length),i=d[r]||u(r);if(!i)return"+"+r+" "+n;const a=i.formats;for(let e=0;e<a.length;e++){const t=a[e]._testAndFormat(n);if(null!=t&&!1!==t&&""!==t)return"+"+r+" "+t}return"+"+r+" "+n}(e),l.set(e,t)),t}const _=/^\+*[\d ()]+$/},87040:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeError=function(e){return{success:!1,error:e}},t.makeSuccess=function(e){return{success:!0,value:e}}},57319:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShiftTimer=void 0;function r(e){if(!(e>=0))throw new Error("ShiftTimer must be given delay >= 0")}t.ShiftTimer=class{constructor(e){this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,this._run=()=>{const e=this._arg,t=this._foo;this._rafId=0,this._timer=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,t(e)},this.onOrBefore=(e,t)=>{r(e);const n=Date.now()+e,i=this._upperBound;if(0!==i&&i<n)return;const a=this._lowerBound;0!==a&&n<a||(this._upperBound=n,this._rafId||this._timer&&!(n<this.ts)||this._setDelay(n,e,t))},this.forceRunNow=e=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._arg=e,this._run()},this.cancel=()=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0},this._foo=e}onOrBeforeRepaint(e){if(this._rafId)return;const t=Date.now(),r=this._lowerBound;if(0!==r&&t<r)return;const n=this._upperBound;(0===n||t<n)&&(this._upperBound=t),this._timer&&(clearTimeout(this._timer),this._timer=0),(!this.ts||this.ts>t)&&(this.ts=t),this._arg=e,this._rafId=requestAnimationFrame(this._run)}onOrAfter(e,t){r(e);const n=Date.now()+e,i=this._lowerBound;if(0!==i&&n<i)return;const a=this._upperBound;0!==a&&a<n||(this._lowerBound=n,(!this._timer||this.ts<n)&&this._setDelay(n,e,t))}debounce(e,t){r(e),this._debounce(Date.now(),e,t)}debounceAndCap(e,t,n){r(e),r(t);const i=Date.now(),a=i+t,o=this._lowerBound,s=this._upperBound;(0===o||o<=a)&&(0===s||a<s)&&(this._upperBound=a),this._debounce(i,e,n)}forceRunNowIfScheduled(){this._timer?(clearTimeout(this._timer),this._run()):this._rafId&&(cancelAnimationFrame(this._rafId),this._run())}isScheduled(){return 0!==this._timer||0!==this._rafId}_debounce(e,t,r){const n=e+t,i=this._lowerBound;if(0!==i&&n<i)return;const a=this.ts,o=this._upperBound;0!==o&&o<n?a<o&&this._setDelay(o,o-e,r):a<n&&this._setDelay(n,t,r)}_setDelay(e,t,r){if(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._arg=r,this.ts=e,this._timer){const t=e-this._timerTs;if(-16<t&&t<16)return;clearTimeout(this._timer)}this._timer=setTimeout(this._run,t),this._timerTs=e}}},2821:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DO_NOT_RESCHEDULE=void 0,t.awaitTaskPromise=function(e){return l("awaitTaskPromise").awaitTaskPromise(e)},t.deactivate=function(e){s(e,i.DUMMY_UNIXTIME)},t.getScheduledTime=function(e){return l("getScheduledTime").getScheduledTime(e)},t.registerTask=function(e,t){l("registerTask").registerTask(e,t)},t.reschedule=s,t.rescheduleNow=function(e){s(e,(0,i.unixTime)())},t.startScheduler=function(e){__LOG__(2)`startScheduler invoked`,o||(o=new a(e))};var n=r(37178),i=r(92844);t.DO_NOT_RESCHEDULE="no_reschedule";class a{constructor(e){this._started=!1,this._resolvers={},this._timers={},this._timeoutIDs={},this._taskImplementations=new Map,this._scheduledTimeResolver=e.scheduledTimeResolver}_startTask(e){const t=this._taskImplementations.get(e);null!=t?this._scheduledTimeResolver.get(e).then((r=>{const n=null==r;if(!n&&r===i.DUMMY_UNIXTIME)return void __LOG__(2)`Task ${e} deactivated`;let a=null==r?0:1e3*r-(0,i.unixTimeMs)();a=Math.max(0,a),a=Math.min(a,~(1<<31)),__LOG__(2)`Scheduling task ${e} in ${a}ms`,this._timeoutIDs[e]=setTimeout((()=>{delete this._timeoutIDs[e],__LOG__(2)`Firing task ${e}`,t(n).then((t=>{if("no_reschedule"===t)return new Promise((()=>{}));let r;return t===i.DUMMY_UNIXTIME?(__LOG__(2)`Task ${e} complete, deactivating`,delete this._timers[e],r=i.DUMMY_UNIXTIME):t>=0?(__LOG__(2)`Task ${e} complete, waiting ${t}`,delete this._timers[e],r=(0,i.futureUnixTime)(t)):(__LOG__(2)`Task ${e} will try again later`,r=this._getNextRun(e)),this._scheduledTimeResolver.set(e,r)})).then((()=>{this._startTask(e),this._resolvers[e]&&(this._resolvers[e].forEach((e=>e())),delete this._resolvers[e])})).catch((t=>(__LOG__(2)`Task ${e} failed, try again later: ${t}`,this._scheduledTimeResolver.set(e,this._getNextRun(e)).then((()=>{this._startTask(e)})))))}),a)})):__LOG__(4,void 0,new Error)`Tried to start task ${e} before registering its implementation`}_getNextRun(e){return this._timers[e]||(this._timers[e]=(0,n.createTimer)({jitter:.1,max:1e3*i.HOUR_SECONDS,algo:{type:"fibonacci",first:1e3,second:2e3}})),(0,i.futureUnixTime)(Math.round(this._timers[e]()/1e3))}_registerResolver(e,t){this._resolvers[e]||(this._resolvers[e]=[]),this._resolvers[e].push(t)}awaitTaskPromise(e){return new Promise((t=>{this._registerResolver(e,t)}))}reschedule(e,t){this._started?(this._scheduledTimeResolver.set(e,t),null!=this._timeoutIDs[e]&&clearTimeout(this._timeoutIDs[e]),this._startTask(e)):this._scheduledTimeResolver.set(e,t)}registerTask(e,t){this._started||(this._started=!0),this._taskImplementations.set(e,t),this._startTask(e)}getScheduledTime(e){return this._scheduledTimeResolver.get(e)}}let o=null;function s(e,t){l("reschedule").reschedule(e,t)}function l(e){if(o)return o;throw new Error(`TaskScheduler::${e} called before startScheduler`)}},92844:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YEAR_SECONDS=t.WEEK_SECONDS=t.WEEK_MILLISECONDS=t.MonotonicTimer=t.MINUTE_MILLISECONDS=t.MAX_INT=t.HOUR_SECONDS=t.HOUR_MILLISECONDS=t.DUMMY_UNIXTIME=t.DAY_SECONDS=t.DAY_MILLISECONDS=void 0,t.cappedMillisecondsUntil=_,t.castLongIntToUnixTime=function(e){return"number"!=typeof e?(0,n.hexLongIsNegative)(e)?d:c:f(e)},t.castToUnixTime=f,t.delayUntil=function(e){const t=_(e);return new Promise((e=>{setTimeout(e,t)}))},t.futureUnixTime=function(e,t){const r=null!=t?t:h();return f(Math.ceil(r+Math.max(e,0)))},t.getClockSkew=function(){return p},t.happenedWithin=function(e,t){return E(h(),e,t)},t.happenedWithinAt=E,t.isInFuture=function(e){return g(e)>0},t.isOverflowTime=function(e){return e<d||e>c},t.isWithinNext24h=function(e){return e-h()<=a},t.midnight=function(){return f((new Date).setHours(0,0,0,0)/1e3-p)},t.midnightOn=function(e){return f(S(e).setHours(0,0,0,0)/1e3-p)},t.monotonicTime=m,t.monotonicTimeSince=y,t.oldest=function(e,t){return e<t?e:t},t.pastUnixTime=function(e,t){const r=null!=t?t:h();return f(Math.ceil(r-Math.max(e,0)))},t.performanceAbsoluteNow=function(){return Date.now()},t.sameDay=function(e,t){if(Math.abs(e-t)>a)return!1;const r=u.time===e?u.day:S(e+p).getDay(),n=u.time===t?u.day:S(t+p).getDay();return u.time=t,u.day=n,r===n},t.secondsUntil=g,t.setClockSkew=function(e){p=e},t.timeSince_USE_ONLY_IF_APPROVED=function(e){return Math.max(h()-e,0)},t.timeoutFor=function(e,t){const r=h(),n=Math.max(e+t-r,0);return Math.min(1e3*n,~(1<<31))},t.toDate=S,t.toHttpHeaderDate=function(e){return S(e).toUTCString()},t.unixTime=h,t.unixTimeMs=function(){return Date.now()-1e3*p},t.unskewedDate_USE_ONLY_IF_APPROVED=function(){return new Date};var n=r(87614);const i=3600;t.HOUR_SECONDS=i;const a=86400;t.DAY_SECONDS=a;t.WEEK_SECONDS=604800;t.YEAR_SECONDS=31536e3;t.MINUTE_MILLISECONDS=6e4;const o=36e5;t.HOUR_MILLISECONDS=o;const s=864e5;t.DAY_MILLISECONDS=s;t.WEEK_MILLISECONDS=6048e5;const l=1<<31;t.DUMMY_UNIXTIME=l;const c=2147483647;t.MAX_INT=c;const d=-2147483647,u={time:0,day:-4};let p=0;function f(e){return Math.max(d,Math.min(0|e,c))}function _(e){const t=Math.max(e-h(),0);return Math.min(1e3*t,~(1<<31))}function h(){return f(Date.now()/1e3-p)}function g(e){return Math.max(e-h(),0)}function m(){return performance.now()}function y(e){return Math.floor(performance.now()-e)}function E(e,t,r){return Math.abs(e-t)<=r}function S(e){return new Date(1e3*e)}t.MonotonicTimer=class{constructor(){const e=m();this._initTime=e,this._startTime=e}reset(){this._startTime=m()}elapsed(){return y(this._startTime)}cumulative(){return y(this._initTime)}}},32428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatArrayBuffers=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let a=0;return t.forEach((e=>{i.set(new Uint8Array(e),a),a+=e.byteLength})),i.buffer}},95024:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBuffersDeepEqual=function(e,t){if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(let e=0;e<r.byteLength;e++)if(r.getUint8(e)!==n.getUint8(e))return!1;return!0}},30138:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=[],n=e.length,i=t.length,a=Math.max(n,i);for(let o=0;o<a;o++)o<n&&r.push(e[o]),o<i&&r.push(t[o]);return r}},48206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayMoveMutate=t.arrayMove=void 0;const r=function(e,t,r){const n=r<0?e.length+r:r,i=e.splice(t,1)[0];e.splice(n,0,i)};t.arrayMoveMutate=r;t.arrayMove=function(e,t,n){const i=e.slice();return r(i,t,n),i}},20177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.b64Equal=function(e,t){const r=e.length,n=t.length;switch(r-n){case-2:return 61===t.charCodeAt(r)&&61===t.charCodeAt(r+1)&&t.substr(0,r)===e;case-1:return 61===t.charCodeAt(r)&&t.substr(0,r)===e;case 0:return e===t;case 1:return 61===e.charCodeAt(n)&&e.substr(0,n)===t;case 2:return 61===e.charCodeAt(n)&&61===e.charCodeAt(n+1)&&e.substr(0,n)===t;default:return!1}}},13353:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=atob(e);let n=0;for(let e=0;e<r.length;e++){const i=r.charCodeAt(e);n=((n<<4)+(i>>4))%t,n=((n<<4)+(15&i))%t}return n}},78403:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return null;const t=e.replace(/\s+$/,"");e!==t&&Math.random()<1e-5&&(__LOG__(3,void 0,void 0,!0)`base64 sanitized due to extra whitespace`,SEND_LOGS("media-key-sanitize"));return t}},27194:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}},93131:(e,t,r)=>{"use strict";let n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.dir=function(e){!function(){if(n)return;const e=r(12182).D,t=e.length/2;n=new Int32Array(t),i=new Int32Array(t);for(let r=0,a=0;r<t;r++,a+=2)n[r]=e[a]+(0===r?0:n[r-1]),i[r]=e[a+1]}();for(let t=0;t<e.length;t++){let r=0|e.charCodeAt(t);if(55296<=r&&r<56320){if(++t===e.length)break;const n=e.charCodeAt(t);if(!(56320<=n&&n<57344))continue;r=65536+((1023&r)<<10|1023&n)}else if(56320<=r&&r<57344)continue;if(r<n[0])continue;const a=0|n.length;let o=0,s=a-1|0;for(;o<s;){const e=s+o>>1;if(n[e]>r)s=e-1|0;else{if(n[e+1]>r){s=e;break}o=e+1|0}}const l=i[s],c=n[s]+Math.abs(l)|0;if(r<c)return l<0?"rtl":"ltr"}return}},12182:(e,t)=>{"use strict";t.D=void 0;t.D=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,49,55,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-3,4,-24,28,-1,10,-1,4,-1,6,-43,46,-119,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,8,2,7,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,4,1,13,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,17,1,8,2,3,11,12,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,11,12,3,4,41,43,4,9,3,4,3,4,2,6,14,18,26,28,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,2,5,6,24,25,1,2,10,11,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,89,96,5,7,34,35,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,60,67,43,45,11,22,1,14,1,8,4,5,6,7,3,5,1,6,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,43,44,94,95,48,96,45,48,48,64,28,31,50,65,12,16,167,171,99,101,31,32,6592,6656,20989,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,55,57,9,51,13,14,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,13,14,38,46,25,36,2,13,30,36,48,49,2,6,2,4,16,17,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,58,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,86,2,67,45,176,29,32,49,96,36,45,30,35,38,48,30,31,37,41,14,56,158,160,10,16,36,40,36,40,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-484,488,-8,18,-294,325,-44,46,-153,164,-175,175,1,2,54,69,7,31,10,28,49,53,2,4,7,18,1,3,25,32,10,19,36,41,1,10,18,26,35,36,3,14,52,61,10,14,2,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,163,56,64,2,5,1,2,21,22,1,2,3,33,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,2,1,8,10,64,27,32,2,6,1,10,16,208,47,56,1,3,1,101,83,95,8,10,1,3,8,9,2,3,30,31,2,6,1,2,4,5,3,12,10,80,8,10,42,50,4,5,4,31,1,7,2,4,40,46,2,6,8,17,1,7,2,5,46,59,1,3,9,38,57,320,9,10,38,52,8,18,29,32,32,57,1,8,1,3,1,76,7,8,2,3,38,59,1,10,10,16,6,7,2,3,37,41,2,3,1,2,1,8,10,320,19,21,4,187,1,16,21,63,923,1025,111,112,5,16,196,2944,1071,1072,9,4048,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,707,91,192,75,80,56,67,13,77,2,3,1,13,2,16,6136,6144,1238,1280,9,8960,287,336,3,20,4,12,396,2704,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,306,20,128,25,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,1659,45,55,7,9,10,14,2,370,44,48,10,1296,-208,215,-109,116,-1445,1447,-270,542,31,32,58,64,61,118,29,42,44,48,9,16,2,3504,42718,42752,4149,4160,222,224,5762,5776,7473,10576,542,2048,4939,786432,65534,65536,65534]},48447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){if(e<=0)throw new RangeError("BitArray:numBits should be positive");this._numBits=e,this._array=new Uint8Array(Math.ceil(this._numBits/8))}get(e){const[t,r]=this._getArrayIndexOffset(e);return Boolean(this._array[t]>>r&1)}set(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]|=1<<r}unset(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]&=~(1<<r)}toggle(e){const[t,r]=this._getArrayIndexOffset(e);this._array[t]^=1<<r}clear(){this._array=new Uint8Array(Math.ceil(this._numBits/8))}toArray(){const e=[];for(let t=0;t<this._numBits;t++)e.push(this.get(t));return e}toString(){return this.toArray().map((e=>e?"1":"0")).join("")}get length(){return this._numBits}_getArrayIndexOffset(e){if(e<0||e>=this._numBits)throw new RangeError("BitArray:index out of bounds");const t=Math.floor(e/8);return[t,e-8*t]}}},42430:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LruCache=void 0;var n=r(57319);class i{constructor(e,t){this.key=e,this.value=t,this.prev=null,this.next=null}}t.LruCache=class{constructor(e){var t;this._keyToNode=new Map,this.purgeNow=()=>{for(let e=this._dummyTail.prev;this._currentSize>this._sizeLimit&&e!==this._dummyHead;e=e?e.prev:null){if(null==e)throw new Error("The linked list is not constructed properly.");const{key:t,value:r}=e;this._shouldEvict(t,r)&&(this.delete(t),this._onEvict&&this._onEvict(t,r))}this._onPurge&&this._onPurge(this._keyToNode)},this._sizeLimit=e.sizeLimit,this._getSize=e.getSize,this._onPurge=e.onPurge,this._shouldEvict=null!==(t=e.shouldEvict)&&void 0!==t?t:()=>!0,this._onEvict=e.onEvict,this._onAdd=e.onAdd,this._onDelete=e.onDelete,this._currentSize=0,this._dummyHead=new i("dummy-head",null),this._dummyTail=new i("dummy-tail",null),this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._purgeTimer=new n.ShiftTimer((()=>this.purgeNow()))}get(e){if(!this._keyToNode.has(e))return null;const t=this._keyToNode.get(e);if(null==t)return null;const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r);const i=this._dummyHead.next;if(null==i)throw new Error("The linked list is not constructed properly.");return this._dummyHead.next=t,i.prev=t,t.prev=this._dummyHead,t.next=i,t.value}has(e){return this._keyToNode.has(e)}touch(e){this.get(e)}put(e,t){0!==this._sizeLimit&&(this._getSize(t)>this._sizeLimit?__LOG__(3)`Blob size is larger than the limit of the whole store.`:(this.delete(e),this._add(e,t),this.schedulePurge()))}_add(e,t){const r=new i(e,t);this._keyToNode.set(e,r);const n=this._dummyHead.next;if(null==n)throw new Error("The linked list is not constructed properly.");this._dummyHead.next=r,n.prev=r,r.prev=this._dummyHead,r.next=n,this._currentSize+=this._getSize(t),this._onAdd&&this._onAdd(e,t)}delete(e){if(!this._keyToNode.has(e))return;const t=this._keyToNode.get(e);if(null==t)return;this._currentSize-=this._getSize(t.value);const r=t.prev,n=t.next;r&&(r.next=n),n&&(n.prev=r),this._keyToNode.delete(e),this._onDelete&&this._onDelete(e,t.value)}clear(){this._keyToNode.clear(),this._currentSize=0,this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._onClear&&this._onClear()}schedulePurge(){this._purgeTimer.onOrBefore(1e3)}}},9006:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t){this._valueFn=e,this._heap=[],this._load(t)}size(){return this._heap.length}_load(e){(null==e?void 0:e.length)&&e.forEach((e=>{this.push(e)}))}_swap(e,t){const r=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=r}_siftUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return;const t=this._getParent(e),r=2*t+1,n=2*t+2,i=this._heap.length;if(e>=i)return;let a=this._getVal(t),o=t;if(r<i){const e=this._getVal(r);a>e&&(o=r,a=e)}if(n<i){a>this._getVal(n)&&(o=n)}o!==t&&(this._swap(o,t),this._siftUp(t))}_doHeapify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=2*e+1,r=2*e+2,n=this._heap.length;if(e>=n)return;let i=this._getVal(e),a=e;if(t<n){const e=this._getVal(t);i>e&&(a=t,i=e)}if(r<n){i>this._getVal(r)&&(a=r)}a!==e&&this._swap(a,e),t<n&&this._doHeapify(t),r<n&&this._doHeapify(r)}_getVal(e){return this._valueFn(this._heap[e])}_getParent(e){return e%2==0?(e-2)/2:(e-1)/2}push(e){this._heap.push(e);const t=this._heap.length-1;this._siftUp(t)}pull(){const e=this._heap.shift();return this.heapify(),e}heapify(){this._doHeapify(0)}peek(){return this._heap[0]}}},55205:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(45095));class a{constructor(e){this._children={},this._indices=[],e&&(this._data=e)}static fromBackwardsStrings(e,t){return e.reduce(((e,t,r)=>e.addBackwardsString(t,r)),new a(t))._optimize()}addBackwardsString(e,t){let r=e.length-1,n=this;for(;r>=0;){const i=e.charAt(r);n._addIndex(t),n=n.get(i)||n.set(i,new a),r--}return n._addIndex(t),this}static fromForwardsStrings(e,t){return e.reduce(((e,t,r)=>e.addForwardsString(t,r)),new a(t))._optimize()}addForwardsString(e,t){let r=0,n=this;for(;r<e.length;){const i=e.charAt(r);n._addIndex(t),n=n.get(i)||n.set(i,new a),r++}return n._addIndex(t),this}set(e,t){return this._children[e]=t,t}get(e){return this._children[e]}getChildren(){return Object.keys(this._children).map((e=>({prefix:e,node:(0,i.default)(this.get(e),"this.get(prefix)")})))}hasChildren(){return!function(e){for(const t in e)return!1;return!0}(this._children)}search(e){const t=this._data;if(!t)return[];let r=this;for(let t=0;t<e.length&&r;t++){const n=e[t];r=r.get(n)}if(!r)return[];return r.getIndices().map((e=>t[e]))}_addIndex(e){this._indices.push(e)}getIndices(){const e=this._indices,t=Object.keys(this._children);return 1===t.length&&0===this._indices.length?this._children[t[0]].getIndices():e}_optimize(){if(!this.hasChildren())return this;const e=Object.keys(this._children),t=this._children[e[0]]._indices;return e.forEach((e=>{this._children[e]._optimize()})),1===e.length&&this._indices.length===t.length&&(this._indices=[]),this}testOnlyGetChildrenProperty(){return this._children}testOnlyGetIndicesProperty(){return this._indices}}t.default=a},63438:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;return e.every(((e,r)=>e===t[r]))}},62971:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.exponentialBackoffIterator=function*(e){const{factor:t,jitter:r,maxTimeout:n,minTimeout:s,retries:l}=(0,i.default)((0,i.default)({},o),e);let c=0;for(const e of(0,a.default)(t)){if(c++,c>l)return;const t=Math.random()*r*2-r+1;yield Math.min(s*e*t,n)}};var i=n(r(73982)),a=n(r(3691));const o={factor:2,jitter:0,maxTimeout:1/0};t.defaults=o},3691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function*(e){let t=1;for(;;)yield t,t*=e}},85396:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIterator=function*(e,t){let r=0;for(const n of e)t(n,r)&&(yield n),r++},t.first=function(e){for(const t of e)return t;return},t.iteratorFromArray=function*(e){for(const t of e)yield t},t.mapIterator=function*(e,t){let r=0;for(const n of e)yield t(n,r),r++},t.rangeIterator=function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(0===r)throw new TypeError("Step can't be zero.");if(r>0){if(e>t)return;for(let n=e;n<t;n+=r)yield n}else{if(e<t)return;for(let n=e;n>t;n+=r)yield n}},t.takeIterator=function*(e,t){if(t<0)throw new TypeError("Count must be a positive integer");let r=0;for(const n of e){if(r>=t)return;yield n,r++}}},29984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNonZeroNumber=function(e){return null!=e&&0!==e&&!isNaN(e)}},65345:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,r,n){r(t).forEach((t=>e(t,r,n))),n(t)}},65023:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.astralRange=void 0,t.length=function(e){const t=e.match(r);return t?t.length:0},t.substring=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const i=e.match(r);if(!i)return"";return i.slice(Math.max(0,t),Math.max(0,n)).join("")},t.toArray=function(e){return e.match(r)||[]};const r=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]?|[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g;t.astralRange=r},64331:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.codePointAt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.codePointAt)return e.codePointAt(t);let r=e.charCodeAt(t);if(r>=55296&&r<=56319){const n=e.charCodeAt(t+1);n>=56320&&n<=57343&&(r=65536+(r-55296<<10)+(n-56320))}return r},t.firstNCodepoints=function(e,t){return i(e||"",0,t)},t.firstNEncodedBytes=function(e,t){if(null==t)return e;if(encodeURI(e).length<=t)return e;let r=0;const n=a(e),o=n.length;for(let a=0;a<o;a++){const o=n[a],s=encodeURI(o).length;if(r+s>t)return i(e,0,a);r+=s}return e},t.numCodepoints=function(e){return(0,n.length)(e||"")},t.substring=i,t.toArray=a;var n=r(65023);function i(e,t,r){if(null==e||""===e)return"";const i=t||0,a=null==r?1/0:r;return e.length,0===i&&a===1/0?e:e.length>=5e3&&a/e.length<=.5?function(e,t,r){const i=new RegExp(n.astralRange);let a,o="",s=0;do{a=i.exec(e),a&&(o+=a[0]),s++}while(a&&s<r);return o}(e,0,a):(0,n.substring)(e,i,a)}function a(e,t,r){const i=e||"",a=t||0,o=null==r?1/0:r;return i.length>=5e3&&o/i.length<=.5?function(e,t,r){const i=new RegExp(n.astralRange),a=[];let o;do{o=i.exec(e),o&&a.push(o[0])}while(o&&a.length<r);return a}(i,0,o):(0,n.toArray)(i).slice(a,o)}},82572:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,r,s){const l=e.split(".");let p,f=!1;if(l.forEach((e=>{if(f=!e.match(u),f){if(p)return null;p=e}})),null==p||f)return null;const _=[];let h=!0;const g=(0,i.toArray)(p);for(let e=0;e<g.length;e++){const t=g[e];if(h=h&&d(t),!h&&a[t]){if(_.length>=2)return null;_.push(t)}}if(h)return c(r)||c(t)||s.some((e=>function(e){return o.has(e)}(e)))?null:new Set(g);if(!_.length)return null;const m=_.filter((e=>{const i=a[e];if(null==i)return!1;if(s.some((e=>i.includes(e))))return!1;const o=new Set;for(let e=0;e<i.length;e++){const t=n.LANGUAGE_TO_REGIONS[i[e]];if(null!=t)for(let e=0;e<t.length;e++)o.add(t[e])}return!o.has(r)&&!o.has(t)}));return m.length?new Set(m):null};var n=r(36349),i=r(65023);const a={:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],:["mt"],:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],:["az","crh","tr"],:["lv"],:["dsb","nv","pl","hsb"],:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],:["naq"],:["naq"],:["liv"],:["fmp","dud","tmh"],:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],:["tzm","kab","okr","shi","tmh","taq"],:["tzm","kab","shi"],:["tzm","kab","shi","tmh","taq"],:[],:["izi","yaz","blt","vi"],:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},o=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),s=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),l="";function c(e){return s.has(e)}function d(e){return l.includes(e)}const u=new RegExp("^[a-z0-9-]+$")},36349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANGUAGE_TO_REGIONS=void 0;t.LANGUAGE_TO_REGIONS={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]}},53659:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,r,o){const s=e.match(a),l=s&&s[1];if(null==l)return null;const c=(0,i.phoneCC)(r),d="whatsapp"===t?"":(0,i.phoneCC)(t),u=o.map((e=>e.toLowerCase()));return(0,n.findSuspiciousCharacters)(l,d,c,u)};var n=r(82572),i=r(40277);const a=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i},46269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castTypedArrays=function(e,t){if(t instanceof e)return t;if("string"==typeof t)return new e((0,n.decodeB64)(t));return new e(t)};var n=r(15688)},60977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatTypedArrays=function(e,t){const r=t.reduce(((e,t)=>e+t.length),0),n=new e(r);let i=0;return t.forEach((e=>{n.set(e,i),i+=e.length})),n}},91560:(e,t,r)=>{"use strict";var n=r(7914);Object.defineProperty(t,"__esModule",{value:!0}),t.ParsableXmlNode=void 0,t.convertBytesToUint=o;var i=n(r(33344)),a=r(56225);function o(e,t){let r=0;for(let n=0;n<t;n++)r=256*r+e[n];return r}t.ParsableXmlNode=class{constructor(e,t){this._name=e,this._node=t,this._children=Array.isArray(t.content)?t.content.map((t=>new this.constructor(e,t))):null}name(){return this._name}node(){return this._node}hasAttr(e){return(0,i.default)(this._node.attrs,e)}assertTag(e){this._node.tag!==e&&this.throw(`to be <${e}>`)}tag(){return this._node.tag}maybeChild(e){const t=this._children;if(!t)return null;for(let r=0;r<t.length;r++)if(t[r].tag()===e)return t[r];return null}hasChild(e){return!!this.maybeChild(e)}child(e){const t=this.maybeChild(e);return t||this.throw(`to have child <${e}>`)}assertAttr(e,t){const r=this.attrString(e);r!==t&&this.throw(`to have "${e}"="${t}", but instead has "${r}"`)}attrString(e){return(0,i.default)(this._node.attrs,e)?this.decodeAsString(this._node.attrs[e]):this.throw(`to have attribute "${e}"`)}forEachAttributeKey(e){const t=this._node.attrs;Object.keys(t).forEach((t=>e(t)))}maybeAttrString(e){return this.hasAttr(e)?this.decodeAsString(this._node.attrs[e]):null}maybeAttrInt(e,t,r){return this.hasAttr(e)?this.attrInt(e,t,r):null}attrEnumValues(e,t,r){const n=new Set(t),i=this.attrString(e);if(!n.has(i)){if(null!=r)return r;const t=Array.from(n).join("|");return this.throw(`to have "${e}"={${t}} but has value "${i}"`)}return i}attrEnum(e,t){const r=this.attrString(e);if(!(0,i.default)(t,r)){const n=Object.keys(t).join("|");return this.throw(`to have "${e}"={${n}} but has value "${r}"`)}return t[r]}attrEnumOrNullIfUnknown(e,t){const r=this.attrString(e);return(0,i.default)(t,r)?t[r]:null}attrEnumOrDefault(e,t,r){return this.hasAttr(e)?this.attrEnum(e,t):r}attrInt(e,t,r){const n=this.attrString(e);return this._parseInt(n,e,t,r)}_parseInt(e,t,r,n){const i=parseInt(e,10);return Number.isNaN(i)?this.throw(`to have "${t}"={integer} but has value "${e}"`):void 0!==r&&i<r?this.throw(`to have "${t}"={at least ${r}} but has value ${i}`):void 0!==n&&i>=n?this.throw(`to have "${t}"={below ${n}} but has value ${i}`):i}forEachChild(e){const t=this._children;if(t)t.forEach((t=>e(t)));else if(null!=this._node.content)return this.throw("to have children")}forEachChildWithTag(e,t){this.forEachChild((r=>{r.tag()===e&&t(r)}))}mapChildren(e){const t=this._children;return t||null==this._node.content?t?t.map((t=>e(t))):[]:this.throw("to have children")}mapChildrenWithTag(e,t){const r=this._children;return r||null==this._node.content?r?r.filter((t=>t.tag()===e)).map((e=>t(e))):[]:this.throw("to have children")}mapFirstChild(e){const t=this._children;return t&&0!==t.length?e(t[0]):this.throw("to have children")}hasContent(){return!this._children&&!!this._node.content}hasChildren(){return null!=this._children}getChildren(){return this._children}getNode(){return this._node}unsafeSetChildren(e){this._children=e}unsafeSetNodeContent(e){this._node.content=e}contentUint(e){return o(this.contentBytes(e),e)}contentBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this._children)return this.throw("to have binary content, but has children instead");if(null!=this._node.content){const t=this._node.content;return-1!==e&&t.length!==e?this.throw(`to be ${e} bytes, but got ${t.length} instead`):t}return this.throw("to have content")}contentString(){return this._children?this.throw("to have string content, but has children instead"):null!=this._node.content?this._node.content:this.throw("to have content")}contentInt(e,t){const r=this.contentString();return this._parseInt(r,"content",e,t)}contentEnum(e){const t=this.contentString();if(!(0,i.default)(e,t)){const r=Object.keys(e).join("|");return this.throw(`to have content {${r}} but has value "${t}"`)}return e[t]}decodeAsString(e){if("string"!=typeof e)throw new Error(`decodeAsString: attribute is ${typeof e} not a string: ${e}`);return e}throw(e){throw new a.XmlParsingFailure(this._name,`expected <${this._node.tag}> ${e}`)}toString(){return this._node.toString()}}},17890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),r=t.length;let n=!1,i=0,a="",o=0;const s=["\n"];for(o=0;o<100;o++)s.push(s[o]+"    ");const l=function(e,t){const r=/^<[\w:\-.,]+/.exec(e[t-1]),n=/^<\/[\w:\-.,]+/.exec(e[t]);return null!=r&&null!=n&&r[0]===n[0]};for(o=0;o<r;o++)t[o].search(/<!/)>-1?(a+=s[i]+t[o],n=!0,(t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1||t[o].search(/!DOCTYPE/)>-1)&&(n=!1)):t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1?(a+=t[o],n=!1):l(t,o)?(a+=t[o],n||i--):t[o].search(/<\w/)>-1&&-1===t[o].search(/<\//)&&-1===t[o].search(/\/>/)?a=a+=n?t[o]:s[i++]+t[o]:t[o].search(/<\w/)>-1&&t[o].search(/<\//)>-1?a=a+=n?t[o]:s[i]+t[o]:t[o].search(/<\//)>-1?a=a+=n?t[o]:s[--i]+t[o]:t[o].search(/\/>/)>-1?a=a+=n?t[o]:s[i]+t[o]:t[o].search(/<\?/)>-1||t[o].search(/xmlns:/)>-1||t[o].search(/xmlns=/)>-1?a+=s[i]+t[o]:a+=t[o];return"\n"===a[0]?a.slice(1):a}},74277:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlNode=void 0,t.attrsToString=a,t.uint8ArrayToDebugString=o;var n=r(87614);const i={};function a(e){const t=Object.keys(e);let r="";for(let n=0;n<t.length;n++){const i=t[n];r+=` ${i}="${e[i].toString()}"`}return r}function o(e){let t="";return t=0===e.length?"\x3c!-- empty binary --\x3e":e.length<50?(0,n.bytesToDebugString)(e):`\x3c!-- ${e.length} bytes --\x3e`,t}t.XmlNode=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=r}toString(){let e="<"+this.tag;e+=a(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:t instanceof Uint8Array?e+=`>${o(t)}</${this.tag}>`:e+=null!=t?`>${String(t)}</${this.tag}>`:" />",e}}},56225:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlParsingFailure=void 0;t.XmlParsingFailure=class{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmlParsingFailure: ${this.parser}: ${this.reason}`}}},28970:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=void 0;var n=r(69719),i=r(57319),a=r(21282);t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=113760892;const o={putBuffer:()=>Promise.resolve()};t.Wam=class{constructor(e){this._pending=[],this._globals=new Map,this._initialized=!1,this._buffers=new Map,this._streamId=-1,this._sink=o,this._getNextSequenceNumber=null,this.deinitialize=()=>{this._initialized=!1,this._pending=[],this._globals.clear(),this._buffers=new Map,this._streamId=-1,this._sink=o,this.serializePending.cancel(),this.finalizeBuffers.cancel()},this.enqueueEvent=(e,t,r,n,i,a)=>{this._pending.push({type:1,id:e,commitTime:t,psIdIntValue:r,weight:i,fields:n,resolve:a}),this._initialized&&this.serializePending.onOrBefore(3e3)},this.enqueueAttributesUpdate=e=>{const t={type:2,delta:[]};e.forEach(((e,r)=>{void 0!==e&&t.delta.push([r,e])})),t.delta.length>0&&(__LOG__(2)`WAM: Enqueued ${t.delta.length} attribute keys for update`,this._pending.push(t))},this.finalizeBuffers=new i.ShiftTimer((()=>{this._finalizeBuffers()})),this.serializePending=new i.ShiftTimer((()=>{this._serializePending()})),this.forceSerializePending=()=>{this._initialized&&this._hasPendingEvents()&&this.serializePending.forceRunNow()},this._channel=e}initialize(e,t,r,n){if(this._initialized)return __LOG__(4,void 0,new Error,!0)`WAM: Failed to initialize already initialized WAM`,void SEND_LOGS("wam-initialize");this._options=n,this._streamId=e,this._sink=r,this._getNextSequenceNumber=t,this._hasPendingEvents()&&this.serializePending.forceRunNow(),this._initialized=!0,__LOG__(2)`WAM: Initialized with stream id ${this._streamId}`}_finalizeBuffers(){this._buffers.forEach((e=>{e.finalize()})),this._buffers.size>0&&this.serializePending.onOrBefore(3e3)}_getKeyHashIntForSequence(e){var t;return(null===(t=this._options)||void 0===t?void 0:t.multipleSequences)?0===e?"null-psid":e:"regular"}_maybeCreateNewBuffer(e){let t=this._buffers.get(e);if(t)return t;const r=this._getKeyHashIntForSequence(e);if(null==this._getNextSequenceNumber)return __LOG__(4,void 0,new Error,!0)`WAM: Sequence number generator not initialised for channel ${this._channel}`,void SEND_LOGS("wam-serializePending");const n=this._getNextSequenceNumber(r);if(t=new a.WamBuffer(this._channel,this._streamId,n,this._globals),this._buffers.set(e,t),"regular"!==e)if(null==this._privateStatsIds)__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats ids`,SEND_LOGS("wam-serializePending");else{const r=0===e?"none":this._privateStatsIds.get(e);null==r?(__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats id`,SEND_LOGS("wam-serializePending")):t.writeGlobal(6005,r)}return t}_serializePending(){const e=[];this.finalizeBuffers.onOrBefore(3e5);const t=new Map;let r=-1;this._pending.forEach(((n,i)=>{if(1===n.type){let o=!0;t.forEach((e=>{(0,a.canWriteGlobal)(e)||(o=!1)}));const s=(0,a.canWriteEvent)(n.fields);if(s&&o){let e;"regular"===this._channel?e=this._maybeCreateNewBuffer("regular"):(this._channel,null==n.psIdIntValue?(__LOG__(4,void 0,new Error,!0)`A WAM event in channel private was dropped before serialization. Reason: missing psIdIntValue in the event payload`,SEND_LOGS("wam-serializePending")):e=this._maybeCreateNewBuffer(n.psIdIntValue)),null!=e&&(t.forEach(((e,t)=>{const r=this._globals.get(t);void 0!==r&&r===e||(this._buffers.forEach((r=>r.writeGlobal(t,e))),this._globals.set(t,e))})),t.clear(),e.writeEvent(n.commitTime,n.id,n.fields,n.weight))}else __LOG__(3)`A WAM event in channel ${this._channel} was dropped before serialization. Event correct: ${s}, pending attributes correct: ${o}`;null!=n.resolve&&e.push(n.resolve),r=i}else{n.type;for(let e=0;e<n.delta.length;++e){const[r,i]=n.delta[e];t.set(r,i)}}}));let i=!1;this._buffers.forEach((e=>{(e.isFinalized()||e.getSize()>65536)&&(i=!0)}));const o=[];this._buffers.forEach(((e,t)=>{e.hasEvents()?o.push([e.getKey(),e.peek(),this._getKeyHashIntForSequence(t)]):__LOG__(3)`Skipping putting buffer to sink, as it does not contain any events`}));const s=(0,n.promiseEach)(o,(e=>{let[t,r,n]=e;return this._sink.putBuffer(t,r,i,n)})).then((()=>{e.forEach((e=>{e()}))}));return this._pending=this._pending.slice(r+1),i&&(this._buffers=new Map,this.finalizeBuffers.cancel()),s}_hasPendingEvents(){return this._pending.length>0&&this._pending.some((e=>1===e.type))}isInitialized(){return this._initialized}updatePrivateStatsIds(e){if("private"!==this._channel)return __LOG__(4,void 0,new Error,!0)`WAM: Tried to set private stats ids on a non-private channel`,void SEND_LOGS("wam-updatePrivateStatsIds");this._privateStatsIds=e}}},21282:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamBuffer=void 0,t.canWriteEvent=function(e){const t=c(e);for(let r=0;r<=t;r+=3){const t=e[r+2];if(null!=t){if(e[r+1]===i.TYPES.INT&&isNaN(t))return!1}}return!0},t.canWriteGlobal=function(e){if("number"==typeof e)return!isNaN(e);return!0};var n=r(8584),i=r(68518);function a(e,t,r,n){0===n?l(e,t,16|r):1===n?l(e,t,32|r):-128<=n&&n<128?(l(e,t,48|r),e.writeInt8(n)):-32768<=n&&n<32768?(l(e,t,64|r),e.writeInt16(n)):-2147483648<=n&&n<2147483648?(l(e,t,80|r),e.writeInt32(n)):(l(e,t,96|r),e.writeInt64(n))}function o(e,t,r,n){l(e,t,112|r),e.writeFloat64(n)}function s(e,t,r,i){const a=(0,n.numUtf8Bytes)(i);a<256?(l(e,t,128|r),e.writeUint8(a)):a<65536?(l(e,t,144|r),e.writeUint16(a)):(l(e,t,160|r),e.writeUint32(a)),e.writeString(i)}function l(e,t,r){t<256?(e.writeUint8(r),e.writeUint8(t)):(e.writeUint8(8|r),e.writeUint16(t))}function c(e){let t=-1;for(let r=0;r<e.length;r+=3)null!=e[r+2]&&(t=r);return t}t.WamBuffer=class{constructor(e,t,r,i){this._finalized=!1,this._hasEvents=!1;const a=new n.Binary(void 0,!0);switch(a.writeString("WAM"),a.writeUint8(5),a.writeUint8(t),a.writeUint16(r),e){case"regular":a.writeUint8(0);break;default:a.writeUint8(2)}this._channel=e,this._buffer=a,this._sequenceNumber=r,this._streamId=t,i.forEach(((e,t)=>{this.writeGlobal(t,e)}))}writeGlobal(e,t){if(null!=t)if("string"==typeof t)s(this._buffer,e,0,t);else if("number"==typeof t)a(this._buffer,e,0,t);else{if("boolean"!=typeof t)throw new Error("Incorrect value type "+typeof t);a(this._buffer,e,0,t?1:0)}else l(this._buffer,e,0)}writeEvent(e,t,r,n){const l=this._buffer;a(l,47,0,Math.floor(e/1e3));const d=c(r);a(l,t,-1===d?5:1,n);for(let e=0;e<=d;e+=3){const t=r[e+2];if(null!=t){const n=r[e],c=r[e+1],u=e===d?6:2;c===i.TYPES.INT?a(l,n,u,t):c===i.TYPES.BOOL?a(l,n,u,t?1:0):c===i.TYPES.STRING?s(l,n,u,t):o(l,n,u,t)}}this._hasEvents=!0}getKey(){return{streamId:this._streamId,sequenceNumber:this._sequenceNumber,channel:this._channel}}getSize(){return this._buffer.size()}peek(){return this._buffer.peek((e=>e.readByteArray()))}isFinalized(){return this._finalized}finalize(){this._finalized=!0}hasEvents(){return this._hasEvents}}},42114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeChannelManager=function(){null!=n&&n.close()},t.getChannelManager=function(){null==n&&(n=new r);return n};class r{constructor(){this._sinkIsBusy=new Map,this._initializedChannel=new Map}getChannelInitialized(e){return this._initializedChannel.get(e)||!1}setChannelInitialized(e){this._initializedChannel.set(e,!0)}isSinkBusy(e){return this._sinkIsBusy.get(e)||!1}setSinkBusy(e,t){this._sinkIsBusy.set(e,t)}close(){this._sinkIsBusy.forEach(((e,t)=>{this._sinkIsBusy.set(t,!1)})),this._initializedChannel.forEach(((e,t)=>{this._initializedChannel.set(t,!1)}))}}let n},7879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinitializeWAM=function(){s().deinitialize()},t.enableDebugMode=function(){a=!0},t.forceFlushBuffers=function(){s().forceFlushBuffers()},t.initializeWAM=function(e,t,r,n,i){s().initialize(r,e,t,n,i)},t.log=function(e,t,r,n,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();s().enqueueEvent(e,t,l,r,(0,i.appendRawFields)(n,a),o)},t.logAsync=function(e,t,r,n,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();return new Promise((c=>{s().enqueueEvent(e,t,l,r,(0,i.appendRawFields)(n,a),o,c)}))},t.logAttributes=function(e,t){const r=(0,i.getDeltaFromAttributes)(e);if(null==r)return;const{deltaRegular:n,deltaPrivate:a}=r;n.size>0&&s().enqueueAttributesUpdate("regular",n);a.size>0&&s().enqueueAttributesUpdate("private",a)},t.rotateBuffers=function(){s().rotateBuffers()},t.updatePrivateStatsIds=function(e){s().updatePrivateStatsIds(e)};var n=r(26305),i=r(56521);let a=!1,o=null;function s(){return o||(o=new n.WamManager),o}},26305:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamManager=void 0;var n=r(28970);class i{constructor(e){this._sequenceNumbers=new Map,this._options=e}_setSequenceNumber(e,t){null==t||0===t||t<0?this._sequenceNumbers.set(e,"uninitialized"):this._sequenceNumbers.set(e,t)}initializeForChannel(e,t){t.forEach(((t,r)=>{var n;if("regular"===e&&"regular"===r)this._setSequenceNumber(r,t);else if("private"===e&&"regular"!==r)this._setSequenceNumber(r,t);else if("private"!==e||(null===(n=this._options)||void 0===n?void 0:n.multipleSequences)){var i;__LOG__(4,void 0,new Error)`SequenceNumberGenerator::initializeForChannel: Incorrect combination of parameters: ${e} ${r} ${null===(i=this._options)||void 0===i?void 0:i.multipleSequences}`}else this._setSequenceNumber(r,t)}))}next(e){const t=this._sequenceNumbers.get(e);let r;return null==t||"uninitialized"===t?r=1:(r=t+1,r>65535&&(r=1)),this._sequenceNumbers.set(e,r),r}}t.WamManager=class{constructor(){this._wamInstances=new Map,this._sequenceNumberGenerator=null}getWamInstance(e){let t=this._wamInstances.get(e);return t||(t=new n.Wam(e),this._wamInstances.set(e,t)),t}initialize(e,t,r,n,a){const o=this.getWamInstance(e);if(o.isInitialized())return void __LOG__(3)`WAM instance for channel ${e} has already been initialized`;null==this._sequenceNumberGenerator&&(this._sequenceNumberGenerator=new i(a));const s=this._sequenceNumberGenerator;this._sequenceNumberGenerator.initializeForChannel(e,r),o.initialize(t,(e=>s.next(e)),n,a)}deinitialize(){this._wamInstances.forEach(((e,t)=>{e.isInitialized()&&(__LOG__(2)`WamManager: Deinitializing WAM Channel ${t}`,e.deinitialize())})),this._sequenceNumberGenerator=null}enqueueEvent(e,t,r,n,i,a,o){this.getWamInstance(e).enqueueEvent(t,r,n,i,a,o)}enqueueAttributesUpdate(e,t){this.getWamInstance(e).enqueueAttributesUpdate(t)}updatePrivateStatsIds(e){this.getWamInstance("private").updatePrivateStatsIds(e)}forceFlushBuffers(){this._wamInstances.forEach((e=>{e.forceSerializePending()}))}rotateBuffers(){this._wamInstances.forEach((e=>{e.finalizeBuffers.forceRunNow()}))}}},47957:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blindToken=function(e,t){return(0,n.runInAllocationScope)((()=>{const r=(0,n.p3Element)(),o=(0,n.allocate)(Uint8Array,32);o.set(t),a(o),i.lowlevel.scalarbase(r,o);const s=(0,n.hashToPoint)(e);(0,i.lowlevel.add)(s,r);const l=new Uint8Array(32);return(0,n.pack)(l,s),l}))},t.unblindToken=function(e,t,r){return(0,n.runInAllocationScope)((()=>{const o=(0,n.p3Element)();if((0,n.unpack)(o,e))return null;const s=(0,n.p3Element)();if(0!==(0,n.unpackneg)(s,r))return null;const l=(0,n.allocate)(Uint8Array,32);l.set(t),a(l);const c=(0,n.p3Element)();i.lowlevel.scalarmult(c,s,l);(0,i.lowlevel.add)(o,c);const d=new Uint8Array(32);return(0,n.pack)(d,o),d}))};var n=r(30141),i=r(14462);function a(e){e[0]&=248,e[31]&=127,e[31]|=64}},11562:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStorage=function(){(0,a.deinitializeWAM)(),(0,i.closeChannelManager)(),l=null,s=null},t.getFinishedStreamBuffers=function(e){return c("getFinishedStreamBuffers").getBuffers().then((t=>(0,o.getFinishedBuffers)(e,t)))},t.initializeWAMSink=function(e,t,r,n){const l=c("initializeWAMSink"),d=(0,i.getChannelManager)();if(d.getChannelInitialized(t))return Promise.resolve();d.setChannelInitialized(t);const u=l.getStreamId(e),p={putBuffer(e,n,i,a){if(d.isSinkBusy(t))return __LOG__(3)`WamStorage: Sink flush did not happen within timeout, buffer is not saved`,Promise.resolve();d.setSinkBusy(t,!0);const{bufferKey:s,meta:c,bufferRow:p}=(0,o.asBufferEntry)(e,t,u,n,i);return l.saveBuffer(c,p,a).then((()=>{const t=[e.streamId,e.sequenceNumber];__LOG__(2)`WamStorage: Successfully put buffer ${t} to sink`,i&&(r(),__LOG__(2)`WamStorage: Buffer ${s} is scheduled for send`)})).finally((()=>{d.setSinkBusy(t,!1)}))}};null==s&&(s=l.finishBuffer(u));return s.then((()=>{if(l.getStartingSequenceNumbers)return l.getStartingSequenceRow,l.getStartingSequenceNumbers(t,u);if(l.getStartingSequenceRow,null==n?void 0:n.multipleSequences)throw new Error("getStartingSequenceRow must not used when enabling support for multiple sequences");return l.getStartingSequenceRow(u).then((e=>{const t=(0,o.getSequenceNumber)(e),r=new Map;return r.set("regular",t),r}))})).then((e=>{(0,a.initializeWAM)(u,e,t,p,n),"private"===t&&l.updatePrivateStatsIds&&l.updatePrivateStatsIds().then(a.updatePrivateStatsIds)}))},t.nukeMetrics=function(){return c("nukeMetrics").nukeMetrics()},t.privateStatsKillSwitchGetBlockedToken=function(){const e=c("privateStatsKillSwitchGetBlockedToken");if(!e.privateStatsKillSwitchGetBlockedToken)throw new Error("privateStatsKillSwitchGetBlockedToken not implemented for WAM DB");return e.privateStatsKillSwitchGetBlockedToken()},t.privateStatsKillSwitchSet=function(e){const t=c("privateStatsKillSwitchSet");if(!t.privateStatsKillSwitchSet)throw new Error("privateStatsKillSwitchSet not implemented for WAM DB");return t.privateStatsKillSwitchSet(e)},t.redeemPrivateStatsToken=function(){const e=c("getPrivateStatsToken");if(!e.redeemPrivateStatsToken)throw new Error("redeemPrivateStatsToken not implemented for WAM DB");return e.redeemPrivateStatsToken(u)},t.removeBufferByKey=function(e){return c("removeBufferByKey").removeBufferByKey(e)},t.savePrivateStatsToken=function(e){const t=c("savePrivateStatsToken");if(!t.savePrivateStatsToken)throw new Error("savePrivateStatsToken not implemented for WAM DB");return t.savePrivateStatsToken(e)},t.startWamStorage=function(e){null==l?l=e:(__LOG__(3,void 0,void 0,!0)`startWamStorage: called again`,SEND_LOGS("startWamStorage"))};var n=r(92844),i=r(42114),a=r(7879),o=r(56521);let s=null,l=null;function c(e){if(l)return l;throw new Error(`WamStorage::${e} called before startWamStorage`)}const d=n.DAY_SECONDS,u=(e,t)=>{const r={maxRedeemCount:(null==t?void 0:t.maxRedeemCount)||64,maxExpirySeconds:(null==t?void 0:t.maxExpirySeconds)||d};return(0,n.happenedWithin)(e.creationTs,r.maxExpirySeconds)?!(e.redeemCount>=r.maxRedeemCount)||(__LOG__(2)`The private stats token was redeemed maximum number of time. The client shall re-issue a new one`,!1):(__LOG__(2)`The private stats token expired. The client shall re-issue a new one`,!1)}},68518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPES=void 0;t.TYPES={INT:0,BOOL:1,STRING:2,FLOAT:3}},56521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendRawFields=function(e,t){if(null==t||0===t.length)return e;const r=new Map;for(let t=0;t<e.length;t+=3){const n=e[t];r.set(n,t)}for(let n=0;n<t.length;++n){const[i,o,s]=t[n];if(null==s)continue;const l=r.get(i);if(null!=l){if(void 0!==e[l+2])continue}a[o]===typeof s&&(null==l?(r.set(i,e.length),e.push(i,o,s)):e[l+2]=s)}return e},t.asBufferEntry=function(e,t,r,i,a){const o=function(e){return JSON.stringify([e.streamId,e.sequenceNumber,e.channel])}(e);return{bufferKey:o,meta:{streamId:e.streamId,sequenceNumber:e.sequenceNumber},bufferRow:{key:o,channel:t,streamId:r,buffer:(0,n.encodeB64)(i),finished:a}}},t.getDeltaFromAttributes=function(e){const t=new Map,r=new Map;for(let n=0;n<e.length;n+=4){const a=e[n],o=e[n+1],s=e[n+2],l=e[n+3];if(s===i.TYPES.FLOAT)throw new Error("Float attributes are currently not supported in runtime");if(!Array.isArray(a))return __LOG__(4,void 0,new Error,!0)`logAttributes WAM channel is not an array`,void SEND_LOGS("wam-log-attributes");a.includes("regular")&&t.set(o,l),a.includes("private")&&r.set(o,l)}return{deltaRegular:t,deltaPrivate:r}},t.getFinishedBuffers=function(e,t){const r=[];return t.forEach((t=>{const{channel:i}=t;if(null==i){if("regular"!==e)return}else if(i!==e)return;if(t.finished){const e=new Uint8Array((0,n.decodeB64)(t.buffer)),i=t.key;r.push({key:i,content:e})}})),r},t.getSequenceNumber=function(e){let t=null;e&&(t=e.sequenceNumber);return t};var n=r(15688),i=r(68518);const a={[i.TYPES.INT]:"number",[i.TYPES.FLOAT]:"number",[i.TYPES.STRING]:"string",[i.TYPES.BOOL]:"boolean"}},46977:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){if(e===a.BUSINESS_CATEGORY_EMPTY_STR_ID)return(0,s.queryBusinessCategories)("");return(0,s.queryBusinessCategories)(e)},t.queryBusinessProfile=function(e,t){return(0,o.queryBusinessProfile)(e,t)},t.queryBusinessPublicKey=function(e){return(0,o.queryBusinessPublicKey)(e)},t.querySignedUserInfo=function(){return d.apply(this,arguments)},t.updateCartEnabled=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(32742),o=r(79235),s=r(40346),l=r(99234);function c(){return(c=(0,i.default)((function*(e){const t=r(93581).BusinessProfileCollection,n=yield(0,o.updateCartEnabled)(e),i=t.getValid((0,l.getMeUser)()),a=null==i?void 0:i.profileOptions;i&&a&&(a.cartEnabled=n,t.add(i,{merge:!0}))}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const{phoneNumber:t,phoneNumberSignature:r,phoneNumberSignatureExpiration:n,businessDomain:i}=yield(0,o.querySignedUserInfo)(e);if(null==t||null==n||null==r||null==i)throw new Error("Unexpected null or undefined");return{phoneNumber:t,phoneNumberSignature:r,phoneNumberSignatureExpiration:n,businessDomain:i}}))).apply(this,arguments)}},9762:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(90257),o=r(99234),s=r(5819),l=r(30849);function c(){return(c=(0,i.default)((function*(e,t,r){const n=p(t),i=p(r),a=[u(e,n,i),d(e,n,i)];yield Promise.all(a.map((t=>t?(0,s.handleSingleMsgMD)(e,t):null)))}))).apply(this,arguments)}function d(e,t,r){if(!0===(0,o.getGlobalSecurityNotifications)())return t===l.ReducedPrivacyMode.E2EE&&r!==l.ReducedPrivacyMode.E2EE?(0,a.genEncryptNotificationMsg)(e,"e2e_identity_unavailable"):void 0}function u(e,t,r){if(t!==r)switch(r){case l.ReducedPrivacyMode.E2EE:return(0,a.genEncryptNotificationMsg)(e,"encrypt_now");case l.ReducedPrivacyMode.BSP:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_bsp");case l.ReducedPrivacyMode.FB:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_fb")}}function p(e){return(0,l.getReducedPrivacyMode)(e.isBusiness&&e.isEnterprise?e.privacyMode:null)}},96519:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.addProduct)(e,t,r)},t.appealProduct=function(e,t){return(0,s.appealProduct)(e,t)},t.createBusinessCatalog=function(){return(0,s.createCatalog)()},Object.defineProperty(t,"createProductCatalog",{enumerable:!0,get:function(){return c.createProductCatalog}}),t.deleteProducts=function(e){return(0,s.deleteProducts)(e)},t.editProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.editProduct)(e,t,r)},t.queryCatalog=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return(0,s.queryCatalog)(e,t,r,n,i,a,o)},t.queryProduct=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,s.queryProduct)(e,t,r,n,i,a)},t.queryProductList=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0;return(0,s.queryProductList)(e,t,r,n,i)},t.reportProduct=function(e,t,r){return(0,s.reportProduct)(e,t,r)},t.sendProductToChat=function(e,t,r){const{catalogWid:s}=e;if(!t)return;const c=t.productCollection.get(e.id),d=c?(0,l.unproxy)(c):(0,l.unproxy)(e);if(!d)return;const u=d.getProductImageCollectionHead(),p=null==u?void 0:u.mediaData;if(!p)return;(0,a.findChat)(s).then((function(e){i.Cmd.openChatFromUnread(e).then((t=>{if(t){const t=(0,l.unproxy)((0,o.createProductInquiry)(d,s,p,null==r?void 0:r.session.toString()));e.composeQuotedMsg=t,i.Cmd.focusChatTextInput(e),window.innerWidth<=n.LAYOUT_2COLUMNS_MAX_WIDTH&&i.Cmd.closeDrawerRight()}}))}))};var n=r(41906),i=r(88102),a=r(50101),o=r(17304),s=r(21374),l=(r(27798),r(31019)),c=r(90880)},92002:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProductListHeaderImageRejected=function(e,t){var r,i,a;const o=n.MsgCollection.get(t),s=null==o||null===(r=o.list)||void 0===r||null===(i=r.productListInfo)||void 0===i||null===(a=i.headerImage)||void 0===a?void 0:a.productId;e.id===s&&null!=o&&(o.productHeaderImageRejected=!0)};var n=r(59871)},31452:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyContactBusinessProps=void 0,t.updateContactsWithVerifiedNames=p;var i=n(r(48926)),a=n(r(45095)),o=r(45454),s=r(93170),l=r(19380),c=r(7293),d=r(49714),u=r(68708);function p(e,t){const r={};for(const t of e){const{id:e}=t;r[e.user]=t}for(const e of t){const{id:t}=e,n=r[t.user],i=Boolean(n),{level:a,name:o,isApi:s,privacyMode:l}=n||{},c={isBusiness:i,isEnterprise:Boolean(s),verifiedLevel:_(a),verifiedName:o,privacyMode:l};e.set(c)}}const f=function(){var e=(0,i.default)((function*(){if(!c.GK.supportsFeature(c.GK.F.MD_BACKEND))return;p((yield(0,u.getAllVerifiedNames)()).map((e=>{let{id:t,name:r,level:n,isApi:i,privacyMode:s}=e;return{id:(0,o.createUserWid)(t),name:r,level:n,isApi:i,privacyMode:s?{actualActors:(0,a.default)(d.ActualActorsEnumType.cast(s.actualActors),"ActualActorsEnumType.cast(privacyMode.actualActors)"),hostStorage:(0,a.default)(d.HostStorageEnumType.cast(s.hostStorage),"HostStorageEnumType.cast(privacyMode.hostStorage)"),privacyModeTs:s.privacyModeTs}:null}})),l.ContactCollection.toArray())}));return function(){return e.apply(this,arguments)}}();function _(e){if(null!=e){switch(e){case"unknown":return s.VERIFIED_LEVEL.UNKNOWN;case"low":return s.VERIFIED_LEVEL.LOW;case"high":return s.VERIFIED_LEVEL.HIGH}return s.VERIFIED_LEVEL.UNKNOWN}}t.applyContactBusinessProps=f},66167:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndUpdateContactPropertiesOnNewChat=function(){return f.apply(this,arguments)},t.updateVerifiedInfo=u;var i=n(r(48926)),a=r(19380),o=r(7293),s=r(39354),l=r(69722),c=r(31452),d=r(68708);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const r=e.id,{name:n,level:i,isApi:a,serial:l}=t,u=t.privacyMode;o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&null!=u&&(yield(0,s.handlePrivacyModeTransition)(r,u,null,!0)),(0,c.updateContactsWithVerifiedNames)([{id:r,name:n,level:i,isApi:a,privacyMode:u}],[e]),yield(0,d.createOrUpdateVerifiedBusinessName)({id:r.user,level:i,serial:l,name:n,isApi:a,privacyMode:u?{actualActors:u.actualActors,hostStorage:u.hostStorage,privacyModeTs:u.privacyModeTs}:null})}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND)){const t=yield(0,l.queryExists)(e);if(null==t)return;const{bizInfo:r}=t;if(r){const t=a.ContactCollection.get(e);if(null==t)return __LOG__(4,void 0,new Error,!0)`queryAndUpdateContactPropertiesOnNewChat contact does not exist ${""}`,void SEND_LOGS("queryAndUpdateContactPropertiesOnNewChat contact does not exist");yield u(t,r.verifiedName)}}}))).apply(this,arguments)}},92027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedNameSync=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(7293),o=r(39354),s=r(31452),l=r(85808);function c(){return(c=(0,i.default)((function*(e){if(!a.GK.supportsFeature(a.GK.F.MD_BACKEND)||0===e.length)return;yield e.map((e=>{let{id:t,verifiedName:{privacyMode:n}}=e;if(null==n)return;const i=r(69951).ChatCollection.get(t);return null!=i&&!0!==i.shouldAppearInList?(0,o.handlePrivacyModeTransition)(t,n,i,!0):void 0}));const t=e.map((e=>{let{id:t,verifiedName:{level:r,serial:n,name:i,isApi:a,privacyMode:o}}=e;return{id:t.user,level:r,serial:n,name:i,isApi:a,privacyMode:o?{actualActors:o.actualActors,hostStorage:o.hostStorage,privacyModeTs:o.privacyModeTs}:null}}));yield(0,l.getTable)().bulkCreateOrReplace(t),yield(0,s.applyContactBusinessProps)()}))).apply(this,arguments)}},26878:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(24606),o=r(24175),s=r(14777),l=r(76290),c=r(58871);function d(){return(d=(0,i.default)((function*(e,t,r){var n,i;let d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.maybeUpdateEphemeralSetting should not be called for group ${e.id.toString()}`,SEND_LOGS("handle-ephemeral-sync-response"),!1;if(!(0,s.isEphemeralDurationAllowed)(t))return __LOG__(2)`chat.maybeUpdateEphemeralSetting called with invalid setting ${t} seconds for chat ${e.id.toString()}`,!1;const u=null!==(n=e.ephemeralSettingTimestamp)&&void 0!==n?n:0,p=null!==(i=e.ephemeralDuration)&&void 0!==i?i:0,f=e.id,_=(0,l.shouldUpdateEphemeralSetting)({oldDuration:p,oldSettingTimestamp:u,newDuration:t,newSettingTimestamp:r,chatId:f});return _&&(yield(0,c.updateLocal)(e.id,{ephemeralDuration:t,ephemeralSettingTimestamp:r,disappearingModeInitiator:a.DisappearingModeInitiator.ChangedInChat}),p!==t&&d&&(yield(0,o.generateEphemeralSystemMessage)(e,t)),e.ephemeralDuration=t,e.ephemeralSettingTimestamp=r,e.disappearingModeInitiator=a.DisappearingModeInitiator.ChangedInChat,__LOG__(2)`chat.maybeUpdateEphemeralSetting updated chatId=${e.id.toString()} ephemeralDuration=${t} ephemeralSettingTimestamp=${r}`),_}))).apply(this,arguments)}},50039:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.updateEphemeralSettingTimestamp should not be called for group ${e.id.toString()}`,void SEND_LOGS("update-ephemeral-setting-timestamp");(0,n.updateLocal)(e.id,{ephemeralSettingTimestamp:t}).then((()=>{e.ephemeralSettingTimestamp=t,__LOG__(2)`chat.updateEphemeralSettingTimestamp chatId=${e.id.toString()} ephemeralSettingTimestamp=${t}`}))};var n=r(58871)},50101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.findChat=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(89385),o=r(91829),s=r(9025);function l(){return(l=(0,i.default)((function*(e,t,r){if(null==r?void 0:r.aborted)throw new a.AbortError;const n=yield(0,s.getExisting)(e);if(n)return n;if(null==r?void 0:r.aborted)throw new a.AbortError;return yield(0,o.create)(e,{createdLocally:!0},{forceUsync:t})}))).apply(this,arguments)}},60629:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createChatOnNewMsg=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(19380),o=r(91829),s=r(30849);function l(){return(l=(0,i.default)((function*(e,t,r){if(!e.isUserNotPSA())return;const n=a.ContactCollection.gadd(e);(0,s.comparePrivacyMode)(r,n.privacyMode)>0&&(n.privacyMode=r),yield(0,o.create)(e,{createdLocally:!1},{firstIncomingMsg:t,nextPrivacyMode:n.privacyMode})}))).apply(this,arguments)}},371:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearPresence=function(e){e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"));e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.typing=!1},t.markComposing=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.typing){const t=e.id;(0,i.sendChatStateComposing)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence composing error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),d)}e.typing=!0,e.pausedTimerId&&clearTimeout(e.pausedTimerId);e.pausedTimerId=setTimeout((()=>u(e)),2500)}((0,s.unproxy)(e))},t.markPaused=function(e){return u((0,s.unproxy)(e))},t.markRecording=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.recording){const t=e.id;(0,i.sendChatStateRecording)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence recording error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),d)}e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.recording=!0,e.typing=!1}((0,s.unproxy)(e))},t.presenceOnlineChanged=function(e){e.presence.isOnline?p(e):e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"))},t.sendPresenceAvailable=function(){(0,o.setPresenceAvailable)()},t.sendPresenceUnavailable=function(){(0,o.setPresenceUnavailable)()};var n=r(50796),i=r(76931),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=c(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),o=r(1985),s=r(31019),l=r(77591);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(c=function(e){return e?r:t})(e)}const d=1e4;function u(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&(e.typing||e.recording)){const t=e.id;(0,i.sendChatStatePaused)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence paused error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId")),e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId")),e.typing=e.recording=!1}function p(e){const t=e.id;if(e.recording)(0,i.sendChatStateRecording)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend recording error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{})));else{if(!e.typing)return void e.unset("presenceResendTimerId");(0,i.sendChatStateComposing)(t).catch((0,n.filteredCatch)(l.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend composing error ${t.toString()}`}))).catch((0,n.filteredCatch)([l.WebdDrop,a.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId=setTimeout((()=>p(e)),d)}},83802:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearChat=E,t.clearMessagesInChatModel=S,t.createEncryptionSystemMessage=function(e,t){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!t){const{handleSingleMsgMD:t}=r(5819),n=(0,d.default)(e.id,e.contact.privacyMode);return t(n.from,n)}return Promise.resolve()},t.sendClear=function(e,t){return y((0,_.unproxy)(e),t)};var i=n(r(48926)),a=r(50796),o=r(48360),s=r(46331),l=r(91177),c=r(88102),d=n(r(25868)),u=r(7293),p=r(57701),f=n(r(43725)),_=r(31019),h=r(58871),g=r(77591),m=r(85893);function y(e,t){const{promises:n}=e;if(n.sendClear)return n.sendClear;const _=e.getLastMsgKeyForAction(),v=n.sendClear=(0,l.sendClear)(e,_,t),T=new s.ActionType(f.default.t(19)),C=v.then(function(){var t=(0,i.default)((function*(){const t=r(63183).ConversationEndOfHistoryTransferModelPropType;return e.endOfHistoryTransferType=t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY,yield(0,h.updateLocal)(e.id,{endOfHistoryTransferType:t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY}),u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!(0,p.clearOrDeleteChatSyncEnabled)()?new s.ActionType(o.fbt._("Chat cleared from this device",null,{hk:"1XIeYe"})):new s.ActionType(f.default.t(18))}));return function(){return t.apply(this,arguments)}}()).catch((0,a.filteredCatch)(g.ServerStatusCodeError,(e=>{if(e.status>=400)return new s.ActionType(f.default.t(17))}))).catch((()=>(__LOG__(3)`models:chat:sendClear dropped`,new s.ActionType(f.default.t(17),{actionText:f.default.t(129),actionHandler:()=>y(e,t)}))));return c.Cmd.openToast((0,m.jsx)(s.ActionToast,{id:(0,s.genId)(),initialAction:T,pendingAction:C})),v.then((n=>{if(!n._duplicate)if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){if(!(0,p.clearOrDeleteChatSyncEnabled)()){E(e,t);const{handleSingleMsgMD:n}=r(5819),i=(0,d.default)(e.id,e.contact.privacyMode);return n(i.from,i)}n.result&&S(e,n.result)}else E(e,t)})).catch((0,a.filteredCatch)(g.ServerStatusCodeError,(()=>{}))).finally((()=>{n.sendClear=null}))}function E(e,t){if(e){const r=e.getLastMsgKeyForAction(),n=r?e.msgs.get(r):void 0;e.deleteMsgsBeforeMsgInclusive(n,t)}}function S(e,t){e&&t&&e.deleteMessages(t)}},75887:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addAndSendMsgToChat=function(e,t,n){return function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const l=Promise.resolve(t).then((t=>{const i=r(59871).MsgCollection,l=(0,a.default)({},t),h=(0,g.getContactPrivacyMode)(e.id);null!=h&&(l.privacyModeWhenSent=h);const m=i.add(l)[0];if(m){var y;u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&(m.wamMessageSendPerfReporter=new _.MessageSendPerfReporter(m.to,m.getWamMediaType(),m.getWamMessageType())),n=(0,d.default)(m,e);const t=n?[n,l]:[l];return null===(y=m.wamMessageSendPerfReporter)||void 0===y||y.startSavedStage(),(0,f.storeMessages)(t,e.id).then((()=>{var e;if(null===(e=m.wamMessageSendPerfReporter)||void 0===e||e.postSavedStage(),m.type===o.MSG_TYPE.GROUPS_V4_INVITE)return(0,p.persistGroupInviteV4Msg)(m.id.toString(),{id:m.id.toString(),from:m.from.toString(),to:m.to.toString(),groupId:m.inviteGrp,expiration:parseInt(m.inviteCodeExp,10),expired:s.Clock.globalUnixTime()>=parseInt(m.inviteCodeExp,10)})})).then((()=>m.waitForPrep().then((()=>m))))}throw new c.ModelCreateError("Msg",l)})),h=e.addQueue.enqueue(l).then((t=>{var r;return null===(r=t.wamMessageSendPerfReporter)||void 0===r||r.startRenderedStage(),n&&e.msgs.add(n),e.msgs.add(t)[0]})).then((e=>{var t;return null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.postRenderedStage(),e})),m=i?h.then(i).then((()=>h)):h,y=S(e,m);return[h,y]}((0,y.unproxy)(e),t,n)},t.resendMsgToChat=function(e,t){return S((0,y.unproxy)(e),t)};var i=n(r(48926)),a=n(r(81109)),o=r(15461),s=r(22683),l=r(1973),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),d=n(r(43239)),u=r(7293),p=r(62415),f=r(84886),_=r(30097),h=r(29731),g=r(30849),m=r(19708),y=(r(13705),r(31019));function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&e.isGroup){const t=r(63928).default;yield t.find(e.id)}return new h.NonPersistJob("sendMessage",(0,i.default)((function*(){const r=yield e.sendQueue.enqueue(t);return(0,m.sendMsgRecord)(r)})),{priority:l.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}},19569:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendNotSpam=function(e,t){return E((0,f.unproxy)(e),t)},t.sendSpamBlockClear=function(e,t){return function(e,t){const{promises:r,isGroup:n,contact:i}=e;if(r.reportSpamBlockClear)return r.reportSpamBlockClear;if(n)return Promise.reject(new l.ActionError);const a=y(e,t);return r.reportSpamBlockClear=a.then((()=>(0,o.blockContact)(i))).then((()=>(0,u.sendClear)(e,!1))).catch((()=>{})).finally((()=>{r.reportSpamBlockClear=null})),r.reportSpamBlockClear}((0,f.unproxy)(e),t)},t.sendSpamExitClear=function(e,t){return function(e,t){const{promises:r,isGroup:n,isReadOnly:i,msgs:a}=e;if(r.reportSpamExitClear)return r.reportSpamExitClear;if(!n)return Promise.reject(new l.ActionError);let o;const s=y(e,t);if(i)o=s;else{const t=(0,c.sendExitGroup)(e),r=(0,_.default)(a,"change:last",(e=>e.isGroupLeave()));o=Promise.all([s,t,r])}return r.reportSpamExitClear=o.then((()=>(0,u.sendClear)(e,!1))).catch((()=>{})).finally((()=>{r.reportSpamExitClear=null})),r.reportSpamExitClear}((0,f.unproxy)(e),t)},t.sendSpamReport=function(e,t){return y((0,f.unproxy)(e),t)};var i=r(50796),a=r(46331),o=r(80140),s=r(88102),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),c=r(5501),d=n(r(43725)),u=r(83802),p=r(26707),f=(r(38839),r(31019)),_=n(r(17072)),h=r(77591),g=r(85893);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function y(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.genId)();const{promises:n}=e;if(n.sendSpamReport)return n.sendSpamReport;const o=n.sendSpamReport=(0,p.sendSpamReport)(e,t),l=new a.ActionType(d.default.t(122)),c=o.then((()=>new a.ActionType(d.default.t(124)))).catch((0,i.filteredCatch)(h.ServerStatusCodeError,(()=>new a.ActionType(d.default.t(123))))).catch((()=>(__LOG__(3)`models:chat:sendSpamReport dropped`,new a.ActionType(d.default.t(123),{actionText:d.default.t(129),actionHandler:()=>y(e,t,r)}))));return s.Cmd.openToast((0,g.jsx)(a.ActionToast,{id:r,initialAction:l,pendingAction:c})),o.finally((()=>{n.sendSpamReport=null}))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,a.genId)();const{promises:n,notSpam:o}=e;if(o)return Promise.resolve();if(n.sendNotSpam)return n.sendNotSpam;const l=n.sendNotSpam=(0,p.sendNotSpam)(e);if(t){const n=new a.ActionType(d.default.t(76)),o=l.then((()=>new a.ActionType(d.default.t(78)))).catch((0,i.filteredCatch)(h.ServerStatusCodeError,(()=>new a.ActionType(d.default.t(77))))).catch((()=>(__LOG__(3)`models:chat:sendNotSpam dropped`,new a.ActionType(d.default.t(77),{actionText:d.default.t(129),actionHandler:()=>E(e,t,r)}))));s.Cmd.openToast((0,g.jsx)(a.ActionToast,{id:r,initialAction:n,pendingAction:o}))}return l.then((()=>{e.set({notSpam:!0})})).finally((()=>{e.isTrusted(),n.sendNotSpam=null}))}},41088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendTcToken=function(){return u.apply(this,arguments)},t.sendTcTokenWhenDeviceIdentityChange=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(64603),s=r(69951),l=r(22683),c=r(76214),d=r(80079);function u(){return(u=(0,i.default)((function*(e){if(!e.isUserNotPSA())return;const t=s.ChatCollection.get(e);if(null!=t&&(0,o.shouldSendNewToken)(t.tcTokenSenderTimestamp))try{const r=(0,a.castToUnixTime)(l.Clock.globalUnixTime());yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],r);const n={tcTokenSenderTimestamp:r};t.set(n),yield(0,c.getChatTable)().merge(e.toString(),n)}catch(e){__LOG__(3,!0,void 0,!0)`sendTcToken failed - ${e}`,SEND_LOGS("send-tc-token-failed")}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=s.ChatCollection.get(e);if(null==t)return;const r=t.tcTokenSenderTimestamp;if(null!=r&&!(0,o.isTokenExpired)(r,o.TcTokenMode.Sender))try{yield(0,d.setPrivacyTokens)(e,[d.TokenType.TrustedContact],(0,a.castToUnixTime)(r))}catch(e){__LOG__(3,!0,void 0,!0)`sendTcTokenWhenDeviceIdentityChange failed - ${e}`,SEND_LOGS("send-tc-token-device-identity-change-failed")}}))).apply(this,arguments)}},3553:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unstarAllMessages=function(e,t){return _(e,t?(0,u.unproxy)(t):t)};var i=r(50796),a=r(46331),o=r(88102),s=n(r(43725)),l=r(69694),c=n(r(11810)),d=r(19011),u=r(31019),p=r(77591),f=r(85893);function _(e,t){const n=r(69951).ChatCollection,u=t?t.promises:n.promises,h=t?t.id:void 0;if(u.sendUnstarAll)return u.sendUnstarAll;const g=u.sendUnstarAll=(0,l.sendUnstarAll)(e,h),m=new a.ActionType(s.default.t(93)),y=g.then((()=>new a.ActionType(s.default.t(91)))).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(e=>{if(e.statusCode>=400)return new a.ActionType(s.default.t(87))}))).catch((()=>(__LOG__(3)`models:chat:sendUnstarAll dropped`,new a.ActionType(s.default.t(87),{actionText:s.default.t(129),actionHandler:()=>_(e,t)}))));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:(0,a.genId)(),initialAction:m,pendingAction:y})),g.then((()=>{e.forEach((e=>{e.set("star",!1)})),t?(0,d.removeStarredMsgs)(e):(d.AllStarredMsgsCollection.reset(),c.default.reset(),n.forEach((e=>{e.starredMsgs&&e.starredMsgs.reset()})))})).finally((()=>{u.sendUnstarAll=null}))}},59201:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setTcToken=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(95024),o=r(91829),s=r(9025),l=r(76214);function c(){return(c=(0,i.default)((function*(e,t,r){if(null==r)return;if(!e.isUserNotPSA())return;let n=yield(0,s.getExisting)(e);if(null==n)return void(n=yield(0,o.create)(e,{tcToken:r,tcTokenTimestamp:t,pendingInitialLoading:!1,createdLocally:!1}));if(null!=n.tcToken&&(0,a.arrayBuffersDeepEqual)(n.tcToken,r)||null!=n.tcTokenTimestamp&&n.tcTokenTimestamp>t)return;const i={tcToken:r,tcTokenTimestamp:t};n.set(i),yield(0,l.getChatTable)().merge(e.toString(),i)}))).apply(this,arguments)}},9609:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearUnreadMentions=function(e){var t;(0,f.isGroupCatchUpEnabled)()&&e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.unreadMentionMetadata.reset())},t.markSeen=v,t.markUnread=function(e,t){return C((0,h.unproxy)(e),t)},t.markUnseen=T,t.sendSeen=S,t.updateUnreadCountMD=O;var i=n(r(48926)),a=r(50796),o=n(r(64369)),s=r(46331),l=r(48285),c=r(88102),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=r(7293),p=n(r(43725)),f=r(10435),_=r(97848),h=r(31019),g=r(8080),m=r(77591),y=r(85893);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}function S(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return A((0,h.unproxy)(e),t).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{__LOG__(3)`sendSeen: got status ${e.status}`})))}function v(e,t,r){return function(){return M.apply(this,arguments)}((0,h.unproxy)(e),t,r)}function T(e){!function(e){0!==e.unreadCount&&e.unreadCount!==o.default.MARKED_AS_UNREAD||(e.active&&(e.markedUnread=!0),(0,_.markConversationUnseen)(e.id).then((()=>{e.unreadCount=o.default.MARKED_AS_UNREAD})))}((0,h.unproxy)(e))}function C(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,s.genId)();t?e.active&&(e.markedUnread=!0):e.markedUnread=!1;const{promises:n}=e;if(n.markUnread)return n.markUnread;const i=n.markUnread=t?b(e):A(e),o=t?new s.ActionType(p.default.t(28)):new s.ActionType(p.default.t(27)),l=i.then((()=>{const n=t?p.default.t(26):p.default.t(25);return new s.ActionType(n,{actionText:p.default.t(133),actionHandler:()=>C(e,!t,r)})})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{if(e.status>=400)return t?new s.ActionType(p.default.t(24)):new s.ActionType(p.default.t(23));throw new Error("invalid response status")}))).catch((()=>{const n=t?p.default.t(24):p.default.t(23);return new s.ActionType(n,{actionText:p.default.t(129),actionHandler:()=>C(e,t,r)})}));return c.Cmd.openToast((0,y.jsx)(s.ActionToast,{id:r,initialAction:o,pendingAction:l})),i.then((()=>{})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>{__LOG__(3)`markUnread: got status ${e.status}`}))).finally((()=>{n.markUnread=null}))}function A(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.markedUnread||0===e.unreadCount)return String(e.markedUnread),e.unreadCount,Promise.resolve();if(!g.Stream.available&&t)return e.listenToOnce(g.Stream,"change:available",(()=>S(e))),Promise.resolve();e.unreadCount,e.pendingSeenCount;const r=e.unreadCount-e.pendingSeenCount,n=-1===e.unreadCount&&-1===r;if(r<=0&&!n)return Promise.resolve();e.disableUnreadAnchor=!0,e.pendingSeenCount=e.unreadCount,e.pendingSeenCount;const i=()=>{e.pendingSeenCount=e.pendingSeenCount-r,e.pendingSeenCount,e.pendingSeenCount<0&&(__LOG__(3)`models:chat:sendSeen unread ${e.unreadCount} pending: ${e.pendingSeenCount} delta: ${r}`,e.pendingSeenCount=0)},o=e.getLastMsgKeyForAction();return(0,_.sendConversationSeen)(e,o,r).then((t=>{u.GK.supportsFeature(u.GK.F.MD_BACKEND)?O(e,r):t._duplicate?i():v(e,r,!0)})).catch((0,a.filteredCatch)(m.ServerStatusCodeError,(e=>(i(),Promise.reject(e))))).catch((0,a.filteredCatch)([m.WebdDrop,d.ProtoVersionUndefined],(()=>{i(),__LOG__(3)`models:chat:sendConversationSeen dropped`})))}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=e.getLastMsgKeyForAction();try{yield(0,_.sendConversationUnseen)(e.id,t),T(e)}catch(t){return(0,a.filteredCatch)(m.ServerStatusCodeError,(t=>(e.markedUnread=!1,Promise.reject(t))))(t)}}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];String(t);let n=null;null!=t?t>0&&t<=e.unreadCount?(n=e.unreadCount-t,String(n)):-1===t&&e.unreadCount<=0&&(n=0,String(n)):(n=0,String(n));const i=null==n?Promise.resolve():(0,_.markConversationSeen)(e.id,n);if(yield i,null!=t&&r){const r=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,r)}null!=n&&(e.unreadCount=n),e.unreadMsgAnchor=void 0,e.markedUnread=!1}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{unreadCount:n}=yield(0,l.getChatMeta)(e.id);if(e.unreadCount,e.unreadCount=n,e.unreadMsgAnchor=void 0,e.markedUnread=!1,r){const r=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,r)}}))).apply(this,arguments)}},67087:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeToCommunity=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(86945),o=r(22683),s=r(58052),l=r(74028);function c(){return(c=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(0,s.getIsCommunityDiscovered)();if(t)return;if(e)return(0,s.setIsCommunityDiscovered)(!0),void __LOG__(2)`upgradeToCommunity: isInitialBootstrap is true, set isCommunityDiscovered to true`;const r=o.Clock.globalUnixTime(),n=(0,a.getABPropConfigValue)("parent_group_query_ts");if(0===n||r<n)(0,s.setIsCommunityDiscovered)(!0),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${n}), set isCommunityDiscovered to true`;else try{yield(0,l.queryAndUpdateAllGroupMetadata)(),(0,s.setIsCommunityDiscovered)(!0),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${n}), fetched groups and set isCommunityDiscovered to true`}catch(e){__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${n}), fetched groups and failed, kept isCommunityDiscovered at false`}}))).apply(this,arguments)}},97270:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addJoinedSubgroup=function(e,t){e.joinedSubgroups=[...e.joinedSubgroups,t]},t.removeJoinedSubgroup=function(e,t){e.joinedSubgroups=e.joinedSubgroups.filter((e=>e!==t))}},53006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPushnameLocally=function(e){n.Conn.pushname=e,(0,i.setPushname)(e)};var n=r(17239),i=r(99234)},67146:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMeToContacts=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(72441),o=r(4233),s=r(99234),l=r(46582);function c(){return(c=(0,i.default)((function*(){const e=yield(0,l.requireContactCollection)(),t=(0,s.getMaybeMeUser)(),r=(0,a.toPhoneUserJid)(t.user);yield(0,o.getTable)().createOrMerge(r,{id:r}),_wext.obam(e),e.gadd(t)}))).apply(this,arguments)}},66308:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGenerateDeviceNotifications=function(){return h.apply(this,arguments)},t.createAndStoreDeviceNotifications=function(){return _.apply(this,arguments)},t.generateDeviceNotifications=p;var i=n(r(48926)),a=r(52230),o=r(45454),s=r(86945),l=r(90257),c=r(99234),d=r(76214),u=r(90641);function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r){const n={notifications:[],chatIds:[]};if(!(0,c.getGlobalSecurityNotifications)())return n;if((0,s.getABPropConfigValue)("adv_v2_m6"))return n;if(!(t.length>0||r.length>0))return n;let i=[];if(e.equals((0,c.getMeUser)()))try{(yield(0,d.getChatTable)().all()).forEach((e=>{e.id!==a.STATUS_JID&&i.push((0,o.createWid)(e.id))}))}catch(e){throw __LOG__(4,!0,new Error,!0)`get all from chat table failed`,SEND_LOGS("get all from chat table failed when creating device notification"),new Error("get all from chat table failed")}else try{const t=yield(0,d.getChatTable)().get(String(e)),r=yield(0,d.getParticipantTable)().equals(["participants"],String(e));i=r.map((e=>(0,o.createWid)(e.groupId))),t&&i.push((0,o.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chays failed")}const u=i.map((n=>(0,l.genDeviceNotificationMsg)(n,e,t,r)));return n.notifications=u,n.chatIds=i.map(String),n}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,r){const{notifications:n}=yield p(e,t,r);yield Promise.all(n.map((e=>(0,u.storeMessageInTransaction)([e]))))}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){let t=[];const r=new Set;if((0,c.getGlobalSecurityNotifications)()){(yield Promise.all(e.map((e=>{let{wid:t,added:r,removed:n,isNewRecord:i}=e;return i?Promise.resolve(null):p(t,r,n)})))).forEach((e=>{e&&(t=t.concat(e.notifications),e.chatIds.forEach((e=>r.add(e))))}))}return t.length>0?{notifications:t,chatIds:Array.from(r)}:{notifications:[],chatIds:[]}}))).apply(this,arguments)}},54181:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceNotification=function(e){let{wid:t,devices:r,type:n}=e;if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return null==n?Promise.reject(new Error("handleADVDeviceNotification: notification without type")):function(){return h.apply(this,arguments)}(t,r,n);return Promise.reject(new Error("This call is only supported in MD mode"))},t.handleADVDeviceSyncResult=function(e){if(c.GK.supportsFeature(c.GK.F.MD_BACKEND))return function(){return g.apply(this,arguments)}(e);return Promise.reject(new Error("This call is only supported in MD mode"))},t.handleADVDeviceUpdateForMessage=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(86945),o=r(68268),s=r(5087),l=r(9108),c=r(7293),d=r(54678),u=n(r(76128)),p=r(17041),f=r(93832);function _(){return(_=(0,i.default)((function*(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(c.GK.supportsFeature(c.GK.F.MD_BACKEND)){let l;return(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(l=yield(0,o.getLastADVDeviceInfoCheckTime)()),(0,d.handleADVDeviceUpdateForMessage)(e,t,r,n,i,s,l)}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){let i=null;if("add"===n){const t=yield u.default.loadIdentityKey((0,f.createSignalAddress)(e).toString());i=t?(0,s.toCurveKeyPubKey)((0,f.strToBuffer)(t)):null}const c=yield(0,l.getDeviceRecord)(e.user);let d;(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(d=yield(0,o.getLastADVDeviceInfoCheckTime)());const _=(0,r(81864).handleDeviceNotification)(e,n,t,i,c,d);if(_)return _.clearRecord&&(yield(0,p.clearDeviceRecord)(e,(null==c?void 0:c.devices)||[])),(0,p.bulkApplyDeviceUpdate)([{wid:e,update:_.update,currentRecord:c}])}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){__LOG__(2)`_handleADVDeviceSyncResult: start to handling ${e.length} updates`;const t=e.map((e=>e.wid)),n=e.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})),i=yield u.default.bulkLoadIdentityKey(n.map((e=>(0,f.createSignalAddress)(e.wid).toString()))),a=new Map;n.forEach(((e,t)=>{a.set(e.wid.user,i[t])}));const o=yield(0,l.bulkGetDeviceRecord)(t.map((e=>e.user))),c=[],d=[],_=r(81864).handleADVSyncResult;e.forEach(((e,t)=>{const r=a.get(e.wid.user),n=r?(0,s.toCurveKeyPubKey)((0,f.strToBuffer)(r)):null,i=o[t],l=_(e.wid,e.devices,n,i);null!=l&&(l.clearRecord?(c.push({wid:e.wid,currentList:(null==i?void 0:i.devices)||[]}),d.push({wid:e.wid,currentRecord:{id:e.wid.user,deleted:!0},update:l.update})):d.push({wid:e.wid,currentRecord:i,update:l.update}))})),yield Promise.all(c.map((e=>{let{wid:t,currentList:r}=e;return(0,p.clearDeviceRecord)(t,r)}))),yield(0,p.bulkApplyDeviceUpdate)(d)}))).apply(this,arguments)}},17041:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkApplyDeviceUpdate=function(){return y.apply(this,arguments)},t.clearDeviceRecord=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=n(r(91966)),o=r(52230),s=r(45454),l=r(66308),c=r(9108),d=r(99234),u=r(41796),p=r(14748),f=n(r(29783)),_=r(90641),h=r(93932),g=r(58928);function m(){return(m=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];yield Promise.all(t.filter((e=>e.id!==o.DEFAULT_DEVICE_ID)).map((t=>v((0,s.createDeviceWidFromUserAndDevice)(e.user,t.id)))));const n=[],a=t.map((e=>e.id)).filter((e=>e!==o.DEFAULT_DEVICE_ID)),{encryptedNotifications:l,chatIds:d}=yield E([{wid:e,added:n,removed:a,isNewRecord:!1}],r);yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=l.length>0?(0,_.storeEncryptedMessage)(l,d,!1):Promise.resolve(),r=(0,g.updateGroupParticipantsInTransaction)(e,n,a),i=(0,c.createOrReplaceDeviceRecord)({id:e.user,deleted:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove from device list table failed`,SEND_LOGS("remove from device list table failed when clearing device record"),new Error("remove from device list table failed")}));yield Promise.all([t,r,i])})),l.length>0)}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=[],n=[];let l=!1;e.forEach((e=>{let{wid:t,update:i,currentRecord:c}=e;const{devices:u}=i,p=u.map((e=>e.id)),f=c&&!c.deleted?c.devices.map((e=>e.id)):[],_=(0,a.default)(p,f).filter((e=>e!==o.DEFAULT_DEVICE_ID)),h=(0,a.default)(f,p).filter((e=>e!==o.DEFAULT_DEVICE_ID));r.push({wid:t,added:_,removed:h,isNewRecord:null==c}),h.forEach((e=>{n.push((0,s.createDeviceWidFromUserAndDevice)(t.user,e))})),t.user===(0,d.getMeUser)().user&&h.length>0&&(l=!0)}));const{encryptedNotifications:u,chatIds:f}=yield E(r,t);Promise.all(n.map((e=>v(e)))),yield(0,p.getDeviceUpdateLock)((0,i.default)((function*(){const t=u.length>0?(0,_.storeEncryptedMessage)(u,f,!1):Promise.resolve(),n=(0,g.bulkUpdateGroupParticipantsInTransaction)(r),i=(0,c.bulkCreateOrReplaceDeviceRecord)(e.map((e=>e.update))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into device list table failed`,SEND_LOGS("bulkCreateOrReplace into device list table failed when applying device update"),new Error("bulkCreateOrReplace into device list table failed")})),a=l?i.then((()=>(0,h.updateMissingKeyDevices)().catch((e=>{__LOG__(3)`syncd: updateMissingKeyDevices failed with error:
${e}`})))):Promise.resolve();yield Promise.all([t,n,i,a])})),u.length>0,l)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{notifications:r,chatIds:n}=yield(0,l.bulkGenerateDeviceNotifications)(e);if(!t){const e=yield(0,_.encryptMultipleMsgs)(r);return C(r),{chatIds:n,encryptedNotifications:e}}return f.default.addOfflineMessage(r.map((e=>({msg:e})))),{chatIds:[],encryptedNotifications:[]}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const{deleteDeviceSenderKey:t,deleteRemoteInfo:n}=r(54084);try{yield Promise.all([n(e),t(e)])}catch(t){__LOG__(2)`handleDevicesNotification: failed to clean the signal info for ${e.user}`}}))).apply(this,arguments)}function C(e){return Promise.all(e.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,u.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})))}},58928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkUpdateGroupParticipantsInTransaction=function(){return f.apply(this,arguments)},t.updateGroupParticipantsInTransaction=function(){return p.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(45454),l=r(57701),c=n(r(11339)),d=r(76214),u=r(99039);function p(){return(p=(0,a.default)((function*(e,t,r){const n=(yield(0,d.getParticipantTable)().equals(["participants"],String(e))).map((n=>{let a=n.rotateKey;const o=new Map(n.senderKey);return(0,l.rotateSenderKeyIfSentEnabled)()?(r.forEach((t=>{var r;const n=String((0,s.createDeviceWidFromUserAndDevice)(e.user,t));a=a||null!==(r=o.get(n))&&void 0!==r&&r,o.delete(n)})),a&&o.forEach(((e,t)=>o.set(t,!1)))):(r.forEach((t=>{o.delete(String((0,s.createDeviceWidFromUserAndDevice)(e.user,t)))})),r.length>0&&(a=!0)),t.forEach((t=>{o.set(String((0,s.createDeviceWidFromUserAndDevice)(e.user,t)),!1)})),_(a,n,t,r),(0,i.default)((0,i.default)({},n),{},{senderKey:o,rotateKey:a})}));return(0,d.getParticipantTable)().bulkCreateOrReplace(n)}))).apply(this,arguments)}function f(){return(f=(0,a.default)((function*(e){if(0===e.length)return;const t=yield(0,d.getParticipantTable)().anyOf(["participants"],e.map((e=>String(e.wid))));if(0===t.length)return;const r=new Map;e.forEach((e=>{r.set(String(e.wid),e)}));const n=t.map((e=>{let t=e.rotateKey;const n=new Map(e.senderKey);return e.participants.forEach((i=>{const a=r.get(i);if(!a)return;const{added:o,removed:c}=a;(0,l.rotateSenderKeyIfSentEnabled)()?(c.forEach((e=>{var r;const i=String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e));t=t||null!==(r=n.get(i))&&void 0!==r&&r,n.delete(i)})),t&&n.forEach(((e,t)=>n.set(t,!1)))):(c.forEach((e=>{n.delete(String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e)))})),c.length>0&&(t=!0)),o.forEach((e=>{n.set(String((0,s.createDeviceWidFromUserAndDevice)(a.wid.user,e)),!1)})),_(t,e,o,c)})),(0,i.default)((0,i.default)({},e),{},{senderKey:n,rotateKey:t})}));return(0,d.getParticipantTable)().bulkCreateOrReplace(n)}))).apply(this,arguments)}function _(e,t,r,n){e&&!t.rotateKey&&(0,u.postSenderKeyExpiredMetric)({chatId:t.groupId,deviceCount:t.senderKey.size,expiryReason:n.includes(o.DEFAULT_DEVICE_ID)&&r.includes(o.DEFAULT_DEVICE_ID)?c.default.EXPIRY_REASON.IDENTITY_CHANGE:c.default.EXPIRY_REASON.DEVICE_UNPAIR})}},89333:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeExpectedTsForDeviceRecord=function(e,t,r){const n=null==t?void 0:t.timestamp;if(null==n)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};let i,o,s;null==t||t.deleted||(i=t.expectedTs,o=t.expectedTsLastDeviceJobTs,s=t.expectedTsUpdateTs);return a(e,n,r,i,o,s)},t.computeNewExpectedTs=a,t.shouldClearExpectedTs=function(e,t,r,i){if(!(0,n.getABPropConfigValue)("adv_v2_m4_m5"))return!1;if(null==r||r.deleted)return!1;if(null==r.expectedTs)return!1;if(e>=r.expectedTs)return!0;if(e<r.expectedTs&&t===r.expectedTs&&null!=i&&(null==r.expectedTsLastDeviceJobTs||i>r.expectedTsLastDeviceJobTs))return!0;return!1};var n=r(86945),i=r(22683);function a(e,t,r,a,o,s){if(!(0,n.getABPropConfigValue)("adv_v2_m4_m5"))return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};const l={expectedTs:a,expectedTsLastDeviceJobTs:o,expectedTsUpdateTs:s};return t>=e||null!=a&&a>=e||(l.expectedTs=e,l.expectedTsLastDeviceJobTs=r,(null==a||t>=a)&&(l.expectedTsUpdateTs=i.Clock.localUnixTime())),l}},65414:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleICDCData=function(e,t,r){if(h.GK.supportsFeature(h.GK.F.MD_BACKEND))return null!=r&&(0,d.getABPropConfigValue)("adv_v2_m4_m5")?m.enqueue((()=>function(){return y.apply(this,arguments)}(e,t,r))):Promise.resolve();return Promise.reject(new Error("handleICDCData: not supported for non md"))};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(8243),l=r(27870),c=r(92844),d=r(86945),u=r(68268),p=r(9108),f=r(89333),_=r(99234),h=r(7293),g=r(81864);const m=new l.PromiseQueue;function y(){return(y=(0,a.default)((function*(e,t,r){const{deviceListMetadata:n}=r;if(null==n)return void __LOG__(2,void 0,void 0,void 0,["handleICDCData"])`get empty device list metadata`;if((null==e.device||e.device===o.DEFAULT_DEVICE_ID)&&null!=n.senderTimestamp&&null==n.senderKeyHash){const t=(0,s.numberOrThrowIfTooLarge)(n.senderTimestamp)+1;return void(0,g.handleADVSyncResult)(e,{deviceList:[{id:o.DEFAULT_DEVICE_ID,keyIndex:0}],keyIndex:{ts:(0,c.castToUnixTime)(t),signedKeyIndexBytes:null}},null,null)}const a=[],l=e.user===(0,_.getMeUser)().user;a.push({id:e.user,ts:n.senderTimestamp}),l&&null!=t&&a.push({id:t.user,ts:n.recipientTimestamp});const d=yield(0,u.getLastADVDeviceInfoCheckTime)(),h=yield(0,p.bulkGetDeviceRecord)(a.map((e=>e.id))),m=[];return h.forEach(((e,t)=>{const r=a[t].ts;if(null==e||e.deleted||null==r)return;const n=(0,f.computeExpectedTsForDeviceRecord)((0,s.numberOrThrowIfTooLarge)(r),e,d);n.expectedTs===e.expectedTs&&n.expectedTsLastDeviceJobTs===e.expectedTsLastDeviceJobTs&&e.expectedTsUpdateTs==e.expectedTsUpdateTs||(__LOG__(2)`handleICDCData: update expectd timestamp for ${e.id}`,m.push((0,i.default)((0,i.default)({},e),n)))})),m.length>0?(0,p.bulkCreateOrReplaceDeviceRecord)(m):void 0}))).apply(this,arguments)}},84135:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleListReset=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(8243),s=r(92844),l=r(45454),c=n(r(41143)),d=r(86945),u=r(5087),p=r(89333),f=r(52083),_=r(17041),h=r(93832);function g(){return(g=(0,i.default)((function*(e,t,r,n,i){let g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6?arguments[6]:void 0;const{rawId:y,timestamp:E,keyIndex:S}=t,v=(0,o.numberOrThrowIfTooLarge)(E),T=(0,d.getABPropConfigValue)("adv_v2_m4_m5"),C=e.device;(0,c.default)(null!=C&&C!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const A=(0,l.toUserWid)(e);let b=0;if(T&&(b=(null==i?void 0:i.timestamp)||(0,s.pastUnixTime)(((0,d.getABPropConfigValue)("num_days_key_index_list_expiration")-1)*s.DAY_SECONDS)),null!=i&&!i.deleted){if(i.timestamp>v)throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");yield(0,_.clearDeviceRecord)(A,i.devices,g)}r&&(yield(0,f.getSignalProtocolStore)().saveIdentity((0,h.createSignalAddress)(A).toString(),(0,u.toSignalCurvePubKey)(r)));const P={id:e.user,rawId:y,timestamp:b,devices:[{id:C,keyIndex:S},{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1};if(T){const e=(0,p.computeExpectedTsForDeviceRecord)(v,P,m);P.expectedTs=e.expectedTs,P.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,P.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,_.bulkApplyDeviceUpdate)([{wid:A,update:P,currentRecord:null}],g),yield(0,f.getSignalProtocolStore)().saveIdentity((0,h.createSignalAddress)(e).toString(),(0,u.toSignalCurvePubKey)(n))}))).apply(this,arguments)}},80405:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleNoListReset=function(){return g.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(8243),l=r(45454),c=n(r(41143)),d=r(86945),u=r(5087),p=r(89333),f=r(52083),_=r(17041),h=r(93832);function g(){return(g=(0,a.default)((function*(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5?arguments[5]:void 0;const{timestamp:m,keyIndex:y}=t,E=(0,s.numberOrThrowIfTooLarge)(m),S=e.device;if((0,c.default)(null!=S&&S!==o.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device"),n.timestamp>=E&&n.validIndexes&&!n.validIndexes.includes(y))throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");const v=new Map(n.devices.map((e=>[e.id,e.keyIndex])));if(!v.has(S)||v.get(S)!==y){v.set(S,y);const t=Array.from(v.entries()).map((e=>{let[t,r]=e;return{id:t,keyIndex:r}})),o=(0,i.default)((0,i.default)({},n),{},{devices:t,deleted:!1});if((0,d.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,p.computeExpectedTsForDeviceRecord)(E,o,g);o.expectedTs=e.expectedTs,o.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,o.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,_.bulkApplyDeviceUpdate)([{wid:(0,l.toUserWid)(e),update:o,currentRecord:n}],a),yield(0,f.getSignalProtocolStore)().saveIdentity((0,h.createSignalAddress)(e).toString(),(0,u.toSignalCurvePubKey)(r))}}))).apply(this,arguments)}},54678:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceUpdateForMessage=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(45454),s=n(r(41143)),l=r(9108),c=r(84135),d=r(80405),u=r(93832);function p(){return(p=(0,i.default)((function*(e,t,r,n,i){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const{rawId:_,timestamp:h,keyIndex:g}=t;(0,s.default)(null!=_,"handleADVDeviceIdentity: rawId of deviceIdentity should not be null"),(0,s.default)(null!=h,"handleADVDeviceIdentity: timestamp of deviceIdentity should not be null"),(0,s.default)(null!=g,"handleADVDeviceIdentity: keyIndex of deviceIdentity should not be null");const m={rawId:_,timestamp:h,keyIndex:g},y=e.device;(0,s.default)(null!=y&&y!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const E=(0,o.toUserWid)(e),S=yield(0,l.getDeviceRecord)(E.user),v=null==r||null!=n&&!(0,u.bufferEqual)(r,n);return!S||S.deleted||S.rawId!==_||v?(0,c.handleListReset)(e,m,v?n:null,i,S,p,f):(0,d.handleNoListReset)(e,m,i,S,p,f)}))).apply(this,arguments)}},79156:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleDeviceAddNotification=function(e,t,r,n,i,d,u){if(!d||d.deleted)return null;if(r<d.timestamp)return null;if(null==i)return null;const p=(0,c.decodeSignedKeyIndexBytes)(i,n);if(!p)return null;const f=p.rawId,_=(0,o.numberOrThrowIfTooLarge)(p.timestamp);if(_!==r)return null;let h=!1,g=null;const m=d.timestamp;d.rawId!==f?h=!0:g=d.devices;const y=new Set(p.validIndexes),E=p.currentIndex||0,S=null==g?[]:g.filter((e=>e.id!==a.DEFAULT_DEVICE_ID&&(y.has(e.keyIndex)||e.keyIndex>E)));t.forEach((e=>{const{id:t,keyIndex:r}=e;t!==a.DEFAULT_DEVICE_ID&&null!=r&&y.has(r)&&S.push({id:t,keyIndex:r})})),S.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0});const v={id:e.user,rawId:f,timestamp:m,validIndexes:Array.from(y),devices:S,currentIndex:p.currentIndex,deleted:!1};if((0,s.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,l.computeExpectedTsForDeviceRecord)(_,v,u);v.expectedTs=e.expectedTs,v.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,v.expectedTsUpdateTs=e.expectedTsUpdateTs}return{update:v,clearRecord:h}},t.handleDeviceRemoveNotification=function(e,t,r){if(null==r||r.deleted)return null;if(t<r.timestamp)return null;const n=new Map(e.map((e=>[e.id,e.keyIndex]))),o=r.devices.filter((e=>{if(e.id!==a.DEFAULT_DEVICE_ID){const t=n.get(e.id);return null==t||t!==e.keyIndex}return!1}));return o.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0}),{update:(0,i.default)((0,i.default)({},r),{},{devices:o}),clearRecord:!1}};var i=n(r(81109)),a=r(52230),o=r(8243),s=r(86945),l=r(89333),c=r(87622)},40626:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleKeyIndexResult=function(e,t,r,s,l,c,d,u){if(null!=(null==c?void 0:c.timestamp)&&r<c.timestamp)return null;if(null==l)return null;const p=(0,o.decodeSignedKeyIndexBytes)(l,s);if(!p)return null;const f=p.rawId,_=(0,i.numberOrThrowIfTooLarge)(p.timestamp);if(_!==r)return null;let h=!1,g=null,m=t;c&&!c.deleted&&(null==m&&(m=c.devices),c.rawId!==f?h=!0:g=c.devices);const y=new Map,E=new Set(p.validIndexes),S=p.currentIndex||0;m&&m.forEach((e=>{null!=e.keyIndex&&E.has(e.keyIndex)&&y.set(e.id,e.keyIndex)}));null!=g&&g.forEach((e=>{e.keyIndex>S&&y.set(e.id,e.keyIndex)}));y.set(n.DEFAULT_DEVICE_ID,0);const v=Array.from(y.entries()).map((e=>{let[t,r]=e;return{id:t,keyIndex:r}})),T={id:e.user,rawId:f,timestamp:_,validIndexes:Array.from(E),devices:v,currentIndex:p.currentIndex,deleted:!1};h||(0,a.shouldClearExpectedTs)(_,u,c,d)||c&&!c.deleted&&(T.expectedTs=c.expectedTs,T.expectedTsLastDeviceJobTs=c.expectedTsLastDeviceJobTs,T.expectedTsUpdateTs=c.expectedTsUpdateTs);return{update:T,clearRecord:h}};var n=r(52230),i=r(8243),a=r(89333),o=r(87622)},49884:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleOmittedResult=function(e,t,r,n){if(!t||t.deleted)return null;if(null!=e&&e<t.timestamp)return null;const s=(0,i.default)({},t);null!=e&&(s.timestamp=e,(0,o.shouldClearExpectedTs)(e,r,t,n)&&(s.expectedTs=void 0,s.expectedTsLastDeviceJobTs=void 0,s.expectedTsUpdateTs=void 0));return s.devices=[{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],{update:s,clearRecord:!1}};var i=n(r(81109)),a=r(52230),o=r(89333)},81864:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVSyncResult=function(e,t,r,n,a){const{deviceList:o,keyIndex:c}=t;if(null==c||null==c.signedKeyIndexBytes)return null!=o&&o.some((e=>e.id!==i.DEFAULT_DEVICE_ID))?void __LOG__(2)`processADVSyncResult: drop response with companion device but no keyIndexbytes`:(0,l.handleOmittedResult)(null==c?void 0:c.ts,n,null==c?void 0:c.expectedTs,a);const{ts:d,expectedTs:u,signedKeyIndexBytes:p}=c;return(0,s.handleKeyIndexResult)(e,o,d,p,r,n,a,u)},t.handleDeviceNotification=function(e,t,r,n,i,s){const{deviceList:l,keyIndex:c}=r;(0,a.default)(null!=l,`handleDeviceNotification: device list should not be none for device ${t} notification`),(0,a.default)(null!=c,`handleDeviceNotification: keyIndex should not be none for device ${t} notification`);const{ts:d,signedKeyIndexBytes:u}=c;if("add"===t)return(0,a.default)(null!=u,`handleDeviceNotification: signedKeyIndexBytes should not be none for device ${t} notification`),(0,o.handleDeviceAddNotification)(e,l,d,u,n,i,s);if("remove"===t)return(0,o.handleDeviceRemoveNotification)(l,c.ts,i)};var i=r(52230),a=n(r(41143)),o=r(79156),s=r(40626),l=r(49884)},87622:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeSignedKeyIndexBytes=function(e,t){let r,o;try{r=(0,n.decodeProtobuf)(i.ADVSignedKeyIndexListSpec,t)}catch(e){return null}if(!(0,a.verifyKeyIndexListAccountSignature)(r,e))return null;try{o=(0,n.decodeProtobuf)(i.ADVKeyIndexListSpec,r.details)}catch(e){return null}const{timestamp:s,rawId:l,validIndexes:c,currentIndex:d}=o;if(null==s)return null;if(null==l)return null;return{timestamp:s,rawId:l,validIndexes:c,currentIndex:d}};var n=r(84902),i=r(61438),a=r(46308)},80140:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockContact=function(e){return p((0,c.unproxy)(e),!0)},t.unblockContact=function(e){return p((0,c.unproxy)(e),!1)};var i=r(46331),a=r(30312),o=r(32826),s=r(88102),l=n(r(43725)),c=r(31019),d=r(77591),u=r(85893);function p(e,t,r){const{id:n}=e,c=e.isBlocked();if(t&&c||!t&&!c)return Promise.resolve();const f=(0,a.sendSetBlock)(t,n).then((e=>{e&&(t?o.BlocklistCollection.add({id:n}):o.BlocklistCollection.remove(n))}));return function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,i.genId)();const a={participant:e.formattedName},o=r?new i.ActionType(l.default.t(10,a)):new i.ActionType(l.default.t(132,a)),c=t.then((()=>{const t=r?l.default.t(9,a):l.default.t(131,a);return new i.ActionType(t,{actionText:l.default.t(133),actionHandler:()=>p(e,!r,n)})})).catch((t=>{if(!(t instanceof d.ServerStatusCodeError)){__LOG__(3)`action:setBlock dropped`;const t=r?l.default.t(8,a):l.default.t(130,a);throw new i.ActionType(t,{actionText:l.default.t(129),actionHandler:()=>p(e,r,n)})}if(t.statusCode>=400)throw r?new i.ActionType(l.default.t(8,a)):new i.ActionType(l.default.t(130,a))}));s.Cmd.openToast((0,u.jsx)(i.ActionToast,{id:n,initialAction:o,pendingAction:c}))}(e,f,t,r),f}},352:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onIsBusinessChange=function(e){const t=(0,i.unproxy)(e),{businessProfile:a,id:o}=t,s=t.isBusiness||t.isMe&&n.Conn.isSMB;s&&!a?t.addChild("businessProfile",r(93581).BusinessProfileCollection.gadd(o)):!s&&a&&(t.stopListening(a),t.businessProfile=void 0,a.delete())};var n=r(17239),i=r(31019)},43024:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactFindQuery=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(13042),o=r(1255),s=r(7293),l=r(76285),c=n(r(56891));function d(){return(d=(0,i.default)((function*(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=performance.now(),n={},i=yield c.default.contactFindQuery(e.retry,(e=>{n.binarySize=e.binarySize}));if("preempted"===i.data)return Promise.reject(new o.CollectionSilentQueryError("contacts preempted"));n.count=i.data.length,n.timing=Math.ceil(performance.now()-t);const d=r(19380).ContactCollection;return d.trigger(a.COLLECTION_HAS_SYNCED,n),(0,l.mungePSAContact)(i.data),i.checksum&&(d.setChecksum(i.checksum),__LOG__(2)`Store:Contact:query update checksum ${i.checksum}`),Promise.resolve(i.data)}))).apply(this,arguments)}},75888:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getOrQueryUsyncInfo=function(){return _.apply(this,arguments)},t.usyncContactCached=function(){return new a.default(u.queryPhoneExists,{maxCached:100,maxAge:36e4,shouldCache:e=>!!e})};var i=n(r(48926)),a=n(r(18569)),o=r(69951),s=r(91036),l=r(19380),c=r(7293),d=r(10435),u=r(69722),p=n(r(72639)),f=n(r(29126));function _(){return(_=(0,i.default)((function*(e){const t=l.ContactCollection.get(e);var r,n;if(null!=t&&(null!=t.name||null!=o.ChatCollection.get(e)))return Promise.resolve({wid:e,biz:t.isBusiness,bizInfo:t.isBusiness?{verifiedName:{level:(0,f.default)(t.verifiedLevel),serial:null,name:t.verifiedName,isApi:Boolean(t.isEnterprise),privacyMode:t.privacyMode}}:null,disappearingMode:(0,d.isDisappearingModeEnabled)()?{duration:null!==(r=t.disappearingModeDuration)&&void 0!==r?r:0,settingTimestamp:null!==(n=t.disappearingModeSettingTimestamp)&&void 0!==n?n:0}:null});const i=yield(0,u.queryExists)(e);if(i){const{biz:r,bizInfo:n,disappearingMode:a}=i;return c.GK.supportsFeature(c.GK.F.QUERY_VNAME)&&r&&(0,p.default)(e,n),(0,d.isDisappearingModeEnabled)()&&a&&null!=t&&(0,s.updateDisappearingMode)(e,a.duration,a.settingTimestamp),i}return Promise.reject(new Error("Invalid number"))}))).apply(this,arguments)}},84765:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryIdentity=function(e){const t=(0,a.unproxy)(e),{verificationBinary:r,verificationString:n,id:l}=t;if(r&&n)return Promise.resolve();if(t.promises.queryIdentity)return t.promises.queryIdentity;if(i.GK.supportsFeature(i.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in non-MD mode"));t.promises.queryIdentity=o.default.queryIdentity(l).then((t=>{s(e,t)})).catch((e=>{__LOG__(3)`models:contact:queryIdentity error: ${String(e)}`})).finally((()=>{t.promises.queryIdentity=null}))},t.updateIdentity=s;var i=r(7293),a=r(31019),o=n(r(56891));function s(e,t){const r=(0,a.unproxy)(e);null!=t.status&&t.status>=400?(r.unset("verificationBinary"),r.unset("verificationString")):(r.verificationBinary=t.binary,r.verificationString=t.string)}},1291:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDeviceRecordForIdentityChange=g,t.handleNewIdentity=function(){return h.apply(this,arguments)},t.handleSelfPrimaryIdentityChange=function(){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){__LOG__(4,void 0,new Error,!0)`handleNewIdentity: ignore identity change for your own primary device`,SEND_LOGS("self-identity-change");const e=r(65044).Socket,t=r(83578).LogoutReason;e.logout(!1,t.PrimaryIdentityKeyChange)}};var i=n(r(48926)),a=r(52230),o=r(72441),s=r(45454),l=r(66308),c=r(9108),d=n(r(69153)),u=r(7293),p=r(99069),f=r(58928),_=r(84356);function h(){return(h=(0,i.default)((function*(e){var t;if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND))return Promise.reject(new Error("This call is only supported in MD mode"));const n=Promise.resolve(),i=window.libsignal.SignalProtocolAddress.fromString(e).getName(),c=(0,s.createWid)((0,o.toPhoneUserJid)(i)),d=null!==(t=c.device)&&void 0!==t?t:a.DEFAULT_DEVICE_ID,p=(0,s.toUserWid)(c);if(d===a.DEFAULT_DEVICE_ID){_.Voip.notifyDeviceIdentityChangedOrDeleted(c,!0);const e=r(9701).addSecurityCodeChangedNotifications;yield g(p),yield e(p)}else yield(0,l.createAndStoreDeviceNotifications)(p,[d],[d]);return n}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!u.GK.supportsFeature(u.GK.F.MD_BACKEND))return Promise.reject(new Error("clearDeviceRecordForIdentityChange: This call is only supported in MD mode"));const n=[a.DEFAULT_DEVICE_ID],i=[a.DEFAULT_DEVICE_ID];if(t)d.default.addOfflinePendingDevice(String(e),null),yield(0,p.getStorage)().lock(["participant"],(()=>(0,f.updateGroupParticipantsInTransaction)(e,i,n)));else{const t=yield(0,c.getDeviceRecord)(e.user);t&&!t.deleted&&t.devices.forEach((e=>{e.id!==a.DEFAULT_DEVICE_ID&&n.push(e.id)}));const o=r(77605).Session;Promise.all(n.map((t=>t===a.DEFAULT_DEVICE_ID?Promise.resolve():o.deleteRemoteInfo((0,s.createDeviceWidFromUserAndDevice)(e.user,t))))),yield Promise.all([(0,p.getStorage)().lock(["participant"],(()=>(0,f.updateGroupParticipantsInTransaction)(e,i,n))),(0,c.createOrReplaceDeviceRecord)({id:e.user,deleted:!0})])}}))).apply(this,arguments)}},3879:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLiveLocation=function(e,t){const r=(0,n.unproxy)(e);r.liveLocations||(r.liveLocations=[]);const{liveLocations:i}=r;i.push(t)},t.removeLiveLocation=function(e,t){const r=(0,n.unproxy)(e),{liveLocations:i}=r;if(!i)return;for(let e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&(r.liveLocations=null)};var n=r(31019)},16150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updatePushname=function(e,t){const r=(0,i.toUserWid)(e);return s.enqueue((()=>{(0,a.getBridge)().sendAndReceive("contact_collection","updatePushname",{contactId:r,pushname:t}).then((e=>{if(e||void 0===e)return __LOG__(2)`updatePushName: set pushname for ${String(r)}`,(0,o.updateLocal)(r,{pushname:t})}))}))};var n=r(27870),i=r(45454),a=r(41796),o=r(27211);const s=new n.PromiseQueue},32613:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resyncContacts=function(e){void 0!==i.ContactCollection.checksum&&void 0!==e&&(i.ContactCollection.checksum!==e?i.ContactCollection.findQuery({retry:!0}).then((e=>{if(Array.isArray(e)){(0,l.mungePSAContact)(e),__LOG__(2)`Store:Contact:resync success`;const t=(0,s.getContactsToRemove)(e);let r=Promise.resolve();if(a.GK.supportsFeature(a.GK.F.MD_BACKEND)&&t.length){const e=t.map((e=>e.id.toString()));r=(0,o.getContactTable)().bulkRemove(e).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from contact table failed`,SEND_LOGS("bulkRemove from contact table failed when resyncing contacts"),new Error("bulkRemove from contact table failed")}))}r.then((()=>{t.forEach((e=>{e.unset("name"),e.unset("shortName")}))}))}else __LOG__(3)`Store:Contact.resync error ${JSON.stringify(e)}`})).catch((0,n.filteredCatch)(c.WebdDrop,(()=>{}))):__LOG__(2)`Store:Contact:resync checksum match`)};var n=r(50796),i=r(19380),a=r(7293),o=r(76214),s=r(88129),l=r(76285),c=r(77591)},9701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSecurityCodeChangedNotifications=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(90257),s=r(99234),l=r(7293),c=r(41796),d=r(76214),u=n(r(29783)),p=r(90641);function f(){return(f=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l.GK.supportsFeature(l.GK.F.MD_BACKEND)){const{notifications:r,chatIds:n}=yield _(e);if(0===r.length)return;if(!t){Promise.all(r.map((e=>{e.recvFresh=!0,e.isNewMsg=!0;return(0,c.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})})));const e=yield(0,p.encryptMultipleMsgs)(r);return(0,p.storeEncryptedMessage)(e,n,!1)}u.default.addOfflineMessage(r.map((e=>({msg:e}))))}}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t={notifications:[],chatIds:[]};if(!(0,s.getGlobalSecurityNotifications)())return t;let r=[];try{const t=yield(0,d.getChatTable)().get(String(e));r=(yield(0,d.getParticipantTable)().equals(["participants"],String(e))).map((e=>(0,a.createWid)(e.groupId))),t&&r.push((0,a.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chats failed")}const n=r.map((t=>(0,o.genSecurityCodeNotificationMsg)(t,e)));return t.notifications=n,t.chatIds=r.map(String),t}))).apply(this,arguments)}},76285:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mungePSAContact=function(e){if(Array.isArray(e)){const t=e.findIndex((e=>e&&i.default.isPSA(e.id))),r=e[t];t>-1&&r&&(r.name=a.default.t(1029),r.shortName=a.default.t(1029))}};var i=n(r(89867)),a=n(r(43725))},42822:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnjoinedSubgroupsToCollection=function(e,t){e.forEach((e=>{null!=e&&s.default.add({id:e.id,subject:e.subject,parentId:t},{merge:!0})}))},t.changesForParentGroupLink=function(e,t){var r;const n=o.ChatCollection.get(e.toString()),{parentGroupChanges:a,subgroupChanges:s}=c(n,t);return{parentGroupChanges:(0,i.default)((0,i.default)({},a),{},{unjoinedSubgroups:a.unjoinedSubgroups.map((e=>e.toString()))}),subgroupChanges:(0,i.default)((0,i.default)({},s),{},{parentGroup:null===(r=s.parentGroup)||void 0===r?void 0:r.toString(),unjoinedSubgroups:s.unjoinedSubgroups.map((e=>e.toString()))})}},t.changesForSubgroupLink=function(e,t){const r=l(o.ChatCollection.gadd(e),t);return(0,i.default)((0,i.default)({},r),{},{unjoinedSubgroups:r.unjoinedSubgroups.map((e=>e.toString()))})},t.getUnjoinedGroupIds=d,t.updateModelsForParentGroupLink=function(e,t){const r=o.ChatCollection.get(e.toString()),{parentGroupChanges:n,subgroupChanges:i}=c(r,t);(null==r?void 0:r.groupMetadata)&&Object.assign(r.groupMetadata,n);t.groupMetadata&&Object.assign(t.groupMetadata,i)},t.updateModelsForSubgroupLink=function(e,t){const r=e.groupMetadata,n=l(e,t);null!=r&&Object.assign(r,n)};var i=n(r(81109)),a=n(r(2883)),o=(r(63183),r(69951)),s=n(r(73213));function l(e,t){const r=e.groupMetadata,n=d(t);return{unjoinedSubgroups:(i=null==r?void 0:r.unjoinedSubgroups,o=n,(0,a.default)(null!=i?i:[],null!=o?o:[],((e,t)=>e.equals(t)))),isParentGroup:!0,parentGroup:void 0};var i,o}function c(e,t){var r;const n={parentGroup:null==e?void 0:e.id,isParentGroup:!1,unjoinedSubgroups:[]},i={};return null!=(null==e||null===(r=e.groupMetadata)||void 0===r?void 0:r.unjoinedSubgroups)&&(i.unjoinedSubgroups=e.groupMetadata.unjoinedSubgroups.filter((e=>e!==t))),{parentGroupChanges:i,subgroupChanges:n}}function d(e){return e.filter((e=>{var t;const r=o.ChatCollection.get(e.toString());return null==r||!(null===(t=r.groupMetadata)||void 0===t?void 0:t.participants.iAmMember())}))}},56489:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;return S(e,t,r,n,void 0,i,a)},t.sendForNeededAddRequest=v;var i=n(r(81109)),a=r(50796),o=r(87614),s=r(45454),l=r(48360),c=r(46331),d=r(88102),u=r(19380),p=r(79583),f=r(50101),_=r(7293),h=n(r(43725)),g=r(3764),m=r(82039),y=r(77591),E=r(85893);function S(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,c.genId)(),s=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;const _=n.map((e=>e.id)),T=void 0,C=(0,p.sendCreateGroup)(e,_,T,(0,o.randomHex)(8),!1,!1,s,u),A=new c.ActionType(h.default.t(51)),b=C.then((t=>(v(t,e,T),new c.ActionType(h.default.t(50))))).catch((0,a.filteredCatch)(y.ServerStatusCodeError,(e=>406===e.status?new c.ActionType(h.default.t(47)+" "+h.default.t(48)):429===e.status?new c.ActionType(h.default.t(47)+" "+l.fbt._("You've created too many groups too quickly. Try again later.",null,{hk:"2fN2Us"}).toString()):void 0))).catch((()=>(__LOG__(3)`models:chatCollection:createGroup dropped`,new c.ActionType(h.default.t(47),{actionText:h.default.t(129),actionHandler:()=>S(e,t,r,n,i,s)}))));return d.Cmd.openToast((0,E.jsx)(c.ActionToast,{id:i,initialAction:A,pendingAction:b})),C.then((e=>{if(null==u&&e.gid&&(0,f.findChat)(e.gid).then((e=>{d.Cmd.openChatBottom(e).then((t=>{t&&d.Cmd.focusChatTextInput(e)}))})),!e._duplicate&&t&&r){const n=m.ProfilePicThumbCollection.gadd(e.gid);return(0,g.setProfilePic)(n,t,r).then((()=>e.gid))}return e._duplicate&&__LOG__(3)`createGroup failed to set picture.`,e.gid})).catch((0,a.filteredCatch)(y.ServerStatusCodeError,(()=>{})))}function v(e,t,r,n){if(!_.GK.supportsFeature(_.GK.F.GROUPS_V_4_JOIN_PERMISSION))return;if(!e.participants)return;const a=n||e.gid;a||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Group add request was provided with undefined gid"));const o=e.participants.reduce(((e,t)=>{const r=Object.keys(t)[0];if("403"!==t[r].code)return e;const n=(0,s.createWid)(r),a=u.ContactCollection.gadd(n,{silent:!0});return[...e,(0,i.default)((0,i.default)({},t[r]),{},{contact:a})]}),[]);o.length>0&&a&&d.Cmd.openGroupV4InviteRequestFlow(o,a,t,r)}},5501:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.localExitGroup=g,t.sendExitGroup=function(e){return h((0,u.unproxy)(e))};var i=r(50796),a=r(46331),o=r(88102),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(90447),c=r(99234),d=n(r(43725)),u=r(31019),p=r(77591),f=r(85893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}function h(e){const{isGroup:t,promises:r}=e;if(!t)return Promise.reject(new s.ActionError);if(r.sendExit)return r.sendExit;const n=r.sendExit=(0,l.sendExitGroup)(e.id),c=new a.ActionType(d.default.t(57)),u=n.then((function(){return new a.ActionType(d.default.t(56))})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(e=>{if(e.status>=400)return new a.ActionType(d.default.t(55))}))).catch((function(){return __LOG__(3)`actions:chat:sendExit dropped`,new a.ActionType(d.default.t(55),{actionText:d.default.t(129),actionHandler:()=>h(e)})}));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:(0,a.genId)(),initialAction:c,pendingAction:u})),n.then((t=>{t._duplicate||g(e)})).finally((()=>{r.sendExit=null})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(()=>{})))}function g(e){var t;e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.participants.remove((0,c.getMaybeMeUser)()),(0,l.markExited)(e.id).then((()=>{e.isReadOnly=!0})).catch((e=>{throw __LOG__(4,!0,new Error,!0)`failed to merge chat table`,SEND_LOGS("failed to merge chat table when exiting group: "+e),new Error("failed to merge chat table")})))}},36098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_ACTIONS=void 0;const r=Object.freeze({SUBJECT:"subject",ADD:"add",PROMOTE:"promote",DEMOTE:"demote",REMOVE:"remove",MODIFY:"modify",INVITE_CODE:"invite",DESC_ADD:"desc_add",DESC_REMOVE:"desc_remove",RESTRICT:"restrict",ANNOUNCE:"announce",NO_FORWARD:"no_frequently_forwarded",EPHEMERAL:"ephemeral",REVOKE_INVITE:"revoke_invite",SUSPEND:"suspend",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",SUB_GROUP_LINK:"sub_group_link",PARENT_GROUP_LINK:"parent_group_link",SIBLING_GROUP_LINK:"sibling_group_link"});t.GROUP_ACTIONS=r},42952:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupAction=function(e,t,r){return function(e,t,r){const n=(0,i.default)(e.groupMetadata,"chat.groupMetadata"),{action:c}=r;switch(r.action){case s.GROUP_ACTIONS.SUBJECT:const i={name:r.subject};e.contact.set(i);break;case s.GROUP_ACTIONS.ADD:case s.GROUP_ACTIONS.PROMOTE:case s.GROUP_ACTIONS.DEMOTE:const d=r.participants.map((e=>({id:e,isAdmin:"promote"===c})));n.participants.add(d,{merge:!0}),"add"===c&&(r.participants.forEach((t=>{l.default.trigger(`group_participant_change_${t.toString()}`,e.id)})),t&&!o.ContactCollection.get(t)&&n.set({notAddedByContact:!0,addedBy:t}));break;case s.GROUP_ACTIONS.REMOVE:r.participants.forEach((e=>{n.participants.remove(e)})),r.participants.forEach((t=>{l.default.trigger(`group_participant_change_${t.toString()}`,e.id)}));break;case s.GROUP_ACTIONS.MODIFY:if(t&&r.participants&&r.participants.length>0){const e=r.participants[0],i=n.participants.remove(t);let a=!1,o=!1;i.length&&i[0]&&(a=i[0].isAdmin,o=i[0].isSuperAdmin);const s={id:e,isAdmin:a,isSuperAdmin:o};n.participants.add(s)}break;case s.GROUP_ACTIONS.INVITE_CODE:r.code?n.inviteCode=r.code:__LOG__(3)`model:chat:handleGroupAction:invalid invite code: ${r.code} for ${e.id.toString()}`;break;case s.GROUP_ACTIONS.DESC_ADD:n.set({desc:r.desc,descId:r.descId,descTime:r.descTime,descOwner:null==t?void 0:t.toString()});break;case s.GROUP_ACTIONS.DESC_REMOVE:if(n.descId===r.descId){n.set({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0});break}break;case s.GROUP_ACTIONS.RESTRICT:n.restrict=!!r.value;break;case s.GROUP_ACTIONS.SUSPEND:n.suspended=!!r.value;break;case s.GROUP_ACTIONS.ANNOUNCE:n.announce=!!r.value;break;case s.GROUP_ACTIONS.NO_FORWARD:n.noFrequentlyForwarded=!!r.value;break;case s.GROUP_ACTIONS.EPHEMERAL:n.ephemeralDuration=r.duration;break;case s.GROUP_ACTIONS.REVOKE_INVITE:break;case s.GROUP_ACTIONS.GROWTH_UNLOCKED:n.growthLockExpiration=void 0,n.growthLockType=void 0;break;case s.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===r.type&&(n.growthLockExpiration=r.expiration,n.growthLockType=r.type);break;case s.GROUP_ACTIONS.PARENT_GROUP_LINK:(0,a.updateModelsForParentGroupLink)(r.groups[0],e);break;case s.GROUP_ACTIONS.SUB_GROUP_LINK:(0,a.updateModelsForSubgroupLink)(e,r.groups);break;case s.GROUP_ACTIONS.SIBLING_GROUP_LINK:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupAction`}return Promise.resolve()}((0,c.unproxy)(e),t,r)};var i=n(r(45095)),a=r(42822),o=r(19380),s=r(36098),l=n(r(63928)),c=r(31019)},34648:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupActionMD=function(e,t,r){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return function(){return I.apply(this,arguments)}(e,t,r);return Promise.reject(new Error("handleGroupActionMD: only supported on MD"))},t.handleGroupActionWap=function(e,t){const{chatId:n,author:i}=e,a=r(69951).ChatCollection.get(n);if(!a)return void __LOG__(3)`model:chat: unknown chat for ${n.toString()}, action ${JSON.stringify(t)}`;(0,y.handleGroupAction)(a,i,t)},t.handleGroupCreation=function(e,t,r){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))return function(){return M.apply(this,arguments)}(e,t,r);return Promise.reject(new Error("handleGroupCreation: should not be called in wap mode"))};var i=n(r(48926)),a=r(50796),o=n(r(45095)),s=r(19380),l=r(91829),c=r(57062),d=r(76581),u=r(99234),p=r(9025),f=r(7293),_=r(57701),h=r(62415),g=r(90101),m=r(36098),y=r(42952),E=r(84886),S=n(r(11339)),v=r(59871),T=r(70405),C=r(80474),A=r(16150),b=r(10790),P=r(92188);function M(){return(M=(0,i.default)((function*(e,t,r){var n,i,a;__LOG__(2,void 0,void 0,void 0,["groups"])`inside handleGroupCreationMD`;const{chatId:o,author:d,pushname:f}=e;null!=e.author&&e.author.equals((0,u.getMaybeMeUser)())||new S.default.GroupJoinC({}).commit(),d&&f&&(0,A.updatePushname)(d,f),yield Promise.all([(0,C.updateParticipantsJob)(t.id,t.participants,t.pvId,r),(0,c.updateGroupMetadataTableJob)([t])]),__LOG__(2,void 0,void 0,void 0,["groups"])`updated GroupMetadata and participants tables`;let h=yield(0,p.getExisting)(o);if(h){var g;(0,b.updateSubject)(o,t.subject),null===(g=h.groupMetadata)||void 0===g||g.set(t)}else{var m;h=yield(0,l.create)(o,{t:t.creation,pendingInitialLoading:!1,createdLocally:!1}),null===(m=h.groupMetadata)||void 0===m||m.set(t),__LOG__(2,void 0,void 0,void 0,["groups"])`updated chat model and table`;s.ContactCollection.gadd(t.id).set({name:t.subject}),__LOG__(2,void 0,void 0,void 0,["groups"])`updated contact name`}const y=(null!==(n=null===(i=h.groupMetadata)||void 0===i?void 0:i.participants)&&void 0!==n?n:[]).length,E=null===(a=h.groupMetadata)||void 0===a?void 0:a.announce;!r&&!E&&y&&(0,_.sendKeyDistributionMsgToNewGroups)()&&y>=(0,_.sendKeyDistributionMsgMinGroupSize)()&&(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message`,(0,P.sendKeyDistributionMsg)(h).then((()=>{__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message: done`})).catch((e=>{__LOG__(3,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message failed: ${e}`})))}))).apply(this,arguments)}function O(e,t){return t?(0,c.markGroupAsDirtyJob)(e):(0,b.sendQueryGroup)(e)}function I(){return(I=(0,i.default)((function*(e,t,n){var i,l,p;__LOG__(2,void 0,void 0,void 0,["groups"])`inside _handleGroupActionMD`;const{chatId:f,author:_,pushname:S}=e;_&&S&&(0,A.updatePushname)(_,S);const b=[],P=r(69951).ChatCollection.get(f);switch(t.action){case m.GROUP_ACTIONS.ADD:_&&!s.ContactCollection.get(_)&&b.push((0,g.persistGroupMetadata)(f,{notAddedByContact:!0,addedBy:_.toString()})),b.push((0,C.addParticipantsJob)(f,t.participants,t.version,t.prevVersion,n).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`addParticipants: out-of-sync group notification`,O(f,n)}))));break;case m.GROUP_ACTIONS.REMOVE:b.push((0,C.removeParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,n)}))));const e=(0,u.getMaybeMeUser)();e&&t.participants.find((t=>t.equals(e)))&&(0,u.removeUserSentMessageToChat)(f);break;case m.GROUP_ACTIONS.DEMOTE:b.push((0,C.demoteParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,n)}))));break;case m.GROUP_ACTIONS.PROMOTE:b.push((0,C.promoteParticipantsJob)(f,t.participants,t.version,t.prevVersion).catch((0,a.filteredCatch)(T.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,O(f,n)}))));break;case m.GROUP_ACTIONS.REVOKE_INVITE:const y=null===(i=(0,u.getMaybeMeUser)())||void 0===i?void 0:i.toString();if(!y)return void __LOG__(3)`getMaybeMeUser returned null, can't process action ${t}`;const S=null==_?void 0:_.toString();let A=[];if(null==S)return void __LOG__(3)`Received revoke without an admin jid ${t}`;if(S===y)A=t.participants.map((e=>({from:y,to:e.id.toString(),groupId:f.toString(),expiration:e.expiration})));else{const e=t.participants.find((e=>e.id.toString()===y));if(!e)return __LOG__(4,void 0,new Error,!0)`Received group invite revokation from ${S}, but user not in participants list`,void SEND_LOGS("bad-revoke");A=[{from:S,to:y,groupId:f.toString(),expiration:e.expiration}]}const P=yield Promise.all(A.map((e=>(0,h.revokeGroupInvites)(e.from,e.to,e.groupId,e.expiration)))),M=[];P.flat().map((e=>{(null==e?void 0:e.id)&&M.push(e.id)})),(yield(0,d.msgFindByIds)(M)).map((e=>{var t;null===(t=v.MsgCollection.get(e.id))||void 0===t||t.set({inviteCodeExp:"0"}),e.inviteCodeExp="0",(0,E.updateExistingMessages)([e],e.id.remote)}));break;case m.GROUP_ACTIONS.MODIFY:if(1!==t.participants.length){__LOG__(3)`_handleGroupActionMD: participants length should be 1, but is ${t.participants.length}`;break}b.push((0,c.modifyGroupParticipantJob)(f,(0,o.default)(_,"author"),t.participants[0],null!==(l=t.prevVersion)&&void 0!==l?l:-1,null!==(p=t.version)&&void 0!==p?p:-1));break;case m.GROUP_ACTIONS.SUBJECT:b.push((0,g.persistGroupMetadata)(f,{subject:t.subject}));break;case m.GROUP_ACTIONS.DESC_ADD:b.push((0,g.persistGroupMetadata)(f,{desc:t.desc,descId:t.descId,descTime:t.descTime,descOwner:null==_?void 0:_.toString()}));break;case m.GROUP_ACTIONS.DESC_REMOVE:b.push((0,g.persistGroupMetadata)(f,{desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0}));break;case m.GROUP_ACTIONS.RESTRICT:b.push((0,g.persistGroupMetadata)(f,{restrict:!!t.value}));break;case m.GROUP_ACTIONS.SUSPEND:b.push((0,g.persistGroupMetadata)(f,{suspended:!!t.value}));break;case m.GROUP_ACTIONS.ANNOUNCE:b.push((0,g.persistGroupMetadata)(f,{announce:!!t.value}));break;case m.GROUP_ACTIONS.NO_FORWARD:b.push((0,g.persistGroupMetadata)(f,{noFrequentlyForwarded:!!t.value}));break;case m.GROUP_ACTIONS.EPHEMERAL:b.push((0,g.persistGroupMetadata)(f,{ephemeralDuration:t.duration}));break;case m.GROUP_ACTIONS.INVITE_CODE:break;case m.GROUP_ACTIONS.GROWTH_UNLOCKED:b.push((0,g.persistGroupMetadata)(f,{growthLockExpiration:void 0,growthLockType:void 0}));break;case m.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===t.type&&b.push((0,g.persistGroupMetadata)(f,{growthLockExpiration:t.expiration,growthLockType:t.type}));break;case m.GROUP_ACTIONS.PARENT_GROUP_LINK:const I=t.groups[0],{parentGroupChanges:w,subgroupChanges:R}=r(42822).changesForParentGroupLink(I,f);b.push((0,g.persistGroupMetadata)(f,R)),b.push((0,g.persistGroupMetadata)(I,w));break;case m.GROUP_ACTIONS.SUB_GROUP_LINK:b.push((0,g.persistGroupMetadata)(f,r(42822).changesForSubgroupLink(f,t.groups)));break;case m.GROUP_ACTIONS.SIBLING_GROUP_LINK:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupActionMD for action ${JSON.stringify(t)}`}yield Promise.all(b),__LOG__(2,void 0,void 0,void 0,["groups"])`finished all storageTasks`,P&&(0,y.handleGroupAction)(P,_,t)}))).apply(this,arguments)}},48537:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(e,t,r,n){return(0,c.sendJoinGroupViaInviteV4)(e,t,r,n)},t.queryGroupInviteV4Info=function(){return d.apply(this,arguments)},t.revokeGroupInviteV4=function(e,t){return(0,c.sendRevokeGroupInviteV4)(e,t)};var i=n(r(48926)),a=r(45454),o=r(69951),s=r(19380),l=r(53686),c=r(64808);function d(){return(d=(0,i.default)((function*(e,t,n,i){let d=null;const u=r(63928).default.get(n);return u&&(d=yield(0,l.phashV1)(u.participants.map((e=>e.id)))),(0,c.sendQueryGroupInviteV4)(e,t,n,i,d).then((e=>{if(null!=e.status&&e.status>0)return e;if(null!=e.id)return s.ContactCollection.gadd(e.id),e;const t=r(63928).default.assertGet((0,a.createWidFromWidLike)(n)),i=o.ChatCollection.assertGet(t.id).contact.name;return{id:t.id,owner:t.owner,creation:t.creation,desc:t.desc,descId:t.descId,descOwner:t.descOwner,descTime:t.descTime,restrict:t.restrict,announce:t.announce,ephemeralDuration:t.ephemeralDuration,growthLockExpiration:t.growthLockExpiration,growthLockType:t.growthLockType,noFrequentlyForwarded:t.noFrequentlyForwarded,subject:i,participants:t.participants.map((e=>({id:e.id,isAdmin:e.isAdmin,isSuperAdmin:e.isSuperAdmin})))}}))}))).apply(this,arguments)}},96269:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupFromPhone=function(){return u.apply(this,arguments)},t.queryGroupInviteInfo=function(){return p.apply(this,arguments)};var i=n(r(6479)),a=n(r(48926)),o=n(r(81629)),s=r(19380),l=n(r(14423)),c=r(10790);const d=["status","subject"];function u(){return(u=(0,a.default)((function*(e){const t=yield(0,c.groupMetadataFindFromPhone)(e);return"ok"===t.status?t.data:"missing"!==t.status?"error"===t.status?(__LOG__(3)`model:GroupMetadata:find error ${t.info}`,Promise.reject(new Error("model:GroupMetadata:find error"))):void 0:void(0,o.default)((()=>{r(69951).ChatCollection.assertGet(e).delete()}))}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){const t=yield(0,c.sendQueryGroupInvite)(e),{status:n,subject:a}=t,o=(0,i.default)(t,d),u=new l.default(o);s.ContactCollection.gadd(u.id);const p=r(69951).ChatCollection.get(u.id);return{status:n,subject:a,groupMetadata:u,inGroup:!!p&&!p.isReadOnly}}))).apply(this,arguments)}},74028:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateGroupMetadataModel=E,t.queryAndUpdateAllGroupMetadata=function(){return g.apply(this,arguments)},t.queryAndUpdateGroupMetadataById=function(e){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,h.queryGroupJob)(e).then(function(){var e=(0,i.default)((function*(e){yield(0,o.updateGroupParticipantTableWithoutDeviceSyncJob)([e]),E(e)}));return function(){return e.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(48926)),a=r(22683),o=r(57062),s=r(7293),l=r(37654),c=n(r(63928)),d=r(50313),u=r(5819),p=r(53686),f=r(85057),_=r(10790),h=r(61051);function g(){return(g=(0,i.default)((function*(){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const e=yield(0,f.queryAllGroups)();if(!e)return;e.forEach((e=>{E(e),m(e)})),yield(0,o.updateGroupMetadataTableJob)(e),yield(0,o.updateGroupParticipantTableWithoutDeviceSyncJob)(e)}return Promise.resolve()}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=(0,d.getInitialGroupPhash)(e.id.toString()),r=yield(0,p.phashV1)(e.participants.map((e=>e.id))),n=r.substring(2);t!==r&&t!==n&&(0,u.handleSingleMsgMD)(e.id,(0,l.genIntialPhashMismatchMsg)(e.id,a.Clock.globalUnixTime()))}))).apply(this,arguments)}function E(e){var t,r,n,i,a;(0,_.updateSubject)(e.id,e.subject),c.default.gadd({id:e.id,owner:e.owner,creation:e.creation,desc:e.desc,descId:e.descId,descOwner:e.descOwner,descTime:e.descTime,restrict:e.restrict||!1,announce:e.announce||!1,noFrequentlyForwarded:e.noFrequentlyForwarded||!1,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,participants:e.participants,support:null!==(t=e.support)&&void 0!==t&&t,unjoinedSubgroups:null!==(r=e.unjoinedSubgroups)&&void 0!==r?r:[],suspended:null!==(n=e.suspended)&&void 0!==n&&n,isParentGroup:null!==(i=e.parent)&&void 0!==i&&i,parentGroup:e.parentGroup,defaultSubgroup:null!==(a=e.defaultSubgroup)&&void 0!==a&&a})}},54248:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(0,n.getMaybeMeUser)().equals(e.id)){const r=i.PresenceCollection.get(e.id);r&&("unsubscribe"===e.type?r.set({isSubscribed:!1,stale:!0}):(a(r,e),t&&r.set({stale:!1})))}return Promise.resolve()};var n=r(99234),i=r(68315);function a(e,t){let r,n=!1;if(void 0===t.type?t.type=e.chatstate.type||"unavailable":"paused"===t.type&&(n=!0,t.type="available"),e.isGroup&&"available"!==t.type&&(t.updateTime=Date.now()),e.isGroup){if(!t.participant)return;t.id=t.participant,t.participant=void 0,r=e.chatstates.gadd(t.id)}else r=e.chatstate;n&&"composing"!==r.type&&"recording"!==r.type||r.set(t),r.expireTimerId&&clearTimeout(r.expireTimerId),"composing"===r.type||"recording"===r.type?r.expireTimerId=setTimeout((()=>function(e){const t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}(r)),25e3):r.expireTimerId=void 0;const i=e.forceDisplay||e.isOnline||e.isUser&&!e.chatstate.deny;e.set({hasData:!0,isSubscribed:!0,forceDisplay:i})}},37638:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeProfilePicThumb=function(e,t){return n.ProfilePicThumbCollection.imageChanged(e,t),Promise.resolve()};var n=r(82039)},78027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphanAck=function(){return g.apply(this,arguments)},t.updateMsgAck=_;var i=n(r(48926)),a=r(35470),o=n(r(89867)),s=r(45454),l=r(25680),c=r(7293),d=r(41796),u=r(39354),p=r(59871),f=n(r(83147));function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,r){const{ack:n,t:i,from:l,to:p}=r,{remote:_,id:h}=e.id;if(e.updateAck(n,i),c.GK.supportsFeature(c.GK.F.MD_BACKEND)){const{deliveryPrivacyMode:t}=r;n===a.ACK.RECEIVED&&null!=t&&e.isSentByMe&&(yield(0,u.handlePrivacyModeTransition)(_,t).catch((()=>{__LOG__(4,void 0,new Error,!0)`msg ack: handlePrivacyModeTransition failed`,SEND_LOGS("msg ack: handlePrivacyModeTransition failed")})),yield(0,f.default)(e,t))}const g=(0,d.getBridge)();if(yield g.sendAndReceive("msg_collection","updateLastReceipt",{wid:_,t:i}),o.default.isUser(_)){if(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:h,from:l,to:p,ack:n,participant:_,t:i}),t&&o.default.isBroadcast(t)){const e=t instanceof o.default?t:(0,s.createWid)(t);yield g.sendAndReceive("msg_info_collection","updateInfo",{id:h,from:l,to:e,ack:n,participant:_,t:i})}}else o.default.isStatusV3(_)&&(yield g.sendAndReceive("msg_info_collection","updateInfo",{id:h,from:l,to:_,ack:n,participant:p,t:i}))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const r=p.MsgCollection.get(e);if(!r)return Promise.reject(new Error(`processOrphanAck: no msg found for id ${e.toString()}`));try{const e=yield(0,l.getHighestAck)(r);if(!e||e.ack===r.ack)return;return _(r,t,e)}catch(e){__LOG__(4,void 0,new Error)`Assertion failed: processOrphanAck failed!`}}))).apply(this,arguments)}},8765:(e,t,r)=>{"use strict";var n=r(95318);t.o0=function(){return T.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(92844),s=r(15461),l=n(r(89867)),c=r(84902),d=r(24808),u=r(99234),p=r(57701),f=r(49714),_=r(45033),h=r(76332),g=r(99069),m=r(93832),y=r(12896);function E(e){let t;const r=e.id.remote,n={externalId:e.id.id,ts:(0,o.castToUnixTime)(e.t),edit:-1,isHsm:!1,count:null,chat:r,pushname:null};var i;l.default.isGroup(r)?t=(0,a.default)((0,a.default)({},n),{},{type:f.MESSAGE_TYPE.GROUP,author:null!==(i=e.author)&&void 0!==i?i:(0,u.getMeUser)(),isDirect:!1}):t=(0,a.default)((0,a.default)({},n),{},{author:e.from,type:f.MESSAGE_TYPE.CHAT});return{msgInfo:t,e2eInfoType:_.CiphertextType.Msg,paymentInfo:null,bizInfo:{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null}}}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){try{const t=(0,y.hydrateMessage)(e),n=t.id.remote;if(!(0,p.receiveReactionsEnabled)())return null;if(!l.default.isGroup(n)&&!l.default.isUser(n))return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: Reaction FutureProof msg.chat is an unexpected type`,null;const{msgInfo:i,e2eInfoType:a,paymentInfo:o,bizInfo:u}=E(t);if(null==t.futureproofBuffer)return null;const f=(0,m.unpad)(t.futureproofBuffer),_=(0,c.decodeProtobuf)(d.MessageSpec,f),h=r(27286).parseMessage,g=yield h(i,a,_,o,u,t.futureproofBuffer);if(null==g.renderableMsgs||null==g.renderableMsgs[0]||g.renderableMsgs[0].type!==s.MSG_TYPE.REACTION)return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: unexpected renderableMsgs`,null;const S=r(53348).createReactionsRow;return yield S(g.renderableMsgs[0],i)}catch(e){return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: reparse error`,null}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){try{let t=[];const n=e.filter((e=>e.type===s.MSG_TYPE.UNKNOWN&&e.subtype===s.MSG_TYPE.REACTION)),a=(yield Promise.all(n.map((e=>S(e))))).filter(Boolean);if(0===a.length)return;const o=a.map((e=>e.msgKey));yield(0,g.getStorage)().lock(["message","reactions"],function(){var e=(0,i.default)((function*(e){let[r,n]=e;t=yield(0,h.addOrUpdateReactionsDBBulk)(a),yield r.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()),t.forEach((e=>{(0,h.addOrUpdateReactionsModelCollection)(e,!1)})),o.forEach((e=>{const t=r(59871).MsgCollection.get(e);null==t||t.delete()}))}catch(e){__LOG__(4,void 0,new Error)`reparseReactionFutureProof: storeReactionsAndDeleteFP error`}}))).apply(this,arguments)}},39354:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePrivacyModeTransition=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(93170),o=n(r(9762)),s=r(68708);function l(){return(l=(0,i.default)((function*(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.isUserNotPSA())return;let l=n;if(null==l){const t=r(9025).getExisting;l=yield t(e)}if(null==l)return;const c=l.contact;if(null!=c.privacyMode&&c.privacyMode.privacyModeTs>=t.privacyModeTs)return;const d={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:c.isBusiness,isEnterprise:c.isEnterprise,privacyMode:c.privacyMode},u={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:!0,isEnterprise:!0,privacyMode:t};c.set({isBusiness:!0,isEnterprise:!0,privacyMode:t}),yield Promise.all([i?null:(0,s.createOrUpdateVerifiedBusinessName)({id:c.id.user,isApi:!0,privacyMode:{actualActors:t.actualActors,hostStorage:t.hostStorage,privacyModeTs:t.privacyModeTs}},s.VerifiedBusinessNameUpdateType.Merge),(0,o.default)(c.id,d,u)])}))).apply(this,arguments)}},35288:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeHandlerAction=void 0;const n=r(76672).Mirrored(["DropMessage","SkipUI"]);t.ActiveRangeHandlerAction=n},91525:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActiveRangeHandlerAction",{enumerable:!0,get:function(){return f.ActiveRangeHandlerAction}}),Object.defineProperty(t,"RangeContain",{enumerable:!0,get:function(){return u.RangeContain}}),t.handleForActiveMessageRange=C,t.handleOfflineForMessageRange=function(){return b.apply(this,arguments)};var i=n(r(48926)),a=r(381),o=r(15461),s=r(45454),l=r(84902),c=r(69702),d=r(38342),u=r(87845),p=n(r(73407)),f=r(35288),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=g(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(13332)),h=r(93824);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(g=function(e){return e?r:t})(e)}const m=new Set,y=e=>e.reduce(((e,t)=>new Set([...Array.from(e),...Array.from(t)])),new Set);function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r){let n=null;switch(e.action){case c.ActiveRangeAction.Archive:return e.actionValue.archived?yield _.handleForArchive(e,r):yield _.handleForUnarchive(e,r),m;case c.ActiveRangeAction.MarkChatAsRead:return yield _.handleForMarkAsReadUnread(e,r,!!e.actionValue.read),m;case c.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case c.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return n=_.handleForClearChat(e,r),n?new Set([n]):m;case c.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case c.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return(yield v(t.id))?m:(n=_.handleForClearChat(e,r),n?new Set([n]):m);case c.ActiveRangeAction.DeleteChatDeleteMedia:case c.ActiveRangeAction.DeleteChatKeepMedia:return n=_.handleForDeleteChat(e,r),n?new Set([n]):m}return __LOG__(3)`handleMessageContainment called with unknwon message range action action: ${e.action}`,m}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=(0,h.constructStarMsgKeyFromMsgKey)(e),r=yield p.default.getSyncAction(t);if(r){var n;return(null===(n=(0,l.decodeProtobuf)(a.SyncActionValueSpec,r.binarySyncAction).starAction)||void 0===n?void 0:n.starred)||!1}return!1}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t){if(o.SYSTEM_MESSAGE_TYPES.includes(t.type))return m;const r=(yield(0,d.getActiveMessageRanges)(e.toString())).map((e=>[e,(0,u.rangeContainsMessage)(e.actionValue.messageRange,t)])),n=r.filter((e=>{let[,t]=e;return t===u.RangeContain.CONTAINS_BY_ADDITIONAL})).map((e=>{let[t]=e;return t}));n.forEach((e=>{e.remainingMessages--})),yield(0,d.bulkUpdateActiveMessageRanges)(n);const i=r.map((e=>{let[r,n]=e;return E(r,t,n)})),a=yield Promise.all(i);return y(a)}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{if(o.SYSTEM_MESSAGE_TYPES.includes(e.type))return;const r=t.get(e.id.remote.toString());(null==r||r.t<e.t)&&t.set(e.id.remote.toString(),e)})),yield Promise.all(Array.from(t.entries()).map((e=>{let[t,r]=e;return C((0,s.createWid)(t),r)})))}))).apply(this,arguments)}},13332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForArchive=function(){return u.apply(this,arguments)},t.handleForClearChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return l.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForDeleteChat=function(e,t){switch(t){case s.RangeContain.CONTAINS_BY_TIMESTAMP:case s.RangeContain.CONTAINS_BY_ADDITIONAL:return l.ActiveRangeHandlerAction.DropMessage;case s.RangeContain.DOES_NOT_CONTAIN:}},t.handleForMarkAsReadUnread=function(){return f.apply(this,arguments)},t.handleForUnarchive=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(38342),s=r(87845),l=r(35288),c=r(57701),d=n(r(68132));function u(){return(u=(0,i.default)((function*(e,t){if(t===s.RangeContain.DOES_NOT_CONTAIN){const t=r(74362).default;(0,c.archiveV2Supported)()&&d.default.showArchiveV2||t.setArchive([{id:e.chatId,archive:!1}]),yield(0,o.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){t!==s.RangeContain.DOES_NOT_CONTAIN&&0!==e.remainingMessages||(yield(0,o.removeActiveMessageRange)(e.chatId,e.action))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,n){if(t===s.RangeContain.DOES_NOT_CONTAIN)yield(0,o.removeActiveMessageRange)(e.chatId,e.action);else if(0===e.remainingMessages){const t=r(69951).ChatCollection.get((0,a.createWid)(e.chatId));if(t){const e=r(9609);n?e.markSeen(t):e.markUnseen(t)}yield(0,o.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}},5819:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleInitialSyncMsgs=function(e){const t={add:"last",isHistory:!0},n=Object.keys(e).map((r=>(0,f.getBridge)().sendAndReceive("msg_collection","processMultipleMessages",{chatId:(0,d.createWid)(r),msgObjs:e[r].msgs,meta:t,chatMsgsCollection:null})));return Promise.all([...n,(0,g.storeInitialSyncMessages)(e)]).then((()=>{const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].msgs.map((e=>e.id.toString())))));return(0,y.checkOrphanMutations)(t,Object.keys(e))})).then((()=>{if((0,p.parseWMIReaction)()){const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].reactionMessages)));return(0,r(53348).storeReactionMsgBulk)(t)}})).then((()=>{})).catch((0,a.filteredCatch)(A.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleMsgsMD=function(e,t){const r=t.length;if(!r)return Promise.resolve();if(!(e instanceof c.default))return Promise.resolve();const n={add:"before",isHistory:!0};for(let e=0;e<r;e++){t[e].invis=!0}const i=(0,f.getBridge)();return i.fireAndForget("msg_collection","trigger",{name:"handle:msg_history",args:{count:t.length}}),(0,g.storeMessages)(t,e,!0).then((()=>{const r=t.map((e=>e.id.toString()));(0,y.checkOrphanMutations)(r,[e.toString()]),(0,p.receiveReactionsEnabled)()&&(0,T.checkUpdateForOrphanReactions)(r)})).then((()=>i.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:t,meta:n,chatMsgsCollection:null}))).catch((0,a.filteredCatch)(A.LogoutDrop,(()=>{}))).catch((t=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${r} Chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleProgressiveHistorySyncMsgs=function(){return M.apply(this,arguments)},t.handleSingleMsgMD=function(){return P.apply(this,arguments)};var i=n(r(48926)),a=r(50796),o=r(13959),s=r(4352),l=r(15461),c=n(r(89867)),d=r(45454),u=r(22683),p=r(57701),f=r(41796),_=r(62415),h=r(91525),g=r(84886),m=r(63728),y=r(12600),E=r(49831),S=r(6684),v=r(90641),T=r(76332),C=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=b(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),A=r(77591);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(b=function(e){return e?r:t})(e)}function P(){return(P=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const d={add:"after",update:n,isHistory:!1},b=(0,f.getBridge)(),P=t.type===l.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(t.subtype);let M=t;if(!P){const e=yield(0,E.applyOrphanRevoke)([M]);if(0===e.length)return;M=e[0]}const O=yield(0,h.handleForActiveMessageRange)(e,M);if(O.has(h.ActiveRangeHandlerAction.DropMessage))return;const I=O.has(h.ActiveRangeHandlerAction.SkipUI);try{c.default.isStatusV3(e)&&(yield b.sendAndReceive("status_v3_collection","handleUpdate",{rawMsg:M,checksum:null,isMsgUpdate:!1})),yield(0,s.promiseLoop)(function(){var t=(0,i.default)((function*(t,i,a){const s=(0,o.delayMs)(C.expBackoff(a,12e4,1e3,.1));try{if(n)yield(0,g.updateMessage)(M),__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`placeholder populate successful`;else if(P){if(yield(0,g.processRevokeMsgs)([{revokeMsgKey:M.protocolMessageKey,newMsgKey:M.id,timestamp:M.t,subtype:M.subtype,sender:M.author}]),(0,p.receiveReactionsEnabled)()){const t=r(68819).getJobManager;yield t().waitUntilPersisted(S.jobSerializers.deleteReactions(e.toString(),[M.protocolMessageKey.toString()]))}}else try{yield(0,g.storeMessages)([M],e),M.type===l.MSG_TYPE.CIPHERTEXT&&(0,m.addPlaceHolderAction)(M)}catch(e){if(!(e instanceof g.DuplicateMessageError))throw e;M.type===l.MSG_TYPE.CIPHERTEXT?__LOG__(2)`processPlaceholderMsg: skip creating duplicate placeholder`:(__LOG__(2)`storeMessages loop: detect resend message`,yield(0,g.updateMessage)(M),d.update=!0)}if(M.type===l.MSG_TYPE.GROUPS_V4_INVITE){const e=M.id.toString();yield(0,_.persistGroupInviteV4Msg)(e,{id:e,from:M.from.toString(),to:M.to.toString(),groupId:M.inviteGrp,expiration:parseInt(M.inviteCodeExp,10),expired:u.Clock.globalUnixTime()>=parseInt(M.inviteCodeExp,10)})}__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop`,t()}catch(e){return __LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop: failed with error ${e}.`,a>3?(__LOG__(3)`storeMessages loop: Gave up after ${a} tries`,Promise.reject(e)):s}}));return function(){return t.apply(this,arguments)}}()),__LOG__(2,void 0,void 0,void 0,["messaging"])`handleSingleMsgMD: msgId::${M.id.id}, write message to db done, overwrite: ${n}, skipUI: ${I}`;try{yield(0,y.checkOrphanMutations)([M.id.toString()],[e.toString()]),(0,p.receiveReactionsEnabled)()&&(yield(0,T.checkUpdateForOrphanReactions)([M.id.toString()]))}catch(t){__LOG__(4,void 0,new Error)`handleSingleMsgMD: checkOrphanMutations failed during handleSingleMsgMD for: ${String(M.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}I||(M.recvFresh=!0,M.isNewMsg=!0,yield b.sendAndReceive("msg_collection","processMultipleMessages",{chatId:e,msgObjs:[M],meta:d,chatMsgsCollection:null,preserveOrder:a}))}catch(t){if(t instanceof A.LogoutDrop)return;if(t instanceof v.PreviousMsgNotPlaceholderError)return __LOG__(2,void 0,void 0,!0)`Msg: ${String(M.id)} chat: ${String(e)} Error: PreviousMsgNotPlaceholderError`,void SEND_LOGS("msg_handler for MD: error storing/processing single message");__LOG__(4,void 0,new Error,!0,["messaging"])`Msg: ${String(M.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing single message")}}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,n,i){return yield Promise.resolve(),(0,g.storeRecentAndFullHistSyncMessages)(e,t,!0,!0).then((()=>{const r=t.map((e=>e)),n=e.map((e=>e.id.toString()));return(0,y.checkOrphanMutations)(n,r)})).then((()=>{if((0,p.parseWMIReaction)()){return(0,r(53348).storeReactionMsgBulk)(n)}})).then((()=>{const e=(0,f.getBridge)(),t=r(69951).ChatCollection;i.forEach((r=>{if(!r||!r.id||!r.id.remote)return;const n=r.id.remote,i=t.get(n);i&&0===i.msgs.length&&!i.pendingInitialLoading&&e.fireAndForget("msg_collection","processMultipleMessages",{chatId:n,msgObjs:[r],meta:{add:"last",isHistory:!0},chatMsgsCollection:null})}))})).catch((0,a.filteredCatch)(A.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("handleProgressiveHistorySyncMsgs: error storing/processing multiple messages")}))}))).apply(this,arguments)}},52821:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateMsgInfo=function(e,t,r,n){if(o.GK.supportsFeature(o.GK.F.MD_BACKEND))return function(e,t,r,n){const o=e.id;a.default.isUser(o.remote)?function(e,t,r,n){t===i.ACK.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===i.ACK.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===i.ACK.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}(e,t,r,n):function(e,t,r,n){let a=i.ACK.CLOCK;e.played.get(r)?a=i.ACK.PLAYED:e.read.get(r)?a=i.ACK.READ:e.delivery.get(r)&&(a=i.ACK.RECEIVED);if(t<=a)return;if(t>i.ACK.RECEIVED){const t=e.delivery.get(r);t?e.delivery.remove(t):e.deliveryRemaining-=1}if(t>i.ACK.READ){const t=e.read.get(r);t?e.read.remove(t):e.readRemaining-=1}t===i.ACK.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===i.ACK.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===i.ACK.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}(e,t,r,n)}((0,s.unproxy)(e),t,r,n);return function(e,t,r,n){const o=e.id;if(!a.default.isUser(o.remote)){if(t!==i.ACK.RECEIVED){const t=e.delivery.get(r);t&&e.delivery.remove(t)}if(t!==i.ACK.READ){const t=e.read.get(r);t&&e.read.remove(t)}if(t!==i.ACK.PLAYED){const t=e.played.get(r);t&&e.played.remove(t)}}t===i.ACK.PLAYED?(e.played.get(r)||(e.playedRemaining-=1),e.played.add({id:r,t:n})):t===i.ACK.READ?(e.read.get(r)||(e.readRemaining-=1),e.read.add({id:r,t:n})):t===i.ACK.RECEIVED&&(e.delivery.get(r)||(e.deliveryRemaining-=1),e.delivery.add({id:r,t:n}))}((0,s.unproxy)(e),t,r,n)};var i=r(35470),a=n(r(89867)),o=r(7293),s=r(31019)},4280:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelOrDeclinePaymentRequest=function(){return s.apply(this,arguments)},t.fulfillPaymentRequest=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(90641),o=r(12896);function s(){return(s=(0,i.default)((function*(e){const t=r(59871).MsgCollection,n=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([n]);i&&i.forEach((r=>{const n=t.get(r.id);n?n.set((0,o.hydrateMessage)(r),{merge:!0}):r.id===e.id.toString()&&(e.type=r.type,e.templateParams=r.templateParams)}))}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=r(59871).MsgCollection,n=new t.constructor.model(e),i=yield(0,a.processPaymentMessages)([n]);i&&i.forEach((e=>{const r=t.get(e.id);r&&r.set((0,o.hydrateMessage)(e),{merge:!0})}))}))).apply(this,arguments)}},17780:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._processMultipleMessages=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(15461),o=n(r(89867)),s=n(r(47545)),l=r(71473),c=r(22683),d=n(r(61516)),u=r(99234),p=n(r(46931)),f=r(7293),_=r(57701),h=r(32554),g=r(78986),m=r(58668),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=T(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(54676)),E=r(92671),S=r(91692),v=r(64551);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(T=function(e){return e?r:t})(e)}function C(){return(C=(0,i.default)((function*(e,t,n,i){const{filteredRecs:T,reorderRecs:C,updates:b}=(0,p.default)(e,t,n,i);yield Promise.all(b);const P=r(69951).ChatCollection,M=r(50101).findChat,O=r(59871).MsgCollection;if(0===T.length&&0===C.length){if(e&&n.pendingMsgsDone){const t=P.get(e);t&&(t.pendingMsgs=!1)}return t.map((e=>O.get(e.id))).filter((e=>e))}if(!e)return A(T).then((()=>t.map((e=>O.get(e.id))).filter((e=>e&&!!e.chat))));let I;const w=t[0];if(o.default.isStatusV3(e)){const e=w.id.fromMe?(0,u.getMaybeMeUser)():w.author;I=r(59387).StatusV3Collection.find(e)}else I=M(e);const R=yield I,D=yield A(T),N="after"===n.add||"last"===n.add,L=!n.isHistory;let k,G,U=!1;if("unread"===n.add?(k=i,R.msgChunks.push(k),G=n.firstUnreadKey):"last"===n.add&&n.resume?(k=i,U=!0):k="function"==typeof i?i():i,(0,s.default)(t,D,C,R,N,k||R.msgs,G,U),n.pendingMsgsDone&&(R.pendingMsgs=!1),L&&o.default.isBroadcast(e)&&!o.default.isStatusV3(e)&&D.forEach((function(e){e&&e.recvFresh&&!e.isNotification&&y.broadcastFanout(e)})),f.GK.supportsFeature(f.GK.F.RECENT_EMOJI_SYNC))for(let e=0;e<D.length;e++){const t=D[e];if(t.isNewMsg&&t.isSentByMe&&t.containsEmoji){E.RecentEmojiCollection.throttledSync();break}}if(f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&v.ServerProps.webServerStickerPanel){const e=D.map((e=>{if(!(e.isSentByMe&&e.type===a.MSG_TYPE.STICKER))return;const{mediaData:t,mediaObject:r}=e,n=e.id.toString(),i=null==r?void 0:r.entries.entries[0];return[{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:(null==i?void 0:i.encFilehash)||t.encFilehash,mediaKey:(null==i?void 0:i.mediaKey)||t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:c.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:m.OUTWARD_TYPES.STICKER,index:0},e.t,n]})).filter(Boolean);r(49264).RecentStickerCollectionMd.enqueue(e)}if(f.GK.isRecentStickersEnabled()){const e=D.map((e=>{if(!(e.isNewMsg&&e.isSentByMe&&e.type===a.MSG_TYPE.STICKER))return;const{mediaData:t}=e;return{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:t.encFilehash,mediaKey:t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:c.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:m.OUTWARD_TYPES.STICKER,index:0}})).filter(Boolean);S.RecentStickerCollection.enqueue(e)}if((0,_.webMediaAutoDownloadEnabled)()&&!o.default.isStatusV3(e)&&D.map((e=>e.asAutoDownloadableMedia)).filter(Boolean).forEach((e=>{l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MEDIA)})),v.ServerProps.webDownloadDocumentThumbMmsEnabled&&D.map((e=>e.asDoc)).filter(Boolean).forEach((e=>{(0,_.webMediaAutoDownloadEnabled)()?l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,d.default)({msg:e,isPreload:!0})})),D.map((e=>e.asUrl)).filter(Boolean).forEach((e=>{(0,h.hqLinkPreviewExpired)(e.t)||((0,_.webMediaAutoDownloadEnabled)()?l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,d.default)({msg:e,isPreload:!0}))})),f.GK.supportsFeature(f.GK.F.DOWNLOAD_STATUS_THUMB_MMS)&&o.default.isStatusV3(e)){const e=(0,u.getLastStatusUsage)();(null==e||Date.now()-e<12096e5)&&D.map((e=>e.asImage||e.asVideo)).filter(Boolean).forEach((e=>{(0,_.webMediaAutoDownloadEnabled)()?l.AutoDownloadQueue.enqueue(e,l.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,g.downloadStatusV3Thumbnail)({msg:e,isPreload:!0})}))}return t.map((e=>O.get(e.id))).filter((e=>e))}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){let t=r(59871).MsgCollection.add(e,{merge:!0});return f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&(t=t.filter(((t,r)=>(null==t&&(__LOG__(4,void 0,new Error,!0)`Get empty message with id ${e[r].id}.`,SEND_LOGS("msgPrepWork-empty-message")),null!=t)))),yield Promise.all(t.map((e=>e.waitForPrep().catch((e=>{__LOG__(4,void 0,new Error,!0)`Assertion failed! ${String(e)}`,SEND_LOGS("bad-msg-prep")}))))),t}))).apply(this,arguments)}},47545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i,a,o,s,l){const c=function(e,t,r,n,i){const a={},o={};let s,l,c,d=r.length,u=i;if(0===d)return{msgs:t,collection:u};for(s=0;s<d;s++)l=r[s],o[l.id]=l;for(d=t.length,s=0;s<d;s++)l=t[s],l&&(a[l.id]=l);const p=[];for(d=e.length,s=0;s<d;s++)if(l=e[s],l&&(c=a[l.id],c&&p.push(c),c=o[l.id],c))if(c.recvFresh)p.push(c),n.removeMsg(c),c.unset("recvFresh");else{const e=n.getAllCMCs().find((function(e){return e.get(c.id)}));i&&e===i||(e?(e.forEach((function(e){p.push(e),delete o[e.id]})),e===n.msgs?(n.replaceMsgsCollection(i),u=n.msgs):(n.notifyMsgCollectionMerge(i,e,i),n.removeMsgsCollection(e))):(__LOG__(3)`models:Msg:reorder trying to merge CMC of orphaned message ${l.id}`,p.push(o[l.id])))}return{msgs:p,collection:u}}(e,t,r,i,o);n.addRecordsToChat(c.msgs,i,a,c.collection,s,l)};var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,r&&r.set(e,n);return n}(r(54676));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}},46931:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){const O=[],w=[],R=[],D=r(69951).ChatCollection,N=r(59871).MsgCollection;return t.forEach((function(t){var L;t.id instanceof l.default||(__LOG__(4,void 0,new Error,!0)`_processMultipleMessages: el.id is not a MsgKey`,SEND_LOGS("forgot-to-create-msgkey"),t.id=new l.default({from:t.from,to:t.to,id:t.id,participant:t.participant,selfDir:t.self})),(0,P.isString)(e)&&d.default.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<s.ACK.CLOCK&&(t.ack=s.ACK.CLOCK),null!=t.hydratedButtons&&((L=t).buttons=new b.TemplateButtonCollection,L.buttons.add(L.hydratedButtons.map(((e,t)=>{var r,n;const i=`${null!=e.index?e.index:t}`;return e.quickReplyButton?new A.default({id:i,displayText:e.quickReplyButton.displayText,selectionId:e.quickReplyButton.id,subtype:"quick_reply"}):e.callButton?new A.default({id:i,displayText:e.callButton.displayText,phoneNumber:e.callButton.phoneNumber,subtype:"call"}):new A.default({id:i,displayText:null===(r=e.urlButton)||void 0===r?void 0:r.displayText,url:null===(n=e.urlButton)||void 0===n?void 0:n.url,subtype:"url"})})))),null!=t.dynamicReplyButtons&&function(e){e.replyButtons=new p.ButtonCollection,e.replyButtons.add(e.dynamicReplyButtons.map((e=>{let{buttonId:t,buttonText:r}=e;return new u.default({id:t,displayText:null==r?void 0:r.displayText})})))}(t);let k=N.get(t.id);if(t.type===c.MSG_TYPE.PROTOCOL&&"ephemeral_setting"!==t.subtype)switch(t.subtype){case"admin_revoke":if(k=N.get(t.protocolMessageKey),k)if(k.isGroupMsg)if(d.default.equals(k.id.remote,t.id.remote)){__LOG__(2)`getMsgUpdates: admin revoked ${k.id.toString()}`;const e=new y.Msg(t);if((0,_.adminRevokeReceiverEnabled)()){const t=(0,o.default)(k.chat.groupMetadata,"m.chat.groupMetadata"),r=t.participants.get(e.sender);if(!r||!r.isAdmin){if(t.participants.add({id:e.sender,isAdmin:!0},{merge:!0}),!r){const t={action:g.GROUP_ACTIONS.ADD,participants:[e.sender]},r=(0,h.genGroupNotificationMsg)({author:void 0,chatId:k.chat.id,ts:e.t},t);(0,E.handleSingleMsgMD)(r.from,r)}(0,v.markGroupAsDirty)({group:k.chat.id})}}(0,C.revoke)(k,{msgKey:e.id,subtype:e.subtype,sender:e.sender})}else __LOG__(2)`getMsgUpdates: ${k.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke came for the different group than the original message was in`;else __LOG__(2)`getMsgUpdates: ${k.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke was sent to a non-group chat`;break;case"sender_revoke":if(k=N.get(t.protocolMessageKey),k){const n=new y.Msg(t);d.default.equals(k.sender,n.sender)?(__LOG__(2)`getMsgUpdates: sender revoked ${k.id.toString()}`,d.default.isStatusV3(e)&&k.msgChunk&&k.msgChunk.remove(k),(0,C.revoke)(k,{msgKey:n.id,subtype:n.subtype,sender:n.sender}),d.default.isStatusV3(e)&&r(59387).StatusV3Collection.find(k.sender).then((e=>{var t,r;if(f.GK.supportsFeature(f.GK.F.QUERY_STATUS_V_3_THUMBNAIL)&&(null===(t=k)||void 0===t||null===(r=t.msgChunk)||void 0===r?void 0:r.length)!==e.totalCount){if(f.GK.supportsFeature(f.GK.F.MD_BACKEND))throw new Error("Webd.statusQueryThumbnail is only supported in non-MD mode");M.default.statusQueryThumbnail(e.id)}}))):__LOG__(3)`getMsgUpdates: sender revoke: sender mismatch: ${n.id.toString()} <> ${k.id.toString()}`}break;case"ephemeral_sync_response":const n=D.get(t.id.remote);n&&(0,m.default)(n,t.ephemeralDuration,t.ephemeralSettingTimestamp);break;default:__LOG__(2)`unknown protocolMessage ${t.id.toString()}`}else if(k&&!k.asRevoked){t.ack<k.ack&&delete t.ack;for(const e in t)t.hasOwnProperty(e)&&void 0===t[e]&&delete t[e];t.id.fromMe&&!k.deprecatedMms3Url&&t.deprecatedMms3Url&&(t.phoneUploading=!1),n.isHistory&&(t.isNewMsg=!1);const e=k.t?(0,a.default)(t,["t","id","from","to"]):t,r=k.applyUpdate(e).then((()=>k));if(R.push(r),d.default.isBroadcast(k.id.remote)){const t=S.getBroadcastFanoutKeys(k);t&&t.forEach((t=>{const r=N.get(t);r&&R.push(r.applyUpdate(e).then((()=>k)))}))}n.isHistory&&(k.recvFresh||i)&&!k.search?(__LOG__(3)`model:Msg:handle:processMM:${k.recvFresh?"dup:":"overlap:"}${String(k.id)}`,w.push(k)):n.isHistory&&k.search?(k.search=!1,__LOG__(3)`model:Msg:handle:processMM load search as history ${String(k.id)}`,O.push({id:k.id})):"search"===n.add&&O.push({id:k.id})}else{"payment_action_request_declined"===t.subtype||"payment_transaction_request_cancelled"===t.subtype?R.push((0,T.cancelOrDeclinePaymentRequest)(t)):t.type===c.MSG_TYPE.PAYMENT&&"send"===t.subtype&&R.push((0,T.fulfillPaymentRequest)(t)),S.typeIsMms(t)&&!t.deprecatedMms3Url&&(t.phoneUploading=t.id.fromMe&&t.ack===s.ACK.CLOCK);const e=D.get(t.id.remote);"search"===n.add&&(t.search=!0),n.update||O.push(t),!n.isHistory&&"search"!==n.add&&e&&R.push(function(){return I.apply(this,arguments)}(t,e)),t.ephemeralOutOfSync&&__LOG__(2)`ephemeralOutOfSync msgId=${t.id.toString()} chatId=${null==e?void 0:e.id.toString()}`}})),{filteredRecs:O,reorderRecs:w,updates:R}};var i=n(r(48926)),a=n(r(57557)),o=n(r(45095)),s=r(35470),l=n(r(65212)),c=r(15461),d=n(r(89867)),u=n(r(15871)),p=r(47688),f=r(7293),_=r(57701),h=r(37654),g=r(36098),m=n(r(26878)),y=r(17304),E=r(5819),S=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=O(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(54676)),v=r(51727),T=r(4280),C=r(81027),A=n(r(11897)),b=r(82988),P=r(31515),M=n(r(56891));function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(O=function(e){return e?r:t})(e)}function I(){return(I=(0,i.default)((function*(e,t){if(!e.isNewMsg||!e.recvFresh)return __LOG__(3,void 0,void 0,!0)`processLiveMessage should not be called with history message id ${e.id.toString()}`,SEND_LOGS("bad-process-live-message-call"),Promise.resolve();if(e.type===c.MSG_TYPE.GP2&&"delete"===e.subtype&&(t.isReadOnly=!0),t.isUser){var r;const a=null!==(r=e.ephemeralDuration)&&void 0!==r?r:0;let o,s=!1;e.type===c.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===e.subtype?o=e.t:e.ephemeralSettingTimestamp&&(o=e.ephemeralSettingTimestamp,s=!0);let l=!1;if(null!=o&&(l=yield(0,m.default)(t,a,o,s)),f.GK.supportsFeature(f.GK.F.MD_BACKEND)&&!S.isNotification(e.type,e.subtype)){var n,i;const r=null!==(n=e.ephemeralDuration)&&void 0!==n?n:0,a=null!==(i=t.getEphemeralSetting())&&void 0!==i?i:0;e.ephemeralOutOfSync=r!==a&&!l}}}))).apply(this,arguments)}},76332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addOrUpdateReactions=function(){return y.apply(this,arguments)},t.addOrUpdateReactionsDB=h,t.addOrUpdateReactionsDBBulk=function(e){return(0,p.createOrUpdateReactions)(e)},t.addOrUpdateReactionsModelCollection=g,t.checkUpdateForOrphanReactions=function(){return P.apply(this,arguments)},t.deleteAllReactionsOfMsg=function(){return E.apply(this,arguments)},t.markReactionsAsRead=function(){return v.apply(this,arguments)},t.markReactionsAsReadByMessageKeys=function(){return T.apply(this,arguments)},t.updateHasReactionFromParent=function(){return S.apply(this,arguments)};var i=n(r(48926)),a=n(r(65212)),o=r(67811),s=r(54958),l=r(88102),c=r(30010),d=r(76214),u=r(75250),p=r(63374),f=r(31464),_=r(35099);function h(e){return(0,p.createOrUpdateReactions)([e])}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const{parentMsgKey:n}=e,i=t&&(0,c.shouldNotifyReaction)(e);let d;if(d=i?yield f.ReactionsCollection.find(n):f.ReactionsCollection.get(n),d){f.ReactionsCollection.addOrUpdateReaction(e);const t=d.reactions.length>0;yield(0,u.updateHasReactionInParent)(n,t)}else e.reactionText!==o.REVOKED_REACTION_TEXT&&(yield(0,u.updateHasReactionInParent)(n,!0));i&&l.Cmd.alertNewReactionMsg(e);const p=(0,o.isReactionByMe)(e.senderUserJid),_=a.default.fromString(n),h=_.fromMe;if((0,s.shouldUnarchiveChatOnReaction)(h,p,e.reactionText)){const e=r(69951).ChatCollection.get(_.remote.toString());e&&l.Cmd.archiveChat(e,!1,!1)}}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const[r]=yield h(e);r&&g(r,t)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){yield(0,p.deleteReactionsByParentMessageKey)(e.toString());f.ReactionsCollection.get(e)&&f.ReactionsCollection.deleteReactionsByParentMessageKey(e)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=[],r=[];e.forEach((e=>{const n=e.parentMsgKey;e.reactionText!==o.REVOKED_REACTION_TEXT?r.push({id:n,hasReaction:!0}):t.push(e.parentMsgKey)}));const n=yield(0,p.getReactionsFromParentMsg)(t);return t.forEach((e=>{const t=n.get(e),i=t&&t.length>0||!1;r.push({id:e,hasReaction:i})})),(0,d.getMessageTable)().bulkCreateOrMerge(r)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){yield(0,_.sendReactionReadReceipts)(e),yield(0,p.markReactionRowsAsRead)(A(e)),f.ReactionsCollection.markReactionsAsRead(b(e))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=yield(0,p.markReactionsAsReadByMessageKeysInStore)(e);t&&f.ReactionsCollection.markReactionsAsRead(C(t))}))).apply(this,arguments)}function C(e){return e.map((e=>{let{parentMsgKey:t,msgKey:r,reactionText:n}=e;return{parentMsgKey:a.default.fromString(t),msgKey:a.default.fromString(r),reactionText:n}}))}function A(e){return e.map((e=>{let{parentMsgKey:t,senderUserJid:r}=e;return{parentMsgKey:t.toString(),senderUserJid:r}}))}function b(e){return e.map((e=>{let{parentMsgKey:t,msgKey:r,reactionText:n}=e;return{parentMsgKey:t,msgKey:r,reactionText:n}}))}function P(){return(P=(0,i.default)((function*(e){try{(yield(0,p.changeOrphanStateReactions)(e)).forEach((e=>{f.ReactionsCollection.get(e.parentMsgKey)&&f.ReactionsCollection.addOrUpdateReaction(e)}))}catch(e){__LOG__(3)`checkUpdateForOrphanReactions: error ${e}`}}))).apply(this,arguments)}},81027:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.revoke=R,t.sendRevoke=function(e,t,n){return function(e,t,n){const{id:a,t:l}=e;if(t===u.Revoke.Sender&&!a.fromMe)return Promise.reject(new Error("revoking received message"));let c;_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&a.remote.isGroup()&&(c=(0,f.getMeUser)());const d=new o.default({id:o.default.newId(),remote:e.id.remote,fromMe:!0,participant:c}),g=function(e){switch(e){case u.Revoke.Sender:return"sender_revoke";case u.Revoke.Admin:return"admin_revoke"}}(t),m={id:d,to:a.remote,t:l,type:s.MSG_TYPE.PROTOCOL,subtype:g,protocolMessageKey:a,clearMedia:!!n,local:!0};return new C.NonPersistJob("sendMessage",(0,i.default)((function*(){try{yield(0,E.storeMessages)([m],e.chat.id)}catch(e){throw __LOG__(4,!0,new Error,!0)`_sendRevoke: failed to storeMessages into storage`,SEND_LOGS("storeMessages failed"),e}if((yield(0,P.sendMsgRecord)(new v.Msg(m)))===M.SendMsgResult.OK){const t=Math.trunc(Date.now()/1e3-e.t);return new S.default.SendRevokeMessage({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),revokeSendDelay:t}).commit(),(0,E.processRevokeMsgs)([{revokeMsgKey:e.id,newMsgKey:d,timestamp:e.t,subtype:g,sender:(0,f.getMeUser)()}]).then((0,i.default)((function*(){if((0,h.receiveReactionsEnabled)()){const t=r(68819).getJobManager;yield t().waitUntilPersisted(A.jobSerializers.deleteReactions(e.chat.id.toString(),[e.id.toString()]))}return R(e,{msgKey:d,subtype:g,sender:(0,f.getMeUser)()}),M.SendMsgResult.OK})))}return Promise.resolve(M.SendMsgResult.ERROR_UNKNOWN)})),{priority:p.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}((0,O.unproxy)(e),t,n)};var i=n(r(48926)),a=n(r(4788)),o=n(r(65212)),s=r(15461),l=n(r(89867)),c=r(48285),d=n(r(69048)),u=r(88102),p=r(1973),f=r(99234),_=r(7293),h=r(57701),g=r(11902),m=r(10435),y=w(r(78986)),E=r(84886),S=n(r(11339)),v=r(17304),T=w(r(54676)),C=r(29731),A=r(6684),b=r(4136),P=r(19708),M=r(13705),O=r(31019);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(I=function(e){return e?r:t})(e)}function w(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=I(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function R(e,t){return function(e,t){var n;const i="admin_revoke"===t.subtype;if(i&&!(0,h.adminRevokeReceiverEnabled)())return void __LOG__(2)`revoke: admin revoke feature is disabled, ${e.id.toString()} has not been revoked`;if(i||(0,m.isSenderRevokeWindowReceiverEnabled)()){if(!(Math.trunc(Date.now()/1e3)-e.t<=b.REVOKE_WINDOW_V2+b.REVOKE_WINDOW_V2_RECEIVER_MARGIN))return void __LOG__(2)`revoke: outside of revoke window, ${e.id.toString()} has not been revoked`}r(16770).LabelCollection.removeAllLabelsMD(e),T.typeIsMms(e)&&y.deregisterMsg(e);e.chat&&e.chat.removeFromCollection(e);e.trigger("revoked");const o=e.getCollection(),u=e.id;e.msgChunk&&e.msgChunk.replaceId(u,t.msgKey);o.replaceId(u,t.msgKey);const p=null===(n=e.chat)||void 0===n?void 0:n.isUnreadMsg(e),f={id:t.msgKey,type:s.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",revokeSender:t.sender,body:void 0,caption:void 0,clientUrl:void 0,deprecatedMms3Url:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,doNotPlayInline:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1};e.set(f),e.trigger("change:msgKey",{newKey:t.msgKey,oldKey:u}),e.chat&&(e.chat.updateMediasCountOnMsg(e,!0),u.equals(e.chat.lastReceivedKey)&&(0,g.setLastReceivedKey)(e.chat.id,t.msgKey).then((()=>{e.chat.lastReceivedKey=t.msgKey})),e.chat.composeQuotedMsg===e&&(e.chat.composeQuotedMsg=null),(0,m.isSenderRevokeUiEnabled)()&&p&&(e.chat.unreadCount=Math.max(e.chat.unreadCount-1,0),(0,c.reduceChatUnreadCount)(e.chat.id.toString())));e.isLive&&r(85865).LiveLocationCollection.removeMsg(e);if(l.default.isBroadcast(u.remote)){const n=T.getBroadcastFanoutKeys(u),i=T.getBroadcastFanoutKeys(t.msgKey);if(!n||!i||n.length!==i.length)return void __LOG__(2)`cannot fanout revoke: ${String(n)} ${String(i)}`;if((0,a.default)(n,i).forEach((e=>{const r=o.get(e[0]);r&&R(r,{msgKey:e[1],subtype:t.subtype,sender:t.sender})})),_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&(d.default.purge([String(e.rowId)]),(0,h.receiveReactionsEnabled)())){const t=r(68819).getJobManager,n=e.chat?e.chat.id.toString():e.id.remote.toString();t().fireAndForget(A.jobSerializers.deleteReactions(n.toString(),[u.toString()]))}}}((0,O.unproxy)(e),t)}},4136:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=t.REVOKE_WINDOW_V2=t.REVOKE_WINDOW=void 0;t.REVOKE_WINDOW=4096;t.REVOKE_WINDOW_V2=216e3;t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=43200},40256:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(84886),o=r(59387);function s(){return(s=(0,i.default)((function*(e){const t=o.StatusV3Collection.getPSAStatus();if(!t)return;const r=t.msgs.filter((t=>t.campaignId===e));if(0===r.length)return;const n=r.map((e=>e.id.toString()));t.revokeMsgs(n),yield(0,a.removeMessagesFromHistory)(n),__LOG__(2,void 0,void 0,void 0,["revoke-status-psa"])`revokeStatusPSA completed`}))).apply(this,arguments)}},92188:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendKeyDistributionMsg=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(65212)),o=r(45454),s=r(99234),l=n(r(63928));function c(){return(c=(0,i.default)((function*(e){if(!e.isGroup)return Promise.reject(new Error("[messaging] sendKeyDistributionMsg: only group chats are supported`"));const t=e.id,n=(0,s.getMaybeMeUser)(),i=new a.default({from:n,to:t,id:a.default.newId(),participant:(0,o.toUserWid)(n),selfDir:"out"});yield l.default.find(e.id);const{encryptAndSendKeyDistributionMsg:c}=r(95547);return c(i)}))).apply(this,arguments)}},19708:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgRecord=function(e){return(0,a.promiseCallSync)((()=>{const t=e.id,n=r(50101).findChat;let a;n(t.remote).then((e=>{e.isTrusted()||(0,T.sendNotSpam)(e).catch((()=>{}))})),p.default.isBroadcast(e.to)&&(a=(0,E.broadcastFanout)(e)),e.isNewMsg=!0;const b=e.type===d.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(e.subtype),P=e.type===d.MSG_TYPE.REACTION&&e.reactionText===u.REVOKED_REACTION_TEXT;if(!e.isGroupMsg&&!b&&!P&&f.BlocklistCollection.get(e.to))return Promise.reject(new _.default("Contact is blocked",h.ContactCollection.assertGet(e.to)));let M;b||P||(M=new y.default.WebcMessageSend({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),messageIsForward:Boolean(e.isForwarded)}));const O=r(59871).MsgCollection,I=r(7293).GK;return n(e.id.remote).then((t=>((0,C.sendSeen)(t),e.type===d.MSG_TYPE.REACTION||b||O.trigger(l.default.NEW_MSG_SENT),(0,o.promiseProps)({reply:(0,S.sendMsgRecord)(e),chat:t})))).then((r=>{var i;let{reply:o,chat:l}=r;const u=t.remote,f=(0,g.getMaybeMeUser)(),_=t.fromMe&&p.default.equals(t.remote,f)?3:o.data?o.data.ack:1;return e.updateAck(_,o.t),M&&(M.markMessageSendT(),M.commit()),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postWrittenWireStage(),[d.MSG_TYPE.PROTOCOL,d.MSG_TYPE.REACTION].includes(e.type)||(0,m.setLastReceivedKey)(l.id,t).then((()=>{l.lastReceivedKey=t})),O.updateLastReceipt(u,o.t),p.default.isBroadcast(u)&&(a?a.forEach((e=>{const r=new c.default({from:f,to:e,id:t.id}),i=O.get(r);i&&(i.ack=s.ACK.SENT,O.updateLastReceipt(e,i.t),null==i.ephemeralStartTimestamp&&i.updateEphemeralStartTimestamp(i.t),n(e).then((e=>{(0,m.setLastReceivedKey)(e.id,r).then((()=>{e.lastReceivedKey=r}))})))})):__LOG__(2)`model:msg:createRecord bclist server ack, no recipients`),v.SendMsgResult.OK})).catch((0,i.filteredCatch)(A.ServerStatusCodeError,(t=>{if(408!==t.status&&(__LOG__(4,void 0,new Error,!0)`Phone responded ${t.status}`,SEND_LOGS("send-not-200")),I.supportsFeature(I.F.MD_BACKEND)){const t=(0,S.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!1,t.messageSendResult=y.default.MESSAGE_SEND_RESULT_TYPE.ERROR_NETWORK,t.commit()}return v.SendMsgResult.ERROR_NETWORK}))).catch((t=>{if(__LOG__(3)`model:msg:createRecord dropped msg: ${e.id.toString()}`,__LOG__(4,void 0,new Error,!0)`Got error ${String(t)}`,SEND_LOGS("send-msg-error"),I.supportsFeature(I.F.MD_BACKEND)){const t=(0,S.createMessageSendMetric)(e);t.messageSendResultIsTerminal=!0,t.messageSendResult=y.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,t.commit()}return v.SendMsgResult.ERROR_UNKNOWN}))})).finally((()=>{e.sendDeferred&&e.sendDeferred.resolve(),e.wamMessageSendPerfReporter=null}))};var i=r(50796),a=r(18412),o=r(67602),s=r(35470),l=n(r(64369)),c=n(r(65212)),d=r(15461),u=r(67811),p=n(r(89867)),f=r(32826),_=n(r(89520)),h=r(19380),g=r(99234),m=r(11902),y=n(r(11339)),E=r(54676),S=r(90298),v=r(13705),T=r(19569),C=r(9609),A=r(77591)},13705:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMsgResult=void 0;const n=r(76672).Mirrored(["OK","ERROR_NETWORK","ERROR_EXPIRED","ERROR_CANCELLED","ERROR_UPLOAD","ERROR_UNKNOWN"]);t.SendMsgResult=n},83147:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(89867)),o=r(90981),s=r(30849),l=r(21224);function c(){return(c=(0,i.default)((function*(e,t){if(!a.default.isUser(e.id.remote))return;const r=e.privacyModeWhenSent;if(null!=r&&r.privacyModeTs>t.privacyModeTs)return;const n=(0,s.getReducedPrivacyMode)(t);if(n===(0,s.getReducedPrivacyMode)(r))return;if(null!=e.bizPrivacyStatus)return void __LOG__(3)`msg.bizPrivacyStatus exist already, we can not assign a new value anymore`;const i=d(n);e.bizPrivacyStatus=i,yield(0,o.getTable)().merge(e.id.toString(),{bizPrivacyStatus:i})}))).apply(this,arguments)}function d(e){switch(e){case s.ReducedPrivacyMode.E2EE:return l.WebMessageInfoBizPrivacyStatus.E2EE;case s.ReducedPrivacyMode.BSP:return l.WebMessageInfoBizPrivacyStatus.BSP;case s.ReducedPrivacyMode.FB:return l.WebMessageInfoBizPrivacyStatus.FB}}},14810:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncPrivacyDisallowedLists=s,t.syncSinglePrivacyDisallowedList=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(61319),o=r(25338);function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){return{type:e,response:yield(0,o.queryPrivacyDisallowedList)(e)}}));return function(){return e.apply(this,arguments)}}())),r=[];return t.forEach((e=>{const{status:t,users:n,dhash:i}=e.response;"mismatch"===t&&null!=n&&null!=i&&r.push({id:e.type,disallowedList:n.map((e=>e.toString())),dhash:i})})),yield(0,a.getTable)().bulkCreateOrReplace(r),r}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){yield s([e])}))).apply(this,arguments)}},3764:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProfilePic=function(e){return g((0,u.unproxy)(e))},t.setProfilePic=function(e,t,r){return h((0,u.unproxy)(e),t,r)};var i=r(50796),a=r(46331),o=r(88102),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(99234),c=n(r(43725)),d=r(5018),u=r(31019),p=r(77591),f=r(85893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_=function(e){return e?r:t})(e)}function h(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.genId)();const{id:u}=e;if(!e.canSet())return Promise.reject(new s.ActionError);const _=(0,d.sendSetPicture)(u,t,r);e.pendingPic=t;const g=(0,l.getMaybeMeUser)(),m=u.equals(g)?new a.ActionType(c.default.t(117)):new a.ActionType(c.default.t(63)),y=_.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:setPicture dropped`,u.equals(g)?new a.ActionType(c.default.t(116)):new a.ActionType(c.default.t(62))})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(i=>{if(i.status>=400){const i=u.equals(g)?c.default.t(116):c.default.t(62);return new a.ActionType(i,{actionText:c.default.t(129),actionHandler:()=>h(e,t,r,n)})}}))).then((()=>u.equals(g)?new a.ActionType(c.default.t(115)):new a.ActionType(c.default.t(61))));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:n,initialAction:m,pendingAction:y})),_.then((t=>{t._duplicate||e.set({tag:t.tag,eurl:t.eurl,token:t.token})})).finally((()=>{e.pendingPic=void 0}))}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.genId)();const{id:r}=e;if(!e.canDelete())return Promise.reject(new s.ActionError);const n=(0,d.requestDeletePicture)(r);e.pendingPic=e.fallbackType;const u=(0,l.getMaybeMeUser)(),_=r.equals(u)?new a.ActionType(c.default.t(114)):new a.ActionType(c.default.t(60)),h=n.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:deletePicture dropped`,r.equals(u)?new a.ActionType(c.default.t(112)):new a.ActionType(c.default.t(58))})).catch((0,i.filteredCatch)(p.ServerStatusCodeError,(n=>{if(n.status>=400){const n=r.equals(u)?c.default.t(112):c.default.t(58);return new a.ActionType(n,{actionText:c.default.t(129),actionHandler:()=>g(e,t)})}}))).then((()=>r.equals(u)?new a.ActionType(c.default.t(113)):new a.ActionType(c.default.t(59))));return o.Cmd.openToast((0,f.jsx)(a.ActionToast,{id:t,initialAction:_,pendingAction:h})),n.then((t=>{t._duplicate||e.set({tag:void 0,eurl:void 0})})).finally((()=>{e.pendingPic=void 0}))}},47569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){return s||(s=(0,i.queryServerProps)().then((e=>{a.ServerProps.updateProps(e),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps Start ---`,Object.keys(a.ServerProps.attributes).forEach((e=>{__LOG__(2,void 0,void 0,void 0,["serverprops"])`key: ${e}, value: ${a.ServerProps.attributes[e]}, type: ${typeof a.ServerProps.attributes[e]}`})),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps End ---`})).catch((0,n.filteredCatch)(o.ServerStatusCodeError,(()=>{}))).catch((0,n.filteredCatch)(o.WebdDrop,(()=>{}))).finally((()=>{s=null})),s)};var n=r(50796),i=r(8369),a=r(64551),o=r(77591);let s},92052:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.setArchiveClassicSetting=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return __LOG__(4,void 0,new Error)`Settings:setArchiveClassicSetting is not supported on MD Companion device.`,Promise.resolve();return m(e)},t.setArchiveEnabledSetting=function(e){if(d.GK.supportsFeature(d.GK.F.MD_BACKEND))return void __LOG__(4,void 0,new Error)`Settings:setArchiveEnabledSetting is not supported on MD Companion device.`;__LOG__(2)`Settings:setArchiveEnabledSetting value to ${e}`,f.default.archive.enabled!==e&&(f.default.archive=(0,a.default)((0,a.default)({},f.default.archive),{},{enabled:e}))};var i=n(r(48926)),a=n(r(81109)),o=r(50796),s=r(48360),l=r(46331),c=r(88102),d=r(7293),u=n(r(43725)),p=n(r(11339)),f=n(r(68132)),_=n(r(56891)),h=r(77591),g=r(85893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,l.genId)();__LOG__(2)`Settings:setArchiveClassicSetting value to ${e}`;const r=_.default.setArchiveSetting(e).then((e=>{if(e.status&&200!==e.status)throw new h.ServerStatusCodeError(e.status)})),n=new l.ActionType(s.fbt._("Changing archive setting",null,{hk:"4s5LmI"})),i=Boolean(f.default.archive.classic),d=r.then((()=>{__LOG__(2)`Settings:setArchiveClassicSetting:success value sucessfully set to ${e}`;const r=e?s.fbt._("Archived chats will unarchive when you receive a new message.",null,{hk:"2VniT0"}):s.fbt._("Archived chats will remain archived when you receive a new message.",null,{hk:"4C3WnP"});return new l.ActionType(r,{actionText:u.default.t(133),actionHandler:()=>m(i,t)})})).catch((0,o.filteredCatch)(h.ServerStatusCodeError,(e=>{if(__LOG__(3)`models:settings:setArchiveClassicSetting failed with server error`,e.status>=400)return new l.ActionType(s.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}))}))).catch((()=>{throw __LOG__(3)`models:settings:setArchiveClassicSetting dropped`,new l.ActionType(s.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}),{actionText:u.default.t(129),actionHandler:()=>m(e,t)})}));c.Cmd.openToast((0,g.jsx)(l.ActionToast,{id:t,initialAction:n,pendingAction:d})),yield r,f.default.archive.classic!==e&&(new p.default.ArchiveSettings({keepChatsArchived:e}).commit(),f.default.archive=(0,a.default)((0,a.default)({},f.default.archive),{},{classic:e}))}))).apply(this,arguments)}},82350:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(){return _.apply(this,arguments)},t.setMyStatus=h;var i=n(r(48926)),a=r(46331),o=r(88102),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(99234),c=n(r(43725)),d=r(51316),u=r(31515),p=r(85893);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}function _(){return(_=(0,i.default)((function*(e){const t=yield(0,d.getStatus)(e),n={id:e};if((0,u.isNumber)(t.status))switch(t.status){case 429:case 401:case 403:case 404:case 304:n.stale=!0;const t=r(46133).StatusCollection.get(e);t&&!(0,u.isString)(t.status)&&(n.status="");break;default:n.status=""}else{let i=t.status;if(t.stale){const t=r(46133).StatusCollection.get(e);t&&(i=t.status)}n.status=i}return n}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.genId)(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.trim();if(!i)return Promise.reject(new s.ActionError);const u=(0,d.setMyStatus)(i),f=new a.ActionType(c.default.t(128)),_=(0,l.getMaybeMeUser)(),g=r(46133).StatusCollection,m=g.assertGet(_).status,y=u.then((e=>{if(200===e.status){const e=n?void 0:{actionText:c.default.t(133),actionHandler:()=>h(m,t,!0)};return new a.ActionType(c.default.t(126),e)}if(e.status>=400)return new a.ActionType(c.default.t(127))})).catch((()=>{throw __LOG__(3)`models:statusCollection:setMyStatus dropped`,new a.ActionType(c.default.t(127),{actionText:c.default.t(129),actionHandler:()=>h(e,t)})}));o.Cmd.openToast((0,p.jsx)(a.ActionToast,{id:t,initialAction:f,pendingAction:y}));const E=yield u;200!==E.status||E._duplicate||(g.assertGet(_).status=e)}))).apply(this,arguments)}},77905:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFirstPartyStickers=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),o=n(r(18561)),s=n(r(43725)),l=n(r(11339)),c=r(2541),d=n(r(23082));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}const p="https://static.whatsapp.net/sticker";function f(){return(f=(0,i.default)((function*(e,t){const r={cat:"sticker_pack_data",id:e,lg:s.default.getLocale()},n=c.URL.build(p,r),i=yield(0,o.default)(n,{signal:null==t?void 0:t.signal}),u=new l.default.StickerCommonQueryToStaticServer;if(u.set({httpResponseCode:i.status,params:new d.default(r).toString(),queryType:l.default.QUERY_TYPE.STICKER_PACK_DATA}),u.commit(),!i.ok)throw new a.InvalidServerResponseError(n,i.status.toString(),"Invalid response from WhatsApp stickers endpoint");const f=yield i.json();if(null==f||0===f.length)throw new a.InvalidServerResponseError(n,i.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(f)}`);return f[0].stickers.map(((e,t)=>({mimetype:e.mimetype,width:e.width,height:e.height,index:t,filehash:e["file-hash"],directPath:e["direct-path"],mediaKey:e["media-key"],id:e["file-hash"],deprecatedMms3Url:e.url,encFilehash:e["enc-file-hash"],mediaKeyTimestamp:0})))}))).apply(this,arguments)}},76046:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleIncomingCallOffer=function(e,t){if(o.CallCollection.processIncomingCall(e.call_id,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:e.isVideoCall?u.default.isVideoCallEnabled():u.default.isVoiceCallEnabled(),offerTime:e.t}),!function(e){return e?u.default.isVideoCallEnabled():u.default.isVoiceCallEnabled()}(e.isVideoCall))return void d.Voip.handleIncomingSignalingMessage(e,t);const r=e.call_id;o.CallCollection.pendingOffers[r]=new a.Resolvable,o.CallCollection.pendingOffers[r].resolve(Promise.all([(0,c.default)(e,t),d.Voip.getNumParticipantsFromCallOffer(t)]).then((n=>{let[{result:i,retryCount:a},l]=n,c=!0;switch(l>0&&(__LOG__(4,void 0,new Error)`voip:incoming: Ignoring call offer since group calling is disabled`,c=!1),c=e.isVideoCall?c&&u.default.isVideoCallEnabled():c&&u.default.isVoiceCallEnabled(),i){case s.E2EProcessResult.SUCCESS:!function(e,t,r){const n=e.call_id;o.CallCollection.processIncomingCall(n,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:null!=r&&r,offerTime:e.t}),!1===r&&o.CallCollection.cleanupPendingOffer(n);d.Voip.handleIncomingSignalingMessage(e,t)}(e,t,c);break;case s.E2EProcessResult.RETRY:__LOG__(2)`voip:handleIncomingCallOffer reject call because of enc retry`,function(){f.apply(this,arguments)}(e,a);break;case s.E2EProcessResult.PARSE_ERROR:__LOG__(2)`voip:handleIncomingCallOffer ending call because of enc parse error`,d.Voip.endCall(r);break;default:throw new Error("invalid e2e result type")}})).finally((()=>{delete o.CallCollection.pendingOffers[r]})))},t.handleIncomingEncRekey=function(e,t){d.Voip.handleIncomingSignalingMessage(e,t)},t.handleIncomingSignalingMsg=function(e,t){d.Voip.handleIncomingSignalingMessage(e,t)};var i=n(r(48926)),a=r(88156),o=r(31218),s=r(49714),l=r(11849),c=n(r(84590)),d=r(84356),u=n(r(69594)),p=r(45473);function f(){return(f=(0,i.default)((function*(e){var t,r;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=yield l.waSignalStore.getRegistrationInfo();if(!i)throw Error("No registration info found");const{registrationId:a}=i,o=n+1;d.Voip.rejectCallWithoutCallCtx(e.call_id,null===(t=e.peer_jid)||void 0===t?void 0:t.toString({legacy:!0}),null===(r=e.call_creator)||void 0===r?void 0:r.toString({legacy:!0}),p.ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,o,a),5===o&&(__LOG__(2)`voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats`,d.Voip.processMissedIncomingCallMaxRetry(e))}))).apply(this,arguments)}},42285:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,s,l){if(__LOG__(2)`voip:handleIncomingCallOfferNotice: callId ${t}`,a.Clock.globalUnixTime()-r>45)return void __LOG__(2)`voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice`;i.CallCollection.add({id:t,isVideo:s,isGroup:l,offerTime:r,canHandleLocally:!1,peerJid:e},{merge:!0}),o.Cmd.alertCall((0,n.toUserWid)(e),t,s,l,!1),setTimeout((()=>{o.Cmd.cancelCall(e);const r=i.CallCollection.get(t);r&&i.CallCollection.remove(r)}),45e3)};var n=r(45454),i=r(31218),a=r(22683),o=r(88102)},56981:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceipt=function(e){return(0,n.prepareRetryReceiptBridge)(e)},t.queryCall=function(e,t){return(0,n.sendQueryCallBridge)(e,t)},t.sendCallEnd=function(e,t){return(0,n.sendCallEndBridge)(e,t)},t.sendCallOffer=function(e){return(0,n.sendCallOfferBridge)(e)},t.sendCallSignalingMsg=function(e,t){return(0,n.sendCallSignalingMsgBridge)(e,t)},t.sendEncRekey=function(e){return(0,n.sendEncRekeyBridge)(e)};var n=r(92486)},55062:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getCommsConfig=function(e){const t=e||{passive:!1};return{openChatSocket:e=>(0,o.default)(t).then((r=>(e(),t.passive=!1,r))),healthCheckInterval:15,deadSocketTime:2e4,maxSocketLoopWaitTime:9e5,shouldCloseStaleSocket:!0,shouldBlockReceivingUntilSuccess:!0,handlers:{onConnect:()=>{(0,a.isRegistered)()&&(i.Cmd.setSocketState(l.SOCKET_STATE.CONNECTED),i.Cmd.openSocketStream())},onDisconnect:()=>{i.Cmd.socketStreamDisconnected()},onSocketOpen:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.PAIRING)},onSocketLoopIteration:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.OPENING)},onConnectionChange:()=>{},onOptimisticConnectionChange:()=>{},onCastStanza:()=>{},onHandleAck:e=>{(0,s.default)(e)},onHandleStanza:()=>{},onSendIq:()=>{}}}};var i=r(88102),a=(r(41796),r(58052)),o=n(r(85726)),s=n(r(23368)),l=r(62583);r(85893)},18438:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return F.apply(this,arguments)};var i=n(r(48926)),a=r(44396),o=r(31914),s=r(45823),l=r(40126),c=r(96429),d=n(r(83558)),u=n(r(69277)),p=r(27514),f=n(r(81367)),_=n(r(58626)),h=n(r(64054)),g=r(92419),m=r(46462),y=n(r(86741)),E=n(r(70605)),S=n(r(70569)),v=n(r(17234)),T=n(r(50404)),C=n(r(58645)),A=n(r(27258)),b=n(r(65347)),P=n(r(46007)),M=n(r(6571)),O=n(r(2276)),I=n(r(54341)),w=r(79711),R=r(56545),D=r(25773),N=n(r(87183)),L=n(r(95681)),k=r(89370),G=r(28237);function U(e,t,r){const{attrs:n}=e;if(n.offline){const e=parseInt(n.t,10);G.OfflineMessageHandler.newOfflineStanza(e,r)}switch(e.tag){case"iq":return function(e){const{attrs:t,content:r}=e;if("urn:xmpp:ping"===t.xmlns)return(0,o.wap)("iq",{type:"result",to:t.from});if("md"!==t.xmlns)throw new Error(`handleIq unrecognized ${e.toString()}`);if(!Array.isArray(r)||!r.length)return;switch(r[0].tag){case"pair-device":return(0,T.default)(e);case"pair-success":return(0,C.default)(e)}}(e);case"receipt":return"retry"===n.type?(0,w.handleMessageRetryRequest)(e):"enc_rekey_retry"===n.type?(0,k.handleEncRekeyRetryRequest)(e):(0,v.default)(e);case"notification":switch(n.type){case"server_sync":return(0,D.handleServerSyncNotification)(e);case"w:gp2":return(0,g.handleGroupNotification)(e);case"picture":return(0,O.default)(e);case"business":return(0,c.handleBusinessNotification)(e);case"contacts":return(0,u.default)(e);case"devices":return(0,p.handleDevicesNotification)(e);case"disappearing_mode":return(0,_.default)(e);case"mediaretry":return(0,E.default)(e);case"encrypt":{const r=e.content;if(!Array.isArray(r)||!r.length)break;switch(r[0].tag){case"count":return(0,b.default)(e,t);case"identity":return(0,m.handleE2eIdentityChange)(e);case"digest":return(0,f.default)(e)}break}case"server":return(0,R.handleServerNotification)(e);case"status":return(0,s.handleAboutNotification)(e);case"account_sync":return(0,l.handleAccountSyncNotification)(e);case"pay":return(0,A.default)(e);case"psa":return(0,I.default)(e);case"privacy_token":return(0,M.default)(e)}if(__LOG__(3)`Comms.handleStanza unrecognized notification stanza ${e.toString()}`,n.hasOwnProperty("id"))return(0,o.wap)("ack",{id:n.id,class:"notification",from:n.to||o.DROP_ATTR,to:n.from||o.DROP_ATTR,type:n.type||o.DROP_ATTR,participant:n.participant||o.DROP_ATTR});break;case"chatstate":return(0,d.default)(e);case"presence":return(0,P.default)(e);case"message":return(0,S.default)(e);case"ib":return(0,y.default)(e);case"stream:error":return(0,N.default)(e);case"failure":return(0,h.default)(e);case"success":return(0,L.default)(e);case"call":return(0,k.handleCall)(e);case"error":return(0,a.handleError)(e)}__LOG__(3)`Comms.handleStanza unrecognized stanza ${e.toString()}`}function F(){return(F=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=yield Promise.resolve(U(e,t,r));return null==n?"NO_ACK":n}))).apply(this,arguments)}},24747:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){b&&b.deadSocketTimer.cancel()},t.castStanza=function(e){const t=N("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=N("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.onStreamErrorReceived=function(){N("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=P,t.resetStateForTests=function(){b=null,T=new p.Resolvable,C=1},t.sendIq=function(e,t){return w(e,t,!1)},t.sendIqErrorParser=function(e,t,r){return w(e,t,!1,r)},t.sendIqIfConnectedWithin=function(e,t,r){const n=N("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);return new Promise(((t,a)=>{const o=setTimeout((()=>{const e=n.pendingIqs.get(i);if(!e)throw new Error(`Unexisting stanza to be cancelled ${i}`);n.removeHandler(e),a(new y.Offline)}),1e3*r),s={type:"iq",resolve:t,stanza:e,attachedToSocketId:0,orderedId:C++,timeoutId:o};n.pendingIqs.set(i,s),n.socket?n.sendPendingIq(s):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`})).then((e=>(0,d.parseIqResponse)(e,t)))},t.sendIqWithoutRetry=function(e,t){return w(e,t,!0)},t.sendPing=function(){return D.apply(this,arguments)},t.sendSmaxIq=function(e,t){return w(e,t,!1)},t.sendStanzaAndReturnAck=I,t.sendStanzaAndWaitForAck=function(){return O.apply(this,arguments)},t.singletonOrThrowIfUninitialized=N,t.socketLoopIteration=M,t.startComms=function(e,t,r,n,i,a){if(b)return;b=new A(e,t,r,n,i,a),setTimeout(P,0)},t.startHandlingRequests=function(){return N("startHandlingRequests").startHandlingRequests()},t.stopComms=function(e){e&&m.Cmd.onStartingLogout();const t=N("stopComms");t.socketLoop.endWithValue(),t.socket&&t.socket.close();b=null},t.waitForConnection=function(){N("waitForConnection").sendPing(),T||(T=new p.Resolvable);return T.promise};var i=n(r(81109)),a=n(r(48926)),o=r(48338),s=r(47151),l=r(50796),c=r(20221),d=r(37329),u=r(72287),p=r(88156),f=r(57319),_=r(31914),h=r(72441),g=r(79196),m=r(88102),y=r(64103),E=(r(41796),r(58052)),S=n(r(23368)),v=r(62583);r(85893);let T=null,C=1;class A{constructor(e,t,r,n,i,a){this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new p.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.parseAndHandleStanza=(e,t)=>{e===this.socketId&&(this.deadSocketTimer.cancel(),T&&(T.resolve(),T=null));const r=(0,_.decodeStanza)(t,this.gzipInflate).then((r=>{if(!r)return void __LOG__(3)`Failure parsing stanza!`;const n=this.activePing;return n&&n.socketId===e&&n.stanzaId===L(r)?(this.activePing=null,n.handler.resolve(r),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(r,e,t.byteLength)})).then((t=>{if(e===this.socketId)if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t?__LOG__(2)`Comms: job response is NO_ACK`:t&&this.castStanza(t)}));this._pending.add(r),r.finally((()=>{this._pending.delete(r)}))},this.handleStanza=(e,t,r)=>{_wext.ohs(e,t,r);const n=L(e);if(null!=n){const t=this.pendingIqs.get(n);t?(this.pendingIqs.delete(n),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${n}`}else{if("ack"!==e.tag)return"failure"===e.tag?this._handleStanza(e,t,r):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,r)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new f.ShiftTimer((()=>{__LOG__(2)`Comms: testing socket`,this.socketId&&this.sendPing()})),this.deadSocketTimer=new f.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.config=r,this.onConnectionChange=(0,c.notifyConnectionChangeFactory)(i,a),this.gzipInflate=n,this.socketLoop=new u.PromiseRetryLoop({name:"MainSocketLoop",code:M,timer:{jitter:.1,max:r.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function r(r){e(r)&&t.push(r)}return this.pendingIqs.forEach(r),this.ackHandlers.forEach(r),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanza(e){this.castStanza(e),this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel()}castStanza(e){const t=this.socketOrThrow("castStanza");try{t.sendFrame((0,_.encodeStanza)(e))}catch(e){__LOG__(3)`castStanza error ${e}`}}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){var e=this;return(0,a.default)((function*(){__LOG__(2)`Comms.startHandlingRequests`,e._recvBlocker.resolve(),yield e._recvBlocker.promise}))()}handleAck(e){const t=this.ackHandlers;let r=-1,n=null;for(;!n&&++r<t.length;)n=t[r].parseAndTest(e);if(n){const i=t[r];(0,s.removeIndexWithoutPreservingOrder)(t,r),(0,S.default)(e),i.resolve(n),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,s.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new y.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}let b=null;function P(){N("openSocketLoop").socketLoop.start()}function M(){const e=N("socketLoopIteration"),t=e.nextSocketId++;__LOG__(2)`Comms: Socket ${t} opening}`;const r=()=>{e.onConnectionChange("in_handshake")};return m.Cmd.setSocketState(v.SOCKET_STATE.OPENING),e.config.openChatSocket(r).then((n=>{Promise.resolve().then(r),m.Cmd.setSocketState(v.SOCKET_STATE.PAIRING);const i=new p.Resolvable;return __LOG__(2)`Comms: Socket ${t} opened`,e.socketId=t,e.socket=n,e.softCloseSocket=()=>{e.softCloseSocket=null,e.socket&&(e.socket.close(),e.socket=null),i.resolve()},e.socketLoop.resetTimeoutAfter(1e4),e.deadSocketTimer.cancel(),e.maybeScheduleHealthCheck(),n.setOnFrame((r=>e.parseAndHandleStanza(t,r))),n.setOnClose((()=>{__LOG__(2)`Comms: Socket ${t} closed`,e.activePing&&t===e.activePing.socketId&&(e.activePing.handler.resolve(),e.activePing=null),e.filterPending((e=>e.attachedToSocketId===t)).forEach((t=>{e.removeHandler(t)})),t===e.socketId&&(e.socketId=0,e.socket=null,e.onConnectionChange("disconnected"),m.Cmd.socketStreamDisconnected(),i.resolve())})),e.onConnectionChange("connected"),(0,E.isRegistered)()&&(m.Cmd.setSocketState(v.SOCKET_STATE.CONNECTED),m.Cmd.openSocketStream()),e.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((t=>{"iq"===t.type?e.sendPendingIq(t):e.callStanza(t.stanza)})),i.promise})).catch((0,l.filteredCatch)(y.Disconnected,(()=>{__LOG__(2)`socketLoopIteration socket closed while in noise handshake`}))).catch((e=>{__LOG__(3)`socketLoopIteration failed ${e}`}))}function O(){return(O=(0,a.default)((function*(e,t){yield I(e,t)}))).apply(this,arguments)}function I(e,t){return new Promise((r=>{const n=N("sendStanzaAndWaitForAck");n.ackHandlers.push({type:"ack",parseAndTest:e=>{const r=o.AckParser.parse(e),n=(0,h.extractJidFromJidWithType)((0,g.widToJidWithType)(t.from)),a=null==t.participant?null:(0,g.widToDeviceJid)(t.participant);return!r.error&&(0,o.ackMatchesTemplate)(r.success,(0,i.default)((0,i.default)({},t),{},{from:n,participant:a}))?e:null},resolve:r,stanza:e,attachedToSocketId:0,orderedId:C++}),n.socket?n.callStanza(e):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,r,n){const i=yield new Promise((t=>{const n=N("sendIq"),i=e.attrs.id;if(!i||"string"!=typeof i)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);const a=n.socketId;if(r&&!a)return void t(Promise.reject(new y.Offline));const o={type:"iq",resolve:t,stanza:e,attachedToSocketId:r?a:0,orderedId:C++};n.pendingIqs.set(i,o),n.socket?n.sendPendingIq(o):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}));return(0,d.parseIqResponse)(i,t,n)}))).apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t){const r=N("sendPing"),n=e.attrs.id;if(!n||"string"!=typeof n)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!r.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(r.activePing&&r.activePing.socketId===r.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();r.activePing&&r.activePing.handler.resolve();const i=new p.Resolvable;r.activePing={socketId:r.socketId,stanzaId:n,handler:i},r.callStanza(e);const a=yield i.promise;return a&&(0,d.parseIqResponse)(a,t)}))).apply(this,arguments)}function N(e){if(b)return b;throw new Error(`Comms::${e} called before startComms`)}function L(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,_.decodeAsString)(e.attrs.id)||null}return null}},23368:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{id:t,from:r,t:n}=e.attrs;"message"===e.attrs.class&&function(e,t,r){const n=new i.default({fromMe:!0,remote:t,id:e}),a=String(n);(0,s.getTable)().get(a).then((e=>l.MessagePropertyType.cast(null==e?void 0:e.messageRangeIndex.split("_")[1]))).then((e=>(0,s.getTable)().merge(a,{messageRangeIndex:(0,l.craftMessageRangeIndex)(t.toString(),!1,e===l.MessagePropertyType.SystemMessage,r)}))).catch((e=>{throw __LOG__(4,!0,new Error,!0)`processAckForOutgoingMessage: failed to update in storage`,SEND_LOGS("message processAckForOutgoingMessage failed"),e})),(0,o.checkAndRemoveActiveMessageRanges)(n,r)}(String(t),(0,a.createWid)(String(r)),parseInt(n,10))};var i=n(r(65212)),a=r(45454),o=r(87845),s=r(90981),l=r(12896)},29100:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockSendPing=function(){return d.apply(this,arguments)},t.sendPing=function(){const e=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,o.generateId)()},(0,o.wap)("ping",null));(0,l.sendPing)(e,c).then((e=>{(null==e?void 0:e.success)&&u(e.result)}))};var i=n(r(48926)),a=r(92844),o=r(31914),s=r(71914),l=r(24747);const c=new s.WapParser("ping",(e=>e.attrTime("t")));function d(){return(d=(0,i.default)((function*(){const e=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,o.generateId)()},(0,o.wap)("ping",null)),t=yield(0,l.sendPing)(e,c);(null==t?void 0:t.success)&&u(t.result)}))).apply(this,arguments)}function u(e){const t=Math.round(Date.now()/1e3-e);(0,a.setClockSkew)(t)}},39410:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_JID=function(e){if(!(e instanceof s.default&&(e.isUser()||e.isGroup()||e.isBroadcast())))throw Error(`CHAT_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,"c.us"===e.server?i.WA_USER_JID_SUFFIX:e.server)},t.DEVICE_JID=function(e){if(!(e instanceof s.default&&e.isUser()))throw Error(`DEVICE_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.createAD(e.user,e.agent,e.device)},t.GROUP_CALL_JID=function(e){if(!(e instanceof s.default&&e.isGroupCall()))throw Error(`GROUP_CALL_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,e.server)},t.GROUP_JID=function(e){if(!(e instanceof s.default&&e.isGroup()))throw Error(`GROUP_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,e.server)},t.JID=function(e){if(!(e instanceof s.default))throw Error(`JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);if(null!=e.device&&0!==e.device||null!=e.agent&&0!==e.agent)return o.WapJid.createAD(e.user,e.agent,e.device);return o.WapJid.create(e.user,e.server)},t.USER_JID=function(e){if(!(e instanceof s.default&&e.isUser()))throw Error(`USER_JID: invalid jid type: ${e instanceof s.default?e.toString():"Not an instance of WID"}`);return o.WapJid.create(e.user,i.WA_USER_JID_SUFFIX)},t.wapNodeToVoipXml=t.voipXmlToWapNode=void 0;var i=r(52230),a=r(31914),o=r(45506),s=n(r(89867));t.voipXmlToWapNode=e=>{if(!e||!Array.isArray(e)||3!==e.length)throw Error("Invalid VOIP xml node");return function e(t){if(!t)return null;if(Array.isArray(t)){const r=t[0],n=t[1];let i;n&&Object.keys(n).map((e=>{i||(i={});let t=n[e];if(!t)throw Error("Attribute value is null");if("object"==typeof t){if(t.type!==o.WAP_JID_SUBTYPE.JID&&!o.WAP_JID_SUBTYPE.JID_AD)throw Error("Invalid attribute value type");t=new o.WapJid(t)}i[e]=t}));const s=t[2];let l=null;Array.isArray(s)&&s.length>0&&(l="number"==typeof s[0]?new Uint8Array(s):s.map(e).filter((e=>e)));const c=l;return new a.WapNode(r,i,c)}return t}(e)};t.wapNodeToVoipXml=e=>function e(t){const r=[];return r.push(t.tag),r.push(t.attrs||{}),Array.isArray(t.content)&&0===t.content.filter((e=>!Array.isArray(e)))?r.push(t.content):Array.isArray(t.content)?r.push(t.content.map((t=>e(t)))):null!=t.content?t.content instanceof Uint8Array?r.push(Array.from(t.content)):r.push(t.content):r.push(null),r}(e)},98969:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_IV_SIZE=void 0,t.decryptMediaRetryNotification=function(){return d.apply(this,arguments)},t.encryptServerErrorReceipt=function(e,t,r){return function(){return u.apply(this,arguments)}(e,t,function(e){__LOG__(2)`encodeServerErrorReceipt`;const t=new a.Binary;return(0,l.encodeProtobuf)(c.ServerErrorReceiptSpec,e,t),t.readByteArray()}({stanzaId:t}),r)};var i=n(r(48926)),a=r(8584),o=r(81576),s=r(84902),l=r(60980),c=r(16258);function d(){return(d=(0,i.default)((function*(e,t,r,n){const i=yield p(e,t,r,n);return(0,s.decodeProtobuf)(c.MediaRetryNotificationSpec,i)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,r,n){const i=(null==n?void 0:n.slice())||m(),{key:a,params:o}=yield h(e,t,i);return{ciphertext:yield self.crypto.subtle.encrypt(o,a,r),iv:i}}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r,n){const{key:i,params:a}=yield h(e,t,r);return self.crypto.subtle.decrypt(a,i,n)}))).apply(this,arguments)}const _="WhatsApp Media Retry Notification";function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t,r){const n=yield(0,o.extractAndExpand)(e,_,32),i=new a.Binary;i.write(t);const s=i.readByteArray();return{key:yield self.crypto.subtle.importKey("raw",new Uint8Array(n),"AES-GCM",!1,["encrypt","decrypt"]),params:{name:"AES-GCM",iv:r,additionalData:s}}}))).apply(this,arguments)}function m(){const e=new Uint8Array(12);return self.crypto.getRandomValues(e),e}t.ENC_IV_SIZE=12},16104:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getFanOutList=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(9108),s=r(99234);function l(){return(l=(0,i.default)((function*(e){let{wids:t}=e;const r=yield(0,o.getDeviceIds)(t.map((e=>e.user))),n=[],i=(0,s.assertGetMe)();return r.forEach(((e,r)=>{if(e){const{devices:t,id:r}=e;t.forEach((e=>{const t=(0,a.createDeviceWidFromUserAndDevice)(r,e);t.equals(i)||n.push(t)}))}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`getFanOutList: no device is found, just send to the primary device`;const e=(0,a.toUserWid)(t[r]);e.equals(i)||n.push(e)}})),n}))).apply(this,arguments)}},86791:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateGroupMetadataTable=function(){return s.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(99069);function s(){return(s=(0,a.default)((function*(e){let{groupInfos:t}=e,r=[];yield(0,o.getStorage)().lock(["group-metadata"],function(){var e=(0,a.default)((function*(e){let[n]=e;const a=yield n.bulkGet(t.map((e=>e.id.toString())));return r=t.map(((e,t)=>{var r,n,o,s,l;const c=a[t];let d={subject:e.subject,subjectTime:e.subjectTime||0},u={announce:e.announce,a_v_id:e.a_v_id||0},p={desc:e.desc,descId:e.descId,descOwner:null===(r=e.descOwner)||void 0===r?void 0:r.toString(),descTime:e.descTime||0},f=[];if(c){const e=c.subjectTime||0,t=c.a_v_id||0,r=c.descTime||0;e>d.subjectTime&&(d={subject:c.subject,subjectTime:e}),t>u.a_v_id&&(u={announce:c.announce,a_v_id:t}),r>p.descTime&&(p={desc:c.desc,descId:c.descId,descOwner:c.descOwner,descTime:r}),f=c.unjoinedSubgroups}return(0,i.default)((0,i.default)((0,i.default)({id:e.id.toString(),creation:e.creation,owner:null===(n=e.owner)||void 0===n?void 0:n.toString(),restrict:e.restrict,noFrequentlyForwarded:e.noFrequentlyForwarded,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,size:e.size||0,support:null!==(o=e.support)&&void 0!==o&&o,suspended:null!==(s=e.suspended)&&void 0!==s&&s,parentGroup:null===(l=e.parentGroup)||void 0===l?void 0:l.toString(),isParentGroup:e.parent,defaultSubgroup:e.defaultSubgroup,unjoinedSubgroups:f},d),p),u)})),n.bulkCreateOrMerge(r)}));return function(){return e.apply(this,arguments)}}())}))).apply(this,arguments)}},51727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirty=function(e){let{group:t}=e;return(0,f.getStorage)().lock(["participant"],(e=>{let[r]=e;return r.merge(String(t),{deviceSyncComplete:!1})}))},t.modifyGroupParticipant=function(e){let{group:t,oldId:r,newId:n,prevVersion:s,newVersion:l}=e;const c=String(t);return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[t]=e;const a=yield t.get(c);if(!a)throw new u.GroupUnSyncedError(`modifyGroupParticipant: group participant info missing for group ${c}`);if(a.version&&(null==s||s!==a.version))throw new u.GroupUnSyncedError(`modifyGroupParticipant: prev version info missing for group ${c}`);return t.createOrReplace(function(e,t,r,n){const a=String(t),s=String(r),l=new Map(e.senderKey),c=e.participants.filter((e=>e!==a)).concat(s);Array.from(l.keys()).forEach((e=>{const r=(0,o.createWid)(e).user;t.user===r?l.delete(e):l.set(e,!1)})),l.set(s,!1);const d=e.admins.map((e=>e===a?s:e));return(0,i.default)((0,i.default)({},e),{},{participants:c,senderKey:l,admins:d,version:n,rotateKey:!0})}(a,r,n,l))}));return function(){return e.apply(this,arguments)}}())},t.removeParticipantInfo=h,t.replaceParticipants=function(e){let{group:t,participants:r,admins:n,deviceIds:i,version:a}=e;const o=t.toString();return(0,f.getStorage)().lock(["participant"],(e=>{let[t]=e;return t.get(o).then((e=>e?t.createOrReplace(function(e,t,r,n,i){let a=e.rotateKey;const o=e.senderKey,l=new Map;n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e),r=o.get(t);null==r?l.set(t,!1):(l.set(t,r),o.delete(t))})),0!==o.size&&(a=!0);return{groupId:e.groupId,senderKey:l,participants:t.map(String),admins:r.map(String),rotateKey:a,version:i,deviceSyncComplete:!0}}(e,r,n,i,a)):t.create(function(e,t,r,n,i){const a=new Map;return n.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);a.has(t)||a.set(t,!1)})),{groupId:e,senderKey:a,participants:t.map(String),admins:r.map(String),rotateKey:!1,version:i,deviceSyncComplete:!0}}(o,r,n,i,a))))}))},t.updateGroupParticipantTableWithoutDeviceSync=function(){return _.apply(this,arguments)},t.updateParticipants=function(e,t){const{participants:r,version:n,prevVersion:i}=t,o=e.toString();return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[a]=e;const l=yield a.get(o);if(!l)throw new u.GroupUnSyncedError(`updateParticipants: group participant info missing for group ${o}, action ${t.action}`);if(l.version&&(null==i||i!==l.version))throw new u.GroupUnSyncedError(`updateParticipants: prevVersion info missing for group ${o}, action ${t.action}`);switch(t.action){case u.PARTICIPANT_OPERATION.ADD:return a.createOrReplace(function(e,t,r,n){const i=new Map(e.senderKey);return r.forEach((e=>{if(e.equals((0,s.assertGetMe)()))return;const t=String(e);i.set(t,!1)})),{groupId:e.groupId,senderKey:i,participants:e.participants.concat(t.map(String)),admins:e.admins,rotateKey:e.rotateKey,version:n,deviceSyncComplete:e.deviceSyncComplete}}(l,r,t.deviceIds,n));case u.PARTICIPANT_OPERATION.REMOVE:return a.createOrReplace(h(l,r,n));case u.PARTICIPANT_OPERATION.DEMOTE:return a.createOrReplace(g(l,r,n,u.PARTICIPANT_OPERATION.DEMOTE));case u.PARTICIPANT_OPERATION.PROMOTE:return a.createOrReplace(g(l,r,n,u.PARTICIPANT_OPERATION.PROMOTE));default:throw new Error(`updateParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}())};var i=n(r(81109)),a=n(r(48926)),o=r(45454),s=r(99234),l=r(57701),c=n(r(11339)),d=r(76214),u=r(70405),p=r(99039),f=r(99069);function _(){return(_=(0,a.default)((function*(e){let{groupInfos:t}=e;const r=yield(0,d.getParticipantTable)().bulkGet(t.map((e=>e.id.toString()))),n=new Map;r.forEach((e=>e&&n.set(e.groupId,e.senderKey)));const i=t.map((e=>{var t;const r=[],i=[],a=e.id.toString(),o=n.get(a)||new Map;return null===(t=e.participants)||void 0===t||t.forEach((e=>{e.isAdmin&&i.push(e.id),r.push(e.id),o.set(String(e.id),!1)})),{groupId:a,participants:r.map(String),admins:i.map(String),senderKey:o,rotateKey:!1,deviceSyncComplete:!1}}));return(0,d.getParticipantTable)().bulkCreateOrReplace(i)}))).apply(this,arguments)}function h(e,t,r){const n=new Map(e.senderKey);let i=!(0,l.rotateSenderKeyIfSentEnabled)()||e.rotateKey;n.forEach(((e,r)=>{const a=(0,o.createWid)(r).user;t.some((e=>e.user===a))&&(i=i||e,n.delete(r))})),i&&n.forEach(((e,t)=>n.set(t,!1)));const a=t.map(String);return!e.rotateKey&&i&&(0,p.postSenderKeyExpiredMetric)({chatId:e.groupId,deviceCount:e.senderKey.size,expiryReason:c.default.EXPIRY_REASON.USER_LEAVE}),{groupId:e.groupId,senderKey:n,participants:e.participants.filter((e=>!a.includes(e))),admins:e.admins.filter((e=>!a.includes(e))),rotateKey:i,version:r,deviceSyncComplete:e.deviceSyncComplete}}function g(e,t,r,n){let i=e.admins;const a=t.map(String);return n===u.PARTICIPANT_OPERATION.DEMOTE?i=e.admins.filter((e=>!a.includes(e))):n===u.PARTICIPANT_OPERATION.PROMOTE&&(i=e.admins.concat(a)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,admins:i,rotateKey:e.rotateKey,version:r,deviceSyncComplete:e.deviceSyncComplete}}},70405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PARTICIPANT_OPERATION=t.GroupUnSyncedError=void 0;const r=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote"});t.PARTICIPANT_OPERATION=r;class n extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}t.GroupUnSyncedError=n},73184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHATSAPP_GRAPHQL_ENDPOINT=t.WHATSAPP_GRAPHQL_ACCESS_TOKEN=void 0;t.WHATSAPP_GRAPHQL_ENDPOINT="https://graph.whatsapp.com/graphql";t.WHATSAPP_GRAPHQL_ACCESS_TOKEN="WA|438455091201276|159a64e893c734301a4db315bba22e04"},7312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistedQueries=void 0;t.PersistedQueries={queryCatalogProductQuery:"4859472260800606",queryProductListCatalogQuery:"4751485608268572",queryCatalogQuery:"7084293094978569"}},48089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLServerError=void 0;class r extends Error{constructor(e){super(),this.name="GraphQLServerError",this.source=e}}t.GraphQLServerError=r},1321:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchQuery=function(){return d.apply(this,arguments)},t.getLocaleVariable=function(){return l.default.getFullLocale().replace("-","_")},t.graphql=function(){throw new Error("Invariant Violation")};var i=n(r(6479)),a=n(r(48926)),o=r(48089),s=r(52148),l=n(r(43725));const c=["eventLogger"];function d(){return(d=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{eventLogger:n}=r,a=(0,i.default)(r,c);const{fetchQuery:l}=yield(0,s.requireRelayRuntime)();try{const r=yield l(yield(0,s.getEnvironment)(),e,t,a).toPromise();return null==n||n.success(),r}catch(e){throw e instanceof o.GraphQLServerError&&(null==n||n.failure(e.source.errors)),e}}))).apply(this,arguments)}},52148:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironment=function(){return d.apply(this,arguments)},t.requireRelayRuntime=l;var i=n(r(48926)),a=r(73184),o=r(7312),s=r(48089);function l(){return r.e(4815).then(r.t.bind(r,44311,23)).then((e=>e.default))}let c;function d(){return(d=(0,i.default)((function*(){if(null!=c)return c;const{Environment:e,Network:t,RecordSource:r,Store:n}=yield l(),d={Accept:"application/json","Content-Type":"application/json"},u=function(){var e=(0,i.default)((function*(e,t){const r={access_token:a.WHATSAPP_GRAPHQL_ACCESS_TOKEN,doc_id:o.PersistedQueries[e.name],variables:t},n=yield fetch(a.WHATSAPP_GRAPHQL_ENDPOINT,{method:"POST",headers:d,body:JSON.stringify(r)}),i=yield n.json();if(null!=(null==i?void 0:i.errors))throw new s.GraphQLServerError({errors:i.errors});return i}));return function(){return e.apply(this,arguments)}}();return c=new e({network:t.create(u),store:new n(new r)}),c}))).apply(this,arguments)}},99805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){throw new Error("Invariant Violation")}},79341:e=>{"use strict";const t={fragment:{argumentDefinitions:r=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryCatalogProductQuery",selections:a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetProductResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"product",plural:!1,selections:[{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:r,kind:"Operation",name:"queryCatalogProductQuery",selections:a},params:{id:"queryCatalogProductQuery",metadata:{},name:"queryCatalogProductQuery",operationKind:"query",text:null}};var r,n,i,a;t.hash="789bf89862b4e217474bfb7e30300896",e.exports=t},25173:e=>{"use strict";const t={fragment:{argumentDefinitions:r=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"queryCatalogQuery",selections:o=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product_catalog",plural:!1,selections:[n={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[{kind:"InlineFragment",selections:[n,i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null}],type:"XWAProductCatalogGetResponseSuccessProductCatalogProduct",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWAProductCatalogGetProductResponseSuccessProductCatalogProduct",abstractKey:null}],type:"XWAICatalogProduct",abstractKey:"__isXWAICatalogProduct"}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalogPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:r,kind:"Operation",name:"queryCatalogQuery",selections:o},params:{id:"queryCatalogQuery",metadata:{},name:"queryCatalogQuery",operationKind:"query",text:null}};var r,n,i,a,o;t.hash="1fc0bd8ed5b61085c7f309bf1755d75d",e.exports=t},69808:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseABProps=function(e){const t=new Map;e.forEach((e=>{if("ExperimentConfig"===e.mixinName){const{configCode:r,configValue:n,configExpoKey:i}=e;t.set(r,{configValue:n,configExpoKey:i})}}));const r=new Map;return Object.keys(n.ABPropConfigs).map((e=>{const i=n.ABPropConfigs[e][0],a=t.get(i),o=null==a?void 0:a.configValue,s=null==a?void 0:a.configExpoKey;r.set(i,{configValue:o,configExpoKey:null==s?null:s.toString()})})),r};var n=r(56042)},89981:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncABProps=h,t.syncABPropsTask=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(13959),o=r(4276),s=r(31914),l=r(34541),c=r(86945),d=r(64971),u=r(69808),p=r(88102),f=r(24747),_=r(80024);function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){var e;let t,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&(t=(0,d.getHash)());const n=(0,s.wap)("iq",{xmlns:"abt",id:(0,s.generateId)(),type:"get",to:s.S_WHATSAPP_NET},(0,s.wap)("props",{protocol:"1",hash:r&&null!=t?(0,s.CUSTOM_STRING)(t):s.DROP_ATTR})),i=yield(0,f.sendSmaxIq)(n,o.parseGetExperimentConfigResponseSuccess);if(!i.success||null==i.result||!i.result.success)return!1;const a=i.result.value,c=Date.now();if((0,_.updateGlobalABKey)(null!==(e=a.propsAbKey)&&void 0!==e?e:""),(0,d.updateAttributesLocalStorage)(a.propsAbKey,a.propsHash,a.propsRefresh,c),null==a.propsHash)return!1;try{return yield(0,l.updateABPropConfigs)((0,u.parseABProps)(a.propsProp)),!0}catch(e){__LOG__(4,!0,new Error,!0)`update ABProps config table failed`,SEND_LOGS("update ABProps config table failed when syncing ABProps")}return!1}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){const e=(0,d.isABPropsAfterFirstSync)();let t=3;for(;t-- >0;)try{if(yield h(e))return yield(0,c.updateABPropsFromStorage)(),void p.Cmd.abPropsUpdate()}catch(e){0===t&&(__LOG__(4,!0,new Error,!0)`failed to sync ABProps`,SEND_LOGS("failed to sync ABProps")),yield(0,a.delayMs)(1e4*Math.random())}}))).apply(this,arguments)}},41075:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ACCOUNT_SYNC_TYPE=void 0,t.getAndUpdateProfilePicture=function(){const e=(0,a.default)(p.ProfilePicThumbCollection.get((0,d.getMeUser)()),"// $FlowFixMe[incompatible-call] (T102990553) Upgrade to flow 0.161.1\nProfilePicThumbCollection.get(getMeUser())");return p.ProfilePicThumbCollection.resyncPictures([e])},t.getDevices=function(e){return(0,s.syncDeviceListJob)([(0,d.assertGetMe)()],e,null)},t.updateBlocklist=function(){return v.apply(this,arguments)},t.updateDefaultDisappearingMode=function(){return T.apply(this,arguments)},t.updatePrivacySettings=function(){return S.apply(this,arguments)},t.updateTosState=function(e){return e.forEach((e=>{m.TosManager.setState(e.id,e.state?"ACCEPTED":"NOT_ACCEPTED")})),Promise.resolve()};var i=n(r(48926)),a=n(r(45095)),o=r(68387),s=r(10823),l=r(32826),c=r(91036),d=r(99234),u=r(61319),p=r(82039),f=r(92913),_=r(99192),h=r(4831),g=r(14810),m=r(70768);const y=r(76672)({BLOCKLIST:"blocklist",DEVICES:"devices",DISAPPEARING_MODE:"disappearing_mode",PICTURE:"picture",PRIVACY:"privacy",STATUS:"status",TOS:"tos"});function E(e,t){switch(t){case u.PrivacyDisallowedListType.About:return e.about===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.GroupAdd:return e.groupAdd===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.LastSeen:return e.lastSeen===o.VISIBILITY.contact_blacklist;case u.PrivacyDisallowedListType.ProfilePicture:return e.profilePicture===o.VISIBILITY.contact_blacklist}}function S(){return(S=(0,i.default)((function*(){const e=yield(0,h.getPrivacy)();(0,d.setUserPrivacySettings)(e);const t=[u.PrivacyDisallowedListType.About,u.PrivacyDisallowedListType.GroupAdd,u.PrivacyDisallowedListType.LastSeen,u.PrivacyDisallowedListType.ProfilePicture].filter((t=>E(e,t))),r=yield(0,g.syncPrivacyDisallowedLists)(t);return{privacySettings:e,privacyDisallowedRows:r}}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=yield(0,f.fetchAndUpdateBlocklist)();e.dhash&&(l.BlocklistCollection.toArray().forEach((e=>l.BlocklistCollection.remove(e))),e.wids&&e.wids.forEach((e=>{l.BlocklistCollection.gadd(e)})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield(0,_.queryDisappearingMode)();yield(0,c.updateDisappearingMode)((0,d.getMaybeMeUser)(),e.duration,e.t)}))).apply(this,arguments)}t.ACCOUNT_SYNC_TYPE=y},68268:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdvToSystemBridgeImpl=void 0,t.getLastADVDeviceInfoCheckTime=v,t.runAdvDeviceInfoCheck=I,t.scheduleAdvDeviceInfoCheck=M;var i=n(r(48926)),a=r(52230),o=r(92844),s=r(45454),l=r(86945),c=r(22683),d=r(9108),u=r(99234),p=n(r(11339)),f=r(97153),_=r(60998),h=r(17041),g=r(65044);const m=25*o.HOUR_SECONDS;class y{constructor(e){this.advToSystemBridge=e}run(e){var t=this;return(0,i.default)((function*(){const r=t.advToSystemBridge,n=yield r.getUsersForExpiration(e),{usersExpired:i,usersCloseToExpiration:a}=n;r.removeCompanions(i),r.sendADVStoredTimestampExpiredEvents(i,e);const o=Array.from(i.keys()).concat(Array.from(a.keys())).filter((e=>!r.canRemoveUserDevices(e)));return r.sendOrQueueDeviceUsyncQuery(o).catch((()=>{})),r.recordLocalTimestamp()}))()}}class E{getNumDaysKeyIndexListExpiration(){return(0,l.getABPropConfigValue)("num_days_key_index_list_expiration")}getNumDaysBeforeDeviceExpiryCheck(){return(0,l.getABPropConfigValue)("num_days_before_device_expiry_check")}getUsersForExpiration(e){var t=this;return(0,i.default)((function*(){const r=yield(0,d.getAllDeviceLists)(),n=yield v(),i=t.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS,l=new Map,c=new Map;return r.forEach((r=>{r.deleted||function(e){return 1===e.devices.length&&e.devices[0].id===a.DEFAULT_DEVICE_ID}(r)||(!function(e,t,r,n){if(e-r.timestamp>=t)return!0;if(null!=r.expectedTsUpdateTs)return e-r.expectedTsUpdateTs>=m&&r.expectedTsLastDeviceJobTs!==n;return!1}(e,i,r,n)?function(e,t,r){if(e-r.timestamp>=t)return!0;if(null!=r.expectedTs)return r.expectedTs>r.timestamp;return!1}(e,i-t.getNumDaysBeforeDeviceExpiryCheck()*o.DAY_SECONDS,r)&&c.set((0,s.createUserWid)(r.id),r):l.set((0,s.createUserWid)(r.id),r))})),{usersExpired:l,usersCloseToExpiration:c}}))()}sendADVStoredTimestampExpiredEvents(e,t){e.forEach((e=>{const r=t-(e.timestamp+this.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS);if(r<0)return;const n=Math.round(r/o.HOUR_SECONDS);new p.default.AdvStoredTimestampExpired({advExpireTimeInHours:n}).commit()}))}sendOrQueueDeviceUsyncQuery(e){return(0,i.default)((function*(){return yield(0,f.addUserToPendingDeviceSync)(e.map((e=>e.toString()))),(0,f.doPendingDeviceSync)()}))()}canRemoveUserDevices(){return!1}removeCompanions(e){return Array.from(e.entries()).some((e=>{let[t,r]=e;t.user,(0,u.getMeUser)().user}))?(g.Socket.logout(),Promise.resolve()):Promise.all(Array.from(e.entries()).map((e=>{let[t,r]=e;return(0,h.clearDeviceRecord)(t,r.devices)})))}recordLocalTimestamp(){return Promise.resolve()}}let S;function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){if(null==S){yield(0,_.getTaskScheduledTime)("advDeviceInfoCheck")}return S}))).apply(this,arguments)}t.AdvToSystemBridgeImpl=E;const C=o.DAY_SECONDS,A="advDeviceInfoCheck";let b,P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){null!=b&&(clearTimeout(b),b=null);const e=c.Clock.localUnixTime(),t=yield v();let r=0,n=()=>Promise.resolve();null!=t&&(r=Math.max(C-(e-t),0),n=()=>(0,l.getABPropConfigValue)("adv_v2_m4_m5")?I():Promise.resolve()),b=setTimeout((0,i.default)((function*(){try{yield n()}catch(e){__LOG__(4,void 0,new Error,void 0,["adv_device_info_check"])`error running the adv device check job`}b=null,S=c.Clock.localUnixTime(),(0,_.updateTaskScheduledTime)(A,(0,o.castToUnixTime)(S)),M()})),1e3*r)}))).apply(this,arguments)}function I(){return null==P&&(P=new y(new E)),P.run(c.Clock.localUnixTime())}},56375:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockUser=function(e){if(f.ServerProps.mdBlocklistV2)return function(e){return E(e,!0)}(e);return function(e){const t=c.BlocklistCollection.map((e=>e.id));return t.push(e),g((0,a.default)(t))}(e)},t.unblockUser=function(e){if(f.ServerProps.mdBlocklistV2)return function(e){return E(e,!1)}(e);return function(e){const t=c.BlocklistCollection.map((e=>e.id));return t.splice(t.indexOf(e),1),g((0,a.default)(t))}(e)};var i=n(r(48926)),a=n(r(44908)),o=r(31914),s=r(71914),l=r(81663),c=r(32826),d=r(24747),u=r(99234),p=r(58052),f=r(64551),_=r(39410);const h=new s.WapParser("blockUser",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`sendBlocklist: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`sendBlocklist: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=0===e.length?(0,o.wap)("list",{name:"default"}):(0,o.wap)("list",{name:"default"},e.map((e=>(0,o.wap)("item",{action:"deny",type:"jid",value:(0,_.JID)(e),order:"1"})))),r=(0,o.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,_.JID)((0,u.assertGetMe)()),type:"set",id:(0,o.generateId)()},(0,o.wap)("query",null,t)),n=yield(0,d.sendIq)(r,h);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`sendBlocklist: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}return n.result}))).apply(this,arguments)}const y=new s.WapParser("blockUserV2ResponseParser",(e=>{var t;if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`blockUserV2ResponseParser: server response with ${r}, ${n}`,{errorCode:r,errorText:n}}__LOG__(2)`block/unblock user: success`;return{blockedUsers:null===(t=e.child("list"))||void 0===t?void 0:t.mapChildrenWithTag("item",(e=>(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid"))))}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const r=(0,p.getBlocklistHash)(),n=(0,o.wap)("iq",{xmlns:"blocklist",to:o.S_WHATSAPP_NET,type:"set",id:(0,o.generateId)()},(0,o.wap)("item",{dhash:null!=r?(0,o.CUSTOM_STRING)(r):o.DROP_ATTR,action:(0,o.CUSTOM_STRING)(t?"block":"unblock"),jid:(0,_.JID)(e)})),i=yield(0,d.sendIq)(n,y);if(!i.success){const{errorCode:e,errorText:t}=i;return __LOG__(3)`blockUnblockUserV2: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},8021:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.editBusinessProfile=function(){return f.apply(this,arguments)},t.updateCartEnabled=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer()})),d=new o.WapParser("commerceSettingsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("commerce_settings").child("cart").attrString("enabled")}));function u(e){let{note:t,timezone:r,config:n}=e;const i=[];for(const e in n){const t=n[e],{mode:r,hours:a}=t;if(a)for(const[t,n]of a)i.push({day_of_week:e,mode:r,open_time:t,close_time:n});else i.push({day_of_week:e,mode:r})}const o=[];return t&&o.push((0,a.wap)("business_hours_note",null,t)),o.push(...i.map((e=>(0,a.wap)("business_hours_config",{day_of_week:(0,a.CUSTOM_STRING)(e.day_of_week),mode:e.mode,open_time:e.open_time?(0,a.CUSTOM_STRING)(e.open_time.toString()):a.DROP_ATTR,close_time:e.close_time?(0,a.CUSTOM_STRING)(e.close_time.toString()):a.DROP_ATTR})))),(0,a.wap)("business_hours",{timezone:r?(0,a.CUSTOM_STRING)(r):a.DROP_ATTR},o)}function p(){return(p=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,smax_id:"25",xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"set"},(0,a.wap)("commerce_settings",null,(0,a.wap)("cart",{enabled:(0,a.CUSTOM_STRING)(e.toString())}))),r=yield(0,s.sendIq)(t,d);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){let{address:t,description:r,categories:n,email:i,website:o,businessHours:d}=e;const p=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"set"},(0,a.wap)("business_profile",{v:"3",mutation_type:"delta"},void 0!==t?(0,a.wap)("address",null,t):null,void 0!==r?(0,a.wap)("description",null,r):null,void 0!==i?(0,a.wap)("email",null,i):null,o&&0===o.length?(0,a.wap)("website",null):null,o&&o.length>0?(0,a.wap)("website",null,o[0]):null,o&&o.length>1?(0,a.wap)("website",null,o[1]):null,n?(0,a.wap)("categories",null,n.map((e=>(0,a.wap)("category",{id:(0,a.CUSTOM_STRING)(e.id)})))):null,d?u(d):null)),f=yield(0,s.sendIq)(p,c);if(!f.success)throw new l.ServerStatusCodeError(f.errorCode)}))).apply(this,arguments)}},16116:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleActivitiesForChatThreadLogging=function(e){var t,r;return __LOG__(2)`chat_thread_logging: handling ${e.length} message(s)`,null!==(t=null===(r=u())||void 0===r?void 0:r.eventStore.handleMessages(e))&&void 0!==t?t:Promise.resolve()},t.initChatThreadLogging=function(){return p.apply(this,arguments)},t.setThreadDsTimeframeOffset=function(){return f.apply(this,arguments)},t.setThreadIdUserSecret=function(e){var t,r;return __LOG__(2)`chat_thread_logging: setting thread_id_user_secret`,null!==(t=null===(r=u())||void 0===r?void 0:r.metadataStore.setSecret(e))&&void 0!==t?t:Promise.resolve(!1)},t.uploadChatThreadLoggingEvents=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(86945),s=r(36112),l=r(7217),c=r(65120);let d=null;function u(){return null==d&&__LOG__(4,void 0,new Error)`getChatThreadLoggingState: init incomplete!`,d}function p(){return(p=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=e&&(yield(0,o.getABPropConfigValue)("message_count_logging_md_enabled")),r=new c.ChatThreadLoggingMetadataLocalStorage,n=t?new s.ChatThreadLoggingEventStoreImpl(r):{handleMessages:()=>Promise.resolve(),getEvent:()=>Promise.resolve(),getBeforeInclusive:()=>Promise.resolve([]),deleteBeforeInclusive:()=>Promise.resolve(0)},i=t?new l.ChatThreadLoggingEventUploaderImpl(r,n):{uploadEvents:()=>Promise.resolve(0)},a=yield r.getOffset();return null!=a&&h(a),d={metadataStore:r,eventStore:n,eventUploader:i},Promise.resolve(d)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){var t,r;__LOG__(2)`chat_thread_logging: setting offset`;const n=null!==(t=yield null===(r=u())||void 0===r?void 0:r.metadataStore.setOffset(e))&&void 0!==t&&t;return n&&h(e),n}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){var t,r,n;if(null==(yield null===(t=u())||void 0===t?void 0:t.metadataStore.getOffset()))return void __LOG__(2)`chat_thread_logging: attempting to upload but offset is unset.`;null!=(yield null===(r=u())||void 0===r?void 0:r.metadataStore.getSecret())?yield null===(n=u())||void 0===n?void 0:n.eventUploader.uploadEvents(e):__LOG__(2)`chat_thread_logging: attempting to upload but secret is unset.`}))).apply(this,arguments)}function h(e){const t=(0,a.unixTime)();let r=t-t%86400+e-t;r<0&&(r+=a.DAY_SECONDS),setTimeout((0,i.default)((function*(){var t;yield null===(t=u())||void 0===t?void 0:t.eventUploader.uploadEvents(),h(e)})),1e3*r)}},61840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COUNT_FIELD_NAMES=t.COUNT_FIELDS=void 0,t.toMaybeCountActionType=function(e){if(!n.hasOwnProperty(e))return null;return e};const r={profileViews:0,statusViews:0,statusReplies:0,groupMembershipReplies:0,groupPrivateReplies:0,profileReplies:0,chatOverflowClicks:0},n=Object.freeze(r);t.COUNT_FIELDS=n;const i=Object.freeze(Object.keys(r));t.COUNT_FIELD_NAMES=i},85033:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeStartTs=u,t.generateThreadID=function(){return d.apply(this,arguments)},t.getThreadDs=function(e){return(0,s.toDate)((0,s.castToUnixTime)(e-8*s.HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")},t.shouldUpdateChatEvent=function(e,t,r){return u(e,t)>r};var i=n(r(48926)),a=r(15688),o=r(11141),s=r(92844);const l=new TextEncoder,c=e=>l.encode(e).buffer;function d(){return(d=(0,i.default)((function*(e,t,r){const n=c(t+r),i=yield(0,o.hmacSha256)(e,n);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function u(e,t){const r=t%s.DAY_SECONDS,n=t-r;return r>=e?n+e:n-s.DAY_SECONDS+e}},36112:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventStoreImpl=void 0,t._computeStartTs=function(e,t){const r=t%s.DAY_SECONDS,n=t-r;if(r>e)return n+e;return n-s.DAY_SECONDS+e};var i=n(r(81109)),a=n(r(48926)),o=r(57319),s=r(92844),l=n(r(89867)),c=r(45454),d=r(61840),u=r(60112),p=r(85033),f=r(35673);t.ChatThreadLoggingEventStoreImpl=class{constructor(e,t){this.metadataStore=e,this._getExistingChat=r(9025).getExisting,this._cachedChanges=new Map,this._updateIntervalSeconds=null!=t?t:5,this._shiftTimer=new o.ShiftTimer((()=>{this._flush()}))}handleMessages(e){var t=this;return(0,a.default)((function*(){const r=yield t.metadataStore.getOffset();if(null==r)return void __LOG__(2)`ChatThreadLoggingEventStoreImpl: handleMessages: offset unset.`;const n=yield t.metadataStore.getLastUploadedStartTs();__LOG__(2)`ChatThreadLoggingEventStoreImpl: lastUploadedStartTs=${n}`,e.forEach((e=>{if(!(0,p.shouldUpdateChatEvent)(r,e.ts,n))return;const a=(0,p.computeStartTs)(r,e.ts),o=e.chatId.toString({legacy:!0}),s=o+"_"+String(a),l=t._cachedChanges.get(s),c=null!=l?l:(0,i.default)((0,i.default)({},d.COUNT_FIELDS),{},{startTs:a,chatId:o,addMsgsSent:0,addMsgsReceived:0,addViewOnceMsgsSent:0,addViewOnceMsgsReceived:0,addViewOnceMsgsOpened:0,addCallOffersSent:0,addCallOffersReceived:0,addTotalCallDuration:0});null==l&&t._cachedChanges.set(s,c);const u=(0,d.toMaybeCountActionType)(e.activityType);if(null!=u)c[u]+=1;else switch(e.activityType){case"msgSend":c.addMsgsSent+=1,e.isViewOnce&&(c.addViewOnceMsgsSent+=1);break;case"msgReceive":c.addMsgsReceived+=1,e.isViewOnce&&(c.addViewOnceMsgsReceived+=1);break;case"viewOnceOpen":c.addViewOnceMsgsOpened+=1;break;case"voipCall":e.outgoing?c.addCallOffersSent+=1:c.addCallOffersReceived+=1,c.addTotalCallDuration+=e.durationInSeconds;break;default:__LOG__(3)`Passed event store info type not valid: ${e.activityType}`}})),yield t._setFlushIfNecessary()}))()}_setFlushIfNecessary(){this._shiftTimer.onOrBefore(1e3*this._updateIntervalSeconds)}_flush(){var e=this;return(0,a.default)((function*(){const t=Array.from(e._cachedChanges.values());e._cachedChanges.clear(),yield(0,u.createOrUpdateChatEvents)(t)}))()}_populateEvents(e){var t=this;return(0,a.default)((function*(){const r=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return[e,yield t._getExistingChat((0,c.createWid)(e.chatId))]}));return function(){return e.apply(this,arguments)}}()));return Promise.all(r.map(function(){var e=(0,a.default)((function*(e){var t,r,n,a,o,s,c;let[d,u]=e;const p=l.default.isGroup(d.chatId),_=p?{isAGroup:p,groupSize:null!==(t=null==u||null===(r=u.groupMetadata)||void 0===r?void 0:r.participants.length)&&void 0!==t?t:1}:{isAGroup:p,isAContact:yield(0,f.isAddressBookContact)(d.chatId)},h=(null!==(n=null==u?void 0:u.pin)&&void 0!==n?n:0)>0,g=null!==(a=null==u?void 0:u.archive)&&void 0!==a&&a,m=null!==(o=null==u?void 0:u.getStarredMsgs().length)&&void 0!==o?o:0,y=null!==(s=null==u?void 0:u.unreadCount)&&void 0!==s?s:0,E=0!==(null!==(c=null==u?void 0:u.muteExpiration)&&void 0!==c?c:0);return(0,i.default)((0,i.default)({},d),{},{isPinned:h,isArchived:g,contactInfo:_,messagesStarred:m,messagesUnread:y,isMuted:E})}));return function(){return e.apply(this,arguments)}}()))}))()}getEvent(e,t){var r=this;return(0,a.default)((function*(){r._cachedChanges.size>0&&(yield r._flush());const n=yield(0,u.getChatEvent)(e,t);return null==n?null:(yield r._populateEvents([n]))[0]}))()}getBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),t._populateEvents(yield(0,u.getBeforeInclusive)(e))}))()}deleteBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),(0,u.deleteBeforeInclusive)(e)}))()}}},7217:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventUploaderImpl=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(92844),l=r(61840),c=r(85033),d=n(r(11339));t.ChatThreadLoggingEventUploaderImpl=class{constructor(e,t){this.eventStore=t,this.metadataStore=e}uploadEvents(e){var t=this;return(0,a.default)((function*(){var r,n;const u=null===(r=null==e?void 0:e.purgeAfter)||void 0===r||r,p=yield t.metadataStore.getOffset();if(null==p)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: offset not in store!`,-1;const f=null!==(n=null==e?void 0:e.lastStartTs)&&void 0!==n?n:(0,c.computeStartTs)(p,(0,s.unixTime)()-s.DAY_SECONDS);if(null==t.secret){const e=yield t.metadataStore.getSecret();if(null==e)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: secret not in store!`,-1;t.secret=e}const _=yield t.eventStore.getBeforeInclusive(f);if(yield Promise.all(_.map(function(){var e=(0,a.default)((function*(e){const r=(0,c.getThreadDs)(e.startTs),n=e.contactInfo;new d.default.ChatMessageCounts((0,i.default)((0,i.default)({},l.COUNT_FIELD_NAMES.reduce(((t,r)=>(t[r]=e[r],t)),{})),{},{messagesSent:e.msgsSent,messagesReceived:e.msgsReceived,viewOnceMessagesSent:e.viewOnceMsgsSent,viewOnceMessagesReceived:e.viewOnceMsgsReceived,viewOnceMessagesOpened:e.viewOnceMessagesOpened,threadDs:r,threadId:yield(0,c.generateThreadID)((0,o.default)(t.secret,"_this.secret"),e.chatId,r),isAGroup:e.contactInfo.isAGroup,groupSize:n.isAGroup?n.groupSize:void 0,isAContact:n.isAGroup?void 0:n.isAContact,isArchived:e.isArchived,isPinned:e.isPinned,messagesStarred:e.messagesStarred,messagesUnread:e.messagesUnread,chatMuted:e.isMuted?d.default.CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:d.default.CHAT_MUTED_TYPE.NOT_MUTED,callOffersSent:e.callOffersSent,callOffersReceived:e.callOffersReceived,totalCallDuration:e.totalCallDuration})).commit()}));return function(){return e.apply(this,arguments)}}())),u){const e=yield t.eventStore.deleteBeforeInclusive(f);e!==_.length&&__LOG__(4,void 0,new Error)`uploadEvents: uploaded ${_.length} events but only deleted ${e} (they should be the same!)`}return yield t.metadataStore.setLastUploadedStartTs(f),_.length}))()}}},65120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingMetadataLocalStorage=void 0;var n=r(15688),i=r(58052);t.ChatThreadLoggingMetadataLocalStorage=class{constructor(){null==(0,i.getChatThreadLoggingLastUploadedStartTs)()&&(0,i.setChatThreadLoggingLastUploadedStartTs)(0)}setOffset(e){return(0,i.setChatThreadLoggingOffset)(e),Promise.resolve(!0)}getOffset(){return Promise.resolve((0,i.getChatThreadLoggingOffset)())}setSecret(e){return(0,i.setChatThreadLoggingSecretB64)((0,n.encodeB64)(e)),Promise.resolve(!0)}getSecret(){const e=(0,i.getChatThreadLoggingSecretB64)();return null==e?Promise.resolve():Promise.resolve((0,n.decodeB64)(e))}setLastUploadedStartTs(e){return(0,i.setChatThreadLoggingLastUploadedStartTs)(e),Promise.resolve(!0)}getLastUploadedStartTs(){var e;return Promise.resolve(null!==(e=(0,i.getChatThreadLoggingLastUploadedStartTs)())&&void 0!==e?e:0)}}},99609:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDirtyBits=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747);const l=new o.WapParser("cleanDirtyReplyParser",(e=>(e.assertAttr("type","result"),{})));function c(){return(c=(0,i.default)((function*(e){if(0===e.length)return;const t=e.map((e=>(0,a.wap)("clean",{type:(0,a.CUSTOM_STRING)(e.type),timestamp:(0,a.INT)(e.timestamp)}))),r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:(0,a.generateId)()},t);try{yield(0,s.sendIq)(r,l),__LOG__(2)`clearDirtyBits: success for type: ${e.map((e=>e.type)).join(",")}`}catch(e){__LOG__(3)`clearDirtyBits: failed with error`}}))).apply(this,arguments)}},58853:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeMaybeMediaType=t.encodeMaybeDecryptFail=t.CIPHERTEXT_VERSION=void 0,t.encodeMediaType=s,t.maybeEncoder=l,t.mediaTypeFromProtobuf=function e(t){if(t.deviceSentMessage){const{message:r}=t.deviceSentMessage;return r?e(r):null}if(t.ephemeralMessage){const{message:r}=t.ephemeralMessage;return r?e(r):null}if(t.viewOnceMessage){const{message:r}=t.viewOnceMessage;return r?e(r):null}if(t.imageMessage)return a.MediaType.Photo;if(t.stickerMessage)return a.MediaType.Sticker;if(t.locationMessage)return a.MediaType.LiveLocation;if(t.contactMessage)return a.MediaType.Contact;if(t.contactsArrayMessage)return a.MediaType.ContactArray;if(t.documentMessage)return a.MediaType.Document;if(t.audioMessage)return t.audioMessage.ptt?a.MediaType.Ptt:a.MediaType.Audio;if(t.videoMessage)return t.videoMessage.gifPlayback?a.MediaType.Gif:a.MediaType.Video;if(t.buttonsMessage)return a.MediaType.Button;if(t.buttonsResponseMessage)return a.MediaType.ButtonResponse;if(t.listMessage)return a.MediaType.List;if(t.listResponseMessage)return a.MediaType.ListResponse;if(t.orderMessage)return a.MediaType.Order;if(t.productMessage)return a.MediaType.Product;if(t.groupInviteMessage)return a.MediaType.Url;return null},t.metricsCiphertextType=function(e){switch(e){case a.CiphertextType.Skmsg:return o.default.E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE;case a.CiphertextType.Pkmsg:return o.default.E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE;case a.CiphertextType.Msg:return o.default.E2E_CIPHERTEXT_TYPE.MESSAGE}},t.metricsDestinationType=function(e){if(e.isUser())return o.default.E2E_DESTINATION.INDIVIDUAL;if(e.isGroup())return o.default.E2E_DESTINATION.GROUP;if(e.isStatusV3())return o.default.E2E_DESTINATION.STATUS;if(e.isBroadcast())return o.default.E2E_DESTINATION.LIST;throw new Error},t.metricsMediaType=function(e){switch(e){case a.MediaType.Photo:return o.default.MEDIA_TYPE.PHOTO;case a.MediaType.Video:return o.default.MEDIA_TYPE.VIDEO;case a.MediaType.Audio:return o.default.MEDIA_TYPE.AUDIO;case a.MediaType.Ptt:return o.default.MEDIA_TYPE.PTT;case a.MediaType.Location:return o.default.MEDIA_TYPE.LOCATION;case a.MediaType.Contact:return o.default.MEDIA_TYPE.CONTACT;case a.MediaType.Document:return o.default.MEDIA_TYPE.DOCUMENT;case a.MediaType.Url:return o.default.MEDIA_TYPE.URL;case a.MediaType.Call:return o.default.MEDIA_TYPE.CALL;case a.MediaType.Gif:return o.default.MEDIA_TYPE.GIF;case a.MediaType.Future:return o.default.MEDIA_TYPE.FUTURE;case a.MediaType.ContactArray:return o.default.MEDIA_TYPE.CONTACT_ARRAY;case a.MediaType.LiveLocation:return o.default.MEDIA_TYPE.LIVE_LOCATION;case a.MediaType.ProfilePic:return o.default.MEDIA_TYPE.PROFILE_PIC;case a.MediaType.Sticker:return o.default.MEDIA_TYPE.STICKER;case a.MediaType.Hsm:return o.default.MEDIA_TYPE.HSM;case a.MediaType.ProductImage:return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case a.MediaType.Template:return o.default.MEDIA_TYPE.TEMPLATE;case a.MediaType.MdAppState:return o.default.MEDIA_TYPE.MD_APP_STATE;case a.MediaType.MdHistorySync:return o.default.MEDIA_TYPE.MD_HISTORY_SYNC;case a.MediaType.List:return o.default.MEDIA_TYPE.LIST;case a.MediaType.ListResponse:return o.default.MEDIA_TYPE.LIST_REPLY;case a.MediaType.Button:return o.default.MEDIA_TYPE.BUTTON_MESSAGE;case a.MediaType.ButtonResponse:return o.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case a.MediaType.Order:return o.default.MEDIA_TYPE.ORDER;case a.MediaType.Product:return o.default.MEDIA_TYPE.PRODUCT_IMAGE}};var i=r(31914),a=r(45033),o=n(r(11339));function s(e){const t=(()=>{switch(e){case a.MediaType.Photo:return"image";case a.MediaType.Video:return"video";case a.MediaType.Audio:return"audio";case a.MediaType.Ptt:return"ptt";case a.MediaType.Contact:return"vcard";case a.MediaType.Document:return"document";case a.MediaType.Gif:return"gif";case a.MediaType.ContactArray:return"contact_array";case a.MediaType.LiveLocation:return"livelocation";case a.MediaType.Sticker:return"sticker";case a.MediaType.List:return"list";case a.MediaType.ListResponse:return"list_response";case a.MediaType.ButtonResponse:return"buttons_response";case a.MediaType.Order:return"order";case a.MediaType.Product:return"product";case a.MediaType.Url:return"url";default:return null}})();if(t)return(0,i.CUSTOM_STRING)(t);throw new Error("Unsupported type")}function l(e){return t=>null==t?i.DROP_ATTR:e(t)}t.CIPHERTEXT_VERSION=2;const c=l(s);t.encodeMaybeMediaType=c;const d=l((()=>(0,i.CUSTOM_STRING)("hide")));t.encodeMaybeDecryptFail=d},65508:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseErrorFields=void 0;const n=new(r(71914).WapParser)("parseErrorFields",(e=>{const t=[];return e.forEachChildWithTag("field",(e=>{const r=e.hasAttr("detail")?e.maybeAttrString("detail"):null;t.push({name:e.attrString("name"),reason:e.attrString("reason"),detail:r})})),t}));t.parseErrorFields=n},76199:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.maybeChild("address"),r=t?t.contentString():void 0,n=e.maybeChild("description"),o=n?n.contentString():void 0,s=e.maybeChild("email"),l=s?s.contentString():void 0,c=e.maybeChild("latitude"),d=c?parseFloat(c.contentString()):void 0,u=e.maybeChild("longitude"),p=u?parseFloat(u.contentString()):void 0,f=e.maybeChild("vertical");let _;if(f){const e=f.maybeAttrString("canonical"),t=f.hasContent()?f.contentString():void 0;_={name:t,canonical:e}}const h=[];e.forEachChildWithTag("website",(e=>{h.push(e.contentString())}));const g=[],m=e.maybeChild("categories");m&&m.forEachChildWithTag("category",(e=>{const t=e.attrString("id");g.push({id:t,localized_display_name:e.contentString()})}));let y;const E=e.maybeChild("business_hours");if(E){const e=E.maybeAttrString("timezone"),t=[];E.forEachChildWithTag("business_hours_config",(e=>{t.push({day_of_week:e.attrString("day_of_week"),mode:e.attrString("mode"),open_time:e.hasAttr("open_time")?parseInt(e.attrString("open_time"),10):0,close_time:e.hasAttr("close_time")?parseInt(e.attrString("close_time"),10):0})})),y={config:t,timezone:e}}let S;const v=e.maybeChild("profile_options");if(v){S={};const e=v.maybeChild("commerce_experience");var T;if(e)S.commerce_experience=null!==(T=a.COMMERCE_EXPERIENCE_TYPES.cast(e.contentString()))&&void 0!==T?T:a.COMMERCE_EXPERIENCE_TYPES.NONE;const t=v.maybeChild("cart_enabled");t&&(S.cart_enabled="true"===t.contentString());const r=v.maybeChild("shop_url");r&&(S.shop_url=r.contentString());const n=v.maybeChild("commerce_manager_url");n&&(S.commerce_manager_url=n.contentString());const i=v.maybeChild("is_banned");i&&(S.is_banned="true"===i.contentString());const o=v.maybeChild("direct_connection");o&&(S.direct_connection="true"===o.contentString())}const C=e.maybeChild("direct_connection");let A;if(C){const e=C.maybeChild("default_postcode");A={enabled:"true"===C.maybeAttrString("enabled"),defaultPostcode:e?{code:e.attrString("code"),locationName:e.attrString("location_name")}:void 0}}const b=e.maybeChild("catalog_status"),P=b?b.attrString("status"):void 0;let M,O,I;const w=e.maybeChild("linked_accounts");if(w){I=!0;const e=w.maybeChild("fb_page");if(e){const t=e.maybeChild("display_name"),r=e.maybeChild("likes");M={displayName:null==t?void 0:t.contentString(),likes:null==r?void 0:r.contentString(),id:e.maybeAttrString("id")}}const t=w.maybeChild("ig_professional");if(t){const e=t.maybeChild("ig_handle"),r=t.maybeChild("followers");O={handle:null==e?void 0:e.contentString(),followers:null==r?void 0:r.contentString()}}}const R={address:r,description:o,email:l,latitude:d,longitude:p,vertical:_,website:h,categories:g,business_hours:y,catalog_status:P,profile_options:S,fbPage:M,igProfessional:O,isProfileLinked:I,directConnection:A};return(0,i.default)(R)};var i=n(r(70740)),a=r(93170)},27874:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.attrEnum("verified_level",i.MSG_VERIFIED_LEVEL),r=e.hasContent()?e.contentBytes():null,o=e.maybeAttrString("serial"),{serial:s,name:l,isApi:c}=r&&function(e){const t=(0,a.getParsedProtoObjects)(e);if(null==t?void 0:t.details){const{name:e,serial:r,isApi:n}=(0,a.extractCertificateDetailsParams)(t.details);return{name:e,serial:String(r),isApi:n}}}(r)||{},d=n.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),u=n.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),p=e.maybeAttrInt("privacy_mode_ts");return{level:t,serial:o||s,name:l,isApi:!0===c,privacyMode:null!=d&&null!=u&&null!=p?{actualActors:d,hostStorage:u,privacyModeTs:p}:null}};var n=r(49714),i=r(12037),a=r(51836)},40376:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.digestKey=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(31914),s=r(71914),l=r(24747),c=r(11849),d=r(46669);const u=new s.WapParser("digestResponseParser",(e=>{const t=e.child("digest"),r=t.child("skey");return{regId:t.child("registration").contentUint(4),type:t.child("type").contentUint(1),identity:t.child("identity").contentBytes(32),skey:{id:r.child("id").contentUint(3),pubkey:r.child("value").contentBytes(32),signature:r.child("signature").contentBytes(64)},keys:t.child("list").mapChildren((e=>e.contentUint(3))),hash:t.child("hash").contentBytes(20)}}));function p(){return(p=(0,i.default)((function*(){const e=(0,o.wap)("iq",{xmlns:"encrypt",type:"get",to:o.S_WHATSAPP_NET,id:(0,o.generateId)()},(0,o.wap)("digest",null)),t=yield(0,l.sendIq)(e,u);let r=null;if(t.success)try{yield f(t.result),r=!1}catch(e){r=!1}else{const e=t.errorCode;404===e?(__LOG__(3)`digestKey: no record found for current user`,r=!0):406===e?(__LOG__(3)`digestKey: malformed request`,r=!1):503===e?(__LOG__(3)`digestKey: service unavailable`,r=!1):(__LOG__(3)`digestKey: server error ${e}`,r=!1)}if(null!=r&&r)return __LOG__(2)`digestKey: validate key bundle failed, upload prekeys again`,(0,d.uploadPreKeys)()}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const[t,r]=yield Promise.all([c.waSignalStore.getRegistrationInfo(),c.waSignalStore.getSignedPreKey()]);if(!t||!r)throw new Error("validateLocalKeyBundle: No registration info is available");if(e.regId!==t.registrationId)throw new Error("validateLocalKeyBundle: registation id mismatch");const n=t.identityKeyPair.pubKey,o=r.keyPair.pubKey,s=n.byteLength+o.byteLength+r.signature.byteLength+32*e.keys.length,l=new Uint8Array(s);let d=0;[n,o,r.signature].forEach((e=>{l.set(new Uint8Array(e),d),d+=e.byteLength}));const u=e.keys.map(function(){var e=(0,i.default)((function*(e){const t=yield c.waSignalStore.getPreKeyById(e);if(!t)throw Error(`validateLocalKeyBundle: missing prekey record for id ${e}`);return t.keyPair.pubKey}));return function(){return e.apply(this,arguments)}}());(yield Promise.all(u)).forEach((e=>{l.set(new Uint8Array(e),d),d+=e.byteLength}));const p=yield self.crypto.subtle.digest("SHA-1",l),f=(0,a.encodeB64)(p),_=(0,a.encodeB64)(e.hash);if(f!==_)throw Error(`validateLocalKeyBundle: hash mismatch remote:${_} local:${f}`);__LOG__(2)`validateLocalKeyBundle: success`}))).apply(this,arguments)}},66457:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(89867)),o=r(79942),s=r(52284);function l(){return(l=(0,i.default)((function*(e){if(!a.default.isWid(e)||!e.isUser())return __LOG__(3)`getAbout: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withStatusProtocol().withUser((new o.USyncUser).withId(e)),r=yield t.execute();if(r.error.all||r.error.status){const t=r.error.all||r.error.status;return __LOG__(3)`getAbout: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const n=r.list;return n.length||Promise.reject(new Error("no status data returned for user")),{id:e,status:n[0].status}}))).apply(this,arguments)}},37790:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=r(99234),d=r(39410);const u=new o.WapParser("getBlocklistParser",(e=>e.hasChild("error")&&404===e.child("error").attrInt("code")?{wids:[]}:{wids:p(e)}));function p(e){return e.child("query").child("list").mapChildrenWithTag("item",(e=>(0,s.userJidToUserWid)(e.attrPhoneUserJid("value"))))}function f(){return(f=(0,i.default)((function*(){const e=yield(0,l.sendIq)((0,a.wap)("iq",{xmlns:"jabber:iq:privacy",from:(0,d.JID)((0,c.assertGetMe)()),type:"get",id:(0,a.generateId)()},(0,a.wap)("query",null,(0,a.wap)("list",{name:"default"}))),u);if(e.success)return __LOG__(2)`getBlocklist from server`,e.result;const{errorCode:t,errorText:r}=e;return __LOG__(3)`getBlocklist: failed ${t}, ${r}`,{errorCode:t,errorText:r}}))).apply(this,arguments)}},88445:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingMode=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=n(r(89867)),o=r(79942),s=r(52284);function l(){return(l=(0,i.default)((function*(e){if(!a.default.isWid(e)||!e.isUser())return __LOG__(3)`getDisappearingMode: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new s.USyncQuery).withContext("interactive").withMode("query").withDisappearingModeProtocol().withUser((new o.USyncUser).withId(e)),r=yield t.execute();if(r.error.all||r.error.status){const t=r.error.all||r.error.status;return __LOG__(3)`getDisappearingMode: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const n=r.list;0!==n.length&&null!=n[0].disappearing_mode||Promise.reject(new Error("no disappearing_mode data returned for user"));const{duration:i,t:l}=n[0].disappearing_mode;return{id:e,disappearingModeDuration:i,disappearingModeSettingTimestamp:l}}))).apply(this,arguments)}},53379:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndStoreIdentityKeys=function(){return _.apply(this,arguments)},t.getIdentityKeys=h;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=r(5087),d=n(r(76128)),u=r(93832),p=r(39410);const f=new o.WapParser("identityKeysParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");throw new Error(`identityKeysParser bad response: ${r} ${n}`)}return{type:e.child("type").contentBytes(1),identity:e.child("identity").contentBytes(32),user:(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid"))}}))));function _(){return(_=(0,i.default)((function*(e){const t=yield d.default.bulkLoadIdentityKey(e.map((e=>String((0,u.createSignalAddress)(e))))),r=e.filter(((e,r)=>null==t[r]));if(0===r.length)return void __LOG__(2)`getAndStoreIdentityKeys: got 0 missing keys`;__LOG__(2)`getAndStoreIdentityKeys: query ${r.length} missing keys for ${e.length} contacts`;const n=(yield h(r)).map((e=>{const t=e.identity,r=(0,c.toSignalCurvePubKey)(t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset));return{identityKey:(0,u.bufferToStr)(r),identifier:(0,u.createSignalAddress)(e.user).toString()}}));return d.default.bulkCreateIdentity(n)}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("user",{jid:(0,p.DEVICE_JID)(e)}))),r=(0,a.wap)("iq",{xmlns:"encrypt",type:"get",to:a.S_WHATSAPP_NET,id:(0,a.generateId)()},(0,a.wap)("identity",null,t)),n=yield(0,l.sendIq)(r,f);if(!n.success)throw new Error(`getIdentityKeys bad response ${String(n)}`);return n.result}))).apply(this,arguments)}},94943:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getProfilePicFull=function(e){return p(e,{preview:!1})},t.getProfilePicPreview=function(e,t){return p(e,{preview:!0,invite:t})};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(39410),c=r(77591);const d={preview:"preview",image:"image"},u=new o.WapParser("profilePicParser",(e=>{const t=e.child("picture");return{id:t.attrInt("id"),type:t.attrEnum("type",d),url:t.attrString("url")}}));function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){e.isBroadcast()&&(__LOG__(4,!0,new Error,!0)`getProfilePic failed with a broadcast WID type target}`,SEND_LOGS("getProfilePic failed with a broadcast WID type target"));const{preview:r,invite:n,photoId:i}=t,o=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:(0,l.CHAT_JID)(e),type:"get",xmlns:"w:profile:picture",id:(0,a.generateId)()},(0,a.wap)("picture",{invite:(0,a.MAYBE_CUSTOM_STRING)(n),type:r?"preview":a.DROP_ATTR,id:null!=i?(0,a.INT)(i):a.DROP_ATTR,query:"url"})),d=yield(0,s.sendIq)(o,u);if(!d.success)return Promise.reject(new c.ServerStatusCodeError(d.errorCode,d.errorText));const{id:p,url:f,type:_}=d.result;return __LOG__(2)`getProfilePic: ${e.toString()} ${p}, ${_}, ${f}`,{tag:p.toString(),eurl:f,type:_}}))).apply(this,arguments)}},26539:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(87614),o=r(31914),s=r(71914),l=r(81663),c=r(45454),d=r(24747),u=r(46920),p=n(r(11339)),f=r(39410),_=r(77591);const h=new s.WapParser("createGroupReplyParser",(e=>{var t;const r=e.child("group");let n;try{n=(0,c.createWid)(`${r.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=n)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");return{wid:n,subject:r.attrString("subject"),creator:(0,l.userJidToUserWid)(r.attrPhoneUserJid("creator")),ts:r.attrTime("creation"),participants:r.mapChildrenWithTag("participant",(e=>{const t=e.maybeChild("add_request");return{wid:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),error:e.hasAttr("error")?e.attrInt("error"):null,invite_code:t&&t.attrString("code"),invite_code_exp:t&&t.attrString("expiration"),type:e.attrEnumOrDefault("type",u.GROUP_PARTICIPANT_TYPES,"participant")}}))}}));function g(){return(g=(0,i.default)((function*(e,t,r,n){const i=(0,a.randomHex)(8),s=t.map((e=>(0,o.wap)("participant",{jid:(0,f.USER_JID)(e)})));null!=r&&0!==r&&s.unshift((0,o.wap)("ephemeral",{expiration:(0,o.INT)(r)})),null!=n&&s.unshift((0,o.wap)("linked_parent",{jid:(0,f.GROUP_JID)(n)}));const l=(0,o.wap)("iq",{to:o.G_US,type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("create",{subject:(0,o.CUSTOM_STRING)(e),key:(0,o.CUSTOM_STRING)(i)},s)),c=yield(0,d.sendIq)(l,h);return c.success?(new p.default.GroupCreateC({}).commit(),c.result):Promise.reject(new _.ServerStatusCodeError(c.errorCode,c.errorText))}))).apply(this,arguments)}},12594:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.leaveGroups=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=r(39410),d=r(77591);const u=new o.WapParser("leaveGroupResultParser",(e=>{e.assertAttr("type","result");return{groups:e.child("leave").mapChildren((e=>(0,s.groupJidToWid)(e.attrGroupJid("id"))))}}));function p(){return(p=(0,i.default)((function*(e){const t=e.map((e=>(0,a.wap)("group",{id:(0,c.GROUP_JID)(e)}))),r=(0,a.wap)("iq",{to:a.G_US,type:"set",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("leave",null,t)),n=yield(0,l.sendIq)(r,u);return n.success?n.result:Promise.reject(new d.ServerStatusCodeError(n.errorCode,n.errorText))}))).apply(this,arguments)}},82394:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(){return h.apply(this,arguments)},t.queryGroupInviteV4=function(){return p.apply(this,arguments)},t.revokeGroupInviteV4=function(){return g.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(31914),s=r(71914),l=r(81663),c=r(24747),d=r(2182);const u=new s.WapParser("queryGroupInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}return e.hasChild("group")?{groupMetadata:(0,d.parseGroupNode)(e.child("group"))}:{phashMatch:!0}}));function p(){return(p=(0,a.default)((function*(e,t,r,n,a){const s=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(r),type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("query",{phash:(0,o.MAYBE_CUSTOM_STRING)(a)},(0,o.wap)("add_request",{code:(0,o.CUSTOM_STRING)(e),expiration:(0,o.CUSTOM_STRING)(t),admin:(0,o.CUSTOM_STRING)(n)}))),l=yield(0,c.sendIq)(s,u);if(!l.success)return __LOG__(2)`parsing failed for queryGroupInviteV4: ${JSON.stringify(l)}`,{status:500};const d=l.result,p={status:null!=d.errorCode&&d.errorCode>0?d.errorCode:200};return d.groupMetadata?(0,i.default)((0,i.default)({},p),{},{groupMetadata:d.groupMetadata}):p}))).apply(this,arguments)}const f=new s.WapParser("joinGroupViaInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text"),groupId:(0,l.groupJidToWid)(t.attrGroupJid("from"))}}return{groupId:(0,l.groupJidToWid)(e.attrGroupJid("from"))}})),_=new s.WapParser("revokeGroupV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}const t=e.child("revoke"),r=[];return t.mapChildrenWithTag("participant",(e=>{e.hasAttr("error")||r.push((0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")))})),{revokedUsers:r}}));function h(){return(h=(0,a.default)((function*(e,t,r,n){const i=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(r),type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("accept",{code:(0,o.CUSTOM_STRING)(e),expiration:(0,o.CUSTOM_STRING)(t),admin:(0,o.CUSTOM_STRING)(n)})),a=yield(0,c.sendIq)(i,f);if(!a.success)return __LOG__(2)`joinGroupV4Parser: parsing failed ${a.errorCode}:${a.errorType}`,{status:500};const s=a.result;return{status:null!=s.errorCode&&s.errorCode>0?s.errorCode:200,gid:s.groupId}}))).apply(this,arguments)}function g(){return(g=(0,a.default)((function*(e,t){const r=(0,o.wap)("iq",{to:(0,o.CUSTOM_STRING)(t),type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("revoke",null,e.map((e=>(0,o.wap)("participant",{jid:(0,o.CUSTOM_STRING)(e)}))))),n=yield(0,c.sendIq)(r,_);if(!n.success)return __LOG__(2)`revokeGroupV4Parser: parsing failed ${n.errorCode}:${n.errorType}`,{status:500};const i=n.result;return{status:null!=i.errorCode&&i.errorCode>0?i.errorCode:200}}))).apply(this,arguments)}},85057:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAllGroups=function(){return p.apply(this,arguments)},t.queryGroupInvite=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(2182),c=r(77591);const d=new o.WapParser("queryGroupParser",(e=>e.hasChild("group")?(0,l.parseGroupNode)(e.child("group")):{phashMatch:!0})),u=new o.WapParser("queryAllGroupParser",(e=>e.child("groups").mapChildren(l.parseGroupNode)));function p(){return(p=(0,i.default)((function*(){const e=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("participating",null,(0,a.wap)("participants",null),(0,a.wap)("description",null))),t=yield(0,s.sendIq)(e,u);return t.success?t.result:(__LOG__(2)`queryAllGroups failed: ${t.errorCode}:${t.errorType}`,Promise.reject(new c.ServerStatusCodeError(t.errorCode,t.errorText)))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.G_US,type:"get",xmlns:"w:g2",id:(0,a.generateId)()},(0,a.wap)("invite",{code:(0,a.CUSTOM_STRING)(e)})),r=yield(0,s.sendIq)(t,d);return r.success?r.result:(__LOG__(2)`queryGroupInvite failed: ${r.errorCode}:${r.errorType}`,Promise.reject(new c.ServerStatusCodeError(r.errorCode,r.errorText)))}))).apply(this,arguments)}},45823:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleAboutNotification=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){switch(__LOG__(2)`handleAboutNotification: received ${e.type}
for ${e.from.toString()}`,e.type){case d.SIDE_LIST_CHANGE:break;case d.CHANGE:const t=l.StatusCollection.get(e.from);t?t.status=e.content:__LOG__(3)`handleAboutNotification: get status update for unknown contact ${e.from}`;break;default:__LOG__(3)`handleAboutNotification: unhandled notification of
type ${e.type}`}return(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e.stanzaId),to:"change"===e.type?(0,c.JID)(e.from):(0,a.CUSTOM_STRING)(e.from),class:"notification",type:"status"})}(t.success)};var i=n(r(81109)),a=r(31914),o=r(71914),s=r(81663),l=r(46133),c=r(39410);const d=Object.freeze({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"});t.NOTIFICATION_TYPE=d;const u=new o.WapParser("incomingAboutNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id")},r=e.hasChild("set")&&e.child("set");if(r&&!r.hasAttr("hash"))return(0,i.default)({type:d.CHANGE,from:(0,s.userJidToUserWid)(e.attrPhoneUserJid("from")),pushname:e.attrString("notify"),content:r.contentString(),ts:e.attrTime("t")},t);let n=d.UNKNOWN;return r&&r.hasAttr("hash")&&(n=d.SIDE_LIST_CHANGE),(0,i.default)({type:n,from:e.attrString("from")},t)}))},40126:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateStatus=M,t.handleAccountSyncNotification=function(){return I.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(52230),s=r(31914),l=r(71914),c=r(81663),d=r(45454),u=r(41075),p=r(88102),f=r(91036),_=n(r(69153)),h=r(99234),g=n(r(66457)),m=r(88445),y=r(7293),E=r(54181),S=r(28237),v=r(10435),T=r(97153),C=r(46133),A=r(39410);const b=e=>{const t=e.maybeChild("key-index-list"),r=null==t?null:{ts:t.attrTime("ts"),signedKeyIndexBytes:t.hasContent()?t.contentBytes():null,expectedTs:t.hasAttr("expected_ts")?t.attrTime("expected_ts"):void 0},n=e.mapChildrenWithTag("device",(e=>({id:(0,d.createWid)(e.attrDeviceJid("jid")).device||o.DEFAULT_DEVICE_ID,keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null})));return 0===n.length?null:{deviceList:n,keyIndex:r}},P=new l.WapParser("incomingAccountSyncNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),ts:e.attrTime("t"),from:(0,c.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from"))};if(e.hasChild("status")){const r=e.child("status"),n=r.hasAttr("action")?r.attrString("action"):void 0;return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.STATUS,action:n},t)}if(e.hasChild("privacy"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.PRIVACY},t);if(e.hasChild("devices"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.DEVICES,devices:b(e.child("devices"))},t);if(e.hasChild("blocklist"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.BLOCKLIST},t);if(e.hasChild("picture"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.PICTURE},t);if(e.hasChild("tos")){const r=e.child("tos"),n=[];return r.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),r=e.attrString("id");n.push({id:r,state:t})})),(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.TOS,notices:n},t)}if(e.hasChild("disappearing_mode")){const r=e.child("disappearing_mode");let n,i,o;return r.hasAttr("action")?n=r.attrString("action"):(i=r.attrInt("duration"),o=r.attrInt("t")),(0,a.default)((0,a.default)({},t),{},{type:u.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE,action:n,disappearingModeDuration:i,disappearingModeSettingTimestamp:o})}throw new Error("notification type not supported")}));function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=(0,h.assertGetMe)(),t=yield(0,g.default)(e);if(t.error)return __LOG__(3)`getStatus failed for ${e}: failed ${t.error.errorCode} : ${t.error.errorText}`,Promise.reject(t.error.errorText);const r=t.status;r&&(C.StatusCollection.assertGet((0,h.getMaybeMeUser)()).status=r)}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=P.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r.stanzaId),to:(0,A.JID)(r.from),class:"notification",type:"account_sync"});switch(r.type){case u.ACCOUNT_SYNC_TYPE.STATUS:yield M();break;case u.ACCOUNT_SYNC_TYPE.DEVICES:if(y.GK.supportsFeature(y.GK.F.MD_BACKEND)){if(!S.OfflineMessageHandler.isResumeFromRestartComplete())return _.default.addOfflinePendingDevice(r.from.toString(),n),"NO_ACK";if(S.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,T.addUserToPendingDeviceSync)([r.from.toString()]),n}r.devices?yield(0,E.handleADVDeviceSyncResult)([{devices:r.devices,wid:(0,d.toUserWid)(r.from)}]):yield(0,u.getDevices)("notification");break;case u.ACCOUNT_SYNC_TYPE.PICTURE:yield(0,u.getAndUpdateProfilePicture)();break;case u.ACCOUNT_SYNC_TYPE.PRIVACY:p.Cmd.onAccountSyncForPrivacy(yield(0,u.updatePrivacySettings)());break;case u.ACCOUNT_SYNC_TYPE.BLOCKLIST:(0,u.updateBlocklist)();break;case u.ACCOUNT_SYNC_TYPE.TOS:r.notices&&(0,u.updateTosState)(r.notices);break;case u.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE:if((0,v.isDisappearingModeEnabled)()){const{action:e,from:t}=r;let n=r.disappearingModeDuration,i=r.disappearingModeSettingTimestamp;if("modify"===e){const e=yield(0,m.getDisappearingMode)(t);null==e.error&&null!=e.disappearingModeDuration&&null!=e.disappearingModeSettingTimestamp&&(n=e.disappearingModeDuration,i=e.disappearingModeSettingTimestamp)}null!=n&&null!=i&&(yield(0,f.updateDisappearingMode)(t,n,i));break}default:__LOG__(2)`account sync notification of type ${r.type} not supported`}return n}))).apply(this,arguments)}},97760:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedBusinessNameNotificationContact=function(){return A.apply(this,arguments)},t.handleVerifiedBusinessNameNotificationHash=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(93170),l=r(24747),c=r(19380),d=n(r(9762)),u=r(9961),p=r(99069),f=r(31452),_=r(68708),h=n(r(27874)),g=r(39410);function m(e,t,r,n,i){const a=c.ContactCollection.get(e);return null!=a&&(0,f.updateContactsWithVerifiedNames)([{id:e,name:r,level:t,isApi:n,privacyMode:i}],[a]),Promise.resolve()}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){yield(0,p.getStorage)().lock(["verified-business-name"],(()=>(0,_.createOrUpdateVerifiedBusinessName)({id:e.wid.user,level:e.level,serial:parseInt(e.serial||"0",10),name:e.verifiedName,isApi:e.isApi,privacyMode:e.privacyMode?{actualActors:e.privacyMode.actualActors,hostStorage:e.privacyMode.hostStorage,privacyModeTs:e.privacyMode.privacyModeTs}:null})));const t=[],r=c.ContactCollection.get(e.wid);null!=r&&t.push((0,d.default)(e.wid,{verifiedName:r.verifiedName,isVerifiedHigh:r.verifiedLevel===s.VERIFIED_LEVEL.HIGH,isBusiness:r.isBusiness,isEnterprise:r.isEnterprise,privacyMode:r.privacyMode},{verifiedName:e.verifiedName,isVerifiedHigh:"high"===e.level,isBusiness:!0,isEnterprise:e.isApi,privacyMode:e.privacyMode})),t.push(m(e.wid,e.level,e.verifiedName,e.isApi,e.privacyMode)),yield Promise.all(t)}))).apply(this,arguments)}const S=new o.WapParser("verifiedNameParser",(e=>(0,h.default)(e.child("verified_name"))));function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:(0,a.generateId)()},(0,a.wap)("verified_name",{jid:(0,g.DEVICE_JID)(e)})),r=yield(0,l.sendIq)(t,S);if(!r.success){if(404===r.errorCode)return void __LOG__(3)`verified name notification not found`;throw new Error("Could not send IQ in retrieveBusinessDetails")}return r.result}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){if("verified_name_hash"!==e.type)throw Error("Invalid notification type");const t=c.ContactCollection.resolveWidsFromHash(e.hash);if(!t)return!1;const r=yield Promise.all(t.map(function(){var e=(0,i.default)((function*(e){return{wid:e,verifiedName:yield v(e)}}));return function(){return e.apply(this,arguments)}}()));return r.length&&(yield Promise.all(r.map((t=>{let{wid:r,verifiedName:n}=t;if(n){const{name:t,level:i,serial:a,isApi:o,privacyMode:s}=n;return y({wid:r,verifiedName:t,level:i,stanzaId:e.stanzaId,ts:e.ts,serial:a,isApi:o,privacyMode:s})}if(void 0===n)return(0,u.handleBusinessRemoval)(r,e.stanzaId,e.ts)})))),!0}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){let{jid:t,stanzaId:r,ts:n,verifiedName:i}=e;const{serial:a="",level:o,isApi:s,privacyMode:l}=i;let d=i.name;var u;if(!d)if(null!=(null===(u=c.ContactCollection.get(t))||void 0===u?void 0:u.verifiedName)){var p;d=(null===(p=c.ContactCollection.get(t))||void 0===p?void 0:p.verifiedName)||""}else{const e=yield v(t);if(!e)return;d=e.name}return y({verifiedName:d,level:o,stanzaId:r,ts:n,wid:t,serial:a,isApi:s,privacyMode:l})}))).apply(this,arguments)}},96429:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessNotification=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(81663),c=r(97760),d=r(91337),u=r(9961),p=r(80537),f=n(r(76199)),_=n(r(27874));const h=new s.WapParser("businessNotificationParser",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),from:e.attrString("from"),ts:e.attrTime("t")};let r;if(e.hasChild("remove"))return r=e.child("remove"),r.hasAttr("jid")?(0,a.default)({type:"remove_jid",jid:(0,l.chatJidToChatWid)(r.attrChatJid("jid"))},t):(0,a.default)({type:"remove_hash",hash:r.attrString("hash")},t);if(e.hasChild("verified_name"))return r=e.child("verified_name"),r.hasAttr("jid")?(0,a.default)({type:"verified_name_jid",jid:(0,l.chatJidToChatWid)(r.attrChatJid("jid")),verifiedName:(0,_.default)(r)},t):(0,a.default)({type:"verified_name_hash",hash:r.attrString("hash")},t);if(e.hasChild("profile")){const r=e.child("profile"),n=r.maybeAttrString("hash");if(n)return(0,a.default)({type:"profile_hash",hash:n},t);const i=(0,f.default)(r);return(0,a.default)({type:"profile",profile:i},t)}if(e.hasChild("product_catalog")){const r=e.child("product_catalog");if(r.hasChild("product")){const e=[];return r.forEachChildWithTag("product",(t=>{const r=t.child("id").contentString();e.push(r)})),(0,a.default)({type:"product",productsIds:e},t)}if(r.hasChild("collection")){const e=[],n=[];return r.forEachChildWithTag("collection",(t=>{if(t.hasChild("status_info")){var r,i;const a={reviewStatus:t.child("status_info").child("status").contentString(),rejectReason:null===(r=t.child("status_info").maybeChild("reject_reason"))||void 0===r?void 0:r.contentString(),commerceUrl:null===(i=t.child("status_info").maybeChild("commerce_url"))||void 0===i?void 0:i.contentString()};e.push(t.attrString("id")),n.push(a)}})),(0,a.default)({type:"collection",collectionIds:e,reviewStatuses:n},t)}}return(0,a.default)({type:"unknown"},t)}));function g(e,t,r){return r?(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e),to:(0,o.CUSTOM_STRING)(t),class:"notification",type:"business"},(0,o.wap)("user",{side_list:"out"})):(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(e),to:(0,o.CUSTOM_STRING)(t),class:"notification",type:"business"})}function m(){return(m=(0,i.default)((function*(e){const t=h.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";const r=t.success;switch(r.type){case"verified_name_hash":const e=yield(0,c.handleVerifiedBusinessNameNotificationHash)(r);return g(r.stanzaId,r.from,!e);case"verified_name_jid":return yield(0,c.handleVerifiedBusinessNameNotificationContact)(r),g(r.stanzaId,r.from,!1);case"remove_hash":const t=yield(0,u.handleBusinessRemovalNotificationHash)(r);return g(r.stanzaId,r.from,!t);case"remove_jid":return yield(0,u.handleBusinessRemovalNotificationContact)(r),g(r.stanzaId,r.from,!1);case"profile":return(0,d.handleBusinessProfile)(r),g(r.stanzaId,r.from,!1);case"profile_hash":const n=yield(0,d.handleBusinessProfileHash)(r);return g(r.stanzaId,r.from,!n);case"product":return yield(0,p.handleProductNotification)(r.productsIds),g(r.stanzaId,r.from,!1);case"collection":return yield(0,p.handleCollectionNotification)(r),g(r.stanzaId,r.from,!1);default:return g(r.stanzaId,r.from,!1)}}))).apply(this,arguments)}},91337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessProfileHash=t.handleBusinessProfile=void 0;var i=n(r(48926)),a=r(45454),o=r(93581),s=r(94010),l=r(19380),c=r(99234);t.handleBusinessProfile=e=>{let{from:t,profile:r}=e;const n=(0,a.createWidFromWidLike)(t),i=Boolean(o.BusinessProfileCollection.getValid(n)),l=(0,s.parseBusinessProfile)({id:n,profile:r,queryCatalog:!1}),d=o.BusinessProfileCollection.gaddUp(l);if(!i)return void(d.stale=!0);const u=(0,c.getMaybeMeUser)();n.equals(u)&&o.BusinessProfileCollection.fetchBizProfile(n)};const d=function(){var e=(0,i.default)((function*(e){let{hash:t}=e;const r=l.ContactCollection.resolveWidsFromHash(t);return!!r&&(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=Boolean(o.BusinessProfileCollection.getValid(e)),r=yield o.BusinessProfileCollection.update(e),n=Array.isArray(r)?r:[r];for(const e of n)t||(e.stale=!0)}));return function(){return e.apply(this,arguments)}}())),!0)}));return function(){return e.apply(this,arguments)}}();t.handleBusinessProfileHash=d},9961:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessRemoval=f,t.handleBusinessRemovalNotificationContact=function(){return g.apply(this,arguments)},t.handleBusinessRemovalNotificationHash=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(93170),o=r(19380),s=n(r(9762)),l=r(99069);function c(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const r=yield e.get(t.user);if(null!=r)return r.isBusiness=!1,r.verifiedLevel=0,r.verifiedName="",e.merge(t.user,r)}))).apply(this,arguments)}function u(e,t){return e.remove(t.user)}const p={isVerifiedHigh:!1,isBusiness:!1,isEnterprise:!1};function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=o.ContactCollection.get(e),r=t?{verifiedName:t.verifiedName,isVerifiedHigh:t.verifiedLevel===a.VERIFIED_LEVEL.HIGH,isBusiness:t.isBusiness,isEnterprise:t.isEnterprise,privacyMode:t.privacyMode}:p;yield(0,l.getStorage)().lock(["contact","verified-business-name"],(t=>{let[r,n]=t;return Promise.all([c(r,e),u(n,e)])}));const n=o.ContactCollection.get(e);return null!=n&&n.set({isBusiness:!1,verifiedLevel:null,verifiedName:null}),(0,s.default)(e,r,p)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){if("remove_hash"!==e.type)throw Error("Invalid notification type");const t=o.ContactCollection.resolveWidsFromHash(e.hash);return!!t&&(yield Promise.all(t.map((t=>f(t,e.stanzaId,e.ts)))),!0)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if("remove_jid"!==e.type)throw Error("Invalid notification type");yield f(e.jid,e.stanzaId,e.ts)}))).apply(this,arguments)}},80537:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCollectionNotification=function(e){const t=a.CatalogCollection.get((0,o.getMeUser)().toString());if(null==t?void 0:t.collections)for(let r=0;r<e.collectionIds.length;r++){const n=t.collections.get(e.collectionIds[r]);n&&n.set(e.reviewStatuses[r])}return Promise.resolve()},t.handleProductNotification=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(99989),o=r(99234);function s(){return(s=(0,i.default)((function*(e){const t=a.CatalogCollection.get((0,o.getMeUser)().toString());if(t){const r=[];e.forEach((e=>{r.push(t.refreshProduct(e))})),yield Promise.all(r)}}))).apply(this,arguments)}},83558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,o.default)(t.success)};var i=r(71914),a=r(81663),o=n(r(54248));const s=new i.WapParser("incomingChatStateParser",(e=>{let t;if(e.assertTag("chatstate"),e.hasChild("paused"))t="paused";else{if(!e.hasChild("composing"))return e.throw("Expected child of type paused or composing");t=e.child("composing").hasAttr("media")?"recording":"composing"}return{id:(0,a.chatJidToChatWid)(e.attrChatJid("from")),type:t,participant:e.hasAttr("participant")?(0,a.userJidToUserWid)(e.attrPhoneUserJid("participant")):void 0}}))},69277:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return P.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=n(r(45095)),s=r(31914),l=r(71914),c=r(81663),d=n(r(65212)),u=r(45454),p=r(68638),f=r(69951),_=r(9995),h=r(99234),g=r(5819),m=r(68315),y=r(41601),E=r(37638),S=r(82350),v=r(46133);const T=new l.WapParser("incomingContactsNotification",(e=>{e.assertTag("notification");const t=e.attrString("id"),r={from:e.attrString("from"),ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:t};if(e.hasChild("update")){const t=e.child("update");return t.hasAttr("jid")?(0,a.default)({type:"update",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("jid"))},r):(0,a.default)({type:"empty",jid:null},r)}if(e.hasChild("add")){const t=e.child("add");return(0,a.default)({type:"add",hash:t.hasContent()?t.contentBytes():null,jid:null},r)}if(e.hasChild("remove")){const t=e.child("remove");return(0,a.default)({type:"remove",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("jid"))},r)}if(e.hasChild("modify")){const t=e.child("modify");return(0,a.default)({type:"modify",jid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("new")),oldJid:(0,c.userJidToUserWid)(t.attrPhoneUserJid("old"))},r)}if(e.hasChild("sync")){const t=e.child("sync");return(0,a.default)({type:"sync",after:t.attrTime("after"),jid:null},r)}return __LOG__(3)`Unexpected "contacts" notification`,(0,a.default)({type:"empty",jid:null},r)}));function C(e,t){const r=function(e,t){if("modify"!==t.type)throw new Error("Error: genContactChangeNotificationMsg invalid type");{const r=(0,h.getMeUser)(),n=(0,o.default)(t.oldJid,"notification.oldJid"),i=(0,o.default)(t.jid,"notification.jid");return{id:new d.default({remote:e,fromMe:!1,id:d.default.newId()}),from:e,subtype:"change_number",t:t.ts,to:r,type:"notification_template",templateParams:[n,i]}}}(e,t);return(0,g.handleSingleMsgMD)(e,r)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){if(e.oldJid){const t=e.oldJid,r=e.jid,n=[];f.ChatCollection.get(t)&&n.push({id:t.toString(),changeNumberNewJid:r.toString(),changeNumberOldJid:void 0});f.ChatCollection.get(r)&&n.push({id:r.toString(),changeNumberNewJid:void 0,changeNumberOldJid:t.toString()}),(0,p.getTable)().bulkCreateOrMerge(n).then((()=>{n.forEach((e=>{const t=f.ChatCollection.get(e.id);t&&(t.changeNumberNewJid=e.changeNumberNewJid?(0,u.createWid)(e.changeNumberNewJid):void 0,t.changeNumberOldJid=e.changeNumberOldJid?(0,u.createWid)(e.changeNumberOldJid):void 0)}))})),yield Promise.all([C(t,e),C(r,e)])}else __LOG__(2)`notification.oldJid is null`;return Promise.resolve()}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=T.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=r.jid;switch(r.type){case"update":{if(!n)return __LOG__(3)`handleContactsNotification: an update command does not include jid`,i(r);const e=m.PresenceCollection.get(n);e&&e.reset();let t=Promise.resolve();const a=v.StatusCollection.get(n);a&&(a.set({status:""}),t=(0,S.getStatus)(n).then((e=>{a.set({status:e.status})})));const o=(0,E.changeProfilePicThumb)(r.jid,y.PROFILE_PIC_COMMAND.REMOVE);return Promise.all([o,t]).then((()=>i(r)))}case"modify":return yield A(r),i(r);case"sync":return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`received contact sync notification`,yield(0,_.contactSync)(),i(r);default:return __LOG__(2)`handleContactsNotification: unhandled notification of type ${r.type}`,i(r)}function i(e,t){return(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e.stanzaId),to:(0,s.CUSTOM_STRING)(e.from),class:"notification",type:"contacts"},t)}}))).apply(this,arguments)}},27514:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICE_NOTIFICATION_TYPES=void 0,t.handleDevicesNotification=function(){return S.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(72441),c=r(45454),d=r(10823),u=n(r(69153)),p=r(7293),f=r(54181),_=r(28237),h=r(97153),g=r(84356),m=r(39410);const y={add:"add",remove:"remove",update:"update"};t.DEVICE_NOTIFICATION_TYPES=y;const E=new o.WapParser("incomingDevicesNotification",(e=>{e.assertTag("notification"),e.assertTag("notification"),e.assertAttr("type","devices");let t,r,n,i=[];if(e.hasChild("remove"))r=y.remove,t=e.child("remove");else if(e.hasChild("add"))r=y.add,t=e.child("add");else{if(!e.hasChild("update"))throw __LOG__(3)`Unknown Devices Notification: Devices notification without "remove" and "add" nodes`,new Error("Failed to parse devices notification");r=y.update,t=e.child("update")}if(r===y.add||r===y.remove){const e=t.maybeChild("key-index-list");if(!e)throw new Error("key index node is required to handle device add or remove notification");const a=e.attrTime("ts");if(r===y.remove&&!a)throw new Error("timestamp is required to handle device remove notification");n={ts:a,signedKeyIndexBytes:r===y.add?e.contentBytes():null};const o=t.child("device");i=[{id:(0,l.extractDeviceId)(o.attrPhoneDeviceJid("jid")),keyIndex:o.hasAttr("key-index")?o.attrInt("key-index"):null}]}return{type:r,stanzaId:e.attrString("id"),hash:t.attrString(r===y.update?"hash":"device_hash"),user:(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("from")),deviceList:i,keyIndex:n}}));function S(){return(S=(0,i.default)((function*(e){const t=E.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,n=r.user,i=(0,a.wap)("ack",{to:(0,m.USER_JID)(r.user),id:(0,a.CUSTOM_STRING)(r.stanzaId),class:"notification"});if(p.GK.supportsFeature(p.GK.F.MD_BACKEND)){if(!_.OfflineMessageHandler.isResumeFromRestartComplete())return u.default.addOfflinePendingDevice(n.toString(),i),"NO_ACK";if(_.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,h.addUserToPendingDeviceSync)([n.toString()]),i}const o={wid:n,devices:{deviceList:r.deviceList,keyIndex:r.keyIndex},type:r.type};if(r.type===y.add){try{yield(0,f.handleADVDeviceNotification)(o)}catch(e){__LOG__(3)`handleDevicesNotification - add error: ${e}`}return i}if(r.type===y.remove){try{var s;yield(0,f.handleADVDeviceNotification)(o);const e=(null===(s=r.deviceList)||void 0===s?void 0:s.map((e=>e.id)))||[];yield Promise.all(e.map((e=>{const t=(0,c.createDeviceWidFromUserAndDevice)(n.user,e);g.Voip.notifyDeviceIdentityChangedOrDeleted(t,!0)})))}catch(e){__LOG__(3)`handleDevicesNotification - remove error: ${e}`}return i}try{yield(0,d.syncDeviceListJob)([n],"notification",r.hash)}catch(e){__LOG__(3)`handleDevicesNotification - update error: ${e}`}return i}))).apply(this,arguments)}},81367:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,"NO_ACK";const r=t.success,i=(0,n.wap)("ack",{to:n.S_WHATSAPP_NET,id:(0,n.CUSTOM_STRING)(r.stanzaId),class:"notification"});return(0,a.digestKey)().then((()=>i))};var n=r(31914),i=r(71914),a=r(40376);const o=new i.WapParser("digestKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),e.child("digest").assertTag("digest"),{stanzaId:e.attrString("id")})))},58626:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(){return p.apply(this,arguments)}(t.success)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(91036),c=r(10435),d=r(39410);const u=new o.WapParser("disappearingModeNotification",(e=>{e.assertTag("notification");const t=e.child("disappearing_mode");return{stanzaId:e.attrString("id"),from:(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from")),duration:t.attrInt("duration",0),ts:t.attrTime("t")}}));function p(){return(p=(0,i.default)((function*(e){let{duration:t,from:r,stanzaId:n,ts:i}=e;return __LOG__(2)`handleDisappearingModeNotification: received d=${t}:t=${i}
for ${r.toString()}`,(0,c.isDisappearingModeEnabled)()&&(yield(0,l.updateDisappearingMode)(r,t,i)),(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(n),to:(0,d.JID)(r),class:"notification",type:"disappearing_mode"})}))).apply(this,arguments)}},64054:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(71914),o=r(88102),s=r(24747),l=r(19518),c=r(29898),d=r(47221),u=r(42448),p=r(65044);const f=new a.WapParser("failureParser",(e=>(e.assertTag("failure"),{reason:e.attrInt("reason",400,599),location:e.attrString("location"),code:e.hasAttr("code")?e.attrInt("code"):null,expire:e.hasAttr("expire")?e.attrInt("expire"):null})));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);switch(t.success.reason){case 401:case 403:case 406:__LOG__(2)`received failure stanza, reason: ${t.success.reason}, logging out`,yield p.Socket.clearCredentialsAndStoredData(),o.Cmd.logout();break;case 405:case 409:__LOG__(2)`Client too old or bad user agent, attempting to update the app`;"web"===l.PLATFORMS[u.WAM_PLATFORM]?c.Updater.update(d.SANITIZED_VERSION_STR,!1,0):c.Updater.update(void 0,!1,0,!1),(0,s.stopComms)();break;case 402:const{code:e,expire:r}=t.success;if(null==e||null==r)throw __LOG__(4,void 0,new Error)`Incorrect temporary ban data ${e} ${r}`,new Error("handleFailure: wrong temp ban data");o.Cmd.onTemporaryBan({banned:!0,code:e,expire:r});break;case 400:case 500:case 501:__LOG__(3)`handleFailure: got failure code ${t.success.reason}`;break;default:return __LOG__(3)`failure reason ${t.success.reason} not implemented yet`,Promise.reject(new Error(`failure reason ${t.success.reason} not implemented yet`))}}))).apply(this,arguments)}},92419:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupNotification=function(e){const t=I.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success,{chatId:n,author:s,ts:l,pushname:c,externalId:d,actions:u,offline:p}=r,f=!!p&&!v.OfflineMessageHandler.isResumeFromRestartComplete(),_=(0,a.default)({chatId:n,author:s,ts:l,externalId:d},c?{pushname:c}:null);return(0,T.handleMessage)(n.toString(),f,(0,i.default)((function*(){return yield Promise.all(u.map((e=>function(){return U.apply(this,arguments)}(_,e,f)))),(0,o.wap)("ack",{to:(0,M.GROUP_JID)(r.chatId),id:(0,o.CUSTOM_STRING)(r.externalId),class:"notification",participant:s?(0,M.JID)(s):o.DROP_ATTR})})))};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(81663),c=r(86945),d=r(68638),u=r(69951),p=r(22683),f=r(46920),_=r(99234),h=r(7293),g=r(57701),m=r(37654),y=r(64632),E=r(36098),S=r(34648),v=r(28237),T=r(15746),C=r(76214),A=n(r(29783)),b=r(5819),P=r(2182),M=r(39410);const O=Object.freeze({REMOVE:"remove",ADD:"add",DEMOTE:"demote",PROMOTE:"promote",MODIFY:"modify",CREATE:"create",SUBJECT:"subject",DESC:"description",LOCKED:"locked",UNLOCKED:"unlocked",ANNOUNCE:"announcement",NOT_ANNOUNCE:"not_announcement",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",FREQUENTLY_FORWARDED_OK:"frequently_forwarded_ok",INVITE:"invite",EPHEMERAL:"ephemeral",NOT_EPHEMERAL:"not_ephemeral",REVOKE_INVITE:"revoke",SUSPENDED:"suspended",UNSUSPENDED:"unsuspended",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",LINK:"link"});const I=new s.WapParser("groupNotificationParser",(e=>{e.assertTag("notification"),e.hasAttr("to")&&e.assertAttr("to",(0,_.assertGetMe)().toJid());const t=(0,l.groupJidToWid)(e.attrGroupJid("from")),r=e.hasAttr("participant")?(0,l.userJidToUserWid)(e.attrPhoneUserJid("participant")):null,n=e.attrTime("t");function i(e){return{participants:e.mapChildrenWithTag("participant",(e=>(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")))),prevVersion:e.hasAttr("prev_v_id")?e.attrInt("prev_v_id"):void 0,version:e.hasAttr("v_id")?e.attrInt("v_id"):void 0}}const o=e.mapChildren((e=>{const t=e.tag();switch(t){case O.CREATE:return function(e){const t=e.child("group"),r=t.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",f.GROUP_PARTICIPANT_TYPES,"participant");return{id:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),isSuperAdmin:t===f.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===f.GROUP_PARTICIPANT_TYPES.admin||t===f.GROUP_PARTICIPANT_TYPES.superadmin}})),n=function(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent())return{content:e.contentString(),id:t.attrString("id")}}}return null}(t),i=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(t),a=(0,P.extractLinkedParent)(t),o={subject:t.attrString("subject"),restrict:t.hasChild("locked"),announce:t.hasChild("announcement"),noFrequentlyForwarded:t.hasChild("no_frequently_forwarded"),ephemeralDuration:i?i.ephemeralDuration:void 0,owner:t.hasAttr("creator")?(0,l.userJidToUserWid)(t.attrPhoneUserJid("creator")):void 0,creation:t.attrTime("creation"),participants:r,desc:n?n.content:void 0,descId:n?n.id:void 0,subjectOwner:t.hasAttr("s_o")?(0,l.userJidToUserWid)(t.attrPhoneUserJid("s_o")):void 0,subjectTime:t.hasAttr("s_t")?t.attrTime("s_t"):void 0,support:t.hasChild("support"),pvId:t.attrInt("p_v_id"),parent:t.hasChild("parent"),parentGroup:a?a.parentGroup:void 0,defaultSubgroup:t.hasChild("default_sub_group")};return{action:O.CREATE,isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason"),groupInfo:o}}(e);case O.ADD:return(0,a.default)((0,a.default)({action:E.GROUP_ACTIONS.ADD},i(e)),{},{isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason")});case O.REMOVE:return(0,a.default)({action:O.REMOVE},i(e));case O.PROMOTE:return(0,a.default)({action:O.PROMOTE},i(e));case O.DEMOTE:return(0,a.default)({action:O.DEMOTE},i(e));case O.MODIFY:return(0,a.default)({action:E.GROUP_ACTIONS.MODIFY},i(e));case O.SUBJECT:return{action:E.GROUP_ACTIONS.SUBJECT,subject:e.attrString("subject"),s_o:e.hasAttr("s_o")?(0,l.userJidToUserWid)(e.attrPhoneUserJid("s_o")):null,s_t:e.hasAttr("s_t")?e.attrTime("s_t"):null};case O.DESC:return e.hasChild("delete")?{action:E.GROUP_ACTIONS.DESC_REMOVE,descId:e.attrString("id")}:{action:E.GROUP_ACTIONS.DESC_ADD,descId:e.attrString("id"),desc:e.hasChild("body")?e.child("body").contentString():null,descTime:n};case O.SUSPENDED:return{action:E.GROUP_ACTIONS.SUSPEND,value:!0};case O.UNSUSPENDED:return{action:E.GROUP_ACTIONS.SUSPEND,value:!1};case O.LOCKED:return{action:E.GROUP_ACTIONS.RESTRICT,value:!0};case O.UNLOCKED:return{action:E.GROUP_ACTIONS.RESTRICT,value:!1};case O.ANNOUNCE:return{action:E.GROUP_ACTIONS.ANNOUNCE,value:!0};case O.NOT_ANNOUNCE:return{action:E.GROUP_ACTIONS.ANNOUNCE,value:!1};case O.NO_FREQUENTLY_FORWARDED:return{action:E.GROUP_ACTIONS.NO_FORWARD,value:!0};case O.FREQUENTLY_FORWARDED_OK:return{action:E.GROUP_ACTIONS.NO_FORWARD,value:!1};case O.INVITE:return{action:E.GROUP_ACTIONS.INVITE_CODE,code:e.attrString("code")};case O.EPHEMERAL:return{action:E.GROUP_ACTIONS.EPHEMERAL,duration:e.attrInt("expiration")};case O.NOT_EPHEMERAL:return{action:E.GROUP_ACTIONS.EPHEMERAL,duration:0};case O.REVOKE_INVITE:return{action:E.GROUP_ACTIONS.REVOKE_INVITE,participants:e.mapChildrenWithTag("participant",(e=>({id:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),expiration:e.attrInt("expiration")})))};case O.GROWTH_UNLOCKED:return{action:E.GROUP_ACTIONS.GROWTH_UNLOCKED};case O.GROWTH_LOCKED:return{action:E.GROUP_ACTIONS.GROWTH_LOCKED,expiration:e.attrInt("expiration"),type:e.attrString("type")};case O.LINK:const r=e.attrString("link_type");return{action:{sub_group:E.GROUP_ACTIONS.SUB_GROUP_LINK,parent_group:E.GROUP_ACTIONS.PARENT_GROUP_LINK,sibling_group:E.GROUP_ACTIONS.SIBLING_GROUP_LINK}[r],groups:e.mapChildrenWithTag("group",(e=>(0,l.groupJidToWid)(e.attrGroupJid("jid"))))};default:throw new Error(`Unrecognized group action ${t}`)}}));return{externalId:e.attrString("id"),chatId:t,author:r,ts:e.attrTime("t"),pushname:e.hasAttr("notify")?e.attrString("notify"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null,actions:o}}));function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const[t,r]=yield Promise.all([(0,y.getTable)().get(e.toString()),(0,d.getTable)().get(e.toString())]);return!!t||!!r&&!!r.t}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e,t){const r=yield(0,C.getParticipantTable)().get(e);return!!r&&r.admins.includes(t)}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t){var r;const n=yield(0,y.getTable)().get(e);return!!n&&n.growthLockType===t&&(null!==(r=n.growthLockExpiration)&&void 0!==r?r:0)>p.Clock.globalUnixTime()}))).apply(this,arguments)}function G(e,t){var r;const n=null===(r=u.ChatCollection.get(e))||void 0===r?void 0:r.groupMetadata;if(!n)return t;const i=n.participants;return t.filter((e=>!i.get(e)))}function U(){return(U=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;__LOG__(2,void 0,void 0,void 0,["groups"])`handle action ${t.action}`;const n=[];try{if(t.action===O.CREATE){const i=(0,a.default)((0,a.default)({},t.groupInfo),{},{id:e.chatId}),o=yield w(i.id);__LOG__(2,void 0,void 0,void 0,["groups"])`group id ${i.id} exists in storage = ${o}`,yield(0,S.handleGroupCreation)(e,i,r);const s=(0,_.getMaybeMeUser)();if(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreation done for group id ${i.id}`,o||n.push((0,m.genGroupCreationMsg)(e,i)),!s.equals(e.author)){const a={action:E.GROUP_ACTIONS.ADD,version:i.pvId,participants:[s],isInvite:t.isInvite};yield(0,S.handleGroupActionMD)(e,a,r),n.push((0,m.genGroupNotificationMsg)(e,a))}const{ephemeralDuration:l}=i;e.author&&null!=e.ts&&null!=l&&l>0&&n.push((0,m.genGroupEphemeralSettingMsg)(e.chatId,e.ts,e.author,l));const{parentGroup:c,defaultSubgroup:d}=i;if((0,g.communitiesEnabled)()&&null!=c&&!0!==d){const t={action:E.GROUP_ACTIONS.PARENT_GROUP_LINK,groups:[c]};n.push((0,m.genGroupNotificationMsg)(e,t))}}else if(t.action===E.GROUP_ACTIONS.ADD){const i=G(e.chatId,t.participants);yield(0,S.handleGroupActionMD)(e,t,r),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i.length&&n.push((0,m.genGroupNotificationMsg)(e,(0,a.default)((0,a.default)({},t),{},{participants:i})))}else{const i=yield F(t,e.chatId);yield(0,S.handleGroupActionMD)(e,t,r),__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupActionMD done for ${t}`,i||n.push((0,m.genGroupNotificationMsg)(e,t))}r?A.default.addOfflineMessage(n.map((e=>({msg:e})))):yield Promise.all(n.map((e=>(0,b.handleSingleMsgMD)(e.from,e))))}catch(e){__LOG__(2)`handleGroupNotification: failed with ${e}`}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,i.default)((function*(e,t){if(e.action===E.GROUP_ACTIONS.REVOKE_INVITE||e.action===E.GROUP_ACTIONS.SUSPEND)return!0;if(e.action===E.GROUP_ACTIONS.GROWTH_LOCKED||e.action===E.GROUP_ACTIONS.GROWTH_UNLOCKED){if(!(h.GK.supportsFeature(h.GK.F.MD_BACKEND)&&(0,c.getABPropConfigValue)("growth_lock_v0_enabled")))return!0;if(e.action===E.GROUP_ACTIONS.GROWTH_LOCKED){if("invite"!==e.type)return!0;if(yield L(t.toString(),e.type))return!0}const r=(0,_.getMaybeMeUser)();return!(yield D(t.toString(),r.toString()))}return!(e.action!==E.GROUP_ACTIONS.SUB_GROUP_LINK&&e.action!==E.GROUP_ACTIONS.PARENT_GROUP_LINK&&e.action!==E.GROUP_ACTIONS.SIBLING_GROUP_LINK||(0,g.communitiesEnabled)())}))).apply(this,arguments)}},19655:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleHistorySyncChunk=re,t.handleHistorySyncNotification=function(){return te.apply(this,arguments)};var a=i(r(81109)),o=i(r(48926)),s=r(52613),l=r(8584),c=r(72651),d=r(52230),u=r(8243),p=i(r(45095)),f=r(92844),_=i(r(65212)),h=i(r(89867)),g=r(45454),m=r(84902),y=r(86945),E=i(r(48277)),S=r(68638),v=r(63183),T=i(r(70257)),C=r(16116),A=r(88102),b=r(90257),P=r(19380),M=r(5087),O=r(24606),I=r(26384),w=r(24808),R=r(27856),D=r(99234),N=r(57701),L=r(41796),k=i(r(63928)),G=r(49714),U=r(41037),F=r(73027),x=r(49801),B=i(r(11339)),K=i(r(39436)),j=r(76214),Y=r(50313),W=r(5819),H=r(58052),V=i(r(57220)),$=r(13493),z=i(r(76128)),q=r(74727),J=i(r(61426)),Q=r(64551),X=r(27286),Z=r(93832),ee=i(r(56891));function te(){return(te=(0,o.default)((function*(e,t,r){if(!e)return;const{downloadOptions:n}=e;if(!n)return;const i=!!e.historySyncNotification.originalMessageId,o=i?e.historySyncNotification.originalMessageId:r,s={msgKey:new _.default({remote:t,fromMe:!0,id:o}).toString(),processed:0,downloadOptions:n,isReupload:1,historySyncStepStartedTs:(0,f.unixTimeMs)(),reuploadPending:!1,historySyncPayloadSize:e.historySyncNotification.fileLength};i&&e.historySyncNotification.syncType!==F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP||(s.syncType=e.historySyncNotification.syncType,s.chunkOrder=e.historySyncNotification.chunkOrder||0,s.isReupload=0);const l=s;switch(new B.default.MdBootstrapHistoryDataReceived({mdBootstrapPayloadType:l.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapHistoryPayloadType:de(l.syncType),mdTimestamp:(0,f.unixTimeMs)(),mdSessionId:yield x.MdSyncFieldStatsMeta.getMdSessionId()}).commit(),l.syncType){case F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP:case F.HistorySyncHistorySyncType.INITIAL_STATUS_V3:__LOG__(2)`[History sync initial sync received] ${oe(l)}`,re(l);break;case F.HistorySyncHistorySyncType.PUSH_NAME:return __LOG__(2)`[History sync initial pushname received] ${oe(l)}`,yield(0,U.enqueueNotification)((0,a.default)((0,a.default)({},l),{},{downloadOptions:(0,a.default)({},l.downloadOptions)}),!0),void re(l);default:__LOG__(2)`[History sync recent or full chunk received] adding chunk info to db: ${oe(l)}`,yield(0,U.enqueueNotification)(l)}E.default.continueProgressiveHistorySyncProcessing()}))).apply(this,arguments)}function re(){return ne.apply(this,arguments)}function ne(){return(ne=(0,o.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(__LOG__(2,void 0,void 0,void 0,["History sync"])`handleHistorySyncChunk started for ${oe(e)}`,e.syncType===F.HistorySyncHistorySyncType.INITIAL_STATUS_V3)try{const t=_.default.fromString(e.msgKey);(0,q.sendAggregateReceipts)(t.remote,q.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,(new Map).set(t.remote,[t.id]))}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: sending Status v3 receipt failed`}const i=e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:B.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,S=new B.default.MdBootstrapHistoryDataDownloaded({mdBootstrapPayloadType:i,mdBootstrapPayloadSize:e.historySyncPayloadSize}),C=e.syncType!==F.HistorySyncHistorySyncType.PUSH_NAME&&!i;S.mdSessionId=yield x.MdSyncFieldStatsMeta.getMdSessionId();const N=yield x.MdSyncFieldStatsMeta.getStorageEstimation();N.mdStorageQuotaBytes!==x.STORAGE_QUOTA_UNAVAILABLE&&(S.mdStorageQuotaUsedBytes=N.mdStorageQuotaUsedBytes,S.mdStorageQuotaBytes=N.mdStorageQuotaBytes);let L=null;try{L=yield I.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new n).signal},e.downloadOptions))}catch(r){if(__LOG__(3)`history sync download failed`,r instanceof R.HttpNetworkError)return e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP&&t>0?(yield V.default.waitIfOffline({signal:(new n).signal}),__LOG__(3,void 0,void 0,void 0,["History sync"])`Initial sync download failed due to network error retry download`,re(e,t-1)):void(0,U.removeLocalFailureFromInFlightChunk)(e.msgKey);const i=_.default.fromString(e.msgKey);return se(S,e.historySyncStepStartedTs,!1),(0,J.default)(i.remote,i.id,e.downloadOptions.mediaKey),void(yield(0,U.markChunkForReuploadPending)(e.msgKey))}e.downloadOptions.mediaKey="",C&&(yield new Promise((e=>setTimeout(e,1e3)))),S.mdBootstrapStepResult=B.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS;const $=new l.Binary(L),ee=yield(0,c.inflate)($.readByteArray());C&&(yield new Promise((e=>setTimeout(e,1e3))));const te=(0,m.decodeProtobuf)(F.HistorySyncSpec,ee);__LOG__(2)`[History sync chunk downloaded], ${oe(e)}`,C&&(yield new Promise((e=>setTimeout(e,1e3))));const ne=new B.default.MdBootstrapDataApplied({mdBootstrapPayloadType:i,mdBootstrapSource:B.default.MD_BOOTSTRAP_SOURCE.HISTORY});if(ne.mdSessionId=yield x.MdSyncFieldStatsMeta.getMdSessionId(),e.syncType===F.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&te.statusV3Messages&&te.statusV3Messages.length>0?(S.mdBootstrapMessagesCount=te.statusV3Messages.length,se(S,e.historySyncStepStartedTs,!0),yield Promise.all(te.statusV3Messages.map(function(){var e=(0,o.default)((function*(e){const t={type:G.MESSAGE_TYPE.OTHER_STATUS,externalId:(0,p.default)(e.key.id,"msg.key.id"),ts:(0,f.castToUnixTime)(parseInt(e.messageTimestamp,10)),edit:-1,isHsm:!1,count:null,chat:(0,g.createWid)(d.STATUS_JID),author:!0===e.key.fromMe?(0,D.getMeUser)():(0,g.createWid)((0,p.default)(e.participant,"msg.participant")),pushname:null,isDirect:!1},r=yield(0,X.parseMessage)(t,"skmsg",(0,p.default)(e.message,"msg.message"),void 0),n=r.renderableMsgs&&r.renderableMsgs;if(!n||1!==n.length)return Promise.resolve();const i=n[0];return"0@s.whatsapp.net"!==e.participant||(0,y.getABPropConfigValue)("web_status_psa_history_sync")&&null!=i.staticUrl?(0,W.handleSingleMsgMD)(i.id.remote,i,!1):Promise.resolve()}));return function(){return e.apply(this,arguments)}}())),yield(0,U.updateCurrentlyProcessed)(e.msgKey),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync storing Status V3 complete], ${oe(e,te.statusV3Messages.length)}`):e.syncType!==F.HistorySyncHistorySyncType.PUSH_NAME&&(te.conversations=te.conversations.reduce(((e,t)=>{let r=null;try{r=(0,g.createWid)(t.id)}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: invalid wid`}return r?e.concat(t):e}),[])),e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP){const t={},r=(0,D.assertGetMe)(),n=(0,g.toUserWid)(r),i=r.getDeviceId(),a={},o={},s=[];let l=0;const c=[];te.conversations.forEach((r=>{var d,p,f;let _=[];l+=r.messages.length;let m=[];r.messages.forEach(((n,i)=>{i===r.messages.length-1&&(t[r.id]=n.msgOrderId);const a=le(e,n.message);m.push(a),_=_.concat(ce(a))})),m=m.filter(Boolean).reverse(),r.pHash&&(o[r.id]=r.pHash);const E=(0,g.createWid)(r.id),S=r.contactPrimaryIdentityKey;if(S&&h.default.isUser(E)){const e=(0,Z.createSignalAddress)((0,g.toUserWid)(E)).toString(),t=(0,Z.bufferToStr)((0,M.toSignalCurvePubKey)(S));E.equals((0,D.getMeUser)())?ue(e,t):c.push({identifier:e,identityKey:t})}const T=(0,D.getGlobalSecurityNotifications)()&&!(0,y.getABPropConfigValue)("adv_v2_m6");if(!E.isStatusV3()&&T){const e=(0,b.genDeviceNotificationMsg)((0,g.createWid)(r.id),n,[i],[]);m.push(e)}let C;if(null!=(null===(d=r.disappearingMode)||void 0===d?void 0:d.initiator))switch(r.disappearingMode.initiator){case w.DisappearingModeInitiator.CHANGED_IN_CHAT:C=O.DisappearingModeInitiator.ChangedInChat;break;case w.DisappearingModeInitiator.INITIATED_BY_ME:C=O.DisappearingModeInitiator.InitiatedByMe;break;case w.DisappearingModeInitiator.INITIATED_BY_OTHER:C=O.DisappearingModeInitiator.InitiatedByOther}const A=null!=r.tcToken&&null!=r.tcTokenTimestamp,P={t:(0,u.maybeNumberOrThrowIfTooLarge)(null!==(p=r.conversationTimestamp)&&void 0!==p?p:r.lastMsgTimestamp),id:(0,g.createWid)(r.id),unreadCount:r.unreadCount,ephemeralDuration:r.ephemeralExpiration,ephemeralSettingTimestamp:r.ephemeralSettingTimestamp,disappearingModeInitiator:C,endOfHistoryTransferType:null!==(f=r.endOfHistoryTransferType)&&void 0!==f?f:v.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE,name:r.name,notSpam:r.notSpam,pendingInitialLoading:!1,unreadMentionCount:r.unreadMentionCount,tcToken:A?r.tcToken:null,tcTokenTimestamp:A?r.tcTokenTimestamp:null};r.suspended&&k.default.add({id:P.id,suspended:!0},{merge:!1}),s.push(P),a[r.id]={chatInfo:P,msgs:m,reactionMessages:_}})),S.mdBootstrapMessagesCount=l,S.mdBootstrapChatsCount=te.conversations.length,se(S,e.historySyncStepStartedTs,!0),E.default.markInitialHistorySyncCountDebugStats(l,s.length);const d=te.conversations.some((e=>void 0!==e.unreadMentionCount));(0,D.setUnreadMentionCountEnabled)(d),yield z.default.bulkCreateIdentity(c),yield(0,T.default)([{cmd:"preempt",response:s,binarySize:10}])||Promise.resolve(),yield(0,W.handleInitialSyncMsgs)(a),yield(0,U.updateCurrentlyProcessed)(e.msgKey),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(!0),__LOG__(2)`[History sync storing initial sync complete] ${oe(e,l,s.length)}`,yield fe(te),(0,Y.setHistoryInitialSyncBoundry)(t),(0,Y.setInitialGroupPhash)(o)}else if(e.syncType===F.HistorySyncHistorySyncType.PUSH_NAME){se(S,e.historySyncStepStartedTs,!0);const t=te.pushnames.map((e=>({id:e.id||"",pushname:e.pushname||""})));yield(0,j.getContactTable)().bulkCreateOrMerge(t),yield(0,U.updateCurrentlyProcessed)(e.msgKey);const r=te.pushnames.map((e=>{const t=(0,g.createWid)(e.id||""),r=P.ContactCollection.get(t);return{id:t,pushname:e.pushname||"",type:(null==r?void 0:r.type)||"out",name:null==r?void 0:r.name}}));P.ContactCollection.add(r,{merge:!0}),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync storing initial pushname complete] with ${te.pushnames.length} records`}else if(e.syncType!==F.HistorySyncHistorySyncType.INITIAL_STATUS_V3){yield new Promise((e=>setTimeout(e,0)));const t=[];let n=[];const i=new Set,a=[],o=(0,Y.getHistoryInitialSyncBoundry)();let l=0,c=0;for(let d=0;d<te.conversations.length;d++){const p=te.conversations[d],f=null==o?void 0:o[p.id];for(let o=0;o<p.messages.length;o++){const d=r(69951).ChatCollection.get((0,g.createWid)(p.id)),_=(null==d?void 0:d.endOfHistoryTransferType)===v.ConversationEndOfHistoryTransferModelPropType.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY;if(!d&&null!=f||d&&null==d.endOfHistoryTransferType||_){__LOG__(2,void 0,void 0,void 0,["History sync"])`One chat in sync payload ${oe(e)} is already marked as complete locally`;break}l++;const h=p.messages[o],m=(0,u.maybeNumberOrThrowIfTooLarge)(h.msgOrderId);if(null!=f&&null!=m&&m>=f)continue;i.add(p.id);const y=le(e,h.message);0===o&&y&&d&&0===d.msgs.length&&a.push(y),n=n.concat(ce(y)),y&&t.push(y),yield(0,s.asyncSleepAfterGivenLoopIteration)(c++,100)}}S.mdBootstrapMessagesCount=l,S.mdBootstrapChatsCount=te.conversations.length,se(S,e.historySyncStepStartedTs,!0),0!==t.length&&(yield(0,W.handleProgressiveHistorySyncMsgs)(t,Array.from(i),n,a)),(0,H.setLastHistorySycnedChunk)(e.syncType,e.chunkOrder),yield(0,U.updateCurrentlyProcessed)(e.msgKey);const d=new Set;te.conversations.forEach((e=>{d.add((0,g.createWid)(e.id).toString());const t=e.endOfHistoryTransferType;if(null!=t)return ie((0,g.createWid)(e.id),t)})),A.Cmd.onHistorySyncChunkProcessed(d),ne.mdTimestamp=(0,f.unixTimeMs)(),ne.commit(),__LOG__(2)`[History sync chunk storing recent or full chunk complete,  ${oe(e,l)}`}const ae=_.default.fromString(e.msgKey),de=new Map;var pe;de.set(ae.remote,[ae.id]),e.syncType!==F.HistorySyncHistorySyncType.INITIAL_STATUS_V3&&(0,q.sendAggregateReceipts)(ae.remote,q.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,de),yield(0,U.updateCurrentlyProcessed)(e.msgKey),Q.ServerProps.webMdMmsSyncDeletionRequest&&null!=e.downloadOptions.encFilehash&&K.default.deleteMdHistorySyncBlob({directPath:e.downloadOptions.directPath,encFilehash:e.downloadOptions.encFilehash,signal:(new n).signal}).catch((()=>{__LOG__(3)`MMS client delete error`})),pe=te.progress,e.syncType===F.HistorySyncHistorySyncType.INITIAL_BOOTSTRAP?((0,H.setInitialHistorySyncComplete)(),(0,H.setHistorySyncStatus)({initialCompleted:!0}),A.Cmd.onInitialChatHistorySynced()):e.syncType===F.HistorySyncHistorySyncType.RECENT&&100===pe?(__LOG__(2,void 0,void 0,void 0,["History sync"])`Recent history sync complete`,(0,Y.setHistoryInitialSyncBoundry)({}),(0,H.setHistorySyncStatus)({recentCompleted:!0}),A.Cmd.onRecentChatHistorySynced()):e.syncType===F.HistorySyncHistorySyncType.FULL&&100===pe&&(__LOG__(2,void 0,void 0,void 0,["History sync"])`Full history sync complete`,(0,Y.setHistoryInitialSyncBoundry)({}),(0,H.setHistorySyncStatus)({fullCompleted:!0}),A.Cmd.onFullChatHistorySynced())}))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,o.default)((function*(e,t){const r=t,n=(0,L.getBridge)();yield n.sendAndReceive("chat_collection","add",{things:[{id:e,endOfHistoryTransferType:r}],options:{merge:!0}}),yield(0,S.getTable)().merge(e.toString(),{endOfHistoryTransferType:r})}))).apply(this,arguments)}function oe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(e.msgKey||"").split("_")[2];return` type_${e.syncType}_order_${null!=e.chunkOrder?e.chunkOrder:"none"}_isReupload_${e.isReupload||0}}, id: ${n} ## msgCount: ${t}, chatCount: ${r}`}function se(e,t,r){e.mdTimestamp=(0,f.unixTimeMs)(),e.mdBootstrapStepDuration=(0,f.unixTimeMs)()-t,e.mdBootstrapStepResult=r?B.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:B.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,e.commit()}function le(e,t){let r=null;try{r=ee.default.parseWebMessageInfo(t,"after")}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMessageInfo failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return r}function ce(e){const t=[];try{(0,N.parseWMIReaction)()&&null!=e&&e.reactions.forEach((r=>{const{key:n,senderTimestampMs:i,text:a,unread:o}=r,s=(0,$.convertToTextWithoutSpecialEmojis)(null!=a?a:""),l=!!n.fromMe,c=(0,$.decodeJid)(n.remoteJid);let d;n.fromMe?c.isUser()||(d=(0,D.getMeUser)()):d=(0,$.decodeJid)(n.participant);const u=new _.default({id:n.id,fromMe:l,remote:c,participant:d}),p=(0,D.getMeUser)(),f=!0===l?p:d||c;null!=f&&f instanceof h.default?null==s?__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction:convertToTextWithoutSpecialEmojis reaction text is null.`:t.push({id:u,reactionTimestamp:i,reactionText:s,reactionParentKey:e.id,sender:f,unread:Boolean(o)}):__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction: reaction sender should be a wid.`}))}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMsgInfoReaction failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return t}function de(e){switch(e){case 0:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.INITIAL;case 1:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.STATUS_V3;case 2:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.FULL_HISTORY;case 3:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY;default:return B.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.PUSHNAME}}function ue(){return pe.apply(this,arguments)}function pe(){return(pe=(0,o.default)((function*(e,t){const r=yield z.default.loadIdentityKey(e);r&&r!==t&&(__LOG__(4,void 0,new Error,!0,["history-sync"])`get changed self identity key from history sync,
exisiting length: ${r.length}, new length: ${t.length}`,SEND_LOGS("self-identity-change-from-history-sync"))}))).apply(this,arguments)}function fe(e){let t=Promise.resolve(),r=Promise.resolve();return null!=e.threadIdUserSecret&&(t=(0,C.setThreadIdUserSecret)(e.threadIdUserSecret)),null!=e.threadDsTimeframeOffset&&(r=(0,C.setThreadDsTimeframeOffset)(e.threadDsTimeframeOffset)),Promise.all([t,r])}},46462:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleE2eIdentityChange=function(e){const t=S.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const{wid:r,stanzaId:n,delay:s,offline:l}=t.success,v=(0,o.wap)("ack",{to:(0,E.DEVICE_JID)(r),id:(0,o.CUSTOM_STRING)(n),class:"notification"});if(null!=r.device&&r.device!==a.DEFAULT_DEVICE_ID)return __LOG__(2)`handleNewIdentity: ignore identity change from companion device`,Promise.resolve(v);if(r.equals((0,c.getMeUser)()))return(0,u.handleSelfPrimaryIdentityChange)(),Promise.resolve(v);const T=!!l&&!d.OfflineMessageHandler.isResumeFromRestartComplete();return(0,f.handleMessage)(String(r),T,(0,i.default)((function*(){yield(0,u.clearDeviceRecordForIdentityChange)(r,T);return(yield(0,_.getSignalProtocolStore)().loadIdentityKey((0,y.createSignalAddress)(r).toString()))&&(__LOG__(2)`handleE2eIdentityChange: ${r.toString()} has old identity, establishing new session`,yield m.Session.deleteRemoteInfo(r),(0,h.addSecurityCodeChangedNotifications)(r,T),(0,g.sendTcTokenWhenDeviceIdentityChange)(r),T||(null!=s?(0,p.ensureE2ESessionsWithDelay)([r],s):(0,p.ensureE2ESessions)([r]))),v})))};var i=n(r(48926)),a=r(52230),o=r(31914),s=r(71914),l=r(81663),c=r(99234),d=r(28237),u=r(1291),p=r(97398),f=r(15746),_=r(52083),h=r(9701),g=r(41088),m=r(77605),y=r(93832),E=r(39410);const S=new s.WapParser("identityChange",(e=>{e.assertTag("notification"),e.assertAttr("type","encrypt"),e.child("identity");const t=parseInt(e.maybeAttrString("delay"),10);return{wid:(0,l.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("from")),stanzaId:e.attrString("id"),delay:isFinite(t)&&t>0?t:null,offline:e.hasAttr("offline")?e.attrString("offline"):null}}))},65341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTED_DIRTY_TYPE=t.SUPPORTED_DIRTY_PROTOCOLS=void 0,t.handleDirtyBits=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(41075),o=r(99609),s=r(88102),l=r(45606),c=n(r(69153)),d=r(99234),u=r(28237),p=n(r(11339)),f=r(97153),_=r(74028),h=r(38804);const g={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state"};t.SUPPORTED_DIRTY_TYPE=g;function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((e=>a.ACCOUNT_SYNC_TYPE.cast(e))).filter(Boolean);return 0===t.length&&(t=Array.from(a.ACCOUNT_SYNC_TYPE.members())),Promise.all(t.map((e=>e===a.ACCOUNT_SYNC_TYPE.DEVICES?S():e===a.ACCOUNT_SYNC_TYPE.PICTURE?(0,a.getAndUpdateProfilePicture)():void(e===a.ACCOUNT_SYNC_TYPE.PRIVACY?(0,a.updatePrivacySettings)():e===a.ACCOUNT_SYNC_TYPE.BLOCKLIST&&(0,a.updateBlocklist)()))))}function y(e){return null!=e.patches&&e.patches.length>0||null!=e.snapshot}function E(){return s.Cmd.once(s.APP_STATE_SYNC_COMPLETED,(e=>{const t=e.some(y);new p.default.MdAppStateDirtyBits({dirtyBitsFalsePositive:!t}).commit()})),(0,h.markCollectionsForSync)(Array.from(l.CollectionName.members()))}function S(){const e=String((0,d.getMeUser)());return u.OfflineMessageHandler.isResumeFromRestartComplete()?u.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress()?(0,f.addUserToPendingDeviceSync)([e]):(0,a.getDevices)("notification"):(c.default.addOfflinePendingDevice(e,null),Promise.resolve())}function v(){return(v=(0,i.default)((function*(e){const{supported:t,unsupported:r,protocols:n}=e;__LOG__(2)`handleDirtyBits: handle dirty bits, supported: ${t.map((e=>e.type)).join(",")}, unsupported: ${r.map((e=>e.type)).join(",")}`;const i=[...r,...t];return yield Promise.all(t.map((e=>{const t=e.type;return t===g.groups?(0,_.queryAndUpdateAllGroupMetadata)():t===g.account_sync?m(n):t===g.syncd_app_state?E():void 0}))),(0,o.clearDirtyBits)(i)}))).apply(this,arguments)}t.SUPPORTED_DIRTY_PROTOCOLS={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist"}},86741:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(71914),o=r(88102),s=r(65341),l=r(89816),c=r(25773),d=r(28237),u=r(70768),p=r(37222);const f=new a.WapParser("infoBulletinParser",(e=>{if(e.assertTag("ib"),e.assertFromServer(),e.hasChild(p.INFO_TYPE.DIRTY)){const t=[],r=[],n=[];return e.forEachChildWithTag(p.INFO_TYPE.DIRTY,(e=>{const i={type:e.attrString("type"),timestamp:e.attrInt("timestamp")};if("account_sync"===i.type){e.mapChildren((e=>e.tag())).forEach((e=>{s.SUPPORTED_DIRTY_PROTOCOLS.hasOwnProperty(e)&&n.push(e)})),r.push(i)}else s.SUPPORTED_DIRTY_TYPE.hasOwnProperty(i.type)?r.push(i):t.push(i)})),{type:p.INFO_TYPE.DIRTY,supported:r,unsupported:t,protocols:n}}if(e.hasChild(p.INFO_TYPE.ROUTING)){const t=e.child(p.INFO_TYPE.ROUTING);return{type:p.INFO_TYPE.ROUTING,edgeRouting:t.child("routing_info").contentBytes(),domain:t.hasChild("dns_domain")?t.child("dns_domain").contentEnum(l.DOMAINS):null}}if(e.hasChild(p.INFO_TYPE.DOWNGRADE))return{type:p.INFO_TYPE.DOWNGRADE};if(e.hasChild(p.INFO_TYPE.OFFLINE))return{count:e.child(p.INFO_TYPE.OFFLINE).attrInt("count"),type:p.INFO_TYPE.OFFLINE};if(e.hasChild(p.INFO_TYPE.OFFLINE_PREVIEW))return{count:{message:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:e.child(p.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:p.INFO_TYPE.OFFLINE_PREVIEW};if(e.hasChild(p.INFO_TYPE.TOS)){const t=[];return e.child("tos").forEachChildWithTag("notice",(e=>{t.push(e.attrString("id"))})),{type:p.INFO_TYPE.TOS,noticeIds:t}}return null}));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const r=t.success;if(r)switch(r.type){case p.INFO_TYPE.DIRTY:return yield(0,s.handleDirtyBits)(r),"NO_ACK";case p.INFO_TYPE.ROUTING:return(0,l.handleRoutingInfo)(r),"NO_ACK";case p.INFO_TYPE.DOWNGRADE:return o.Cmd.downgradeWebclient(),"NO_ACK";case p.INFO_TYPE.OFFLINE:return d.OfflineMessageHandler.setOfflineSessionComplete(r.count),(0,c.reportOfflineNotifications)(),"NO_ACK";case p.INFO_TYPE.OFFLINE_PREVIEW:return yield d.OfflineMessageHandler.setOfflineMessagePreviewCounter(r.count),"NO_ACK";case p.INFO_TYPE.TOS:return u.TosManager.maybeUpdateServer(r.noticeIds),"NO_ACK"}else __LOG__(3)`handleInfoBulletin unrecognized info bulletin`}))).apply(this,arguments)}},89816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAINS=void 0,t.handleRoutingInfo=function(e){let t=e.domain;if(!t){const e=(0,i.getRoutingInfo)();t=e?e.domain:a.fb}const r=(0,n.bytesToBuffer)(e.edgeRouting);(0,i.setRoutingInfo)({domain:t,edgeRouting:r}),__LOG__(2)`handleInfoBulletin setting and domain: ${t} and edgeRouting:`};var n=r(87614),i=r(58052);const a={fb:"fb",sl:"sl"};t.DOMAINS=a},37222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFO_TYPE=void 0;const r=Object.freeze({DIRTY:"dirty",DOWNGRADE:"downgrade_webclient",ROUTING:"edge_routing",OFFLINE:"offline",OFFLINE_PREVIEW:"offline_preview",TOS:"tos"});t.INFO_TYPE=r},70605:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=n(r(45095)),s=r(31914),l=r(71914),c=r(99234),d=r(98969),u=r(16258),p=r(3151),f=r(39410);const _=new l.WapParser("mediaRetryNotification",(e=>{e.assertTag("notification");const t=e.maybeChild("error");if(t)return{msgId:e.attrString("id"),ciphertext:null,iv:null,errorCode:u.MediaRetryNotificationResultType.cast(t.attrInt("code"))};const r=e.child("encrypt");return{msgId:e.attrString("id"),ciphertext:r.child("enc_p").contentBytes(),iv:r.child("enc_iv").contentBytes(d.ENC_IV_SIZE),errorCode:null}}));function h(){return(h=(0,i.default)((function*(e){const t=_.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{msgId:r,errorCode:n}=t.success,i=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(r),class:"notification",type:"mediaretry",to:(0,f.USER_JID)((0,c.getMeUser)())});if(null!=n)return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:r,result:n}),i;const{ciphertext:l,iv:u}=t.success,h=p.RequestMediaReuploadManager.getMediaKey(r);if(!h)return __LOG__(3)`handleMediaRetryNotification: mediaKey is not found for msgId ${r}`,i;const{stanzaId:g,directPath:m,result:y}=yield(0,d.decryptMediaRetryNotification)((0,a.decodeB64)(h),r,(0,o.default)(u,"iv"),(0,o.default)(l,"ciphertext"));if(g!==r)throw new Error("handleMediaRetryNotification: msg id does not match");return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:r,result:y,directPath:m}),i}))).apply(this,arguments)}},80278:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptE2EPayload=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(50796),o=r(66751),s=r(15461),l=r(46308),c=r(58853),d=r(6303),u=r(8001),p=r(49714),f=r(12037),_=r(45033),h=r(84886),g=n(r(11339)),m=r(53348),y=r(52083),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),S=r(27286);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function T(e,t,r){const{e2eType:n,ciphertext:i}=e;switch(n){case _.CiphertextType.Skmsg:return t.isGroup()||t.isBroadcast()?r?E.Cipher.decryptGroupSignalProto(t,r,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`)):Promise.reject(new Error(`['messaging'] decryptEnc: Can not do skmsg for non group ${t.toString()}`));case _.CiphertextType.Pkmsg:case _.CiphertextType.Msg:const e=t.isUser()?t:r;return e?E.Cipher.decryptSignalProto(e,n,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`))}}function C(){return(C=(0,i.default)((function*(e){const{bizInfo:t,msgInfo:r,paymentInfo:n,deviceIdentity:_,encs:E}=e;if(null!=r.author.device&&0!==r.author.device){if(!(yield(0,l.validateADVwithEncs)(r.author,_,E,!!r.offline)))return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, validateADVIdentity failed`,{result:p.E2EProcessResult.RETRY,retryCount:E[0].retryCount}}const v=yield(0,o.promiseReduce)(e.encs,((e,o)=>{if(e.result!==p.E2EProcessResult.SUCCESS)return Promise.resolve(e);const l=(0,S.getFrom)(r),_=new g.default.E2eMessageRecv({e2eCiphertextType:(0,c.metricsCiphertextType)(o.e2eType),e2eCiphertextVersion:c.CIPHERTEXT_VERSION,e2eDestination:(0,c.metricsDestinationType)(l),e2eSuccessful:!1,messageMediaType:o.mediaType?(0,c.metricsMediaType)(o.mediaType):g.default.MEDIA_TYPE.NONE,retryCount:o.retryCount});return T(o,l,r.author).then(function(){var e=(0,i.default)((function*(e){_.e2eSuccessful=!0,_.weight=1e3,_.commit();const i={retryCount:o.retryCount,e2eType:o.e2eType,mediaType:o.mediaType,hideFail:o.hideFail};return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId} done`,yield(0,m.processDecryptedProto)(e,r,n,i,t),__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${r.externalId} done`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([u.SignalDecryptionError,d.UnknownMessageError],function(){var e=(0,i.default)((function*(e){return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, ${e.toString()}`,_.weight=1,_.commit(),o.hideFail||(yield(0,m.processPlaceholderMsg)(r,p.PlaceholderType.E2E)),{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(u.SignalMessageCounterError,function(){var e=(0,i.default)((function*(e){if(__LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, signal counter error: ${e}`,null!=r.offline&&"peer"!==r.category){const e=(0,S.messageInfoToKey)(r),t=yield(0,h.getMsgByMsgKey)(e);if(null==t&&(__LOG__(4,void 0,new Error,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, creating placeholder (upload logs for debugging)`,SEND_LOGS("handleMsg: decryption counter error creating placeholder"),o.hideFail||(yield(0,m.processPlaceholderMsg)(r,p.PlaceholderType.E2E))),null==t||t.type===s.MSG_TYPE.CIPHERTEXT)return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, missing message for repeated signal counter`,{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, ignore repeated signal counter`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(f.HsmMismatchError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: hsm mismatch error"),_.weight=1,_.commit(),{result:p.E2EProcessResult.HSM_MISMATCH})))).catch((0,a.filteredCatch)(d.ReactionValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: ReactionValidationError"),{result:p.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${r.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: parse decrypted message error"),_.weight=1,_.commit(),{result:p.E2EProcessResult.PARSE_ERROR})))}),{result:p.E2EProcessResult.SUCCESS});return yield(0,y.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),v}))).apply(this,arguments)}},6303:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageError=t.ReactionValidationError=t.DeviceSentMessageError=void 0;var i=r(40265),a=n(r(11339));class o extends((0,i.customError)("DeviceSentMessageError")){constructor(e,t){t===a.default.DSM_ERROR.MISSING_DSM?super("parseMessage: message should be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_SENDER?super("parseMessage: message should not be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_DSM?super("parseMessage: invalid deviceSentMessage"):super("parseMessage: unknown deviceSentMessage error"),new a.default.MdBadDeviceSentMessage({peerType:e,dsmError:t}).commit(),this.peerType=e,this.dsmError=t}}t.DeviceSentMessageError=o;class s extends((0,i.customError)("UnknownMessageError")){}t.UnknownMessageError=s;class l extends((0,i.customError)("ReactionValidationError")){}t.ReactionValidationError=l},49714:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderType=t.MESSAGE_TYPE=t.HostStorageEnumType=t.E2EProcessResult=t.ActualActorsEnumType=void 0;const n=r(76672)({Self:1,Bsp:2});t.ActualActorsEnumType=n;const i=r(76672)({OnPremise:1,Facebook:2});t.HostStorageEnumType=i;const a=r(76672).Mirrored(["SUCCESS","RETRY","HSM_MISMATCH","BACKFILL","PARSE_ERROR","PARSE_VALIDATION_ERROR"]);t.E2EProcessResult=a;const o=r(76672).Mirrored(["E2E","FANOUT"]);t.PlaceholderType=o;const s=Object.freeze({CHAT:"chat",GROUP:"group",PEER_BROADCAST:"peer_broadcast",OTHER_BROADCAST:"other_broadcast",DIRECT_PEER_STATUS:"direct_peer_status",OTHER_STATUS:"other_status"});t.MESSAGE_TYPE=s},70569:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.incomingMsgParser.parse(e);if(t.error){const r=p.incomingMsgParserForAckOnly.parse(e);if(r.error)return Promise.reject(t.error);const{externalId:n,from:i,type:a}=r.success;return(0,_.sendAck)(n,i,a)}const r=t.success,{msgMeta:n,msgInfo:h}=r;h.clientReceivedTsMillis=(0,a.unixTimeMs)(),null!=h.offline&&(c.OfflineMessageHandler.addOfflinePendingMessage(),c.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete());c.OfflineMessageHandler.isResumeFromRestartComplete()&&delete r.msgInfo.offline;return(0,d.handleMessage)(h.chat.toString(),!!r.msgInfo.offline,(0,i.default)((function*(){if(h.msgProcessStartTsMillis=(0,a.unixTimeMs)(),n.isUnavailable&&(__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${h.externalId}, get fanout placeholder`,yield(0,f.processPlaceholderMsg)(h,s.PlaceholderType.FANOUT),(0,_.sendReceipt)(h,n,{result:s.E2EProcessResult.BACKFILL})),null!=h.offline){const e=yield c.OfflineMessageHandler.decryptOfflineMessage(r);e.result!==s.E2EProcessResult.SUCCESS||h.category===l.CATEGORY_PEER?(0,_.sendReceipt)(h,n,e):u.default.addOfflineMessage([{receiptInfo:{externalId:h.externalId,from:(0,_.getFrom)(h),author:h.author}}])}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${h.externalId}, start processing inline message`;const e=yield(0,o.decryptE2EPayload)(r);(0,_.sendReceipt)(h,n,e)}})))};var i=n(r(48926)),a=r(92844),o=r(80278),s=r(49714),l=r(12037),c=r(28237),d=r(15746),u=n(r(29783)),p=r(20365),f=r(53348),_=r(27286)},12037:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAY_NODE_TYPES=t.MSG_VERIFIED_LEVEL=t.MSG_TYPES=t.HsmMismatchError=t.CATEGORY_PEER=void 0;var n=r(40265);t.MSG_TYPES={text:"text",media:"media",pay:"pay",reaction:"reaction"};t.MSG_VERIFIED_LEVEL={high:"high",low:"low",unknown:"unknown"};t.CATEGORY_PEER="peer";class i extends((0,n.customError)("HSMMismatchError")){}t.HsmMismatchError=i;t.PAY_NODE_TYPES={send:"send",request:"request",futureproof:"futureproof","request-decline":"request-decline","request-cancel":"request-cancel",invite:"invite"}},48616:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logReceivedMessagesInWAM=function(e,t,r,n,h){(function(e,t,r,n,o){const h=(0,a.unixTimeMs)();e.forEach((e=>{const a=new f.Msg(e),g=new p.default.MessageReceive((0,i.default)({messageType:a.getWamMessageType(),messageMediaType:a.getWamMediaType(),messageIsInternational:a.isInternational,messageIsOffline:t,isViewOnce:Boolean(a.isViewOnce)},(0,u.getGroupMetricsFromChatWid)(a.from)));if(a.from.isGroup()){var m;const e=null===(m=d.default.get(a.from))||void 0===m?void 0:m.cachedDeviceSizeBucket;null!=e&&(g.deviceSizeBucket=e)}else{const e=(0,c.getDisappearingModeSettingForUser)(a.from);null!=e&&(g.senderDefaultDisappearingDuration=e.duration);const t=(0,l.getMaybeMeUser)(),r=(0,c.getDisappearingModeSettingForUser)(t);null!=r&&(g.receiverDefaultDisappearingDuration=r.duration)}null!=n&&(g.messageReceiveT0=n-r,g.messageReceiveT1=h-n,null!=o&&(g.messageQueueTime=o-n)),null!=a.ephemeralDuration&&a.ephemeralDuration>0&&(g.ephemeralityDuration=a.ephemeralDuration);const y=a.getWamDisappearingModeInitiator();if(null!=y&&(g.disappearingChatInitiator=y),g.commit(),a.chat&&!a.isSentByMe)if((0,s.shouldBlockByCountry)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.COUNTRY}).commit()}else if((0,_.shouldBlockByTos)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.TOS3}).commit()}}))})(e,t,r,n,h),function(e){(0,o.handleActivitiesForChatThreadLogging)(e.map((e=>({activityType:e.id.fromMe?"msgSend":"msgReceive",ts:e.t,chatId:e.id.remote,isViewOnce:e.isViewOnce}))))}(e)};var i=n(r(81109)),a=r(92844),o=r(16116),s=r(47473),l=r(99234),c=r(28307),d=n(r(63928)),u=r(42515),p=n(r(11339)),f=r(17304),_=r(37894)},20365:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.incomingMsgParserForAckOnly=t.incomingMsgParser=void 0;var i=n(r(81109)),a=r(71914),o=r(81663),s=r(45454),l=r(2599),c=r(99234),d=r(49714),u=r(12037),p=r(45033),f=r(75295),_=r(52586),h=r(27286),g=r(21224);const m=new a.WapParser("incomingMsgParser",(e=>{e.assertTag("message"),e.hasAttr("to")&&e.assertAttr("to",(0,c.assertGetMe)().toJid());const t=e.mapChildrenWithTag("enc",(e=>({e2eType:e.attrEnumValues("type",p.CiphertextType.members()),mediaType:p.MediaType.cast(e.maybeAttrString("mediatype")),ciphertext:e.contentBytes(),retryCount:e.hasAttr("count")?e.attrInt("count"):0,hideFail:"hide"===e.maybeAttrString("decrypt-fail")}))),r=e.maybeChild("device-identity"),n=r?r.contentBytes():null,a=function(e,t){const r={externalId:e.attrString("id"),ts:e.attrTime("t"),edit:e.hasAttr("edit")?e.attrInt("edit"):-1,isHsm:e.hasChild("hsm"),count:e.hasAttr("count")?e.attrInt("count"):null,pushname:e.hasAttr("notify")?e.attrString("notify"):null,category:e.hasAttr("category")?e.attrString("category"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},n=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),a=e.hasAttr("participant")?(0,o.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("participant")):null,l=e.hasAttr("recipient")?(0,o.userJidToUserWid)(e.attrPhoneUserJid("recipient")):null,c=t.every((e=>e.e2eType!==p.CiphertextType.Skmsg)),u=t.some((e=>e.retryCount>0));let f;const _={},g=e.maybeChild("participants");if(g){const e=[];g.forEachChildWithTag("to",(t=>{const r=(0,o.deviceJidToDeviceWid)(t.attrPhoneDeviceJid("jid")),n=t.maybeAttrString("eph_setting");e.push(r),null!=n&&(_[r.toString()]=n)})),f=e}if(n.isUser())return null!=l?(0,h.isPeer)(n)?(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.CHAT},r),{},{chat:(0,s.toUserWid)(l),author:n}):e.throw("recipient on non peer chat message"):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.CHAT},r),{},{chat:(0,s.toUserWid)(n),author:n});if(n.isGroup())return null==a?e.throw("group message with no participant"):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.GROUP},r),{},{chat:n,author:a,isDirect:c});if(n.isBroadcast()&&!n.isStatusV3()){if(null==a)return e.throw("broadcast message with no participant");if((0,h.isPeer)(a)){if(null==f){if(!u)return e.throw("peer broadcast message with no participants node");f=[]}return(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.PEER_BROADCAST},r),{},{chat:n,author:a,isDirect:c,bclParticipants:f,bclHashValidated:!1,bclEphSettings:_})}return(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.OTHER_BROADCAST},r),{},{chat:n,author:a,isDirect:c,ephSetting:e.maybeAttrString("eph_setting")})}if(n.isBroadcast()&&n.isStatusV3())return null==a?e.throw("status message with no participant"):(0,h.isPeer)(a)&&c?null==f?(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.DIRECT_PEER_STATUS},r),{},{chat:n,author:a,isDirect:c}):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.DIRECT_PEER_STATUS},r),{},{chat:n,author:a,bclParticipants:f,bclHashValidated:!1}):(0,i.default)((0,i.default)({type:d.MESSAGE_TYPE.OTHER_STATUS},r),{},{chat:n,author:a,isDirect:c});return e.throw("Unrecognized message type")}(e,t);return{encs:t,msgInfo:a,msgMeta:function(e,t){const r=e.hasChild("unavailable");r||0!==t.length||e.throw("incomingMsgParser: to have enc node children");return{isUnavailable:r,type:e.attrEnum("type",u.MSG_TYPES),rawTs:e.attrString("t"),urlNumber:e.hasChild("url_number"),urlText:e.hasChild("url_text")}}(e,t),bizInfo:function(e){const t=e.hasChild("verified_name")?e.child("verified_name").contentBytes():null,r=e.attrEnumOrDefault("verified_level",u.MSG_VERIFIED_LEVEL,null),n=e.hasAttr("verified_name")?e.attrInt("verified_name"):-1,i=e.maybeChild("biz");let a=null;if(null!=i){const e=d.ActualActorsEnumType.cast(i.maybeAttrInt("actual_actors")),t=d.HostStorageEnumType.cast(i.maybeAttrInt("host_storage")),r=i.maybeAttrInt("privacy_mode_ts");null!=e&&null!=t&&null!=r&&(a={actualActors:e,hostStorage:t,privacyModeTs:r})}const o=null==i?void 0:i.maybeAttrString("native_flow_name");return{verifiedNameCert:t,verifiedLevel:r,verifiedNameSerial:n,privacyMode:a,nativeFlowName:o}}(e),paymentInfo:function(e){let t=null;const r=e.hasChild("pay")?e.child("pay"):null,n=e.hasChild("transaction")?e.child("transaction"):null,i=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")).isGroup(),a=e.hasAttr("participant")?(0,o.jidWithTypeToWid)(e.attrJidWithType("participant")):null;if((0,f.isNoviTransaction)(r)||(0,f.isNoviTransaction)(n))t={futureproofed:!0};else if(n){const e=(0,f.parseTransactionNode)(n);e&&(t=y(i,a,(0,s.createWid)(e.receiver.toString()))?{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts,txnStatus:(0,_.getPaymentTxnWebStatus)(e.status)}:{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts})}else if(r){switch(r.attrEnum("type",u.PAY_NODE_TYPES)){case u.PAY_NODE_TYPES.send:const{amount1000:n,currency:o}=(0,l.getAmount1000AndCurrency)(r),c=r.hasAttr("receiver")?r.attrString("receiver"):e.attrString("recipient");t=y(i,a,(0,s.createWid)(c))?{receiverJid:c,currency:o,amount1000:n,transactionTimestamp:e.attrInt("t"),txnStatus:g.PaymentInfoTxnStatus.INIT}:{receiverJid:c,currency:o,amount1000:n,transactionTimestamp:e.attrInt("t")};break;case u.PAY_NODE_TYPES.request:case u.PAY_NODE_TYPES.invite:}}return t}(e),deviceIdentity:n}}));function y(e,t,r){if(e&&null!=t&&null!=r){const e=(0,c.getMeUser)();if(!e.equals(t)&&!e.equals(r))return!1}return!0}t.incomingMsgParser=m;const E=new a.WapParser("incomingMsgParserForAckOnly",(e=>(e.assertTag("message"),{externalId:e.attrString("id"),from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),type:e.attrEnum("type",u.MSG_TYPES)})));t.incomingMsgParserForAckOnly=E},53348:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createReactionsRow=Q,t.processDecryptedProto=function(){return H.apply(this,arguments)},t.processPlaceholderMsg=function(){return z.apply(this,arguments)},t.processReactionMsg=q,t.processRenderableMsg=V,t.storeReactionMsgBulk=function(e){const t=e.map((e=>(0,s.webMsgInfoReactionTypeToReactionsRow)(e)));return t.map((e=>`${e.msgKey.toString()} to ${e.parentMsgKey}`)).toString(),(0,G.addOrUpdateReactionsDBBulk)(t)};var i=n(r(81109)),a=n(r(48926)),o=r(15461),s=r(67811),l=n(r(89867)),c=r(45454),d=r(84902),u=r(78027),p=r(10823),f=n(r(69153)),_=r(24808),h=r(6303),g=r(99234),m=r(9025),y=n(r(39505)),E=r(57701),S=r(19655),v=r(65582),T=r(82568),C=r(49714),A=r(12037),b=r(39354),P=r(65414),M=r(48616),O=r(84886),I=n(r(11339)),w=(r(17304),n(r(29783))),R=r(5819),D=r(60629),N=r(55552),L=r(30849),k=r(16150),G=r(76332),U=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=W(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),F=r(26704),x=n(r(83147)),B=r(66167),K=r(93832),j=r(27286),Y=r(22695);function W(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(W=function(e){return e?r:t})(e)}function H(){return(H=(0,a.default)((function*(e,t,r,n,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=a?(0,K.unpad)(e):new Uint8Array(e),l=(0,d.decodeProtobuf)(_.MessageSpec,s);if(null==t.offline&&__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${t.externalId}, message decrypted: `,!t.isHsm&&l.highlyStructuredMessage)throw new A.HsmMismatchError;const u=(0,j.getFrom)(t);if(!(yield(0,Y.isFromKnownDevice)(t.author))){const e=(0,c.toUserWid)(t.author);throw null==t.offline?(0,p.syncDeviceListJob)([e],null,null):f.default.addOfflinePendingDevice(String(e),null),new h.UnknownMessageError(`[messaging] msgId::${t.externalId}, processDecryptedProto: reject message from unknown device`)}if(t.type===C.MESSAGE_TYPE.PEER_BROADCAST&&n.retryCount>0){const e=yield(0,O.getMsgByMsgKey)((0,j.messageInfoToKey)(t));null!=(null==e?void 0:e.broadcastParticipants)&&(t.bclParticipants=e.broadcastParticipants,null!=e.broadcastEphSettings&&(t.bclEphSettings=e.broadcastEphSettings))}l.messageContextInfo&&(0,P.handleICDCData)(t.author,t.chat.isUser()?t.chat:null,l.messageContextInfo);const m=yield(0,j.parseMessage)(t,n.e2eType,l,r,i,e),y=[];if(m.history)(0,S.handleHistorySyncNotification)(m.history,u,t.externalId);else if(m.securityNotificationEnabled)(0,g.setGlobalSecurityNotifications)(m.securityNotificationEnabled.isEnabled);else if(m.appStateSyncKeyShare)(0,T.handleAppStateSyncKeyShare)(m.appStateSyncKeyShare,u);else if(m.appStateSyncKeyRequest)(0,v.handleAppStateSyncKeyRequest)(m.appStateSyncKeyRequest,u);else{var b;let e=!1;if(null==m.deviceSent?e=!0:m.deviceSent.phash?e=yield(0,Y.validateBclHash)(m.deviceSent.phash,m.deviceSent.info):m.deviceSent.destination&&(e=yield(0,Y.validateMsgDestination)(m.deviceSent.destination,t)),!e)throw new h.DeviceSentMessageError((0,j.getDeviceType)(t.author),I.default.DSM_ERROR.INVALID_DSM);if((0,E.receiveReactionsEnabled)()&&(null===(b=m.renderableMsgs[0])||void 0===b?void 0:b.type)===o.MSG_TYPE.REACTION)y.push(q(m.renderableMsgs[0],t));else{const e=n.retryCount>0&&(0,j.placeholderCheck)(t);y.push(V(m.renderableMsgs,t,r,i,e)),null!=m.storeMsg&&(0,O.storeMessages)([m.storeMsg],m.storeMsg.id.remote)}null!=m.senderKey&&y.push(U.Session.createGroupSignalSession(t.author,m.senderKey.groupId,m.senderKey.key)),t.pushname&&(0,k.updatePushname)(t.author,t.pushname),yield Promise.all(y),(0,M.logReceivedMessagesInWAM)(m.renderableMsgs,null!=t.offline,1e3*t.ts,t.clientReceivedTsMillis,t.msgProcessStartTsMillis)}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,n,s,c){try{const n=(0,y.default)(t,s),d=null==n?e:e.map((e=>(0,i.default)((0,i.default)({},e),{},{privacyModeWhenSent:n})));if(t.offline)return void w.default.addOfflineMessage(d.map((e=>({msg:e}))));const p=t.chat,f=r(69951).ChatCollection,_=p.isUserNotPSA(),h=_&&null==f.get(p),E=(0,L.getLatestPrivacyMode)(s.privacyMode,(0,L.getContactPrivacyMode)(p));try{if(_){const t=yield(0,m.getExisting)(p);if(null==t){const t=e[0];yield(0,D.createChatOnNewMsg)(p,t,E)}else null!=E&&(yield(0,b.handlePrivacyModeTransition)(p,E,t))}}catch(e){const t="";__LOG__(4,void 0,new Error,!0,["messaging"])`createChatOnNewMsg or handlePrivacyModeTransition ${t} failed with error: ${e}`,SEND_LOGS("createChatOnNewMsg or handlePrivacyModeTransition failed")}if(yield Promise.all(d.map(function(){var e=(0,a.default)((function*(e){yield(0,R.handleSingleMsgMD)(e.id.remote,e,c),(0,u.processOrphanAck)(e.id).catch((e=>{__LOG__(2)`processOrphanAck: msgId::${t.externalId}, failed with error: ${e}`,__LOG__(3,void 0,void 0,void 0,["messaging"])`processOrphanAck: failed`})),e.type===o.MSG_TYPE.PAYMENT&&"send"===e.subtype&&(0,N.processOrphanPaymentNotifications)([e])}));return function(){return e.apply(this,arguments)}}())),h&&(0,B.queryAndUpdateContactPropertiesOnNewChat)(p),_&&!l.default.equals((0,g.getMaybeMeUser)(),t.author)&&null!=E){const e=r(59871).MsgCollection;Promise.all(d.map((t=>{const r=e.get(t.id);if(r)return(0,x.default)(r,E)})))}}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMsg: msgId::${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e,t){if(e.category!==A.CATEGORY_PEER)try{const r=yield(0,j.genPlaceholderMsg)(e,t);e.offline?w.default.addOfflineMessage(r.map((e=>({msg:e})))):yield Promise.all(r.map(function(){var e=(0,a.default)((function*(e){const t=e.id.remote;yield(0,R.handleSingleMsgMD)(t,e)}));return function(){return e.apply(this,arguments)}}()))}catch(t){__LOG__(4,void 0,new Error,!0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, failed with error: ${t}`,SEND_LOGS("handle_msg: error storing/processing single message")}else __LOG__(2,void 0,void 0,void 0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, skip placeholder for peer message ${e.externalId}`}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){if(t.offline){const r={msg:e,receiptInfo:{from:e.from,author:t.author}};return void w.default.addOfflineMessage([r])}const r=yield Q(e,t);if(r)return String(e.id),String(e.reactionParentKey),(0,G.addOrUpdateReactions)(r,!0)}))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e,t){var r;const n=yield(0,O.getMsgByMsgKey)(e.reactionParentKey);let i,a=0;n||(a=1,i=F.OrphanReactionsReasonType.ParentMsgMissing),(null==n?void 0:n.type)===o.MSG_TYPE.CIPHERTEXT&&(a=1,i=F.OrphanReactionsReasonType.ParentMsgPlaceholder);const l=t.author;if(n&&n.type!==o.MSG_TYPE.CIPHERTEXT&&!(0,s.canHaveReactions)(n.type))return __LOG__(3)`createReactionsRow: reactions not allowed for this message type ${n.type}`,Promise.resolve();const d=(0,c.toUserWid)(l);return{msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:d.toString(),reactionText:null!==(r=e.reactionText)&&void 0!==r?r:s.REVOKED_REACTION_TEXT,timestamp:e.reactionTimestamp,orphan:a,orphanReason:i,read:!1}}))).apply(this,arguments)}},27286:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPlaceholderMsg=function(){return F.apply(this,arguments)},t.generateBaseMsg=x,t.getDeviceType=W,t.getFrom=H,t.isPeer=j,t.messageInfoToKey=Y,t.parseMessage=function(){return M.apply(this,arguments)},t.placeholderCheck=U,t.sendAck=function(e,t,r){return Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:t?(0,P.JID)(t):s.DROP_ATTR,type:r})))},t.sendReceipt=function(e,t,r){const{externalId:n}=e,{rawTs:i,type:a}=t,o=H(e),l=e.type===y.MESSAGE_TYPE.CHAT&&j(e.author)?e.chat:null,c=e.type===y.MESSAGE_TYPE.CHAT?null:e.author,d=e.category===E.CATEGORY_PEER;switch(r.result){case y.E2EProcessResult.SUCCESS:return(0,A.sendDeliveryReceiptsAfterDecryption)(n,o,l,c,d,a);case y.E2EProcessResult.HSM_MISMATCH:return Promise.resolve();case y.E2EProcessResult.RETRY:const e=null==r.retryCount?1:r.retryCount+1;return(0,b.sendRetryReceipt)(e,o,c,l,n,i,d);case y.E2EProcessResult.PARSE_VALIDATION_ERROR:return(0,A.sendDeliveryReceiptsAfterDecryption)(n,o,l,c,d,a),Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:o?(0,P.JID)(o):s.DROP_ATTR,type:t.type,participant:c?(0,P.USER_JID)(c):s.DROP_ATTR})));default:return Promise.resolve((0,f.castStanza)((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"message",from:(0,P.DEVICE_JID)((0,m.assertGetMe)()),to:o?(0,P.JID)(o):s.DROP_ATTR,type:t.type,participant:c?(0,P.USER_JID)(c):s.DROP_ATTR})))}};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(31914),l=r(35470),c=n(r(65212)),d=r(15461),u=n(r(89867)),p=r(45454),f=r(24747),_=r(47343),h=r(6303),g=r(7003),m=r(99234),y=r(49714),E=r(12037),S=r(45033),v=r(84886),T=n(r(11339)),C=r(13493),A=r(16927),b=r(55253),P=r(39410);function M(){return(M=(0,a.default)((function*(e,t,r,n,i){var a,o,s,l;let c,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if(null!=(null===(a=r.protocolMessage)||void 0===a?void 0:a.historySyncNotification)){c={history:(0,C.parseMsgProto)(r,x(e),"relay",n,void 0,void 0,i).historySyncMetaData}}else if(null!=(null===(o=r.protocolMessage)||void 0===o?void 0:o.initialSecurityNotificationSettingSync)){var u;c={securityNotificationEnabled:{isEnabled:null===(u=r.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)||void 0===u||u}}}else if(null!=(null===(s=r.protocolMessage)||void 0===s?void 0:s.appStateSyncKeyShare))c={appStateSyncKeyShare:r.protocolMessage.appStateSyncKeyShare};else if(null!=(null===(l=r.protocolMessage)||void 0===l?void 0:l.appStateSyncKeyRequest))c={appStateSyncKeyRequest:r.protocolMessage.appStateSyncKeyRequest};else switch(e.type){case y.MESSAGE_TYPE.CHAT:c=j(e.author)?yield O(e,r,n,i,d):yield D(e,r,n,i,d);break;case y.MESSAGE_TYPE.GROUP:c=j(e.author)&&e.isDirect?yield O(e,r,n,i,d):yield D(e,r,n,i,d);break;case y.MESSAGE_TYPE.PEER_BROADCAST:if(t===S.CiphertextType.Skmsg){if(!e.bclHashValidated)throw new Error("parseMessage: participants for peer broadcast message is not validated");c=yield D(e,r,n,i,d)}else c=yield w(e,r,n,i,d);break;case y.MESSAGE_TYPE.OTHER_BROADCAST:c=yield D(e,r,n,i,d);break;case y.MESSAGE_TYPE.DIRECT_PEER_STATUS:c=e.isDirect?yield O(e,r,n,i,d):yield w(e,r,n,i,d);break;case y.MESSAGE_TYPE.OTHER_STATUS:c=yield D(e,r,n,i,d);break;default:throw new Error("Unrecognized MESSAGE_TYPE")}return c}))).apply(this,arguments)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,r,n,a){const{deviceSentMessage:o}=t;if(null==o)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.MISSING_DSM);if(null==o.destinationJid)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_DSM);const{destinationJid:s}=o,l=yield L(e,o.message,r,n,a);return(0,i.default)({deviceSent:{destination:(0,p.createWid)(s)}},l)}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,r,n,a){const{deviceSentMessage:o}=t;if(null==o)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.MISSING_DSM);if(null==o.phash)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_DSM);const{phash:s}=o,l=yield L(e,o.message,r,n,a);return(0,i.default)({deviceSent:{phash:s,info:e}},l)}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t,r,n,a){if(null!=t.deviceSentMessage)throw new h.DeviceSentMessageError(W(e.author),T.default.DSM_ERROR.INVALID_SENDER);const o=yield L(e,t,r,n,a);return(0,i.default)({deviceSent:null},o)}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t,r,n,a){var o;if(null==t)return{senderKey:null,storeMsg:null,renderableMsgs:[]};let s=(0,C.parseMsgProto)(t,x(e),"relay",r,void 0,void 0,n,e.edit);s=(0,i.default)((0,i.default)({},s),yield(0,g.genDirectConnectionMessageModifiers)(s.type,null===(o=s.list)||void 0===o?void 0:o.listType,s.businessOwnerJid));const l=null!=t.senderKeyDistributionMessage?G(e,t.senderKeyDistributionMessage):null,c=s.type===d.MSG_TYPE.UNKNOWN&&null==l,u=s.type===d.MSG_TYPE.UNKNOWN&&null!=l;let p=null;if(c&&(s.futureproofBuffer=a),e.type===y.MESSAGE_TYPE.OTHER_STATUS&&(s.campaignId=e.campaignId,s.campaignDuration=e.campaignDuration),e.type===y.MESSAGE_TYPE.PEER_BROADCAST&&(s.broadcastId=e.chat,s.broadcastParticipants=e.bclParticipants,s.broadcastEphSettings=e.bclEphSettings,p=s),e.type===y.MESSAGE_TYPE.OTHER_BROADCAST){s.broadcastId=e.chat;const t=e.ephSetting,r=s.ephemeralSharedSecret;if(null!=t&&null!=r){const{ephemeralDuration:n,ephemeralSettingTimestamp:i}=yield(0,_.decodeBroadcastEphemeralSetting)(e.chat,(0,m.getMeUser)(),e.author,t,r);s.ephemeralDuration=n,s.ephemeralSettingTimestamp=i}}let f=[];return u||(e.type===y.MESSAGE_TYPE.PEER_BROADCAST?f=yield B(s,e.bclParticipants,e.bclEphSettings):("payment_transaction_request_cancelled"!==s.subtype&&"payment_action_request_declined"!==s.subtype||null!=s.paymentRequestMessageKey)&&"non_renderable"!==s.subtype&&(f=[s])),{senderKey:l,storeMsg:p,renderableMsgs:f}}))).apply(this,arguments)}function G(e,t){if(!e.chat.isGroup()&&!e.chat.isBroadcast())throw new Error("should not have senderkey");const{groupId:r,axolotlSenderKeyDistributionMessage:n}=t;if(null==r||e.chat.toString({legacy:!0})!==r)throw new Error(`senderKeyDistributionMessage: from ${e.chat.toString()} mismatched to ${r||"null"}`);if(!n)throw new Error(`senderKeyDistributionMessage: from ${e.author.toString()} has no content`);return{groupId:r,key:n}}function U(e){return e.edit!==l.EDIT_ATTR.SENDER_REVOKE||e.type===y.MESSAGE_TYPE.PEER_BROADCAST}function F(){return(F=(0,a.default)((function*(e,t){if(!U(e))return[];const r=x(e);if(t===y.PlaceholderType.E2E?r.type=d.MSG_TYPE.CIPHERTEXT:(r.type=d.MSG_TYPE.CIPHERTEXT,r.subtype="fanout"),e.type===y.MESSAGE_TYPE.PEER_BROADCAST){if(r.broadcastParticipants=e.bclParticipants,r.broadcastEphSettings=e.bclEphSettings,(0,v.storeMessages)([r],r.id.remote),e.edit===l.EDIT_ATTR.SENDER_REVOKE)return[];return yield B(r,e.bclParticipants)}return[r]}))).apply(this,arguments)}function x(e){const t=Y(e),r=(0,m.getMeUser)(),n={id:t,from:t.fromMe?r:t.remote,to:t.fromMe?t.remote:r,type:d.MSG_TYPE.UNKNOWN,t:e.ts||0,ack:l.ACK.SENT,author:!t.fromMe&&u.default.isGroup(t.remote)||u.default.isStatusV3(t.remote)?t.participant:void 0,broadcast:!1,notifyName:e.pushname||""};return null!=e.count&&(n.count=e.count),n}function B(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e,t,r){return(yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){let n,a,o;try{n=new c.default({remote:t,fromMe:!0,id:e.id.id})}catch(e){return __LOG__(3)`drop: cannot create MsgKey: ${e.stack}`,null}const s=r?r[t.toString()]:null,l=e.ephemeralSharedSecret,d=e.broadcastId;null!=d&&null!=s&&null!=l&&({ephemeralDuration:a,ephemeralSettingTimestamp:o}=yield(0,_.decodeBroadcastEphemeralSetting)(d,t,(0,m.getMeUser)(),s,l));const u=(0,i.default)((0,i.default)({},e),{},{id:n,from:(0,m.getMeUser)(),to:t,broadcast:!0,ephemeralDuration:a,ephemeralSettingTimestamp:o});return e.protocolMessageKey&&(u.protocolMessageKey=new c.default({remote:t,fromMe:!0,id:e.protocolMessageKey.id})),u}));return function(){return t.apply(this,arguments)}}()))).filter(Boolean)}))).apply(this,arguments)}function j(e){return(0,p.toUserWid)(e).equals((0,m.getMeUser)())}function Y(e){return e.type===y.MESSAGE_TYPE.OTHER_BROADCAST?new c.default({remote:(0,p.toUserWid)(e.author),fromMe:!1,id:e.externalId}):e.type===y.MESSAGE_TYPE.CHAT?new c.default({remote:e.chat,fromMe:j(e.author),id:e.externalId}):new c.default({remote:e.chat,fromMe:j(e.author),participant:(0,p.toUserWid)(e.author),id:e.externalId})}function W(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID?T.default.DEVICE_TYPE.PRIMARY:T.default.DEVICE_TYPE.COMPANION}function H(e){return e.type===y.MESSAGE_TYPE.CHAT?e.author:e.chat}},39505:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.type!==o.MESSAGE_TYPE.CHAT)return;if(!i.default.equals((0,a.getMaybeMeUser)(),e.author))return t.privacyMode;const r=t.privacyMode,n=(0,s.getContactPrivacyMode)(e.chat);return(0,s.getLatestPrivacyMode)(n,r)};var i=n(r(89867)),a=r(99234),o=r(49714),s=r(30849)},22695:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isFromKnownDevice=function(){return p.apply(this,arguments)},t.validateBclHash=function(){return u.apply(this,arguments)},t.validateMsgDestination=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(45454),s=r(9108),l=r(99234),c=r(53686);function d(){return(d=(0,i.default)((function*(e,t){const r=t.author,n=t.chat;if(!e.equals(n))return __LOG__(4,void 0,new Error,!0)`encDestination: ${String(e)}, destination: ${n.toString()}`,SEND_LOGS("validateMsgDestination: drop due to the deviceSentMessage meta mismatch."),Promise.resolve(!1);const i=(0,o.toUserWid)(r),a=r.device||0;if(!i.equals((0,l.getMeUser)()))return __LOG__(4,void 0,new Error,!0)`sender: ${r.toString()}`,SEND_LOGS("validateMsgDestination: drop due to msg is not sent from your own device."),Promise.resolve(!1);const c=yield(0,s.hasDevice)(i,a);return c||(__LOG__(4,void 0,new Error,!0)`no record found for sender: ${r.toString()}`,SEND_LOGS("validateMsgDestination:drop due to invalid device")),c}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){var r;const n=null!==(r=t.bclParticipants)&&void 0!==r?r:[],i=yield(0,c.phashV2)(n);return i!==e?(__LOG__(4,void 0,new Error,!0)`expected: ${e}, got: ${i}`,SEND_LOGS("validateBclHash: drop due to invalid hash."),!1):(t.bclHashValidated=!0,!0)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=null==e.device?a.DEFAULT_DEVICE_ID:e.device;if(t===a.DEFAULT_DEVICE_ID)return!0;const[r]=yield(0,s.getDeviceIds)([e.user]);return null!=r&&r.devices.includes(t)}))).apply(this,arguments)}},48309:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleChatSimpleAck=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(35470),o=n(r(65212)),s=r(45454),l=r(86945),c=r(99234),d=r(29331),u=r(28237),p=r(47124),f=n(r(66545));function _(){return(_=(0,i.default)((function*(e){const{from:t,externalIds:r,ts:n,recipient:i,ackString:_,offline:g,biz:m}=e;let{ack:y}=e;const E=_===a.ACK_STRING.SENDER,S=!E&&(0,s.toUserWid)(t).equals((0,c.getMeUser)());let v;if(S||E){if(!i)throw new Error("handleChatSimpleAck: invalid sender/peer receipt without recipient");v=i}else{v=(0,s.toUserWid)(t);"none"===(0,c.getUserPrivacySettings)().readReceipts&&(y===a.ACK.READ||y===a.ACK.PLAYED&&(0,l.getABPropConfigValue)("played_self_enabled"))&&(y=a.ACK.RECEIVED)}const T=r.map((e=>new o.default({id:e,remote:v,fromMe:!S})));S&&y===a.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(T);const C=T.map((e=>e.toString()));if(null!=g&&u.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==g||u.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(h(S,E,T,v,y,n,m)),S||e.push((0,p.updateReceiptRecords)(y,n,t,C,m?{actualActors:m.actualActors,hostStorage:m.hostStorage,privacyModeTs:m.privacyModeTs}:null).catch((e=>{__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleChatSimpleAck: failed")}))),yield Promise.all(e)}else{if(!S)return f.default.addOfflineReceipt(y,n,t,C);if(null!=i&&(_===a.ACK_STRING.READ||_===a.ACK_STRING.READ_SELF||_===a.ACK_STRING.PLAYED||_===a.ACK_STRING.PLAYED_SELF)&&r.length>0)return f.default.addOfflinePeerReceipt(n,C,y)}}))).apply(this,arguments)}function h(e,t,r,n,i,o,s){return i<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleChatSimpleAck: sender receipt from peer device ${n.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleChatSimpleAck: peer receipt from peer device ${n.toString()}`,i===a.ACK.READ?(0,d.updateChatPeerRead)(n,r):i===a.ACK.PLAYED?(0,d.updateMsgAcks)(r,i,o):Promise.resolve()):(0,d.updateMsgAcks)(r,i,o,s)}},84947:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupSimpleAck=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(35470),o=n(r(65212)),s=r(45454),l=r(78027),c=r(99234),d=r(29331),u=r(28237),p=r(47124),f=r(59871),_=r(52821),h=r(17972),g=r(29731),m=n(r(66545));function y(){return(y=(0,i.default)((function*(e){const{ack:t,from:r,externalIds:n,ts:l,ackString:f,participant:_,recipient:h,offline:y}=e;if(!_)throw new Error("handleGroupSimpleAck: got group ack without participant.");const S=(0,c.getMeUser)(),v=(0,s.toUserWid)(_),T=f===a.ACK_STRING.SENDER,C=!T&&v.equals(S);let A;if(C){if(!h)throw new Error("handleGroupSimpleAck: invalid sender/peer receipt without recipient");A=h}else A=S;const b=n.map((e=>new o.default({id:e,remote:r,fromMe:!C,participant:A})));C&&t===a.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(b);const P=b.map((e=>e.toString()));if(null!=y&&u.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),null==y||u.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(E(C,T,b,r,t,v,l)),C||e.push(new g.NonPersistJob("updateGroupReceiptRecords",(0,i.default)((function*(){try{yield(0,p.updateReceiptRecords)(t,l,_,P)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleGroupSimpleAck: failed")}}))).waitUntilCompleted()),yield Promise.all(e)}else{if(!C)return m.default.addOfflineReceipt(t,l,_,P);if(null!=h&&(f===a.ACK_STRING.READ||f===a.ACK_STRING.READ_SELF||f===a.ACK_STRING.PLAYED||f===a.ACK_STRING.PLAYED_SELF)&&n.length>0)return m.default.addOfflinePeerReceipt(l,P,t)}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r,n,o,s,u){return o<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleGroupSimpleAck: sender receipt from peer device ${n.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleGroupSimpleAck: peer receipt from peer device ${n.toString()}`,o===a.ACK.READ&&(0,d.updateChatPeerRead)(n,r),o===a.ACK.PLAYED?(0,d.updateMsgAcks)(r,o,u):Promise.resolve()):void(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=f.MsgCollection.get(e);if(!t)return void __LOG__(2)`handleGroupSimpleAck: no message found for incoming ack, with msgKey:`;const r=yield h.MsgInfoCollection.find(e);return r||(__LOG__(3,void 0,void 0,!0)`Assertion failed! ${e.toString()}`,SEND_LOGS("handleGroupSimpleAck: no msgInfo found for msg:")),(0,_.updateMsgInfo)(r,o,s,u),o===a.ACK.RECEIVED&&0===r.deliveryRemaining||o===a.ACK.READ&&0===r.readRemaining||o===a.ACK.PLAYED&&0===r.playedRemaining?(0,l.updateMsgAck)(t,null,{from:(0,c.assertGetMe)(),to:n,ack:o,t:u}):void 0}));return function(){return e.apply(this,arguments)}}())))}))).apply(this,arguments)}},17234:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return E.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(31914),s=r(35470),l=n(r(65212)),c=n(r(89867)),d=r(48309),u=r(99234),p=r(84947),f=r(78428),_=r(28237),h=n(r(66545)),g=r(90756),m=r(97563),y=r(39410);function E(){return(E=(0,a.default)((function*(e){const t=f.msgReceiptParser.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,new Error(t.error);{const e=t.success,{ack:r,ackString:n,from:i,stanzaId:a}=e;if(e.type===f.RECEIPT_TYPE.SIMPLE){if(r===s.ACK.CONTENT_GONE)return T(i,a,n,null);let t=null;null==e.offline||_.OfflineMessageHandler.isResumeFromRestartComplete()?t=T(i,a,n,e.participant):h.default.addOfflineReceiptAck(i,a,n,e.participant);try{__LOG__(2)`handleSimpleAck: got receipt ${e.ack} for msg ${e.stanzaId}`,yield S(e)}catch(e){}return t}if(e.type===f.RECEIPT_TYPE.AGGREGATE){const t=T(i,a,n,null);try{__LOG__(2)`handleAggregateAck: got ${e.receipts.length} receipts of ack type ${e.ack} for msg ${e.externalId}`,yield v(e)}catch(e){}return t}return __LOG__(4,void 0,new Error,!0)`type: ${e.type}`,SEND_LOGS("handleMsgReceipt: Invalid receipt type"),T(i,a,n,null)}}))).apply(this,arguments)}function S(e){const{from:t,ack:r,stanzaId:n,participant:a}=e;if(r===s.ACK.MD_DOWNGRADE){const e=new l.default({id:n,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,u.getMeUser)()});return(0,m.updateLocalAndModel)(e,{mdDowngrade:!(a&&c.default.isWid(a)&&a.isUser())||a.toString()})}if(r===s.ACK.PEER)return Promise.resolve();if(t.isStatusV3())return(0,g.handleStatusSimpleAck)(e);if(t.isUser())return(0,d.handleChatSimpleAck)(e);if(t.isGroup())return(0,p.handleGroupSimpleAck)(e);if(t.isBroadcast()){if(!e.participant)return Promise.reject(new Error(`handleSimpleAck: missing participant for broadcast receipt ${t.toString()}`));const r=(0,i.default)((0,i.default)({},e),{},{from:e.participant,participant:null});return(0,d.handleChatSimpleAck)(r)}return Promise.reject(new Error(`handleSimpleAck: unsupported type for ${t.toString()}`))}function v(e){const{ack:t,from:r}=e;if(t===s.ACK.CONTENT_GONE)return Promise.reject(new Error("handleAggregateAck: reupload receipts cannot be aggregated"));if(!r.isGroup())return Promise.reject(new Error("handleAggregateAck: aggregate receipts should come only from group JIDs"));const n=e.receipts.map((t=>S({type:f.RECEIPT_TYPE.SIMPLE,stanzaId:e.externalId,externalIds:[e.externalId],from:e.from,participant:t.participant,recipient:null,ts:t.ts,ack:e.ack,ackString:e.ackString,offline:e.offline,biz:null})));return Promise.all(n)}function T(e,t,r,n){return(0,o.wap)("ack",{to:(0,y.JID)(e),id:(0,o.CUSTOM_STRING)(t),class:"receipt",type:(0,o.MAYBE_CUSTOM_STRING)(r),participant:n&&n!==e?(0,y.DEVICE_JID)(n):o.DROP_ATTR})}},29331:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleViewOnceOpenedIfNecessary=function(e){e.forEach((e=>{const t=_.MsgCollection.get(e);(null==t?void 0:t.isViewOnce)&&(0,u.handleActivitiesForChatThreadLogging)([{activityType:"viewOnceOpen",ts:t.t,chatId:t.id.remote}])}))},t.processOrphanPeerReceipt=function(e){return y.enqueue((0,i.default)((function*(){const t=yield(0,h.getOrphanReceipt)(String(e));t?(null!=t[o.ACK_STRING.PLAYED]&&(__LOG__(2)`processOrphanPeerReceipt: orphan played ack found for incoming ${e}`,yield C([e],o.ACK.PLAYED,t[o.ACK_STRING.PLAYED])),null!=t[o.ACK_STRING.READ]&&(__LOG__(2)`processOrphanPeerReceipt: orphan read ack found for incoming ${e}`,v(e.remote,[e])),yield(0,h.removeOrphanReceipt)(String(e))):__LOG__(2)`processOrphanPeerReceipt: no orphan ack found for incoming ${e}`})))},t.updateChatPeerRead=v,t.updateMsgAcks=C;var i=n(r(48926)),a=r(27870),o=r(35470),s=n(r(65212)),l=r(38342),c=r(87845),d=r(48285),u=r(16116),p=r(57701),f=r(90981),_=r(59871),h=r(40221),g=r(76332),m=r(9609);const y=new a.PromiseQueue;function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const r=(yield(0,l.getActiveMessageRanges)(e)).filter((e=>"markChatAsRead"===e.action&&!1===e.actionValue.read&&null!=e.actionValue.messageRange));if(0===r.length)return!0;const n=r[0];return t.some((e=>!(0,c.rangeContainsMessage)(n.actionValue.messageRange,{id:s.default.fromString(e.id),t:e.t})))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const n=t.map(String),i=[];let a=null;const s=yield(0,f.getTable)().bulkGet(n,!1);s.forEach(((e,t)=>{e?null==e.pendingReadReceipt||null!=e.rowId&&(null==a||e.rowId>a)&&(a=e.rowId):i.push(n[t])})),y.enqueue((()=>(__LOG__(2)`updateChatPeerRead: storing ${i.length} orphan acks`,(0,h.createOrUpdateOrphanReceipt)(o.ACK_STRING.READ,0,i)))),yield(0,d.markMessageAndChatAsRead)(a,String(e),!(yield E(e.toString(),s.filter(Boolean)))),(0,p.receiveReactionsEnabled)()&&(yield(0,g.markReactionsAsReadByMessageKeys)(t));const l=r(69951).ChatCollection.get(e);l&&((0,m.updateUnreadCountMD)(l,0,!1),(0,m.clearUnreadMentions)(l))}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,i){const a=[],s=[],l=r(78027).updateMsgAck;e.forEach((e=>{const r=_.MsgCollection.get(e);r?s.push(l(r,null,{from:r.from,to:r.to,ack:t,t:n,deliveryPrivacyMode:o.ACK.RECEIVED===t?i:null})):(__LOG__(2)`updateMsgAcks: no message found for incoming ack, with msgKey: ${e}`,e.fromMe||a.push(e))})),a.length>0&&y.enqueue((()=>{__LOG__(2)`updateMsgAcks: store ${a.length} orphan acks`;let e=null;if(t===o.ACK.PLAYED?e=o.ACK_STRING.PLAYED:t===o.ACK.READ&&(e=o.ACK_STRING.READ),e)return(0,h.createOrUpdateOrphanReceipt)(e,n,a.map(String))})),yield Promise.all(s)}))).apply(this,arguments)}},78428:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgReceiptParser=t.RECEIPT_TYPE=void 0;var i=n(r(81109)),a=r(71914),o=r(35470),s=r(81663),l=r(99234),c=r(49714);const d={read:o.ACK.READ,played:o.ACK.PLAYED,inactive:o.ACK.INACTIVE,"server-error":o.ACK.CONTENT_GONE,"md-downgrade":o.ACK.MD_DOWNGRADE,sender:o.ACK.RECEIVED,"read-self":o.ACK.READ,"played-self":o.ACK.PLAYED,peer_msg:o.ACK.PEER},u={SIMPLE:"simple",AGGREGATE:"aggregate"};t.RECEIPT_TYPE=u;const p=new a.WapParser("incomingMsgReceiptParser",(e=>{e.assertTag("receipt"),e.hasAttr("to")&&e.assertAttr("to",(0,l.assertGetMe)().toJid());const t={ack:e.attrEnumOrDefault("type",d,o.ACK.RECEIVED),stanzaId:e.attrString("id"),from:(0,s.jidWithTypeToWid)(e.attrJidWithType("from")),ackString:e.hasAttr("type")?e.attrString("type"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},r=e.maybeChild("participants");return r?function(e,t){const r=t.mapChildrenWithTag("user",(e=>{try{const t=(0,s.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid"));return{participant:t,ts:e.attrTime("t")}}catch(e){return null}})).filter((e=>null!=e));return(0,i.default)((0,i.default)({},e),{},{type:u.AGGREGATE,externalId:t.attrString("key"),receipts:r})}(t,r):function(e,t){const r=t.hasAttr("participant")?(0,s.deviceJidToDeviceWid)(t.attrPhoneDeviceJid("participant")):null,n=t.hasAttr("recipient")?(0,s.userJidToUserWid)(t.attrPhoneUserJid("recipient")):null;let a,o;a=t.hasChild("list")?t.child("list").mapChildrenWithTag("item",(e=>e.attrString("id"))):[];if(t.hasChild("biz")){const e=t.child("biz"),r=c.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),n=c.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),i=e.maybeAttrInt("privacy_mode_ts");null!=r&&null!=n&&null!=i&&(o={actualActors:r,hostStorage:n,privacyModeTs:i})}return a.push(e.stanzaId),(0,i.default)((0,i.default)({},e),{},{type:"simple",externalIds:a,participant:r,recipient:n,ts:t.attrTime("t"),biz:o})}(t,e)}));t.msgReceiptParser=p},90756:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleStatusSimpleAck=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(35470),s=n(r(65212)),l=r(45454),c=r(99234),d=r(29331),u=r(47124),p=r(52821),f=r(17972),_=r(59387);function h(){return(h=(0,i.default)((function*(e){const{externalIds:t,ts:r,ackString:n,ack:i,participant:d,recipient:p}=e;if("none"===(0,c.getUserPrivacySettings)().readReceipts||n!==o.ACK_STRING.READ)return;if(!d)return __LOG__(4,void 0,new Error,!0)`error: got status ack without participant`,void SEND_LOGS("handleStatusSimpleAck: failed");const f=(0,c.getMeUser)(),_=(0,l.toUserWid)(d),h=_.equals(f),m=new s.default({id:t[0],remote:(0,l.createWid)(a.STATUS_JID),fromMe:!h,participant:null!=p?p:f}),y=[m.toString()];if(!h)try{yield(0,u.updateReceiptRecords)(i,r,d,y)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleStatusSimpleAck: failed")}yield g(h,m,_,r)}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r,n){if(e){const e=_.StatusV3Collection.get(t.participant);e&&e.handleReadStatus(t)}else{const e=yield f.MsgInfoCollection.find(t);(0,p.updateMsgInfo)(e,o.ACK.READ,r,n)}yield(0,d.updateMsgAcks)([t],o.ACK.READ,n)}))).apply(this,arguments)}},58464:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdaptiveOfflineEnabled=function(){return(0,n.getABPropConfigValue)("web_adaptive_offline_resume_enabled")};var n=r(86945)},98972:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDanglingReceipts=u,t.sendAndClearDanglingReceipts=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(45454),s=r(93771),l=r(74727),c=r(29100);function d(){return(d=(0,i.default)((function*(){const e=yield(0,s.getTable)().all(),t=new Map;e.forEach((e=>{const{receipts:r}=e;r.forEach((e=>{const r=(0,o.createWid)(e.from),n=(0,o.createWid)(e.author);let i=t.get(r);i||(i=new Map,t.set(r,i));let a=i.get(n);a||(a=[],i.set(n,a)),a.push(e.externalId)}))}));const r=String((0,a.unixTime)());yield Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,l.sendAggregateReceipts)(e,l.RECEIPT_TYPE.DELIVERY,r,n)}))),yield u()}))).apply(this,arguments)}function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){yield(0,c.blockSendPing)(),yield(0,s.getTable)().clear()}))).apply(this,arguments)}},69153:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),o=r(57319),s=r(24747),l=r(97153);var c=new class{constructor(){this.pendingDeviceCache=new Set,this.pendingAcks=[],this.snapshotTimer=new o.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new a.PromiseQueue}addOfflinePendingDevice(e,t){this.pendingDeviceCache.add(e),t&&this.pendingAcks.push(t),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][device-cache]: creating snapshot: schedule in ${3e3} ms`,this.snapshotTimer.onOrAfter(3e3))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.pendingDeviceCache),t=this.pendingAcks;__LOG__(2)`[offline-resume][device-cache]: creating snapshot for pending devices ${e.join(",")}`,this.checkpointQueue.enqueue((0,i.default)((function*(){yield(0,l.addUserToPendingDeviceSync)(e),t.forEach(s.castStanza),(0,s.cancelDeadSocketTimer)()}))),this.pendingDeviceCache=new Set,this.pendingAcks=[]}};t.default=c},28237:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineMessageHandlerImpl=t.OfflineMessageHandler=void 0;var i=n(r(48926)),a=r(13959),o=r(4352),s=r(98972),l=r(88102),c=r(80278),d=r(36163),u=r(15746),p=n(r(29783)),f=r(52083),_=n(r(66545)),h=r(49714),g=r(65044),m=r(97153),y=n(r(69153)),E=r(57319),S=r(83578),v=r(58464),T=r(45607),C=r(57701),A=r(6684),b=n(r(65212)),P=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=D(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(22906)),M=r(85553),O=r(97480),I=r(60324),w=r(55552),R=r(16116);function D(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(D=function(e){return e?r:t})(e)}const N=20,L=50,k=200,G=r(76672)({INIT:"INIT",RESUME_ON_RESTART:"RESUME_ON_RESTART",RESUME_WITH_OPEN_TAB:"RESUME_WITH_OPEN_TAB",COMPLETE:"COMPLETE"});class U{constructor(){this._offlineCompleteTimer=null,this.initState(),l.Cmd.on("logout",(()=>{this.initState()})),l.Cmd.on("open_socket_stream",(()=>{O.OfflineResumeReporter.logSocketConnectT()}))}initState(){this._offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=G.INIT,this._pendingMessageCount=0,this._isPendingPrevBatch=!1}setStatus(e){e===G.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] begin RESUME_WITH_OPEN_TAB`:e===G.RESUME_ON_RESTART?__LOG__(2)`[offline-resume][handler] begin RESUME_ON_RESTART`:e===G.COMPLETE&&(this._status===G.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] finished RESUME_WITH_OPEN_TAB`:__LOG__(2)`[offline-resume][handler] finished RESUME_ON_RESTART`),this._status=e}setOfflineMessagePreviewCounter(e){var t=this;return(0,i.default)((function*(){if(O.OfflineResumeReporter.logOfflinePreviewT(),t.isResumeFromRestartComplete()){__LOG__(2)`[offline-resume][handler] Offline session is complete when receiving offline preview ib.`,t._exceedResumeWithOpenTabLimit(e.message,e.receipt)&&(__LOG__(2)`[offline-resume][handler] restart client due to exceed the LIMIT, message: ${e.message}, receipt: ${e.receipt}`,B()),M.jsHaltDetector.restartDetection(),t.setStatus(G.RESUME_WITH_OPEN_TAB);const n=r(69951).ChatCollection;n.disableSortListener(),setTimeout((()=>{n.enableSortListener(!0)}),7e3)}else if(t._status===G.INIT)O.OfflineResumeReporter.logOfflineCount(e),t._hasMessagesToDownload=e.message>0,t._finishedDownloading=0===e.message,t._offlineMessagePreviewCounter=e.message,t._decryptedMessageCount=0,t._firstPreviewReceivedT=Date.now(),l.Cmd.handleOfflineProgressUpdate(),M.jsHaltDetector.restartDetection(),t.setStatus(G.RESUME_ON_RESTART),yield(0,f.enableMemSignalStore)(),t._startOfflineCompleteTimer(e.message,e.receipt);else{const r=t._firstPreviewReceivedT;if(null!=r){const n=Date.now()-r;n<1e3?(__LOG__(2)`[offline-resume][handler] Accept multiple offline preview ibs during offline resume, delay ${n}.`,t._offlineMessagePreviewCounter+=e.message,t._hasMessagesToDownload=t._offlineMessagePreviewCounter>0,t._finishedDownloading=0===t._offlineMessagePreviewCounter,O.OfflineResumeReporter.logOfflineCount(e),l.Cmd.handleOfflineProgressUpdate()):__LOG__(2)`[offline-resume][handler] Reject multiple offline preview ib during offline resume, delay ${n}.`}t.refreshOfflineCompleteTimer()}}))()}getOfflineDeliveryProgress(){return this._finishedDownloading?100:-1===this._offlineMessagePreviewCounter?0:0===this._offlineMessagePreviewCounter?100:Math.min(Math.ceil(100*this._decryptedMessageCount/this._offlineMessagePreviewCounter),100)}isResumeOnSocketDisconnectInProgress(){return this._status===G.RESUME_WITH_OPEN_TAB}isResumeFromRestartComplete(){return this._status!==G.RESUME_ON_RESTART&&this._status!==G.INIT}getHasMessagesToDownload(){return this._hasMessagesToDownload}getFinishedDownloading(){return 100===this.getOfflineDeliveryProgress()}setOfflineSessionComplete(e){var t=this;return(0,i.default)((function*(){var n;return setTimeout((()=>{r(69951).ChatCollection.enableSortListener(!0)}),3e3),null===(n=t._offlineCompleteTimer)||void 0===n||n.cancel(),t._offlineCompleteTimer=null,t._status===G.COMPLETE?Promise.resolve():t._status===G.RESUME_WITH_OPEN_TAB?(yield(0,u.waitForOnlineMsgThread)(),yield(0,m.doPendingDeviceSync)(),t.setStatus(G.COMPLETE),Promise.resolve()):(t._hasMessagesToDownload=e>0,t._finishedDownloading=0===e,t.setStatus(G.COMPLETE),t._offlineStanzaCountAfterOfflineMarker=0,setTimeout((()=>{t._offlineStanzaCountAfterOfflineMarker>100&&(__LOG__(3)`[offline-resume][handler] ${t._offlineStanzaCountAfterOfflineMarker} received after offline completion marker. Refreshing window due to potential server issue.`,B())}),2e4),l.Cmd.handleOfflineProgressUpdate(),t._onOfflineComplete())}))()}shouldUseOfflineResumeScreen(){return this._offlineMessagePreviewCounter>this._decryptedMessageCount}decryptOfflineMessage(e){var t=this;return(0,i.default)((function*(){const r=yield(0,c.decryptE2EPayload)(e);return t._decryptedMessageCount=t._decryptedMessageCount+1,r.result===h.E2EProcessResult.RETRY&&(t._decryptionErrorCount=t._decryptionErrorCount+1),(0,v.isAdaptiveOfflineEnabled)()&&(t._pendingMessageCount-=1,t.maybeRequestMoreStanza()),r}))()}offlineStanzaReceivedAfterCompelete(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker=this._offlineStanzaCountAfterOfflineMarker+1)}addOfflinePendingMessage(){(0,v.isAdaptiveOfflineEnabled)()&&!this.isResumeFromRestartComplete()&&(this._pendingMessageCount+=1)}maybeRequestMoreStanza(){this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._pendingMessageCount<=200&&((0,T.sendBatchRequestIb)(200),this._isPendingPrevBatch=!0,__LOG__(2)`[offline-resume][adaptive] maybeRequestMoreStanza: request next batch, pending message ${this._pendingMessageCount}`)}newOfflineStanza(e,t){(0,v.isAdaptiveOfflineEnabled)()&&(this._isPendingPrevBatch=!1,null==this._endBatchCheck&&(this._endBatchCheck=setTimeout((()=>{this.maybeRequestMoreStanza(),this._endBatchCheck=null,__LOG__(2)`[offline-resume][adaptive] _endBatchCheck: done`}),0))),this.refreshOfflineCompleteTimer(),O.OfflineResumeReporter.logAddOfflineSizeBytes(t),O.OfflineResumeReporter.logOldestStanzaTime(e)}refreshOfflineCompleteTimer(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(6e4)}_startOfflineCompleteTimer(e,t){var r;null===(r=this._offlineCompleteTimer)||void 0===r||r.cancel(),this._offlineCompleteTimer=new E.ShiftTimer((()=>{this._status!==G.COMPLETE&&(__LOG__(2)`[offline-resume][handler]: offline session completed by timeout`,this.setOfflineSessionComplete(e+t),this._offlineCompleteTimer=null,O.OfflineResumeReporter.logMissedOfflineComplete())})),this._offlineCompleteTimer.onOrAfter(6e4)}_onOfflineComplete(){var e=this;return(0,i.default)((function*(){yield(0,u.waitForOfflineMsgThread)(),e._finishedDownloading=!0,l.Cmd.handleOfflineProgressUpdate(),O.OfflineResumeReporter.logOfflineDecryptionErrorCount(e._decryptionErrorCount),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ${e._decryptionErrorCount}`,e._decryptionErrorCount=0,yield function(){return x.apply(this,arguments)}(),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: clearOfflineSnapShot done.`,(0,f.enablePersistSignalStore)(),(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e,t,r){const n=(0,a.delayMs)(P.expBackoff(r,12e4,1e3,.1));try{return yield(0,s.clearDanglingReceipts)(),__LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: done.`,e()}catch(t){return __LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: failed with error ${t}.`,r>3?(__LOG__(3)`[offline-resume][handler] runReceiptCleanUpLoop: Gave up clean up receipts ${r} tries`,e()):n}}));return function(){return e.apply(this,arguments)}}());try{const e=yield(0,I.pruneExpiredMessages)(),t=e.length;if((0,C.receiveReactionsEnabled)()&&t>0){const t=r(68819).getJobManager,n=[],i=new Set;e.forEach((e=>{const t=e.id.toString();i.add(b.default.fromString(t).remote.toString()),n.push(t)}));const a=Array.from(i.values()).join(",").toString();yield t().waitUntilPersisted(A.jobSerializers.deleteReactions(a,n))}__LOG__(2)`[offline-resume][handler] setOfflineSessionComplete: pruneExpiredMessages pruned ${t} msg(s)`}catch(e){throw __LOG__(4,void 0,new Error)`[offline-resume][handler] _onOfflineComplete: pruneExpiredMessages message failed with error: ${e}`,e}O.OfflineResumeReporter.logLastStanzaT();try{__LOG__(2)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages.`,yield Promise.all([(0,d.restoreChatsAndMessages)(),(0,d.restoreGroupsContactsAndProfilePics)()])}catch(e){__LOG__(4,!0,new Error,!0)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages failed with error ${e}.`,SEND_LOGS("offline-resume-fatal-error"),g.Socket.logout(!1,S.LogoutReason.ClientFatalError)}l.Cmd.readyForMainStreamMode(),O.OfflineResumeReporter.logMainScreenLoadT(),O.OfflineResumeReporter.commit(),(0,w.processAllOrphanPaymentNotifications)(),(0,R.uploadChatThreadLoggingEvents)(),setTimeout((()=>{(0,m.doPendingDeviceSync)()}),2e3)}))()}_exceedResumeWithOpenTabLimit(e,t){return e+t>k||e>N&&e+t>L}}t.OfflineMessageHandlerImpl=U;const F=new U;function x(){return(x=(0,i.default)((function*(){p.default.createSnapshot(),_.default.createSnapshot(),y.default.createSnapshot(),yield Promise.all([p.default.checkpointQueue.wait(),_.default.checkpointQueue.wait(),y.default.checkpointQueue.wait()])}))).apply(this,arguments)}function B(){var e;(null===(e=window.location)||void 0===e?void 0:e.reload)&&window.location.reload()}t.OfflineMessageHandler=F},29783:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(27870),o=r(57319),s=r(92844),l=r(15461),c=r(67811),d=r(58464),u=r(88102),p=r(24747),f=r(93771),_=r(57701),h=n(r(54624)),g=r(76332),m=r(74727),y=r(11849),E=r(77246),S=r(71251);var v=new class{constructor(){this.cache=[],this.checkpointQueue=new a.PromiseQueue,this.lastCheckpointIndex=0,this.snapshotTimer=new o.ShiftTimer((()=>{this.createSnapshot()}))}addOfflineMessage(e){this.cache.push(...e),(0,d.isAdaptiveOfflineEnabled)()&&this.cache.length-this.lastCheckpointIndex>=200?this.createSnapshot():this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][msg-cache]: snapshot schedule in ${1e3} ms`,this.snapshotTimer.onOrAfter(1e3))}_addToMessageTable(e,t){var r=this;return(0,i.default)((function*(){const n=[],i=[];for(let a=e;a<t;a++){const e=r.cache[a].msg;null!=e&&((0,_.receiveReactionsEnabled)()&&e.type===l.MSG_TYPE.REACTION?i.push(r.cache[a]):n.push(e))}if(yield(0,S.storeOfflineMsgs)(n),i.length>0){const e=yield(0,c.createReactionsRowFromOffline)(i),t=yield(0,g.addOrUpdateReactionsDBBulk)(e);(0,g.updateHasReactionFromParent)(t)}}))()}_sendAggregateReceipts(e,t){var r=this;return(0,i.default)((function*(){const n=new Map,i=[];for(let a=e;a<t;a++){const e=r.cache[a].msg,t=r.cache[a].receiptInfo;if(!t)continue;const o=t.externalId||(null==e?void 0:e.id.id);if(!o)continue;const{from:s,author:l}=t;let c=n.get(s);c||(c=new Map,n.set(s,c));let d=c.get(l);d||(d=[],c.set(l,d)),d.push(o),i.push({from:String(s),author:String(l),externalId:o})}const a=String((0,s.unixTime)());Promise.all(Array.from(n.keys()).map((e=>{const t=n.get(e);if(t)return(0,m.sendAggregateReceipts)(e,m.RECEIPT_TYPE.DELIVERY,a,t)}))),(0,p.cancelDeadSocketTimer)(),yield(0,f.getTable)().createOrReplace({receipts:i})}))()}createSnapshot(){var e=this;this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const t=this.lastCheckpointIndex,r=this.cache.length;if(this.lastCheckpointIndex=r,__LOG__(2)`[offline-resume][msg-cache]: creating snapshot for offline ${t} to ${r}`,t===r)return;const n=h.default.generateSnapshot();this.checkpointQueue.enqueue((0,i.default)((function*(){yield e._addToMessageTable(t,r),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: messages done for ${t} - ${r}`,yield(0,E.getStorage)().lock(["session-store","identity-store","prekey-store","senderkey-store"],(0,i.default)((function*(){yield Promise.all([y.waSignalStore.bulkPutSession(n.sessionUpdate),y.waSignalStore.bulkPutIdentityKeyWithRowId(n.identityUpdate),y.waSignalStore.bulkPutSenderKey(n.senderKeyUpdate),y.waSignalStore.bulkRemovePreKey(n.preKeyRemove),y.waSignalStore.bulkRemoveSession(n.sessionRemove),y.waSignalStore.bulkRemoveIdentity(n.identityRemove)])}))),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: signal done for ${t} - ${r}`,yield e._sendAggregateReceipts(t,r),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: sending receipt done for ${t} - ${r}`,u.Cmd.handleOfflineProgressUpdate()})))}};t.default=v},66545:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(52230),o=r(27870),s=r(57319),l=r(31914),c=r(35470),d=r(45454),u=r(24747),p=r(78956),f=r(99069),_=r(39410);const h=Object.freeze({[c.ACK.RECEIVED]:c.ACK_STRING.DELIVERY,[c.ACK.READ]:c.ACK_STRING.READ,[c.ACK.PLAYED]:c.ACK_STRING.PLAYED,[c.ACK.INACTIVE]:c.ACK_STRING.INACTIVE}),g=1e3;function m(e){return(0,p.getTable)().bulkCreate(e)}function y(e,t){if(null!=e&&null!=t)return Math.min(e,t);const r=null!=e?e:t;return null!=r?r:void 0}var E=new class{constructor(){this.peerReadCache=[],this.otherReceiptCache=new Map,this.receiptAckCache=[],this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new o.PromiseQueue}addOfflinePeerReceipt(e,t,r){this.peerReadCache.push({ts:e,msgKeys:t,ack:r}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceipt(e,t,r,n){var i;const o=(0,d.toUserWid)(r).toString(),s=null!==(i=r.device)&&void 0!==i?i:a.DEFAULT_DEVICE_ID;n.forEach((r=>{const n=h[e];if(!n)return void __LOG__(3)`[offline-resume][receipt-cache]: not supported ack type ${e}`;const i=`${r},${o}`,a=this.otherReceiptCache.get(i);a?(n!==h[c.ACK.INACTIVE]&&(a[n]=y(a[n],t)),a.deviceDelivered.add(s)):this.otherReceiptCache.set(i,{[n]:t,deviceDelivered:new Set([s])})})),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceiptAck(e,t,r,n){this.receiptAckCache.push({from:e,stanzaId:t,ackString:r,participant:n}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.otherReceiptCache),t=this.peerReadCache,r=this.receiptAckCache;__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot for ${e.length} other, ${t.length} peer`,this.checkpointQueue.enqueue((0,i.default)((function*(){var n;yield Promise.all([(n=e,(0,f.getStorage)().lock(["message-info"],function(){var e=(0,i.default)((function*(e){let[t]=e;const r=yield t.bulkGet(n.map((e=>e[0].split(",")))),i=r.map(((e,t)=>{const[r,i]=n[t];if(!i)return null;if(!e){const[e,t]=r.split(",");return{delivery:i.delivery,read:i.read,played:i.played,msgKey:e,receiverUserJid:t,deviceDelivered:Array.from(i.deviceDelivered),deviceNotDelivered:[]}}const a=i.deviceDelivered;return e.deviceDelivered.forEach((e=>a.add(e))),{delivery:y(e.delivery,i.delivery),read:y(e.read,i.read),played:y(e.played,i.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(a),deviceNotDelivered:e.deviceNotDelivered.filter((e=>!a.has(e)))}}));return t.bulkCreateOrReplace(i)}));return function(){return e.apply(this,arguments)}}())),m(t)]),function(e){e.forEach((e=>{let{from:t,stanzaId:r,ackString:n,participant:i}=e;const a=(0,l.wap)("ack",{to:(0,_.JID)(t),id:(0,l.CUSTOM_STRING)(r),class:"receipt",type:(0,l.MAYBE_CUSTOM_STRING)(n),participant:i&&i!==t?(0,_.DEVICE_JID)(i):l.DROP_ATTR});(0,u.castStanza)(a),(0,u.cancelDeadSocketTimer)()})),__LOG__(2)`[offline-resume][receipt-cache] finish sending ${e.length} acks`}(r),__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot done`}))),this.otherReceiptCache=new Map,this.peerReadCache=[],this.receiptAckCache=[]}};t.default=E},45607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendBatchRequestIb=function(e){if(!(0,i.isAdaptiveOfflineEnabled)())return;const t=(0,n.wap)("ib",null,(0,n.wap)("offline_batch",{count:(0,n.CUSTOM_STRING)(String(e))}));(0,a.castStanza)(t)};var n=r(31914),i=r(58464),a=r(24747)},71251:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeOfflineMsgs=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(15461),s=r(68638),l=r(7293),c=r(57701),d=r(91525),u=r(10435),p=r(90981),f=r(63728),_=r(17304),h=r(54676),g=r(12600),m=r(49831),y=r(6684),E=r(90641),S=r(76332),v=r(99069),T=r(12896);function C(){return(C=(0,i.default)((function*(e){if(l.GK.supportsFeature(l.GK.F.MD_BACKEND))try{const{newMsgs:t,replaceMsgs:r,revokeMsgs:n,paymentMessages:a,chatsWithNewOfflineMsg:o}=yield M(e);__LOG__(2)`[offline-resume][msg-cache] storeOfflineMsgs: newMsgs: ${t.length}, replaceMsgs: ${r.length}, revokeMsgs: ${n.length}, paymentMessages: ${a.length}`;const s=yield(0,m.applyOrphanRevoke)(t),[l,u]=yield Promise.all([A(s),(0,E.encryptMultipleMsgs)(s,!1)]);yield(0,p.getTable)().bulkCreateOrReplace(r),yield(0,v.getStorage)().lock(["chat","message","fts-indexing-queue"],function(){var e=(0,i.default)((function*(e){let[t,r,n]=e;yield t.bulkCreateOrMerge(l),yield(0,E.storeEncryptedMessage)(u,o,!1)}));return function(){return e.apply(this,arguments)}}()),yield P(n),yield(0,E.processPaymentMessages)(a),yield(0,d.handleOfflineForMessageRange)(e);const _=e.map((e=>e.id.toString()));yield(0,g.checkOrphanMutations)(_,o),(0,c.receiveReactionsEnabled)()&&(yield(0,S.checkUpdateForOrphanReactions)(_)),t.forEach((e=>{I(e)&&(0,f.addPlaceHolderAction)(e)}))}catch(e){__LOG__(4,void 0,new Error,!0)`[offline-resume] Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("storeOfflineMsgs-error")}}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{const r=e.id,n=r.remote.toString();if(n!==a.STATUS_JID&&(0,T.isUnreadTypeMsg)(e)){const i=t.get(n)||{unread:0,t:0,unreadMentionsOfMe:[]};if(!r.fromMe&&(i.unread+=1,(0,u.isGroupCatchUpEnabled)()&&(0,h.isImportantMessage)(e))){const t={id:e.id.toString(),timestamp:e.t};i.unreadMentionsOfMe?i.unreadMentionsOfMe.push(t):i.unreadMentionsOfMe=[t]}e.t>i.t&&(i.t=Math.max(e.t,i.t)),t.set(n,i)}}));const r=Array.from(t.keys()),n=(yield(0,s.getTable)().bulkGet(r)).map(((e,n)=>{var i;const a=r[n],o=t.get(a),s=(null==o?void 0:o.unread)||0,l=Math.max(0,e?e.unreadCount:0);let c=(null==o?void 0:o.t)||void 0;e&&null!=e.t&&(null==c||e.t>c)&&(c=e.t);let d=[],p=null!==(i=null==e?void 0:e.archiveAtMentionViewedInDrawer)&&void 0!==i&&i;if((0,u.isGroupCatchUpEnabled)()){var f,_;const t=null!==(f=null==o?void 0:o.unreadMentionsOfMe)&&void 0!==f?f:[],r=null!==(_=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==_?_:[];t.length>0&&(p=!1),d=t.concat(r)}return{id:a,unreadCount:l+s,t:c,unreadMentionsOfMe:d,archiveAtMentionViewedInDrawer:p}}));return __LOG__(2)`[offline-resume][msg-cache]: storing chat updates: ${JSON.stringify(n)}`,n}))).apply(this,arguments)}function P(e){const t=[];return e.forEach((e=>{const r=new _.Msg(e);r.protocolMessageKey&&t.push({revokeMsgKey:r.protocolMessageKey,newMsgKey:r.id,timestamp:r.t,subtype:r.subtype,sender:r.sender})})),(0,E.processRevokeMsgs)(t).then(function(){var e=(0,i.default)((function*(e){if((0,c.receiveReactionsEnabled)()&&t.length>0){const e=[],n=new Set;t.forEach((t=>{e.push(t.revokeMsgKey.toString());const r=t.revokeMsgKey.remote.toString();n.add(r)}));const i=r(68819).getJobManager;yield i().waitUntilPersisted(y.jobSerializers.deleteReactions(Array.from(n.values()).join(","),e))}return e}));return function(){return e.apply(this,arguments)}}())}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=yield(0,p.getTable)().bulkGet(e.map((e=>String(e.id))),!1),r=[],n=[],i=[],a=[],s=new Set,l=new Map;return e.forEach(((e,c)=>{const d=String(e.id),u=t[c];if(u)if(I(u)){const t=(0,T.convertToMessageRowType)(e);t.t=u.t,t.internalId=u.internalId,t.rowId=u.rowId,n.push(t),(0,f.populatePlaceHolderAction)(u)}else r.push(e.id.id);else{const t=l.get(d);t&&!I(t)?r.push(e.id.id):["sender_revoke","admin_revoke"].includes(e.subtype)?i.push(e):e.type===o.MSG_TYPE.PAYMENT&&"send"===e.subtype||"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype?(a.push(e),l.set(d,e),s.add(String(e.id.remote))):(l.set(d,e),s.add(String(e.id.remote)))}})),r.length>0&&__LOG__(2)`[offline-resume] classifyOfflineMsgs: skip for ${r.length} duplicate messages, with id ${r}`,{newMsgs:Array.from(l.values()),chatsWithNewOfflineMsg:Array.from(s),replaceMsgs:n,revokeMsgs:i,paymentMessages:a}}))).apply(this,arguments)}function I(e){return e.type===o.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype||e.type===o.MSG_TYPE.CIPHERTEXT}},50404:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success;if(r&&r.refs&&Array.isArray(r.refs)&&6===r.refs.length){const{refs:e,id:t}=r;(0,l.castStanza)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"result",id:(0,a.CUSTOM_STRING)(t)})),(0,s.generateADVSecretKey)(),h=e,g||(g=new i.ShiftTimer((()=>{if(!(0,u.isRegistered)()&&p.default.online&&d.GK.supportsFeature(d.GK.F.MD_BACKEND))if(h&&h.length){const e=6===h.length?6e4:2e4,t=h.shift();c.Conn.set({ref:t,refTTL:e}),_.Socket.state=f.SOCKET_STATE.UNPAIRED,g&&g.onOrAfter(e)}else g&&g.cancel(),g=null,_.Socket.state=f.SOCKET_STATE.UNPAIRED_IDLE;else g&&g.cancel(),g=null}))),g.forceRunNow()}else __LOG__(3)`handlePairDevice: wrong pair device result received from server`};var i=r(57319),a=r(31914),o=r(71914),s=r(46308),l=r(24747),c=r(17239),d=r(7293),u=r(58052),p=n(r(57220)),f=r(62583),_=r(65044);let h=[],g=null;const m=new o.WapParser("pairDeviceParser",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.child("pair-device").forEachChild((e=>{e.assertTag("ref"),t.push(e.contentString())})),{refs:t,id:e.attrString("id")}}))},58645:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return D.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(11141),s=r(92844),l=r(31914),c=r(71914),d=r(81663),u=r(45454),p=r(84902),f=r(60980),_=n(r(41143)),h=r(61438),g=r(46308),m=r(24747),y=r(17186),E=r(17239),S=r(5087),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=I(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(91214)),T=r(99234),C=r(83578),A=n(r(11339)),b=r(58052),P=r(11849),M=r(93832),O=r(65044);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(I=function(e){return e?r:t})(e)}let w=!1;const R=new c.WapParser("pairSuccessParser",(e=>{var t;e.assertTag("iq"),e.assertFromServer();const r=e.attrString("id"),n=e.child("pair-success"),i=null===(t=n.maybeChild("platform"))||void 0===t?void 0:t.maybeAttrString("name"),a=n.child("device"),o=n.child("device-identity").contentBytes(),s=n.maybeChild("biz"),l=s?s.attrString("name"):"";return{wid:(0,d.deviceJidToDeviceWid)(a.attrPhoneDeviceJid("jid")),id:r,deviceIdentityBytes:o,businessName:l,platform:i}}));function D(){return(D=(0,i.default)((function*(e){if(w||(0,b.isRegistered)())return;(0,T.getShowMdUpgradeCompleteMsg)()&&((0,T.setShowMdUpgradeCompleteMsg)(!1),(0,T.setForcedMdUpgradeComplete)(!1)),w=!0;const t=(0,s.unixTime)(),r=R.parse(e);if(r.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,w=!1,Promise.reject(r.error);try{(0,y.resetCompanionReg)(),(0,T.setHistorySyncEarliestDate)(t);const e=r.success,{id:n,wid:i,deviceIdentityBytes:s,platform:c}=e;E.Conn.blockStoreAdds=!1,c&&(E.Conn.platform=c);const d=(0,p.decodeProtobuf)(h.ADVSignedDeviceIdentityHMACSpec,s),C=d.details,O=d.hmac;(0,_.default)(null!=C&&null!=O,"ADVSignedDeviceIdentityHMAC should not have empty details or hmac");const I=(0,g.getADVSecretKey)(),R=yield(0,o.hmacSha256)(I,C),D=(0,a.encodeB64)(R);if(D!==(0,a.encodeB64)(O))return(0,m.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),(0,y.logoutAfterValidationFail)(),void(w=!1);const N=(0,p.decodeProtobuf)(h.ADVSignedDeviceIdentitySpec,C),L=N.accountSignatureKey;(0,_.default)(null!=L,"accountSignatreKey should not be null");const k=N.accountSignature;(0,_.default)(null!=k,"accountSignature should not be null");const G=yield P.waSignalStore.getRegistrationInfo();(0,_.default)(null!=G,"Empty regInfo"),v.initDeviceLinkEvent(L,G.identityKeyPair.pubKey,t),v.setDeviceLinkPairStage(A.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);if(!(0,g.verifyDeviceIdentityAccountSignature)(N,G.identityKeyPair.pubKey))return(0,m.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"error",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("error",{code:"401",text:"not-authorized"}))),v.commitDeviceLinkEvent(401),(0,y.logoutAfterValidationFail)(),void(w=!1);N.deviceSignature=(0,g.generateDeviceSignature)(N,G.identityKeyPair,L),yield P.waSignalStore.putIdentity((0,M.createSignalAddress)((0,u.toUserWid)(i)).toString(),(0,M.bufferToStr)((0,S.toSignalCurvePubKey)(L))),yield(0,g.setADVSignedIdentity)(N);const U=(0,p.decodeProtobuf)(h.ADVDeviceIdentitySpec,N.details).keyIndex;(0,_.default)(null!=U,"keyIndex should not be null"),N.accountSignatureKey=void 0;const F=(0,f.encodeProtobuf)(h.ADVSignedDeviceIdentitySpec,N).readByteArray();(0,m.castStanza)((0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"result",id:(0,l.CUSTOM_STRING)(n)},(0,l.wap)("pair-device-sign",null,(0,l.wap)("device-identity",{"key-index":(0,l.INT)(U)},F)))),v.setDeviceLinkPairStage(A.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT),(0,T.setMdOptedIn)(!0),(0,T.setMe)(i),(0,b.getInitialHistorySyncComplete)()||(0,y.startInitialHistorySyncTimeout)(),w=!1}catch(e){__LOG__(4,!0,new Error,!0)`error in handlePairSuccess, ${e}`,SEND_LOGS("error in handlePairSuccess"),(0,v.commitDeviceLinkEvent)(-1),O.Socket.logout(!1,C.LogoutReason.UnknownCompanion)}}))).apply(this,arguments)}},2599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAmount1000AndCurrency=function(e){return function(e){if(e.hasChild("amount")){return function(e){e.assertTag("money");const t=parseFloat(e.attrString("value")),n=e.attrString("currency"),i=e.maybeAttrInt("offset");return{currency:n,amount1000:t*r/(null!=i&&0!==i?i:r)}}(e.child("amount").child("money"))}if(e.hasAttr("amount")){return{amount1000:parseFloat(e.attrString("amount"))*r,currency:e.attrString("currency")}}throw __LOG__(3)`Amount missing in pay or transaction node`,new Error("Amount missing in pay or transaction node")}(e)};const r=1e3},27258:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(55552).handlePaymentNotification;t.default=n},55552:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePaymentNotification=function(){return y.apply(this,arguments)},t.parseNotificationPaymentInfo=T,t.processAllOrphanPaymentNotifications=function(){return A.apply(this,arguments)},t.processOrphanPaymentNotifications=function(){return C.apply(this,arguments)},t.updateReceivedPaymentInfo=S;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=n(r(65212)),l=r(35588),c=r(84886),d=r(17304),u=r(59871),p=r(5819),f=r(45377),_=r(75295),h=r(39577),g=r(31019),m=r(52586);function y(){return(y=(0,a.default)((function*(e){if(e.content&&"invite"===e.content[0].tag)return E(e);const t=_.paymentNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const r=t.success,n=(0,o.default)(r.msgKey,"info.msgKey"),a=u.MsgCollection.get(n),s=a?(0,g.unproxy)(a):yield(0,l.getMsgByMsgKey)(n);if(!s){__LOG__(3)`handlePaymentNotification: no msg found for id ${n.toString()}`;const e=(0,i.default)((0,i.default)({},r),{},{msgKey:n.toString()});return(0,f.getTable)().createOrReplace(e)}return S(s,r)}))).apply(this,arguments)}function E(e){const t=_.paymentInviteNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const r=t.success;if("account-set-up"===r.type){const e=(0,h.genPaymentInviteAccoutSetupMsg)(r.from,r.timestamp);return(0,p.handleSingleMsgMD)(e.from,e)}return Promise.resolve()}function S(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){const r=[];T(e,t),r.push(e.id.toString());const n=[e instanceof d.Msg?e.toJSON():e];if(null!=e.paymentRequestMessageKey){const t=u.MsgCollection.get(e.paymentRequestMessageKey),r=t?(0,g.unproxy)(t):yield(0,l.getMsgByMsgKey)(e.paymentRequestMessageKey||"");r&&(r.paymentStatus=e.paymentStatus,r.paymentTxnStatus=(0,m.determinePaymentRequestFulfilledStatus)(e.paymentTxnStatus),n.push(r instanceof d.Msg?r.toJSON():r))}return(0,f.getTable)().bulkRemove(r).catch((()=>{__LOG__(4,void 0,new Error)`getOrphanPaymentNotificationTable bulkremove of ${r} failed. {e}`})),(0,c.updateExistingMessages)(n)}))).apply(this,arguments)}function T(e,t){t&&(null!=t.status&&(e.paymentStatus=(0,m.getPaymentWebStatus)(t.status,t.type),e.paymentTxnStatus=(0,m.getPaymentTxnWebStatus)(t.status)),e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,o.default)(t.amount1000,"mdPaymentInfo.amount1000"),e.paymentMessageReceiverJid=t.receiver,e.paymentTransactionTimestamp=(0,o.default)(t.ts,"mdPaymentInfo.ts"))}function C(){return(C=(0,a.default)((function*(e){const t=e.map((e=>e.id.toString())),r=yield(0,f.getTable)().bulkGet(t),n=new Map;e.forEach((e=>{n.set(e.id.toString(),e)})),r.forEach((e=>{if(e){const t=n.get(e.msgKey);if(!t)return;S(t,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:s.default.fromString(e.msgKey)})}}))}))).apply(this,arguments)}function A(){return(A=(0,a.default)((function*(){const e=yield(0,f.getTable)().all(),t=new Map,r=[];if(e.forEach((e=>{const n=u.MsgCollection.get(e.msgKey);n?S(n,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:s.default.fromString(e.msgKey)}):(t.set(e.msgKey,e),r.push(e.msgKey))})),r.length>0){const e=yield(0,l.getMsgsByMsgKey)(r);return e.forEach((e=>{const r=t.get(e.id.toString());r&&(e.paymentTxnStatus=(0,m.getPaymentTxnWebStatus)(r.status),e.paymentCurrency=r.currency||"",e.paymentAmount1000=(0,o.default)(r.amount1000,"notification.amount1000"),e.paymentMessageReceiverJid=r.receiver,e.paymentTransactionTimestamp=(0,o.default)(r.ts,"notification.ts"))})),(0,c.updateExistingMessages)(e)}}))).apply(this,arguments)}},75295:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isNoviTransaction=d,t.parseTransactionNode=f,t.paymentNotificationParser=t.paymentInviteNotificationParser=void 0;var i=r(71914),a=r(81663),o=n(r(65212)),s=r(2599),l=r(99234),c=r(52586);function d(e){return!(!e||!e.hasAttr("service")||"NOVI"!==e.attrString("service").toUpperCase())}const u=new i.WapParser("paymentNotificationParser",(e=>{if(e.hasChild("transaction")){return f(e.child("transaction"))}return __LOG__(2)`No transaction node in the payment notification`,null}));t.paymentNotificationParser=u;const p=new i.WapParser("paymentInviteNotificationParser",(e=>{if(e.hasChild("invite")){const t=e.child("invite");return{type:t.maybeAttrString("type"),service:t.maybeAttrString("service"),inviteUsed:t.hasAttr("invite-used")?"1"===t.attrString("invite-used"):null,from:(0,a.chatJidToChatWid)(e.attrChatJid("from")),timestamp:e.attrTime("t")}}return __LOG__(2)`No invite node in the payment invite notification`,null}));function f(e){if(d(e))return __LOG__(2)`Payment notification from Novi not supported`,null;let t,r;const n=(0,l.getMeUser)(),i=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender")),u=(0,a.jidWithTypeToWid)(e.attrJidWithType("receiver")),p=n.equals(i);e.hasAttr("group")?(t=(0,a.jidWithTypeToWid)(e.attrJidWithType("group")),r=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender"))):t=p?u:i;const f=new o.default({id:e.attrString("message-id"),fromMe:p,remote:t,participant:r}),_=(0,c.getPaymentTransactionType)(e.attrString("transaction-type"),f.fromMe),{amount1000:h,currency:g}=(0,s.getAmount1000AndCurrency)(e);return{receiver:u,currency:g,amount1000:h,status:(0,c.getNotificationTransactionStatus)(_,e.attrString("status")),ts:e.attrInt("ts"),type:_,msgKey:f}}t.paymentInviteNotificationParser=p},52586:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentTransactionTypeServerString=t.PaymentTransactionType=t.PaymentTransactionStatusServerString=t.NotificationTransactionStatus=void 0,t.determinePaymentRequestFulfilledStatus=function(e){if(function(e){return e===n.PaymentInfoTxnStatus.COMPLETED||e===n.PaymentInfoTxnStatus.SUCCESS}(e))return e;return n.PaymentInfoTxnStatus.COLLECT_INIT},t.getNotificationTransactionStatus=function(e,t){if(!t)return a.STATUS_UNSET;const r=t.toUpperCase();switch(e){case i.TYPE_P2P_SENT:case i.TYPE_P2M_SENT:case i.TYPE_DEPOSIT:switch(r){case s.PENDING_RECEIVER_SETUP:return a.SEND_PAY_PENDING_RECEIVER;case s.FAILED_DA:return a.SEND_PAY_PENDING;case s.REFUND_FAILED_DA:return a.SEND_PAY_REFUND_PENDING;case s.FAILED_RISK:return a.SEND_PAY_FAILURE_RISK;case s.INITIAL:return a.SEND_PAY_INIT;case s.SUCCESS:case s.COMPLETED:return a.SEND_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.SEND_PAY_FAILURE;case s.REFUNDED:return a.SEND_PAY_REFUNDED;case s.REFUND_FAILED:return a.SEND_PAY_REFUND_FAILED;case s.FAILED_RECEIVER_PROCESSING:return a.SEND_PAY_FAILURE_RECEIVER;case s.REFUND_FAILED_PROCESSING:return a.SEND_PAY_REFUND_FAILED_PROCESSING;case s.FAILED_DA_FINAL:return a.SEND_PAY_PENDING_REFUND;case s.AUTH_CANCEL_FAILED_PROCESSING:return a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING;case s.AUTH_CANCEL_FAILED:return a.SEND_PAY_AUTH_CANCEL_FAILED;case s.AUTH_CANCELED:return a.SEND_PAY_AUTH_CANCELED;case s.EXPIRED:return a.SEND_PAY_EXPIRED;case s.IN_REVIEW:return a.SEND_PAY_IN_REVIEW;case s.PENDING:return a.SEND_PAY_PENDING_PROCESSING;case s.CANCELED:return a.SEND_PAY_USER_CANCELED}break;case i.TYPE_P2P_RCVD:case i.TYPE_P2M_RCVD:switch(r){case s.PENDING_SETUP:return a.RECV_PAY_PENDING_SETUP;case s.FAILED_DA:return a.RECV_PAY_PENDING;case s.FAILED_PROCESSING:return a.RECV_PAY_RETRY_ON_FAILURE;case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.RECV_PAY_FAILURE;case s.EXPIRED:return a.RECV_PAY_EXPIRED;case s.FAILED_RISK:return a.RECV_PAY_FAILURE_RISK;case s.WITHDRAWAL_PROCESSING:return a.RECV_PAY_WITHDRAWAL_PROCESSING;case s.WITHDRAWAL_FAILURE:return a.RECV_PAY_WITHDRAWAL_FAILURE;case s.WITHDRAWAL_PERMANENT_FAILED:return a.RECV_PAY_WITHDRAWAL_PERMANENT_FAILED;case s.CANCELED:return a.RECV_PAY_SENDER_CANCELED}break;case i.TYPE_P2P_REQ_SENT:case i.TYPE_P2P_REQ_RCVD:switch(r){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SUCCESS;case s.COLLECT_FAILED:return a.REQUEST_PAY_FAILED;case s.COLLECT_FAILED_RISK:return a.REQUEST_PAY_FAILED_RISK;case s.COLLECT_REJECTED:return a.REQUEST_PAY_REJECTED;case s.COLLECT_EXPIRED:return a.REQUEST_PAY_EXPIRED;case s.COLLECT_CANCELED:return a.REQUEST_PAY_CANCELLED}break;case i.TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:switch(r){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS;case s.AUTH_SUCCESS:return a.SEND_PAY_AUTH_SUCCESS}break;case i.TYPE_REFUND:switch(r){case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS}break;case i.TYPE_WITHDRAWAL:switch(r){case s.PENDING:return a.WITHDRAWAL_PENDING;case s.IN_REVIEW:return a.WITHDRAWAL_IN_REVIEW;case s.SUCCESS:case s.COMPLETED:return a.WITHDRAWAL_SUCCESS;case s.FAILED:case s.DECLINED:return a.WITHDRAWAL_FAILED;case s.CANCELED:return a.WITHDRAWAL_USER_CANCELED;case s.EXPIRED:return a.WITHDRAWAL_EXPIRED;case s.WITHDRAWAL_ACTIVE:return a.WITHDRAWAL_ACTIVE}break;default:return a.STATUS_UNSET}return a.STATUS_UNSET},t.getPaymentTransactionType=function(e,t){if(e){const r=e.toLowerCase();switch(r){case o.TYPE_P2P:return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD;case o.TYPE_P2M:return t?i.TYPE_P2M_SENT:i.TYPE_P2M_RCVD;case o.TYPE_P2M_PAYOUT:return i.TYPE_P2M_PAYOUT;case o.TYPE_DEPOSIT:return i.TYPE_DEPOSIT;case o.TYPE_REFUND:return i.TYPE_REFUND;case o.TYPE_WITHDRAWAL:return i.TYPE_WITHDRAWAL;default:__LOG__(2)`parsePaymentTransactionType payment transaction string=${r}`}}return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD},t.getPaymentTxnWebStatus=function(e){if(null==e)return n.PaymentInfoTxnStatus.UNKNOWN;switch(e){case a.RECV_PAY_EXPIRED:case a.SEND_PAY_EXPIRED:return n.PaymentInfoTxnStatus.EXPIRED_TXN;case a.RECV_PAY_FAILURE:case a.SEND_PAY_FAILURE:return n.PaymentInfoTxnStatus.FAILED;case a.RECV_PAY_INIT:case a.SEND_PAY_INIT:return n.PaymentInfoTxnStatus.INIT;case a.RECV_PAY_PENDING_SETUP:return n.PaymentInfoTxnStatus.PENDING_SETUP;case a.RECV_PAY_PENDING:case a.SEND_PAY_PENDING:return n.PaymentInfoTxnStatus.FAILED_DA;case a.RECV_PAY_RETRY_ON_FAILURE:return n.PaymentInfoTxnStatus.FAILED_PROCESSING;case a.RECV_PAY_SUCCESS:case a.SEND_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return n.PaymentInfoTxnStatus.SUCCESS;case a.REQUEST_PAY_CANCELLED:return n.PaymentInfoTxnStatus.COLLECT_CANCELED;case a.REQUEST_PAY_CANCELLING:return n.PaymentInfoTxnStatus.COLLECT_CANCELLING;case a.REQUEST_PAY_EXPIRED:return n.PaymentInfoTxnStatus.COLLECT_EXPIRED;case a.REQUEST_PAY_FAILED_RISK:return n.PaymentInfoTxnStatus.COLLECT_FAILED_RISK;case a.REQUEST_PAY_FAILED:return n.PaymentInfoTxnStatus.COLLECT_FAILED;case a.REQUEST_PAY_INIT:return n.PaymentInfoTxnStatus.COLLECT_INIT;case a.REQUEST_PAY_REJECTED:return n.PaymentInfoTxnStatus.COLLECT_REJECTED;case a.REQUEST_PAY_SUCCESS:return n.PaymentInfoTxnStatus.COLLECT_SUCCESS;case a.SEND_PAY_AUTH_CANCELED:return n.PaymentInfoTxnStatus.AUTH_CANCELED;case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return n.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED_PROCESSING;case a.SEND_PAY_AUTH_CANCEL_FAILED:return n.PaymentInfoTxnStatus.AUTH_CANCEL_FAILED;case a.SEND_PAY_FAILURE_RECEIVER:return n.PaymentInfoTxnStatus.FAILED_RECEIVER_PROCESSING;case a.SEND_PAY_FAILURE_RISK:case a.RECV_PAY_FAILURE_RISK:return n.PaymentInfoTxnStatus.FAILED_RISK;case a.SEND_PAY_PENDING_RECEIVER:return n.PaymentInfoTxnStatus.PENDING_RECEIVER_SETUP;case a.SEND_PAY_PENDING_REFUND:return n.PaymentInfoTxnStatus.FAILED_DA_FINAL;case a.SEND_PAY_REFUNDED:return n.PaymentInfoTxnStatus.REFUNDED_TXN;case a.SEND_PAY_REFUND_FAILED_PROCESSING:return n.PaymentInfoTxnStatus.REFUND_FAILED_PROCESSING;case a.SEND_PAY_REFUND_FAILED:return n.PaymentInfoTxnStatus.REFUND_FAILED;case a.SEND_PAY_REFUND_PENDING:return n.PaymentInfoTxnStatus.REFUND_FAILED_DA;case a.SEND_PAY_IN_REVIEW:return n.PaymentInfoTxnStatus.IN_REVIEW;case a.STATUS_UNSET:default:return n.PaymentInfoTxnStatus.UNKNOWN}},t.getPaymentWebStatus=function(e,t){if(null==e)return n.PaymentInfoStatus.UNKNOWN_STATUS;switch(e){case a.SEND_PAY_INIT:case a.SEND_PAY_PENDING:case a.RECV_PAY_INIT:case a.RECV_PAY_PENDING:case a.RECV_PAY_RETRY_ON_FAILURE:case a.REQUEST_PAY_INIT:return n.PaymentInfoStatus.PROCESSING;case a.SEND_PAY_PENDING_RECEIVER:case a.SEND_PAY_FAILURE_RECEIVER:return n.PaymentInfoStatus.SENT;case a.REQUEST_PAY_SUCCESS:return t===i.TYPE_P2P_REQ_SENT?n.PaymentInfoStatus.WAITING_FOR_PAYER:n.PaymentInfoStatus.WAITING;case a.RECV_PAY_PENDING_SETUP:return n.PaymentInfoStatus.NEED_TO_ACCEPT;case a.SEND_PAY_SUCCESS:case a.RECV_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return n.PaymentInfoStatus.COMPLETE;case a.SEND_PAY_FAILURE:case a.SEND_PAY_FAILURE_RISK:case a.SEND_PAY_PENDING_REFUND:case a.SEND_PAY_REFUND_PENDING:case a.SEND_PAY_REFUND_FAILED:case a.SEND_PAY_REFUND_FAILED_PROCESSING:case a.RECV_PAY_FAILURE:case a.REQUEST_PAY_FAILED:case a.REQUEST_PAY_FAILED_RISK:return n.PaymentInfoStatus.COULD_NOT_COMPLETE;case a.SEND_PAY_REFUNDED:return n.PaymentInfoStatus.REFUNDED;case a.RECV_PAY_EXPIRED:case a.REQUEST_PAY_EXPIRED:case a.SEND_PAY_AUTH_CANCELED:case a.SEND_PAY_AUTH_CANCEL_FAILED:case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return n.PaymentInfoStatus.EXPIRED;case a.REQUEST_PAY_REJECTED:return n.PaymentInfoStatus.REJECTED;case a.REQUEST_PAY_CANCELLED:return n.PaymentInfoStatus.CANCELLED;case a.STATUS_UNSET:case a.REQUEST_PAY_CANCELLING:default:return n.PaymentInfoStatus.UNKNOWN_STATUS}};var n=r(21224);const i=r(76672)({TYPE_UNSET:0,TYPE_P2P_SENT:1,TYPE_P2P_RCVD:2,TYPE_P2P_GRP:3,TYPE_P2P_NO_INFO:4,TYPE_FUTURE:5,TYPE_P2P_REQ_SENT:10,TYPE_P2P_REQ_RCVD:20,TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:21,TYPE_P2P_REQ_GRP:30,TYPE_P2M_SENT:100,TYPE_P2M_RCVD:200,TYPE_P2M_PAYOUT:300,TYPE_MISSING_DETAILS:400,TYPE_DEPOSIT:500,TYPE_REFUND:600,TYPE_WITHDRAWAL:700});t.PaymentTransactionType=i;const a=r(76672)({STATUS_UNSET:0,REQUEST_PAY_INIT:11,REQUEST_PAY_SUCCESS:12,REQUEST_PAY_FAILED:13,REQUEST_PAY_FAILED_RISK:14,REQUEST_PAY_REJECTED:15,REQUEST_PAY_EXPIRED:16,REQUEST_PAY_FULFILLED:17,REQUEST_PAY_CANCELLED:18,REQUEST_PAY_CANCELLING:19,REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS:20,RECV_PAY_INIT:101,RECV_PAY_PENDING_SETUP:102,RECV_PAY_PENDING:103,RECV_PAY_RETRY_ON_FAILURE:104,RECV_PAY_FAILURE:105,RECV_PAY_SUCCESS:106,RECV_PAY_EXPIRED:107,RECV_PAY_FAILURE_RISK:108,RECV_PAY_WITHDRAWAL_PROCESSING:109,RECV_PAY_WITHDRAWAL_FAILURE:110,RECV_PAY_WITHDRAWAL_PERMANENT_FAILED:111,RECV_PAY_SENDER_CANCELED:112,SEND_PAY_INIT:401,SEND_PAY_PENDING_RECEIVER:402,SEND_PAY_PENDING:403,SEND_PAY_REFUND_PENDING:404,SEND_PAY_SUCCESS:405,SEND_PAY_FAILURE:406,SEND_PAY_FAILURE_RISK:407,SEND_PAY_REFUNDED:408,SEND_PAY_REFUND_FAILED:409,SEND_PAY_FAILURE_RECEIVER:410,SEND_PAY_REFUND_FAILED_PROCESSING:411,SEND_PAY_PENDING_REFUND:412,SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:413,SEND_PAY_AUTH_CANCEL_FAILED:414,SEND_PAY_AUTH_CANCELED:415,SEND_PAY_EXPIRED:416,SEND_PAY_AUTH_SUCCESS:417,SEND_PAY_AUTH_SUCCESS_CANCELING:418,SEND_PAY_IN_REVIEW:419,SEND_PAY_PENDING_PROCESSING:420,SEND_PAY_USER_CANCELED:421,WITHDRAWAL_INIT:601,WITHDRAWAL_PENDING:602,WITHDRAWAL_IN_REVIEW:603,WITHDRAWAL_SUCCESS:604,WITHDRAWAL_FAILED:605,WITHDRAWAL_USER_CANCELED:606,WITHDRAWAL_EXPIRED:607,WITHDRAWAL_ACTIVE:608});t.NotificationTransactionStatus=a;const o={TYPE_P2P:"p2p",TYPE_P2M:"p2m",TYPE_P2M_PAYOUT:"payout",TYPE_WITHDRAWAL:"withdrawal",TYPE_DEPOSIT:"deposit",TYPE_REFUND:"refund"};t.PaymentTransactionTypeServerString=o;const s={PENDING_RECEIVER_SETUP:"PENDING_RECEIVER_SETUP",PENDING_SETUP:"PENDING_SETUP",PENDING:"PENDING",INITIAL:"INITIAL",SUCCESS:"SUCCESS",COMPLETED:"COMPLETED",IN_REVIEW:"IN_REVIEW",FAILED:"FAILED",DECLINED:"DECLINED",FAILURE:"FAILURE",FAILED_RISK:"FAILED_RISK",FAILED_PROCESSING:"FAILED_PROCESSING",FAILED_RECEIVER_PROCESSING:"FAILED_RECEIVER_PROCESSING",REFUND_FAILED_PROCESSING:"REFUND_FAILED_PROCESSING",REFUNDED:"REFUNDED",REFUND_FAILED:"REFUND_FAILED",EXPIRED:"EXPIRED",CANCELED:"CANCELLED",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_CANCELED:"AUTH_CANCELED",AUTH_CANCEL_FAILED_PROCESSING:"AUTH_CANCEL_FAILED_PROCESSING",AUTH_CANCEL_FAILED:"AUTH_CANCEL_FAILED",COLLECT_SUCCESS:"COLLECT_SUCCESS",COLLECT_FAILED:"COLLECT_FAILED",COLLECT_REJECTED:"COLLECT_REJECTED",COLLECT_EXPIRED:"COLLECT_EXPIRED",COLLECT_CANCELED:"COLLECT_CANCELED",FAILED_DA:"FAILED_DA",FAILED_DA_FINAL:"FAILED_DA_FINAL",REFUND_FAILED_DA:"REFUND_FAILED_DA",COLLECT_FAILED_RISK:"COLLECT_FAILED_RISK",WITHDRAWAL_PROCESSING:"WITHDRAWAL_PROCESSING",WITHDRAWAL_FAILURE:"WITHDRAWAL_FAILURE",WITHDRAWAL_PERMANENT_FAILED:"WITHDRAWAL_PERMANENT_FAILED",WITHDRAWAL_ACTIVE:"WITHDRAWAL_ACTIVE"};t.PaymentTransactionStatusServerString=s},65347:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(88102),l=r(11849),c=r(46669);const d=new Set,u=new Promise((e=>{s.Cmd.isMainStreamReadyMd&&e(),s.Cmd.on("main_stream_mode_ready",(()=>{e()}))})),p=new o.WapParser("lowKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),{stanzaId:e.attrString("id"),numRemaining:e.child("count").attrInt("value")})));function f(){return(f=(0,i.default)((function*(e,t){const r=p.parse(e);if(r.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${r.error.toString()}`,new Error(r.error);{const e=r.success,n=(0,a.wap)("ack",{to:a.S_WHATSAPP_NET,id:(0,a.CUSTOM_STRING)(e.stanzaId),class:"notification"});return d.has(t)?n:(d.add(t),l.waSignalStore.setServerHasPreKeys(!1),yield u,(0,c.uploadPreKeys)().then((()=>n)).finally((()=>{d.delete(t)})))}}))).apply(this,arguments)}},46007:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,o.default)(t.success)};var i=r(71914),a=r(81663),o=n(r(54248));const s=new i.WapParser("incomingPresenceParser",(e=>{e.assertTag("presence");const t=e.attrEnumOrDefault("type",{available:"available",unavailable:"unavailable",unsubscribe:"unsubscribe"},"available"),r="deny"===e.maybeAttrString("last")||void 0;let n;return"unavailable"===t&&(e.hasAttr("last")?["deny","none","error"].includes(e.attrString("last"))||(n=e.attrTime("last")):n=Date.now()),{id:(0,a.chatJidToChatWid)(e.attrChatJid("from")),type:t,t:n,deny:r}}))},6571:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(86945),c=r(11365),d=r(68315),u=r(59201);const p=new o.WapParser("incomingPrivacyTokensParser",(e=>{e.assertTag("notification");return{id:e.attrString("id"),from:e.attrPhoneUserJid("from"),privacyTokens:e.child("tokens").mapChildrenWithTag("token",(e=>({type:e.attrString("type"),content:(0,c.uint8ArrayToBuffer)(e.contentBytes()),ts:e.attrTime("t")})))}}));function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const{type:r,content:n,ts:i}=t;if("trusted_contact"!==r)return;const a=(0,s.userJidToUserWid)(e.from);yield(0,u.setTcToken)(a,i,n),yield d.PresenceCollection.reSubscribeWhenActive(a)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:r}=t,n=(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(r.id),class:"notification",to:(0,a.JID)(r.from),type:"privacy_token"});return(0,l.getABPropConfigValue)("trusted_contacts")?(yield Promise.all(r.privacyTokens.map((e=>f(r,e)))),n):n}))).apply(this,arguments)}},2276:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success;let i=Promise.resolve();if(r.jid){const e=r.jid;switch(r.type){case"delete":case"set":const t="delete"===r.type?c.PROFILE_PIC_COMMAND.REMOVE:c.PROFILE_PIC_COMMAND.SET;i=(0,d.changeProfilePicThumb)(e,t).then((()=>{if(!e.isGroup())return;const n=(0,s.genGroupPicChangeNotificationMsg)(r.jid,t,r.ts,r.author||(0,o.getMeUser)());return(0,l.handleSingleMsgMD)(r.jid,n)}));break;case"request":break;default:__LOG__(3)`Invalid type received`}}return i.then((()=>(0,n.wap)("ack",{id:(0,n.CUSTOM_STRING)(r.stanzaId),to:(0,u.JID)(r.from),class:"notification",type:"picture"})))};var n=r(31914),i=r(71914),a=r(81663),o=r(99234),s=r(37654),l=r(5819),c=r(41601),d=r(37638),u=r(39410);const p=new i.WapParser("incomingProfilePicNotificationParser",(e=>{let t,r;if(e.assertTag("notification"),e.hasChild("delete"))t="delete",r=e.child("delete");else if(e.hasChild("set"))t="set",r=e.child("set");else{if(!e.hasChild("request"))return e.throw("Expected child type to be one of: set, delete, request");t="request",r=e.child("request"),r.assertAttr("jid",(0,o.assertGetMe)().toJid())}const n=e.attrString("id");return r.hasAttr("jid")?{type:t,from:(0,a.chatJidToChatWid)(e.attrChatJid("from")),jid:(0,a.chatJidToChatWid)(r.attrChatJid("jid")),author:r.hasAttr("author")?(0,a.userJidToUserWid)(r.attrPhoneUserJid("author")):null,ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:n,picId:"set"===t?r.attrInt("id",1):0}:{from:(0,a.userJidToUserWid)(e.attrPhoneUserJid("from")),jid:null,type:t,hash:r.attrString("hash"),stanzaId:n}}))},54341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(31914),s=r(71914),l=r(81663),c=r(45454),d=r(86945),u=r(11365),p=r(49714),f=r(45033),_=r(53348),h=n(r(40256)),g=r(39410);const m=r(76672)({Image:"image",Video:"video",Text:"text"}),y=new s.WapParser("incomingCampaignParser",(e=>{e.assertTag("notification"),e.assertAttr("from",a.STATUS_JID);const t=e.attrString("id"),r=(0,l.userJidToUserWid)(e.attrPhoneUserJid("participant")),n=e.attrTime("t"),i=e.child("campaign"),o=i.hasChild("revoke"),s=i.attrString("id"),c=i.maybeAttrInt("duration"),d=i.mapChildrenWithTag("message",(e=>{const t=e.child("media");t.attrEnumValues("mediatype",m.members());return{id:e.attrString("id"),ts:n,body:(0,u.uint8ArrayToBuffer)(t.contentBytes())}}));return{participant:r,stanzaId:t,campaignId:s,campaignDuration:c,revoke:o,ts:n,messages:d}}));function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const{participant:r,campaignId:n,campaignDuration:i}=e,{id:o,ts:s,body:l}=t,d={type:p.MESSAGE_TYPE.OTHER_STATUS,externalId:o,ts:s,edit:-1,isHsm:!1,count:null,chat:(0,c.createWid)(a.STATUS_JID),author:r,pushname:null,isDirect:!1,campaignId:n,campaignDuration:i},u={retryCount:0,e2eType:f.CiphertextType.Msg,mediaType:f.MediaType.Photo,hideFail:!1};yield(0,_.processDecryptedProto)(l,d,null,u,{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null},!1)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=y.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:r}=t,n=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(r.stanzaId),participant:(0,g.USER_JID)(r.participant),class:"notification",type:"psa",to:(0,g.JID)((0,c.createWid)(a.STATUS_JID))});return(0,d.getABPropConfigValue)("web_status_psa")?(r.revoke?yield(0,h.default)(r.campaignId):yield Promise.all(r.messages.map((e=>E(r,e)))),n):n}))).apply(this,arguments)}},79711:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_RETRY=void 0,t.handleMessageRetryRequest=function(e){const t=h.default.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(new Error(t.error));const r=t.success,{from:n,participant:a,recipient:s,retryCount:l,stanzaId:c}=r;if(null==c)return __LOG__(3)`Received null stanzaID when handling message retry request`,Promise.reject(new Error("Received null stanzaID when handling message retry request"));const d=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(c),to:(0,y.JID)(n),participant:a?(0,y.DEVICE_JID)(a):o.DROP_ATTR,class:"receipt",type:"retry"}),p=T(n,s);if(!p)return Promise.resolve(d);return(0,u.handleMessage)(String(p),!1,(0,i.default)((function*(){const e=yield S(r);if(null==e)return d;const{originalMsgId:t,chat:i,requester:o,identityRowId:c}=e;try{const e=yield(0,_.getMsgIfAuthorized)(t,i,o,l,c);if(!e)return __LOG__(3)`handleMessageRetryRequest msg retry not authorized`,d;yield(0,g.sendRetry)(n,a,s,e,l)}catch(e){__LOG__(3)`handleMessageRetryRequest error: ${e}`}return d})))},t.handleVoipRetryRequest=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(31914),s=r(45454),l=r(9108),c=r(99234),d=r(97398),u=r(15746),p=n(r(11339)),f=n(r(76128)),_=r(28870),h=n(r(87423)),g=r(95547),m=r(93832),y=r(39410);function E(){return(E=(0,i.default)((function*(e){return null!=(yield S(e))}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{originalMsgId:t,from:r,participant:n,recipient:i,retryCount:o,offline:s}=e;if(o>=5)return void __LOG__(2)`handleRetryRequest refusing retry attempt #${o}`;const c=T(r,i);if(!c)return void __LOG__(3)`handleRetryRequest: no chat found for incoming retry request.`;const u=c.isUser()?r:n;if(!u)return void __LOG__(3)`handleRetryRequest: no requester found for incoming retry request.`;const h=u.device||0;try{if(!(yield(0,l.hasDevice)(u,h)))return __LOG__(3)`handleRetryRequest: no device ${h} found for ${u.user} for incoming retry request .`,void new p.default.MdRetryFromUnknownDevice({offline:s,senderType:h===a.DEFAULT_DEVICE_ID?p.default.DEVICE_TYPE.PRIMARY:p.default.DEVICE_TYPE.COMPANION}).commit();yield(0,_.updateLocalSession)(c,e),yield(0,d.ensureE2ESessions)([u]);return{originalMsgId:t,chat:c,requester:u,identityRowId:yield f.default.getIdentityRowId((0,m.createSignalAddress)(u).toString())}}catch(e){__LOG__(3)`handleRetryRequest error: ${e}`}}))).apply(this,arguments)}function T(e,t){return e.isUser()?(0,s.toUserWid)(e).equals((0,c.getMeUser)())?t||(__LOG__(3)`getActualChatId: from is a peer device, but without recipient`,null):(0,s.toUserWid)(e):e}t.MAX_RETRY=5},28870:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgIfAuthorized=function(){return m.apply(this,arguments)},t.processKeyBundle=y,t.updateLocalSession=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=n(r(65212)),s=r(15461),l=r(45454),c=r(99234),d=r(90981),u=r(47124),p=n(r(11339)),f=r(17304),_=r(43201),h=r(77605),g=r(12896);function m(){return(m=(0,a.default)((function*(e,t,r,n,i){const a=new o.default({id:e,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,c.getMeUser)()}),l=yield(0,d.getTable)().get(String(a));if(!l)return __LOG__(3)`getMsgIfAuthorized: can not find msg ${a.toString()}.`,null;const _=l.type===s.MSG_TYPE.REVOKED?l.protocolMessageRowId:l.rowId;if(null==_)return __LOG__(3)`getMsgIfAuthorized: msg missing rowId ${a.toString()}.`,null;const h=yield(0,u.isRetryEligible)(a,r,i,_);__LOG__(2,void 0,void 0,void 0,["messaging"])`getMsgIfAuthorized: ${e}, ${String(r)} retry eligibility ${h}`;const m=new f.Msg((0,g.hydrateMessage)(l));yield m.waitForPrep();let y=!1;switch(m.type===s.MSG_TYPE.REVOKED&&(y=!0,m.type="protocol",m.subtype="admin"===m.subtype?"admin_revoke":"sender_revoke"),h){case u.RetryEligibilityResult.ELIGIBLE:return m;case u.RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:new p.default.E2eRetryAfterDelivery({deviceType:r.isCompanion()?p.default.DEVICE_TYPE.COMPANION:p.default.DEVICE_TYPE.PRIMARY,messageType:m.getWamMessageType(),msgRetryCount:n,retryRevoke:y}).commit()}return null}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,r,n,a){return null!=r&&e&&e.key?a?null==n?(__LOG__(2)`processKeyBundle: missing session for retry`,yield h.Session.deleteRemoteInfo(t),!1):n!==r?(__LOG__(2)`processKeyBundle: delete session because reg does not match, saved: ${n}, received: ${r}`,yield h.Session.deleteRemoteInfo(t),!1):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield h.Session.createSignalSession((0,i.default)({wid:t,regId:r},e)),!0):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield h.Session.createSignalSession((0,i.default)({wid:t,regId:r},e)),!0):(__LOG__(2)`processKeyBundle: skip due to missing key bundle`,!1)}))).apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t){const{from:n,keyBundle:i,offline:a,originalMsgId:o,participant:s,regId:d,retryCount:u}=t,p=s||n;if(__LOG__(2)`updateLocalSession: retryCount: ${u}, offline: ${a.toString()}, has keyBundle: ${(!!i).toString()}`,e.isGroup()){const t=r(69951).ChatCollection.get(e);t&&p&&(0,_.markForgetSenderKey)(t.id,[p])}const f=yield h.Session.getRemoteRegId(p);if((0,l.toUserWid)(p).equals((0,c.getMeUser)())&&f!==d)throw new Error(`updateLocalSession: detect registration Id change remote: ${d}, local: ${f} for peer device`);(yield y(i,p,d,f,a))||null!=f&&f!==d&&(__LOG__(2)`updateLocalSession: delete session because reg does not match, saved: ${f}, received: ${f}`,yield h.Session.deleteRemoteInfo(p));if(2===u)return h.Session.saveSessionBaseKey(p,o);if(u>2){if(yield h.Session.hasSameBaseKey(p,o))return __LOG__(2)`updateLocalSession: delete local session due to same base key`,h.Session.deleteRemoteInfo(p)}}))).apply(this,arguments)}},87423:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(71914),i=r(81663),a=r(99234);var o=new n.WapParser("retryRequestParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","retry"),e.hasAttr("to")&&e.assertAttr("to",(0,a.assertGetMe)().toJid());const t=(0,i.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.hasAttr("participant")?(0,i.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("participant")):null,n=e.hasAttr("recipient")?(0,i.deviceJidToUserWid)(e.attrPhoneDeviceJid("recipient")):null,o=e.child("retry"),s=e.maybeChild("keys");let l=null;if(null!=s){var c;const e=s.child("skey"),t=s.child("key");l={identity:s.child("identity").contentBytes(32),deviceIdentity:null===(c=s.maybeChild("device-identity"))||void 0===c?void 0:c.contentBytes(),skey:{id:e.child("id").contentUint(3),pubkey:e.child("value").contentBytes(32),signature:e.child("signature").contentBytes(64)},key:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32)}}}return{stanzaId:e.attrString("id"),originalMsgId:o.attrString("id"),ts:e.attrTime("t"),retryCount:o.hasAttr("count")?o.attrInt("count"):0,regId:e.child("registration").contentUint(4),offline:e.hasAttr("offline"),from:t,participant:r,recipient:n,keyBundle:l}}));t.default=o},56545:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleServerNotification=function(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){const t=(0,n.wap)("ack",{id:(0,n.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server",to:(0,n.CUSTOM_STRING)(e.from)});switch(e.type){case c.LOG:return o.upload({reason:"Server request",immediate:!0,force:!0,skipSampling:!1}),Promise.resolve(t);case c.PROPS:return(0,s.queryServerProps)().then((()=>t));case c.ABPROPS:return(0,a.syncABProps)(!1).then((()=>t));default:return __LOG__(3)`Unsupported notification with type "server",
blindly ack-ing it and doing nothing`,Promise.resolve(t)}}(t.success)};var n=r(31914),i=r(71914),a=r(89981),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(85965)),s=r(47569);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}const c=Object.freeze({LOG:"log",PROPS:"props",ABPROPS:"abprops"});t.NOTIFICATION_TYPE=c;const d=new i.WapParser("incomingServerNotificationParser",(e=>{e.assertTag("notification");const t=e.attrString("id"),r=e.attrString("from");return e.hasChild(c.LOG)?{type:c.LOG,stanzaId:t,from:r}:e.hasChild(c.PROPS)?{type:c.PROPS,stanzaId:t,from:r}:e.hasChild(c.ABPROPS)?{type:c.ABPROPS,stanzaId:t,from:r}:{type:null,stanzaId:t,from:r}}))},25773:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleServerSyncNotification=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){if(e.changedCollections){const t=new Map;for(const[r,n]of e.changedCollections){const e=s.CollectionName.cast(r);null!=e?t.set(e,n):__LOG__(3)`syncd: unknown collection name in notification: ${r}`}let r=Array.from(t.keys());e.offline&&r.forEach((e=>{const t=u.get(e);null!=t?u.set(e,t+1):u.set(e,1)})),__LOG__(2)`syncd: incoming sync notification for collections
${Array.from(t.entries()).map((e=>{let[t,r]=e;return`${t} v${r}`})).join("\n")}`,o.default.isSyncDCriticalDataSyncInProcess()&&(r=r.filter((e=>(0,d.isCriticalCollection)(e))),__LOG__(2)`syncd: filtered non critical collections during bootstrap. new collections: ${r}`),(0,c.markCollectionsForSync)(r,t)}return Promise.resolve((0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server_sync",to:i.S_WHATSAPP_NET}))}(t.success)},t.reportOfflineNotifications=function(){if(u.size<1)return;let e=0;Array.from(u.entries()).forEach((t=>{let[,r]=t;e+=r-1})),new l.default.MdAppStateOfflineNotifications({redundantCount:e}).commit(),u.clear()};var i=r(31914),a=r(71914),o=n(r(48277)),s=r(45606),l=n(r(11339)),c=r(38804),d=r(93824);const u=new Map,p=new a.WapParser("serverSyncNotification",(e=>{if(e.assertTag("notification"),!e.hasChild("collection"))throw new Error("Server sync notifcation does not contain any collections");const t=e.attrString("id"),r=new Map(e.mapChildrenWithTag("collection",(e=>[e.attrString("name"),e.attrInt("version")]))),n=e.hasAttr("offline");return e.attrString("from")!==i.S_WHATSAPP_NET.toString()&&__LOG__(4,void 0,new Error)`handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"`,{changedCollections:r,stanzaId:t,offline:n}}))},87183:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(71914),o=r(88102),s=r(24747),l=r(17186),c=r(91214),d=r(65044);const u=new a.WapParser("streamErrorParser",(e=>{if(e.assertTag("stream:error"),!e.hasChild("conflict"))return e.hasAttr("code")?{type:"code",code:e.attrInt("code")}:e.hasChild("ack")?{type:"ack",id:e.child("ack").hasAttr("id")?e.child("ack").attrString("id"):null}:(__LOG__(3)`Unrecognized stream:error: ${e.toString()}`,{type:"other"});switch(e.child("conflict").attrString("type")){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}));function p(){return(p=(0,i.default)((function*(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const r=t.success;if("code"===r.type&&r.code>=500&&r.code<600){if(515===r.code)return(0,l.startLogin)(),Promise.resolve("NO_ACK");if(516===r.code)return(0,c.commitDeviceLinkEvent)(516),(0,l.startLogout)(),Promise.resolve("NO_ACK");(0,s.onStreamErrorReceived)()}else{if("device_removed"===r.type)return(0,s.stopComms)(!0),yield d.Socket.clearCredentialsAndStoredData(),__LOG__(2)`stream error due to device removed, logging out`,o.Cmd.logout(),Promise.resolve("NO_ACK");if("replaced"===r.type)return(0,s.stopComms)(),Promise.resolve("NO_ACK")}return Promise.resolve("CLOSE_SOCKET")}))).apply(this,arguments)}},95681:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=_.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`handleSuccess: failed to parse ${t.error}`,Promise.reject(t.error);const r=t.success;(function(e){const t=Date.now()/1e3,r=Math.round(t-e),n=Math.round(r/3600);0!==n&&(0,o.getABPropConfigValue)("log_clock_skew")&&new u.default.ClockSkewDifferenceT({clockSkewHourly:-1*n}).commit();(0,i.setClockSkew)(r),s.Clock.setSkew(r)})(r.ts),l.Cmd.onTemporaryBan({banned:!1});const n=r.companionEncStatic;if(c.DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(n),(0,d.generateFinalDbEncryptionAndFtsKeyForInvoker)(n),null==f.ServerProps.serverPropsVersion||f.ServerProps.serverPropsVersion<r.propsVersion)return(0,p.queryServerProps)()};var i=r(92844),a=r(71914),o=r(86945),s=r(22683),l=r(88102),c=r(15998),d=r(10786),u=n(r(11339)),p=r(47569),f=r(64551);const _=new a.WapParser("successParser",(e=>(e.assertTag("success"),{ts:e.attrTime("t"),propsVersion:e.attrInt("props"),companionEncStatic:e.maybeAttrString("companion_enc_static")||"NULL"})))},2634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{callCreator:r,from:n,message:a,payloadTag:o,stanzaId:s}=t.success,l=(0,h.wapNodeToVoipXml)(e),g={elapsed_msec:a.elapsed_msec,epoch_msec:a.epoch_msec,is_offline:a.is_offline,payload:l[2][0],peer_app_version:a.peer_app_version,peer_platform:a.peer_platform,peer_jid:a.peer_jid?a.peer_jid.toString({legacy:!0}):void 0},E=a.call_id;switch(a.type){case _.TYPE.OFFER:return y(n,s,E,r,a.type),(0,p.getDoNotDisturb)()&&!u.default.isFocused?__LOG__(2)`handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`:(0,d.handleIncomingCallOffer)(a,g),Promise.resolve("NO_ACK");case _.TYPE.ENC_REKEY:return(0,d.handleIncomingEncRekey)(a,g).then((e=>{let{shouldRetry:t,retryCount:i}=e;t?(0,f.default)(s,a,i):y(n,s,E,r,_.TYPE.ENC_REKEY)})),Promise.resolve("NO_ACK");case _.TYPE.ACCEPT:case _.TYPE.REJECT:return y(n,s,E,r,a.type),(0,d.handleIncomingSignalingMsg)(a,g),Promise.resolve("NO_ACK");case _.TYPE.OFFER_NOTICE:return(0,c.default)(e);default:return(0,d.handleIncomingSignalingMsg)(a,g),Promise.resolve(function(e,t,r){return(0,i.wap)("ack",{to:(0,h.JID)(e),id:(0,i.CUSTOM_STRING)(t),class:"call",type:(0,i.MAYBE_CUSTOM_STRING)(r)})}(n,s,o))}};var i=r(31914),a=r(71914),o=(n(r(64369)),r(81663)),s=r(24747),l=r(99234),c=n(r(66337)),d=r(76046),u=n(r(96489)),p=r(17506),f=n(r(64254)),_=r(45473),h=r(39410);function g(e){return _.TYPE[e.tag().toUpperCase()]||_.TYPE.NONE}const m=new a.WapParser("callParser",(e=>{e.assertTag("call");const t=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.mapFirstChild((e=>e));if(r){const n=r.attrString("call-id"),i=(0,o.jidWithTypeToWid)(r.attrJidWithType("call-creator")),a={call_id:n,call_creator:i,peer_jid:t,peer_platform:e.hasAttr("platform")?e.attrString("platform"):void 0,peer_app_version:e.hasAttr("version")?e.attrString("version"):void 0,epoch_msec:e.hasAttr("t")?String(1e3*e.attrInt("t")):void 0,elapsed_msec:e.hasAttr("e")?String(1e3*e.attrInt("e")):void 0,type:g(r),common:{call_id:n,peer_jid:t.toString(),type:String(g(r))},isVideoCall:r.hasChild("video"),t:e.attrTime("t")};return{from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),stanzaId:e.attrString("id"),payloadTag:r.tag(),message:a,callCreator:i}}throw new Error("Unrecognized call stanza")}));function y(e,t,r,n,a){let o;switch(a){case _.TYPE.OFFER:o=(0,i.wap)("offer",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)});break;case _.TYPE.ENC_REKEY:o=(0,i.wap)("enc_rekey",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)});break;case _.TYPE.ACCEPT:o=(0,i.wap)("accept",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)});break;case _.TYPE.REJECT:o=(0,i.wap)("reject",{"call-id":(0,i.CUSTOM_STRING)(r),"call-creator":(0,h.JID)(n)})}(0,s.castStanza)((0,i.wap)("receipt",{to:(0,h.JID)(e),id:(0,i.CUSTOM_STRING)(t),from:(0,h.JID)((0,l.getMaybeMeUser)())},o))}},71419:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),o=r(31914),s=r(71914),l=r(81663),c=r(79711),d=r(84356),u=r(39410);const p=new s.WapParser("rekeyRetryReceiptParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","enc_rekey_retry");const t=e.child("enc_rekey");return{from:(0,l.jidWithTypeToWid)(e.attrJidWithType("from")),originalMsgId:t.attrString("call-id"),stanzaId:e.attrString("id"),retryCount:t.hasAttr("count")?t.attrInt("count"):0,regId:e.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}}));function f(){return(f=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve();const r=t.success,n=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)((0,a.default)(r.stanzaId,"retryInfo.stanzaId")),to:(0,u.JID)(r.from),class:"receipt",type:"enc_rekey_retry"});try{return(yield(0,c.handleVoipRetryRequest)(r))?d.Voip.resendEncRekeyRetry(r.from.toString({legacy:!0,formatFull:!0}),r.retryCount):(__LOG__(3)`voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry`,d.Voip.endCall(r.originalMsgId)),n}catch(e){return __LOG__(3)`voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry`,n}}))).apply(this,arguments)}},66337:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=c.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{stanzaId:r,fromWid:n,callCreator:a,callId:o,isGroup:d,isVideo:u,t:p}=t.success;return(0,s.default)(a,o,p,u,d),Promise.resolve((0,i.wap)("ack",{to:(0,l.JID)(n),id:(0,i.CUSTOM_STRING)(r),class:"call",type:(0,i.CUSTOM_STRING)("offer_notice")}))};var i=r(31914),a=r(71914),o=r(81663),s=n(r(42285)),l=r(39410);const c=new a.WapParser("callOfferNoticeParser",(e=>{e.assertTag("call");const t=e.attrString("id"),r=(0,o.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.child("offer_notice");return{stanzaId:t,fromWid:r,callCreator:(0,o.deviceJidToDeviceWid)(n.attrPhoneDeviceJid("call-creator")),callId:n.attrString("call-id"),isGroup:"group"===n.attrString("type"),isVideo:"video"===n.attrString("media"),t:e.attrTime("t")}}))},89370:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"handleCall",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"handleEncRekeyRetryRequest",{enumerable:!0,get:function(){return a.default}});var i=n(r(2634)),a=n(r(71419))},51836:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCertificateDetailsParams=function(e){return{serial:e.serial,name:e.verifiedName,isApi:"ent:wa"===e.issuer}},t.getParsedProtoObjects=function(e){if(!e)return null;const t=(0,n.decodeProtobuf)(i.VerifiedNameCertificateSpec,e);if(!t.details)throw new Error("verifyCertificate cert missing details");if(!t.signature)throw new Error("verifyCertificate cert missing signature");const r=(0,n.decodeProtobuf)(i.VerifiedNameCertificate$DetailsSpec,t.details);return{cert:t,details:r}};var n=r(84902),i=r(91344)},45033:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.CiphertextType=void 0;const n=r(76672)({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg"});t.CiphertextType=n;const i=r(76672)({Photo:"photo",Video:"video",Audio:"audio",Ptt:"ptt",Location:"location",Contact:"contact",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"live_location",ProfilePic:"profile_pic",Sticker:"sticker",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product"});t.MediaType=i},68819:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getJobManager=function(){if(null==d)throw new Error("jobs manager has not been initialized");return d},t.maybeCreateJob=f,t.startWebPersistedJobManager=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(87614),o=r(47901),s=r(92844),l=r(16703),c=n(r(56816));let d=null;function u(){return(u=(0,i.default)((function*(){yield(0,l.initialize)();const e=(0,l.getJobsTable)();d=new o.PersistedJobManager({accessors:p(),unfinishedJobEntries:e.all(),isRestartAfterCrash:!1,listeners:{onJobStarted:()=>{},onJobFinished:()=>null},deprecatedJobs:[]}),(0,c.default)(d)}))).apply(this,arguments)}function p(){return{deletePersistedJob:e=>(0,l.getJobsTable)().remove(e),updatePersistedJob:e=>(0,l.getJobsTable)().createOrReplace(e),readPersistedJob:e=>(0,l.getJobsTable)().get(e),maybeCreateJob:f}}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){var t,r;const n=(0,l.getJobsTable)(),i=JSON.stringify([e.type,null!==(t=e.uniqKey)&&void 0!==t?t:(0,a.randomHex)(32)]),c={type:e.type,uniqKey:i,startTime:(0,s.unixTime)(),version:null!==(r=e.version)&&void 0!==r?r:1,original:e.args,current:e.args,step:o.UNSTARTED_JOB,waitUntil:null,stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,backedOffCount:0};if(null==e.uniqKey)return n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const d=yield n.equals(["uniqKey"],[e.uniqKey]);if(0===d.length)return n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})));const u=[];let p=null;for(const e of d)e.step!==o.FINISHED_JOB?p=e:u.push(n.remove(e.jobId));return yield Promise.all(u),null!=p?{id:p.jobId,newlyCreated:!1}:n.createOrReplace(c).then((e=>({id:e,newlyCreated:!0})))}))).apply(this,arguments)}},97398:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureE2ESessions=m,t.ensureE2ESessionsWithDelay=function(e,t){const r=new s.ShiftTimer((()=>{m(e)}));e.forEach((e=>{h.set(String(e),r)})),r.onOrAfter(1e3*t)},t.splitWidsIntoChunks=S;var i=n(r(48926)),a=r(52230),o=r(27870),s=r(57319),l=r(31914),c=r(71914),d=r(81663),u=r(86945),p=r(24747),f=r(77605),_=r(39410);const h=new Map,g=new o.PromiseQueueMap;function m(e){const t=e.map((e=>e.toString())).join();e.forEach((e=>{const t=h.get(e.toString());t&&(t.cancel(),h.delete(e.toString()))})),__LOG__(2)`ensureE2ESession ${t}`;const r=g.waitIfPending(t);if(r)return __LOG__(2)`ensureE2ESession deduped ${t}`,r;const n=f.Session.hasSignalSessions(e).then(function(){var t=(0,i.default)((function*(t){const r=e.filter(((e,r)=>!t[r]));if(r.length>0){const{depletedPrekeyCount:e}=yield function(){return E.apply(this,arguments)}(r);return{missedPrekeyCount:r.length,depletedPrekeyCount:e}}return{missedPrekeyCount:0,depletedPrekeyCount:0}}));return function(){return t.apply(this,arguments)}}());return g.enqueueHandlers(t,n)}const y=new c.WapParser("e2eSessionParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");throw new Error(`establishE2ESessionParser bad response: ${r} ${n}`)}{const t=e.child("skey"),r=e.hasChild("key")?e.child("key"):null,n=e.hasChild("device-identity")?e.child("device-identity").contentBytes():null;return{wid:(0,d.deviceJidToDeviceWid)(e.attrPhoneDeviceJid("jid")),regId:e.child("registration").contentUint(4),identity:e.child("identity").contentBytes(32),deviceIdentity:n,skey:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32),signature:t.child("signature").contentBytes(64)},key:r&&{id:r.child("id").contentUint(3),pubkey:r.child("value").contentBytes(32)}}}}))));function E(){return(E=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=new o.PromiseQueue,n=new o.PromiseQueue;let s=0;return S(e,(0,u.getABPropConfigValue)("web_prekeys_fetch_first_batch_size")).forEach((e=>{r.enqueue((0,i.default)((function*(){const r=e.map((e=>(0,l.wap)("user",{jid:(0,_.DEVICE_JID)(e),reason:t?"identity":l.DROP_ATTR}))),o=(0,l.wap)("iq",{id:(0,l.generateId)(),xmlns:"encrypt",type:"get",to:l.S_WHATSAPP_NET},(0,l.wap)("key",null,r)),c=yield(0,p.sendIq)(o,y);if(!c.success)throw new Error(`establishE2ESession bad response ${String(c)}`);const d=c.result;if(!d||d.length<=0)throw new Error("establishE2ESession: empty keyInfo");n.enqueue((0,i.default)((function*(){const e=[],t=[];d.forEach((r=>{null!=r.wid.device&&r.wid.device!==a.DEFAULT_DEVICE_ID?t.push(r):e.push(r),r.key||s++}));const r=e=>f.Session.createSignalSession(e).catch((t=>{__LOG__(4,void 0,new Error,!0)`createSignalSession: failed for device ${e.wid} with error ${t}`,SEND_LOGS("createSignalSession-fail")}));yield Promise.all(e.map((e=>r(e)))),yield Promise.all(t.map((e=>r(e))))})))})))})),__LOG__(2)`establishE2ESession: successfully established E2E sessions`,yield r.wait(),yield n.wait(),{depletedPrekeyCount:s}}))).apply(this,arguments)}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.length<500)return[e];const r=Math.max(Math.min(t,1),0),n=Math.ceil(r*e.length);return[e.slice(0,n),e.slice(n)].filter((e=>e.length>0))}},63442:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMerchantCompliance=function(){return f.apply(this,arguments)},t.setMerchantCompliance=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(24747),c=r(39410),d=r(77591);const u=e=>{var t,r,n;return{email:(null==e||null===(t=e.maybeChild("email"))||void 0===t?void 0:t.contentString())||"",landline_number:(null==e||null===(r=e.maybeChild("landline_number"))||void 0===r?void 0:r.contentString())||"",mobile_number:(null==e||null===(n=e.maybeChild("mobile_number"))||void 0===n?void 0:n.contentString())||""}},p=new s.WapParser("merchantComplianceResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.forEachChildWithTag("merchant_info",(e=>{var r,n,i,o;const s=(null===(r=e.maybeChild("entity_name"))||void 0===r?void 0:r.contentString())||"",l=(null===(n=e.maybeChild("entity_type"))||void 0===n?void 0:n.contentString())||"",c=null===(i=e.maybeChild("entity_type_custom"))||void 0===i?void 0:i.contentString(),d="true"===e.attrString("is_registered"),p=e.maybeChild("customer_care_details"),f=e.maybeChild("grievance_officer_details"),_=(0,a.default)({},u(p)),h=(0,a.default)({name:(null==f||null===(o=f.maybeChild("name"))||void 0===o?void 0:o.contentString())||""},u(f));t.push({entity_name:s,entity_type:l,is_registered:d,entity_type_custom:c,customer_care_details:_,grievance_officer_details:h})})),t}));function f(){return(f=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,o.generateId)(),type:"get",smax_id:"53"},e.map((e=>(0,o.wap)("merchant_info",{jid:(0,c.USER_JID)(e.wid)})))),r=yield(0,l.sendIq)(t,p);if(r.success)return r.result;throw new d.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){let{entityName:e,entityType:t,isRegistered:r,entityTypeCustom:n,customerCareDetails:i,grievanceOfficerDetails:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,o.generateId)(),type:"set",smax_id:"54"},(0,o.wap)("merchant_info",{is_registered:r?"true":"false"},void 0!==e?(0,o.wap)("entity_name",null,e):null,void 0!==t?(0,o.wap)("entity_type",null,t):null,void 0!==n?(0,o.wap)("entity_type_custom",null,n):null,i?(0,o.wap)("customer_care_details",null,void 0!==i.email?(0,o.wap)("email",null,i.email):null,void 0!==i.landlineNumber?(0,o.wap)("landline_number",null,i.landlineNumber):null,void 0!==i.mobileNumber?(0,o.wap)("mobile_number",null,i.mobileNumber):null):null,a?(0,o.wap)("grievance_officer_details",null,void 0!==a.name?(0,o.wap)("name",null,a.name):null,void 0!==a.email?(0,o.wap)("email",null,a.email):null,void 0!==a.landlineNumber?(0,o.wap)("landline_number",null,a.landlineNumber):null,void 0!==a.mobileNumber?(0,o.wap)("mobile_number",null,a.mobileNumber):null):null)),c=yield(0,l.sendIq)(s,p);if(c.success)return c.result;throw new d.ServerStatusCodeError(c.errorCode)}))).apply(this,arguments)}},63728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addPlaceHolderAction=function(e){d(e,{placeholderActionInd:l.default.PLACEHOLDER_ACTION.ADD}).commit()},t.populatePlaceHolderAction=function(e){d((0,c.hydrateMessage)(e),{placeholderActionInd:l.default.PLACEHOLDER_ACTION.POPULATE}).commit()},t.viewPlaceHolderAction=function(e){d((0,c.hydrateMessage)(e),{placeholderActionInd:l.default.PLACEHOLDER_ACTION.VIEW}).commit()};var i=n(r(81109)),a=r(92844),o=n(r(89867)),s=r(45454),l=n(r(11339)),c=r(12896);function d(e,t){const n=new(r(17304).Msg)(e),c=new l.default.PlaceholderActivity((0,i.default)({placeholderChatTypeInd:o.default.isGroup(n.from)||o.default.isGroup(n.to)?l.default.PLACEHOLDER_CHAT_TYPE.GROUP:l.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL,placeholderTimePeriod:Math.max((0,a.unixTime)()-n.t,0),placeholderTypeInd:"fanout"===n.subtype?l.default.PLACEHOLDER_TYPE.FANOUT:l.default.PLACEHOLDER_TYPE.CIPHERTEXT,messageIsRevoke:Boolean(n.asRevoked),messageMediaType:n.getWamMediaType(),messageType:n.getWamMessageType()},t));return function(e,t){let n;o.default.isGroup(e.from)?n=e.from instanceof o.default?e.from:(0,s.createWidFromWidLike)(e.from):o.default.isGroup(e.to)&&(n=e.to);if(null!=n&&n.isGroup()){var i;const e=null===(i=r(63928).default.get(n))||void 0===i?void 0:i.cachedDeviceSizeBucket;null!=e&&(t.deviceSizeBucket=e)}}(n,c),c}},24872:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllContactsFromChatCollectionIntoChunks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;const t=[],r=[],n=new Set;let i=new Set;for(const a of l.ChatCollection.toArray())i.size===e&&(t.push(i),i=new Set),a.isBroadcast||(a.isGroup?r.push(a.id):n.has(a.id)||(i.add(a.id),n.add(a.id)));for(const s of r){var a,o;const r=l.ChatCollection.get(s)||{},c=null!==(a=null===(o=r.groupMetadata)||void 0===o?void 0:o.participants.toArray())&&void 0!==a?a:[];for(const r of c)i.size===e&&(t.push(i),i=new Set),n.has(r.id)||(i.add(r.id),n.add(r.id))}0!==i.size&&t.push(i);return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${t.length} chunks of contacts from chat collection, chunk size: ${e}`,t},t.getAndUpdateNonAddressBookContacts=function(){return g.apply(this,arguments)},t.getNonAddressBookContactsAndMarkAllContactsDirty=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(72441),o=n(r(89867)),s=r(45454),l=r(69951),c=r(76214),d=r(99069);function u(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){const e=new Set;return yield(0,c.getParticipantTable)().forEach((t=>{t.participants.forEach((t=>{e.add((0,a.toPhoneUserJid)((0,s.createWid)(t).user))}))})),yield(0,c.getChatTable)().forEach((t=>{o.default.isUser(t.id)&&e.add((0,a.toPhoneUserJid)((0,s.createWid)(t.id).user))})),__LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${e.size} contacts from chat and group participant tables`,Array.from(e)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=yield e.anyOf(["isAddressBookContact"],[1,0]),r=new Set(t.map((e=>e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${r.size} contacts with set isAddressBookContact value from contact table`,r}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){const e=yield u();return(0,d.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield f(r),i=Array.from(e).map((e=>n.has(e)?{id:e,isContactSyncCompleted:0}:{id:e,isAddressBookContact:0,isContactSyncCompleted:0}));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${i.length} contacts dirty during the regular sync`,r.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=yield u();return(0,d.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[r]=t;const n=yield f(r),i=e.filter((e=>!n.has(e))).map((e=>({id:e,isAddressBookContact:0,isContactSyncCompleted:0})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${i.length} non-address book contacts, mark dirty, and update the contact table during the inital sync`,r.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}},10058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactListInChunksJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactListInChunks",(e=>(0,n.syncContactListInChunks)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldDelayBetweenChunks:t})},t.syncContactListJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,a.NonPersistJob)("syncContactList",(e=>(0,n.syncContactList)(e)),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldSyncDevice:t})};var n=r(33192),i=r(1973),a=r(29731)},57062:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markGroupAsDirtyJob=function(e){return(0,a.NonPersistJob)("markGroupAsDirty",(e=>(0,o.markGroupAsDirty)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e})},t.modifyGroupParticipantJob=function(e,t,r,i,s){return(0,a.NonPersistJob)("modifyGroupParticipant",(e=>(0,o.modifyGroupParticipant)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,oldId:t,newId:r,prevVersion:i,newVersion:s})},t.replaceParticipantsJob=function(e,t,r,i,s){return(0,a.NonPersistJob)("replaceParticipants",(e=>(0,o.replaceParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,admins:r,deviceIds:i,version:s})},t.updateGroupMetadataTableJob=function(e){return(0,a.NonPersistJob)("updateGroupMetadataTable",(e=>(0,i.updateGroupMetadataTable)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})},t.updateGroupParticipantTableWithoutDeviceSyncJob=function(e){return(0,a.NonPersistJob)("updateGroupParticipantTableWithoutDeviceSync",(e=>(0,o.updateGroupParticipantTableWithoutDeviceSync)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})};var n=r(1973),i=r(86791),a=r(29731),o=r(51727)},80474:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipantsJob=function(e,t,r,o,s){return(0,i.NonPersistJob)("addParticipants",(e=>(0,a.addParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o,isOffline:s})},t.demoteParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("demoteParticipants",(e=>(0,a.demoteParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o})},t.promoteParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("promoteParticipants",(e=>(0,a.promoteParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o})},t.removeParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("removeParticipants",(e=>(0,a.removeParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,prevVersion:o})},t.updateParticipantsJob=function(e,t,r,o){return(0,i.NonPersistJob)("updateParticipants",(e=>(0,a.updateParticipants)(e)),{priority:n.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:r,isOffline:o})};var n=r(1973),i=r(29731),a=r(18615)},61051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupJob=function(e,t,r){return(0,o.NonPersistJob)("queryGroup",function(){var e=(0,i.default)((function*(e){const t=yield(0,l.queryGroup)(e);return t.id&&(yield Promise.all([(0,a.updateGroupMetadataTable)({groupInfos:[t]}),(0,s.updateParticipants)({group:t.id,participants:t.participants,version:t.pvId,isOffline:null})])),t}));return function(){return e.apply(this,arguments)}}()).waitUntilCompleted({groupWid:e,request:t,phash:r})};var i=n(r(48926)),a=r(86791),o=r(29731),s=r(18615),l=r(2182)},10823:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncDeviceListJob=function(e,t,r){return(0,a.NonPersistJob)("syncDeviceList",(e=>(0,n.syncDeviceList)(e))).waitUntilCompleted({wids:e,context:t,phash:r})},t.syncMyDeviceListJob=function(){return(0,a.NonPersistJob)("syncMyDeviceList",(()=>(0,n.syncMyDeviceList)()),{priority:i.JOB_PRIORITY.SKIP}).waitUntilCompleted()};var n=r(64114),i=r(1973),a=r(29731)},66101:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.reportSyncdStatsJob=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(86945),o=r(1973),s=n(r(11339)),l=r(29731),c=r(35047);function d(){return(d=(0,i.default)((function*(){if(yield(0,a.getABPropConfigValue)("md_app_state_report_md_sync_mutation_stats"))return new l.NonPersistJob("reportSyncdStats",(0,i.default)((function*(){const e=yield(0,c.generateActionStatCounts)();for(const t of e.values())new s.default.MdAppStateSyncMutationStats({syncdAction:t.action,applied:(0,c.convertToBucket)(t.applied),invalid:(0,c.convertToBucket)(t.invalid),orphan:(0,c.convertToBucket)(t.orphan),unsupported:(0,c.convertToBucket)(t.unsupported),failed:(0,c.convertToBucket)(t.failed)}).commit()})),{priority:o.JOB_PRIORITY.LOW}).waitUntilCompleted()}))).apply(this,arguments)}},4454:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.requestAllSyncdMissingKeysJob=function(){return new s.NonPersistJob("requestAllSyncdMissingKeys",(0,i.default)((function*(){yield(0,o.requestAllMissingKeys)(),setTimeout(l.setMissingKeyTimeout,2e4)})),{priority:a.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=n(r(48926)),a=r(1973),o=r(84051),s=r(29731),l=r(93932)},5474:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncdSyncAllCollectionsJob=function(){return new s.NonPersistJob("syncdSyncAllCollections",(0,i.default)((function*(){__LOG__(2)`syncd: periodic sync for all collection`,yield(0,l.markCollectionsForSync)([a.CollectionName.CriticalBlock,a.CollectionName.CriticalUnblockLow,a.CollectionName.Regular,a.CollectionName.RegularLow,a.CollectionName.RegularHigh])})),{priority:o.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=n(r(48926)),a=r(45606),o=r(1973),s=r(29731),l=r(38804)},1973:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JOB_PRIORITY=void 0;const n=r(76672)({SKIP:"SKIP_PRIORITIZATION",UI_ACTION:"UI_ACTION",LOW:"LOW",HIGH:"HIGH"});t.JOB_PRIORITY=n},26681:(e,t,r)=>{"use strict";var n=r(95318);t.eE=void 0;var i=n(r(48926)),a=n(r(81109)),o=r(40265),s=r(87614),l=r(38284),c=r(1973);const d=c.JOB_PRIORITY.LOW;class u{constructor(){this._isInitialized=!1,this._tasks=[],this._pendingTasks=[]}init(e,t){var r;if(this._isInitialized)throw new Error("ConcurrentPreemptiveQueue has already initialized");this._maxThreadsCount=e.maxConcurrency,this._availableThreadsCount=e.maxConcurrency,this._jobMaxConcurrency=null!==(r=e.maxConcurrencyPerJob)&&void 0!==r?r:{},this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){if(!this._isInitialized)throw new Error("ConcurrentPreemptiveQueue not initialized");this._tasks=[],this._pendingTasks=[]}enqueue(e,t,r){var n=this;if(!this._isInitialized)return Promise.reject(new Error("ConcurrentPreemptiveQueue not initialized"));let l,u;const p=new Promise(((e,t)=>{l=e,u=t})),f=(0,a.default)({priority:d},r),_=(0,s.randomHex)(8).substr(0,64),h=this._addJobTask(e,f,_,(0,i.default)((function*(){try{n._jobLogger.logJobStarted(_);const e=yield n._promiseTimeoutWrapper(t(),null==r?void 0:r.maxTimeoutMs);n._jobLogger.logJobCompleted(_),l(e)}catch(e){e instanceof o.TimeoutError?n._jobLogger.logJobTimeout(_):n._jobLogger.logJobError(_),u(e)}})));return r&&r.priority===c.JOB_PRIORITY.UI_ACTION&&this._runJobTask(h),this._runJobTasks(),p}_runJobTasks(){for(;this._availableThreadsCount>0;){const e=this._getNextJobTask();if(null==e)break;this._runJobTask(e)}}_promiseTimeoutWrapper(e,t){return void 0!==t?(0,l.promiseTimeout)(e,t):e}_runJobTask(e){var t=this;return(0,i.default)((function*(){t._availableThreadsCount--,t._markJobTaskPending(e);const{run:r,jobId:n,jobName:i}=e;try{var a;yield t._promiseTimeoutWrapper(r(),void 0===(null===(a=e.jobInfo)||void 0===a?void 0:a.maxTimeoutMs)?1e4:void 0)}catch(e){if(!(e instanceof o.TimeoutError))throw e;t._jobLogger.logJobTimeout(n),__LOG__(2)`[job-orchestator]: ${i} exceeding the timeout, release the thread.`}finally{t._availableThreadsCount++,t._markJobTaskDone(n),setTimeout((()=>t._runJobTasks()),0)}}))()}_addJobTask(e,t,r,n){const i={jobId:r,jobInfo:t,jobName:e,run:n};return this._jobLogger.logJobCreated({jobId:r,jobName:e,jobPriority:t.priority,pendingJobsCount:this._tasks.length}),this._tasks.push(i),i}_markJobTaskPending(e){this._pendingTasks.includes((t=>t.jobId===e.jobId))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskPending found jobId: ${e.jobId} in pending tasks`,SEND_LOGS("JobOrchestrator::markJobTaskPending")),this._pendingTasks.push(e),this._tasks=this._tasks.filter((t=>t.jobId!==e.jobId))}_markJobTaskDone(e){this._pendingTasks=this._pendingTasks.filter((t=>t.jobId!==e)),this._tasks.includes((t=>t.jobId===e))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskDone found jobId: ${e} in scheduled tasks`,SEND_LOGS("JobOrchestrator::markJobTaskDone"))}_getNextJobTask(){if(0===this._tasks.length)return null;const e=this._pendingTasks.reduce(((e,t)=>{var r;const n=null!==(r=e.get(t.jobName))&&void 0!==r?r:0;return e.set(t.jobName,n+1),e}),new Map);return this._tasks.filter((t=>{var r,n;return(null!==(r=e.get(t.jobName))&&void 0!==r?r:0)<(null!==(n=this._jobMaxConcurrency[t.jobName])&&void 0!==n?n:1)}))[0]}}const p=new u;t.eE=p},5215:(e,t,r)=>{"use strict";var n=r(95318);t.e=void 0;var i=n(r(48926)),a=r(87614),o=r(1973);const s=new class{constructor(){this._isInitialized=!1}init(e,t){if(this._isInitialized)throw new Error("DefaultNoQueue has already initialized");this._jobLogger=t,this._isInitialized=!0}isInitialized(){return this._isInitialized}clearQueue(){}enqueue(e,t,r){var n=this;return(0,i.default)((function*(){var i;let s;const l=(0,a.randomHex)(8).substr(0,64);n._jobLogger.logJobCreated({jobId:l,jobName:e,jobPriority:null!==(i=null==r?void 0:r.priority)&&void 0!==i?i:o.JOB_PRIORITY.LOW,pendingJobsCount:0});try{n._jobLogger.logJobStarted(l),s=yield t(),n._jobLogger.logJobCompleted(l)}catch(e){throw n._jobLogger.logJobError(l),e}return s}))()}};t.e=s},26558:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobInfoEvent=void 0;r(1973),n(r(11339));t.JobInfoEvent=class{constructor(e,t,r,n){this.jobName=e,this.scenario=n,this.pendingJobsCount=r,this.jobPriority=t}logJobAdded(){this.webcJobAddedT=Date.now()}logJobStarted(){this.webcJobStartedT=Date.now()}logJobCompleted(e){this.webcJobCompletedT=Date.now(),this.jobResultType=e}}},69221:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInstance=function(e){let t;if(e)t=r(5215).e;else{switch(function(){let e=s;e=i.GK.supportsFeature(i.GK.F.MD_BACKEND)?(0,n.getABPropConfigValue)("web_orchestrator_enabled_version"):s;return e}()){case"preemptive":t=r(26681).eE;break;case"v2":case"v1":default:t=r(5215).e}}if(!t.isInitialized()){const e=function(){l||(l=new a.JobStatsLogger);return l}();t.init(o,e)}return t};var n=r(86945),i=r(7293),a=r(95236);const o={maxConcurrency:1},s="default";let l},95236:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobStatsLogger=void 0;n(r(81109)),n(r(52991)),r(26558);var i=n(r(11339));t.JobStatsLogger=class{constructor(){this._jobEventMap=new Map}logJobCreated(e){}logJobStarted(e){}logJobCompleted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.COMPLETED)}logJobError(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ERROR)}logJobTimeout(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.TIMEOUT)}logJobAborted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ABORTED)}_logJobFinished(e,t){}_maybeCommitJobEvent(e){}}},29731:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NonPersistJob=function(e,t,r){if("function"!=typeof t)throw new Error("NonPersistJob got invalid function param");const a=(0,i.getInstance)((null==r?void 0:r.priority)===n.JOB_PRIORITY.SKIP);return{fireAndForget(){a.enqueue(e,(()=>t.apply(null,arguments)),r)},waitUntilCompleted(){return a.enqueue(e,(()=>t.apply(null,arguments)),r)}}};var n=r(1973),i=r(69221)},47587:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendPassiveIb=function(e){const t=(0,a.wap)("ib",null,(0,a.wap)("passive",{value:(0,a.CUSTOM_STRING)(String(e))}));(0,s.castStanza)(t)},t.sendPassiveIq=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747);const l=new o.WapParser("passiveIqParser",(e=>{e.assertAttr("type","result")}));function c(){return(c=(0,i.default)((function*(e){const t=e?(0,a.wap)("passive",null):(0,a.wap)("active",null),r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"passive",type:"set",id:(0,a.generateId)()},t),n=yield(0,s.sendIq)(r,l);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`sendPassiveIq: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}__LOG__(2)`sendPassiveIq: passive mode set to ${String(e)}`}))).apply(this,arguments)}},56816:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){!function(e,t){Object.keys(t).forEach((r=>{t.hasOwnProperty(r)&&e.addPersistedJobImplementation(r,t[r])}))}(e,{rotateKey:()=>r.e(5179).then(r.bind(r,95179)).then((e=>e.default)),setAbout:()=>r.e(2776).then(r.bind(r,62776)).then((e=>e.default)),queryProductList:()=>r.e(1505).then(r.bind(r,71505)).then((e=>e.QueryProductListCatalog)),getPublicKey:()=>r.e(8578).then(r.bind(r,58578)).then((e=>e.QueryGetPublicKey)),getSignedUserInfo:()=>r.e(6801).then(r.bind(r,6801)).then((e=>e.QueryGetSignedUserInfo)),deleteReactions:()=>r.e(5377).then(r.bind(r,55377)).then((e=>e.default))})}},6684:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobSerializers=void 0;var n=r(57701),i=r(77591);const a={rotateKey:()=>({type:"rotateKey",args:{},uniqKey:"rotateKey"}),setAbout:e=>({type:"setAbout",args:{content:e},uniqKey:"setAbout"}),queryProductList(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if((0,n.commerceFeaturesDisabledBySanctions)())throw new i.E451;return{type:"queryProductList",args:{catalogWid:e.toString(),productIds:t,width:a,height:o,directConnectionEncryptedInfo:r},uniqKey:`queryProductList:${t.slice().sort().join(",")}:${a}:${o}`}},getPublicKey:e=>({type:"getPublicKey",args:{businessJid:e.toString()},uniqKey:`getPublicKey:${e.toString()}`}),getSignedUserInfo:e=>({type:"getSignedUserInfo",args:{businessJid:e.toString()},uniqKey:`getSignedUserInfo:${e.toString()}`}),deleteReactions:(e,t)=>({type:"deleteReactions",args:{chatId:e,parentMsgKeys:t},uniqKey:`deleteReactions:${e}`})};t.jobSerializers=a},93306:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProductMD=function(){return f.apply(this,arguments)},t.addProductResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(65508),c=r(57701),d=r(90667),u=r(77591);const p=new o.WapParser("addProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_add").child("product");return(0,d.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,r){if((0,c.commerceFeaturesDisabledBySanctions)())throw new u.E451;const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_add",{v:"1"},(0,d.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,r.toString()))),i=yield(0,s.sendIqErrorParser)(n,p,l.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new u.E451;throw null!=i.customError?new u.CatalogEditServerError(i.errorCode,i.customError):new u.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}t.addProductResponse=p},27534:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealProductMD=function(){return u.apply(this,arguments)},t.appealProductResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("appealProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("response").child("success").contentString()}));function u(){return(u=(0,i.default)((function*(e,t){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const r=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"fb:thrift_iq"},(0,a.wap)("request",{type:"appeal_product"},(0,a.wap)("reason",null,t),(0,a.wap)("id",null,e))),n=yield(0,s.sendIq)(r,d);if(n.success)return n.result;if(451===n.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}t.appealProductResponse=d},23216:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCatalogEventLogger=t.GRAPHQL_CATALOG_ENDPOINT=void 0;var i=n(r(11339));const a=i.default.GRAPHQL_CATALOG_ENDPOINT;t.GRAPHQL_CATALOG_ENDPOINT=a;t.createCatalogEventLogger=e=>{const t=new i.default.GraphqlCatalogRequest({graphqlCatalogEndpoint:e});return{success:()=>{t.set({graphqlErrorCode:-1,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.SUCCESS}),t.commit()},failure:e=>{let[r]=e;t.set({graphqlErrorCode:r.code,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.FAILURE}),t.commit()}}}},90880:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductCatalog=function(){return u.apply(this,arguments)},t.productCatalogCreateResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("productCatalogCreateResponse",(e=>{e.assertTag("iq"),e.assertFromServer(),e.child("product_catalog_create")}));function u(){return(u=(0,i.default)((function*(){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const e=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_create",{version:"1"})),t=yield(0,s.sendIq)(e,d);if(t.success)return t.result;if(451===t.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(t.errorCode)}))).apply(this,arguments)}t.productCatalogCreateResponse=d},15814:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProductsMD=function(){return u.apply(this,arguments)},t.productDeleteResponse=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("productDeleteResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return{deletedCount:e.child("product_catalog_delete").attrInt("deleted_count")}}));function u(){return(u=(0,i.default)((function*(e){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const t=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_delete",{v:"1"},e.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e)))))),r=yield(0,s.sendIq)(t,d);if(r.success)return r.result;if(451===r.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}t.productDeleteResponse=d},21013:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(65508),c=r(57701),d=r(90667),u=r(77591);const p=new o.WapParser("editProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_edit").child("product");return(0,d.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,r){if((0,c.commerceFeaturesDisabledBySanctions)())throw new u.E451;const n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,a.wap)("product_catalog_edit",{v:"1"},(0,d.productModelToNode)(e),(0,a.wap)("width",null,t.toString()),(0,a.wap)("height",null,r.toString()))),i=yield(0,s.sendIqErrorParser)(n,p,l.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new u.E451;throw i.customError?new u.CatalogEditServerError(i.errorCode,i.customError):new u.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},90667:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseLegacyProductErrorReason=function(e){if(null!=e){const t=Object.keys(e)[0];return[{name:t,reason:e[t]||"",detail:e.detail}]}return[]},t.parseProductNode=void 0,t.productModelToNode=function(e){var t,r;const n=e.id?(0,a.wap)("id",null,e.id.toString()):void 0,c=e.description?(0,a.wap)("description",null,e.description):void 0,d=e.url?(0,a.wap)("url",null,e.url):void 0,u=e.retailerId?(0,a.wap)("retailer_id",null,e.retailerId):void 0,p=null!=e.priceAmount1000?(0,a.wap)("currency",null,e.currency):void 0,f=null!=e.priceAmount1000?(0,a.wap)("price",null,e.priceAmount1000.toString()):void 0,_=[(0,a.wap)("image",null,(0,a.wap)("url",null,e.imageCdnUrl))].concat(null===(t=e.additionalImageCdnUrl)||void 0===t?void 0:t.map((e=>(0,a.wap)("image",null,(0,a.wap)("url",null,e))))),h=function(e){var t,r,n,i,s,l;const{isExempt:c,hasCountryCodeOrigin:d,hasImporterName:u,hasImporterAddress:p}=(0,o.scanComplianceInfoForMissingData)(e);return!c&&(d||u||p)?(0,a.wap)("compliance_info",null,d?(0,a.wap)("country_code_origin",null,null==e?void 0:e.countryCodeOrigin):void 0,u?(0,a.wap)("importer_name",null,null==e?void 0:e.importerName):void 0,p?(0,a.wap)("importer_address",null,(null==e||null===(t=e.importerAddress)||void 0===t?void 0:t.street1)?(0,a.wap)("street1",null,e.importerAddress.street1):void 0,(null==e||null===(r=e.importerAddress)||void 0===r?void 0:r.street2)?(0,a.wap)("street2",null,e.importerAddress.street2):void 0,(null==e||null===(n=e.importerAddress)||void 0===n?void 0:n.city)?(0,a.wap)("city",null,e.importerAddress.city):void 0,(null==e||null===(i=e.importerAddress)||void 0===i?void 0:i.region)?(0,a.wap)("region",null,e.importerAddress.region):void 0,(null==e||null===(s=e.importerAddress)||void 0===s?void 0:s.postalCode)?(0,a.wap)("postal_code",null,e.importerAddress.postalCode):void 0,(null==e||null===(l=e.importerAddress)||void 0===l?void 0:l.countryCode)?(0,a.wap)("country_code",null,e.importerAddress.countryCode):void 0):void 0):void 0}(e.complianceInfo),g=(0,i.default)({is_hidden:e.isHidden?"true":"false"},(null===(r=e.complianceInfo)||void 0===r?void 0:r.countryCodeOrigin)===String(s.SyntheticCountryCode.NotApplicable)?{compliance_category:l.ProductComplianceCategory.CountryOriginExempt}:void 0);return(0,a.wap)("product",g,n,(0,a.wap)("name",null,e.name),c,d,u,(0,a.wap)("media",null,_),f,p,h)};var i=n(r(81109)),a=r(31914),o=r(72549),s=r(9978),l=r(6822);t.parseProductNode=e=>{var t,r,n;const a=e.child("id").contentString(),o=e.maybeChild("url");let c="";o&&o.hasContent()&&(c=o.contentString());const d=e.child("name").contentString(),u=null!==(t=e.maybeAttrString("availability"))&&void 0!==t?t:l.ProductAvailability.UNKNOWN,p=e.maybeChild("description"),f=p?p.contentString():"",_=e.maybeChild("belongs_to"),h="true"===(null==_?void 0:_.contentString())||!1,g=[],m=[],y=[],E=e.child("media");let S=!0;E.forEachChildWithTag("image",(e=>{if(S)S=!1,g.push({key:"requested",value:e.child("request_image_url").contentString()}),g.push({key:"full",value:e.child("original_image_url").contentString()}),y.push(e.child("id").contentString());else{const t=[];t.push({key:"requested",value:e.child("request_image_url").contentString()}),t.push({key:"full",value:e.child("original_image_url").contentString()}),m.push(t),y.push(e.child("id").contentString())}}));const v=e.maybeChild("status_info"),T=(null==v?void 0:v.child("status").contentString())||"APPROVED",C=null==v||null===(r=v.maybeChild("can_appeal"))||void 0===r?void 0:r.contentString(),A=e.maybeChild("currency"),b=A?A.contentString():void 0,P=e.maybeChild("price"),M=null==P?void 0:P.contentString(),O=e.maybeChild("retailer_id"),I=O?O.contentString():"",w=!!e.hasAttr("is_hidden")&&"true"===e.attrString("is_hidden"),R=e.hasAttr("compliance_category")?l.ProductComplianceCategory.cast(e.attrString("compliance_category")):l.ProductComplianceCategory.Default,D=e.maybeChild("sale_price"),N=D?(0,i.default)({sale_price:null===(n=D.maybeChild("price"))||void 0===n?void 0:n.contentString()},D.hasChild("start_date")&&D.hasChild("end_date")?{sale_start_date:D.child("start_date").contentString(),sale_end_date:D.child("end_date").contentString()}:null):null,L=(0,i.default)({id:a,is_hidden:w,url:c,name:d,description:f,availability:u,additional_image_cdn_urls:m,image_cdn_urls:g,capability_to_review_status:[{key:"WHATSAPP",value:T}],whatsapp_product_can_appeal:"true"===C,image_hashes_for_whatsapp:y,currency:b,price:M,retailer_id:I,checkmark:h},N),k=e.maybeChild("compliance_info");return R===l.ProductComplianceCategory.CountryOriginExempt?L.compliance_info={country_code_origin:String(s.SyntheticCountryCode.NotApplicable)}:k&&(L.compliance_info=function(e){var t;const r=e.child("country_code_origin").contentString(),n=null===(t=e.maybeChild("importer_name"))||void 0===t?void 0:t.contentString(),i=e.maybeChild("importer_address"),a={country_code_origin:r,importer_name:n};var o,s,l;i&&(a.importer_address={street1:i.child("street1").contentString(),street2:null===(o=i.maybeChild("street2"))||void 0===o?void 0:o.contentString(),postal_code:null===(s=i.maybeChild("postal_code"))||void 0===s?void 0:s.contentString(),city:i.child("city").contentString(),region:null===(l=i.maybeChild("region"))||void 0===l?void 0:l.contentString(),country_code:i.child("country_code").contentString()});return a}(k)),L}},53069:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseProductGraphQL=function(e){var t,r,n,u,p,f,_,h;let{status_info:g,sale_price:m,availability:y,compliance_info:E}=e,S=(0,a.default)(e,c);const[v,...T]=null!==(t=null===(r=S.media)||void 0===r?void 0:r.images)&&void 0!==t?t:[],C=(0,i.default)((0,i.default)({id:(0,o.default)(S.id,"product.id"),retailer_id:null!==(n=S.retailer_id)&&void 0!==n?n:"",name:(0,o.default)(S.name,"product.name"),description:null!==(u=S.description)&&void 0!==u?u:"",url:null!==(p=S.url)&&void 0!==p?p:"",currency:S.currency,price:S.price,is_hidden:"ISHIDDEN_TRUE"===S.is_hidden,availability:y&&y in d?d[y]:l.ProductAvailability.UNKNOWN},null!=(null==m?void 0:m.price)?(0,i.default)({sale_price:m.price},null!=m.start_date&&null!=m.end_date?{sale_start_date:m.start_date,sale_end_date:m.end_date}:null):null),{},{checkmark:"true"===S.belongs_to,image_hashes_for_whatsapp:(null!==(f=null===(_=S.media)||void 0===_?void 0:_.images)&&void 0!==f?f:[]).map((e=>(0,o.default)(e.id,"img.id"))),image_cdn_urls:v?[{key:"requested",value:(0,o.default)(v.request_image_url,"firstImage.request_image_url")},{key:"full",value:(0,o.default)(v.original_image_url,"firstImage.original_image_url")}]:[],additional_image_cdn_urls:T.map((e=>[{key:"requested",value:(0,o.default)(e.request_image_url,"img.request_image_url")},{key:"full",value:(0,o.default)(e.original_image_url,"img.original_image_url")}])),whatsapp_product_can_appeal:"true"===(null==g?void 0:g.can_appeal),capability_to_review_status:[{key:"WHATSAPP",value:null!==(h=null==g?void 0:g.status)&&void 0!==h?h:"APPROVED"}]});if(null!=E){var A,b,P,M,O;const{importer_address:e}=E;C.compliance_info="COMPLIANCECATEGORY_COUNTRYORIGINEXEMPT"===S.compliance_category?{country_code_origin:s.SyntheticCountryCode.NotApplicable}:{country_code_origin:null!==(A=E.country_code_origin)&&void 0!==A?A:void 0,importer_name:null!==(b=E.importer_name)&&void 0!==b?b:void 0,importer_address:{street1:(0,o.default)(null==e?void 0:e.street1,"importerAddress?.street1"),street2:null!==(P=null==e?void 0:e.street2)&&void 0!==P?P:void 0,postal_code:null!==(M=null==e?void 0:e.postal_code)&&void 0!==M?M:void 0,city:(0,o.default)(null==e?void 0:e.city,"importerAddress?.city"),region:null!==(O=null==e?void 0:e.region)&&void 0!==O?O:void 0,country_code:(0,o.default)(null==e?void 0:e.country_code,"importerAddress?.country_code")}}}return C};var i=n(r(81109)),a=n(r(6479)),o=n(r(45095)),s=(r(1321),r(9978)),l=r(6822);const c=["status_info","sale_price","availability","compliance_info"];const d={AVAILABILITY_INSTOCK:l.ProductAvailability.IN_STOCK,AVAILABILITY_OUTOFSTOCK:l.ProductAvailability.OUT_OF_STOCK}},17728:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(77591);const d=new o.WapParser("visibilitySetResponse",(e=>{e.assertTag("iq"),e.assertFromServer()}));function u(){return(u=(0,i.default)((function*(e){if((0,l.commerceFeaturesDisabledBySanctions)())throw new c.E451;const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",smax_id:"23",id:(0,a.generateId)()},(0,a.wap)("product_visibility_update",{v:"1"},e.map((e=>(0,a.wap)("product",{is_hidden:e.isHidden?"true":"false"},(0,a.wap)("id",null,e.productId)))))),r=yield(0,s.sendIq)(t,d);if(r.success)return r.result;if(451===r.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}},60323:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealCollection=function(){return b.apply(this,arguments)},t.createCollection=function(){return S.apply(this,arguments)},t.deleteCollection=function(){return T.apply(this,arguments)},t.editCollection=function(){return C.apply(this,arguments)},t.parseCollectionStatusInfoNode=void 0,t.queryCollections=function(){return h.apply(this,arguments)},t.querySingleCollection=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(90667),d=r(39410),u=r(77591);const p=e=>{var t,r,n;return{status:e.child("status").contentString(),canAppeal:"true"===(null===(t=e.maybeChild("can_appeal"))||void 0===t?void 0:t.contentString().toLowerCase()),rejectReason:null===(r=e.maybeChild("reject_reason"))||void 0===r?void 0:r.contentString(),commerceUrl:null===(n=e.maybeChild("commerce_url"))||void 0===n?void 0:n.contentString()}};t.parseCollectionStatusInfoNode=p;const f=e=>{var t;const r=e.maybeChild("status_info"),n=r?p(r):void 0,i=(null==n?void 0:n.status)||"APPROVED",a=!!n&&n.canAppeal,o={id:e.child("id").contentString(),name:e.child("name").contentString(),isHidden:"TRUE"===(null===(t=e.maybeChild("is_hidden"))||void 0===t?void 0:t.contentString()),rejectReason:null==n?void 0:n.rejectReason,commerceUrl:null==n?void 0:n.commerceUrl,totalItemsCount:0,products:[],reviewStatus:i,canAppeal:a};return e.forEachChildWithTag("product",(e=>{o.products.push((0,c.parseProductNode)(e))})),o},_=new o.WapParser("collectionsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collections"),r=[];t.forEachChildWithTag("collection",(e=>{r.push(f(e))}));const n=t.child("paging").child("after"),i=n.hasContent()?n.contentString():"";return{collections:r,afterCursor:i}}));function h(){return(h=(0,i.default)((function*(e,t,r,n,i,o){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const p=t?(0,a.wap)("after",null,t):void 0,f=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"35"},(0,a.wap)("collections",{biz_jid:(0,d.DEVICE_JID)(e)},(0,a.wap)("collection_limit",null,r.toString()),(0,a.wap)("item_limit",null,n.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,o.toString()),p,c?(0,a.wap)("direct_connection_encrypted_info",null,c):null)),h=yield(0,s.sendIq)(f,_);if(h.success)return h.result;if(404===h.errorCode)return{collections:[],afterCursor:""};if(451===h.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(h.errorCode)}))).apply(this,arguments)}const g=new o.WapParser("singleCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),r=f(t),n=t.child("paging").child("after");return{collections:[r],afterCursor:n.hasContent()?n.contentString():""}}));function m(){return(m=(0,i.default)((function*(e,t,r,n,i,o){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const p=r?(0,a.wap)("after",null,r):void 0,f=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"30"},(0,a.wap)("collection",{biz_jid:(0,d.DEVICE_JID)(e),id:(0,a.CUSTOM_STRING)(t)},(0,a.wap)("limit",null,n.toString()),(0,a.wap)("width",null,i.toString()),(0,a.wap)("height",null,o.toString()),p,c?(0,a.wap)("direct_connection_encrypted_info",null,c):null)),_=yield(0,s.sendIq)(f,g);if(_.success)return _.result;if(451===_.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(_.errorCode)}))).apply(this,arguments)}const y=new o.WapParser("createOrEditCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),r=t.child("id").contentString(),n=t.maybeChild("status_info");return{id:r,reviewStatus:n?p(n).status:"APPROVED"}})),E=new o.WapParser("createOrEditCollectionResponseErrorParser",(e=>{const t=e.attrString("code"),r=e.attrString("text"),n=e.maybeChild("field");return{code:t,text:r,fieldName:null==n?void 0:n.attrString("name"),fieldReason:null==n?void 0:n.attrString("reason")}}));function S(){return(S=(0,i.default)((function*(e,t,r){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const n=[];n.push((0,a.wap)("name",null,e)),n.push(...t.map((e=>(0,a.wap)("product",null,(0,a.wap)("id",null,e))))),n.push((0,a.wap)("catalog_session_id",null,r));const i=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"36"},(0,a.wap)("collection",{op:"create"},n)),o=yield(0,s.sendIqErrorParser)(i,y,E);if(o.success)return o.result;if(451===o.errorCode)throw new u.E451;throw o.customError}))).apply(this,arguments)}const v=new o.WapParser("deleteCollectionResponse",(e=>{e.assertTag("iq");const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function T(){return(T=(0,i.default)((function*(e,t){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"43"},(0,a.wap)("collections",{op:"delete"},(0,a.wap)("id",null,e),(0,a.wap)("catalog_session_id",null,t))),n=yield(0,s.sendIq)(r,v);if(!n.success){if(451===n.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(n.errorCode)}if(!n.result)throw new u.ServerStatusCodeError(500)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,r,n,i,o){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const c=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,a.generateId)(),smax_id:"40"},(0,a.wap)("collection",{op:"update"},(0,a.wap)("id",null,e),t?(0,a.wap)("name",null,t):void 0,n.length>0?(0,a.wap)("add",null,n.map((e=>(0,a.wap)("id",null,e)))):void 0,i.length>0?(0,a.wap)("remove",null,i.map((e=>(0,a.wap)("id",null,e)))):void 0,(0,a.wap)("catalog_session_id",null,o))),d=yield(0,s.sendIqErrorParser)(c,y,E);if(d.success)return d.result;if(451===d.errorCode)throw new u.E451;throw d.customError}))).apply(this,arguments)}const A=new o.WapParser("appealCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function b(){return(b=(0,i.default)((function*(e,t){if((0,l.commerceFeaturesDisabledBySanctions)())throw new u.E451;const r=t?(0,a.wap)("reason",null,t):void 0,n=(0,a.wap)("iq",{id:(0,a.generateId)(),to:a.S_WHATSAPP_NET,xmlns:"w:biz:catalog",type:"set",smax_id:"48"},(0,a.wap)("collection",{op:"appeal",id:(0,a.CUSTOM_STRING)(e)},r)),i=yield(0,s.sendIq)(n,A);if(i.success)return i.result;if(451===i.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},92913:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAndUpdateBlocklist=function(){return g.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(73382),c=r(24747),d=r(37790),u=r(58052),p=r(64551);const f=new o.WapParser("blocklistParser",(e=>{const t={wids:[]};if(e.hasChild("error"))return function(e){const t=e&&e.maybeAttrString("code"),r=e&&e.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getBlocklist error: code ${t} text ${r}`,SEND_LOGS("getBlocklist")}(e.child("error")),t;e.assertAttr("type","result");const r=e.maybeChild("list");if(r){const e=r.maybeAttrString("dhash");e&&(t.dhash=e),r.hasChild("item")&&(t.wids=r.mapChildrenWithTag("item",(e=>(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid"))))||[])}return t}));function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){const e=(0,u.getBlocklistHash)(),t=(0,a.wap)("iq",{xmlns:"blocklist",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},e?(0,a.wap)("item",{dhash:(0,a.CUSTOM_STRING)(e)}):null),r=yield(0,c.sendIq)(t,f);if(!r.success){const{errorCode:e,errorText:t}=r;return __LOG__(3)`fetchBlocklist: failed ${e}, ${t}`,{errorCode:e,errorText:t}}return r.result?r.result:Promise.reject(new Error("response does not have blocked list"))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=p.ServerProps.mdBlocklistV2?_:d.getBlocklist;__LOG__(2)`[blocklist] fetch blocklist using blocklist ${p.ServerProps.mdBlocklistV2?"v2":"v1"}`;const t=yield e();return null!=t.errorCode||(t.dhash?(__LOG__(2)`[blocklist] updating blocklist with ${t.wids.length||0} contact(s)`,(0,u.setBlocklistHash)(t.dhash),yield(0,l.updateBlocklist)(t.wids)):__LOG__(2)`[blocklist] no change in blocklist, skip update`),t}))).apply(this,arguments)}},87117:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("businessCategoriesResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("response"),r=[];let n="";try{const e=t.maybeChild("not_a_biz");null==e||e.forEachChildWithTag("category",(e=>{n=e.attrString("id")}));t.child("categories").forEachChildWithTag("category",(e=>{const t=e.attrString("id"),i=e.contentString();r.push({id:t,localized_display_name:i,not_a_biz:!!n.length&&t===n})}))}catch(e){}return{categories:r,notABizId:n}}));function d(){return(d=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=t?"profile_typeahead":"typeahead",n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",id:(0,a.generateId)(),type:"get"},(0,a.wap)("request",{op:(0,a.CUSTOM_STRING)(r),type:"catkit",v:"1"},(0,a.wap)("query",null,e))),i=yield(0,s.sendIq)(n,c);if(i.success)return i.result;throw new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},63638:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747),c=n(r(76199)),d=r(39410),u=r(77591);const p=new o.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("business_profile"),r=[];return t.forEachChildWithTag("profile",(e=>{const t=(0,s.jidWithTypeToWid)(e.attrJidWithType("jid")),n=e.attrString("tag"),i=(0,c.default)(e);Object.keys(i).length?r.push({wid:t,tag:n,profile:i}):r.push({wid:t,tag:n})})),r}));function f(){return(f=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,a.generateId)(),type:"get"},(0,a.wap)("business_profile",{v:(0,a.INT)(t)},e.map((e=>(0,a.wap)("profile",{jid:(0,d.USER_JID)(e.wid),tag:null!=e.tag?(0,a.INT)(e.tag):a.DROP_ATTR}))))),n=yield(0,l.sendIq)(r,p);if(n.success)return n.result;throw new u.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}},43077:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=n(r(48926)),o=r(31914),s=r(71914),l=r(1321),c=(n(r(99805)),r(23216)),d=r(24747),u=r(57701),p=r(90667),f=r(53069),_=r(39410),h=r(77591);const g=new s.WapParser("catalogResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog"),r=[];t.forEachChildWithTag("product",(e=>{e.maybeChild("id")&&r.push((0,p.parseProductNode)(e))}));const n=t.child("paging"),i=n.child("before"),a=i.hasContent()?i.contentString():"",o=n.child("after"),s=o.hasContent()?o.contentString():"";return{data:r,paging:{cursors:{after:s,before:a}}}}));const m=function(){var e=(0,a.default)((function*(e){let{catalogWid:t,afterCursor:r,limit:n,width:i,height:a,checkmarkCollectionId:s,allowShopSource:l,directConnectionEncryptedInfo:c=null}=e;if((0,u.commerceFeaturesDisabledBySanctions)())throw new h.E451;const p=r?(0,o.wap)("after",null,r):void 0,f=s?(0,o.wap)("belongs_to",null,(0,o.wap)("collection_id",null,s)):void 0,m=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,o.generateId)()},(0,o.wap)("product_catalog",{jid:(0,_.DEVICE_JID)(t),allow_shop_source:(y=l,y?"true":"false")},(0,o.wap)("limit",null,n.toString()),(0,o.wap)("width",null,i.toString()),(0,o.wap)("height",null,a.toString()),p,f,c?(0,o.wap)("direct_connection_encrypted_info",null,c):null));var y;const E=yield(0,d.sendIq)(m,g);if(E.success)return E.result;if(451===E.errorCode)throw new h.E451;throw new h.ServerStatusCodeError(E.errorCode)}));return function(){return e.apply(this,arguments)}}(),y=function(){var e=(0,a.default)((function*(e){if((0,u.commerceFeaturesDisabledBySanctions)())throw new h.E451;try{var t,n,a;const{catalogWid:o,afterCursor:s,limit:d,width:u,height:p,checkmarkCollectionId:_,allowShopSource:h,directConnectionEncryptedInfo:g}=e,m=yield(0,l.fetchQuery)(void 0!==i?i:i=r(25173),{request:{product_catalog:{jid:o.toString(),allow_shop_source:h?"ALLOWSHOPSOURCE_TRUE":"ALLOWSHOPSOURCE_FALSE",width:String(u),height:String(p),direct_connection_encrypted_info:g,limit:String(d),after:s,catalog_session_id:_,locale:(0,l.getLocaleVariable)()}}},{eventLogger:(0,c.createCatalogEventLogger)(c.GRAPHQL_CATALOG_ENDPOINT.GET_CATALOG)}),{paging:y,products:E}=(null==m||null===(t=m.xwa_product_catalog_get_product_catalog)||void 0===t?void 0:t.product_catalog)||{};return{data:E.map(f.parseProductGraphQL),paging:{cursors:{before:null!==(n=null==y?void 0:y.before)&&void 0!==n?n:"",after:null!==(a=null==y?void 0:y.after)&&void 0!==a?a:""}}}}catch(t){var o,s;const[r]=null!==(o=null===(s=t.source)||void 0===s?void 0:s.errors)&&void 0!==o?o:[];switch(null==r?void 0:r.code){case 2498030:case 2498031:case 2498033:case 2498029:case 2498032:case 2498027:throw new h.ServerStatusCodeError(400,t.message);case 2498048:throw new h.E451;case 2498047:throw new h.ServerStatusCodeError(421);default:return __LOG__(3)`GraphQL: Failed fetching query xwa_product_catalog_get_product_catalog. Falling back to IQ.`,m(e)}}}));return function(){return e.apply(this,arguments)}}();var E=e=>((0,u.graphQLForCatalogM1Enabled)()?y:m)(e);t.default=E},27678:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=n(r(48926)),o=n(r(45095)),s=r(31914),l=r(71914),c=r(1321),d=(n(r(99805)),r(23216)),u=r(24747),p=r(57701),f=r(90667),_=r(53069),h=r(39410),g=r(77591);const m=new l.WapParser("productResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog").child("product");return(0,f.parseProductNode)(t)})),y=function(){var e=(0,a.default)((function*(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if((0,p.commerceFeaturesDisabledBySanctions)())throw new g.E451;const o=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,s.generateId)()},(0,s.wap)("product",{jid:(0,h.DEVICE_JID)(e)},(0,s.wap)("product_id",null,t),(0,s.wap)("width",null,r.toString()),(0,s.wap)("height",null,n.toString()),i?(0,s.wap)("fetch_compliance_info",null,i.toString()):void 0,a?(0,s.wap)("direct_connection_encrypted_info",null,a):null)),l=yield(0,u.sendIq)(o,m);if(l.success)return{data:l.result};if(404===l.errorCode)return{error:"NOT_FOUND"};throw 451===l.errorCode?new g.E451:new g.ServerStatusCodeError(l.errorCode)}));return function(){return e.apply(this,arguments)}}(),E=function(){var e=(0,a.default)((function*(){if((0,p.commerceFeaturesDisabledBySanctions)())throw new g.E451;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const[a,s,l,u,f=!1,h=null]=t;try{var m,E;const e=yield(0,c.fetchQuery)(void 0!==i?i:i=r(79341),{request:{product:{jid:a.toString(),product_id:s,width:String(l),height:String(u),fetch_compliance_info:String(f),direct_connection_encrypted_info:h,locale:(0,c.getLocaleVariable)()}}},{eventLogger:(0,d.createCatalogEventLogger)(d.GRAPHQL_CATALOG_ENDPOINT.GET_PRODUCT)}),t=(0,o.default)(null==e||null===(m=e.xwa_product_catalog_get_product)||void 0===m||null===(E=m.product_catalog)||void 0===E?void 0:E.product,"data?.xwa_product_catalog_get_product?.product_catalog?.product");return{data:(0,_.parseProductGraphQL)(t)}}catch(e){var S,v;const[r]=null!==(S=null===(v=e.source)||void 0===v?void 0:v.errors)&&void 0!==S?S:[];switch(null==r?void 0:r.code){case 2498036:return{error:"NOT_FOUND"};case 2498035:case 2498034:case 2498037:case 2498025:throw new g.ServerStatusCodeError(400,e.message);case 2498048:throw new g.E451;case 2498040:throw new g.ServerStatusCodeError(421);default:return __LOG__(3)`GraphQL: Failed fetching query xwa_product_catalog_get_product. Falling back to IQ.`,y(...t)}}}));return function(){return e.apply(this,arguments)}}();var S=function(){return((0,p.graphQLForCatalogM1Enabled)()?E:y)(...arguments)};t.default=S},99192:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryDisappearingMode=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("dmParser",(e=>{const t=e.child("disappearing_mode");return{duration:t.attrInt("duration"),t:t.attrInt("t")}}));function d(){return(d=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"disappearing_mode",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()}),t=yield(0,s.sendIq)(e,c);if(!t.success)throw new l.ServerStatusCodeError(t.errorCode);return t.result}))).apply(this,arguments)}},71820:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExist=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(10435),o=r(79942),s=r(52284),l=r(77591);function c(){return(c=(0,i.default)((function*(e){const t=(new s.USyncQuery).withContactProtocol();t.withUser((new o.USyncUser).withPhone(e)),t.withBusinessProtocol(),(0,a.isDisappearingModeEnabled)()&&t.withDisappearingModeProtocol();const r=yield t.execute(),n=r.error.all||r.error.contact;if(n)return Promise.reject(new l.ServerStatusCodeError(n.errorCode,n.errorText));const{list:i}=r;if(1===i.length){const{id:e,contact:t,business:r,disappearing_mode:n}=i[0];if(t&&"in"===t.type){const t={wid:e,biz:!!r,bizInfo:r};return n&&(t.disappearingMode={duration:n.duration,settingTimestamp:n.t}),t}}return null}))).apply(this,arguments)}},78518:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.mapParsedMediaConn=f,t.queryMediaConn=function(e){const t=new Date,r=(0,o.unixTime)(),n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:(0,s.generateId)()},(0,s.wap)("media_conn",null)),u=(0,l.sendIq)(n,a.mediaConnParser).then((e=>{if(e.success){__LOG__(2)`backend:queryMediaConn: got ${e.result.hosts.length} hosts`;const{auth:n,authTTL:a,ttl:o,hosts:s,maxBuckets:l}=f(e.result);if(!n||null==o||!s||0===s.length)throw __LOG__(2)`backend:queryMediaConnections: auth exists ${String(!!n)}`,__LOG__(2)`backend:queryMediaConnections: ttl exists ${String(!!o)}`,__LOG__(2)`backend:queryMediaConnections: hosts exists ${String(!!s)}`,s&&__LOG__(2)`backend:queryMediaConnections: hosts.length ${s.length}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("backend:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");return(0,i.default)({queryStartTime:t,auth:n,hosts:s,ttl:o-r,maxBuckets:l},null!=a?{authTTL:a-r}:null)}if(__LOG__(4,void 0,new Error,!0)`response: ${e.errorCode} ${e.errorText}`,SEND_LOGS("backend:queryMediaConn: fail"),507===e.errorCode)throw new d.E507(e.errorText,e.errorBackoff);throw new d.ServerStatusCodeError(e.errorCode,e.errorText)}));return(0,c.default)(u,e)};var i=n(r(81109)),a=r(48095),o=r(92844),s=r(31914),l=r(24747),c=n(r(84644)),d=r(77591);function u(e){switch(e){case"kyc-id":case"novi-image":case"novi-video":case"thumbnail-gif":case"ppic":return null;default:return e}}function p(e){return{hostname:e.domain,class:e.class,ips:[{ip4:e.ip4,ip6:e.ip6}]}}function f(e){var t,r;const n=e=>{const t=[],r=e.downloadable.map(u).filter(Boolean);r.length>0&&t.push({download:r});const n=e.uploadable.map(u).filter(Boolean);n.length>0&&t.push({upload:n});const i=e.downloadBuckets.map((e=>e.toString()));return null!=i&&i.length>0&&t.push({downloadBuckets:i}),t};return{hosts:e.hosts.map((e=>(0,i.default)((0,i.default)({},p(e)),{},{fallback:null!=e.fallback?p(e.fallback):void 0,type:e.isFallback?"fallback":"primary",rules:n(e)}))),auth:e.authToken,authTTL:null!==(t=e.authTTL)&&void 0!==t?t:void 0,ttl:e.authExpires,maxBuckets:null!==(r=e.maxBuckets)&&void 0!==r?r:void 0}}},25338:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryPrivacyDisallowedList=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=r(24747);r(61319);const c=new o.WapParser("getPrivacyDisallowedListParser",(e=>{const t=e.child("privacy").maybeChild("list");if(null==t)return{status:"match"};return{status:"mismatch",users:t.mapChildren((e=>(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid")))),dhash:t.attrString("dhash")}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)(),xmlns:"privacy"},(0,a.wap)("privacy",null,(0,a.wap)("list",{name:(0,a.CUSTOM_STRING)(e),value:(0,a.CUSTOM_STRING)("contact_blacklist")}))),r=yield(0,l.sendIq)(t,c);if(r.success)return r.result;throw new Error("invalid response")}))).apply(this,arguments)}},4831:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPrivacy=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(68387),l=r(24747);function c(e,t){const r=t.maybeChild("error"),n=r&&r.maybeAttrString("code"),i=r&&r.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getPrivacy error: ${e} code ${n} text ${i}`,SEND_LOGS("getPrivacy")}const d=new o.WapParser("privacyParser",(e=>{e.assertAttr("type","result");const t={};return e.child("privacy").forEachChildWithTag("category",(e=>{switch(e.attrString("name")){case"readreceipts":{const r=e.attrEnum("value",s.ALL_NONE_WITH_ERROR);"error"!==r?t.readReceipts=r:c("readreceipts",e);break}case"last":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.lastSeen=r:c("last",e);break}case"profile":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.profilePicture=r:c("profile",e);break}case"status":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.about=r:c("status",e);break}case"groupadd":{const r=e.attrEnum("value",s.VISIBILITY_WITH_ERROR);"error"!==r?t.groupAdd=r:c("groupadd",e);break}default:c("unknown type",e)}})),t}));function u(){return(u=(0,i.default)((function*(){const e=(0,a.wap)("iq",{xmlns:"privacy",to:a.S_WHATSAPP_NET,type:"get",id:(0,a.generateId)()},(0,a.wap)("privacy",null)),t=yield(0,l.sendIq)(e,d);if(t.success)return t.result;throw new Error("invalid response")}))).apply(this,arguments)}},66501:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,n.wap)("iq",{xmlns:"w",id:(0,n.generateId)(),type:"get",to:n.S_WHATSAPP_NET},(0,n.wap)("props",null));return(0,a.sendIq)(e,o)};var n=r(31914),i=r(71914),a=r(24747);const o=new i.WapParser("serverProps",(e=>{e.assertTag("iq"),e.assertAttr("from","s.whatsapp.net");const t=e.child("props"),r={serverPropsVersion:t.attrInt("version")};return t.forEachChildWithTag("prop",(e=>{switch(e.attrString("name")){case"web_ctwa_context_compose_enabled":r.ctwaContextCompose=1===e.attrInt("value");break;case"ctwa_context_enabled":r.ctwaContextRender=1===e.attrInt("value")?1:0;break;case"ephemeral_messages_allowed_values":r.ephemeralMessagesAllowedValues=e.attrString("value");break;case"frequently_forwarded_max":r.frequentlyForwardedMax=e.attrInt("value");break;case"frequently_forwarded_threshold":r.frequentlyForwardedThreshold=e.attrInt("value");break;case"web_gif_search":r.gifSearch=e.attrString("value");break;case"group_call_max_participants":r.groupCallMaxParticipants=e.attrInt("value",0);break;case"group_description_length":r.groupDescLength=e.attrInt("value");break;case"hfm_string_changes":r.hfmStringChanges=e.attrInt("value");break;case"image_max_edge":r.imageMaxEdge=e.attrInt("value");break;case"image_max_kbytes":r.imageMaxKBytes=e.attrInt("value");break;case"image_quality":r.imageQuality=e.attrInt("value")/100;break;case"max_participants":r.maxParticipants=e.attrInt("value");break;case"max_subject":r.maxSubject=e.attrInt("value");break;case"max_keys":r.maxKeys=e.attrInt("value");break;case"media":r.media=e.attrInt("value");break;case"multicast_limit_global":r.multicastLimitGlobal=e.attrInt("value");break;case"mute_always":r.muteAlways=e.attrInt("value");break;case"mms_media_key_ttl":r.mmsMediaKeyTTL=e.attrInt("value");break;case"wallpapers_v2":r.wallpapersV2=e.attrInt("value");break;case"web_shops_chat_header_button_enabled":r.webShopsChatHeaderButtonEnabled=1===e.attrInt("value",0);break;case"shops_hide_catalog_attachment_entrypoint":r.shopsHideCatalogAttachmentEntrypoint=1===e.attrInt("value",0);break;case"shops_header_dropdown_menu_item":r.shopsHeaderDropdownMenuItem=1===e.attrInt("value",0);break;case"shops_product_grid":r.shopsProductGrid=e.attrInt("value",0);break;case"mms_hot_content_timespan_in_seconds":r.mmsHotContentTimespan=e.attrInt("value");break;case"mms_vcache_aggregation_enabled":r.mmsVCacheAggregationEnabled=1===e.attrInt("value");break;case"mms_vcard_autodownload_size_kb":r.mmsVcardAutodownloadSizeKb=e.attrInt("value");break;case"product_media_attachments":r.productMediaAttachments=e.attrInt("value");break;case"status_video_max_duration":r.statusVideoMaxDuration=e.attrInt("value");break;case"syncd_inline_mutations_max_count":r.syncdInlineMutationsMaxCount=e.attrInt("value");break;case"syncd_patch_protobuf_max_size":r.syncdPatchProtobufMaxSize=e.attrInt("value");break;case"syncd_key_max_use_days":r.syncdKeyMaxUseDays=e.attrInt("value");break;case"syncd_wait_for_key_timeout_days":r.syncdWaitForKeyTimeoutDays=e.attrInt("value");break;case"syncd_additional_mutations":r.syncdAdditionalMutations=e.attrInt("value");break;case"syncd_sentinel_timeout_seconds":r.syncdSentinelTimeoutSeconds=e.attrInt("value");break;case"syncd_patch_device_index_included":r.syncdPatchDeviceIndexIncluded=1===e.attrInt("value");break;case"syncd_clear_chat_delete_chat_enabled":r.syncdClearChatDeleteChatEnabled=1===e.attrInt("value");break;case"md_pin_chat_enabled":r.syncdPinChatEnabled=1===e.attrInt("value");break;case"template_doc_mime_types":r.templateDocMimeTypes=e.attrInt("value");break;case"web_biz_profile_options":r.webBizProfileOptions=e.attrInt("value");break;case"web_biz_profile_v3":r.webBizProfileV3=1===e.attrInt("value");break;case"view_once_read":r.viewOnceRead=e.attrInt("value");break;case"view_once_write":r.viewOnceWrite=e.attrInt("value");break;case"vcard_as_document_size_kb":r.vcardAsDocumentSizeKb=e.attrInt("value");break;case"vcard_max_size_kb":r.vcardMaxSizeKb=e.attrInt("value");break;case"md_blocklist_v2":r.mdBlocklistV2=1===e.attrInt("value");break;case"web_download_document_thumb_mms_enabled":r.webDownloadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_download_status_thumb_mms_enabled":r.webDownloadStatusThumbMmsEnabled=1===e.attrInt("value");break;case"web_send_document_thumb_in_message_disabled":r.webSendDocumentThumbInMessageDisabled=1===e.attrInt("value");break;case"web_upload_document_thumb_mms_enabled":r.webUploadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_list_message":r.webListMessage=1===e.attrInt("value");break;case"web_voip_mac_os_min_version":r.webVoipMacOsMinVersion=e.attrString("value");break;case"web_voip_windows_os_min_version":r.webVoipWindowsOsMinVersion=e.attrString("value");break;case"web_cart_enabled":r.webCart=1===e.attrInt("value");break;case"web_cart_v1_1_order_message_changes_enabled":r.webCartV11OrderMessageChanges=1===e.attrInt("value");break;case"mms_cat_v1_forward_hot_override_enabled":r.mmsCatV1ForwardHotOverrideEnabled=1===e.attrInt("value");break;case"web_buttons_message_enabled":r.webButtonsMessage=1===e.attrInt("value");break;case"web_product_list_message_fallback":r.webProductListMessageFallback=1===e.attrInt("value");break;case"web_product_list_message_render_kill_switch":r.webProductListMessageRenderKillSwitch=1===e.attrInt("value");break;case"web_smb_upsell_in_biz_profile_enabled":r.webSMBUpsellInBizProfile=1===e.attrInt("value");break;case"ptt_conversation_waveform":r.pttConversationWaveform=1===e.attrInt("value");break;case"ptt_oot_playback":r.pttOotPlayback=1===e.attrInt("value");break;case"ptt_forwarded_features_enabled":r.pttForwardedFeaturesEnabled=1===e.attrInt("value");break;case"ptt_pausable_enabled":r.pttPausableEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_enabled":r.pttPlaybackSpeedEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_hide_delay":r.pttPlaybackSpeedHideDelay=e.attrInt("value");break;case"web_product_list_message_page_size":r.webProductListMessagePageSize=e.attrInt("value");break;case"ptt_remember_play_position":r.pttRememberPlayPosition=1===e.attrInt("value");break;case"ptt_waveform_send":r.pttWaveformSend=1===e.attrInt("value");break;case"web_youtube_player_enhancements":r.webYouTubePlayerEnhancements=1===e.attrInt("value");break;case"web_server_sticker_panel":r.webServerStickerPanel=e.attrInt("value");break;case"web_collections_display_enabled":r.webCollectionsDisplay=1===e.attrInt("value");break;case"web_cart_on_off":r.webCartOnOffToggle=1===e.attrInt("value");break;case"web_product_list_message_enabled":r.webProductListMessage=1===e.attrInt("value");break;case"web_media_auto_download_enabled":r.webMediaAutoDownloadEnabled=1===e.attrInt("value");break;case"download_host_switching_enabled":r.downloadHostSwitchingEnabled=1===e.attrInt("value");break;case"upload_host_switching_enabled":r.uploadHostSwitchingEnabled=1===e.attrInt("value");break;case"web_is_direct_connection_for_plm_transparent":r.isDirectConnectionForPLMTransparent=1===e.attrInt("value");break;case"web_pip_redesign":r.webPipRedesign=1===e.attrInt("value");break;case"max_electron_file_size":r.maxElectronFileSize=e.attrInt("value");break;case"max_file_size":r.maxFileSize=e.attrInt("value");break;case"web_sticker_maker":r.stickerMaker=1===e.attrInt("value");break;case"web_md_migration_experience":r.webMdMigrationExperience=1===e.attrInt("value");break;case"web_log_upload_download_crashes":r.webLogUploadDownloadCrashes=1===e.attrInt("value");break;case"web_large_files_ui":r.webLargeFilesUi=1===e.attrInt("value");break;case"web_graphql_for_catalog_m1":r.webGraphQLForCatalogM1=1===e.attrInt("value");break;case"web_md_mms_sync_deletion_request":r.webMdMmsSyncDeletionRequest=1===e.attrInt("value");break;case"web_payment_background_enabled":r.webPaymentBackgroundEnabled=1===e.attrInt("value");break;case"web_forwarding_limit_to_groups":r.webForwardingLimitToGroups=1===e.attrInt("value");break;case"streaming_upload_chunk_size":r.streamingUploadChunkSize=e.attrInt("value")}})),r}))},74727:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RECEIPT_TYPE=t.RECEIPT_MSG_TYPE=void 0,t.sendAggregateReceipts=function(){return h.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(31914),s=r(71914),l=r(68387),c=r(24747),d=r(99234),u=r(39410);const p=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"});t.RECEIPT_TYPE=p;const f=Object.freeze({PEER:"peer"});t.RECEIPT_MSG_TYPE=f;const _=new s.WapParser("readReceiptAckParser",(e=>(e.assertTag("ack"),{readReceipts:e.hasAttr("readreceipts")?e.attrEnum("readreceipts",l.ALL_NONE):null})));function h(){return(h=(0,a.default)((function*(e,t,r,n,s,l){const f=t===p.READ||t===p.PLAYED||t===p.READ_SELF||t===p.PLAYED_SELF||t===p.HISTORY_SYNC_COMPLETION;yield Promise.all(Array.from(n.keys()).map((h=>{const g=n.get(h);if(!g||0===g.length)return;const m=e.isUser()?null:h,y=[];for(;g.length>0;){const n=g.splice(0,256);let h=null;n.length>1&&(h=(0,o.wap)("list",null,n.slice(1).map((e=>(0,o.wap)("item",{id:(0,o.CUSTOM_STRING)(e)})))));const E=(0,o.wap)("receipt",{to:(0,u.JID)(e),type:t===p.DELIVERY?o.DROP_ATTR:(0,o.CUSTOM_STRING)(t),msgtype:l?(0,o.CUSTOM_STRING)(l):o.DROP_ATTR,id:(0,o.CUSTOM_STRING)(n[0]),t:null!=r?(0,o.CUSTOM_STRING)(r):o.DROP_ATTR,participant:m?(0,u.DEVICE_JID)(m):o.DROP_ATTR,recipient:s?(0,u.USER_JID)(s):o.DROP_ATTR},h);if(f){const r=function(){var r=(0,a.default)((function*(){const r={id:n[0],from:e,class:"receipt",type:t,participant:m};if(t!==p.READ&&t!==p.READ_SELF)return(0,c.sendStanzaAndWaitForAck)(E,r);{const e=yield(0,c.sendStanzaAndReturnAck)(E,r),t=_.parse(e);if(t.error)__LOG__(4,void 0,new Error,!0)`[messaging] sendAggregateReceipts: Invalid ack from server`,SEND_LOGS("Invalid-Receipt-Ack");else{const{readReceipts:e}=t.success;null!=e&&(0,d.setUserPrivacySettings)((0,i.default)((0,i.default)({},(0,d.getUserPrivacySettings)()),{},{readReceipts:e}))}}}));return function(){return r.apply(this,arguments)}}();y.push(r())}else y.push((0,c.castStanza)(E))}return Promise.all(y)})))}))).apply(this,arguments)}},16927:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterDecryption=function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)){const o=(0,h.default)(),l=(0,d.assertGetMe)(),c=!l.getDeviceId(),u=t.isUser()&&(0,s.toUserWid)(l).equals((0,s.toUserWid)(t))||null!=n&&(0,s.toUserWid)(l).equals((0,s.toUserWid)(n)),_=!(a===p.MSG_TYPES.reaction)&&(u||o||c);let g=Promise.resolve();if(!_){const r={msgId:e,chatId:t.toString(),participantId:n?n.toString():null};g=(0,f.getInactiveReceiptTable)().createOrReplace(r)}return g.then((()=>{if(m(e,t,r,n,_,u,i),_)return(0,f.getInactiveReceiptTable)().remove(e)}))}return Promise.resolve()},t.sendDeliveryReceiptsAfterPresence=function(){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND))return(0,f.getInactiveReceiptTable)().all().then(function(){var e=(0,i.default)((function*(e){const t=new Map,r=Date.now().toString();return e.forEach((e=>{const{msgId:r,chatId:n,participantId:i}=e,a=(0,s.createWid)(n),o=(i?(0,s.createWid)(i):null)||a;let l=t.get(a);l||(l=new Map,t.set(a,l));let c=l.get(o);c||(c=[],l.set(o,c)),c.push(r)})),yield Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,_.sendAggregateReceipts)(e,_.RECEIPT_TYPE.DELIVERY,r,n)}))),(0,f.getInactiveReceiptTable)().bulkRemove(e.map((e=>e.msgId)))}));return function(){return e.apply(this,arguments)}}());return Promise.resolve()};var i=n(r(48926)),a=r(31914),o=r(72441),s=r(45454),l=r(79196),c=r(24747),d=r(99234),u=r(7293),p=r(12037),f=r(76214),_=r(74727),h=n(r(84435)),g=r(39410);function m(e,t,r,n,i,s,d){let u=a.DROP_ATTR;d?u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.PEER_MSG):s?u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.SENDER):i||(u=(0,a.CUSTOM_STRING)(_.RECEIPT_TYPE.INACTIVE));const p=(0,o.extractJidFromJidWithType)((0,l.widToJidWithType)(t)),f=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(e),to:(0,a.JID)(p),participant:(t.isGroup()||t.isBroadcast())&&n?(0,g.DEVICE_JID)(n):a.DROP_ATTR,recipient:!d&&s&&r?(0,g.USER_JID)(r):a.DROP_ATTR,type:u});(0,c.castStanza)(f)}},61426:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(31914),s=r(24747),l=r(98969),c=r(39410);function d(){return(d=(0,i.default)((function*(e,t,r){const n=(0,a.decodeB64)(r),{ciphertext:i,iv:d}=yield(0,l.encryptServerErrorReceipt)(n,t),u=(0,o.wap)("receipt",{type:"server-error",to:(0,c.USER_JID)(e),id:(0,o.CUSTOM_STRING)(t),category:"peer"},(0,o.wap)("encrypt",null,(0,o.wap)("enc_p",null,i),(0,o.wap)("enc_iv",null,d)));return(0,s.sendStanzaAndWaitForAck)(u,{id:t,class:"receipt",type:"server-error",from:e,participant:null})}))).apply(this,arguments)}},35099:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.markChatRead=function(){return v.apply(this,arguments)},t.markStatusRead=function(){return T.apply(this,arguments)},t.sendReactionReadReceipts=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=n(r(45095)),s=r(92844),l=r(35470),c=n(r(65212)),d=r(15461),u=r(68387),p=r(67811),f=r(45454),_=r(48285),h=r(99234),g=r(90981),m=r(63728),y=r(74727);const E=(0,f.createWid)(a.STATUS_JID);function S(e){return e.isGroup()?y.RECEIPT_TYPE.READ:(0,h.getUserPrivacySettings)().readReceipts===u.ALL_NONE.none?y.RECEIPT_TYPE.READ_SELF:y.RECEIPT_TYPE.READ}function v(){return(v=(0,i.default)((function*(e,t){const r=Date.now().toString(),n=String(e.id),i=yield(0,g.getTable)().equals(["from","pendingReadReceipt"],[n,1],{shouldDecrypt:!1});i.sort(((e,t)=>(e.rowId||0)-(t.rowId||0)));const a=t?String(t):null;let o=i.length-1;if(a){for(;o>=0&&i[o].id!==a;o--);o<0&&(o=i.length-1)}let s=null;const l=[];for(;o>=0;o--){const e=i[o];null!=e.rowId&&(null==s||e.rowId>s)&&(s=e.rowId);const t=c.default.fromString(e.id);if(e.type===d.MSG_TYPE.CIPHERTEXT){(0,m.viewPlaceHolderAction)(e);continue}e.type===d.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype&&(0,m.viewPlaceHolderAction)(e);const r=e.broadcastId||e.from,n=e.author||e.from;l.push({id:t.id,sender:(0,f.createWidFromWidLike)(n),chat:(0,f.createWidFromWidLike)(r)})}const u=A(l);return yield Promise.all(Array.from(u.keys()).map((t=>{const n=u.get(t);if(!n)return;const i=S(e.id);return(0,y.sendAggregateReceipts)(t,i,r,n)}))),(0,_.markMessageAndChatAsRead)(s,n,!1)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if("status"!==e.remote.user)return void __LOG__(3)`markStatusRead: message is not a status.`;if(e.fromMe)return;yield(0,y.sendAggregateReceipts)(E,S(E),String(t),new Map([[(0,o.default)(e.participant,"msgKey.participant"),[e.id]]]));const r={ack:l.ACK.READ};e.participant&&e.participant.isPSA()&&(r.statusPSAReadTimestamp=t),yield(0,g.getTable)().merge(e.toString(),r)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){const t=String((0,s.unixTime)()),r=A(e.filter((e=>!(0,p.isReactionByMe)(e.senderUserJid))).map((e=>({chat:e.msgKey.remote,sender:(0,f.createWidFromWidLike)(e.senderUserJid),id:e.msgKey.id}))));yield Promise.all(Array.from(r.keys()).map((e=>{const n=r.get(e);if(n)return(0,y.sendAggregateReceipts)(e,y.RECEIPT_TYPE.READ_SELF,t,n)})))}))).apply(this,arguments)}function A(e){const t=new Map;return e.forEach((e=>{var r,n;let{chat:i,sender:a,id:o}=e;const s=null!==(r=t.get(i))&&void 0!==r?r:new Map,l=null!==(n=s.get(a))&&void 0!==n?n:[];l.push(o),s.set(a,l),t.set(i,s)})),t}},55253:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareKeysForRetry=E,t.sendRetryReceipt=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=n(r(64369)),s=r(45454),l=r(46308),c=r(24747),d=r(5087),u=r(99234),p=r(7293),f=r(58425),_=r(52083),h=r(11849),g=r(91335),m=r(39410);function y(){return(y=(0,i.default)((function*(e,t,r,n,i,o){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{const p=(0,_.getSignalProtocolStore)(),[f,h]=yield Promise.all([p.getLocalRegistrationId(),p.getIdentityKeyPair()]);if(null==f||null==h)throw new Error("No registration info found");const g=yield E(e,(0,d.toCurveKeyPair)(h));let y,S,v=a.DROP_ATTR,T=a.DROP_ATTR;if(t.isUser()){if(S=a.DROP_ATTR,y=(0,m.DEVICE_JID)(t),(0,u.getMeUser)().equals((0,s.toUserWid)(t)))if(l)v=(0,a.CUSTOM_STRING)("peer"),T=a.DROP_ATTR;else{if(!n)return Promise.reject(new Error("sendRetryReceipt: send retry to peer device without receipient"));T=(0,m.USER_JID)(n)}}else y=(0,m.CHAT_JID)(t),S=r?(0,m.DEVICE_JID)(r):a.DROP_ATTR;const C=(0,a.wap)("receipt",{id:(0,a.CUSTOM_STRING)(i),to:y,participant:S,recipient:T,type:"retry",category:v},(0,a.wap)("retry",{v:"1",count:(0,a.INT)(e),id:(0,a.CUSTOM_STRING)(i),t:(0,a.CUSTOM_STRING)(o)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(f)),g);return(0,c.sendStanzaAndWaitForAck)(C,{id:i,class:"receipt",from:t,participant:r,type:"retry"})}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("sendRetryReceipt: error while creating or sending the retry message")}}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const[r,n]=yield v(e,t);return n&&(yield h.waSignalStore.markKeyAsUploaded(n.keyId),yield h.waSignalStore.markPreKeyAsDirectDistribution(n.keyId)),r}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(e<2)return Promise.resolve([null,null]);let r=Promise.resolve(null);p.GK.supportsFeature(p.GK.F.MD_ADV)&&(r=(0,l.getADVEncodedIdentity)().then((e=>(0,a.wap)("device-identity",null,e))));try{const[e,n,i]=yield Promise.all([h.waSignalStore.getSignedPreKey(),h.waSignalStore.getOrGenSinglePreKey(f.generatePreKeyPair),r]);if(!e)throw new Error("Signed pre key is not available");return[(0,a.wap)("keys",null,(0,a.wap)("type",null,o.default.KEY_BUNDLE_TYPE),(0,a.wap)("identity",null,t.pubKey),(0,g.xmppPreKey)(n),(0,g.xmppSignedPreKey)(e),i),n]}catch(e){throw Error("Could not create keys section for retry")}}))).apply(this,arguments)}},27184:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(15688),o=r(31914),s=r(24747),l=r(99234),c=r(98969),d=r(39410);function u(){return(u=(0,i.default)((function*(e){const t=e.id.id,r=(0,a.decodeB64)(e.mediaKey),{ciphertext:n,iv:i}=yield(0,c.encryptServerErrorReceipt)(r,t),{chat:u}=e,p=(0,o.CUSTOM_STRING)(u.id.toString({legacy:!0})),f=u.isGroup||u.isBroadcast?(0,o.CUSTOM_STRING)(e.sender.toString({legacy:!0})):o.DROP_ATTR,_=(0,l.getMeUser)(),h=(0,o.wap)("receipt",{type:"server-error",to:(0,d.USER_JID)(_),id:(0,o.CUSTOM_STRING)(t)},(0,o.wap)("encrypt",null,(0,o.wap)("enc_p",null,n),(0,o.wap)("enc_iv",null,i)),(0,o.wap)("rmr",{jid:p,from_me:(0,o.CUSTOM_STRING)(String(e.isSentByMe)),participant:f}));return(0,s.sendStanzaAndWaitForAck)(h,{id:t,class:"receipt",type:"server-error",from:_,participant:null})}))).apply(this,arguments)}},93374:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(57701),c=r(39410),d=r(77591);const u=new o.WapParser("reportProductResponse",(e=>{e.assertTag("iq"),e.assertAttr("type","result")}));function p(){return(p=(0,i.default)((function*(e,t,r){if((0,l.commerceFeaturesDisabledBySanctions)())throw new d.E451;const n=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",type:"set",id:(0,a.generateId)()},(0,a.wap)("request",{type:"report_product",biz_jid:(0,c.USER_JID)(e)},r?(0,a.wap)("reason",null,r):void 0,(0,a.wap)("id",null,t))),i=yield(0,s.sendIq)(n,u);if(!i.success){if(451===i.errorCode)throw new d.E451;throw new d.ServerStatusCodeError(i.errorCode)}}))).apply(this,arguments)}},18701:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getSpamMessageProtobuf=S,t.reportSpam=function(){return C.apply(this,arguments)};var i=n(r(48926)),a=n(r(67154)),o=n(r(81109)),s=r(31914),l=r(71914),c=r(15461),d=r(60980),u=r(58853),p=r(24747),f=r(24808),_=r(99234),h=r(6565),g=r(93650),m=r(84728),y=r(39410);const E=new Set([c.MSG_TYPE.CHAT,c.MSG_TYPE.AUDIO,c.MSG_TYPE.IMAGE,c.MSG_TYPE.PTT,c.MSG_TYPE.VIDEO,c.MSG_TYPE.VCARD,c.MSG_TYPE.UNKNOWN,c.MSG_TYPE.CIPHERTEXT,c.MSG_TYPE.LIST,c.MSG_TYPE.LIST_RESPONSE,c.MSG_TYPE.BUTTONS_RESPONSE,c.MSG_TYPE.NATIVE_FLOW]);function S(e){return null==e.buttonsMessage||null!=e.buttonsMessage.buttons&&(e.buttonsMessage=(0,o.default)((0,o.default)({},e.buttonsMessage),{},{buttons:e.buttonsMessage.buttons.map((e=>{if(e.nativeFlowInfo){var t;const r=JSON.parse(null!==(t=e.nativeFlowInfo.paramsJson)&&void 0!==t?t:"{}");return delete r.reference_id,delete r.total_amount,(0,o.default)((0,o.default)({},e),{},{nativeFlowInfo:(0,o.default)((0,o.default)({},e.nativeFlowInfo),{},{paramsJson:JSON.stringify(r)})})}return e}))})),e}function v(e){const t=[],r=e.isGroup?null:e.id;return function(e,t,r){const n=[],i=e.msgs.toArray().reverse();for(let a=0;a<i.length&&!(n.length>=t);a++){const t=i[a];if(E.has(t.type)&&!t.from.equals((0,_.getMaybeMeUser)())){if(r){if(e.isGroup&&!r.equals(t.author))continue;if(e.isUser&&!r.equals(t.from))continue}n.push(t)}}return n}(e,5,r).forEach((r=>{let n,i,o,l;const p=r.t.toString(),_=r.isViewOnce&&!(0,m.isUnviewed)(r.safe());switch(r.type){case c.MSG_TYPE.UNKNOWN:l=null,n=s.DROP_ATTR,o=s.DROP_ATTR,i=(0,s.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString());break;case c.MSG_TYPE.CIPHERTEXT:l=null,n=s.DROP_ATTR,o=s.DROP_ATTR,i=s.DROP_ATTR;break;default:let e={};if(r.asMms){e=r.isUnsentPhoneMsg()||_||!r.mediaObject?{type:r.type}:r.avParams()}const t=S((0,h.createMsgProtobuf)(r,e)),a=(0,u.mediaTypeFromProtobuf)(t);l=_?null:(0,d.encodeProtobuf)(f.MessageSpec,t).readByteArray(),n=(0,g.typeAttributeFromProtobuf)(t),o=a?(0,s.CUSTOM_STRING)(a):s.DROP_ATTR,i=(0,s.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString())}let E;const v={};if(_&&(v.deleted_reason=(0,m.isViewed)(r.safe())?"view_once_opened":"view_once_expired"),e.isGroup){let t=s.DROP_ATTR;r.author?t=(0,y.USER_JID)(r.author):r.from.isUser()&&(t=(0,y.USER_JID)(r.from)),E=(0,s.wap)("message",(0,a.default)({},v,{t:(0,s.CUSTOM_STRING)(p),from:(0,y.CHAT_JID)(e.id),participant:t,id:(0,s.CUSTOM_STRING)(r.id.id),type:n}),(0,s.wap)("raw",{v:i,mediatype:o},l))}else E=(0,s.wap)("message",(0,a.default)({},v,{t:(0,s.CUSTOM_STRING)(p),from:(0,y.USER_JID)(r.from),to:(0,y.USER_JID)(r.to),type:n,id:(0,s.CUSTOM_STRING)(r.id.id)}),r.multicast?(0,s.wap)("multicast",null):null,r.urlNumber?(0,s.wap)("url_number",null):null,r.urlText?(0,s.wap)("url_text",null):null,(0,s.wap)("raw",{v:i,mediatype:o},l));t.push(E)})),t}const T=new l.WapParser("reportUserSpam",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`reportSpam: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`reportSpam: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function C(){return(C=(0,i.default)((function*(e,t){const r=v(e);let n;if(e.isGroup){var i;const a=(null===(i=e.groupMetadata)||void 0===i?void 0:i.owner)&&(0,y.USER_JID)(e.groupMetadata.owner);n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,s.generateId)()},(0,s.wap)("spam_list",{creator:a||s.DROP_ATTR,subject:(0,s.CUSTOM_STRING)(e.name),jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,s.CUSTOM_STRING)(String(t))},r))}else n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,s.generateId)()},(0,s.wap)("spam_list",{jid:(0,y.CHAT_JID)(e.id),spam_flow:(0,s.CUSTOM_STRING)(String(t))},r));const a=yield(0,p.sendIq)(n,T);if(!a.success){const{errorCode:e,errorText:t}=a;return __LOG__(3)`reportSpam: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}return a.result}))).apply(this,arguments)}},88795:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r;switch(t){case"paused":r=(0,n.wap)("paused",null);break;case"composing":r=(0,n.wap)("composing",null);break;case"recording":r=(0,n.wap)("composing",{media:"audio"});break;default:throw new Error(`Impossible value, the default statement should never be reached for value: ${t}`)}return(0,i.castStanza)((0,n.wap)("chatstate",{to:(0,o.CHAT_JID)(e),from:(0,o.JID)((0,a.assertGetMe)())},r))};var n=r(31914),i=r(24747),a=r(99234),o=r(39410)},52407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyMsg=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(24747),o=r(99094),s=r(6565);function l(){return(l=(0,i.default)((function*(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendKeyMsg: sending ${e.id.toString()}`;const t=e.to,r=(0,s.createMsgProtobuf)(e),n=yield(0,o.createUserDeviceMsgStanza)(t,null,e,r,{type:o.MsgType.AppStateSync});return(0,a.sendStanzaAndWaitForAck)(n,{id:e.id.id,class:"message",from:t,participant:null})}))).apply(this,arguments)}},99094:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgType=void 0,t.createGroupDeviceMsgStanza=function(){return T.apply(this,arguments)},t.createUserDeviceMsgStanza=function(){return v.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(45454),s=n(r(41143)),l=r(46308),c=r(58853),d=r(40316),u=r(99234),p=r(6565),f=r(7293),_=r(45033),h=r(97398),g=r(76802),m=r(52083),y=r(93650),E=r(39410);const S=r(76672).Mirrored(["Retry","AppStateSync"]);function v(){return(v=(0,i.default)((function*(e,t,r,n,i){let a=n;return yield(0,h.ensureE2ESessions)([e]),(0,o.toUserWid)(e).equals((0,u.getMeUser)())&&i.type!==S.AppStateSync?((0,s.default)(null!=t,"[messaging] createDeviceMsgStanza: no recipient for peer device message"),a=(0,p.createDeviceSentMessage)(n,t),yield(0,g.populateICDCMeta)((0,o.toUserWid)(t),a)):yield(0,g.populateICDCMeta)((0,o.toUserWid)(e),a),C(e,null,t,r,a,i)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i){if(yield(0,h.ensureE2ESessions)([t]),i.type===S.AppStateSync)return Promise.reject(new Error("[messaging] createGroupDeviceMsgStanza: not expect for App State Sync message"));const a=(0,o.toUserWid)(t).equals((0,u.getMeUser)())?(0,p.createDeviceSentMessage)(n,e):n;return yield(0,g.populateICDCMeta)((0,o.toUserWid)(t),a),C(e,t,null,r,a,i)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n,i,o){var s;const u=t||e,p=null!==(s=o.retryCount)&&void 0!==s?s:0,h=(0,c.mediaTypeFromProtobuf)(i),v=n.id,{type:T,ciphertext:C}=yield(0,d.encryptMsgProtobuf)(u,p,i);let A=null;if(f.GK.supportsFeature(f.GK.F.MD_ADV)&&T===_.CiphertextType.Pkmsg){const e=yield(0,l.getADVEncodedIdentity)();A=(0,a.wap)("device-identity",null,e)}return o.type!==S.Retry&&(yield(0,g.updateIdentityRange)(v,[u])),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(v.id),to:(0,E.JID)(e),participant:t?(0,E.DEVICE_JID)(t):a.DROP_ATTR,recipient:r?(0,E.USER_JID)(r):a.DROP_ATTR,type:(0,y.typeAttributeFromProtobuf)(i),edit:(0,g.editAttribute)(i,n.subtype),category:o.type===S.AppStateSync?(0,a.CUSTOM_STRING)("peer"):a.DROP_ATTR,push_priority:o.type===S.AppStateSync?(0,a.CUSTOM_STRING)("high"):a.DROP_ATTR},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(T),count:0===p?a.DROP_ATTR:(0,a.INT)(p),mediatype:(0,c.encodeMaybeMediaType)(h),"decrypt-fail":(0,c.encodeMaybeDecryptFail)(i.reactionMessage)},C),A)}))).apply(this,arguments)}t.MsgType=S},40316:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMsgProtobuf=function(){return u.apply(this,arguments)},t.encryptMsgSenderKey=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(58853),o=r(45033),s=n(r(11339)),l=r(76802),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=d(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(d=function(e){return e?r:t})(e)}function u(){return(u=(0,i.default)((function*(e,t,r){const n=(0,a.mediaTypeFromProtobuf)(r),i=new s.default.E2eMessageSend({e2eCiphertextVersion:a.CIPHERTEXT_VERSION,e2eDestination:(0,a.metricsDestinationType)(e),messageMediaType:n?(0,a.metricsMediaType)(n):s.default.MEDIA_TYPE.NONE,retryCount:t});try{const{type:t,ciphertext:n}=yield c.Cipher.encryptSignalProto(e,(0,l.encodeAndPad)(r));return i.e2eCiphertextType=(0,a.metricsCiphertextType)(t),i.e2eSuccessful=!0,i.commit(),{type:t,ciphertext:n}}catch(t){return i.e2eSuccessful=!1,i.weight=1,i.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const r=new s.default.E2eMessageSend({e2eCiphertextType:(0,a.metricsCiphertextType)(o.CiphertextType.Skmsg),e2eCiphertextVersion:a.CIPHERTEXT_VERSION,e2eDestination:s.default.E2E_DESTINATION.GROUP,messageMediaType:s.default.MEDIA_TYPE.NONE,retryCount:0});try{const n=yield c.Cipher.encryptSenderKeyMsgSignalProto(e,t);return r.e2eSuccessful=!0,r.commit(),n}catch(t){return r.e2eSuccessful=!1,r.weight=1,r.commit(),__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`))}}))).apply(this,arguments)}},45325:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.FANOUT_TYPE=void 0,t.createFanoutMsgStanza=function(){return P.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(45454),s=r(46308),l=r(58853),c=r(19380),d=r(40316),u=r(99234),p=r(6565),f=r(7293),_=r(45033),h=r(97398),g=r(47124),m=n(r(11339)),y=r(76802),E=r(16860),S=r(52083),v=r(93650),T=r(39410);const C=Object.freeze({CHAT:"chat",GROUP_DIRECT:"groupDirect"});function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r,n,s){const c=(0,l.mediaTypeFromProtobuf)(r),f=(0,u.getMeUser)();if(n.fanoutType===C.CHAT&&1===t.length&&(0,y.isPrimaryDevice)(t[0])){null==s||s.startClientEncryptStage();const{type:e,ciphertext:n}=yield(0,d.encryptMsgProtobuf)(t[0],0,r);return null==s||s.postClientEncryptStage(),{shouldHaveIdentity:e===_.CiphertextType.Pkmsg,body:(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(r.reactionMessage)},n)}}let h=!1;null==s||s.startClientEncryptStage();const g=t.map(function(){var t=(0,i.default)((function*(t){const i=(0,o.toUserWid)(t).equals(f)?(0,p.createDeviceSentMessage)(r,e):r,s=n.fanoutType===C.GROUP_DIRECT?(0,o.toUserWid)(t):(0,o.toUserWid)(e);yield(0,y.populateICDCMeta)(s,i);try{const{type:e,ciphertext:n}=yield(0,d.encryptMsgProtobuf)(t,0,i);return e===_.CiphertextType.Pkmsg&&(h=!0),(0,a.wap)("to",{jid:(0,T.DEVICE_JID)(t)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(r.reactionMessage)},n))}catch(e){return(0,y.isPrimaryDevice)(t)&&(__LOG__(4,void 0,new Error,!0,["messaging"])`encryptAndSendUserMsg: encryption fail for primary device ${String(t)}`,SEND_LOGS("encryption-fail-for-primary-device")),null}}));return function(){return t.apply(this,arguments)}}()),m=yield Promise.all(g);null==s||s.postClientEncryptStage();const E=m.filter((e=>null!=e));return E.length>0?{body:(0,a.wap)("participants",null,E),shouldHaveIdentity:h}:Promise.reject(new Error("[messaging] encryptAndSendUserMsg: encryption fail for all devices"))}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r,n){const i=e.to;try{const e=yield(0,h.ensureE2ESessions)(r);(0,E.postPrekeysDepletionMetric)({count:null==e?void 0:e.depletedPrekeyCount,prekeysFetchReason:m.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:n.fanoutType===C.CHAT?m.default.MESSAGE_TYPE.INDIVIDUAL:m.default.MESSAGE_TYPE.GROUP,chatId:i})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const o=e.id;let d=r;n.isResendingMsg&&(d=yield(0,y.filterDeviceWithChangedIdentity)(o,r));const u=d.map((e=>({msgKey:o,receiverId:e})));yield(0,g.createOrMergeReceiptRecords)(u);const p=yield A(i,d,t,n,e.wamMessageSendPerfReporter),b=n.fanoutType===C.GROUP_DIRECT?(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(_.CiphertextType.Skmsg)}):null;let P=null;if(f.GK.supportsFeature(f.GK.F.MD_ADV)&&p.shouldHaveIdentity){const e=yield(0,s.getADVEncodedIdentity)();P=(0,a.wap)("device-identity",null,e)}const M=(0,v.getBizNativeFlowName)(t);let O;const I=c.ContactCollection.get(i),w=null==I?void 0:I.privacyMode;null!=w&&(O=(0,a.wap)("biz",{host_storage:(0,a.INT)(w.hostStorage),actual_actors:(0,a.INT)(w.actualActors),privacy_mode_ts:(0,a.INT)(w.privacyModeTs),native_flow_name:(0,a.MAYBE_CUSTOM_STRING)(M)})),null==O&&null!=M&&(O=(0,a.wap)("biz",{native_flow_name:(0,a.CUSTOM_STRING)(M)})),n.isResendingMsg||(yield(0,y.updateIdentityRange)(o,d)),yield(0,S.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const{id:R}=o;return(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(R),to:(0,T.CHAT_JID)(i),type:(0,v.typeAttributeFromProtobuf)(t),edit:(0,y.editAttribute)(t,e.subtype),device_fanout:n.isResendingMsg?(0,a.CUSTOM_STRING)("false"):a.DROP_ATTR},p.body,b,P,O)}))).apply(this,arguments)}t.FANOUT_TYPE=C},43341:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupDirectMsg=function(){return g.apply(this,arguments)},t.resendGroupMsg=m;var i=n(r(48926)),a=n(r(70735)),o=r(45454),s=r(10823),l=r(22683),c=r(24747),d=r(45325),u=r(16104),p=n(r(11339)),f=r(76802),_=r(52083),h=r(90298);function g(){return(g=(0,i.default)((function*(e,t,r){const n=e.to;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: sending ${e.id} with group ${n.toString()}`;const i=yield E(e,t,r,{fanoutType:d.FANOUT_TYPE.GROUP_DIRECT}),{phash:a}=i;if(a){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: phash mismatch, got server phash ${a}`;const n=l.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,s.syncDeviceListJob)(r,"message",a).then((()=>m(e,t,r,n)))}return i}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r,n){__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: to ${e.to.toString()}`;const i=(0,f.createResendAbortMetric)((0,f.isRevokeMsg)(t),Boolean(e.isViewOnce),e.to);if(l.Clock.globalUnixTime()-n>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip group resending due to 5 min timeout`,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void i.commit();try{const n=Array.from(new Set(r.map((e=>e.user)))).map((e=>(0,o.createUserWid)(e))),s=yield(0,u.getFanOutList)({wids:n}),l=(0,a.default)(s,r,String);if(0===l.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: skip sending to the empty list`,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void i.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resending to devices ${l.join(",")}`,yield E(e,t,l,{fanoutType:d.FANOUT_TYPE.GROUP_DIRECT,isResendingMsg:!0})}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resend got error ${e} `,i.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,i.commit(),e}(0,h.logSuccessfulMessageSend)(i,e)}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r,n){var i;const{id:a,to:o}=e,s=yield(0,d.createFanoutMsgStanza)(e,t,r,n);yield(0,_.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const l=yield(0,c.sendStanzaAndReturnAck)(s,{id:a.id,class:"message",from:o,participant:null}),u=f.sendMsgAckSyncParser.parse(l);return u.error?Promise.reject(new Error("[messaging] encryptAndSendGroupDirectMsg: Invalid ack from server")):u.success}))).apply(this,arguments)}},23712:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDistributionMsg=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(40316),s=(r(45033),r(97398)),l=n(r(11339)),c=r(76802),d=r(16860),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function f(){return(f=(0,i.default)((function*(e,t,r){var n,p,f,_;if(null==e||null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.startPrekeysFetchStage(),null==e||null===(p=e.wamMessageSendPerfReporter)||void 0===p||p.setFetchedPrekeyCount(0),null==e||null===(f=e.wamMessageSendPerfReporter)||void 0===f||f.setSenderKeyDistributionCount(r.length),0===r.length)return null==e||null===(_=e.wamMessageSendPerfReporter)||void 0===_||_.postPrekeysFetchStage(),null;try{var h;const n=yield(0,s.ensureE2ESessions)(r),i=null==n?void 0:n.missedPrekeyCount;var g;if(null!=i)null==e||null===(g=e.wamMessageSendPerfReporter)||void 0===g||g.setFetchedPrekeyCount(i);null==e||null===(h=e.wamMessageSendPerfReporter)||void 0===h||h.postPrekeysFetchStage(),(0,d.postPrekeysDepletionMetric)({count:null==n?void 0:n.depletedPrekeyCount,prekeysFetchReason:l.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:l.default.MESSAGE_TYPE.GROUP,chatId:t})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const m=yield u.Session.getGroupSenderKeyInfo(t),y={senderKeyDistributionMessage:{groupId:t.toString({legacy:!0}),axolotlSenderKeyDistributionMessage:m}},E=r.map(function(){var e=(0,i.default)((function*(e){try{yield(0,c.populateICDCMeta)((0,a.toUserWid)(e),y);const t=yield(0,o.encryptMsgProtobuf)(e,0,y);return{type:t.type,ciphertext:t.ciphertext,participant:e}}catch(t){if(__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: encryption fail for ${e.toString()}, ${t}`,(0,c.isPrimaryDevice)(e))return Promise.reject(new Error(`[messaging] encryptAndSendUserMsg: encryption fail for primary device ${String(e)}`))}}));return function(){return e.apply(this,arguments)}}());return(yield Promise.all(E)).filter(Boolean)}))).apply(this,arguments)}},51974:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupMsg=function(e,t){var r;const{id:n,to:d}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupMsg: sending ${n}`;const{protocolMessage:u}=t;let p=null;if((null==u?void 0:u.type)===c.Message$ProtocolMessageType.REVOKE&&(null==u?void 0:u.key)){const{remoteJid:e,id:t,participant:r}=u.key;e&&t&&r&&(p=new o.default({remote:(0,s.createWid)(e),fromMe:!0,id:t,participant:(0,s.createWid)(r)}))}return null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startWaitingToEncryptStage(),_.senderKeyQueueMap.enqueue(d.toString(),(0,a.default)((function*(){var r;null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.postWaitingToEncryptStage();const n=yield function(){return m.apply(this,arguments)}(d,p);if(n.type===g.DIRECT){const{deviceList:r}=n,a=yield(0,l.encryptAndSendGroupDirectMsg)(e,t,r);return(0,i.default)((0,i.default)({},a),{},{deviceCount:r.length})}const{senderKeyList:a}=n,o=yield(0,h.encryptAndSendSenderKeyMsg)(e,t,a);return(0,i.default)((0,i.default)({},o),{},{deviceCount:a.skList.length+a.skDistribList.length})})))};var i=n(r(81109)),a=n(r(48926)),o=n(r(65212)),s=r(45454),l=r(43341),c=r(24808),d=r(16104),u=r(7293),p=r(76214),f=r(43201),_=r(92657),h=r(3922);const g=Object.freeze({SKMSG:"skmsg",DIRECT:"direct"});function m(){return(m=(0,a.default)((function*(e,t){const r=yield(0,f.getGroupSenderKeyList)(e),n={senderKeyList:r,type:g.SKMSG};if(t&&u.GK.supportsFeature(u.GK.F.MD_BACKEND)){const e=yield(0,p.getMsgInfoTable)().equals(["msgKey"],String(t));if(0===e.length)return n;const{skDistribList:i,skList:a}=r,o=new Set(i.concat(a).map((e=>String((0,s.toUserWid)(e))))),l=e.filter((e=>!o.has(e.receiverUserJid))).map((e=>(0,s.createWid)(e.receiverUserJid)));if(0===l.length)return n;const c=[...yield(0,d.getFanOutList)({wids:l}),...a,...i];return{type:g.DIRECT,deviceList:c}}return n}))).apply(this,arguments)}},95216:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupKeyDistributionMsg=function(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupKeyDistributionMsg: sending ${e}`;const t=e.remote;return y.senderKeyQueueMap.enqueue(t.toString(),(()=>function(){return T.apply(this,arguments)}(e)))};var i=n(r(48926)),a=r(31914),o=r(46308),s=r(58853),l=r(24747),c=r(99234),d=r(23712),u=r(7293),p=r(45033),f=r(47124),_=r(76802),h=r(43201),g=r(53686),m=r(52083),y=r(92657),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),S=r(39410);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function T(){return(T=(0,i.default)((function*(e){const{id:t}=e,r=e.remote,{skDistribList:n,skList:i,rotateKey:o}=yield(0,h.getGroupSenderKeyList)(r),[d,u]=yield C(r,n,o),y=i.concat(n);yield(0,_.updateIdentityRange)(e,y),yield(0,f.createOrMergeReceiptRecords)(y.map((t=>({msgKey:e,receiverId:t})))),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const E=yield(0,g.phashV2)([...y,(0,c.assertGetMe)()]),v=(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(t),to:(0,S.CHAT_JID)(r),phash:(0,a.CUSTOM_STRING)(E),type:"text",device_fanout:(0,a.CUSTOM_STRING)("false")},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(p.CiphertextType.Skmsg),"decrypt-fail":(0,a.CUSTOM_STRING)("hide")}),d,u),T=yield(0,l.sendStanzaAndReturnAck)(v,{id:t,class:"message",from:r,participant:null}),A=_.sendMsgAckSyncParser.parse(T);return A.error?(__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"))):(yield(0,h.markHasSenderKey)(r,n),A.success)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r){r&&(yield E.Session.deleteGroupSenderKeyInfo(e));const n=yield(0,d.getKeyDistributionMsg)(null,e,t);let i=null,l=!1;n&&n.length>0&&(i=(0,a.wap)("participants",null,n.map((e=>{let{type:t,ciphertext:r,participant:n}=e;return t===p.CiphertextType.Pkmsg&&(l=!0),(0,a.wap)("to",{jid:(0,S.DEVICE_JID)(n)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),"decrypt-fail":(0,a.CUSTOM_STRING)("hide"),type:(0,a.CUSTOM_STRING)(t)},r))}))));let c=null;if(u.GK.supportsFeature(u.GK.F.MD_ADV)&&l){const e=yield(0,o.getADVEncodedIdentity)();c=(0,a.wap)("device-identity",null,e)}return[i,c]}))).apply(this,arguments)}},92657:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.senderKeyQueueMap=void 0;const n=new(r(27870).PromiseQueueMap);t.senderKeyQueueMap=n},3922:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendSenderKeyMsg=function(){return w.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(46308),s=r(22683),l=r(58853),c=r(24747),d=r(43341),u=r(40316),p=r(99234),f=r(23712),_=r(7293),h=r(45033),g=r(90981),m=r(47124),y=n(r(11339)),E=r(76802),S=r(43201),v=r(53686),T=r(52083),C=r(10790),A=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=M(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),b=r(93650),P=r(39410);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(M=function(e){return e?r:t})(e)}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t,r,n){var i,s;const c=(0,E.encodeAndPad)(n),d=(0,l.mediaTypeFromProtobuf)(n),p=yield(0,f.getKeyDistributionMsg)(e,t,r);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startClientEncryptStage();const g=yield(0,u.encryptMsgSenderKey)(t,c);null===(s=e.wamMessageSendPerfReporter)||void 0===s||s.postClientEncryptStage();let m=null,y=!1;p&&p.length>0&&(m=(0,a.wap)("participants",null,p.map((e=>{let{type:t,ciphertext:r,participant:i}=e;return t===h.CiphertextType.Pkmsg&&(y=!0),(0,a.wap)("to",{jid:(0,P.DEVICE_JID)(i)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(t),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(n.reactionMessage)},r))}))));const S=(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(h.CiphertextType.Skmsg),mediatype:(0,l.encodeMaybeMediaType)(d),"decrypt-fail":(0,l.encodeMaybeDecryptFail)(n.reactionMessage)},g.ciphertext);let v=null;if(_.GK.supportsFeature(_.GK.F.MD_ADV)&&y){const e=yield(0,o.getADVEncodedIdentity)();v=(0,a.wap)("device-identity",null,e)}return[m,S,v]}))).apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t,r){var n;const{id:i,to:o}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: sending ${i}`;const{id:l}=i,{skDistribList:u,skList:f,rotateKey:_}=r;R(e);const h=f.concat(u),M=yield(0,v.phashV2)([...h,(0,p.assertGetMe)()]);yield(0,m.createOrMergeReceiptRecords)(h.map((e=>({msgKey:i,receiverId:e})))),_&&(yield A.Session.deleteGroupSenderKeyInfo(o));const[I,w,D]=yield O(e,o,u,t),N=(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(l),to:(0,P.CHAT_JID)(o),phash:(0,a.CUSTOM_STRING)(M),type:(0,b.typeAttributeFromProtobuf)(t),edit:(0,E.editAttribute)(t,e.subtype)},I,w,D);yield(0,E.updateIdentityRange)(i,h),yield(0,T.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.postReadyToSendStage();const L=yield(0,c.sendStanzaAndReturnAck)(N,{id:l,class:"message",from:o,participant:null}),k=E.sendMsgAckSyncParser.parse(L);if(k.error)return __LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"));yield(0,S.markHasSenderKey)(o,u);const{phash:G,count:U}=k.success;if(G&&G!==M){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: phash mismatch, got server phash ${G}`;const r=s.Clock.globalUnixTime();new y.default.MdDeviceSyncAck({chatType:y.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,E.isRevokeMsg)(t)}).commit(),(0,C.sendQueryGroup)(o).then((()=>{(0,d.resendGroupMsg)(e,t,h,r)}))}return null!=U&&(0,g.getTable)().merge(String(i),{count:U}),k.success}))).apply(this,arguments)}function R(e){var t;(0,p.markUserSentMessageToChat)(e.chat.id)&&(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.setMessageIsFirstUserMessage(!0))}},24659:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendRetry=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=n(r(41143)),o=r(24747),s=r(99094),l=r(6565);function c(){return(c=(0,i.default)((function*(e,t,r,n,i){const c=n.id.id;let d;__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: id ${c} to ${e.toString()}, requester: ${(t||e).toString()}, count: ${i}`,n.asMms&&(d=n.isUnsentPhoneMsg()?{type:n.type}:n.avParams());const u=(0,l.createMsgProtobuf)(n,d||{}),p={type:s.MsgType.Retry,retryCount:i};let f;return e.isUser()?f=yield(0,s.createUserDeviceMsgStanza)(e,r,n,u,p):((0,a.default)(null!=t,"[messaging] sendRetry: no participant for group retry message"),f=yield(0,s.createGroupDeviceMsgStanza)(e,t,n,u,p)),__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: sending ${c} to ${e.toString()}`,(0,o.sendStanzaAndWaitForAck)(f,{id:c,class:"message",from:e,participant:t})}))).apply(this,arguments)}},95547:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"encodeAndPad",{enumerable:!0,get:function(){return h.encodeAndPad}}),t.encryptAndSendKeyDistributionMsg=function(e){if(!e.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!e.remote)return Promise.reject(new Error("[messaging] sending message without an remote id"));if(e.remote.isGroup()){const t=new l.MessageSendPerfReporter(e.remote,c.default.MEDIA_TYPE.NONE,c.default.MESSAGE_TYPE.GROUP);return(0,u.encryptAndSendGroupKeyDistributionMsg)(e).then((()=>{t.setMessageIsInvisible(!0),t.postWrittenWireStage()}))}return Promise.reject(new Error("[messaging] unsupported remote jid type"))},t.encryptAndSendMsg=function(e){var t,r;const n=e.id,l=e.to;if(!n||!n.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!l)return Promise.reject(new Error("[messaging] sending message without an remote id"));s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e.type===i.MSG_TYPE.STICKER&&null==e.deprecatedMms3Url&&(e.deprecatedMms3Url=g);let c;if(e.asMms){const t=e.isUnsentPhoneMsg();c=t?{type:e.type}:e.avParams(),s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&e.type===i.MSG_TYPE.STICKER&&!t&&null==c.url&&(c.url=g)}const u=(0,o.createMsgProtobuf)(e,c||{});if(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.startWrittenWireStage(),null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startReadyToSendStage(),l.isUser()){const t=(0,f.encryptAndSendUserMsg)(e,u);return s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&(0,a.getABPropConfigValue)("trusted_contacts_sender")&&(0,p.sendTcToken)(l),t}if(l.isGroup())return(0,d.encryptAndSendGroupMsg)(e,u);return Promise.reject(new Error("[messaging] unsupported remote jid type"))},Object.defineProperty(t,"sendRetry",{enumerable:!0,get:function(){return _.sendRetry}});var i=r(15461),a=r(86945),o=r(6565),s=r(7293),l=r(30097),c=n(r(11339)),d=r(51974),u=r(95216),p=r(41088),f=r(68264),_=r(24659),h=r(76802);const g="https://whatsapp.net"},68264:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendUserMsg=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=n(r(70735)),o=r(10823),s=r(22683),l=r(24747),c=r(45325),d=r(16104),u=r(99234),p=n(r(11339)),f=r(76802),_=r(90298);function h(){return(h=(0,i.default)((function*(e,t){const{id:r,to:n}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: sending ${r}`;const i=(0,u.assertGetMe)(),a=yield(0,d.getFanOutList)({wids:[n,i]}),l=yield y(e,t,a,{fanoutType:c.FANOUT_TYPE.CHAT}),{phash:_}=l;if(_){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: phash mismatch, got server phash ${_}`;const r=s.Clock.globalUnixTime();new p.default.MdDeviceSyncAck({chatType:p.default.MESSAGE_CHAT_TYPE.INDIVIDUAL,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,o.syncDeviceListJob)([n,i],"message",_).then((()=>g(e,t,a,r)))}return l}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r,n){const{id:i,to:l}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending ${i.id}`;const h=(0,f.createResendAbortMetric)((0,f.isRevokeMsg)(t),Boolean(e.isViewOnce),e.to);if(s.Clock.globalUnixTime()-n>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending due to 5 min timeout`,h.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void h.commit();try{const n=(0,u.assertGetMe)(),i=yield(0,d.getFanOutList)({wids:[l,n]}),s=(0,a.default)(i,r,String);if(0===s.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending to the empty list`,h.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void h.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending to devices ${s.join(",")}`;const{phash:f}=yield y(e,t,s,{fanoutType:c.FANOUT_TYPE.CHAT,isResendingMsg:!0});f&&(0,o.syncDeviceListJob)([l,n],"message",f)}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resend got error ${e} `,h.messageSendResult=p.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,h.commit(),e}(0,_.logSuccessfulMessageSend)(h,e)}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r,n){var i;const{id:a,to:o}=e,s=yield(0,c.createFanoutMsgStanza)(e,t,r,n);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage();const d=yield(0,l.sendStanzaAndReturnAck)(s,{id:a.id,class:"message",from:o,participant:null}),u=f.sendMsgAckSyncParser.parse(d);if(u.error)throw new Error("[messaging] sendMsgToDeviceList: Invalid ack from server");return u.success}))).apply(this,arguments)}},93167:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,n.wap)("presence",{type:e,name:(0,n.MAYBE_CUSTOM_STRING)(a.Conn.pushname)}))};var n=r(31914),i=r(24747),a=r(17239)},34083:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const r=e.isUser()&&null!=t&&(0,i.getABPropConfigValue)("trusted_contacts");return(0,a.castStanza)((0,n.wap)("presence",{id:(0,n.generateId)(),to:(0,o.CHAT_JID)(e),type:"subscribe"},r?(0,n.wap)("tctoken",null,t):null))};var n=r(31914),i=r(86945),a=r(24747),o=r(39410)},66612:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=n(r(89867)),l=r(24747),c=r(39410),d=r(77591);const u=new o.WapParser("photoResponseParser",(e=>{if(e.assertAttr("type","result"),e.hasChild("picture")){return{id:e.child("picture").attrInt("id")}}return{id:null}}));function p(){return(p=(0,i.default)((function*(e,t){const r=yield(0,l.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,target:s.default.isGroup(e)?(0,c.CHAT_JID)(e):a.DROP_ATTR,type:"set",xmlns:"w:profile:picture",id:(0,a.generateId)()},t?(0,a.wap)("picture",{type:"image"},t):null),u);return r.success?{id:r.result.id}:Promise.reject(new d.ServerStatusCodeError(r.errorCode,r.errorText))}))).apply(this,arguments)}},80079:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=void 0,t.setPrivacyTokens=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(39410),c=r(77591);const d=new o.WapParser("setPrivacyTokensParser",(e=>({stanzaId:e.attrString("id")}))),u=r(76672)({TrustedContact:"trusted_contact"});function p(){return(p=(0,i.default)((function*(e,t,r){const n=t.map((t=>(0,a.wap)("token",{jid:(0,l.USER_JID)(e),t:(0,a.CUSTOM_STRING)(String(r)),type:(0,a.CUSTOM_STRING)(t)}))),i=yield(0,s.sendIq)((0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:(0,a.generateId)()},(0,a.wap)("tokens",null,n)),d);if(!i.success)throw new c.ServerStatusCodeError(i.errorCode,i.errorText)}))).apply(this,arguments)}t.TokenType=u},45723:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.castStanza)((0,n.wap)("presence",{name:(0,n.MAYBE_CUSTOM_STRING)(e)}))};var n=r(31914),i=r(24747)},35065:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(97197),o=r(92844),s=r(97245),l=r(24747),c=n(r(11339));function d(e){const{result:t,overallStartTime:r,retryStartTime:n,retryAttemptsLeft:i}=e,a=function(e){switch(e){case"success":return c.default.SIGN_CREDENTIAL_RESULT.SUCCESS;case"bad-request":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_BAD_REQUEST;case"internal-server-error":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_SERVER;case"disconnected":return c.default.SIGN_CREDENTIAL_RESULT.ERROR_CLIENT_NETWORK;default:return c.default.SIGN_CREDENTIAL_RESULT.ERROR_OTHER}}(t);new c.default.SignCredential({signCredentialResult:a,overallT:(0,o.monotonicTimeSince)(r),signCredentialT:(0,o.monotonicTimeSince)(n),retryCount:3-i,waConnectedToChatd:"disconnected"!==t,applicationState:"visible"===document.visibilityState?c.default.APPLICATION_STATE.FOREGROUND:c.default.APPLICATION_STATE.BACKGROUND}).commit()}const u=new a.Semaphore(1);function p(){return(p=(0,i.default)((function*(){const e=yield u.acquire();try{const{result:t,metric:r}=yield(0,s.getToken)(l.sendIqWithoutRetry);return null!=r&&d(r),t||__LOG__(3)`Couldn't get a private stats token`,t}finally{e.release()}}))).apply(this,arguments)}},13176:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747);const l=new o.WapParser("uploadStats",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`fieldStatsUpload: success`;const t=e.child("error"),r=t.attrInt("code"),n=t.attrString("text");return __LOG__(3)`fieldStatsUpload: sever response with ${r}, ${n}`,{errorCode:r,errorText:n}}));function c(){return(c=(0,i.default)((function*(e,t){const r=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",xmlns:"w:stats",id:(0,a.generateId)()},(0,a.wap)("add",{t:(0,a.INT)(t)},e));__LOG__(2)`fieldStatsUpload:sendIq start`;const n=yield(0,s.sendIq)(r,l);if(__LOG__(2)`fieldStatsUpload:sendIq end`,!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`fieldStatsUpload: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},66837:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getContactSyncRefreshSeconds=function(){var e;const t=null!==(e=(0,a.default)(c.default,"localStorage").getItem(p.KEYS.CONTACT_SYNC_REFRESH))&&void 0!==e?e:86400;return parseInt(t,10)},t.runSyncDirtyContactsJob=function(){(0,u.getShouldCheckContactSyncStatus)()&&setTimeout((function(){!function(){h.apply(this,arguments)}()}),6e4);(0,u.setShouldCheckContactSyncStatus)()},t.syncNewContact=function(e){_.push(e),f?f.debounce(1e3):(f=new o.ShiftTimer((()=>{if(!(0,u.isRegistered)())return;const e=_;_=[],f=null,__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start new contact sync for ${e.length} contacts`,(0,l.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0}).catch((e=>{__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}))})),f.onOrBefore(2e4))};var i=n(r(48926)),a=n(r(45095)),o=r(57319),s=r(45454),l=r(33192),c=n(r(92417)),d=r(76214),u=r(58052),p=r(72407);let f=null,_=[];function h(){return(h=(0,i.default)((function*(){const e=(yield(0,d.getContactTable)().equals(["isContactSyncCompleted"],0)).map((e=>(0,s.createWid)(e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync dirty contacts, found ${e.length} contacts to sync`,(0,l.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0})}))).apply(this,arguments)}},99684:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryTosState=function(){return d.apply(this,arguments)},t.resetTosState=function(){return u.apply(this,arguments)},t.updateTosState=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(77591);const c=new o.WapParser("tosNotices",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("tos"),r={refresh:t.attrInt("refresh"),notice:[]};return t.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),n=e.attrString("id");r.notice.push({id:n,state:t})})),(r.refresh>259200||r.refresh<7200)&&(r.refresh=86400),r}));function d(){return(d=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"get",to:a.S_WHATSAPP_NET},(0,a.wap)("request",null,e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)}))))),r=yield(0,s.sendIq)(t,c);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode,r.errorText)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=new o.WapParser("tosNoticesSet",(()=>{})),r=(0,a.wap)("iq",{xmlns:"tos",id:(0,a.generateId)(),type:"set",to:a.S_WHATSAPP_NET},(0,a.wap)("request",{type:"session_update"},e.map((e=>(0,a.wap)("notice",{id:(0,a.CUSTOM_STRING)(e)})))));yield(0,s.sendIq)(r,t)}))).apply(this,arguments)}},14892:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.unpairDevice=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(71914),s=r(24747),l=r(99234),c=r(39410);const d=new o.WapParser("unpairResponse",(e=>{e.assertTag("iq"),e.assertFromServer();let t=200;return"error"===e.attrString("type")&&(t=e.child("error").attrInt("code")),{status:t}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,type:"set",id:(0,a.generateId)(),xmlns:"md"},(0,a.wap)("remove-companion-device",{jid:(0,c.DEVICE_JID)((0,l.assertGetMe)()),reason:(0,a.CUSTOM_STRING)(e)})),r=yield(0,s.sendIq)(t,d);return r.success?{status:r.result.status}:{status:r.errorCode}}))).apply(this,arguments)}},46669:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadPreKeys=function(){const e=new a.PromiseRetryLoop({name:"uploadPreKeys",timer:g,code:e=>(0,i.default)((function*(){__LOG__(2)`uploadPreKeys: running`;!0===(yield function(){return h.apply(this,arguments)}()).success?e():__LOG__(2)`uploadPreKeys: retrying (after delay)`}))()});return e.start(),e.promise()};var i=n(r(48926)),a=r(72287),o=r(31914),s=r(71914),l=n(r(64369)),c=r(24747),d=r(58425),u=r(11849),p=r(91335);const f={error:!1,result:!0},_=new s.WapParser("uploadPreKeyResParser",(e=>{e.assertTag("iq"),e.assertFromServer();if(e.attrEnum("type",f))return{success:!0};const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.hasAttr("text")?t.attrString("text"):""}}));function h(){return(h=(0,i.default)((function*(){const[e,t]=yield Promise.all([u.waSignalStore.getRegistrationInfo(),u.waSignalStore.getSignedPreKey()]);if(!e||!t)throw new Error("No signal info is available");const{registrationId:r,identityKeyPair:n}=e,[i,a]=yield u.waSignalStore.getOrGenPreKeys(30,d.generatePreKeyPair).then((e=>{if(0===e.length)throw new Error("No preKey is available");return[(0,o.wap)("iq",{id:(0,o.generateId)(),xmlns:"encrypt",type:"set",to:o.S_WHATSAPP_NET},(0,o.wap)("registration",null,(0,o.BIG_ENDIAN_CONTENT)(r)),(0,o.wap)("type",null,l.default.KEY_BUNDLE_TYPE),(0,o.wap)("identity",null,n.pubKey),(0,o.wap)("list",null,e.map(p.xmppPreKey)),(0,p.xmppSignedPreKey)(t)),e[e.length-1].keyId]}));try{const e=yield(0,c.waitForConnection)().then((()=>u.waSignalStore.markKeyAsUploaded(a))).then((()=>(0,c.sendIqWithoutRetry)(i,_)));if(e.success)return u.waSignalStore.setServerHasPreKeys(!0),{success:!0};const t=e.errorCode;return t>=500?__LOG__(3)`_uploadPreKeys: server requested backoff ${t}`:406===t?__LOG__(3)`_uploadPreKeys: uploaded invalid keys`:__LOG__(3)`_uploadPreKeys: unrecognized error ${t}`,{errorCode:e.errorCode,errorText:e.errorText}}catch(e){return void __LOG__(3)`_uploadPreKeys: disconnected, unclear if on server`}}))).apply(this,arguments)}const g={algo:{type:"fibonacci",first:1e3,second:2e3},max:61e4}},15746:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._waitForMainStream=t._online=void 0,t.handleMessage=function(){return f.apply(this,arguments)},t.waitForOfflineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return p.chatQueue.wait(e);return p.allChatQueue.wait()},t.waitForOnlineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return u.chatQueue.wait(e);return u.allChatQueue.wait()};var i=n(r(48926)),a=r(27870),o=r(38284),s=r(88102),l=r(28237);const c=2e4,d=new Promise((e=>{s.Cmd.on("main_stream_mode_ready",(()=>{e()}))}));t._waitForMainStream=d;const u={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};t._online=u;const p={allChatQueue:new a.PromiseQueue,chatQueue:new a.PromiseQueueMap};function f(){return(f=(0,i.default)((function*(e,t,r){return t&&!l.OfflineMessageHandler.isResumeFromRestartComplete()?p.allChatQueue.enqueue((()=>p.chatQueue.enqueue(e,(()=>(0,o.promiseTimeout)(r(),c))))):(yield d,u.allChatQueue.enqueue((()=>u.chatQueue.enqueue(e,(()=>(0,o.promiseTimeout)(r(),c))))))}))).apply(this,arguments)}},26775:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return A.apply(this,arguments)};var i=n(r(48926)),a=r(52230),o=r(31914),s=n(r(64369)),l=n(r(89867)),c=r(45454),d=r(46308),u=r(58853),p=r(24747),f=r(7293),_=r(45033),h=r(97398),g=r(52083),m=r(95547),y=T(r(77605)),E=T(r(45473)),S=r(39410);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(v=function(e){return e?r:t})(e)}function T(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=v(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const{VOIP_LOG_COLOR:C}=s.default;function A(){return(A=(0,i.default)((function*(e,t){const r=e.common,n=(0,c.createWid)(r.peer_jid);if(l.default.isGroupCall(n))return b((0,o.CUSTOM_STRING)(r.peer_jid),n,e);try{return b(yield M(e,n,t),n,e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Failed to encrypt and send msg`}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r){const n=(0,S.voipXmlToWapNode)(r.payload),i=(0,o.generateId)(),a=(0,o.wap)("call",{to:e,id:i},n);yield(0,g.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const s=yield(0,p.sendStanzaAndReturnAck)(a,{id:String(i),class:"call",from:t,participant:null});return{payload:(0,S.wapNodeToVoipXml)(s),status:200}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,r){const n=e.payload[2].findIndex((e=>"destination"===e[0])),o=e.payload[2][n];if(o){e.payload[0]!==E.TYPE_STR.OFFER&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("call offer check"));const r=o[2].map((e=>(0,c.createDeviceWidFromUserAndDevice)(e[1].jid.user,e[1].jid.device)));try{yield(0,h.ensureE2ESessions)(r)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Could not establish E2E session with all deviceWids`}let n=!1,a=!1;return yield Promise.all(o[2].map(function(){var t=(0,i.default)((function*(t,i){if(I(t[2])){const o=N(t[2]),s=r[i];try{const{encNode:r,shouldHaveIdentity:n}=yield L(o,s,D(e.payload[2]));a=a||n,R(t[2],r)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Signal encryption failed for ${s.toString()}, ${e}`,n=!0}}}));return function(){return t.apply(this,arguments)}}())),n?(__LOG__(3)`voip:encryptMsgCallKey: Removing all enc nodes due to encryption failure`,o[2].forEach((e=>w(e)))):a&&(yield G(e.payload[2])),(0,S.USER_JID)(t)}if(!I(e.payload[2]))return(0,S.DEVICE_JID)(t);try{const e=[t];if(t.isCompanion()){const r=(0,c.createDeviceWidFromUserAndDevice)(t.user,a.DEFAULT_DEVICE_ID);e.unshift(r)}yield(0,h.ensureE2ESessions)(e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Could not establish E2E session with deviceWid`}const s=N(e.payload[2]);let l,d;try{const r=yield L(s,t,D(e.payload[2]));l=r.encNode,d=r.shouldHaveIdentity}catch(e){if(r!==E.TYPE.OFFER)throw e;l=null,d=!1,__LOG__(3)`voip:encryptAndSendSignalingMsg: Sending offer without enc`}return R(e.payload[2],l),d&&(yield G(e.payload[2])),(0,S.DEVICE_JID)(t)}))).apply(this,arguments)}function I(e){if(null==e)return!1;return e.findIndex((e=>"enc"===e[0]))>=0}function w(e){if(null==e)return;const t=e.findIndex((e=>"enc"===e[0]));e.splice(t,1)}function R(e,t){const r=e.findIndex((e=>"enc"===e[0]));r>=0&&(e[r]=t)}function D(e){var t;const r=e.find((e=>"enc"===e[0])),n=null==r||null===(t=r[1])||void 0===t?void 0:t.count;return null!=n?n:0}function N(e){const t=e.find((e=>"enc"===e[0])),r=null==t?void 0:t[2];return{call:{callKey:new Uint8Array(r)}}}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t,r){const{type:n,ciphertext:i}=yield y.Cipher.encryptSignalProto(t,(0,m.encodeAndPad)(e));return{encNode:(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString()),type:(0,o.CUSTOM_STRING)(n),count:(0,o.INT)(r)},i),shouldHaveIdentity:n===_.CiphertextType.Pkmsg}}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){if(f.GK.supportsFeature(f.GK.F.MD_ADV)){const t=yield(0,d.getADVEncodedIdentity)();e.push((0,o.wap)("device-identity",null,t))}}))).apply(this,arguments)}},77723:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(55253),o=r(11849);function s(){return(s=(0,i.default)((function*(e){var t;const r=yield o.waSignalStore.getRegistrationInfo();if(!r)throw Error("No registration info found");const{identityKeyPair:n}=r,i=null!==(t=e[1]&&parseInt(e[1].count,10))&&void 0!==t?t:0,s=yield(0,a.prepareKeysForRetry)(i,n);return s&&e[2]&&Array.isArray(e[2])&&e[2].push(s),e}))).apply(this,arguments)}},25662:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(45454),s=r(24747),l=r(97398),c=r(39410);function d(){return(d=(0,i.default)((function*(e){const t=e.common,r=(0,o.createWid)(t.peer_jid);let n,i;r.isGroupCall()?(n=(0,c.GROUP_CALL_JID)(r),i=Promise.resolve()):(n=(0,c.DEVICE_JID)(r),i=(0,l.ensureE2ESessions)([r])),yield i;const d=(0,c.voipXmlToWapNode)(e.payload),u=(0,a.generateId)(),p=(0,a.wap)("call",{to:n,id:u},d),f=yield(0,s.sendStanzaAndReturnAck)(p,{id:String(u),class:"call",from:r,participant:null});return{payload:(0,c.wapNodeToVoipXml)(f),status:200}}))).apply(this,arguments)}},64254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(31914),o=r(24747),s=r(11849),l=r(45473),c=r(39410);function d(){return(d=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=yield s.waSignalStore.getRegistrationInfo();if(!n)throw Error("No registration info found");const i=(0,a.wap)("receipt",{to:(0,c.DEVICE_JID)(t.peer_jid),id:(0,a.CUSTOM_STRING)(e),type:(0,a.CUSTOM_STRING)(l.ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},(0,a.wap)("enc_rekey",{"call-creator":(0,c.DEVICE_JID)(t.call_creator),"call-id":(0,a.CUSTOM_STRING)(t.call_id),count:(0,a.INT)(r+1)}),(0,a.wap)("registration",null,(0,a.BIG_ENDIAN_CONTENT)(n.registrationId)));(0,o.castStanza)(i)}))).apply(this,arguments)}},84590:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=r(50796),o=r(52230),s=n(r(45095)),l=r(84902),c=n(r(41143)),d=r(46308),u=r(24808),p=r(8001),f=r(49714),_=r(45033),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(77605)),g=r(93832);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function y(){return(y=(0,i.default)((function*(e,t){var r;const n=t.payload[2]&&t.payload[2].find((e=>"enc"===e[0])),i=e.peer_jid;if(!n||!i)return{result:f.E2EProcessResult.SUCCESS};let a=0;(null===(r=n[1])||void 0===r?void 0:r.count)&&(a=parseInt(n[1].count,10)||0);const l={e2eType:n[1].type,mediaType:null,ciphertext:new Uint8Array(n[2]),retryCount:a,hideFail:!1};try{const e=t.payload[2].find((e=>"device-identity"===e[0]));if(null!=i.device&&i.device!==o.DEFAULT_DEVICE_ID&&l.e2eType===_.CiphertextType.Pkmsg&&!e)return __LOG__(2)`voip:validateAndDecryptEnc: expected device-identity with pkmsg enc`,{result:f.E2EProcessResult.PARSE_ERROR};if(e){const t=new Uint8Array(e[2]);if(!(yield(0,d.validateADVwithEncs)(i,t,[l])))return{result:f.E2EProcessResult.PARSE_ERROR};__LOG__(2)`voip:validateAndDecryptEnc: successfully validated ADV device-identity`}const{result:r,decrypted:c}=yield E(l,i);return r===f.E2EProcessResult.SUCCESS&&(n[2]=Array.prototype.slice.call(new Uint8Array((0,s.default)(c,"decrypted")))),{result:r,retryCount:a}}catch(e){return __LOG__(3)`voip:validateAndDecryptEnc error`,{result:f.E2EProcessResult.PARSE_ERROR}}}))).apply(this,arguments)}function E(e,t){return(0,c.default)(e.e2eType!==_.CiphertextType.Skmsg,"VoIP enc type should not be skmsg"),h.Cipher.decryptSignalProto(t,e.e2eType,e.ciphertext).then((e=>{var t;const r=(0,g.unpad)(e),n=(0,l.decodeProtobuf)(u.MessageSpec,r);return(null===(t=n.call)||void 0===t?void 0:t.callKey)?{result:f.E2EProcessResult.SUCCESS,decrypted:n.call.callKey}:{result:f.E2EProcessResult.PARSE_ERROR}})).catch((0,a.filteredCatch)(p.SignalDecryptionError,(e=>(__LOG__(3)`voip:decryptSignalProto failed with decryption error; ${e}`,{result:f.E2EProcessResult.RETRY})))).catch((e=>(__LOG__(3)`voip:decryptSignalProto failed with unexpected error; ${e}`,{result:f.E2EProcessResult.PARSE_ERROR})))}},4182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=t.CONTACT_SYNC_CHUNK_SIZE=void 0;t.CONTACT_SYNC_CHUNK_SIZE=500;t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=20},33192:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactList=b,t.syncContactListInChunks=function(){return A.apply(this,arguments)};var i=n(r(48926)),a=n(r(45095)),o=r(13959),s=r(92844),l=r(72441),c=r(45454),d=r(4182),u=r(91036),p=r(9108),f=r(53379),_=r(54181),h=r(10435),g=n(r(92417)),m=r(76214),y=r(53686),E=r(72407),S=r(46133),v=r(79942),T=r(52284),C=r(92027);function A(){return(A=(0,i.default)((function*(e){let{contactIds:t,shouldDelayBetweenChunks:r}=e;const n=d.CONTACT_SYNC_CHUNK_SIZE;__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${t.length} contacts in ${Math.ceil(t.length/n)} chunks, each chunk size: ${n}`;for(let e=0;e<t.length;e+=n){const i=t.slice(e,e+n);r&&(yield(0,o.delayMs)(1e3*d.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS)),yield b({contactIds:i,shouldSyncDevice:!0})}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){let{contactIds:t,shouldSyncDevice:r}=e;if(0===t.length)return;const n=yield G(t),i=(new T.USyncQuery).withContext("background").withMode("full").withBusinessProtocol().withStatusProtocol().withPictureProtocol();r&&i.withDeviceProtocol(),(0,h.isDisappearingModeEnabled)()&&i.withDisappearingModeProtocol(),n.forEach((e=>{i.withUser((new v.USyncUser).withId(e.id).withDeviceHash(String(e.hash)))}));let a=null,s=3,l=10*Math.random();for(;s-- >0;)try{a=yield i.execute();const e=a.error.all;var c;if(e)throw l=null!==(c=e.errorBackoff)&&void 0!==c?c:10*Math.random(),new Error(`syncContactList: error ${e.errorCode}: ${e.errorText}`);s=0}catch(e){0===s&&(__LOG__(4,!0,new Error,!0)`failed to execute usync query`,SEND_LOGS("failed to execute usync query: "+e)),yield(0,o.delayMs)(1e3*l)}if(null==a||a.error.all)return;const d=a.refresh,u=[];for(const e of Object.keys(d))u.push(d[e]);if(u.length>0){F(Math.min(...u))}yield Promise.all([r?L(a):Promise.resolve(),(0,h.isDisappearingModeEnabled)()?O(a):Promise.resolve(),M(a),w(a),D(a)]),yield N(t)}))).apply(this,arguments)}function M(e){const t=e.error.status;t?__LOG__(3)`handleSyncStatus: failed ${t.errorCode} : ${t.errorText}`:e.list.map((e=>{const t=S.StatusCollection.get(e.id);t&&e.status&&t.set({status:e.status})}))}function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){const t=e.error.status;t?__LOG__(3)`handleDisappearingMode: failed ${t.errorCode} : ${t.errorText}`:yield Promise.all(e.list.map(function(){var e=(0,i.default)((function*(e){e.disappearing_mode&&(yield(0,u.updateDisappearingMode)(e.id,e.disappearing_mode.duration,e.disappearing_mode.t))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=e.list.filter((e=>{let{business:t}=e;return Boolean(t)}));yield(0,C.handleVerifiedNameSync)(t.map((e=>{let{id:t,business:{verifiedName:r}}=e;return{id:t,verifiedName:r}})))}))).apply(this,arguments)}function D(e){const t=e.error.pictures;t&&__LOG__(3)`handleSyncProfilePictures: failed ${t.errorCode} : ${t.errorText}`}function N(e){const t=e.map((e=>({id:(0,l.toPhoneUserJid)(e.user),isContactSyncCompleted:1})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${t.length} contacts completed for contact sync`,(0,m.getContactTable)().bulkCreateOrMerge(t)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e){const t=e.error.devices;t&&__LOG__(3)`handleSyncDevice: error ${t.errorCode}: ${t.errorText}`;const r=e.list.filter((e=>e.devices&&null!=e.devices.deviceList&&null!=e.devices.keyIndex&&!("errorCode"in e.devices))).map((e=>({wid:e.id,devices:e.devices})));return __LOG__(2)`handleSyncDevice: skipping ${e.list.length-r.length} out of ${e.list.length} records`,yield(0,f.getAndStoreIdentityKeys)(r.map((e=>e.wid))),(0,_.handleADVDeviceSyncResult)(r)}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e){const t=e.map((e=>e.user)),r=(yield(0,p.getDeviceIds)(t)).map((e=>e?e.devices.map((t=>(0,c.createDeviceWidFromUserAndDevice)(e.id,t))):[])),n=yield Promise.all(r.map((e=>0===e.length?"":(0,y.phashV2)(e))));return e.map(((e,t)=>({id:e,hash:n[t]})))}))).apply(this,arguments)}function F(e){Number.isNaN(e)||e<=s.HOUR_SECONDS?__LOG__(3,void 0,void 0,void 0,["contact-sync"])`invalid contact sync refresh period: ${e}`:(__LOG__(2,void 0,void 0,void 0,["contact-sync"])`set contact sync refresh period: ${e}`,(0,a.default)(g.default,"localStorage").setItem(E.KEYS.CONTACT_SYNC_REFRESH,String(e)))}},60764:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_ALERT_TYPE=void 0;const n=r(76672)({LOW_QUOTA_EXCEEDED:"low_quota_exceed",HIGH_QUOTA_EXCEEDED:"high_quota_exceed",NO_ALERT:"no_alert"});t.STORAGE_ALERT_TYPE=n},46920:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_PARTICIPANT_TYPES=void 0;t.GROUP_PARTICIPANT_TYPES={superadmin:"superadmin",admin:"admin",participant:"participant"}},18615:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipants=function(){return u.apply(this,arguments)},t.demoteParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.DEMOTE,t,r,n,i)},t.participantsAction=p,t.promoteParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.PROMOTE,t,r,n,i)},t.removeParticipants=function(e){let{group:t,participants:r,version:n,prevVersion:i}=e;return p(l.PARTICIPANT_OPERATION.REMOVE,t,r,n,i)},t.updateParticipants=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(64114),s=r(51727),l=r(70405),c=r(97153);function d(){return(d=(0,i.default)((function*(e){let{group:t,participants:r,version:n,isOffline:i}=e;const a=[],o=[];r.forEach((e=>{e.isAdmin&&o.push(e.id),a.push(e.id)}));const l=yield f(a,i);return(0,s.replaceParticipants)({group:t,participants:a,admins:o,deviceIds:l,version:n})}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){let{group:t,participants:r,version:n,prevVersion:i,isOffline:a}=e;if(null==n)throw new Error("addParticipants: incoming change missing version id");const o=yield f(r,a);return(0,s.updateParticipants)(t,{action:l.PARTICIPANT_OPERATION.ADD,participants:r,deviceIds:o,version:n,prevVersion:i})}))).apply(this,arguments)}function p(e,t,r,n,i){return null==n?Promise.reject(new Error(`participantsAction with action = ${e}: incoming change missing version id`)):(0,s.updateParticipants)(t,{action:e,participants:r,version:n,prevVersion:i})}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){let r=[];if(t)return yield(0,c.addUserToPendingDeviceSync)(e.map((e=>String(e)))),e;r=yield(0,o.syncAndGetDeviceList)(e);let n=[];return r.forEach(((t,r)=>{if(t){const{devices:e,id:r}=t;n=n.concat(e.map((e=>(0,a.createDeviceWidFromUserAndDevice)(r,e))))}else n.push(e[r])})),n}))).apply(this,arguments)}},2182:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDescription=_,t.extractLinkedParent=h,t.parseGroupNode=g,t.queryGroup=function(){return y.apply(this,arguments)};var i=n(r(48926)),a=n(r(81109)),o=r(31914),s=r(71914),l=r(81663),c=r(45454),d=r(24747),u=r(46920),p=r(39410),f=r(77591);function _(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent()){const r={desc:e.contentString(),descId:t.attrString("id")};return t.hasAttr("participant")&&(r.descOwner=(0,l.userJidToUserWid)(t.attrPhoneUserJid("participant"))),t.hasAttr("t")&&(r.descTime=t.attrTime("t")),r}}}return null}function h(e){const t=e.maybeChild("linked_parent"),r=null==t?void 0:t.maybeAttrGroupJid("jid");return null==r?null:{parentGroup:(0,l.groupJidToWid)(r)}}function g(e){var t,r,n;const i=_(e),o=function(e){const t={subject:e.attrString("subject")};return e.hasAttr("s_o")&&(t.subjectOwner=(0,l.userJidToUserWid)(e.attrPhoneUserJid("s_o"))),e.hasAttr("s_t")&&(t.subjectTime=e.attrTime("s_t")),t}(e),s=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(e),d=function(e){const t=e.maybeChild("growth_locked"),r=null==t?void 0:t.maybeAttrInt("expiration"),n=null==t?void 0:t.maybeAttrString("type");return null==r||null==n?null:{growthLockExpiration:r,growthLockType:n}}(e),p=h(e);let f;try{f=(0,c.createWid)(`${e.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=f)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");const g=e.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",u.GROUP_PARTICIPANT_TYPES,u.GROUP_PARTICIPANT_TYPES.participant);return{id:(0,l.userJidToUserWid)(e.attrPhoneUserJid("jid")),isSuperAdmin:t===u.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===u.GROUP_PARTICIPANT_TYPES.admin||t===u.GROUP_PARTICIPANT_TYPES.superadmin}})),m={id:f,owner:e.hasAttr("creator")?(0,l.userJidToUserWid)(e.attrPhoneUserJid("creator")):void 0,creation:e.attrTime("creation"),restrict:e.hasChild("locked"),announce:e.hasChild("announcement"),noFrequentlyForwarded:e.hasChild("no_frequently_forwarded"),participants:g,pvId:e.hasAttr("p_v_id")?e.attrInt("p_v_id"):void 0,support:e.hasChild("support"),size:e.hasAttr("size")?e.attrInt("size"):void 0,suspended:e.hasChild("suspended"),parent:null!==(r=e.hasChild("parent"))&&void 0!==r?r:void 0,defaultSubgroup:null!==(n=e.hasChild("default_sub_group"))&&void 0!==n?n:void 0};return(0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)({},m),i),s),d),o),p)}const m=new s.WapParser("queryGroupParser",(e=>e.hasChild("group")?g(e.child("group")):{phashMatch:!0}));function y(){return(y=(0,i.default)((function*(e){const{groupWid:t,request:r,phash:n}=e,i=(0,o.wap)("iq",{to:(0,p.GROUP_JID)(t),type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("query",{request:r||o.DROP_ATTR,phash:(0,o.MAYBE_CUSTOM_STRING)(n)})),a=yield(0,d.sendIq)(i,m);if(!a.success)return __LOG__(2)`queryGroup failed: ${a.errorCode}:${a.errorType}`,Promise.reject(new f.ServerStatusCodeError(a.errorCode,a.errorText));const{result:s}=a;return s.phashMatch?Promise.reject(new Error("queryGroup: phash match case is not implemented!")):s}))).apply(this,arguments)}},46308:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearADVSecretKey=function(){(0,y.setADVSecretKey)(void 0)},t.generateADVSecretKey=function(){const e=new Uint8Array(32);self.crypto.getRandomValues(e);const t=(0,a.encodeB64)(e);return(0,y.setADVSecretKey)(t),t},t.generateDeviceSignature=function(e,t,r){const n=e.details,i=o.Binary.build(O,n,t.pubKey,r).readByteArray().buffer;return window.libsignal.Curve.calculateSignature(t.privKey,i)},t.getADVEncodedIdentity=function(){return w.apply(this,arguments)},t.getADVSecretKey=function(){const e=(0,y.getADVSecretKey)();if(null==e)throw new Error("MD secretKey is null or undefined");return e},t.setADVSignedIdentity=function(e){if(null==e)return Promise.reject(new Error("MD advSignedDeviceIdentity is null or undefined"));if(null==e.deviceSignature)return Promise.reject(new Error("MD advSignedDeviceIdentity is missing deviceSignature"));return v.waSignalStore.putADVSignedIdentity(e)},t.validateADVwithEncs=function(){return P.apply(this,arguments)},t.validateADVwithIdentityKey=A,t.verifyDeviceIdentityAccountSignature=R,t.verifyDeviceSignature=D,t.verifyKeyIndexListAccountSignature=function(e,t){const r=e.details,n=e.accountSignature;(0,d.default)(null!=n,"accountSignature should not be null");const i=o.Binary.build(I,r).readByteArray();return(0,f.verifySignature)(new Uint8Array(t),i,new Uint8Array(n))};var i=n(r(48926)),a=r(15688),o=r(8584),s=r(45454),l=r(84902),c=r(60980),d=n(r(41143)),u=r(61438),p=r(11365),f=r(5087),_=r(7293),h=r(57701),g=r(54181),m=r(45033),y=r(58052),E=n(r(76128)),S=r(52083),v=r(11849),T=r(91335),C=r(93832);function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!_.GK.supportsFeature(_.GK.F.MD_ADV))return!0;try{const i=(0,p.uint8ArrayToBuffer)(r),a=yield(0,S.getSignalProtocolStore)().loadIdentityKey((0,C.createSignalAddress)(e).toString());if(a){const e=(0,f.toCurveKeyPubKey)((0,C.strToBuffer)(a));if((0,C.bufferEqual)(e,i))return!0}const o=(0,l.decodeProtobuf)(u.ADVSignedDeviceIdentitySpec,t);(0,d.default)(null!=o,"advSignedDeviceIdentity should not be null");const c=yield E.default.loadIdentityKey((0,C.createSignalAddress)((0,s.toUserWid)(e)).toString()),_=c?(0,f.toCurveKeyPubKey)((0,C.strToBuffer)(c)):null;if(!R(o,i,_))return __LOG__(3)`validateADVIdentity: invalid account signature`,!1;if(!D(o,i,_))return __LOG__(3)`validateADVIdentity: invalid device signature`,!1;const h=(0,l.decodeProtobuf)(u.ADVDeviceIdentitySpec,o.details);(0,d.default)(null!=h,"advDeviceIdentity should not be null");try{yield(0,g.handleADVDeviceUpdateForMessage)(e,h,_,o.accountSignatureKey,i,n)}catch(e){return __LOG__(3)`validateADVIdentity: process adv device identity failed`,!1}return __LOG__(2)`validateADVIdentity: successfully verified accountSignature and deviceSignature`,!0}catch(e){return __LOG__(3)`validateADVIdentity: failed`,!1}}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!_.GK.supportsFeature(_.GK.F.MD_ADV))return!0;const i=r.find((e=>e.e2eType===m.CiphertextType.Pkmsg));if(!i)return!0;__LOG__(2)`validateADVwithEncs: start validate prekey msg `;try{(0,d.default)(null!=e,"author should not be null");const r=(0,T.extractIdentityKey)(i.ciphertext);(0,d.default)(null!=r,"identityKey should not be null");const a=yield A(e,t,new Uint8Array(r),n);return(0,h.identityStoreCacheEnabled)()&&(yield(0,S.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode()),a}catch(e){return __LOG__(3)`validateADVwithEncs: failed ${e}`,!1}}))).apply(this,arguments)}const M=new Uint8Array([6,0]),O=new Uint8Array([6,1]),I=new Uint8Array([6,2]);function w(){return(w=(0,i.default)((function*(){const e=yield v.waSignalStore.getADVSignedIdentity();if(null==e)throw new Error("MD advSignedDeviceIdentity is null or undefined");if(null==e.deviceSignature)throw new Error("MD advSignedDeviceIdentity is missing deviceSignature");return(0,c.encodeProtobuf)(u.ADVSignedDeviceIdentitySpec,e).readByteArray()}))).apply(this,arguments)}function R(e,t,r){const n=e.details,i=e.accountSignatureKey||r;(0,d.default)(null!=i,"accountSignatureKey should not be null");const a=e.accountSignature;(0,d.default)(null!=a,"accountSignature should not be null");const s=o.Binary.build(M,n,t).readByteArray();return(0,f.verifySignature)(new Uint8Array(i),s,new Uint8Array(a))}function D(e,t,r){const n=e.details,i=e.deviceSignature;(0,d.default)(null!=i,"deviceSignature should not be null");const a=e.accountSignatureKey||r;(0,d.default)(null!=a,"accountSignatureKey should not be null");const s=o.Binary.build(O,n,t,a).readByteArray();return(0,f.verifySignature)(new Uint8Array(t),s,new Uint8Array(i))}},18634:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeIdentityHash=y,t.getICDCMeta=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(73045),o=r(52230),s=n(r(45095)),l=r(27764),c=r(92844),d=r(45454),u=r(86945),p=r(5087),f=r(9108),_=r(99234),h=n(r(76128)),g=r(56592);function m(){return(m=(0,i.default)((function*(e){if(!1===(0,u.getABPropConfigValue)("md_icdc_enabled"))return null;const t=yield(0,f.getDeviceRecord)(e.user);if(!t||t.deleted)return null;const r={keyHash:void 0,timestamp:void 0},{timestamp:n,devices:i}=t,a=i.some((e=>e.id!==o.DEFAULT_DEVICE_ID));if(a){const n=i.map((e=>[e.keyIndex,(0,d.createDeviceWidFromUserAndDevice)(t.id,e.id)])),a=[],o=(0,_.assertGetMe)();let l=null;n.forEach((e=>{let[t,r]=e;r.equals(o)?l=t:a.push([t,r])}));const c=yield(0,g.getAllIdentityKeysBytes)(a.map((e=>{let[,t]=e;return t}))),u=[],f=[];if(c.forEach(((e,t)=>{null!=e&&(u.push(e),f.push(a[t][0]))})),o.user===e.user){const e=yield h.default.getIdentityKeyPair();if(!e)return null;u.push(new Uint8Array(e.pubKey)),f.push((0,s.default)(l,"myKeyIndex"))}const m=S();r.keyHash=yield y(u.map((e=>new Uint8Array((0,p.toCurveKeyPubKey)(e.buffer)))),m),f.length!==i.length&&(r.keyIndexes=f)}return(a||v(n))&&(r.timestamp=n),r}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const r=(0,g.identityKeysToBinary)(e),n=yield(0,a.sha256)(r),i=new Uint8Array(n);return(0,l.sliceBytes)(i,0,t)}))).apply(this,arguments)}function S(){const e=(0,u.getABPropConfigValue)("md_icdc_hash_length");return Math.max(e,8)}function v(e){return(0,c.unixTime)()-e<2592e3}},56592:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllIdentityKeysBytes=d,t.getAllIdentityKeysBytesOrThrow=function(){return c.apply(this,arguments)},t.identityKeysToBinary=function(e){const t=new a.Binary;return e.sort(l).forEach((e=>{t.writeByteArray(e)})),t.readByteArray()};var i=n(r(48926)),a=r(8584),o=n(r(76128)),s=r(93832);function l(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return e[r]-t[r];return e.length-t.length}function c(){return(c=(0,i.default)((function*(e){return(yield d(e)).map(((t,r)=>{if(null==t)throw new Error(`getAllIdentityKeys: missing identity key for device ${String(e[r])}`);return t}))}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){return(yield o.default.bulkLoadIdentityKey(e.map((e=>(0,s.createSignalAddress)(e).toString())))).map((e=>null==e?null:new Uint8Array((0,s.strToBuffer)(e))))}))).apply(this,arguments)}},76802:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.RESEND_TIMEOUT_IN_SECONDS=void 0,t.createResendAbortMetric=function(e,t,r){const n=(0,i.default)({e2eBackfill:!0,messageIsRevoke:e,messageSendResultIsTerminal:!1,isViewOnce:t},(0,g.getGroupMetricsFromChatWid)(r));return new E.default.MessageSend(n)},t.editAttribute=function(e,t){if(T(e)){const e="admin_revoke"===t?c.EDIT_ATTR.ADMIN_REVOKE:c.EDIT_ATTR.SENDER_REVOKE;return(0,s.CUSTOM_STRING)(String(e))}if(C(e))return(0,s.CUSTOM_STRING)(String(c.EDIT_ATTR.SENDER_REVOKE));return s.DROP_ATTR},t.encodeAndPad=function(e){const t=(0,p.encodeProtobuf)(f.MessageSpec,e);return(0,v.writeRandomPadMax16)(t),t.readByteArray()},t.filterDeviceWithChangedIdentity=function(){return M.apply(this,arguments)},t.isPrimaryDevice=function(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID},t.isRevokeMsg=T,t.isRevokeReactionMsg=C,t.populateICDCMeta=function(){return b.apply(this,arguments)},t.sendMsgAckSyncParser=void 0,t.updateIdentityRange=function(){return P.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(52230),s=r(31914),l=r(71914),c=r(35470),d=r(67811),u=r(45454),p=r(60980),f=r(24808),_=r(99234),h=r(6565),g=r(42515),m=r(18634),y=r(90981),E=n(r(11339)),S=n(r(76128)),v=r(93832);function T(e){return null!=e.protocolMessage&&e.protocolMessage.type===f.Message$ProtocolMessageType.REVOKE}function C(e){return null!=e.reactionMessage&&e.reactionMessage.text===d.REVOKED_REACTION_TEXT}t.RESEND_TIMEOUT_IN_SECONDS=300;const A=new l.WapParser("sendMsgAckSyncParser",(e=>(e.assertTag("ack"),{t:e.attrTime("t"),sync:e.hasAttr("sync")?e.attrString("sync"):null,phash:e.hasAttr("phash")?e.attrString("phash"):null,count:e.hasAttr("count")?e.attrInt("count"):null})));function b(){return(b=(0,a.default)((function*(e,t){const r=(0,_.getMeUser)();let n,i;try{n=yield(0,m.getICDCMeta)(r)}catch(e){throw new E.default.AdvMetadataCreationFailure({advMetadataIsMe:!0}).commit(),e}try{i=e.equals(r)?null:yield(0,m.getICDCMeta)(e)}catch(e){throw new E.default.AdvMetadataCreationFailure({advMetadataIsMe:!1}).commit(),e}(0,h.populateMessageContextInfo)(t,n,i)}))).apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t){const r=yield(0,y.getTable)().get(String(e),!1);null!=(null==r?void 0:r.rowId)&&(yield S.default.updateIdentityRangeAfterEncryption(r.rowId,t.map((e=>(0,v.createSignalAddress)(e).toString()))))}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t){const r=yield(0,y.getTable)().get(String(e),!1),n=null==r?void 0:r.rowId;if(null==n)return __LOG__(2)`filterDeviceWithChangedIdentity: get message with empty rowId`,[];const i=new Set;t.forEach((e=>{i.add(e.user)}));const a=Array.from(i).map((e=>(0,u.createDeviceWidFromUserAndDevice)(e,o.DEFAULT_DEVICE_ID))),s=yield S.default.bulkGetIdentityRowId(a.map((e=>(0,v.createSignalAddress)(e).toString()))),l=new Set;return s.forEach(((e,t)=>{const r=a[t];(null==e||e>n)&&l.add(r.user)})),t.filter((e=>!l.has(e.user)))}))).apply(this,arguments)}t.sendMsgAckSyncParser=A},64114:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncAndGetDeviceList=function(){return S.apply(this,arguments)},t.syncDeviceList=h,t.syncMyDeviceList=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=n(r(94654)),o=r(45454),s=r(9108),l=r(99234),c=r(53379),d=r(54181),u=r(53686),p=r(79942),f=r(52284);const _=new Map;function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let{wids:t,context:r,phash:n}=e;if(null!=n){const e=t.map((e=>e.user)),r=(yield(0,s.getDeviceIds)(e)).map((e=>e?e.devices.map((t=>(0,o.createDeviceWidFromUserAndDevice)(e.id,t))):[])),i=(0,a.default)(r,(e=>e));if(n===(yield(0,u.phashV2)(i)))return}const i=new Set,l=[];if(t.forEach((e=>{const t=_.get(e.user);t?i.add(t):l.push(e)})),0===l.length)return void(yield Promise.all(Array.from(i)));const c=m(l.map((e=>e.user)),l,r);l.map((e=>{_.set(e.user,c)})),yield Promise.all([c,...Array.from(i)])}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,r){try{const n=yield(0,s.getDeviceInfoForSync)(e),i=n.map((e=>e?e.devices.map((t=>(0,o.createDeviceWidFromUserAndDevice)(e.id,t))):[])),a=yield Promise.all(i.map((e=>0===e.length?"":(0,u.phashV2)(e))));return v(t.map(((e,t)=>{var r,i;return{id:e,hash:a[t],ts:null===(r=n[t])||void 0===r?void 0:r.timestamp,expectedTs:null===(i=n[t])||void 0===i?void 0:i.expectedTs}})),r)}catch(e){__LOG__(4,void 0,new Error)`Failed to sync device list with error: ${e}`}finally{t.map((e=>{_.delete(e.user)}))}}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){yield h({wids:[(0,l.getMeUser)()],context:null,phash:null})}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=e.map((e=>e.user));return yield h({wids:e,context:null,phash:null}),(0,s.getDeviceIds)(t)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(0===e.length)return;const r=(new f.USyncQuery).withContext(t||"interactive").withDeviceProtocol();e.forEach((e=>{0!==e.id.user&&r.withUser((new p.USyncUser).withId(e.id).withDeviceHash(String(e.hash)).withTs(e.ts).withExpectedTs(e.expectedTs))}));const n=yield r.execute();if(n.error.all)throw new Error(`syncDeviceList: error ${n.error.all.errorCode}: ${n.error.all.errorText}`);n.error.devices&&__LOG__(3)`syncDeviceList: error ${n.error.devices.errorCode}: ${n.error.devices.errorText}`;let i=n.list.filter((e=>!("errorCode"in e.devices)));i=i.map((e=>({wid:e.id,devices:e.devices})));const a=i.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})).map((e=>e.wid));return __LOG__(2)`syncDeviceList: skipping ${n.list.length-a.length} out of ${n.list.length} records`,yield(0,c.getAndStoreIdentityKeys)(a),(0,d.handleADVDeviceSyncResult)(i)}))).apply(this,arguments)}},37039:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBuildHash=g,t.getClientPayloadForLogin=function(e){const t=(0,d.assertGetMe)(),r=(0,i.default)((0,i.default)({},h(e)),{},{username:parseInt(t.user,10),device:null!=t.device?t.device:0});return(0,o.encodeProtobuf)(f.ClientPayloadSpec,r).readByteArray()},t.getClientPayloadForRegistration=function(e,t,r){const n=g(),a=m(),s=(0,i.default)((0,i.default)({},h(r)),{},{regData:{buildHash:n,companionProps:a,eRegid:(0,l.intToBytes)(4,e.registrationId),eKeytype:(0,l.intToBytes)(1,5),eIdent:e.identityKeyPair.pubKey,eSkeyId:(0,l.intToBytes)(3,t.keyId),eSkeyVal:t.keyPair.pubKey,eSkeySig:t.signature}});return(0,o.encodeProtobuf)(f.ClientPayloadSpec,s).readByteArray()},t.getCompanionProps=m,t.getPlatformTypeFromName=E,t.getUserAgent=y,t.getWebSubPlatform=S;var i=n(r(81109)),a=r(15688),o=r(60980),s=n(r(87045)),l=r(11365),c=r(98263),d=r(99234),u=r(14111),p=n(r(64084)),f=r(84331),_=r(42448);function h(e){return{passive:!!e&&e.passive,connectType:f.ClientPayloadConnectType.WIFI_UNKNOWN,connectReason:f.ClientPayloadConnectReason.USER_ACTIVATED,userAgent:y(),webInfo:{webSubPlatform:S()}}}function g(){const e=(0,a.decodeB64)((0,p.default)("2.2208.7"));return new Uint8Array(e)}function m(){const e=s.default.info();let t;if(e.version&&""!==e.version){const r=e.version.split(".");r.length>0&&e.version&&/^[0-9\.]+$/.test(e.version)&&(t={primary:parseInt(r[0],10),secondary:r.length>1?parseInt(r[1],10):void 0,tertiary:r.length>2?parseInt(r[2],10):void 0})}const r={os:e.os,version:t,platformType:E(e.name),requireFullSync:!1};return(0,o.encodeProtobuf)(c.CompanionPropsSpec,r).readByteArray()}function y(){const e=u.deviceInfo.get(),t=f.ClientPayload$UserAgentReleaseChannel.RELEASE;return{appVersion:{primary:Number("2"),secondary:Number("2208"),tertiary:Number("7")},platform:f.ClientPayload$UserAgentPlatform.WEB,releaseChannel:t,mcc:e.mcc,mnc:e.mnc,osVersion:e.osVersion,manufacturer:e.manufacturer,device:e.device,osBuildNumber:e.osBuild,localeLanguageIso6391:e.lg,localeCountryIso31661Alpha2:e.lc}}function E(e){switch(e){case"Chrome":return c.CompanionPropsPlatformType.CHROME;case"Firefox":return c.CompanionPropsPlatformType.FIREFOX;case"IE":return c.CompanionPropsPlatformType.IE;case"Opera":return c.CompanionPropsPlatformType.OPERA;case"Safari":return c.CompanionPropsPlatformType.SAFARI;case"Edge":return c.CompanionPropsPlatformType.EDGE;case"electron":case"Desktop":return c.CompanionPropsPlatformType.DESKTOP;case"ipad":case"iPad":return c.CompanionPropsPlatformType.IPAD;case"tablet":case"Android tablet":return c.CompanionPropsPlatformType.ANDROID_TABLET;case"Ohana":return c.CompanionPropsPlatformType.OHANA;case"Aloha":return c.CompanionPropsPlatformType.ALOHA;case"Catalina":return c.CompanionPropsPlatformType.CATALINA;default:return c.CompanionPropsPlatformType.UNKNOWN}}function S(){switch(_.WAM_PLATFORM){case"WEB":return f.ClientPayload$WebInfoWebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return f.ClientPayload$WebInfoWebSubPlatform.DARWIN;case"WIN32":case"WIN32_BETA":return f.ClientPayload$WebInfoWebSubPlatform.WIN32;case"MACSTORE":return f.ClientPayload$WebInfoWebSubPlatform.APP_STORE;case"WINSTORE":return f.ClientPayload$WebInfoWebSubPlatform.WIN_STORE;default:return}}},10151:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=w;var i=n(r(48926)),a=(r(70818),r(65044)),o=r(7293),s=r(79736),l=r(41796),c=r(46582),d=r(72651),u=r(99234),p=r(58052),f=r(36163),_=r(97480),h=r(10786),g=r(76214),m=r(318),y=r(92613),E=n(r(18438)),S=r(29100),v=r(24747),T=r(83254),C=r(88102),A=n(r(67938)),b=n(r(52991)),P=r(62583),M=r(55062);function O(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(){const e=(0,M.getCommsConfig)(void 0);return(0,v.startComms)(E.default,S.sendPing,e,(e=>Promise.resolve((0,d.inflate)(e))),(()=>{}),(()=>{})),yield(0,v.waitForConnection)(),(0,v.startHandlingRequests)()}))).apply(this,arguments)}function w(e){const t=(0,s.makeBridge)();(0,l.setBridge)(t),(0,c.requireSetHandlers)().then((e=>e(t)));let r=Promise.resolve();return o.GK.supportsFeature(o.GK.F.MD_BACKEND)?r=(0,h.initEncSalt)().then((()=>(0,h.initEncSaltForInvoker)())).then((()=>(0,m.initialize)())).catch((e=>{__LOG__(4,void 0,new Error,void 0,["launch_socket"])`storageInitializationError triggered logout: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}.`,C.Cmd.storageInitializationError()})).then((()=>{if(b.default.isLogoutInProgress)throw new Error("aborting launchSocket due to logout");return(0,p.isRegistered)()?(__LOG__(2)`[launch socket] launch socket for loggin`,C.Cmd.initialLoadReady(),(0,g.initialize)().catch((()=>C.Cmd.storageInitializationError())).then((()=>{C.Cmd.incrementProgress(),(0,f.restoreImportantMetaData)()})).then((()=>(0,f.restoreBlocklist)())).then((()=>{C.Cmd.incrementProgress(),(0,y.startBackend)()}))):(__LOG__(2)`[launch socket] launch socket for registration`,C.Cmd.incrementProgress(),_.OfflineResumeReporter.setIsInitialSync(),Promise.all([(0,T.refreshNoiseCredentials)(),(0,T.refreshSignalCredentials)()]).then((()=>{C.Cmd.incrementProgress(),O()})))})):a.Socket.launch(e),r}C.Cmd.on("md_downgrade_webclient",(0,i.default)((function*(){(0,v.stopComms)(),yield(0,h.deleteEncKeysAndCache)(),a.Socket.set({launched:!1,stream:P.SOCKET_STREAM.DISCONNECTED,mustExitLoop:!1,shouldUpgradeToMD:!1}),(0,u.setMdOptedIn)(!1),o.GK.setFeature(o.GK.F.MD_BACKEND,!1),o.GK.setFeature(o.GK.F.MD_ADV,!1),o.GK.setFeature(o.GK.F.MD_VOIP_GROUP,!1),a.Socket.initialize(),a.Socket.handler||a.Socket.registerHandler(A.default),w(!0)}))),C.Cmd.on("upgrade_to_md",(()=>{o.GK.setFeature(o.GK.F.MD_BACKEND,!0),o.GK.setFeature(o.GK.F.MD_ADV,!0),o.GK.setFeature(o.GK.F.MD_VOIP_GROUP,!1),w(!0),(0,p.setUpgradeMdWamFlag)(!0)})),C.Cmd.on("upgrade_to_md_prod",(()=>{o.GK.setFeature(o.GK.F.MD_BACKEND,!0),o.GK.setFeature(o.GK.F.MD_ADV,!0),o.GK.setFeature(o.GK.F.MD_VOIP_GROUP,!1),w(!0),(0,p.setUpgradeMdWamFlag)(!0)})),C.Cmd.on("md_refresh_qr",(()=>{(0,v.stopComms)(),O()})),C.Cmd.on("logout",(()=>{o.GK.supportsFeature(o.GK.F.MD_BACKEND)&&w(!0)}))},85726:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!(0,m.isRegistered)())return function(){return R.apply(this,arguments)}(e);return function(){return w.apply(this,arguments)}(e)};var i=n(r(48926)),a=r(15688),o=r(8584),s=r(17525),l=(r(87614),r(10095)),c=n(r(45095)),d=r(27498),u=r(84902),p=r(60980),f=r(37039),_=r(88102),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=C(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(5087)),g=r(14111),m=r(58052),y=r(11849),E=n(r(33815)),S=r(24774),v=r(78155),T=n(r(17072));function C(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(C=function(e){return e?r:t})(e)}const A=new Uint8Array([87,65,6,d.DICT_VERSION]),b="Noise_XX_25519_AESGCM_SHA256\0\0\0\0";let P;function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=(0,m.getRoutingInfo)(),t=e?e.edgeRouting:null;let r=t?(0,a.encodeB64UrlSafe)(t):null;const n=new E.default({routingToken:r}),i=h.keyPair(),[c,d,u]=yield(0,T.default)(n,"change:socket").cancellable().then((()=>n.socket)).finally((()=>{n.deactivate()})).then((e=>{let r;if(t){const e=new o.Binary;e.write("ED",0,1),e.writeUint8(t.byteLength>>16),e.writeUint16(65535&t.byteLength),e.writeBuffer(t),r=e.readByteArray()}const n=r?o.Binary.build(r,A).readByteArray():A,a=new s.FrameSocket(e,n);P=new l.NoiseHandshake(a),P.start(b,A),__LOG__(2)`openChatSocket send hello`,P.authenticate(i.pubKey);const c={clientHello:{ephemeral:i.pubKey}};return P.sendAndReceive((0,p.encodeProtobuf)(v.HandshakeMessageSpec,c).readByteArray())})).then((e=>I(P,e,i)));return __LOG__(2)`verifying certificate`,(0,S.verifyChainCertificateWA6)(d,c),u}))).apply(this,arguments)}function I(e,t,r){__LOG__(2)`openChatSocket rcv hello`;const{serverHello:n}=(0,u.decodeProtobuf)(v.HandshakeMessageSpec,t);if(!n)throw new Error("ServerHello payload error");const{ephemeral:i,static:a,payload:o}=n;if(null==i||null==a||null==o)throw new Error("Missing server Ephemeral");e.authenticate(i),e.mixIntoKey(h.sharedSecret(i,r.privKey));const s=e.decrypt(a),l=s.then((e=>h.sharedSecret(e,r.privKey)));return e.mixIntoKey(l),Promise.all([s,e.decrypt(o),i])}function w(){return(w=(0,i.default)((function*(e){try{const t=yield M().then(function(){var t=(0,i.default)((function*(t){_.Cmd.incrementProgress();const r=(0,c.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair,n=(0,f.getClientPayloadForLogin)(e);return Promise.all([D(r,P,t),P.encrypt(Promise.resolve(n))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,r]=e;return _.Cmd.incrementProgress(),P.send((0,p.encodeProtobuf)(v.HandshakeMessageSpec,{clientFinish:{static:t,payload:r}}).readByteArray()),P.finish()}));return _.Cmd.incrementProgress(),__LOG__(2)`openChatSocketForLogin success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForLogin error ${e}`}}))).apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){try{const t=yield M().then((e=>Promise.all([y.waSignalStore.getRegistrationInfo(),y.waSignalStore.getSignedPreKey(),e]))).then(function(){var t=(0,i.default)((function*(t){let[r,n,i]=t;if(!n||!r)throw new Error("Invalid signal credentials");const a=(0,f.getClientPayloadForRegistration)(r,n,e),o=(0,c.default)(yield g.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair;return Promise.all([D(o,P,i),P.encrypt(Promise.resolve(a))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,r]=e;return P.send((0,p.encodeProtobuf)(v.HandshakeMessageSpec,{clientFinish:{static:t,payload:r}}).readByteArray()),P.finish()}));return __LOG__(2)`openChatSocketForRegistration success, resetting round`,t}catch(e){__LOG__(3)`openChatSocketForRegistration error ${e}`}}))).apply(this,arguments)}function D(e,t,r){const n=Promise.resolve(e.pubKey),i=t.encrypt(n);if(!r)return Promise.reject(new Error("staticAgreement called before serverKeys"));const a=h.sharedSecret(r,e.privKey);return t.mixIntoKey(a),i}},72006:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.openSocket=function(e){return new WebSocket(e)};n(r(45095)),r(57932),n(r(92417))},83254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildUrl=function(e,t,r){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw new Error(`buildUrl given invalid host "${e}"`);if(!t.startsWith("/"))throw new Error(`buildUrl given invalid path "${t}"`);const n=r,i=`${e}${t}`;if(!n)return i;const a=Object.keys(n).map((e=>{let t=n[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));const r=t instanceof Uint8Array?Array.prototype.slice.call(t).map((e=>`%${e.toString(16)}`)).join(""):encodeURIComponent(t);return`${encodeURIComponent(e)}=${r}`}));if(a.length>0){const e=a.join("&");return i.includes("?")?`${i}&${e}`:`${i}?${e}`}return i},t.refreshNoiseCredentials=function(){const e=(0,o.keyPair)(),t=new Uint8Array(24);return self.crypto.getRandomValues(t),Promise.resolve(s.waNoiseInfo.set({recoveryToken:t.buffer,staticKeyPair:e}))},t.refreshSignalCredentials=function(){return u.apply(this,arguments)},t.setRoutingInfo=function(e,t){const r={domain:e,edgeRouting:t?(0,a.decodeB64)(t):null};return __LOG__(2)`set routingInfo:`,Promise.resolve((0,c.setRoutingInfo)(r))};var i=n(r(48926)),a=r(15688),o=r(5087),s=r(14111),l=r(58425),c=r(58052),d=r(11849);function u(){return(u=(0,i.default)((function*(){const e=window.libsignal.KeyHelper.generateRegistrationId();yield d.waSignalStore.clearCredential();const t=yield(0,l.generateIdentityKeyPair)();yield Promise.all([d.waSignalStore.setRegistrationInfo({registrationId:e,identityKeyPair:t}),d.waSignalStore.rotateSignedPreKey((0,o.toSignalCurveKeyPair)(t),l.generateSignedKeyPair)])}))).apply(this,arguments)}},62583:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WATCHED_SOCKET_STATE=t.SOCKET_STREAM=t.SOCKET_STATE=void 0;t.SOCKET_STATE={OPENING:"OPENING",PAIRING:"PAIRING",UNPAIRED:"UNPAIRED",UNPAIRED_IDLE:"UNPAIRED_IDLE",CONNECTED:"CONNECTED",TIMEOUT:"TIMEOUT",CONFLICT:"CONFLICT",UNLAUNCHED:"UNLAUNCHED",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION"};t.SOCKET_STREAM={DISCONNECTED:"DISCONNECTED",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTED:"CONNECTED"};t.WATCHED_SOCKET_STATE={OPEN:"OPEN",CLOSED:"CLOSED"}},94030:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=r(8584),s=r(856),l=r(13959),c=r(85553),d=r(11290),u=i(r(78144)),p=i(r(57220)),f=i(r(17072)),_=r(7388),h=r(24465),g=r(12099);const m=3e5,y=18e4,E=(0,h.fibonacci)(8e3,4e3,3e5);class S extends d.BaseModel{constructor(){super(...arguments),this.active=(0,d.prop)(!0),this.socket=(0,d.prop)(),this.sockets=(0,d.prop)(),this.pendingSocketPromiseCount=(0,d.prop)(0),this.attempts=(0,d.prop)(0),this.startId=(0,d.prop)(0),this.controller=(0,d.prop)(),this.retryTimestamp=(0,d.prop)(),this.tsListener=(0,d.prop)(),this.onerror=(0,d.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpener set to socket ${e.id}`,this.set({active:!1,socket:e}),p.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpener closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpener deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(p.default,"change:online",this.onOnlineChange),this.listenTo(c.jsHaltDetector,c.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return __LOG__(2,void 0,void 0,!0)`attemptOpen called while not active!`,void SEND_LOGS("rogue-opener");const e=(0,g.open)({url:"wss://web.whatsapp.com/ws",msgParser:T});this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const r=function(){if(t)return Promise.resolve();t=!0;const e=(new n).signal;return p.default.checkOnline({signal:e})},i=new n;(0,l.delayMs)(6e3,i.signal).then((()=>r())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>r()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=p.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpener:onlineController activating`,new h.Watchdog({waitAlgorithm:E,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpener:offlineController activating`;let e,t=0;return new h.Watchdog({waitAlgorithm:n=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpener:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpener:offline... heuristic poll`,e=v(n,[(0,_.waitForOnlineNaive)(),(0,f.default)(c.jsHaltDetector,c.JS_HALT_EVENT),(0,f.default)(r(8080).Stream,"change:available")]),m):(__LOG__(2)`SocketOpener:offline... wait for navigator`,t=0,e=v(n,[(0,_.waitForOnlineNaive)()]),m)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function v(e,t){return(0,s.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}function T(e){const t=e.data;let r,n,i;if(t instanceof ArrayBuffer){let e;const a=[],s=new o.Binary(t);for(;44!==(e=s.readUint8());)a.push(e);r=String.fromCharCode.apply(String,a),n=s.readBuffer(),i=t.byteLength}else{if("string"!=typeof t)throw new Error("Unexpected message event type");{const e=t.indexOf(",");r=t.slice(0,e),n=t.slice(e+1),n=n?JSON.parse(n,u.default):void 0,i=new Blob([t]).size}}return{tag:r,data:n,binarySize:i}}var C=(0,d.defineModel)(S);t.default=C},33815:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(89385),o=r(856),s=r(13959),l=r(85553),c=r(11290),d=i(r(57220)),u=i(r(17072)),p=r(7388),f=r(24465),_=r(14350);const h="wss://web.whatsapp.com/ws/chat",g=3e5,m=18e4,y=(0,f.fibonacci)(8e3,4e3,3e5);class E extends c.BaseModel{constructor(){super(...arguments),this.active=(0,c.prop)(!0),this.socket=(0,c.prop)(),this.sockets=(0,c.prop)(),this.pendingSocketPromiseCount=(0,c.prop)(0),this.attempts=(0,c.prop)(0),this.controller=(0,c.prop)(),this.retryTimestamp=(0,c.prop)(),this.tsListener=(0,c.prop)(),this.onerror=(0,c.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpenerMD set to socket ${e.id}`,this.set({active:!1,socket:e}),d.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpenerMD closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpenerMD deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(d.default,"change:online",this.onOnlineChange),this.listenTo(l.jsHaltDetector,l.JS_HALT_EVENT,this.onJsHalt),this.onOnlineChange()}attemptOpen(){if(!this.active)return void __LOG__(2)`attemptOpen called while not active!`;const e=(0,_.open)(this.routingToken?`${h}?ED=${this.routingToken}`:h);this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const r=function(){if(t)return Promise.resolve();t=!0;const e=(new n).signal;return d.default.checkOnline({signal:e})},i=new n;(0,s.delayMs)(6e3,i.signal).then((()=>r())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>r()))}poke(){this.controller&&this.controller.forceTimeout()}onOnlineChange(){if(!this.active)return;const e=this.controller,t=d.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpenerMD:onlineController activating`,new f.Watchdog({waitAlgorithm:y,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpenerMD:offlineController activating`;let e,t=0;return new f.Watchdog({waitAlgorithm:n=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpenerMD:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpenerMD:offline... heuristic poll`,e=S(n,[(0,p.waitForOnlineNaive)(),(0,u.default)(l.jsHaltDetector,l.JS_HALT_EVENT),(0,u.default)(r(8080).Stream,"change:available")]),g):(__LOG__(2)`SocketOpenerMD:offline... wait for navigator`,t=0,e=S(n,[(0,p.waitForOnlineNaive)()]),g)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}onJsHalt(e){const t=this.controller;t&&e>m&&(__LOG__(2)`js halt longer than ${m} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function S(e,t){return(0,o.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}var v=(0,c.defineModel)(E);t.default=v},24774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCertificateWA6=d,t.verifyCertificateWA6=u,t.verifyChainCertificateWA6=function(e,t){const r=(0,a.decodeProtobuf)(s.CertChainSpec,e);if(!r)throw new Error("verifyCertificateWA6 - Missing Certificate");const i=r.intermediate,o=r.leaf;if(null==i||null==o)throw new Error("verifyCertificateWA6 - Missing Leaf and/or Intermediate Certificate");__LOG__(2)`verifying intermediate certificate`;const l=d(i);if(u(l,c.PUBLIC_KEY),l.issuerSerial!==c.SERIAL)throw new Error("verifyChainCertificateWA6 intermediateCert was not issued by RootCA");__LOG__(2)`verifying leaf certificate`;const p=d(o);if(u(p,l.key),p.issuerSerial!==l.serial)throw new Error("verifyChainCertificateWA6 leafCert was not issued by IntermediateCert");if(!(0,n.areBuffersEqual)(p.key,t))throw new Error("verifyChainCertificateWA6 leafCert.key does not match handshake server.hello.static")};var n=r(7589),i=r(87614),a=r(84902),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(5087)),s=r(78155);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}const c={SERIAL:0,ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:(0,i.parseHex)("142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b")};function d(e){const t=e.details,r=e.signature;if(!t)throw new Error('parseCertificateWA6 certificate is missing "details"');if(!r)throw new Error('parseCertificateWA6 certificate is missing "signature"');const n=(0,a.decodeProtobuf)(s.CertChain$NoiseCertificate$DetailsSpec,t),{issuerSerial:i,serial:o,key:l,notAfter:c,notBefore:d}=n;if(null==i)throw new Error('parseCertificateWA6 certificate is missing "issuer_serial"');if(null==o)throw new Error('parseCertificateWA6 certificate is missing "serial"');if(null==l)throw new Error('parseCertificateWA6 certificate is missing "key"');return{serial:o,issuerSerial:i,key:l,notBefore:d,notAfter:c,details:t,signature:r}}function u(e,t){if(!o.verifySignature(new Uint8Array(t),new Uint8Array(e.details),new Uint8Array(e.signature)))throw new Error("verifyCertificateWA6 certificate is poorly signed!")}},12099:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketModel=void 0,t.open=function(e){let t;try{t=new T(e)}catch(e){return __LOG__(3)`WatchedSocket error constructing: ${e}`,h.default.reject(e)}return new h.default(t,(function(e,t){this.id=(T.numSocketsAttempted++).toString(),__LOG__(2)`WatchedSocket opening socket ${this.id}`;const r=(0,u.openSocket)(this.url);r.binaryType="arraybuffer",r.onopen=e,r.onclose=r.onerror=function(e){t(new d.SocketError(e))},this.socket=r})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocket error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocket opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,m.default)().then(this.close.bind(this,!1,"offline")).catch((0,a.catchAbort)((()=>{}))),this._pingTimer.onOrAfter(C()),this.state=_.WATCHED_SOCKET_STATE.OPEN,this}))};var i=n(r(82569)),a=r(89385),o=r(38284),s=r(57319),l=r(85553),c=r(11290),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=y(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),u=r(72006),p=n(r(84426)),f=n(r(26445)),_=r(62583),h=n(r(59402)),g=r(65127),m=n(r(14706));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(y=function(e){return e?r:t})(e)}const E=18e4;function S(e,t){let r=-1;const n=e.find((e=>(r++,t(e))));return void 0===n?void 0:{index:r,value:n}}class v extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.session)(),this.url=(0,c.session)(),this.onmessage=(0,c.session)(),this.onactivity=(0,c.session)(),this.timeSkew=(0,c.session)(),this.msgParser=(0,c.session)(),this.state=(0,c.session)(),this.error=(0,c.session)(),this.socket=(0,c.session)(),this.isQueueing=(0,c.session)(!0),this.maxQueueSize=(0,c.session)(),this.messageQueue=(0,c.session)(),this._offlineListener=(0,c.session)(),this._msgListeners=(0,c.session)(),this._pingTimer=(0,c.session)(),this._killTimer=(0,c.session)()}initialize(){this._msgListeners=[],this.messageQueue=[],this.safariSplitter=g.UA.isSafari?new p.default(this):null,this._pingTimer=new s.ShiftTimer((()=>this._ping())),this._killTimer=new s.ShiftTimer((()=>this._killSocket())),l.jsHaltDetector.on(l.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>E&&(__LOG__(2)`js halt longer than ${E} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_ping(){this.send("?,,"),this._killTimer.onOrAfter(A())}_killSocket(){__LOG__(3)`WatchedSocket ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.set({onactivity:void 0,onmessage:void 0})}send(e){this.cast(e),this._pingTimer.cancel(),this._killTimer.onOrAfter(A())}cast(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)throw new d.SocketNotOpen(this.state);if("string"==typeof e&&/\[object ArrayBuffer\]/.test(e))throw new TypeError("converted ArrayBuffer to string prematurely");if(this.safariSplitter)this.safariSplitter.send(e);else try{_wext.os(e);this.socket.send(e)}catch(e){__LOG__(3,void 0,void 0,!0)`exception sending: ${e}\n${e.stack}`,SEND_LOGS("send-exception"),this.close(!0,e)}}partingSend(e,t,r){const n=this,i=this.socket,a=new Promise((function(a){function o(){a(void 0)}i.onclose=o,i.onerror=o,i.onmessage=function(e){const t=e.data;r&&!r(t)||a(t)},n.send(t),n._onCloseOrError(!1,e)}));return(0,o.promiseTimeout)(a,2e4,"paringSendTimeout").catch((()=>{})).finally((function(){i.onclose=void 0,i.onerror=void 0,i.onmessage=void 0,i.readyState===WebSocket.OPEN&&i.close()}))}close(e,t){const r=this.socket;let n;if(this._onCloseOrError(e,t||"unspecified"),r&&(n=r.readyState,n===WebSocket.CONNECTING||n===WebSocket.OPEN))try{r.close()}catch(e){__LOG__(3)`WatchedSocket:exception closing: ${e}\n${e.stack}`}}_onMessage(e){this._pingTimer.onOrAfter(C()),this._killTimer.cancel();const t=e.data;if("string"==typeof t&&"!"===t.charAt(0)){const e=parseInt(t.slice(1),10);return e==e&&(this.timeSkew=Date.now()-e),void(this.onactivity&&this.onactivity())}const r=this.msgParser(e);_wext.om(r);this.onactivity&&this.onactivity(r),this._onParsedMsg(r)}_onParsedMsg(e){const t=S(this._msgListeners,(function(t){return!t.filter||t.filter(e)}));t?(this._msgListeners.splice(t.index,1),t.value.removed=!0,t.value.promise.force(e)):this.isQueueing?(__LOG__(3)`watchedSocket:enqueued`,this.messageQueue.push(e),void 0!==this.maxQueueSize&&this.messageQueue.length>this.maxQueueSize&&this.close(!0,"Queue Overflow")):this.onmessage?this.onmessage(e):__LOG__(3)`watchedSocket:dropped!`}_onCloseOrError(e,t){if(this.state===_.WATCHED_SOCKET_STATE.CLOSED)return;this.safariSplitter&&this.safariSplitter.cancel(),this.socket&&(this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,l.jsHaltDetector.off(l.JS_HALT_EVENT,this._onJsHalt,this),this._pingTimer.cancel(),this._killTimer.cancel(),this.set({state:_.WATCHED_SOCKET_STATE.CLOSED,error:e?t:void 0});const r=this._msgListeners,n=e?new d.SocketError(t):new d.SocketClosed(t);this._msgListeners=[],r.forEach((function(e){e.removed=!0,e.promise.cancel(n)}))}holdMessages(e){const t=this.isQueueing&&void 0!==e&&this.messageQueue>e;this.set({isQueueing:!0,messageQueue:this.messageQueue||[],maxQueueSize:e}),t&&this.close(!0,"Queue Overflow")}releaseMessages(e){if(!this.isQueueing)return void __LOG__(3)`WatchedSocket:releaseMessages not queued!`;const t=this.messageQueue;this.set({isQueueing:!1,messageQueue:[]}),e?t.length>0&&__LOG__(3)`WatchedSocket:releaseMessages dropping ${t.length} messages.`:t.forEach((e=>{this._onParsedMsg(e)}))}nextMessage(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)return h.default.reject(new d.SocketNotOpen(this.state)).cancellable();let t;if(t=e instanceof f.default?e.test.bind(e):e,this.isQueueing){let e;if(t){const r=S(this.messageQueue,t);r&&(e=r.value,this.messageQueue.splice(r.index,1))}else this.messageQueue.length>0&&(e=this.messageQueue.shift());if(e)return h.default.resolve(e).cancellable()}const r=(new h.default).cancellable().forceable(),n={removed:!1,filter:t,promise:r};return this._msgListeners.push(n),r.catch((()=>{n.removed||(this._msgListeners=(0,i.default)(this._msgListeners,n))})),r}}const T=(0,c.defineModel)(v);function C(){return 2e4*Math.random()+1e4}function A(){return 7e4*Math.random()+2e4}t.WatchedSocketModel=T,T.numSocketsAttempted=0},14350:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketMD=void 0,t.open=function(e){let t;try{t=new h(e)}catch(e){return __LOG__(3)`WatchedSocketMD error constructing: ${e}`,u.default.reject(e)}return new u.default(t,(function(e,t){h.numSocketsAttempted++,this.id=h.numSocketsAttempted,__LOG__(2)`WatchedSocketMD opening socket ${this.id}`;const r=(0,c.openSocket)(this.url);r.binaryType="arraybuffer",r.onopen=e,r.onclose=r.onerror=function(e){t(new s.SocketError(e))},this.socket=r})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocketMD error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocketMD opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._onMessage.bind(this),e.onerror=this._onCloseOrError.bind(this,!0),e.onclose=this._onCloseOrError.bind(this,!1),this._offlineListener=(0,p.default)().then(this.close.bind(this,!1,"offline")).catch((0,i.catchAbort)((()=>{}))),this.state=d.WATCHED_SOCKET_STATE.OPEN,this}))};var i=r(89385),a=r(8584),o=r(57319),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=f(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(64103)),l=r(85553),c=r(72006),d=r(62583),u=n(r(59402)),p=n(r(14706));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(f=function(e){return e?r:t})(e)}const _=18e4;class h{constructor(e){this.onError=null,this.dataToSend=new a.Binary,this.url=e,this._killTimer=new o.ShiftTimer((()=>this._killSocket())),l.jsHaltDetector.on(l.JS_HALT_EVENT,this._onJsHalt,this)}_onJsHalt(e){e>_&&(__LOG__(2)`js halt longer than ${_} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_killSocket(){__LOG__(3)`WatchedSocketMD ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.socket.onmessage=g}close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const r=this.socket;let n;if(this._onCloseOrError(e,t||"unspecified"),r&&(n=r.readyState,n===WebSocket.CONNECTING||n===WebSocket.OPEN))try{r.close()}catch(e){__LOG__(3)`WatchedSocketMD:exception closing: ${e}\n${e.stack}`}}requestSend(){if(this.state!==d.WATCHED_SOCKET_STATE.OPEN)throw new s.SocketNotOpen(this.state);if(this.dataToSend.size())try{this.socket.send(this.dataToSend.readByteArray())}catch(e){__LOG__(3)`exception sending: ${e}\n${e.stack}`,this.close(!0,e)}}_onMessage(e){if(!(e.data instanceof ArrayBuffer))throw new TypeError("expected ArrayBuffer from the socket");if(this.onData){(0,this.onData)(new Uint8Array(e.data))}}_onCloseOrError(e,t){this.state!==d.WATCHED_SOCKET_STATE.CLOSED&&(this.socket&&(this.socket.onclose=g,this.socket.onerror=g,this.socket.onmessage=g),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,l.jsHaltDetector.off(l.JS_HALT_EVENT,this._onJsHalt,this),this._killTimer.cancel(),this.state=d.WATCHED_SOCKET_STATE.CLOSED,this.error=e?t:void 0,null!=this.onClose&&this.onClose())}}function g(){}t.WatchedSocketMD=h,h.numSocketsAttempted=0},6565:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceSentMessage=function(e,t){return{deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:e}}},t.createDisappearingMode=E,t.createMessageKey=function(e){const t=P(e.to),r={fromMe:!0,id:e.id.id};(0,h.isString)(t)&&(r.remoteJid=t);return r},t.createMsgProtobuf=function(e,t){const r=function(e){const t=e.id,r=e.toJSON();delete r.status,delete r.mimetype,delete r.height,delete r.width,delete r.recipients,delete r.chat,delete r.broadcast,delete r.ack,delete r.invis,delete r.filehash,delete r.recvFresh,delete r.mediaData,g.URL.isHttp(e.clientUrl)||delete r.clientUrl;g.URL.isHttp(e.deprecatedMms3Url)||delete r.deprecatedMms3Url;for(const e in r)null==r[e]&&delete r[e];const n=l.default.get(t.remote);n&&(r.conversionTuple=n.serialize());return r}(e),n={};if(r.quotedMsg){const e=r.quotedMsg.mentionedJidList,t=Array.isArray(e)&&e.length>0?{mentionedJid:e.map(P)}:void 0;n.stanzaId=r.quotedStanzaID,n.remoteJid=P(r.quotedRemoteJid),n.participant=P(r.quotedParticipant),n.quotedMessage=A(r.quotedMsg,{duration:r.quotedMsg.duration,directPath:r.quotedMsg.directPath,encFilehash:r.quotedMsg.encFilehash,filehash:r.quotedMsg.filehash,height:r.quotedMsg.height,mediaKey:r.quotedMsg.mediaKey,mediaKeyTimestamp:(0,h.isNumber)(r.quotedMsg.mediaKeyTimestamp)?r.quotedMsg.mediaKeyTimestamp:void 0,mimetype:r.quotedMsg.mimetype,url:r.quotedMsg.clientUrl||r.quotedMsg.deprecatedMms3Url,width:r.quotedMsg.width},t)}else r.quotedRemoteJid&&r.quotedGroupSubject&&r.quotedParentGroupJid?(n.remoteJid=P(r.quotedRemoteJid),n.groupSubject=r.quotedGroupSubject,n.parentGroupJid=P(r.quotedParentGroupJid)):r.quotedRemoteJid&&(n.remoteJid=P(r.quotedRemoteJid));if(r.mentionedJidList&&r.mentionedJidList.length>0){const e=r.mentionedJidList;n.mentionedJid=e.map(P)}r.conversionTuple&&Object.assign(n,r.conversionTuple);r.isForwarded&&(n.isForwarded=r.isForwarded);r.forwardingScore&&(n.forwardingScore=r.forwardingScore);r.ephemeralDuration&&(n.expiration=r.ephemeralDuration);r.ephemeralSettingTimestamp&&(n.ephemeralSettingTimestamp=r.ephemeralSettingTimestamp);r.disappearingModeInitiator&&(n.disappearingMode=E(r.disappearingModeInitiator));r.ctwaContext&&(n.externalAdReply={sourceUrl:r.ctwaContext.sourceUrl,sourceId:r.ctwaContext.sourceId,sourceType:r.ctwaContext.sourceType,body:r.ctwaContext.description,title:r.ctwaContext.title,thumbnailUrl:r.ctwaContext.thumbnailUrl,thumbnail:r.ctwaContext.thumbnail?M(r.ctwaContext.thumbnail):void 0,mediaType:r.ctwaContext.mediaType,mediaUrl:r.ctwaContext.mediaUrl});return A(r,t,Object.keys(n).length>0?n:void 0)},t.createViewOnceFutureProofMessage=y,t.encodeJid=P,t.populateMessageContextInfo=function(e,t,r){if(!t&&!r)return;e.messageContextInfo={deviceListMetadata:{senderKeyHash:null==t?void 0:t.keyHash,senderTimestamp:null==t?void 0:t.timestamp,senderKeyIndexes:null==t?void 0:t.keyIndexes,recipientKeyHash:null==r?void 0:r.keyHash,recipientTimestamp:null==r?void 0:r.timestamp,recipientKeyIndexes:null==r?void 0:r.keyIndexes},deviceListMetadataVersion:2}};var i=n(r(81109)),a=r(15688),o=r(15461),s=n(r(89867)),l=n(r(35667)),c=r(24606),d=r(24808),u=r(7293),p=r(34535),f=n(r(5165)),_=r(64551),h=r(31515),g=r(2541),m=r(93650);function y(e){return{viewOnceMessage:{message:e}}}function E(e){let t;switch(e){case c.DisappearingModeInitiator.ChangedInChat:t=d.DisappearingModeInitiator.CHANGED_IN_CHAT;break;case c.DisappearingModeInitiator.InitiatedByMe:t=d.DisappearingModeInitiator.INITIATED_BY_ME;break;case c.DisappearingModeInitiator.InitiatedByOther:t=d.DisappearingModeInitiator.INITIATED_BY_OTHER}return{initiator:t}}function S(e,t,r){const{documentMessage:n,imageMessage:i,locationMessage:a,videoMessage:o}=e;if(t.isForwarded&&(n||i||a||o))return e;const s={buttons:!0===t.isForwarded?void 0:t.dynamicReplyButtons,footerText:t.footer,contextInfo:r};return n?(s.documentMessage=n,s.headerType=d.Message$ButtonsMessageHeaderType.DOCUMENT,s.contentText=t.caption):i?(s.imageMessage=i,s.headerType=d.Message$ButtonsMessageHeaderType.IMAGE,s.contentText=t.caption):a?(s.locationMessage=a,s.headerType=d.Message$ButtonsMessageHeaderType.LOCATION,s.contentText=t.caption):o?(s.videoMessage=o,s.headerType=d.Message$ButtonsMessageHeaderType.VIDEO,s.contentText=t.caption):t.title?(s.text=t.title,s.headerType=d.Message$ButtonsMessageHeaderType.TEXT,s.contentText=t.body):(s.contentText=t.body,s.headerType=d.Message$ButtonsMessageHeaderType.EMPTY),{buttonsMessage:s}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const i={url:t.url,mimetype:n,caption:e.caption,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:M(e.body),contextInfo:r,viewOnce:e.isViewOnce};return O(e.type,i),i}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=t.duration;i=(0,h.isString)(i)?parseInt(i,10):i;const a=e.type===o.MSG_TYPE.INTERACTIVE?void 0:e.caption,s={url:t.url,mimetype:n,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,seconds:i,caption:a,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:M(e.body),gifPlayback:e.isGif,gifAttribution:e.gifAttribution,contextInfo:r,streamingSidecar:e.streamingSidecar,viewOnce:e.isViewOnce};return O(e.type,s),s}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;const i=e.type===o.MSG_TYPE.INTERACTIVE?void 0:e.caption,a={url:t.url,mimetype:n,title:i,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),fileName:t.filename,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:M(e.body),contextInfo:r,contactVcard:e.isVcardOverMmsDocument,thumbnailDirectPath:t.thumbnailDirectPath,thumbnailSha256:M(t.thumbnailSha256),thumbnailEncSha256:M(t.thumbnailEncSha256),thumbnailHeight:t.thumbnailHeight,thumbnailWidth:t.thumbnailWidth};return Number.isFinite(e.pageCount)&&!Number.isNaN(e.pageCount)&&(a.pageCount=e.pageCount),O(e.type,a),a}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=n||{};const s=e.mimetype||t.mimetype||void 0;let l=t.duration;switch(e.type){case o.MSG_TYPE.CHAT:"url"===e.subtype||e.quotedMsg||e.quotedRemoteJid||Array.isArray(e.mentionedJidList)&&e.mentionedJidList.length>0||e.conversionTuple||e.isForwarded||e.forwardingScore||e._isPaymentNoteMsg||e.ephemeralDuration||e.ephemeralSettingTimestamp||e.ctwaContext?a.extendedTextMessage={text:e.body,matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:e.description,title:e.title,jpegThumbnail:M(e.thumbnail),previewType:e.richPreviewType,contextInfo:r,mediaKey:M(e.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(e.mediaKeyTimestamp)?e.mediaKeyTimestamp:void 0,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:M(e.thumbnailSha256),thumbnailEncSha256:M(e.thumbnailEncSha256),thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth}:a.conversation=e.body;break;case o.MSG_TYPE.GROUPS_V4_INVITE:a.groupInviteMessage={inviteCode:e.inviteCode,inviteExpiration:parseInt(e.inviteCodeExp,10),groupJid:e.inviteGrp,groupName:e.inviteGrpName,caption:e.comment,jpegThumbnail:M(e.inviteGrpJpegThum)};break;case o.MSG_TYPE.STICKER:if("image/webp"!==t.mimetype)throw __LOG__(3)`invalid sticker mimetype: ${t.mimetype}`,new Error("invalid sticker mimetype");a.stickerMessage={url:t.url,mimetype:t.mimetype,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,height:e.height,width:e.width,firstFrameLength:t.firstFrameLength||void 0,firstFrameSidecar:e.firstFrameSidecar||void 0,isAnimated:t.isAnimated,contextInfo:r},O(e.type,a.stickerMessage);break;case o.MSG_TYPE.LOCATION:const n={degreesLatitude:parseFloat(e.lat)||void 0,degreesLongitude:parseFloat(e.lng)||void 0,jpegThumbnail:M(e.body),contextInfo:r};if(e.loc&&(0,h.isString)(e.loc)){const t=e.loc.split("\n");n.name=t[0],n.address=t[1],n.url=e.clientUrl}a.locationMessage=n;break;case o.MSG_TYPE.VCARD:a.contactMessage={displayName:e.vcardFormattedName,vcard:e.body,contextInfo:r};break;case o.MSG_TYPE.MULTI_VCARD:a.contactsArrayMessage={displayName:e.subtype,contacts:e.vcardList.map((e=>e)),contextInfo:r};break;case o.MSG_TYPE.IMAGE:a.imageMessage=v(e,t,r,s);break;case o.MSG_TYPE.PRODUCT:a.productMessage={product:{productImage:{url:t.url,mimetype:s,caption:e.caption,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),height:t.height,width:t.width,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:M(e.body)},productId:e.productId,title:e.title,description:e.description,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000||void 0,salePriceAmount1000:e.salePriceAmount1000||void 0,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount},businessOwnerJid:e.businessOwnerJid,contextInfo:r,body:e.caption,footer:e.footer};break;case o.MSG_TYPE.DOCUMENT:a.documentMessage=C(e,t,r,s);break;case o.MSG_TYPE.PTT:case o.MSG_TYPE.AUDIO:l=(0,h.isString)(l)?parseInt(l,10):l;const c={url:t.url,mimetype:s,directPath:t.directPath||void 0,fileSha256:M(t.filehash),fileEncSha256:M(t.encFilehash),seconds:l,ptt:"ptt"===e.type,fileLength:(0,h.isNumber)(e.size)?e.size:void 0,mediaKey:M(t.mediaKey),mediaKeyTimestamp:(0,h.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,contextInfo:r,streamingSidecar:e.streamingSidecar};_.ServerProps.pttWaveformSend&&e.waveform&&((0,m.validateWaveform)(e.waveform)?c.waveform=e.waveform.buffer:(__LOG__(4,void 0,new Error,!0)`Outgoing waveform with invalid size: ${e.waveform.byteLength}`,SEND_LOGS("outgoing-waveform-invalid-size"))),a.audioMessage=c,O(e.type?"ptt":"audio",a.audioMessage);break;case o.MSG_TYPE.VIDEO:a.videoMessage=T(e,t,r,s);break;case o.MSG_TYPE.PROTOCOL:let u;switch(e.subtype){case"admin_revoke":case"sender_revoke":u={key:b(e.protocolMessageKey),type:d.Message$ProtocolMessageType.REVOKE};break;case"ephemeral_setting":u={type:d.Message$ProtocolMessageType.EPHEMERAL_SETTING,ephemeralExpiration:e.ephemeralDuration};break;case"ephemeral_sync_response":u={type:d.Message$ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE,ephemeralExpiration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingMode:E(e.disappearingModeInitiator)};break;case"app_state_sync_key_share":u={type:d.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE,appStateSyncKeyShare:e.appStateSyncKeyShare};break;case"app_state_sync_key_request":u={type:d.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST,appStateSyncKeyRequest:e.appStateSyncKeyRequest};break;case"app_state_fatal_exception_notification":u={type:d.Message$ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION,appStateFatalExceptionNotification:e.appStateFatalExceptionNotification}}u&&(a.protocolMessage=u);break;case o.MSG_TYPE.INTERACTIVE:let g={};if((e.caption||e.nativeFlowName===f.default.ORDER_STATUS)&&(g={body:{text:e.caption}}),e.interactiveHeader){const n={title:e.interactiveHeader.title,subtitle:e.interactiveHeader.subtitle,hasMediaAttachment:e.interactiveHeader.hasMediaAttachment};if(e.interactiveHeader.thumbnail)n.jpegThumbnail=M(e.interactiveHeader.thumbnail);else if(e.interactiveHeader.mediaType)switch(e.interactiveHeader.mediaType){case p.InteractiveMessageHeaderMediaType.VIDEO:n.videoMessage=T(e,t,r,s);break;case p.InteractiveMessageHeaderMediaType.DOCUMENT:n.documentMessage=C(e,t,r,s);break;case p.InteractiveMessageHeaderMediaType.IMAGE:n.imageMessage=v(e,t,r,s)}g.header=n}e.footer&&(g.footer={text:e.footer});const y=(0,m.getInteractiveMessageFieldNameForType)(e.interactiveType);y&&(g[y]=e.interactivePayload),r&&(g.contextInfo=r),a.interactiveMessage=g;break;case o.MSG_TYPE.PAYMENT:const I={};I.stanzaId=e.quotedStanzaID,I.mentionedJid=e.mentionedJidList&&e.mentionedJidList.map(P),I.isForwarded=e.isForwarded,I.forwardingScore=e.forwardingScore,I.participant=P(e.quotedParticipant),e.quotedMsg&&(I.quotedMessage=A(e.quotedMsg));const w=e.paymentNoteMsg?A(Object.assign(e.paymentNoteMsg,{_isPaymentNoteMsg:!0}),I):void 0;switch(e.subtype){case"send":const t=e.paymentRequestMessageKey?{fromMe:e.paymentRequestMessageKey.fromMe,remoteJid:P(e.paymentRequestMessageKey.remote),id:e.paymentRequestMessageKey.id,participant:P(e.paymentRequestMessageKey.participant)}:void 0;a.sendPaymentMessage={requestMessageKey:t,noteMessage:w};break;case"request":a.requestPaymentMessage={amount1000:e.amount1000,expiryTimestamp:e._paymentExpiryTimestamp,requestFrom:e._paymentRequestFrom,currencyCodeIso4217:e._currencyCodeIso4217,noteMessage:w}}break;case o.MSG_TYPE.TEMPLATE_BUTTON_REPLY:a.templateButtonReplyMessage={selectedId:e.selectedId,selectedIndex:e.selectedIndex,selectedDisplayText:e.body,contextInfo:r};break;case"template":return"text"===e.subtype?(e.type="chat",e.title&&(e.body="*"+e.title+"*\n"+e.body)):e.type=e.subtype,A(e,t,r,a);case o.MSG_TYPE.LIST:a.listMessage=e.list,a.listMessage.contextInfo=r;break;case o.MSG_TYPE.LIST_RESPONSE:a.listResponseMessage=e.listResponse,a.listResponseMessage.contextInfo=r;break;case o.MSG_TYPE.BUTTONS_RESPONSE:a.buttonsResponseMessage=e.buttonsResponse,a.buttonsResponseMessage.contextInfo=r;break;case o.MSG_TYPE.ORDER:e.itemCount||e.message||e.orderId||e.orderTitle||e.sellerJid||e.status||e.surface||e.thumbnail||e.token||e.totalAmount1000||e.totalCurrencyCode?a.orderMessage={itemCount:e.itemCount,message:e.message,orderId:e.orderId,orderTitle:e.orderTitle,sellerJid:e.sellerJid,status:e.status,surface:e.surface,thumbnail:M(e.thumbnail),token:e.token,totalAmount1000:e.totalAmount1000,totalCurrencyCode:e.totalCurrencyCode}:a.conversation=e.body;break;case o.MSG_TYPE.NATIVE_FLOW:e.headerType===d.Message$ButtonsMessageHeaderType.IMAGE&&(a.imageMessage=v(e,t,void 0,s)),a=S(a,e,r),a.buttonsMessage=(0,i.default)((0,i.default)({},a.buttonsMessage),{},{buttons:e.nativeFlowButtons});break;case o.MSG_TYPE.REACTION:a.reactionMessage={key:b(e.reactionParentKey),text:e.reactionText,senderTimestampMs:e.reactionTimestamp}}return!0===e.isDynamicReplyButtonsMsg&&(a=S(a,e,r)),e.isViewOnce&&(a=y(a)),a}function b(e){const t={fromMe:e.fromMe,id:e.id},r=P(e.remote),n=P(e.participant);return(0,h.isString)(r)&&(t.remoteJid=r),(0,h.isString)(n)&&(t.participant=n),t}function P(e){return e instanceof s.default?e.toString({legacy:!0}):(0,h.isString)(e)?e.replace(/@c.us$/,"@s.whatsapp.net"):void 0}function M(e){return e?(0,a.decodeB64)(e):void 0}function O(e,t){u.GK.supportsFeature(u.GK.F.LOG_OUTGOING_MSG_MISSING_REQUIRED_PROPERTIES)&&(t.viewOnce||(null==t.directPath&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-direct-path`)),null==t.fileSha256&&(__LOG__(2,void 0,void 0,!0)`fileSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-sha`)),null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-enc-sha`)),null==t.url&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-mms3-url`))))}},13493:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToTextWithoutSpecialEmojis=Me,t.decodeBytes=ne,t.decodeJid=te,t.decodeUrl=re,t.isValidReactionMessage=be,t.parseAudioMessageProto=q,t.parseButtons=oe,t.parseButtonsMessageProto=Te,t.parseButtonsResponseMessageProto=Ee,t.parseCancelPaymentRequestMessageProto=fe,t.parseContactMessageProto=W,t.parseContactsArrayMessageProto=H,t.parseContextInfoProto=Q,t.parseConversationProto=K,t.parseCtwaContextProto=X,t.parseDeclinePaymentRequestMessageProto=pe,t.parseDeviceSentMessage=ie,t.parseDisappearingModeProto=Ce,t.parseDocumentMessageProto=z,t.parseEphemeralFutureProofMessageProto=ve,t.parseExtendedTextMessageProto=$,t.parseGroupInviteMessageProto=he,t.parseImageMessageProto=j,t.parseInteractiveMessageProto=Ae,t.parseListMessageProto=me,t.parseListResponseMessageProto=ye,t.parseLiveLocationMessageProto=ce,t.parseLocationMessageProto=V,t.parseMsgProto=B,t.parseOrderMessageProto=ge,t.parsePaymentInviteMessageProto=_e,t.parseProductMessageProto=le,t.parseProtocolMessageProto=ee,t.parseReactionMessageProto=Pe,t.parseRequestPaymentMessageProto=ue,t.parseSendPaymentMessageProto=de,t.parseStickerMessageProto=Y,t.parseTemplateButtonReplyMessage=se,t.parseTemplateMessage=ae,t.parseVideoMessageProto=J,t.parseViewOnceFutureProofMessageProto=Se,t.validateRequiredMediaProperties=Oe;var i=n(r(81109)),a=n(r(88306)),o=r(15688),s=n(r(78403)),l=n(r(45095)),c=r(35470),d=n(r(64369)),u=r(72441),p=n(r(65212)),f=r(15461),_=n(r(89867)),h=r(45454),g=r(99140),m=r(22683),y=r(17239),E=r(24606),S=r(24808),v=r(70449),T=r(6303),C=r(99234),A=r(7293),b=r(57701),P=r(41796),M=r(34535),O=n(r(84064)),I=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=F(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(86688)),w=r(26287),R=n(r(5165)),D=r(90837),N=r(64551),L=r(31515),k=r(2541),G=r(93650),U=r(21224);function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(F=function(e){return e?r:t})(e)}const x=(0,a.default)((function(e){if((0,P.isConnectedToPage)())return k.URL.hostname(e);if(!e)return"";const t=k.URL.isHttp(e)?e:"http://"+e;return new self.URL(t).hostname}));function B(e,t,r,n,i,a,o,s){if(!e)return __LOG__(4,void 0,new Error,!0)`drop: not Message`,SEND_LOGS("null-message"),t;const{conversation:c,imageMessage:d,contactMessage:u,locationMessage:p,liveLocationMessage:_,extendedTextMessage:h,documentMessage:g,audioMessage:m,videoMessage:y,stickerMessage:E,contactsArrayMessage:S,sendPaymentMessage:v,requestPaymentMessage:T,productMessage:C,groupInviteMessage:b,viewOnceMessage:P,ephemeralMessage:M,orderMessage:O,listMessage:I,listResponseMessage:w,protocolMessage:R,declinePaymentRequestMessage:D,cancelPaymentRequestMessage:k,paymentInviteMessage:G,templateMessage:U,templateButtonReplyMessage:F,buttonsResponseMessage:x,buttonsMessage:B,interactiveMessage:Z,reactionMessage:te}=e;let re;var ne,oe,Ce,be;((0,L.isString)(c)&&K(t,c),b&&he(t,b),d&&(j(t,d),re=d.contextInfo),E&&(Y(t,E),re=E.contextInfo),u&&(W(t,u),re=u.contextInfo),S&&(H(t,S),re=S.contextInfo),p&&(V(t,p),re=p.contextInfo),_&&(ce(t,_,i),re=_.contextInfo),v)&&(re=null===(ne=v.noteMessage)||void 0===ne||null===(oe=ne.extendedTextMessage)||void 0===oe?void 0:oe.contextInfo,de(t,v,n));T&&(re=null===(Ce=T.noteMessage)||void 0===Ce||null===(be=Ce.extendedTextMessage)||void 0===be?void 0:be.contextInfo,ue(t,T,n));if(D&&pe(t,D),k&&fe(t,k),G&&_e(t,G),h&&($(t,h),re=h.contextInfo),g&&(z(t,g),re=g.contextInfo),m&&(q(t,m),re=m.contextInfo),y&&(J(t,y),re=y.contextInfo),R&&ee(t,R,r,s),C&&(le(t,C),re=C.contextInfo),O&&(ge(t,O),re=O.contextInfo),I&&(me(t,I),re=I.contextInfo),w&&(ye(t,w),re=w.contextInfo),P&&Se(t,P),M&&ve(t,M),B&&Te(t,B,o),x&&(Ee(t,x),re=x.contextInfo),Z&&(Ae(t,Z,o),re=Z.contextInfo),te&&Pe(t,te),A.GK.supportsFeature(A.GK.F.MD_BACKEND)){const{deviceSentMessage:n,highlyStructuredMessage:i}=e;var Oe;if(n&&ie(t,n,r),i)t.type=f.MSG_TYPE.HSM,(null===(Oe=i.hydratedHsm)||void 0===Oe?void 0:Oe.hydratedTemplate)&&(t.body=Me(i.hydratedHsm.hydratedTemplate.hydratedContentText))}return U&&(A.GK.supportsFeature(A.GK.F.MD_BACKEND)&&U.hydratedTemplate?ae(t,U.hydratedTemplate):ae(t,(0,l.default)(U.hydratedFourRowTemplate,"templateMessage.hydratedFourRowTemplate"))),F&&(se(t,F),re=F.contextInfo,t.type=f.MSG_TYPE.TEMPLATE_BUTTON_REPLY),re&&(Q(t,re,a),re.externalAdReply&&N.ServerProps.ctwaContextRender&&X(t,re.externalAdReply)),t}function K(e,t){e.type=f.MSG_TYPE.CHAT,e.body=Me(t)}function j(e,t){e.type=f.MSG_TYPE.IMAGE,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath||"",e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype||"",e.caption=Me(t.caption),e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height||0,e.width=t.width||0,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.body=ne(t.jpegThumbnail)||"",e.interactiveAnnotations=t.interactiveAnnotations,e.scanLengths=t.scanLengths,e.scansSidecar=t.scansSidecar,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),Oe(e,t)}function Y(e,t){e.type=f.MSG_TYPE.STICKER,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.mediaKey=(0,s.default)(ne(t.mediaKey)),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.height=t.height||0,e.width=t.width||0,e.firstFrameLength=t.firstFrameLength,e.firstFrameSidecar=t.firstFrameSidecar,e.isAnimated=t.isAnimated,Oe(e,t)}function W(e,t){e.type=f.MSG_TYPE.VCARD,e.vcardFormattedName=t.displayName,e.body=t.vcard}function H(e,t){const r=t.contacts;e.type=f.MSG_TYPE.MULTI_VCARD,e.vcardFormattedName=t.displayName,e.vcardList=Array.isArray(r)?r.map((e=>({displayName:e.displayName,vcard:e.vcard}))):[]}function V(e,t){const r=t.name&&t.address?`${t.name}\n${t.address}`:t.name||t.address||"";e.type=f.MSG_TYPE.LOCATION,e.lat=void 0!==t.degreesLatitude?t.degreesLatitude:void 0,e.lng=void 0!==t.degreesLongitude?t.degreesLongitude:void 0,e.loc=r,e.body=ne(t.jpegThumbnail)||"",e.clientUrl=t.url}function $(e,t){const r=t.matchedText||t.canonicalUrl||t.description||t.title;if(r){const r=x(t.canonicalUrl||""),n=x(t.matchedText||"");e.canonicalUrl=r===n||""===r?t.canonicalUrl:n}e.type=f.MSG_TYPE.CHAT,e.subtype=r?"url":void 0,e.body=Me(t.text||""),e.matchedText=t.matchedText,e.description=t.description,e.title=t.title,e.thumbnail=ne(t.jpegThumbnail)||"",e.richPreviewType=t.previewType,e.doNotPlayInline=t.doNotPlayInline,e.textColor=t.textArgb,e.backgroundColor=t.backgroundArgb,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=t.mediaKeyTimestamp,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth;const n=S.Message$ExtendedTextMessageFontType;if(null!=t.font)switch(t.font){case n.SANS_SERIF:case n.SERIF:case n.NORICAN_REGULAR:case n.BRYNDAN_WRITE:case n.BEBASNEUE_REGULAR:case n.OSWALD_HEAVY:e.font=t.font}}function z(e,t){e.type=f.MSG_TYPE.DOCUMENT,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.pageCount=t.pageCount||0,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.filename=(0,g.cleanIncomingFilename)(t.fileName||t.title),e.caption=e.filename,e.body=ne(t.jpegThumbnail)||"",e.isVcardOverMmsDocument=Boolean(t.contactVcard)&&e.size<=1024*N.ServerProps.vcardMaxSizeKb,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth,Oe(e,t)}function q(e,t){e.type=t.ptt?f.MSG_TYPE.PTT:f.MSG_TYPE.AUDIO,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.duration=`${t.seconds||0}`,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.streamingSidecar=t.streamingSidecar,e.waveform=t.waveform&&(0,G.validateWaveform)(t.waveform)?new Uint8Array(t.waveform):void 0,Oe(e,t)}function J(e,t){e.type=f.MSG_TYPE.VIDEO,e.deprecatedMms3Url=re(t.url),e.directPath=t.directPath,e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype,e.filehash=ne(t.fileSha256),e.encFilehash=ne(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height,e.width=t.width,e.duration=`${t.seconds||0}`,e.mediaKey=ne(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:m.Clock.globalUnixTime(),e.caption=Me(t.caption),e.body=ne(t.jpegThumbnail)||"",e.isGif=t.gifPlayback,e.gifAttribution=t.gifAttribution,e.streamingSidecar=t.streamingSidecar,e.interactiveAnnotations=t.interactiveAnnotations,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=ne(t.thumbnailSha256),e.thumbnailEncSha256=ne(t.thumbnailEncSha256),Oe(e,t)}function Q(e,t,r){const n=t.quotedMessage,i=t.mentionedJid;e.quotedMsg=n&&B(n,{type:f.MSG_TYPE.UNKNOWN}),e.quotedMsg&&"payment"===e.quotedMsg.type&&r&&__LOG__(2)`parseContextInfoProto: payment not supported`,e.quotedStanzaID=t.stanzaId,e.quotedParticipant=te(t.participant),e.quotedRemoteJid=te(t.remoteJid),e.quotedGroupSubject=te(t.groupSubject),e.quotedParentGroupJid=te(t.parentGroupJid),e.mentionedJidList=Array.isArray(i)?i.map(te):i,e.isForwarded=t.isForwarded,e.forwardingScore=t.forwardingScore,null!=t.expiration&&(e.ephemeralDuration=t.expiration),null!=t.ephemeralSettingTimestamp&&(e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp),null!=t.ephemeralSharedSecret&&(e.ephemeralSharedSecret=t.ephemeralSharedSecret),null!=t.disappearingMode&&Ce(e,t.disappearingMode),null!=t.actionLink&&(e.actionLink=t.actionLink)}function X(e,t){const r=I.findLink(t.sourceUrl||"",!1,e.from);e.ctwaContext={sourceUrl:t.sourceUrl,description:t.body,title:t.title,thumbnail:t.thumbnail?ne(t.thumbnail):null,thumbnailUrl:t.thumbnailUrl,mediaType:t.mediaType,mediaUrl:t.mediaUrl,isSuspiciousLink:(null==r?void 0:r.suspiciousCharacters)&&r.suspiciousCharacters.size>0}}function Z(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for protocol message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for protocol message");let n=null;return n=A.GK.supportsFeature(A.GK.F.MD_BACKEND)?function(e,t,r){var n;let i,a,o;if(null==r||null===(n=r.id)||void 0===n?void 0:n.fromMe)i=!!t.fromMe,o=te(t.remoteJid),t.fromMe?o.isUser()||(a=(0,C.getMeUser)()):a=te(t.participant);else if(o=r.id.remote,t.fromMe)i=!1,a=r.author;else{const e=te(t.participant);e?e.equals((0,C.getMeUser)())?(i=!0,o.isUser()||(a=(0,C.getMeUser)())):(i=!1,o.isUser()||(a=e)):i=!0}null!=o&&(o instanceof _.default&&o.isBroadcast()&&!o.isStatusV3()||"broadcast"===(0,u.interpretAndValidateJid)(o.toString()).jidType)&&(o=te(t.participant),a=void 0);return new p.default({id:e,fromMe:i,remote:o,participant:a})}(r,e,t):new p.default({id:r,fromMe:!!e.fromMe,remote:te(e.remoteJid),participant:te(e.participant)}),n}function ee(e,t,r,n){if("relay"!==r&&t.type!==S.Message$ProtocolMessageType.EPHEMERAL_SETTING)return;const{key:i,type:a}=t;let o=null;if(e.type=f.MSG_TYPE.PROTOCOL,null!=a)switch(a){case S.Message$ProtocolMessageType.REVOKE:o=Z(i,e),e.protocolMessageKey=o,e.subtype=n===c.EDIT_ATTR.ADMIN_REVOKE?"admin_revoke":"sender_revoke";break;case S.Message$ProtocolMessageType.EPHEMERAL_SETTING:e.subtype="ephemeral_setting",e.ephemeralDuration=t.ephemeralExpiration;break;case S.Message$ProtocolMessageType.EPHEMERAL_SYNC_RESPONSE:e.subtype="ephemeral_sync_response",e.ephemeralDuration=t.ephemeralExpiration,e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp,null!=t.disappearingMode&&Ce(e,t.disappearingMode);break;case S.Message$ProtocolMessageType.HISTORY_SYNC_NOTIFICATION:e.subtype="history_sync_notification";const{historySyncNotification:r}=t;if(r){const n={directPath:r.directPath,encFilehash:ne(r.fileEncSha256),filehash:ne(r.fileSha256),mediaKey:ne(r.mediaKey),type:"md-msg-hist"};e.historySyncMetaData={historySyncNotification:t.historySyncNotification,downloadOptions:n}}break;case S.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_REQUEST:case S.Message$ProtocolMessageType.APP_STATE_SYNC_KEY_SHARE:case S.Message$ProtocolMessageType.MSG_FANOUT_BACKFILL_REQUEST:case S.Message$ProtocolMessageType.INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:case S.Message$ProtocolMessageType.APP_STATE_FATAL_EXCEPTION_NOTIFICATION:e.subtype="unknown"}}function te(e){return e&&_.default.isWid(e)?(0,h.createWid)(e):e}function re(e){return e&&!e.includes("/u/")?e:void 0}function ne(e){return e?(0,o.encodeB64)(e):void 0}function ie(e,t,r){const n=te(t.destinationJid);e.id.remote=n,e.to=n,B(t.message,e,r)}function ae(e,t){const{documentMessage:r,imageMessage:n,locationMessage:i,videoMessage:a}=t;e.isFromTemplate=!0,r?z(e,r):n?j(e,n):i?V(e,i):a?J(e,a):(e.type=f.MSG_TYPE.CHAT,t.hydratedContentText&&(e.body=Me(t.hydratedContentText))),t.hydratedButtons&&oe(e,t),t.hydratedContentText&&(e.caption=Me(t.hydratedContentText)),t.hydratedFooterText&&(e.footer=Me(t.hydratedFooterText)),t.hydratedTitleText&&(e.title=Me(t.hydratedTitleText))}function oe(e,t){const{hydratedButtons:r}=t;r.length&&(e.hydratedButtons=r)}function se(e,t){e.body=Me(t.selectedDisplayText),e.selectedIndex=t.selectedIndex,e.selectedId=t.selectedId}function le(e,t){const{product:r,body:n,footer:i}=t;r&&(r.productImage&&j(e,r.productImage),e.type=f.MSG_TYPE.PRODUCT,e.businessOwnerJid=t.businessOwnerJid,e.productId=r.productId,e.currencyCode=r.currencyCode,e.priceAmount1000=r.priceAmount1000,e.salePriceAmount1000=r.salePriceAmount1000,e.retailerId=r.retailerId,e.url=r.url,e.productImageCount=r.productImageCount,e.title=r.title,e.description=r.description,e.caption=n,e.footer=i)}function ce(e,t,r){e.type="location",e.isLive=!0,e.lat=t.degreesLatitude,e.lng=t.degreesLongitude,e.body=ne(t.jpegThumbnail)||"",e.accuracy=t.accuracyInMeters,e.speed=t.speedInMps,e.degrees=t.degreesClockwiseFromMagneticNorth,e.comment=Me(t.caption),e.sequence=t.sequenceNumber,r&&(e.finalLat=r.degreesLatitude,e.finalLng=r.degreesLongitude,e.finalThumbnail=ne(r.jpegThumbnail)||"",e.finalAccuracy=r.accuracyInMeters,e.finalSpeed=r.speedInMps,e.finalDegrees=r.degreesClockwiseFromMagneticNorth,e.finalTimeOffset=r.timeOffset)}function de(e,t,r){if((null==r?void 0:r.futureproofed)||(0,G.hasUnsupportedCurrency)(r))e.type="unknown",e.subtype="phone_only_feature",__LOG__(2)`parseSendPaymentMessageProto: does not support novi transactions`;else{var n,i,a;e.type=f.MSG_TYPE.PAYMENT,e.subtype="send",t.background&&(e.paymentBackground=t.background),(null===(n=t.noteMessage)||void 0===n?void 0:n.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=B(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",(0,G.parseMsgPaymentInfo)(e,r);const o=t.requestMessageKey;o&&(e.paymentRequestMessageKey=function(e,t){if(!e)throw new Error("_getPaymentRequestMessageKey: no message key is defined");const{id:r}=e;if(!r)throw new Error("_getPaymentRequestMessageKey: no key id is defined");if(!t.id)return __LOG__(3)`_getPaymentRequestMessageKey: no message id is defined`,null;let n;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,C.getMeUser)()))&&"send"!==t.subtype)return null;n=te(e.participant)}return new p.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:r,participant:n})}(o,e))}}function ue(e,t,r){if((null==r?void 0:r.futureproofed)||(0,G.hasUnsupportedCurrency)(r))e.subtype="phone_only_feature",__LOG__(2)`parseRequestPaymentMessageProto: does not support novi transactions`;else{var n,i,a;if(e.type=f.MSG_TYPE.PAYMENT,(0,G.parseMsgPaymentInfo)(e,r),e.subtype="request",t.background&&(e.paymentBackground=t.background),(null===(n=t.noteMessage)||void 0===n?void 0:n.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=B(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",null!=t.amount){if(t.amount.currencyCode&&!e.paymentCurrency&&(e.paymentCurrency=t.amount.currencyCode),null!=t.amount.value&&!e.paymentAmount1000){const r=t.amount,n=null==r.offset||0===r.offset?1e3:r.offset;e.paymentAmount1000=1e3*parseFloat(r.value)/n}}else t.currencyCodeIso4217&&!e.paymentCurrency&&(e.paymentCurrency=t.currencyCodeIso4217),null==t.amount1000||e.paymentAmount1000||(e.paymentAmount1000=t.amount1000);t.requestFrom&&!e.paymentMessageReceiverJid&&(e.paymentMessageReceiverJid=te(t.requestFrom)),e.paymentStatus&&e.paymentTxnStatus||(0,G.isEitherSenderOrReceiverOfPaymentMessage)(e)&&(e.paymentStatus=U.PaymentInfoStatus.WAITING,e.paymentTxnStatus=U.PaymentInfoTxnStatus.COLLECT_INIT),null==t.expiryTimestamp||e.paymentExpiryTimestamp||(e.paymentExpiryTimestamp=t.expiryTimestamp)}}function pe(e,t){const r=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for decline payment request message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for decline payment request message");let n;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,C.getMeUser)()))&&"send"!==t.subtype)return null;n=te(e.participant)}return new p.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:r,participant:n})}(t.key,e);e.paymentRequestMessageKey=r,e.subtype="payment_action_request_declined"}function fe(e,t){const r=t.key;if(r){const t=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for cancel payment request message");const{id:r}=e;if(!r)throw new Error("parseProtocolMessageProto: no message id is defined for cancel payment request message");let n;var i;if(t.id.remote.isGroup())if(n=t.id.participant,t.id.fromMe)n=te(t.from);else if(!(null===(i=te(e.participant))||void 0===i?void 0:i.equals((0,C.getMeUser)())))return null;return new p.default({id:r,fromMe:t.id.fromMe,remote:t.id.remote,participant:n})}(r,e);e.paymentRequestMessageKey=t,e.subtype="payment_transaction_request_cancelled"}}function _e(e,t){t.serviceType===S.Message$PaymentInviteMessageServiceType.NOVI?(e.subtype="phone_only_feature",__LOG__(2)`[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions`):(e.type=f.MSG_TYPE.PAYMENT,e.subtype="invite",e.paymentExpiryTimestamp=t.expiryTimestamp,e.paymentInviteServiceType=t.serviceType,__LOG__(2)`[payment-invite] render payment invite of type ${t.serviceType}`)}function he(e,t){e.comment=t.caption,e.inviteCode=t.inviteCode,e.inviteCodeExp=t.inviteExpiration,e.inviteGrp=t.groupJid,e.inviteGrpName=t.groupName,e.type=f.MSG_TYPE.GROUPS_V4_INVITE}function ge(e,t){e.type=f.MSG_TYPE.ORDER,e.thumbnail=ne(t.thumbnail),e.message=t.message||"",e.orderId=t.orderId,e.itemCount=t.itemCount||0,e.status=t.status,e.surface=t.surface,e.sellerJid=t.sellerJid,e.orderTitle=t.orderTitle||"",e.token=t.token||"",e.totalAmount1000=t.totalAmount1000,e.totalCurrencyCode=t.totalCurrencyCode,e.body=""}function me(e,t){var r,n;N.ServerProps.webListMessage&&t.listType===S.Message$ListMessageListType.SINGLE_SELECT||(0,b.productListMessagesEnabled)()&&t.listType===S.Message$ListMessageListType.PRODUCT_LIST?(e.type=f.MSG_TYPE.LIST,e.list=t,e.footer=t.footerText,t.listType===S.Message$ListMessageListType.PRODUCT_LIST&&(e.businessOwnerJid=null===(r=t.productListInfo)||void 0===r?void 0:r.businessOwnerJid,e.productListItemCount=null===(n=t.productListInfo)||void 0===n?void 0:n.productSections.reduce(((e,t)=>e+t.products.length),0))):(t.listType===S.Message$ListMessageListType.PRODUCT_LIST&&(0,b.productListMessageFallbackEnabled)()&&(e.subtype="phone_only_feature"),e.type=f.MSG_TYPE.UNKNOWN)}function ye(e,t){if(N.ServerProps.webListMessage&&t.listType===S.Message$ListResponseMessageListType.SINGLE_SELECT){e.type=f.MSG_TYPE.LIST_RESPONSE,e.listResponse=(0,i.default)((0,i.default)({},t),{},{contextInfo:void 0});let r=t.title||"";t.description&&(r+="\n"+t.description),e.body=Me(r)}}function Ee(e,t){let{selectedDisplayText:r,selectedButtonId:n,type:i}=t;(0,b.buttonsMessagesEnabled)()&&i===S.Message$ButtonsResponseMessageType.DISPLAY_TEXT?(e.type=f.MSG_TYPE.BUTTONS_RESPONSE,e.selectedButtonId=n,e.body=Me(r)):e.type=f.MSG_TYPE.UNKNOWN}function Se(e,t){N.ServerProps.viewOnceRead?B(t.message,e):(e.type=f.MSG_TYPE.UNKNOWN,e.subtype="phone")}function ve(e,t){B(t.message,e)}function Te(e,t,r){if(!(0,b.buttonsMessagesEnabled)())return void(e.type=f.MSG_TYPE.UNKNOWN);const{documentMessage:n,imageMessage:a,locationMessage:o,videoMessage:s,contentText:l,footerText:c,text:d,buttons:u=[],headerType:p}=t,_=R.default.cast((0,G.getBizNativeFlowName)({buttonsMessage:t}));if(!(0,G.shouldParseNFM)(_,r)||(0,G.hasUnsupportedButtons)(u))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(p!==S.Message$ButtonsMessageHeaderType.UNKNOWN&&new Set(S.Message$ButtonsMessageHeaderType.members()).has(p)){if(e.type=f.MSG_TYPE.CHAT,e.headerType=p,a?j(e,a):n?z(e,n):o?V(e,(0,i.default)((0,i.default)({},o),{},{name:void 0,address:void 0})):s?J(e,s):(d&&(e.title=Me(d)),l&&(e.body=Me(l))),null==_)u.length&&(e.isDynamicReplyButtonsMsg=!0,e.dynamicReplyButtons=u);else{var h;if(e.type=f.MSG_TYPE.NATIVE_FLOW,e.nativeFlowName=R.default.cast(_),e.nativeFlowButtons=u,!e.nativeFlowName||!(0,w.isValidNativeFlowMessage)(e))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(e.nativeFlowName===R.default.ORDER_STATUS&&!(0,D.validateOrderAndSendReceipt)(null===(h=e.id)||void 0===h?void 0:h.remote,e))return void(e.subtype="non_renderable")}l&&(e.caption=Me(l)),c&&(e.footer=Me(c))}else e.type=f.MSG_TYPE.UNKNOWN}function Ce(e,t){if(null==e.from)return;const r=e.from.equals((0,C.getMeUser)());if(null!=t.initiator)switch(t.initiator){case S.DisappearingModeInitiator.CHANGED_IN_CHAT:e.disappearingModeInitiator=E.DisappearingModeInitiator.ChangedInChat;break;case S.DisappearingModeInitiator.INITIATED_BY_ME:e.disappearingModeInitiator=r?E.DisappearingModeInitiator.InitiatedByMe:E.DisappearingModeInitiator.InitiatedByOther;break;case S.DisappearingModeInitiator.INITIATED_BY_OTHER:e.disappearingModeInitiator=r?E.DisappearingModeInitiator.InitiatedByOther:E.DisappearingModeInitiator.InitiatedByMe}}function Ae(e,t,r){var n;const i=(0,G.getInteractiveMessageTypeForProto)(t);if(!i||!(0,G.isInteractiveMessageTypeEnabled)(i))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");const{body:a,footer:o}=t,s=(0,G.getInteractiveMessageFieldNameForType)(i),l={type:f.MSG_TYPE.INTERACTIVE,caption:null!==(n=Me(null==a?void 0:a.text))&&void 0!==n?n:"",interactiveType:i,interactivePayload:t[s]};if(!(0,G.isSupportedInteractiveMessageVersion)(l))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(i===O.default.NATIVE_FLOW){var c;if(l.nativeFlowName=R.default.cast((0,G.getBizNativeFlowName)({interactiveMessage:t})),!(0,G.isValidNativeFlowName)(l.nativeFlowName,r)||!(0,w.isValidNativeFlowMessage)(l))return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(l.nativeFlowName===R.default.ORDER_STATUS&&!(0,D.validateOrderAndSendReceipt)(null===(c=e.id)||void 0===c?void 0:c.remote,l))return void(e.subtype="non_renderable")}o&&(l.footer=Me(o.text)),function(e,t){let{header:r}=t;if(!r)return;const n={title:Me(r.title),subtitle:Me(r.subtitle),thumbnail:ne(r.jpegThumbnail),mediaType:void 0,hasMediaAttachment:Boolean(r.hasMediaAttachment)};n.hasMediaAttachment&&(r.documentMessage?(z(e,r.documentMessage),n.mediaType=M.InteractiveMessageHeaderMediaType.DOCUMENT):r.videoMessage?(J(e,r.videoMessage),n.mediaType=M.InteractiveMessageHeaderMediaType.VIDEO):r.imageMessage&&(j(e,r.imageMessage),n.mediaType=M.InteractiveMessageHeaderMediaType.IMAGE)),e.interactiveHeader=n}(e,t),Object.assign(e,l)}function be(e){const t=e.text;return null==t||t.length<=d.default.REACTION_CONTENT_MAX_LENGTH}function Pe(e,t){if(!(0,b.receiveReactionsEnabled)())return e.type=f.MSG_TYPE.UNKNOWN,void(e.subtype="reaction");if(!be(t))throw new T.ReactionValidationError("[messaging] Reaction failed validation");const r=Me(t.text);e.type=f.MSG_TYPE.REACTION,e.reactionParentKey=Z(t.key,e),e.reactionText=r,e.reactionTimestamp=t.senderTimestampMs}function Me(e){return e?y.Conn.platform===y.PLATFORMS.ANDROID?e:v.EmojiUtil.convertToTextWithoutSpecialEmojis(e):e}function Oe(e,t){var r;if(!A.GK.supportsFeature(A.GK.F.LOG_INCOMING_MSG_MISSING_REQUIRED_PROPERTIES))return;if(Math.random()>.001)return;if(!e.id)return;if("status"===(null===(r=e.id.remote)||void 0===r?void 0:r.user)&&_.default.isPSA(e.author)&&!t.staticUrl)return;if(e.id.fromMe)return;const n=e.type;null==t.directPath&&null==t.fileEncSha256?(__LOG__(2,void 0,void 0,!0)`directPath and fileEncSha256 missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-direct-path-and-file-enc`)):null==t.directPath?(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-direct-path`)):null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-file-enc`)),null==t.url&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) is missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-mms3-url`)),null==t.mediaKey&&(__LOG__(2,void 0,void 0,!0)`mediaKey is missing from msg type ${n}`,SEND_LOGS(`${n}-message-missing-media-key`))}},93650:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBizNativeFlowName=function(e){var t,r,n,i,a,o;if(1===(null===(t=e.interactiveMessage)||void 0===t||null===(r=t.nativeFlowMessage)||void 0===r||null===(n=r.buttons)||void 0===n?void 0:n.length))return(0,f.getNativeFlowNameByButtonName)(e.interactiveMessage.nativeFlowMessage.buttons[0].name);if(1===(null===(i=e.buttonsMessage)||void 0===i||null===(a=i.buttons)||void 0===a?void 0:a.length))return(0,f.getNativeFlowNameByButtonName)(null===(o=e.buttonsMessage.buttons[0].nativeFlowInfo)||void 0===o?void 0:o.name)},t.getInteractiveMessageFieldNameForType=m,t.getInteractiveMessageTypeForProto=function(e){for(const t of p.default.members())if(m(t)in e)return t;return null},t.hasUnsupportedButtons=function(e){return e.some((e=>e.nativeFlowInfo&&g.includes(e.nativeFlowInfo.name)||g.includes(e.buttonId)))},t.hasUnsupportedCurrency=function(e){var t;const r=(null==e||null===(t=e.primaryAmount)||void 0===t?void 0:t.currencyCode)||(null==e?void 0:e.currency);if(["XUS","XDX","USDP"].includes(null==r?void 0:r.toUpperCase()))return!0;return!1},t.isEitherSenderOrReceiverOfPaymentMessage=function(e){var t,r;if((null===(t=e.id)||void 0===t?void 0:t.remote.isGroup())&&!(null===(r=e.id)||void 0===r?void 0:r.participant.equals((0,c.getMeUser)()))&&!e.paymentMessageReceiverJid.equals((0,c.getMeUser)()))return!1;return!0},t.isInteractiveMessageTypeEnabled=function(e){switch(e){case p.default.NATIVE_FLOW:return(0,d.interactiveNativeFlowMessagesEnabled)();case p.default.SHOPS_STOREFRONT:return(0,d.shopsInteractiveMessageEnabled)()}},t.isSupportedInteractiveMessageVersion=function(e){let{interactivePayload:t,interactiveType:r}=e;const n=null==t?void 0:t.messageVersion;if(null==n||null==r)return!1;switch(r){case p.default.NATIVE_FLOW:case p.default.SHOPS_STOREFRONT:return n<=1}},t.isValidNativeFlowName=h,t.msgKeyToProtobuf=function(e){var t;return{fromMe:e.fromMe,id:e.id,participant:e.fromMe||null===(t=e.participant)||void 0===t?void 0:t.toString({legacy:!0}),remoteJid:e.remote.toString({legacy:!0})}},t.parseMsgPaymentInfo=function(e,t){t&&(e.paymentStatus=t.status,e.paymentTxnStatus=t.txnStatus,e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.amount1000),"maybeNumberOrThrowIfTooLarge(paymentInfo.amount1000)"),e.paymentMessageReceiverJid=(0,s.createWid)((0,a.default)(t.receiverJid,"paymentInfo.receiverJid")),e.paymentExpiryTimestamp=(0,i.maybeNumberOrThrowIfTooLarge)(t.expiryTimestamp),e.paymentTransactionTimestamp=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.transactionTimestamp),"maybeNumberOrThrowIfTooLarge(paymentInfo.transactionTimestamp)"))},t.protobufToMsgKey=function(e){const{fromMe:t,id:r,participant:n,remoteJid:i}=e;(0,l.default)(null!=t&&null!=i&&null!=r,"fromMe, remoteJid, and id should be set");let a=null!=n&&(0,s.isWidlike)(n)?(0,s.createWid)(n):void 0;const d=(0,s.createWid)(i);(d.isGroup()||d.isBroadcast())&&t&&(a=(0,c.getMaybeMeUser)());return new o.default({fromMe:t,id:r,participant:a,remote:(0,s.createWid)(i)})},t.shouldParseNFM=function(e,t){if(null!=e||null!=(null==t?void 0:t.nativeFlowName))return!!(0,d.nativeFlowMessagesEnabled)()&&h(e,t);return!0},t.typeAttributeFromProtobuf=function e(t){if(t.ephemeralMessage){const{message:r}=t.ephemeralMessage;return r?e(r):u.MSG_TYPES.text}if(t.deviceSentMessage){const{message:r}=t.deviceSentMessage;return r?e(r):u.MSG_TYPES.text}if(t.reactionMessage)return u.MSG_TYPES.reaction;if(t.conversation||t.extendedTextMessage||t.templateButtonReplyMessage||t.protocolMessage||t.interactiveMessage)return u.MSG_TYPES.text;return u.MSG_TYPES.media},t.validateWaveform=function(e){return e.byteLength>=64&&e.byteLength<=192};var i=r(8243),a=n(r(45095)),o=n(r(65212)),s=r(45454),l=n(r(41143)),c=r(99234),d=r(57701),u=r(12037),p=n(r(84064)),f=r(26287),_=n(r(5165));function h(e,t){return null==e&&null==(null==t?void 0:t.nativeFlowName)||null==(null==t?void 0:t.nativeFlowName)||null!=e&&_.default.cast(t.nativeFlowName)===e}const g=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail","wa_payment_transaction_details","wa_payment_learn_more","wa_payment_fbpin_reset"];function m(e){switch(e){case p.default.NATIVE_FLOW:return"nativeFlowMessage";case p.default.SHOPS_STOREFRONT:return"shopStorefrontMessage"}}},55878:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptGroupSignalProto=function(){return p.apply(this,arguments)},t.decryptSignalProto=function(){return d.apply(this,arguments)},t.encryptSenderKeyMsgSignalProto=function(){return f.apply(this,arguments)},t.encryptSignalProto=function(){return u.apply(this,arguments)};var i=n(r(48926)),a=r(8001),o=r(99234),s=r(45033),l=r(52083),c=r(93832);function d(){return(d=(0,i.default)((function*(e,t,r){const n=new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e));try{const e=yield Promise.resolve(n);let i;switch(t){case s.CiphertextType.Pkmsg:i=yield e.decryptPreKeyWhisperMessage(r);break;case s.CiphertextType.Msg:i=yield e.decryptWhisperMessage(r);break;default:return Promise.reject(new Error(`decryptSignalProto: Received unsupported msg type ${t}`))}return i}catch(e){if(e&&"call_failure"===e.reason&&e.value&&"number"==typeof e.value.result)__LOG__(3)`decryptSignalProto error code ${e.value.result}`;else{if(e&&"MessageCounterError"===e.name)return Promise.reject(new a.SignalMessageCounterError(e));__LOG__(3)`decryptSignalProto js error ${e}`}return Promise.reject(new a.SignalDecryptionError(e))}}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){const r=yield new window.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e)),{type:n,body:i}=yield r.encrypt(t);return __LOG__(2)`encryptSignalProto complete, type=${n}`,{type:3===n?s.CiphertextType.Pkmsg:s.CiphertextType.Msg,ciphertext:(0,c.strToBuffer)(i)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,r){try{const n=yield new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)(t));return yield n.decryptSenderKeyMessage(r)}catch(e){if(e&&"MessageCounterError"===e.name)throw new a.SignalMessageCounterError(e);throw new a.SignalDecryptionError(e)}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const r=new window.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)((0,o.assertGetMe)())),n=yield Promise.resolve(r).then((e=>e.encrypt(t)));return{ciphertext:(0,c.strToBuffer)(n)}}))).apply(this,arguments)}},8001:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalMessageCounterError=t.SignalDecryptionError=void 0;var n=r(40265);class i extends((0,n.customError)("SignalDecryptionError")){}t.SignalDecryptionError=i;class a extends((0,n.customError)("SignalMessageCounterError")){}t.SignalMessageCounterError=a},11849:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waSignalStore=void 0;var n=r(88102),i=r(318),a=r(77246);const o="signal_reg_id",s="signal_static_pubkey",l="signal_static_privkey",c="signal_next_pk_id",d="signal_last_spk_id",u="signal_first_unupload_pk_id",p="signal_sever_has_pre_keys",f="adv_signed_identity",_={name:"AES-CTR",length:128,counter:new Uint8Array(16)};function h(e){return self.crypto.subtle.generateKey({name:_.name,length:_.length},!1,["encrypt","decrypt"]).then((t=>self.crypto.subtle.encrypt(_,t,e).then((e=>({encKey:t,value:e})))))}function g(e){return self.crypto.subtle.decrypt(_,e.encKey,e.value)}const m=new class{constructor(){this.idToSignedPreKey=new Map,n.Cmd.on("logout",(()=>{this.registrationInfo=void 0,this.idToSignedPreKey.clear()}))}getMeta(e){return(0,i.getMetaTable)().get(e).then((e=>e?e.value:null))}putMeta(e){const t=(0,i.getMetaTable)(),r=e.map((e=>t.createOrReplace(e)));return Promise.all(r).then()}setServerHasPreKeys(e){this.putMeta([{key:p,value:e}])}getServerHasPreKeys(){return this.getMeta(p)}putADVSignedIdentity(e){return this.putMeta([{key:f,value:e}])}getADVSignedIdentity(){return this.getMeta(f)}getPreKeysByRange(e,t){return(0,i.getPreKeyTable)().greaterThan(["keyId"],e-1,{limit:t})}getPreKeyById(e){return(0,i.getPreKeyTable)().get(e)}removePreKeyById(e){return(0,i.getPreKeyTable)().remove(e)}bulkRemovePreKey(e){return(0,i.getPreKeyTable)().bulkRemove(e)}putPreKeys(e){const t=(0,i.getPreKeyTable)(),r=e.map((e=>{const{keyId:r,keyPair:n,isDirectDistribution:i}=e;return t.get(r).then((e=>{if(e)throw Error(`preKey id ${r} already exists`);return t.create({keyId:r,keyPair:n,isDirectDistribution:i})}))}));return Promise.all(r).then()}markPreKeyAsDirectDistribution(e){return(0,i.getPreKeyTable)().merge(e,{isDirectDistribution:1})}getSignedPreKey(){return this.getMeta(d).then((e=>this.getSignedPreKeyById(e)))}getSignedPreKeyById(e){if(this.idToSignedPreKey.has(e))return Promise.resolve(this.idToSignedPreKey.get(e));return(0,i.getSignedPreKeyTable)().get(e).then((t=>(this.idToSignedPreKey.set(e,t),t)))}putSignedPreKeys(e){const t=(0,i.getSignedPreKeyTable)(),r=e.map((e=>{const{keyId:r,keyPair:n,signature:i}=e;return t.get(r).then((e=>{if(e)throw Error(`signed preKey id ${r} already exists`);return t.create({keyId:r,keyPair:n,signature:i})}))}));return Promise.all(r).then()}putSession(e,t){return(0,i.getSessionTable)().createOrReplace({address:e,session:t})}bulkPutSession(e){return(0,i.getSessionTable)().bulkCreateOrReplace(e)}removeSession(e){return(0,i.getSessionTable)().remove(e)}bulkRemoveSession(e){return(0,i.getSessionTable)().bulkRemove(e)}getSession(e){return(0,i.getSessionTable)().get(e).then((e=>e?e.session:null))}bulkGetSession(e){return(0,i.getSessionTable)().bulkGet(e).then((e=>e.map((e=>e?e.session:null))))}putIdentity(e,t){return(0,i.getIdentityTable)().createOrReplace({identifier:e,identityKey:t})}bulkPutIdentity(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}bulkGetIdentity(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?e.identityKey:null))))}getIdentity(e){return(0,i.getIdentityTable)().get(e).then((e=>e?e.identityKey:null))}removeIdentity(e){return(0,i.getIdentityTable)().remove(e)}bulkRemoveIdentity(e){return(0,i.getIdentityTable)().bulkRemove(e)}getIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().get(e).then((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))}bulkGetIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))))}bulkPutIdentityKeyWithRowId(e){return(0,i.getIdentityTable)().bulkCreateOrReplace(e)}saveBaseKey(e,t,r){return(0,i.getBaseKeyTable)().createOrReplace({address:e,originalMsgId:t,baseKey:r})}loadBaseKey(e,t){return(0,i.getBaseKeyTable)().equals(["address","originalMsgId"],[e,t]).then((e=>e&&0!==e.length?e[0].baseKey:null))}deleteBaseKey(e,t){const r=(0,i.getBaseKeyTable)();return r.equals(["address","originalMsgId"],[e,t]).then((e=>{if(e&&0!==e.length)return r.remove(e[0].id)}))}putSenderKey(e,t,r){return(0,i.getSenderKeyTable)().createOrReplace({senderKeyName:e,senderId:t,senderKey:r})}bulkPutSenderKey(e){return(0,i.getSenderKeyTable)().bulkCreateOrReplace(e)}removeSenderKey(e){return(0,i.getSenderKeyTable)().remove(e)}getSenderKey(e){return(0,i.getSenderKeyTable)().get(e).then((e=>e?e.senderKey:null))}removeSenderKeyBySenderId(e){const t=(0,i.getSenderKeyTable)();return t.equals(["senderId"],e).then((e=>t.bulkRemove(e.map((e=>e.senderKeyName)))))}clearCredential(){const e=[(0,i.getIdentityTable)(),(0,i.getMetaTable)(),(0,i.getPreKeyTable)(),(0,i.getSessionTable)(),(0,i.getSignedPreKeyTable)()];return Promise.all(e.map((e=>e.clear()))).then((()=>{}))}getRegistrationInfo(){return null!=this.registrationInfo?Promise.resolve(this.registrationInfo):Promise.all([this.getMeta(o),this.getMeta(s),this.getMeta(l)]).then((e=>{let[t,r,n]=e;if(t&&r&&n)return Promise.all([g(r),g(n)]).then((e=>{let[r,n]=e;return this.registrationInfo={registrationId:t,identityKeyPair:{pubKey:r,privKey:n}},this.registrationInfo}))}))}setRegistrationInfo(e){return Promise.all([h(e.identityKeyPair.pubKey),h(e.identityKeyPair.privKey)]).then((t=>{let[r,n]=t;return Promise.all([this.putMeta([{key:o,value:e.registrationId},{key:s,value:r},{key:l,value:n}])]).then()}))}getOrGenPreKeys(e,t){return(0,a.getStorage)().lock(["signal-meta-store","prekey-store"],(()=>Promise.all([this.getMeta(u),this.getMeta(c)]).then((r=>{let[n,i]=r;const a=n||1,o=i||1,s=o-a,l=e-s;if(l<=0)return __LOG__(2)`getPreKeys: no prekey needs to be generated, avaliable: ${s}, need: ${e}`,this.getPreKeysByRange(a,e);const c=function(e,t){const r=[];for(let n=e;n<t;n++)r.push(n);return r}(o,o+l).map((e=>t(e)));return Promise.all(c).then((e=>this.savePreKeys(e))).then((()=>this.getPreKeysByRange(a,e)))}))))}getOrGenSinglePreKey(e){return this.getOrGenPreKeys(1,e).then((e=>{if(1!==e.length)throw Error("Expected to get exactly one key but got ${keys.length}");return e[0]}))}savePreKeys(e){if(0===e.length)return Promise.resolve();const t=e[e.length-1];return Promise.all([this.putMeta([{key:c,value:t.keyId+1}]),this.putPreKeys(e)]).then()}markKeyAsUploaded(e){return Promise.all([this.getMeta(u),this.getMeta(c)]).then((t=>{let[r,n]=t;if(e<0||!n||e>=n)throw Error(`markKeyAsUploaded: key ${e} is out of boundary.`);const i=r?Math.max(r,e+1):e+1;return this.putMeta([{key:u,value:i}])}))}rotateSignedPreKey(e,t){return(0,a.getStorage)().lock(["signal-meta-store","signed-prekey-store"],(()=>this.getMeta(d).then((r=>{const n=null==r?1:r+1;return t(e,n).then((e=>(this.putSignedPreKeys([e]),this.putMeta([{key:d,value:n}]),e)))}))))}};t.waSignalStore=m},93832:(e,t)=>{"use strict";function r(e,t){for(let r=0;r<t;r++)e.writeUint8(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.bufferEqual=function(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const r=new DataView(e),n=new DataView(t);for(let e=0;e<r.byteLength;e++)if(r.getUint8(e)!==n.getUint8(e))return!1;return!0},t.bufferToStr=function(e){return new window.dcodeIO.ByteBuffer.wrap(e).toString("binary")},t.createSignalAddress=function(e){if(!(e.isUser()||e.isServer()||e.isPSA()))throw new Error(`Jid ${e.toString({legacy:!0})} is not fully qualified, jid.server should be "s.whatsapp.net"`);return new window.libsignal.SignalProtocolAddress(e.getSignalAddress(),0)},t.strToBuffer=function(e){return new window.dcodeIO.ByteBuffer.wrap(e,"binary").toArrayBuffer()},t.unpad=function(e){const t=new Uint8Array(e);if(0===t.length)throw new Error("unpadPkcs7 given empty bytes");const r=t[t.length-1];if(r>t.length)throw new Error(`unpad given ${t.length} bytes, but pad is ${r}`);return new Uint8Array(t.buffer,t.byteOffset,t.length-r)},t.writePad=r,t.writeRandomPadMax16=function(e){const t=new Uint8Array(1);self.crypto.getRandomValues(t),r(e,1+(15&t[0]))}},77605:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.KeyGenerator=t.Cipher=void 0;var n=s(r(58425)),i=s(r(55878)),a=s(r(54084));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}const l=n;t.KeyGenerator=l;const c=i;t.Cipher=c;const d=a;t.Session=d},58425:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIdentityKeyPair=function(){return l.apply(this,arguments)},t.generatePreKeyPair=function(){return o.apply(this,arguments)},t.generateSignedKeyPair=function(){return s.apply(this,arguments)};var i=n(r(48926)),a=r(5087);function o(){return(o=(0,i.default)((function*(e){const t=yield window.libsignal.KeyHelper.generatePreKey(e),{keyId:r,keyPair:n}=t;return{keyId:r,keyPair:(0,a.toCurveKeyPair)(n),isDirectDistribution:0}}))).apply(this,arguments)}function s(){return(s=(0,i.default)((function*(e,t){const r=yield window.libsignal.KeyHelper.generateSignedPreKey(e,t),{keyId:n,keyPair:i,signature:o}=r;return{keyId:n,keyPair:(0,a.toCurveKeyPair)(i),signature:o}}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){const e=yield window.libsignal.KeyHelper.generateIdentityKeyPair();return(0,a.toCurveKeyPair)(e)}))).apply(this,arguments)}},46361:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyIdentityKey=function(e){if(e instanceof ArrayBuffer)return(0,n.bufferToStr)(e);return e};var n=r(93832)},52083:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.enableMemSignalStore=function(){o=i.default},t.enablePersistSignalStore=function(){o=a.default},t.getSignalProtocolStore=function(){return o};var i=n(r(54624)),a=n(r(76128));let o=a.default},54624:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(50361)),o=r(88102),s=r(46361),l=r(5087),c=r(99234),d=r(1291),u=r(11849),p=r(93832);var f=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.PrekeyStore=new Map,this.SenderKeyStore=new Map,o.Cmd.on("logout",(()=>{this.cleanStorage()}))}getIdentityKeyPair(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfo.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}loadIdentityKey(e){var t=this;return(0,i.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityStore.has(e)){const r=yield u.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityStore.set(e,r)}return(null===(r=t.IdentityStore.get(e))||void 0===r?void 0:r.identityKey)||void 0}))()}saveIdentity(e,t){var r=this;return(0,i.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to put identity key for undefined/null key"));const n=(0,s.stringifyIdentityKey)(t),i=yield r.loadIdentityKey(e);i&&i===n||(i&&e===(0,p.createSignalAddress)((0,c.getMeUser)()).toString()?(0,d.handleSelfPrimaryIdentityChange)():r.putIdentity(e,n))}))()}putIdentity(e,t){this.IdentityStore.set(e,{identityKey:t})}removeIdentity(e){return null==e?Promise.reject(new Error("Tried to remove identity key for undefined/null key")):(this.IdentityStore.set(e,{deleted:!0}),Promise.resolve())}loadPreKey(e){var t=this;return(0,i.default)((function*(){if(null==e)return;if(!t.PrekeyStore.has(e)){var r;const n=null===(r=yield u.waSignalStore.getPreKeyById(e))||void 0===r?void 0:r.keyPair;t.PrekeyStore.set(e,{keyPair:n})}const n=t.PrekeyStore.get(e);return(null==n?void 0:n.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):(this.PrekeyStore.set(e,{deleted:!0}),Promise.resolve())}loadSignedPreKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SignedPreKeyStore.has(e)){var r;const n=null===(r=yield u.waSignalStore.getSignedPreKeyById(e))||void 0===r?void 0:r.keyPair;t.SignedPreKeyStore.set(e,n)}return t.SignedPreKeyStore.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,i.default)((function*(){var r;if(null!=e){if(!t.SessionStore.has(e)){const r=yield u.waSignalStore.getSession(e);t.SessionStore.set(e,r?{session:r}:void 0)}return(null===(r=t.SessionStore.get(e))||void 0===r?void 0:r.session)||void 0}}))()}storeSession(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SessionStore.set(e,{session:t}),Promise.resolve())}removeSession(e){return null==e?Promise.reject(new Error("Tried to remove session without identifier")):(this.SessionStore.set(e,{deleted:!0}),Promise.resolve())}storeSenderKey(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SenderKeyStore.set(e,t),Promise.resolve())}loadSenderKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SenderKeyStore.has(e)){const r=yield u.waSignalStore.getSenderKey(e);t.SenderKeyStore.set(e,r)}return t.SenderKeyStore.get(e)||void 0}}))()}cleanStorage(){this.RegistrationInfo=null,this.SessionStore.clear(),this.IdentityStore.clear(),this.PrekeyStore.clear(),this.SignedPreKeyStore.clear(),this.SenderKeyStore.clear()}_generateSessionUpdate(){const e=[],t=[];return Array.from(this.SessionStore.keys()).forEach((r=>{const n=this.SessionStore.get(r);n&&(n.deleted?t.push(r):e.push({address:r,session:(0,a.default)(n.session)}))})),{update:e,remove:t}}_generateSenderKeyUpdate(){const e=[];return Array.from(this.SenderKeyStore.keys()).forEach((t=>{const r=this.SenderKeyStore.get(t);if(r){const n=t.split("::");2===n.length&&e.push({senderKeyName:t,senderId:n[1],senderKey:(0,a.default)(r)})}})),e}_generateIdentityUpdate(){const e=[],t=[];return Array.from(this.IdentityStore.keys()).forEach((r=>{const n=this.IdentityStore.get(r);n&&(n.deleted?t.push(r):e.push({identifier:r,identityKey:n.identityKey,rowId:n.rowId}))})),{update:e,remove:t}}_generatePreKeyUpdate(){const e=[];return Array.from(this.PrekeyStore.keys()).forEach((t=>{const r=this.PrekeyStore.get(t);(null==r?void 0:r.deleted)&&e.push(parseInt(t,10))})),e}generateSnapshot(){const e=this._generateIdentityUpdate(),t=this._generateSessionUpdate();return{sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this._generateSenderKeyUpdate(),preKeyRemove:this._generatePreKeyUpdate()}}flushBufferToDiskIfNotMemOnlyMode(){return Promise.resolve()}};t.default=f},76128:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(97197),s=r(46361),l=r(5087),c=r(99234),d=r(57701),u=r(1291),p=r(11849),f=r(77246),_=r(93832);var h=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache=new Map,this.SessionCache=new Map,this.SessionCacheDirtySet=new Set,this._sessionMutex=new o.Semaphore(1),this.IdentityCache=new Map,this.IdentityCacheDirtySet=new Set,this._identityMutex=new o.Semaphore(1)}getIdentityKeyPair(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.identityKeyPair)?(0,l.toSignalCurveKeyPair)(e.RegistrationInfoReadThruCache.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield p.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}saveIdentity(e,t){var r=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to put identity key for undefined/null key");const n=(0,s.stringifyIdentityKey)(t),i=yield r.loadIdentityKey(e);if(!i||i!==n){if(i){if(e===(0,_.createSignalAddress)((0,c.getMeUser)()).toString())return void(0,u.handleSelfPrimaryIdentityChange)();yield(0,u.handleNewIdentity)(e)}yield r.putIdentity(e,n)}}))()}_putIdentityImpl(e,t){const r=this.IdentityCache.get(e);this.IdentityCache.set(e,(0,i.default)((0,i.default)({},r),{},{identityKey:t})),this.IdentityCacheDirtySet.add(e)}putIdentity(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._identityMutex.acquire();try{(0,d.identityStoreCacheEnabled)()?r._putIdentityImpl(e,t):(yield p.waSignalStore.putIdentity(e,t),r.IdentityCache.set(e,{identityKey:t}))}finally{n.release()}}))()}_loadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityCache.has(e)){const r=yield p.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityCache.set(e,r)}return(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.identityKey)||void 0}))()}loadIdentityKey(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{return yield t._loadIdentityKeyImpl(e)}finally{r.release()}}))()}getIdentityRowId(e){var t=this;return(0,a.default)((function*(){var r;if(null==e)throw new Error("Tried to get identity key for undefined/null key");return yield t.loadIdentityKey(e),(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.rowId)||void 0}))()}bulkGetIdentityRowId(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");return 0===e.length?[]:(yield t.bulkLoadIdentityKey(e),e.map((e=>{var r;return(null===(r=t.IdentityCache.get(e))||void 0===r?void 0:r.rowId)||void 0})))}))()}_bulkLoadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(0===e.length)return[];const r=new Array(e.length),n=[];if(e.forEach(((e,i)=>{var a;t.IdentityCache.has(e)?r[i]=null===(a=t.IdentityCache.get(e))||void 0===a?void 0:a.identityKey:n.push({id:e,pos:i})})),n.length>0){(yield p.waSignalStore.bulkGetIdentityKeyWithRowId(n.map((e=>e.id)))).forEach(((e,i)=>{const a=n[i];t.IdentityCache.set(a.id,e),r[a.pos]=null==e?void 0:e.identityKey}))}return r}))()}bulkLoadIdentityKey(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{return yield t._bulkLoadIdentityKeyImpl(e)}finally{r.release()}}))()}_bulkCreateIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to bulk put identity key with undefined/null");__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s): start`,yield(0,f.getStorage)().lock(["identity-store"],(0,a.default)((function*(){const r=e.map((e=>e.identifier)),n=yield t._bulkLoadIdentityKeyImpl(r),i=e.filter(((e,t)=>!n[t]));i.length>0&&(yield p.waSignalStore.bulkPutIdentity(i),i.forEach((e=>{let{identifier:r,identityKey:n}=e;t.IdentityCache.set(r,{identityKey:n})}))),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s) (new: ${i.length}): end`})))}))()}bulkCreateIdentity(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{yield t._bulkCreateIdentityImpl(e)}finally{r.release()}}))()}_removeIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove identity key for undefined/null key"));yield p.waSignalStore.removeIdentity(e),t.IdentityCache.delete(e),t.IdentityCacheDirtySet.delete(e)}))()}removeIdentity(e){var t=this;return(0,a.default)((function*(){const r=yield t._identityMutex.acquire();try{yield t._removeIdentityImpl(e)}finally{r.release()}}))()}loadPreKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);const t=yield p.waSignalStore.getPreKeyById(e);return(null==t?void 0:t.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):p.waSignalStore.removePreKeyById(e)}loadSignedPreKey(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SignedPreKeyStoreReadThruCache.has(e)){var r;const n=null===(r=yield p.waSignalStore.getSignedPreKeyById(e))||void 0===r?void 0:r.keyPair;t.SignedPreKeyStoreReadThruCache.set(e,n)}return t.SignedPreKeyStoreReadThruCache.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SessionCache.has(e)){const r=yield p.waSignalStore.getSession(e);t.SessionCache.set(e,r)}return t.SessionCache.get(e)||void 0}}))()}_storeSessionImpl(e,t){if(null==e)throw new Error("Tried to put session without identifier");this.SessionCache.set(e,t),this.SessionCacheDirtySet.add(e)}storeSession(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._sessionMutex.acquire();return r._storeSessionImpl(e,t),n.release(),Promise.resolve()}))()}removeSession(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove session without identifier"));yield p.waSignalStore.removeSession(e),t.SessionCache.delete(e),t.SessionCacheDirtySet.delete(e)}))()}containSessions(e){var t=this;return(0,a.default)((function*(){const r=[];for(const n of e)t.SessionCache.has(n)||r.push(n);if(r.length>0){(yield p.waSignalStore.bulkGetSession(r)).forEach(((e,n)=>{const i=r[n];t.SessionCache.set(i,e)}))}return e.map((e=>!!t.SessionCache.get(e)))}))()}storeSenderKey(e,t){if(null==e)return Promise.reject(new Error("Tried to put senderKey without senderKeyName"));const r=e.split("::");if(r.length<2)return Promise.reject(new Error("Tried to put senderKey with invalid senderKeyName"));const n=r[1];return p.waSignalStore.putSenderKey(e,n,t)}loadSenderKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);return(yield p.waSignalStore.getSenderKey(e))||void 0}))()}deleteAllCache(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`deleteAllCache`,this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache.clear(),this.SessionCache.clear(),this.IdentityCache.clear(),this.SessionCacheDirtySet.clear(),this.IdentityCacheDirtySet.clear()}_flushSessions(){var e=this;return(0,a.default)((function*(){if(0===e.SessionCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: get dirty updates for ${Array.from(e.SessionCacheDirtySet).join(",")}`;const t=[];e.SessionCacheDirtySet.forEach((r=>{const n=e.SessionCache.get(r);n&&t.push({address:r,session:n})})),t.length>0&&(yield p.waSignalStore.bulkPutSession(t)),e.SessionCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: ${t.length} flushed`}))()}_flushIdentities(){var e=this;return(0,a.default)((function*(){if(!(0,d.identityStoreCacheEnabled)())return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: disabled`;if(0===e.IdentityCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: get dirty updates for ${Array.from(e.IdentityCacheDirtySet).join(",")}`;const t=[];e.IdentityCacheDirtySet.forEach((r=>{const n=e.IdentityCache.get(r);n&&t.push((0,i.default)((0,i.default)({},n),{},{identifier:r}))})),t.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(t)),e.IdentityCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: ${t.length} flushed`}))()}flushBufferToDiskIfNotMemOnlyMode(){var e=this;return(0,a.default)((function*(){const t=yield e._sessionMutex.acquire(),r=yield e._identityMutex.acquire();try{yield(0,f.getStorage)().lock(["identity-store","session-store"],(()=>Promise.all([e._flushSessions(),e._flushIdentities()])))}finally{r.release(),t.release()}}))()}_updateIdentityRangeAfterEncryptionImpl(e,t){var r=this;return(0,a.default)((function*(){if(__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: start`,yield r._bulkLoadIdentityKeyImpl(t),(0,d.identityStoreCacheEnabled)()){const n=[];t.forEach((t=>{const i=r.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(r.IdentityCache.set(t,{identityKey:i.identityKey,rowId:e}),r.IdentityCacheDirtySet.add(t),n.push(t))})),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${n.length} updated`}else{const n=[];t.forEach((t=>{const i=r.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(i.rowId=e,n.push({identifier:t,identityKey:i.identityKey,rowId:e}))})),n.length>0&&(yield p.waSignalStore.bulkPutIdentityKeyWithRowId(n),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${n.length} flushed`)}}))()}updateIdentityRangeAfterEncryption(e,t){var r=this;return(0,a.default)((function*(){const n=yield r._identityMutex.acquire();try{yield r._updateIdentityRangeAfterEncryptionImpl(e,t)}finally{n.release()}}))()}};t.default=h},54084:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupSignalSession=function(){return E.apply(this,arguments)},t.createSignalSession=function(){return _.apply(this,arguments)},t.deleteDeviceSenderKey=function(e){const t=String((0,f.createSignalAddress)(e));return p.waSignalStore.removeSenderKeyBySenderId(t)},t.deleteGroupSenderKeyInfo=function(e){const t=(0,f.createSignalAddress)((0,c.assertGetMe)()),r=`${e.toString({legacy:!0})}::${t.toString()}`;return p.waSignalStore.removeSenderKey(r)},t.deleteRemoteInfo=function(){return g.apply(this,arguments)},t.getGroupSenderKeyInfo=function(){return S.apply(this,arguments)},t.getRemoteRegId=function(){return h.apply(this,arguments)},t.hasSameBaseKey=function(){return y.apply(this,arguments)},t.hasSignalSessions=function(e){return d.default.containSessions(e.map((e=>(0,f.createSignalAddress)(e).toString())))},t.saveSessionBaseKey=function(){return m.apply(this,arguments)};var i=n(r(48926)),a=r(8584),o=r(52230),s=r(46308),l=r(5087),c=r(99234),d=n(r(76128)),u=r(52083),p=r(11849),f=r(93832);function _(){return(_=(0,i.default)((function*(e){const{wid:t,identity:r,deviceIdentity:n}=e;if(__LOG__(2)`Signal::createSignalSession with `,null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID){if(!n)throw new Error("Signal::createSignalSession: expected device-identity in keyBundle for companion device");if(!(yield(0,s.validateADVwithIdentityKey)(t,n,r)))throw new Error("Signal::createSignalSession: invalid identityKey fetched")}let i,c,u;try{i=(0,l.toSignalCurvePubKey)(new a.Binary(e.identity).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid identityKey fetched"),e}try{c=(0,l.toSignalCurvePubKey)(new a.Binary(e.skey.pubkey).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid signedPreKey fetched"),e}if(e.key)try{u=(0,l.toSignalCurvePubKey)(new a.Binary(e.key.pubkey).readBuffer())}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid preKey fetched")}const p={registrationId:e.regId,identityKey:i,signedPreKey:{keyId:e.skey.id,publicKey:c,signature:new a.Binary(e.skey.signature).readBuffer()}};return e.key&&u&&(p.preKey={keyId:e.key.id,publicKey:u}),new window.libsignal.SessionBuilder(d.default,(0,f.createSignalAddress)(t)).processPreKey(p)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=new window.libsignal.SessionCipher(d.default,(0,f.createSignalAddress)(e));return(yield Promise.resolve(t)).getRemoteRegistrationId()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=(0,f.createSignalAddress)(e).toString();yield Promise.all([(0,u.getSignalProtocolStore)().removeIdentity(t),(0,u.getSignalProtocolStore)().removeSession(t)])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const r=(0,f.createSignalAddress)(e),n=new window.libsignal.SessionInfo(d.default,r),i=yield n.getSessionBaseKey();i?yield p.waSignalStore.saveBaseKey(r.toString(),t,i):__LOG__(2)`saveSessionBaseKey: for ${t}, no basekey provided`}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const r=(0,f.createSignalAddress)(e),n=new window.libsignal.SessionInfo(d.default,(0,f.createSignalAddress)(e)),[i,a]=yield Promise.all([n.getSessionBaseKey(),p.waSignalStore.loadBaseKey(r.toString(),t)]);return a?i?(0,f.bufferEqual)(a,i)?(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is same`,!0):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is different `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no session has been saved locally `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no base key has been saved locally `,!1)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,r){const n=new window.libsignal.GroupCipher((0,u.getSignalProtocolStore)(),t,(0,f.createSignalAddress)(e));return(yield Promise.resolve(n)).decryptSenderKeyDistributionMessage(r)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=new window.libsignal.GroupCipher(d.default,e.toString({legacy:!0}),(0,f.createSignalAddress)((0,c.assertGetMe)())),r=yield t.createSenderKeyDistributionMsg();return(0,f.strToBuffer)(r)}))).apply(this,arguments)}},91335:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractIdentityKey=function(e){const t=window.dcodeIO.ByteBuffer.wrap(e);t.readUint8();try{const e=window.libsignal.Protobuf.PreKeyWhisperMessage.decode(t);return(0,i.toCurveKeyPubKey)(e.identityKey.toArrayBuffer())}catch(e){return __LOG__(3)`extractIdentityKey: parse proto failed`,null}},t.xmppPreKey=function(e){return(0,n.wap)("key",null,(0,n.wap)("id",null,(0,n.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,n.wap)("value",null,e.keyPair.pubKey))},t.xmppSignedPreKey=function(e){return(0,n.wap)("skey",null,(0,n.wap)("id",null,(0,n.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,n.wap)("value",null,e.keyPair.pubKey),(0,n.wap)("signature",null,e.signature))};var n=r(31914),i=r(5087)},92613:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.startBackend=q;var i=n(r(48926)),a=r(72651),o=r(38284),s=r(55062),l=r(18018),c=r(86945),d=r(64971),u=r(89981),p=r(68268),f=n(r(48277)),_=r(16116),h=r(98972),g=n(r(69048)),m=r(88102),y=r(24747),E=r(79502),S=r(93771),v=r(15998),T=r(91214),C=r(99234),A=r(7293),b=n(r(18438)),P=r(36163),M=r(37726),O=r(68819),I=(r(83578),r(46582)),w=n(r(11339)),R=r(76214),D=r(85417),N=r(67087),L=r(47587),k=r(34771),G=r(48694),U=r(47569),F=r(29100),x=r(64551),B=r(11849),K=r(66837),j=r(38804),Y=r(42862),W=r(70768),H=r(31452),V=r(46669),$=(r(47221),r(77959)),z=r(65044);function q(){return J.apply(this,arguments)}function J(){return(J=(0,i.default)((function*(){if(!B.waSignalStore.getRegistrationInfo())return void __LOG__(2)`startBackendRegistered: chatd user not registered`;__LOG__(2)`[startBackend]: connected as ${(0,C.assertGetMe)()}`;try{yield(0,o.promiseTimeout)(Promise.all([(0,R.initialize)()]),2e4),yield(0,o.promiseTimeout)((0,D.initialize)(),2e4)}catch(e){m.Cmd.storageInitializationError()}(0,d.isABPropsAfterFirstSync)()&&(yield(0,c.updateABPropsFromStorage)());const e=yield(0,S.getTable)().count(),t=yield B.waSignalStore.getServerHasPreKeys(),r=(0,s.getCommsConfig)({passive:e>0||!t});yield te(),yield(0,y.startComms)(b.default,F.sendPing,r,(e=>Promise.resolve((0,a.inflate)(e))),(()=>{}),(()=>{})),yield(0,y.waitForConnection)();{const r=[];e>0&&r.push((0,h.sendAndClearDanglingReceipts)()),t||((0,T.setDeviceLinkPairStage)(w.default.MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS),r.push((0,V.uploadPreKeys)().catch((e=>{__LOG__(4,!0,new Error,!0)`error while uploading prekeys, ${e}`,SEND_LOGS("error while uploading prekeys"),(0,T.commitDeviceLinkEvent)(-1)})))),yield Promise.all(r),(0,T.setDeviceLinkPairStage)(w.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),(0,T.commitDeviceLinkEvent)(),yield(0,L.sendPassiveIq)(!1)}k.PrimaryFeatures.initializeFromLocalStorage(),(0,d.isABPropsAfterFirstSync)()||(yield(0,u.syncABPropsTask)()),yield X(),Q(),yield(0,j.initialize)(),G.PrimaryForceUpgrade.setup(),yield(0,_.initChatThreadLogging)(),yield(0,O.startWebPersistedJobManager)(),yield(0,y.startHandlingRequests)();const n=!f.default.isCriticalDataSynced();n?yield f.default.syncCriticalData():__LOG__(2)`[bootstrap] need to sync critical data: false`,yield v.DbEncKeyStore.waitForFinalDbMsgEncKey(),null==x.ServerProps.serverPropsVersion&&(yield(0,U.queryServerProps)()),(0,l.compareServerPropsAndABProps)(),ee(),W.TosManager.run(),(0,M.startQPL)(),(0,N.upgradeToCommunity)(n)}))).apply(this,arguments)}function Q(){var e;const t=null===(e=(0,C.getMaybeMeUser)())||void 0===e?void 0:e.user;t&&$.Wam.set(w.default.METRICS.getGlobal("psCountryCode"),(0,E.getCountryShortcodeByPhone)(t))}function X(){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.default)((function*(){(0,c.getABPropConfigValue)("web_wam_v5_enabled")&&(yield $.Wam.upgradeWamRuntime())}))).apply(this,arguments)}function ee(){(0,H.applyContactBusinessProps)(),(0,P.restoreLabels)(),(0,P.restoreQuickReplies)(),(0,P.restoreLabelAssociations)(),(0,P.restoreCarts)(),(0,P.restoreArchiveV2Settings)()}function te(){return re.apply(this,arguments)}function re(){return(re=(0,i.default)((function*(){const e=r(99234),t=r(56891).default,{loadProtoVersions:n}=r(77113),i=e.getVersion(),a=(null==i?void 0:i.protoVersion)||[0,17];yield n(),A.GK.setVersion(a),t.setVersion(a,10,"EAEYASACKAEwAjgBQAFIAVgBYAFoAXgBmAEBoAEBqAEBsAECuAEBwAEByAEB0AEA2AEB4AEC8AED+AEDgAIDkAIDmAIAqAIDsAIAuAIDwAIB"),x.ServerProps.updateSelectiveProps({groupDescLength:512,multicastLimitGlobal:5,frequentlyForwardedMax:5,stickers:1,mdBlocklistV2:1})}))).apply(this,arguments)}m.Cmd.on("main_stream_mode_ready",(()=>{try{f.default.continueProgressiveHistorySyncProcessing(),g.default.startIndexer(),(0,I.requireStatusV3Collection)().then((e=>{e.sync()})),(0,Y.registerTasks)(),(0,K.runSyncDirtyContactsJob)(),(0,P.restoreRecentStickers)(),(0,P.restoreFavoriteStickers)(),(0,p.scheduleAdvDeviceInfoCheck)()}catch(e){__LOG__(2)`debug setup failed:`}})),m.Cmd.on("md_restart_backend",(()=>{(0,y.stopComms)(),q()})),m.Cmd.on("storage_initialization_error",(0,i.default)((function*(){__LOG__(2)`storage initialization error, logging out`,yield z.Socket.clearCredentialsAndStoredData(),m.Cmd.logout()}))),A.GK.on(A.FEATURE_CHANGE_EVENT,(()=>{(0,P.updateGKFeatures)()}))},21084:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(50073),i=r(381),a=r(92844),o=r(60980),s=r(45606),l=r(58052),c=r(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=4}applyMutations(e){return Promise.all(e.map((e=>{try{if("set"===e.operation){const{value:t}=e,r=t.androidUnsupportedActions;if(!r)return __LOG__(3)`android unsupported actions: malformed mutation`,{actionState:s.SyncActionState.Malformed};return r.allowed&&this.updatePrimaryAllowsAllMutationsFlag("allow_unsupported_mutation"),{actionState:s.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}})))}getAndroidUnsupportedActionsMutation(){const e=(0,a.unixTimeMs)();return{collection:s.CollectionName.RegularLow,index:JSON.stringify([s.Actions.AndroidUnsupportedActions]),operation:n.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,o.encodeProtobuf)(i.SyncActionValueSpec,{timestamp:e,androidUnsupportedActions:{allowed:!0}}).readBuffer(),timestamp:e,action:s.Actions.AndroidUnsupportedActions}}updatePrimaryAllowsAllMutationsFlag(e){(0,l.getPrimaryAllowsAllMutations)()||(__LOG__(2)`[syncd] primary allows all mutations flag set: ${e}`,(0,l.setPrimaryAllowsAllMutations)())}}const u=new d;Object.freeze(u);var p=u;t.default=p},74362:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(89867)),d=r(45454),u=r(84902),p=r(60980),f=r(38342),_=r(69951),h=r(45606),g=r(57701),m=r(19937),y=n(r(11339)),E=r(76214),S=n(r(68132)),v=r(89835),T=r(22954),C=r(93824);function A(e,t){switch(t){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:h.SyncActionState.Success};case m.MessageRangeEncloseType.RangeBEnclosesRangeA:case m.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:h.SyncActionState.Orphan,orphanModel:{modelType:h.SyncModelType.Chat,modelId:e.toString()}}}}class b extends v.SyncActionBase{constructor(){super(...arguments),this.version=3}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,T.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}setArchive(e){return(0,a.default)((function*(){yield(0,E.getChatTable)().bulkCreateOrMerge(e),e.forEach((e=>{const t=(0,d.createWid)(e.id),r=_.ChatCollection.get(t);r&&(r.archive=e.archive)}))}))()}validateSyncActionValue(e){const t=e.archiveChatAction;return null!=(null==t?void 0:t.archived)&&(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return(0,a.default)((function*(){const r=new Map;yield(0,E.getChatTable)().bulkGet(e.map((e=>{const{indexParts:t}=e,[,r]=t;return r&&c.default.isWid(r)?(0,d.createWid)(r).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.set(e.id,e)}))));const n=[],i=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,T.throwInvalidActionIndex)(),!c.default.isWid(s))return(0,C.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:h.SyncActionState.Malformed};const l=a.archiveChatAction;if(!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][archive-chat]: malformed mutation`,{actionState:h.SyncActionState.Malformed};const u=(0,o.default)(null==l?void 0:l.archived,"archiveChatAction?.archived"),p=(0,o.default)(null==l?void 0:l.messageRange,"archiveChatAction?.messageRange"),f=(0,d.createWid)(s);if(!r.has(f.toString()))return{actionState:h.SyncActionState.Orphan,orphanModel:{modelType:h.SyncModelType.Chat,modelId:f.toString()}};const _=yield t._applyMutation(f,u,p,a);return _.updates&&n.push(_.updates),_.syncApplyActionResult}return __LOG__(3)`[syncd][archive-chat]: REMOVE operation not supported`,{actionState:h.SyncActionState.Unsupported}}catch(e){return{actionState:h.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return n.length>0&&(yield t.setArchive(n)),i}))()}_applyMutation(e,t,r,n){return(0,a.default)((function*(){if(yield(0,f.removeActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("archive")),!t)return{updates:{id:e.toString(),archive:t},syncApplyActionResult:{actionState:h.SyncActionState.Success}};const i=yield(0,m.constructMessageRange)(e,!1),a=(0,m.compareMessageRanges)(i,r),o=(0,p.encodeProtobuf)(l.SyncActionValueSpec,n).readBuffer(),s=()=>(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("archive"),o),c=(0,g.archiveV2Supported)()&&S.default.showArchiveV2;switch(a){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield s(),{updates:{id:e.toString(),archive:t},syncApplyActionResult:A(e,a)};case m.MessageRangeEncloseType.RangeAEnclosesRangeB:case m.MessageRangeEncloseType.RangesNotEnclosing:return c?{updates:{id:e.toString(),archive:t},syncApplyActionResult:A(e,a)}:(yield s(),{updates:void 0,syncApplyActionResult:A(e,a)})}}))()}_constructArchiveChatIndex(e){return JSON.stringify([h.Actions.Archive,e.toString({legacy:!0})])}getArchiveChatMutation(e,t,r){var n=this;return(0,a.default)((function*(){const i={timestamp:e,archiveChatAction:{archived:t,messageRange:yield(0,m.constructMessageRange)(r,!0)}};return{collection:h.CollectionName.RegularLow,index:n._constructArchiveChatIndex(r),binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:n.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:h.Actions.Archive}}))()}getMutationsForArchive(e,t,n){var i=this;return(0,a.default)((function*(){const a=[yield i.getArchiveChatMutation(e,t,n)];if(t&&(0,g.pinChatSyncEnabled)()){const t=r(36014).default;a.push(t.getPinMutation(e,!1,n))}return a}))()}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){var n,s;const c=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),_=c(e.binarySyncAction),g=c(t.binarySyncAction),y=e.timestamp,E=t.timestamp,S=(0,o.default)(_.archiveChatAction,"pendingMutationValue.archiveChatAction"),v=(0,o.default)(g.archiveChatAction,"incomingMutationValue.archiveChatAction");switch((0,m.compareMessageRanges)((0,o.default)(v.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(S.messageRange,"pendingArchiveChatAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return h.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return h.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return y<=E?h.ConflictResolutionState.ApplyRemoteAndDropLocal:h.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=y<=E?null!==(n=v.archived)&&void 0!==n&&n:null!==(s=S.archived)&&void 0!==s&&s,c=(0,m.mergeMessageRanges)((0,o.default)(v.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(S.messageRange,"pendingArchiveChatAction.messageRange")),u=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},g),{},{archiveChatAction:{archived:t,messageRange:c}})).readBuffer(),_=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:u});return delete _.id,yield(0,m.lockForMessageRangeSync)(["chat"],[_],(0,a.default)((function*(){const n=JSON.parse(e.index),i=(0,d.createWid)(n[1]);return yield(0,f.addActiveMessageRange)(i.toString(),(0,f.getActiveRangeAction)("archive"),u),r.setArchive([{id:i.toString(),archive:t}])}))),h.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const P=new b;Object.freeze(P);var M=P;t.default=M},28464:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(381),s=r(45454),l=r(84902),c=r(38342),d=r(69702),u=n(r(21084)),p=r(69951),f=r(45606),_=n(r(73407)),h=r(57701),g=r(19937),m=r(76214),y=r(58052),E=n(r(68132)),S=r(99069),v=r(89835);class T extends v.SyncActionBase{constructor(){super(...arguments),this.version=4}decodeValue(e){if(!e.binarySyncData){if(!e.binarySyncAction)throw __LOG__(4,void 0,new Error,!0,["syncd"])`binarySyncAction should not be null`,SEND_LOGS("syncd binarySyncAction should not be null"),new Error("binarySyncAction should not be null");return(0,l.decodeProtobuf)(o.SyncActionValueSpec,e.binarySyncAction)}{const t=(0,l.decodeProtobuf)(o.SyncActionDataSpec,e.binarySyncData);if(t.value)return t.value}}applyMutations(e,t){var r=this;return(0,a.default)((function*(){u.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{setMutationsPendingToPersist:n}=t;if(e.length>0){const t=e[e.length-1];try{let e=[];if(!(0,h.archiveV2Supported)())return __LOG__(3)`archive setting sync: ArchiveV2 not supported yet`,[{actionState:f.SyncActionState.Unsupported}];if("set"===t.operation){const{value:o}=t,l=o.unarchiveChatsSetting;if(null==(null==l?void 0:l.unarchiveChats))return __LOG__(3)`archive setting sync: malformed mutation`,[{actionState:f.SyncActionState.Malformed}];const c=l.unarchiveChats;return(0,y.getArchiveV2EnabledSetting)()||((0,y.setArchiveV2EnabledSetting)(!0),E.default.archive=(0,i.default)((0,i.default)({},E.default.archive),{},{enabled:!0})),(0,y.setUnarchiveChatsSetting)(c),E.default.archive=(0,i.default)((0,i.default)({},E.default.archive),{},{classic:c}),yield(0,S.getStorage)().lock(["message","chat","sync-actions","active-message-ranges"],(0,a.default)((function*(){e=yield r.updateSideEffectOnChats(c,n),yield(0,m.getChatTable)().bulkCreateOrMerge(e)}))),e.forEach((e=>{const t=(0,s.createWid)(e.id),r=p.ChatCollection.get(t);r&&(r.archive=e.archive)})),[{actionState:f.SyncActionState.Success}]}return __LOG__(3)`archive setting sync: operation not supported`,[{actionState:f.SyncActionState.Unsupported}]}catch(e){return[{actionState:f.SyncActionState.Failed}]}}return __LOG__(3)`archive setting sync: no mutations`,[{actionState:f.SyncActionState.Failed}]}))()}handleSettingOn(e){var t=this;return(0,a.default)((function*(){const r=[];performance.now();const n=(yield(0,m.getChatTable)().all()).filter((e=>e.archive)).map((e=>e.id)),i=(yield Promise.all(n.map((e=>(0,c.getActiveMessageRanges)(e))))).flat().filter((e=>e.action===d.ActiveRangeAction.Archive)).map((e=>e.chatId)),a=n.filter((e=>!i.includes(e))),o=(yield Promise.all(a.map((t=>{const r=(0,s.createWid)(t),n=JSON.stringify([f.Actions.Archive,r.toString({legacy:!0})]),i=e.find((e=>e.index===n));return i?Promise.resolve(i):_.default.getSyncAction(n)})))).filter((e=>{if(!e)return!1;const r=t.decodeValue(e).archiveChatAction;return[f.SyncActionState.Success,f.SyncActionState.Orphan].includes(e.actionState)&&(null==r?void 0:r.archived)&&r.messageRange})).map((e=>{const r=e&&t.decodeValue(e).archiveChatAction;return[e?JSON.parse(e.index)[1]:"",null==r?void 0:r.messageRange]})),l=new Map(o),u=Array.from(l.keys()),p=yield Promise.all(u.map((e=>(0,g.constructMessageRange)((0,s.createWid)(e),!1))));return u.forEach(((e,t)=>{const n=p[t],i=l.get(e);if(i){const t=(0,g.compareMessageRanges)(n,i);if(t===g.MessageRangeEncloseType.RangeAEnclosesRangeB||t===g.MessageRangeEncloseType.RangesNotEnclosing){const t=(0,s.createWid)(e);r.push({id:t.toString({legacy:!1}),archive:!1})}else __LOG__(4,void 0,new Error,!0)`Archive_Setting_Sync: Unsupported rangeEnclosedType ${t}`,SEND_LOGS("ArchiveSettingSync setting true rangeEnclosedType unsupported")}})),performance.now(),r.length,r}))()}handleSettingOff(e){var t=this;return(0,a.default)((function*(){const r=[],n=yield _.default.getSyncActionsRows(["action"],[f.Actions.Archive]),i=e.filter((e=>e.action===f.Actions.Archive)),a=i.map((e=>e.index));return[...n.filter((e=>!a.includes(e.index))),...i].filter((e=>{if(e.actionState===f.SyncActionState.Success){var r;return null===(r=t.decodeValue(e).archiveChatAction)||void 0===r?void 0:r.archived}return!1})).forEach((e=>{const t=JSON.parse(e.index)[1],n=(0,s.createWid)(t);r.push({id:n.toString({legacy:!1}),archive:!0})})),r.length,r}))()}updateSideEffectOnChats(e,t){return e?this.handleSettingOn(t):this.handleSettingOff(t)}}const C=new T;Object.freeze(C);var A=C;t.default=A},29867:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(89867)),d=r(45454),u=r(84902),p=r(60980),f=r(38342),_=n(r(21084)),h=r(69951),g=r(45606),m=n(r(73407)),y=r(57701),E=r(19937),S=n(r(11339)),v=r(76214),T=r(6684),C=r(89835),A=r(22954),b=r(93824);class P extends C.SyncActionBase{constructor(){super(...arguments),this.version=6}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,A.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}_getMessageIdsThatWereUnstarredInCurrentPatch(e,t){const r=new Set;return e.forEach((e=>{if(e.actionName===g.Actions.Star&&e.timestamp>t){const t=(0,b.getMsgKeyFromStarActionIndex)(e.index);r.add(t.toString())}})),r}validateSyncActionValue(e){const t=e.clearChatAction;return(0,E.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e,t){var r=this;_.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{allSupportedSetMutations:n}=t;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,y.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][clear-chat]: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if("set"===e.operation){var t;const{indexParts:i,value:a}=e,[,s,l,u]=i;if(s&&l&&u||(0,A.throwInvalidActionIndex)(),!c.default.isWid(s))return(0,b.uploadCriticalEventMetric)(S.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};if(!r.validateSyncActionValue(a))return __LOG__(3)`[syncd][clear-chat]: malformed mutation`,{actionState:g.SyncActionState.Malformed};const p=(0,o.default)(null===(t=a.clearChatAction)||void 0===t?void 0:t.messageRange,"value.clearChatAction?.messageRange"),f=(0,d.createWid)(s),_=f.toString();if(!(yield(0,v.getChatTable)().get(_)))return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:_}};const h=r._getMessageIdsThatWereUnstarredInCurrentPatch(n,e.timestamp);return r._applyMutation(f,p,"1"===l,"0"===u,h,a)}return __LOG__(3)`[syncd][clear-chat]: REMOVE operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}clearChat(e,t,n,i){return(0,a.default)((function*(){const{queryAndRemoveMessagesInMessageRange:a}=r(13946),o=yield a(e,t,{skipStarred:!n,skipMessages:i});if((0,y.receiveReactionsEnabled)()&&o.length>0){const t=r(68819).getJobManager;yield t().waitUntilPersisted(T.jobSerializers.deleteReactions(e.toString(),o))}const s=h.ChatCollection.get(e);s&&s.deleteMessages(o)}))()}_applyMutation(e,t,r,n,i,o){var s=this;return(0,a.default)((function*(){const a=(0,p.encodeProtobuf)(l.SyncActionValueSpec,o).readBuffer();return yield(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("clearChat",{deleteMedia:n,deleteStarred:r}),a),yield s.clearChat(e,t,r,i),{actionState:g.SyncActionState.Success}}))()}getClearChatMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){let a=yield(0,E.constructForwardMovingMessageRange)(t);const o=i._constructClearChatIndex(t,r,n||!1),c=yield m.default.getPendingMutationsRowsByIndex(["index"],o);if(c.length){var d;const e=c.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(d=(0,u.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).clearChatAction)||void 0===d?void 0:d.messageRange;t&&(a=(0,E.mergeMessageRanges)(a,t))}const f={timestamp:e,clearChatAction:{messageRange:a}};return{collection:g.CollectionName.RegularHigh,index:o,binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,f).readBuffer(),version:i.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.ClearChat}}))()}_constructClearChatIndex(e,t,r){return JSON.stringify([g.Actions.ClearChat,e.toString({legacy:!0}),t?"1":"0",r?"1":"0"])}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){const n=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),s=n(e.binarySyncAction),c=n(t.binarySyncAction),_=e.timestamp,h=t.timestamp,m=(0,o.default)(s.clearChatAction,"pendingMutationValue.clearChatAction"),y=(0,o.default)(c.clearChatAction,"incomingMutationValue.clearChatAction");switch((0,E.compareMessageRanges)((0,o.default)(y.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingClearChatAction.messageRange"))){case E.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case E.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case E.MessageRangeEncloseType.RangesAreEqual:return _<=h?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case E.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,E.mergeMessageRanges)((0,o.default)(y.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingClearChatAction.messageRange")),n=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},c),{},{clearChatAction:{messageRange:t}})).readBuffer(),s=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:n});return delete s.id,yield(0,E.lockForMessageRangeSync)([],[s],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,d.createWid)(i[1]),o="1"===i[2],s="1"===i[3];return yield(0,f.addActiveMessageRange)(a.toString(),(0,f.getActiveRangeAction)("clearChat",{deleteStarred:o,deleteMedia:s}),n),r.clearChat(a,t,o)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const M=new P;Object.freeze(M);var O=M;t.default=O},24900:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(72441),s=r(45454),l=r(45606),c=r(35673),d=r(19380),u=r(76214),p=r(959),f=r(89835),_=r(66837),h=r(22954);class g extends f.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return(0,a.default)((function*(){const t=[],r=[],n=yield Promise.all(e.map((e=>{try{const a=e.indexParts,[,o]=a;o||(0,h.throwInvalidActionIndex)();const c=(0,s.createUserWid)(o);if("set"===e.operation){var n;const r=e.value.contactAction;if(!r)return __LOG__(3)`contact sync: malformed mutation`,{actionState:l.SyncActionState.Malformed};const a={id:o,name:r.fullName||"",shortName:r.firstName||(null!==(n=(0,p.getShortName)(r.fullName))&&void 0!==n?n:""),type:"in",isAddressBookContact:1,isContactSyncCompleted:0};return t.push(a),d.ContactCollection.add((0,i.default)((0,i.default)({},a),{},{id:c}),{merge:!0}),(0,_.syncNewContact)(c),{actionState:l.SyncActionState.Success}}if("remove"===e.operation){const e=d.ContactCollection.get(c);return null!=e&&e.setNotMyContact(),r.push(c),{actionState:l.SyncActionState.Success}}return __LOG__(3)`contact sync: operation not supported`,{actionState:l.SyncActionState.Unsupported}}catch(e){return{actionState:l.SyncActionState.Failed}}})));if(yield(0,u.getContactTable)().bulkCreateOrMerge(t),r.length>0){const e=r.map((e=>(0,o.toPhoneUserJid)(e.user)));yield(0,c.setNotAddressBookContacts)(e)}return n}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},56928:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(89867)),d=r(45454),u=r(84902),p=r(60980),f=r(38342),_=n(r(21084)),h=r(69951),g=r(45606),m=n(r(73407)),y=r(77772),E=r(57701),S=r(19937),v=n(r(11339)),T=r(76214),C=r(6684),A=r(13946),b=r(89835),P=r(22954),M=r(93824);class O extends b.SyncActionBase{constructor(){super(...arguments),this.version=6}validateSyncActionValue(e){const t=e.deleteChatAction;return(0,S.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return _.default.updatePrimaryAllowsAllMutationsFlag("other mutation"),Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,E.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][delete-chat]: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if("set"===e.operation){var r;const{indexParts:n,value:i}=e,[,a,s]=n;if(a&&s||(0,P.throwInvalidActionIndex)(),!c.default.isWid(a))return(0,M.uploadCriticalEventMetric)(v.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};if(!t.validateSyncActionValue(i))return __LOG__(3)`[syncd][delete-chat]: malformed mutation`,{actionState:g.SyncActionState.Malformed};const l=(0,o.default)(null===(r=i.deleteChatAction)||void 0===r?void 0:r.messageRange,"value.deleteChatAction?.messageRange"),u=(0,d.createWid)(a),p=u.toString();return(yield(0,T.getChatTable)().get(p))?t._applyMutation(u,l,"0"===s,i):{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:p}}}return __LOG__(3)`[syncd][delete-chat]: REMOVE operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}deleteChat(e,t){return(0,a.default)((function*(){const n=h.ChatCollection.get(e);if(t){const i=yield(0,A.queryAndRemoveMessagesInMessageRange)(e,t);if((0,E.receiveReactionsEnabled)()&&i.length>0){const t=r(68819).getJobManager;yield t().waitUntilPersisted(C.jobSerializers.deleteReactions(e.toString(),i))}n&&n.deleteMessages(i)}else yield(0,y.deleteFromStorage)(e),n&&n.delete()}))()}_applyMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){const a=(0,p.encodeProtobuf)(l.SyncActionValueSpec,n).readBuffer();yield(0,f.addActiveMessageRange)(e.toString(),(0,f.getActiveRangeAction)("deleteChat",{deleteMedia:r}),a);const o=yield(0,S.constructMessageRange)(e,!1);switch((0,S.compareMessageRanges)(o,t)){case S.MessageRangeEncloseType.RangeAEnclosesRangeB:case S.MessageRangeEncloseType.RangesNotEnclosing:yield i.deleteChat(e,t);break;default:yield i.deleteChat(e)}return{actionState:g.SyncActionState.Success}}))()}getDeleteChatMutation(e,t,r){var n=this;return(0,a.default)((function*(){let i=yield(0,S.constructForwardMovingMessageRange)(t);const a=n._constructDeleteChatIndex(t,r||!1),o=yield m.default.getPendingMutationsRowsByIndex(["index"],a);if(o.length){var c;const e=o.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(c=(0,u.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).deleteChatAction)||void 0===c?void 0:c.messageRange;t&&(i=(0,S.mergeMessageRanges)(i,t))}const d={timestamp:e,deleteChatAction:{messageRange:i}};return{collection:g.CollectionName.RegularHigh,index:a,binarySyncAction:(0,p.encodeProtobuf)(l.SyncActionValueSpec,d).readBuffer(),version:n.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.DeleteChat}}))()}_constructDeleteChatIndex(e,t){return JSON.stringify([g.Actions.DeleteChat,e.toString({legacy:!0}),t?"1":"0"])}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){const n=e=>(0,u.decodeProtobuf)(l.SyncActionValueSpec,e),s=n(e.binarySyncAction),c=n(t.binarySyncAction),_=e.timestamp,h=t.timestamp,m=(0,o.default)(s.deleteChatAction,"pendingMutationValue.deleteChatAction"),y=(0,o.default)(c.deleteChatAction,"incomingMutationValue.deleteChatAction");switch((0,S.compareMessageRanges)((0,o.default)(y.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingDeleteChatAction.messageRange"))){case S.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case S.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case S.MessageRangeEncloseType.RangesAreEqual:return _<=h?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case S.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,S.mergeMessageRanges)((0,o.default)(y.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(m.messageRange,"pendingDeleteChatAction.messageRange")),n=(0,p.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},c),{},{deleteChatAction:{messageRange:t}})).readBuffer(),s=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:n});return delete s.id,yield(0,S.lockForMessageRangeSync)([],[s],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,d.createWid)(i[1]);return yield(0,f.addActiveMessageRange)(a.toString(),(0,f.getActiveRangeAction)("deleteChat",{deleteMedia:"1"===i[2]}),n),r.deleteChat(a,t)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const I=new O;Object.freeze(I);var w=I;t.default=w},41058:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(50073),s=r(381),l=r(92844),c=n(r(65212)),d=n(r(89867)),u=r(84902),p=r(60980),f=r(45606),_=r(57701),h=r(84886),g=n(r(11339)),m=r(76214),y=r(59871),E=r(6684),S=r(89835),v=r(22954),T=r(93824);class C extends S.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return(0,i.default)((function*(){const t=[],n=new Map;yield(0,m.getMessageTable)().bulkGet(e.map((e=>{var t;const[,r,n,i,a]=e.indexParts;return r&&n&&i&&a&&d.default.isWid(r)?null===(t=(0,v.syncKeyToMsgKey)(r,n,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.set(e.id,e)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){const[,r,i,a,o]=e.indexParts;r&&i&&a&&o||(0,v.throwInvalidActionIndex)();const s=(0,v.syncKeyToMsgKey)(r,i,a,o);if(!s)return(0,T.uploadCriticalEventMetric)(g.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:f.SyncActionState.Malformed};const l=n.get(s.toString());if(!l)return{actionState:f.SyncActionState.Orphan,orphanModel:{modelId:s.toString(),modelType:f.SyncModelType.Msg}};t.push(l.id);const c=y.MsgCollection.get(s);return c?c.delete():__LOG__(3)`delete_message_for_me_sync: msg ${s} found in storage but not in collection`,{actionState:f.SyncActionState.Success}}return __LOG__(3)`delete_message_for_me_sync: operation not supported`,{actionState:f.SyncActionState.Unsupported}}catch(e){return{actionState:f.SyncActionState.Failed}}})));if(t.length>0&&(yield(0,h.removeMessagesFromHistory)(t),(0,_.receiveReactionsEnabled)())){const e=new Set;t.forEach((t=>e.add(c.default.fromString(t).remote.toString())));const n=Array.from(e.values()).join(",").toString(),i=r(68819).getJobManager;yield i().waitUntilPersisted(E.jobSerializers.deleteReactions(n,t))}return i}))()}resolveConflicts(e,t){var r,n;const i=e=>(0,u.decodeProtobuf)(s.SyncActionValueSpec,e),o=(0,a.default)(null===(r=i(e.binarySyncAction).deleteMessageForMeAction)||void 0===r?void 0:r.deleteMedia,"decodeValue(localMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia");return!(0,a.default)(null===(n=i(t.binarySyncAction).deleteMessageForMeAction)||void 0===n?void 0:n.deleteMedia,"decodeValue(remoteMutation.binarySyncAction).deleteMessageForMeAction?.deleteMedia")&&o?Promise.resolve(f.ConflictResolutionState.SkipRemote):Promise.resolve(f.ConflictResolutionState.SkipRemoteAndDropLocal)}getDeleteForMeMutations(e,t){const r=(0,l.unixTimeMs)();return e.map((e=>{const n={deleteMessageForMeAction:{deleteMedia:t,messageTimestamp:e.t},timestamp:r};return{collection:f.CollectionName.RegularHigh,index:JSON.stringify([f.Actions.DeleteMessageForMe,e.id.remote.toString({legacy:!0}),e.id.id,e.id.fromMe?"1":"0",e.isGroupMsg&&!e.id.fromMe?e.sender.toString({legacy:!0}):"0"]),binarySyncAction:(0,p.encodeProtobuf)(s.SyncActionValueSpec,n).readBuffer(),version:this.version,operation:o.SyncdMutationSyncdOperation.SET,timestamp:r,action:f.Actions.DeleteMessageForMe}}))}}const A=new C;Object.freeze(A);var b=A;t.default=b},12123:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(89867)),s=r(45454),l=r(68638),c=r(45606),d=r(82663),u=r(31912),p=r(905),f=n(r(11339)),_=r(89835),h=r(22954),g=r(93824);class m extends _.SyncActionBase{constructor(){super(...arguments),this.version=c.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,a.default)((function*(){const t=new Set,n=[],_=[],m=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var a;const{indexParts:m,value:y}=e,[,E,S]=m;E&&S||(0,h.throwInvalidActionIndex)();const v=null===(a=y.labelAssociationAction)||void 0===a?void 0:a.labeled;if(null==v)return __LOG__(3)`label jid sync: malformed mutation`,{actionState:c.SyncActionState.Malformed};if(!o.default.isWid(S))return(0,g.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:c.SyncActionState.Malformed};const T=(0,s.createWid)(S),C=T.toString(),A={labelId:E,associationId:C,type:d.LabelAssociationType.Jid};if(v){let e=t.has(C);if(!e){(yield(0,l.getTable)().get(C))&&(t.add(C),e=!0)}const a=r(63183).Chat,o=e?null:new a({id:T});n.push(A),o&&((0,l.getTable)().create((0,i.default)((0,i.default)({},o.toJSON()),{},{id:C})),t.add(C)),o&&r(69951).ChatCollection.add(o),(0,p.addToLabelCollection)(C,[E],u.LabelItemParentType.Chat)}else _.push(A),(0,p.removeLabelFromCollection)(C,E,u.LabelItemParentType.Chat);return{actionState:c.SyncActionState.Success}}return __LOG__(3)`label jid sync: unsupported operation`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return yield(0,d.getTable)().bulkRemove(_.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,d.getTable)().bulkCreateOrReplace(n),m}))()}}const y=new m;Object.freeze(y);var E=y;t.default=E},35096:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(89867)),o=r(45606),s=r(82663),l=r(31912),c=r(905),d=n(r(11339)),u=r(76214),p=r(89835),f=r(22954),_=r(93824);function h(){return(h=(0,i.default)((function*(e){const t=new Set;return yield(0,u.getMessageTable)().bulkGet(e.map((e=>{var t;const[,,r,n,i,o]=e.indexParts;return r&&n&&i&&o&&a.default.isWid(r)?null===(t=(0,f.syncKeyToMsgKey)(r,n,i,o))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&t.add(e.id)})))),t}))).apply(this,arguments)}class g extends p.SyncActionBase{constructor(){super(...arguments),this.version=o.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,i.default)((function*(){const t=[],r=[],n=yield function(){return h.apply(this,arguments)}(e),i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:u}=e,[,p,h,g,m,y]=a;p&&h&&g&&m&&y||(0,f.throwInvalidActionIndex)();const E=null===(i=u.labelAssociationAction)||void 0===i?void 0:i.labeled;if(null==E)return __LOG__(3)`label message sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const S=(0,f.syncKeyToMsgKey)(h,g,m,y);if(!S)return(0,_.uploadCriticalEventMetric)(d.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:o.SyncActionState.Malformed};if(!n.has(S.toString()))return{actionState:o.SyncActionState.Orphan,orphanModel:{modelId:S.toString(),modelType:o.SyncModelType.Msg}};const v={labelId:p,associationId:S.toString(),type:s.LabelAssociationType.Message};return E?(t.push(v),(0,c.addToLabelCollection)(S.toString(),[p],l.LabelItemParentType.Msg)):(r.push(v),(0,c.removeLabelFromCollection)(S.toString(),p,l.LabelItemParentType.Msg)),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label message sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})));return yield(0,s.getTable)().bulkRemove(r.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,s.getTable)().bulkCreateOrReplace(t),i}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},80056:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(45606),s=r(94337),l=r(16770),c=r(89835),d=r(22954);class u extends c.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,a]=r;a||(0,d.throwInvalidActionIndex)();const c=n.labelEditAction;if(!c)return __LOG__(3)`label sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};if(c.deleted)return yield(0,s.getTable)().remove(a),l.LabelCollection.remove(a),{actionState:o.SyncActionState.Success};const{color:u,predefinedId:p}=c,f=null!==(t=c.name)&&void 0!==t?t:"";""===f&&__LOG__(3)`labelEditAction.name is empty`,null==u&&__LOG__(3)`labelEditAction.color is empty`;const _={id:a,name:f,colorIndex:u,predefinedId:p};return yield(0,s.getTable)().createOrReplace(_),l.LabelCollection.add((0,i.default)({},_),{merge:!0}),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const p=new u;Object.freeze(p);var f=p;t.default=f},79171:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),o=n(r(43725)),s=r(53558),l=r(89835);class c extends l.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{value:t}=e,r=t.localeSetting;if(!r)return __LOG__(3)`locale setting sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const n=r.locale;return yield o.default.setLocale(n,s.L10N_PRIORITY.PHONE),{actionState:a.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const d=new c;Object.freeze(d);var u=d;t.default=u},64294:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(81109)),a=n(r(48926)),o=n(r(45095)),s=r(50073),l=r(381),c=n(r(64369)),d=n(r(89867)),u=r(45454),p=r(84902),f=r(60980),_=r(38342),h=r(69951),g=r(45606),m=r(19937),y=n(r(11339)),E=r(76214),S=r(89835),v=r(22954),T=r(93824);function C(e,t){switch(t){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:g.SyncActionState.Success};case m.MessageRangeEncloseType.RangeBEnclosesRangeA:case m.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:e.toString()}}}}class A extends S.SyncActionBase{constructor(){super(...arguments),this.version=3}_setRead(e,t){const n=h.ChatCollection.get(e);if(n){const e=r(9609);t?e.markSeen(n):e.markUnseen(n)}}_isChatMarkedUnreadByUser(e){return(0,a.default)((function*(){const t=yield(0,E.getChatTable)().get(e.toString());return(null==t?void 0:t.unreadCount)===c.default.MARKED_AS_UNREAD}))()}validateSyncActionValue(e){const t=e.markChatAsReadAction;return null!=(null==t?void 0:t.read)&&(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var r,n;const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,v.throwInvalidActionIndex)(),!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][mark-chat-as-read]: malformed mutation`,{actionState:g.SyncActionState.Malformed};if(!d.default.isWid(s))return(0,T.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};const l=(0,o.default)(null===(r=a.markChatAsReadAction)||void 0===r?void 0:r.read,"value.markChatAsReadAction?.read"),c=(0,o.default)(null===(n=a.markChatAsReadAction)||void 0===n?void 0:n.messageRange,"value.markChatAsReadAction?.messageRange"),p=(0,u.createWid)(s),f=p.toString();return(yield(0,E.getChatTable)().get(f))?t._applyMutation(p,l,c,a):{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:f}}}return __LOG__(3)`[syncd][mark-chat-as-read]: operation not supported`,{actionState:g.SyncActionState.Unsupported}}catch(e){return{actionState:g.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}_applyMutation(e,t,r,n){var i=this;return(0,a.default)((function*(){yield(0,_.removeActiveMessageRange)(e.toString(),(0,_.getActiveRangeAction)("markChatAsRead"));const a=yield(0,m.constructMessageRange)(e,!1),o=(0,m.compareMessageRanges)(a,r),s=(0,f.encodeProtobuf)(l.SyncActionValueSpec,n).readBuffer();switch(o){case m.MessageRangeEncloseType.RangesAreEqual:case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield(0,_.addActiveMessageRange)(e.toString(),(0,_.getActiveRangeAction)("markChatAsRead"),s),i._setRead(e,t),Promise.resolve(C(e,o));case m.MessageRangeEncloseType.RangesNotEnclosing:case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return t&&(yield i._isChatMarkedUnreadByUser(e))&&i._setRead(e,t),Promise.resolve(C(e,o))}}))()}_constructMarkChatAsReadIndex(e){return JSON.stringify([g.Actions.MarkChatAsRead,e.toString({legacy:!0})])}getMarkChatAsReadMutation(e,t,r){var n=this;return(0,a.default)((function*(){const i={timestamp:e,markChatAsReadAction:{read:t,messageRange:yield(0,m.constructMessageRange)(r,!0)}};return{collection:g.CollectionName.RegularLow,index:n._constructMarkChatAsReadIndex(r),binarySyncAction:(0,f.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:n.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.MarkChatAsRead}}))()}resolveConflicts(e,t){var r=this;return(0,a.default)((function*(){var n,s;const c=e=>(0,p.decodeProtobuf)(l.SyncActionValueSpec,e),d=c(e.binarySyncAction),h=c(t.binarySyncAction),y=e.timestamp,E=t.timestamp,S=(0,o.default)(d.markChatAsReadAction,"pendingMutationValue.markChatAsReadAction"),v=(0,o.default)(h.markChatAsReadAction,"incomingMutationValue.markChatAsReadAction");switch((0,m.compareMessageRanges)((0,o.default)(v.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(S.messageRange,"pendingMarkChatAsReadAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return g.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return g.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return y<=E?g.ConflictResolutionState.ApplyRemoteAndDropLocal:g.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=y<=E?null!==(n=v.read)&&void 0!==n&&n:null!==(s=S.read)&&void 0!==s&&s,c=(0,m.mergeMessageRanges)((0,o.default)(v.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(S.messageRange,"pendingMarkChatAsReadAction.messageRange")),d=(0,f.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},h),{},{markChatAsReadAction:{read:t,messageRange:c}})).readBuffer(),p=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:d});return delete p.id,yield(0,m.lockForMessageRangeSync)(["chat"],[p],(0,a.default)((function*(){const n=JSON.parse(e.index),i=(0,u.createWid)(n[1]);return yield(0,_.addActiveMessageRange)(i.toString(),(0,_.getActiveRangeAction)("markChatAsRead"),d),r._setRead(i,t)}))),g.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const b=new A;Object.freeze(b);var P=b;t.default=P},19937:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRangeEncloseType=void 0,t.compareMessageRanges=function(e,t){const r=E(e,t),n=E(t,e);if(r&&n)return y.RangesAreEqual;if(r)return y.RangeAEnclosesRangeB;if(n)return y.RangeBEnclosesRangeA;return y.RangesNotEnclosing},t.constructForwardMovingMessageRange=function(){return P.apply(this,arguments)},t.constructMessageRange=S,t.lockForMessageRangeSync=void 0,t.mergeMessageRanges=C,t.validateMessageRange=function(e){if(null==e)return(0,m.uploadCriticalEventMetric)(h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_UNSET),!1;for(const[t,r]of A)if(r(e))return(0,m.uploadCriticalEventMetric)(t),!1;for(const t of e.messages)for(const[e,r]of b)if(r(t))return(0,m.uploadCriticalEventMetric)(e),!1;return!0};var i=n(r(48926)),a=r(8243),o=r(381),s=n(r(89867)),l=r(45454),c=r(84902),d=r(38342),u=r(69702),p=r(45606),f=n(r(73407)),_=r(30986),h=n(r(11339)),g=r(38804),m=r(93824);const y=r(76672).Mirrored(["RangeAEnclosesRangeB","RangeBEnclosesRangeA","RangesAreEqual","RangesNotEnclosing"]);function E(e,t){const r=new Set(e.messages.map((e=>{var t;return null===(t=e.key)||void 0===t?void 0:t.id})));for(let e=0;e<t.messages.length;e++){var n;if(null==t.messages[e].timestamp)if(!r.has(null===(n=t.messages[e].key)||void 0===n?void 0:n.id))return!1}for(let n=0;n<t.messages.length;n++){var i,o,s;if(!r.has(null===(i=t.messages[n].key)||void 0===i?void 0:i.id)&&(0,a.numberOrThrowIfTooLarge)(null!==(o=e.lastMessageTimestamp)&&void 0!==o?o:0)<=(0,a.numberOrThrowIfTooLarge)(null!==(s=t.messages[n].timestamp)&&void 0!==s?s:0))return!1}return!0}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,r){let n=yield(0,_.getLastMessageTimestamp)(e);const i=yield(0,_.getLastSystemMessageTimestamp)(e),{messages:o,newLastMessageTimestamp:s}=yield(0,_.getAdditionalMessages)(e,n,r);if(null!=s&&(n=s),null==n){var l;n=null===(l=o.sort(_.timestampComparison)[o.length-1])||void 0===l?void 0:l.timestamp}const c={messages:o};if(null!=n&&(c.lastMessageTimestamp=n),null!=i&&(null==n||i>(0,a.numberOrThrowIfTooLarge)(n))&&(c.lastSystemMessageTimestamp=i),t&&null==c.lastMessageTimestamp){const t=yield(0,_.getFirstSystemMessageTimestamp)(e);null!=t&&(c.lastMessageTimestamp=t,t===i&&(c.lastSystemMessageTimestamp=void 0))}return c}))).apply(this,arguments)}function T(e,t,r){const n=new Map;return e.concat(t).forEach((e=>{var t,i,o;const s=null!==(t=null===(i=e.key)||void 0===i?void 0:i.id)&&void 0!==t?t:"";if((0,a.numberOrThrowIfTooLarge)(null!==(o=e.timestamp)&&void 0!==o?o:0)>=r){const t=n.get(s);var l,c;if(t)n.set(s,(0,a.numberOrThrowIfTooLarge)(null!==(l=t.timestamp)&&void 0!==l?l:0)<(0,a.numberOrThrowIfTooLarge)(null!==(c=e.timestamp)&&void 0!==c?c:0)?e:t);else n.set(s,e)}})),Array.from(n.values())}function C(e,t){var r,n;const i=(0,a.numberOrThrowIfTooLarge)(null!==(r=e.lastMessageTimestamp)&&void 0!==r?r:0),o=(0,a.numberOrThrowIfTooLarge)(null!==(n=t.lastMessageTimestamp)&&void 0!==n?n:0),s=Math.max(i,o),l={messages:T(e.messages,t.messages,s)};if(0!==s&&(l.lastMessageTimestamp=s),null!=e.lastSystemMessageTimestamp||null!=t.lastSystemMessageTimestamp){var c,d;const r=Math.max((0,a.numberOrThrowIfTooLarge)(null!==(c=e.lastSystemMessageTimestamp)&&void 0!==c?c:0),(0,a.numberOrThrowIfTooLarge)(null!==(d=t.lastSystemMessageTimestamp)&&void 0!==d?d:0));(null==s||r>s)&&(l.lastSystemMessageTimestamp=r)}return l}t.MessageRangeEncloseType=y;const A=[[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET,e=>{let{lastSystemMessageTimestamp:t,lastMessageTimestamp:r}=e;return null!=t&&null!=r&&(0,a.numberOrThrowIfTooLarge)(t)<(0,a.numberOrThrowIfTooLarge)(r)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGES_CROSS_LIMIT,e=>e.messages.filter((e=>null!=e.timestamp)).length>1e3]],b=[[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_UNSET,e=>null==e.key],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.fromMe)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.id)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID,e=>{var t;return!(0,l.isWidlike)(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[h.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET,e=>{var t,r,n;return s.default.isGroup(null===(t=e.key)||void 0===t?void 0:t.remoteJid)&&!(null===(r=e.key)||void 0===r?void 0:r.fromMe)&&null==(null===(n=e.key)||void 0===n?void 0:n.participant)}]];function P(){return(P=(0,i.default)((function*(e,t){var r;let n=yield S(e,!0,t);(yield(0,d.getActiveMessageRanges)(e.toString())).forEach((e=>{switch(e.action){case u.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case u.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:case u.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case u.ActiveRangeAction.ClearChatKeepStarredKeepMedia:case u.ActiveRangeAction.DeleteChatDeleteMedia:case u.ActiveRangeAction.DeleteChatKeepMedia:const t=e.actionValue.messageRange;t&&(n=C(n,t));break;case u.ActiveRangeAction.Archive:case u.ActiveRangeAction.MarkChatAsRead:}}));const i=yield M(e);return n.messages=T(n.messages,i,(0,a.numberOrThrowIfTooLarge)(null!==(r=n.lastMessageTimestamp)&&void 0!==r?r:0)),n=(0,_.fixMessageRange)(n),n}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=[];return(yield f.default.getSyncActionsRows(["action"],[p.Actions.DeleteMessageForMe])).forEach((r=>{const n=e.toString({legacy:!0}),i=JSON.parse(r.index);if(5!==i.length)__LOG__(2)`constructForwardMovingMessageRange: delete for me mutation index malformed ${r.index}`;else if(n===i[1]&&r.actionState===p.SyncActionState.Success){var a;const e=null===(a=(0,c.decodeProtobuf)(o.SyncActionValueSpec,r.binarySyncAction).deleteMessageForMeAction)||void 0===a?void 0:a.messageTimestamp;if(null==e)__LOG__(2)`constructForwardMovingMessageRange: deleteMessageForMeAction malformed`;else{const r={remoteJid:i[1],id:i[2],fromMe:"1"===i[3],participant:"0"!==i[4]?i[4]:void 0};t.push({key:r,timestamp:e})}}})),t}))).apply(this,arguments)}t.lockForMessageRangeSync=(e,t,r)=>(0,g.lockForSync)([...e,"message","active-message-ranges"],t,r)},70119:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(8243),o=r(50073),s=r(381),l=r(92844),c=n(r(89867)),d=r(45454),u=r(60980),p=r(45606),f=n(r(11339)),_=r(76214),h=r(72472),g=r(89835),m=r(22954),y=r(93824);class E extends g.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:n}=e,[,i]=r;if(i||(0,m.throwInvalidActionIndex)(),!c.default.isWid(i))return(0,y.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:p.SyncActionState.Malformed};const o=n.muteAction,s=null===(t=n.muteAction)||void 0===t?void 0:t.muted,u=(0,a.maybeNumberOrThrowIfTooLarge)(null==o?void 0:o.muteEndTimestamp);if(null==s||s&&null==u)return __LOG__(3)`mute chat sync: malformed mutation`,{actionState:p.SyncActionState.Malformed};const g=(0,d.createWid)(i);if(!(yield(0,_.getChatTable)().get(g.toString())))return{actionState:p.SyncActionState.Orphan,orphanModel:{modelType:p.SyncModelType.Chat,modelId:g.toString()}};const E=null!=u?u:0,S=E>0&&E<(0,l.unixTimeMs)()?0:Math.floor(E/1e3);return yield(0,_.getChatTable)().merge(g.toString(),{muteExpiration:S}),h.MuteCollection.add({id:g,expiration:S},{merge:!0}),{actionState:p.SyncActionState.Success}}return __LOG__(3)`mute chat sync: operation not supported`,{actionState:p.SyncActionState.Unsupported}}catch(e){return{actionState:p.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}generateMuteMutation(e,t){const r=void 0!==t&&0!==t,n=(0,l.unixTimeMs)();let i=t;-1!==i&&(i*=1e3);const a={timestamp:n,muteAction:{muted:r,muteEndTimestamp:i}};return{collection:p.CollectionName.RegularHigh,index:JSON.stringify([p.Actions.Mute,e.toString({legacy:!0})]),operation:o.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,u.encodeProtobuf)(s.SyncActionValueSpec,a).readBuffer(),timestamp:n,action:p.Actions.Mute}}}const S=new E;Object.freeze(S);var v=S;t.default=v},34610:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(60980),l=r(86945),c=r(22683),d=r(45606),u=r(7293),p=r(36677),f=r(89835),_=r(38804),h=r(31515);class g extends f.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,l.getABPropConfigValue)("nux_sync"))return __LOG__(3)`NuxSync: nux_sync ab prop required`,e.map((()=>({actionState:d.SyncActionState.Unsupported})));const t=[],r=e.map((e=>{if("set"!==e.operation)return __LOG__(3)`NuxSync: operation not supported ${e}`,{actionState:d.SyncActionState.Malformed};const r=e.indexParts[1];return(0,h.isString)(r)?(t.push(r),{actionState:d.SyncActionState.Success}):(__LOG__(3)`NuxSync: malformed mutation ${e}`,{actionState:d.SyncActionState.Malformed})}));return t.length&&(__LOG__(2)`NuxSync: adding keys to local store ${t}`,(0,p.addToLocalNuxSyncList)(t)),r}))()}_createNuxMutation(e,t){return{collection:d.CollectionName.RegularLow,index:JSON.stringify([d.Actions.Nux,e]),binarySyncAction:(0,s.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:t}).readBuffer(),version:this.version,operation:a.SyncdMutationSyncdOperation.SET,timestamp:t,action:d.Actions.Nux}}markNuxAsSeen(e){var t=this;return(0,i.default)((function*(){if(u.GK.supportsFeature(u.GK.F.MD_BACKEND)&&!0===(0,l.getABPropConfigValue)("nux_sync")){(0,p.addToLocalNuxSyncList)([e]);const r=t._createNuxMutation(e,c.Clock.globalUnixTimeMilliseconds());yield(0,_.lockForSync)([],[r],(()=>Promise.resolve()))}}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},36014:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(8243),o=n(r(45095)),s=r(50073),l=r(381),c=r(92844),d=n(r(89867)),u=r(45454),p=r(84902),f=r(60980),_=n(r(21084)),h=n(r(74362)),g=r(45606),m=n(r(73407)),y=r(9025),E=r(57701),S=n(r(11339)),v=r(76214),T=r(89835),C=r(38804),A=r(22954),b=r(93824);class P extends T.SyncActionBase{constructor(){super(...arguments),this.version=5}applyMutations(e){var t=this;return(0,i.default)((function*(){_.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const r=[];for(let n=0;n<e.length;n++)r.push(yield t.applyMutation(e[n]));return r}))()}applyMutation(e){var t=this;return(0,i.default)((function*(){if("remove"===e.operation)return __LOG__(3)`syncd: pin_chat_sync: REMOVE not supported`,Promise.resolve({actionState:g.SyncActionState.Unsupported});if(!(0,E.pinChatSyncEnabled)())return __LOG__(3)`syncd: pin_chat_sync: not enabled`,Promise.resolve({actionState:g.SyncActionState.Unsupported});const{indexParts:r,value:n,timestamp:i}=e,[,a]=r;try{if(a||(__LOG__(3)`syncd: pin_chat_sync: missing chatId in index`,(0,A.throwInvalidActionIndex)()),!d.default.isWid(a))return(0,b.uploadCriticalEventMetric)(S.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:g.SyncActionState.Malformed};const e=(0,u.createWid)(a),{pinAction:r}=n;if(null==r)return __LOG__(3)`syncd: pin_chat_sync: missing pinAction`,Promise.resolve({actionState:g.SyncActionState.Malformed});const{pinned:o}=r;if(null==o)return __LOG__(3)`syncd: pin_chat_sync: missing pinned field`,Promise.resolve({actionState:g.SyncActionState.Malformed});if(null==(yield(0,v.getChatTable)().get(e.toString())))return{actionState:g.SyncActionState.Orphan,orphanModel:{modelType:g.SyncModelType.Chat,modelId:e.toString()}};if(!o)return yield t.applyUpdates([{wid:e,pinned:!1,timestamp:i}]),{actionState:g.SyncActionState.Success};const s=yield t.getLocalPins();if(s.some((t=>t.chatId.toString()===e.toString())))return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:g.SyncActionState.Success};if(s.length<3)return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:g.SyncActionState.Success};const l=s.reduce(((e,t)=>t.timestamp<e.timestamp?t:e)),c=[],p=l.timestamp<i?l.chatId:e;return p===l.chatId&&c.push({wid:l.chatId,pinned:!1,timestamp:i},{wid:e,pinned:!0,timestamp:i}),yield Promise.all([t.applyUpdates(c),t.createPendingUnpin(p,i)]),Promise.resolve({actionState:g.SyncActionState.Success})}catch(e){return{actionState:g.SyncActionState.Failed}}}))()}applyUpdates(e){return(0,i.default)((function*(){if(0===e.length)return;const t=e.map((e=>{let{wid:t,pinned:r,timestamp:n}=e;const i={id:t.toString(),pin:r?n:0};return r&&(i.archive=!1),i}));yield Promise.all(t.map((e=>(0,v.getChatTable)().merge(e.id,e)))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield(0,y.getExisting)(e.wid);null!=t&&(t.pin=e.pinned?e.timestamp:0,e.pinned&&(t.archive=!1))}));return function(){return e.apply(this,arguments)}}()))}))()}createPendingUnpin(e,t){var r=this;return(0,i.default)((function*(){yield m.default.appendPendingMutationsRows([r.getPinMutation(t,!1,e)])}))()}getLocalPins(){return(0,i.default)((function*(){const e=(0,v.getChatTable)().all().then((e=>e.filter((e=>null!=e.pin&&e.pin>0)).map((e=>[e.id,(0,o.default)(e.pin,"chatRow.pin")])))),t=m.default.getSyncActionsRows(["action"],[g.Actions.Pin]).then((e=>e.filter((e=>e.actionState===g.SyncActionState.Orphan)).map((e=>{var t;const r=JSON.parse(e.index);if(r.length<2)return null;const n=r[1],i=(0,p.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction);return null!=i.pinAction&&i.pinAction.pinned?[n,(0,a.numberOrThrowIfTooLarge)(null!==(t=i.timestamp)&&void 0!==t?t:0)]:null})).filter(Boolean))),[r,n]=yield Promise.all([e,t]);return[...r,...n].map((e=>{let[t,r]=e;return{chatId:(0,u.createWid)(t),timestamp:r}}))}))()}unpinAll(){var e=this;return(0,i.default)((function*(){const t=yield e.getLocalPins(),r=(0,c.unixTimeMs)(),n=t.map((t=>{let{chatId:n}=t;return e.getPinMutation(r,!1,n)}));return(0,C.lockForSync)(["chat"],n,(()=>Promise.resolve())).then((()=>e.applyUpdates(t.map((e=>{let{chatId:t}=e;return{wid:t,pinned:!1,timestamp:r}})))))}))()}getMutationsForPin(e,t,r){var n=this;return(0,i.default)((function*(){const i=[n.getPinMutation(e,t,r)];return t&&i.push(yield h.default.getArchiveChatMutation(e,!1,r)),i}))()}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}getPinMutation(e,t,r){return{collection:g.CollectionName.RegularLow,index:JSON.stringify([g.Actions.Pin,r.toString({legacy:!0})]),binarySyncAction:(0,f.encodeProtobuf)(l.SyncActionValueSpec,{timestamp:e,pinAction:{pinned:t}}).readBuffer(),version:this.version,operation:s.SyncdMutationSyncdOperation.SET,timestamp:e,action:g.Actions.Pin}}}const M=new P;Object.freeze(M);var O=M;t.default=O},44720:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=n(r(45095)),o=r(86945),s=r(45606),l=r(34771),c=r(89835);class d extends c.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,o.getABPropConfigValue)("primary_feature_sync"))return __LOG__(3)`primary feature sync: operation not supported`,e.map((()=>({actionState:s.SyncActionState.Unsupported})));let t;const r=e.map((e=>{var r;if("set"!==e.operation)return __LOG__(3)`primary feature sync: operation not supported`,{actionState:s.SyncActionState.Malformed};return null==(null===(r=e.value.primaryFeature)||void 0===r?void 0:r.flags)?(__LOG__(3)`primary feature sync: malformed mutation`,{actionState:s.SyncActionState.Malformed}):((null==t||e.timestamp>t.timestamp)&&(t=e),{actionState:s.SyncActionState.Success})}));if(null!=t){var n;const e=(0,a.default)(null===(n=t.value.primaryFeature)||void 0===n?void 0:n.flags,"latestMutation.value.primaryFeature?.flags");l.PrimaryFeatures.setPrimaryFeatures(e)}return r}))()}}const u=new d;Object.freeze(u);var p=u;t.default=p},42339:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(60980),l=r(45606),c=r(58597),d=n(r(11339)),u=n(r(45723)),p=r(53006),f=r(89835);class _ extends f.SyncActionBase{constructor(){super(...arguments),this.version=1}applyMutations(e){return(0,i.default)((function*(){return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{value:n}=e;let i=null===(t=n.pushNameSetting)||void 0===t?void 0:t.name;i||(__LOG__(3)`push name sync: empty pushname`,(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),i=""),(0,u.default)(i),(0,p.setPushnameLocally)(i),yield(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_APPLIED);const a=r(48277).default;return a.isSyncDCriticalDataSyncInProcess()&&(a.setSyncDCriticalSynced(),yield a.setSyncDCriticalDataSyncCompleted()),Promise.resolve({actionState:l.SyncActionState.Success})}return __LOG__(3)`push name sync: operation not supported`,Promise.resolve({actionState:l.SyncActionState.Unsupported})}catch(e){return(0,c.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),{actionState:l.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}))()}getPushnameMutation(e,t){return{collection:l.CollectionName.CriticalBlock,index:JSON.stringify([l.Actions.SettingPushName]),binarySyncAction:(0,s.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:e,pushNameSetting:{name:t}}).readBuffer(),version:this.version,operation:a.SyncdMutationSyncdOperation.SET,timestamp:e,action:l.Actions.SettingPushName}}}const h=new _;Object.freeze(h);var g=h;t.default=g},60282:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(45606),o=r(76214),s=r(99662),l=r(89835),c=r(22954);class d extends l.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{indexParts:t,value:r}=e,[,n]=t;n||(0,c.throwInvalidActionIndex)();const i=r.quickReplyAction;if(!i)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};if(i.deleted)return yield(0,o.getQuickReplyTable)().remove(n),s.QuickReplyCollection.remove(n),{actionState:a.SyncActionState.Success};const{shortcut:l,message:d}=i;if(!l||!d)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:a.SyncActionState.Malformed};const u=i.keywords||[],p=i.count||0;return yield(0,o.getQuickReplyTable)().createOrReplace({id:n,shortcut:l,count:p,message:d,keywords:u}),s.QuickReplyCollection.add({id:n,shortcut:l,message:d,keywords:u,count:p},{merge:!0}),{actionState:a.SyncActionState.Success}}return __LOG__(3)`quick replies sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const u=new d;Object.freeze(u);var p=u;t.default=p},40108:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(92844),l=r(60980),c=r(45606),d=n(r(73407)),u=r(837),p=r(89835);class f extends p.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const r=null===(t=e.value.keyExpiration)||void 0===t?void 0:t.expiredKeyEpoch;return null==r?(__LOG__(4,void 0,new Error)`sentinel mutation sync: malformed mutation`,{actionState:c.SyncActionState.Malformed}):(yield d.default.expireSyncKey(r),{actionState:c.SyncActionState.Success})}return __LOG__(3)`sentinel mutation sync: operation not supported`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}getSentinelMutations(){var e=this;return(0,i.default)((function*(){const t=(0,s.unixTimeMs)(),r=Array.from(c.CollectionName.members()),n={keyExpiration:{expiredKeyEpoch:(yield(0,u.getNewestKeyPair)()).keyEpoch},timestamp:t};return r.map((r=>({collection:r,index:JSON.stringify([c.Actions.Sentinel,r]),operation:a.SyncdMutationSyncdOperation.SET,version:e.version,binarySyncAction:(0,l.encodeProtobuf)(o.SyncActionValueSpec,n).readBuffer(),timestamp:t,action:c.Actions.Sentinel})))}))()}}const _=new f;Object.freeze(_);var h=_;t.default=h},21263:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(50073),o=r(381),s=r(92844),l=n(r(89867)),c=r(60980),d=r(45606),u=r(84886),p=n(r(11339)),f=r(76214),_=r(59871),h=r(19011),g=r(89835),m=r(22954),y=r(93824);class E extends g.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t,r,n,i]=e.indexArr;t&&r&&n&&i||(0,m.throwInvalidActionIndex)();const a=(0,m.syncKeyToMsgKey)(t,r,n,i);return{chatJid:t,messageKey:null==a?void 0:a.toString()}}applyMutations(e){return(0,i.default)((function*(){const t=[],r=[],n=new Set;yield(0,f.getMessageTable)().bulkGet(e.map((e=>{var t;const[,r,n,i,a]=e.indexParts;return r&&n&&i&&a&&l.default.isWid(r)?null===(t=(0,m.syncKeyToMsgKey)(r,n,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.add(e.id)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:o}=e,[,s,l,c,u]=a;s&&l&&c&&u||(0,m.throwInvalidActionIndex)();const f=null===(i=o.starAction)||void 0===i?void 0:i.starred;if(null==f)return __LOG__(3)`star message sync: malformed mutation`,{actionState:d.SyncActionState.Malformed};const g=(0,m.syncKeyToMsgKey)(s,l,c,u);if(!g)return(0,y.uploadCriticalEventMetric)(p.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:d.SyncActionState.Malformed};if(!n.has(g.toString()))return{actionState:d.SyncActionState.Orphan,orphanModel:{modelId:g.toString(),modelType:d.SyncModelType.Msg}};f?t.push(g.toString()):r.push(g.toString());const E=_.MsgCollection.get(g);return E?(E.star=f,E.star?(0,h.addStarredMsgs)([E]):(0,h.removeStarredMsgs)([E])):__LOG__(3)`star_message_sync: msg ${g} found in storage but not in collection`,{actionState:d.SyncActionState.Success}}return __LOG__(3)`star message sync: operation not supported`,{actionState:d.SyncActionState.Unsupported}}catch(e){return{actionState:d.SyncActionState.Failed}}})));return yield Promise.all([(0,u.starMessages)(t),(0,u.unstarMessages)(r)]),i}))()}getStarMessageMutations(e,t){const r=(0,s.unixTimeMs)();return e.map((e=>({collection:d.CollectionName.RegularHigh,index:(0,y.constructStarMsgKey)(e),operation:a.SyncdMutationSyncdOperation.SET,version:this.version,binarySyncAction:(0,c.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:r,starAction:{starred:t}}).readBuffer(),timestamp:r,action:d.Actions.Star})))}}const S=new E;Object.freeze(S);var v=S;t.default=v},89835:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionBase=void 0;var n=r(45606);t.SyncActionBase=class{getChatJidAndMessageKey(){}resolveConflicts(e,t){return t.timestamp>=e.timestamp?Promise.resolve(n.ConflictResolutionState.ApplyRemoteAndDropLocal):Promise.resolve(n.ConflictResolutionState.SkipRemote)}dropMutationDueToCrossIndexConflict(){return Promise.resolve(!1)}}},22954:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncKeyToMsgKey=function(e,t,r,n){let l;if(!a.default.isWid(e))return __LOG__(3)`syncKeyToMsgKey: invalid remote value: ${e.replace(d,"#")}`,null;if(!(0,o.createWid)(e).isUser()){if("0"===r&&!a.default.isWid(n))return __LOG__(3)`syncKeyToMsgKey: invalid participant value: ${n.replace(d,"#")}`,null;l="1"===r?(0,s.getMeUser)():(0,o.createWid)(n)}return new i.default({fromMe:"1"===r,remote:(0,o.createWid)(e),id:t,participant:l})},t.throwInvalidActionIndex=function(){throw new l.default.MdFatalError({mdFatalErrorCode:l.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX}).commit(),new c.SyncdFatalError("invalid action index")};var i=n(r(65212)),a=n(r(89867)),o=r(45454),s=r(99234),l=n(r(11339)),c=r(85156);const d=/\d(?=)/gm},11681:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(92844),o=r(45606),s=r(76214);class l{static loadStatesFromDb(){var e=this;return(0,i.default)((function*(){(yield(0,s.getCollectionVersionTable)().all()).forEach((t=>e.collectionStates.set(t.collection,{collection:t.collection,state:t.state,finiteFailureStartTime:t.finiteFailureStartTime})))}))()}static persistToDb(){const e=[];return this.collectionStates.forEach((t=>e.push(t))),__LOG__(2)`syncd: state machine persistToDb. states:`,e.forEach((e=>{__LOG__(2)`syncd: ${e.collection}: ${e.state}`})),(0,s.getCollectionVersionTable)().bulkCreateOrMerge(e)}static clean(){this.collectionStates=new Map}static getCollectionState(e){const t=this.collectionStates.get(e);return t?t.state:(this.moveCollectionsToUpToDate([e]),o.CollectionSyncState.UpToDate)}static getCollectionsInStateDirty(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Dirty&&e.push(t.collection)})),e}static getCollectionsInStateRetry(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.FailingFiniteRetry&&e.push(t.collection)})),e}static getCollectionsInStateFatal(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Fatal&&e.push(t.collection)})),e}static getCollectionsInStateBlocked(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Blocked&&e.push(t.collection)})),e}static moveCollectionsToUpToDate(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.UpToDate,finiteFailureStartTime:void 0})))}static moveCollectionsToDirty(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Dirty,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static moveCollectionsToFiniteRetry(e){e.forEach((e=>{var t,r;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.FailingFiniteRetry,finiteFailureStartTime:null!==(t=null===(r=this.collectionStates.get(e))||void 0===r?void 0:r.finiteFailureStartTime)&&void 0!==t?t:(0,a.unixTimeMs)()})}))}static moveCollectionsToFatal(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Fatal})))}static moveCollectionsToBlocked(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Blocked,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static getExpiredCollections(){const e=[];return this.collectionStates.forEach((t=>{if(t.state===o.CollectionSyncState.FailingFiniteRetry){let r;null==t.finiteFailureStartTime?(r=1/0,__LOG__(3)`Collection ${t.collection} is in finite retry state with no failure start time`):r=t.finiteFailureStartTime;r+o.FINITE_FAILURE_EXPIRY_DURATION<(0,a.unixTimeMs)()&&e.push(t.collection)}})),e}}t.default=l,l.collectionStates=new Map},45606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncModelType=t.SyncDataType=t.SyncActionState=t.MIN_PATCH_SIZE=t.MIN_INLINE_MUTATIONS=t.MAX_PATCH_SIZE=t.MAX_INLINE_MUTATIONS=t.LABEL_ASSOCIATION_SYNC_VERSION=t.FINITE_FAILURE_EXPIRY_DURATION=t.DEFAULT_COLLECTION_VERSION=t.ConflictResolutionState=t.CollectionSyncState=t.CollectionState=t.CollectionName=t.BACKOFF_MIN_TIMEOUT=t.BACKOFF_MAX_TIMEOUT=t.BACKOFF_BASE=t.Actions=void 0;var n=r(92844);t.BACKOFF_MIN_TIMEOUT=1e3;t.BACKOFF_MAX_TIMEOUT=36e5;t.BACKOFF_BASE=2;const i=2*n.DAY_MILLISECONDS;t.FINITE_FAILURE_EXPIRY_DURATION=i;t.MIN_INLINE_MUTATIONS=100;t.MAX_INLINE_MUTATIONS=2e3;t.MIN_PATCH_SIZE=10;t.MAX_PATCH_SIZE=100;t.DEFAULT_COLLECTION_VERSION=0;t.LABEL_ASSOCIATION_SYNC_VERSION=3;const a=r(76672)({Star:"star",Contact:"contact",Mute:"mute",PinDEPRECATED:"pin",Pin:"pin_v1",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel",UnarchiveChatsSetting:"setting_unarchiveChats",DeleteChat:"deleteChat",AndroidUnsupportedActions:"android_unsupported_actions",PrimaryFeature:"primary_feature",Nux:"nux"});t.Actions=a;const o=r(76672)({Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});t.CollectionName=o;const s=r(76672).Mirrored(["Success","SuccessHasMore","Conflict","ConflictHasMore","ErrorRetry","ErrorFatal","Blocked"]);t.CollectionState=s;const l=r(76672).Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]);t.CollectionSyncState=l;const c=r(76672).Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]);t.SyncActionState=c;const d=r(76672)({Msg:"Msg",Chat:"Chat"});t.SyncModelType=d;const u=r(76672).Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]);t.ConflictResolutionState=u;const p=r(76672).Mirrored(["Patch","Snapshot"]);t.SyncDataType=p},58597:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logCriticalBootstrapStageIfNecessary=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=r(86945),s=r(49801),l=n(r(11339));function c(){return(c=(0,i.default)((function*(e){(yield(0,o.getABPropConfigValue)("md_app_state_critical_data_processing_logging"))&&r(48277).default.isSyncDCriticalDataSyncInProcess()&&new l.default.MdBootstrapAppStateCriticalDataProcessing({bootstrapAppStateDataStage:e,mdSessionId:yield s.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,a.unixTimeMs)()}).commit()}))).apply(this,arguments)}},73407:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(48926)),a=r(899),o=(r(381),r(84902),r(76214)),s=r(99069);const l=new ArrayBuffer(a.KEY_LENGTH_BYTES);t.default=class{static getAllPendingMutationsRows(){return(0,o.getPendingMutationsTable)().all()}static performTransaction(e){return(0,s.getStorage)().lock(["collection-version","pending-mutations","sync-actions"],e)}static getPendingMutationsRows(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static getPendingMutationsRowsById(e){return(0,i.default)((function*(){return(yield(0,o.getPendingMutationsTable)().bulkGet(e)).filter(Boolean)}))()}static getPendingMutationsRowsByIndex(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static appendPendingMutationsRows(e){return(0,o.getPendingMutationsTable)().bulkCreate(e)}static bulkUpdatePendingMutationsKeyId(e){return(0,o.getPendingMutationsTable)().bulkCreateOrMerge(e)}static bulkRemovePendingMutations(e){return(0,o.getPendingMutationsTable)().bulkRemove(e)}static hasPendingMutationForCollection(e){return(0,o.getPendingMutationsTable)().equals(["collection"],e).then((e=>e.length>0))}static getCollectionVersion(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return null==t?void 0:t.version}))()}static getCollectionVersions(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().bulkGet(e);return new Map(e.map(((e,r)=>{var n;return[e,null===(n=t[r])||void 0===n?void 0:n.version]})))}))()}static setCollectionVersion(e,t,r){return(0,o.getCollectionVersionTable)().createOrMerge(e,{collection:e,version:t,ltHash:r})}static getLtHash(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return(null==t?void 0:t.ltHash)||l}))()}static getAllCollectionLtHashes(){return(0,i.default)((function*(){return(yield(0,o.getCollectionVersionTable)().all()).map((e=>({collection:e.collection,ltHash:e.ltHash})))}))()}static getSyncAction(e){return(0,o.getSyncActionsTable)().get(e)}static getSyncActionsRows(e,t){return(0,o.getSyncActionsTable)().anyOf(e,t)}static setSyncAction(e){return(0,o.getSyncActionsTable)().createOrReplace(e)}static setSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrReplace(e)}static updateSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrMerge(e)}static deleteSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkRemove(e)}static getSyncKey(e){return(0,o.getSyncKeysTable)().get(e)}static getAllSyncKeys(){return(0,o.getSyncKeysTable)().all()}static createSyncKey(e){return(0,o.getSyncKeysTable)().create(e)}static getSyncKeyData(e){return(0,o.getSyncKeysTable)().get(e)}static expireSyncKey(e){return(0,i.default)((function*(){(yield(0,o.getSyncKeysTable)().equals(["keyEpoch"],e)).forEach((e=>(0,o.getSyncKeysTable)().merge(e.keyId,{keyId:e.keyId,timestamp:0})))}))()}static getMissingKey(e){return(0,o.getMissingKeysTable)().get(e)}static getMissingKeyCount(){return(0,o.getMissingKeysTable)().count()}static bulkGetMissingKeys(e){return(0,o.getMissingKeysTable)().bulkGet(e)}static getAllMissingKeys(){return(0,o.getMissingKeysTable)().all()}static bulkRemoveMissingKeys(e){return(0,o.getMissingKeysTable)().bulkRemove(e)}static createOrUpdateMissingKeys(e){return(0,o.getMissingKeysTable)().bulkCreateOrMerge(e)}}},1377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkLtHash=function(){return O.apply(this,arguments)},t.computeLtHash=P,t.computeLtHashAndValidatePatch=function(){return S.apply(this,arguments)},t.computeLtHashAndValidateSnapshot=function(){return E.apply(this,arguments)},t.computeOutgoingSnapshotAndPatchMacs=function(){return b.apply(this,arguments)},t.logMacsInSnapshot=D;var i=n(r(48926)),a=r(899),o=r(7589),s=r(50073),l=r(62109),c=r(63109),d=r(85156),u=r(45606),p=n(r(73407)),f=r(68254),_=r(837),h=n(r(11339)),g=r(85156);function m(e,t){return`${e.slice(-16)}:${(0,c.arrayBufferToHexPadded)(t).slice(-16)}`}const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){const{mac:r,version:n,keyId:i,records:o}=t,s=yield(0,_.getKeyData)(i.id);if(!s)throw new g.SyncdMissingKeyError;const d=new Map(o.map((e=>[(0,c.arrayBufferToHexPadded)(e.index.blob),(0,l.valueMacFromIndexAndValueCipherText)(e.value.blob)])));__LOG__(2)`syncd:
${e} snapshot macsToAdd:
    ${Array.from(d.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}`;const u=yield a.LT_HASH_ANTI_TAMPERING.add(a.EMPTY_LT_HASH,Array.from(d.values())),{snapshotMacKey:p}=yield(0,l.generateEncryptionKeys)(s),f=(0,c.to64BitNetworkOrder)(n.version),h=(0,c.toUtf8)(e).buffer;return __LOG__(2)`syncd: validating snapshot mac for ${e} snapshot v${n.version}:
ltHash: ${(0,c.arrayBufferToHexPadded)(u)}
encoded version: ${(0,c.arrayBufferToHexPadded)(f)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(h)}
expected snapshotMAC: ${(0,c.arrayBufferToHexPadded)(r)}`,yield v(e,r,p,u,f,h,!0,o.length,t.version.version),u}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,r){const{version:n,mutations:i,snapshotMac:s,patchMac:u,keyId:f}=t,h=f.id,m=yield(0,_.getKeyData)(h);if(!m)throw new g.SyncdMissingKeyError;const{snapshotMacKey:y,patchMacKey:E}=yield(0,l.generateEncryptionKeys)(m),S=i.map((e=>({operation:e.operation,indexMac:e.record.index.blob,valueMac:(0,l.valueMacFromIndexAndValueCipherText)(e.record.value.blob)}))),T=yield P(e,S),A=(0,c.to64BitNetworkOrder)(n.version),b=(0,c.toUtf8)(e).buffer;__LOG__(2)`syncd: validating snapshot and patch mac for ${e} v${n.version}:
expected snapshotMAC: ${(0,c.arrayBufferToHexPadded)(s)}
expected patchMAC: ${(0,c.arrayBufferToHexPadded)(u)}
encoded version: ${(0,c.arrayBufferToHexPadded)(A)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(b)}
key ID: ${(0,c.arrayBufferToHexPadded)(h)}`;try{yield C(e,u,E,s,S.map((e=>e.valueMac)),A,b,i.length,n.version),yield v(e,s,y,T,A,b,!1,i.length,n.version,r)}catch(t){if(yield D(e),t instanceof g.SyncdFatalError){var M;const t=null!==(M=yield p.default.getCollectionVersion(e))&&void 0!==M?M:0;if(t!==n.version-1){const r=t>n.version-1?"greater-than-expected":"less-than-expected";throw __LOG__(3,void 0,void 0,!0)`syncd: ${e} patch v${n.version} !== current ${e} version (v${t}) - 1`,SEND_LOGS(`syncd-version-check-error-local-version-${r}`),new d.SyncdVersionCheckError}const r=yield p.default.getLtHash(e);if((0,o.areBuffersEqual)(r,a.EMPTY_LT_HASH))throw __LOG__(3,void 0,void 0,!0)`syncd: empty local lthash found when processing ${e} patch v${n.version}`,SEND_LOGS("syncd-empty-lthash-on-mac-mismatch"),new d.SyncdRetryableError("empty lthash")}throw t}return T}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r,n,i,a,s,c,d,u){const p=yield(0,l.generateSnapshotMac)(r,n,i,a);if(!(0,o.areBuffersEqual)(p,t)){let t=s?h.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:h.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_PATCH;throw s||!0!==u||(t=h.default.MD_SYNCD_FATAL_ERROR_CODE.SERVER_DID_NOT_SEND_ALL_PATCHES),yield(0,f.uploadFatalErrorMetric)(t,e,c,d),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate snapshot mac.`,SEND_LOGS("syncd: unable to validate snapshot mac."),new g.SyncdFatalError("unable to validate snapshot mac")}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n,i,a,s,c,d){const u=yield(0,l.generatePatchMac)(r,n,i,a,s);if(!(0,o.areBuffersEqual)(u,t))throw yield(0,f.uploadFatalErrorMetric)(h.default.MD_SYNCD_FATAL_ERROR_CODE.MAC_MISMATCH_PATCH,e,c,d),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate patch mac.`,SEND_LOGS("syncd: unable to validate patch mac."),new g.SyncdFatalError("unable to validate patch mac")}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r,n){const i=((yield p.default.getCollectionVersion(e))||u.DEFAULT_COLLECTION_VERSION)+1,{patchMacKey:a,snapshotMacKey:o}=yield(0,l.generateEncryptionKeys)(n),s=(0,c.to64BitNetworkOrder)(i),d=(0,c.toUtf8)(e).buffer,f=yield(0,l.generateSnapshotMac)(o,t,s,d),_=yield(0,l.generatePatchMac)(a,f,r.map((e=>e.valueMac)),s,d);return __LOG__(2)`syncd: computing snapshot and patch macs for outgoing patch ${e} v${i}:
encoded version: ${(0,c.arrayBufferToHexPadded)(s)}
encoded collection: ${(0,c.arrayBufferToHexPadded)(d)}
snapshotMAC: ${(0,c.arrayBufferToHexPadded)(f)}
patchMAC: ${(0,c.arrayBufferToHexPadded)(_)}`,{snapshotMac:f,patchMac:_}}))).apply(this,arguments)}function P(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){const r=yield p.default.getLtHash(e),n=yield w(t.map((e=>e.indexMac))),i=new Map,o=new Map,l=new Map;t.forEach((t=>{const{indexMac:r,valueMac:a,operation:d}=t,u=y.decode(r),p=n.get(u);p?d===s.SyncdMutationSyncdOperation.REMOVE?o.set((0,c.arrayBufferToHexPadded)(r),p):l.set((0,c.arrayBufferToHexPadded)(r),p):d===s.SyncdMutationSyncdOperation.REMOVE&&(__LOG__(3,void 0,void 0,!0)`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e}:
${(0,c.arrayBufferToHexPadded)(r).slice(-16)}`,SEND_LOGS(`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e}`)),d===s.SyncdMutationSyncdOperation.SET&&i.set((0,c.arrayBufferToHexPadded)(r),a)}));const d=yield a.LT_HASH_ANTI_TAMPERING.subtractThenAdd(r,Array.from(i.values()),Array.from(o.values()).concat(Array.from(l.values())));return __LOG__(2)`syncd: computing ltHash for ${e}:
currentLtHash: ${(0,c.arrayBufferToHexPadded)(r)}
macsToAdd:
    ${Array.from(i.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}
macsToRemove:
    ${Array.from(o.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}
macsToOverwrite (also remove):
    ${Array.from(l.entries()).map((e=>{let[t,r]=e;return m(t,r)})).join("\n\t")}
newLtHash: ${(0,c.arrayBufferToHexPadded)(d)}`,d}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(){const e=[];yield p.default.performTransaction((0,i.default)((function*(){const t=yield p.default.getAllCollectionLtHashes();yield Promise.all(t.map(function(){var t=(0,i.default)((function*(t){let{collection:r,ltHash:n}=t;const i=yield p.default.getSyncActionsRows(["collection"],[r]);e.push({collection:r,ltHash:n,mutations:i})}));return function(){return t.apply(this,arguments)}}()))}))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){let{collection:t,ltHash:r,mutations:n}=e;const i=yield I(n);(0,o.areBuffersEqual)(r,i)||(__LOG__(4,!0,new Error,!0)`syncd: failed LtHash check for ${t}`,SEND_LOGS("LtHash check failed"))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function I(e){const t=new Map(e.map((e=>[(0,c.arrayBufferToHexPadded)(e.indexMac),e.valueMac])));return a.LT_HASH_ANTI_TAMPERING.add(a.EMPTY_LT_HASH,Array.from(t.values()))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=yield p.default.getSyncActionsRows(["indexMac"],e);return new Map(t.map((e=>[y.decode(e.indexMac),e.valueMac])))}))).apply(this,arguments)}function D(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e){const[t,r]=yield p.default.performTransaction((0,i.default)((function*(){return[yield p.default.getCollectionVersion(e),yield p.default.getSyncActionsRows(["collection"],[e])]})));if(__LOG__(2)`syncd: current snapshot ${e} v${t} with ${r.length} mutations:`,r.length>100)return;r.reduce(((e,t,r)=>(r%20==0&&e.push(""),e[e.length-1]+=m((0,c.arrayBufferToHexPadded)(t.indexMac),t.valueMac)+" | ",e)),[]).forEach((e=>__LOG__(2)`|${e}`))}))).apply(this,arguments)}},2161:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.maxSupportedVersion=t.ActionHandlers=void 0;var i=n(r(6162)),a=n(r(21084)),o=n(r(74362)),s=n(r(28464)),l=n(r(29867)),c=r(45606),d=n(r(24900)),u=n(r(56928)),p=n(r(41058)),f=n(r(12123)),_=n(r(35096)),h=n(r(80056)),g=n(r(79171)),m=n(r(64294)),y=n(r(70119)),E=n(r(34610)),S=n(r(36014)),v=n(r(44720)),T=n(r(42339)),C=n(r(60282)),A=n(r(40108)),b=n(r(21263));const P=new Map([[c.Actions.Star,b.default],[c.Actions.Contact,d.default],[c.Actions.Mute,y.default],[c.Actions.LabelEdit,h.default],[c.Actions.LabelMessage,_.default],[c.Actions.LabelJid,f.default],[c.Actions.QuickReply,C.default],[c.Actions.LocaleSetting,g.default],[c.Actions.SettingPushName,T.default],[c.Actions.Archive,o.default],[c.Actions.MarkChatAsRead,m.default],[c.Actions.ClearChat,l.default],[c.Actions.DeleteMessageForMe,p.default],[c.Actions.Sentinel,A.default],[c.Actions.UnarchiveChatsSetting,s.default],[c.Actions.Pin,S.default],[c.Actions.DeleteChat,u.default],[c.Actions.AndroidUnsupportedActions,a.default],[c.Actions.PrimaryFeature,v.default],[c.Actions.Nux,E.default]]);t.ActionHandlers=P;t.maxSupportedVersion=()=>(0,i.default)(Array.from(P.values()).map((e=>e.version)))},29938:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAppStateSyncResponse=function(){return U.apply(this,arguments)},t.applyIndividualMutations=function(){return G.apply(this,arguments)};var i=n(r(6479)),a=n(r(48926)),o=n(r(89734)),s=r(8243),l=n(r(45095)),c=r(50073),d=r(381),u=r(92844),p=r(84902),f=r(2161),_=n(r(21084)),h=r(1377),g=r(45606),m=r(58597),y=n(r(73407)),E=r(58743),S=r(68254),v=r(84051),T=r(49801),C=n(r(11339)),A=r(59037),b=r(11540),P=r(85156),M=r(93824),O=r(6954),I=r(72466),w=n(r(89453)),R=n(r(78375)),D=r(35377),N=r(62274);const L=["indexMac","valueMac"],k=new ArrayBuffer(128);function G(){return(G=(0,a.default)((function*(e){if(0===e.length)return Promise.resolve();__LOG__(2)`syncd: start applyIndividualMutations`;const t=(0,O.syncActionsToDecryptedMutation)(e).reduce(((e,t)=>{var r;const n=null!==(r=e.get(t.collection))&&void 0!==r?r:[];return n.push(t),e.set(t.collection,n),e}),new Map),r=Array.from(t.keys()).map(function(){var e=(0,a.default)((function*(e){__LOG__(2)`syncd: apply individual mutations for collection ${e}`;const r=t.get(e);if(void 0===r)return;const{setMutationsToPersist:n,pendingMutationsToDrop:o}=yield z(e,r,!0),s=n.map((e=>{const{indexMac:t,valueMac:r}=e;return(0,i.default)(e,L)}));__LOG__(2)`syncd: end apply individual mutations for collection ${e}`,yield y.default.performTransaction((0,a.default)((function*(){yield y.default.updateSyncActionRows(s),yield y.default.bulkRemovePendingMutations(o)}))),__LOG__(2)`syncd: end update db after apply individual mutations for collection ${e}`}));return function(){return e.apply(this,arguments)}}());yield Promise.all(r),__LOG__(2)`syncd: end applyIndividualMutations`}))).apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e,t){const{name:r,version:n,patches:i,snapshot:a,syncedPendingMutationsId:o,syncedEncryptedMutations:s}=e;__LOG__(2)`syncd: start applying collection ${r}`;try{const[l,c]=yield B(r,i,a,t),d=performance.now();if(null!=l)yield j(r,l,c,t),__LOG__(2)`syncd: ${r} snapshot and patches applied successfully`;else if(null!=c){const e=Math.min.apply(Math,c.map((e=>e.version.version))),n=null!=t&&e>t+1&&c.length>0;if(n){const n=yield y.default.getAllMissingKeys();__LOG__(2)`syncd: missing keys: [${n.map((e=>e.keyHex+":"+e.timestamp))}]`,__LOG__(3,void 0,void 0,!0)`syncd: has missing patches. collection: ${r}, localVersion: ${t},
minPatch: ${e}`,SEND_LOGS("syncd: has missing patches")}yield W(r,c,t,n),__LOG__(2)`syncd: ${r} patches applied successfully`}else null!=n?(yield F(r,n,o,s),__LOG__(2)`syncd: ${r} v${n} uploaded successfully`):((0,M.isBootstrap)(t)&&(yield y.default.setCollectionVersion(r,0,k)),__LOG__(2)`syncd: sync ${r} but there are no updates`);const p=Math.floor(performance.now()-d);return __LOG__(2)`syncd: applyAppStateSyncResponse: finished applying ${r} in ${p}ms`,(c||l)&&(0,M.isBootstrap)(t)&&!(0,M.isCriticalCollection)(r)&&new C.default.MdBootstrapDataApplied({mdBootstrapPayloadType:C.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapSource:C.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield T.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,u.unixTimeMs)(),mdBootstrapStepDuration:p,collection:(0,M.collectionNameToMetric)(r),usedSnapshot:null!=l}).commit(),yield(0,h.logMacsInSnapshot)(e.name),e}catch(e){const t=e.message;return e instanceof P.SyncdMissingKeyError?(__LOG__(3)`syncd: key error: ${r} missing keys`,{name:r,state:g.CollectionState.Blocked}):e instanceof P.SyncdFatalError?(__LOG__(4,void 0,new Error,!0)`syncd: fatal error: ${r} throws ${t}`,SEND_LOGS(`syncd: fatal error: ${String(r)} throws ${t}`),{name:r,state:g.CollectionState.ErrorFatal}):(__LOG__(3,void 0,void 0,!0)`syncd: retryable error: ${r} throws ${t}`,SEND_LOGS(`syncd: retryable error: ${String(r)} throws ${t}`),{name:r,state:g.CollectionState.ErrorRetry})}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e,t,r,n){yield(0,h.logMacsInSnapshot)(e);const i=n.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),o=yield(0,h.computeLtHash)(e,i),s=(0,O.encryptedUploadMutationsToSyncActions)(n.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),g.SyncActionState.Success);__LOG__(2)`syncd: _uploadSuccessful: write to db for ${e}`,yield y.default.performTransaction((0,a.default)((function*(){yield y.default.setSyncActionRows(s),yield y.default.bulkRemovePendingMutations(r),yield y.default.setCollectionVersion(e,t,o)}))),__LOG__(2)`syncd: end _uploadSuccessful for ${e}`}))).apply(this,arguments)}function B(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e,t,r,n){let i=Promise.resolve(),o=0;const l=(0,u.unixTimeMs)();if(null!=r){const t=w.default.validateExternalBlobReference(e,r);o+=(0,s.numberOrThrowIfTooLarge)(t.fileSizeBytes||0),__LOG__(2)`syncd: download snapshot for ${e}`,i=(0,A.downloadSnapshot)(e,t)}let c,d,p=Promise.resolve();if(null!=t){const r=t.map((t=>w.default.validatePatchProtobuf(e,t)));p=Promise.all(r.map(function(){var t=(0,a.default)((function*(t){let r=t.mutations||[];const n=t.externalMutations;return n&&(__LOG__(2)`syncd: download patch for ${e}`,r=yield(0,A.downloadExternalPatch)(e,n),__LOG__(2)`syncd: ${e}'s external patch downloaded`,o+=(0,s.numberOrThrowIfTooLarge)(n.fileSizeBytes||0)),{mutations:r,version:t.version,snapshotMac:t.snapshotMac,patchMac:t.patchMac,keyId:t.keyId,exitCode:t.exitCode,deviceIndex:t.deviceIndex}}));return function(){return t.apply(this,arguments)}}()))}try{[c,d]=yield Promise.all([i,p]),(0,M.isBootstrap)(n)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,o,!0)}catch(t){throw(0,M.isBootstrap)(n)&&(0,N.commitBootstrapAppStateDownloadMetric)(e,l,o,!1),t}return[c,d]}))).apply(this,arguments)}function j(){return Y.apply(this,arguments)}function Y(){return(Y=(0,a.default)((function*(e,t,r,n){yield(0,h.logMacsInSnapshot)(e);try{__LOG__(2)`syncd: start validate ${e}'s snapshot`;const r=yield(0,h.computeLtHashAndValidateSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot validated`;const n=yield(0,E.tryDecryptSnapshot)(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot decrypted`,R.default.addMutationCount(t.records.length),(0,D.logMetricsForMutations)(n),(0,I.validateNoSameIndexForMultipleMutations)(e,n,g.SyncDataType.Snapshot);const i=t.version.version,{setMutationsToPersist:o,pendingMutationsToDrop:s}=yield z(e,n);__LOG__(2)`syncd: processed ${n.length} mutations in snapshot of collection ${e} v${i}`,__LOG__(2)`syncd: collection ${e}'s snapshot v${i} applied`,yield y.default.performTransaction((0,a.default)((function*(){yield y.default.setSyncActionRows(o),yield y.default.bulkRemovePendingMutations(s),yield y.default.setCollectionVersion(e,i,r)}))),__LOG__(2)`syncd: completed applying snapshot for ${e}`}catch(r){throw r instanceof P.SyncdMissingKeyError&&(yield(0,v.handleMissingKeysInSnapshot)(e,t)),r}if(r)return W(e,r,n)}))).apply(this,arguments)}function W(){return H.apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t,r,n){if(0===t.length)return __LOG__(2)`syncd: no patches for collection ${e}`,Promise.resolve();(0,I.validateNoDuplicatePatchVersionInCollection)(e,t);const i=(0,o.default)(t,(e=>e.version.version));try{for(let t=0;t<i.length;t++)yield V(e,i[t],r,n)}catch(t){throw t instanceof P.SyncdMissingKeyError&&(yield(0,v.handleMissingKeysInPatches)(e,i)),t}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,r,n){if(yield(0,h.logMacsInSnapshot)(e),t.exitCode){var i;const r=t.exitCode.code;switch(r){case 100:(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_MISSING_DATA,e);break;case 101:(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_DESERIALIZATION_ERROR,e);break;default:(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_UNKNOWN,e)}throw new P.SyncdFatalError(`received terminal patch with exit code:  ${String(r)} text: ${String(null===(i=t.exitCode)||void 0===i?void 0:i.text)}  `)}0===t.deviceIndex&&_.default.updatePrimaryAllowsAllMutationsFlag("device index");const o=t.mutations.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)).length,s=t.mutations.length-o;__LOG__(2)`syncd: applying patch ${e} v${t.version.version} from device ${t.deviceIndex}
SET count: ${o}
REMOVE count: ${s}`,0===o&&0===s&&(__LOG__(3,void 0,void 0,!0)`syncd: ${e}: empty patch found`,SEND_LOGS(`syncd: ${e}: empty patch found`));const l=yield(0,h.computeLtHashAndValidatePatch)(e,t,n);__LOG__(2)`syncd: completed computeLtHashAndValidatePatch for ${e} v${t.version.version}`;const d=yield(0,E.tryDecryptPatch)(e,t);(0,D.logMetricsForMutations)(d),R.default.addMutationCount(d.length),(0,I.validateNoSameIndexForMultipleMutations)(e,d,g.SyncDataType.Patch);const u=Z(d),p=u.filter((e=>e.operation===c.SyncdMutationSyncdOperation.REMOVE));yield J(e,p),__LOG__(2)`syncd: completed _applyRemoveMutations for ${e} v${t.version.version}`;const f=u.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),{setMutationsToPersist:m,pendingMutationsToDrop:v}=yield z(e,f);__LOG__(2)`syncd: processed ${d.length} mutations in patch version ${t.version.version} of collection ${e}`;const T=t.version.version;yield y.default.performTransaction((0,a.default)((function*(){yield y.default.deleteSyncActionRows(p.map((e=>e.index))),yield y.default.setSyncActionRows(m),yield y.default.bulkRemovePendingMutations(v),yield y.default.setCollectionVersion(e,T,l)}))),__LOG__(2)`syncd: completed final transaction in _applyPatch for ${e} v${t.version.version}`}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,m.logCriticalBootstrapStageIfNecessary)(C.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ABOUT_TO_APPLY_MUTATIONS);const n=r?" (individual mutations)":"",i=[],a=(0,I.validateAndTypeSetMutations)(e,t),{supportedMutations:o,unsupportedMutations:s}=ee(e,a);s.forEach((e=>i.push((0,O.setMutationToSyncAction)(e,g.SyncActionState.Unsupported))));const{remoteMutationsToApply:c,pendingMutationsToDrop:u}=yield(0,b.resolveConflict)(e,o),f=o.filter((e=>!c.includes(e)));f.forEach((e=>i.push((0,O.setMutationToSyncAction)(e,g.SyncActionState.Skipped,e.actionName))));const _=te(c);for(let t=0;t<_.length;t++){const r=_[t][0].actionHandler,a=_[t].map((e=>{let t;return t=e.binarySyncData?(0,l.default)((0,p.decodeProtobuf)(d.SyncActionDataSpec,e.binarySyncData).value,"decodeProtobuf(SyncActionDataSpec, m.binarySyncData).value"):(0,p.decodeProtobuf)(d.SyncActionValueSpec,e.binarySyncAction),{operation:"set",indexParts:e.indexArr,value:t,timestamp:e.timestamp}}));__LOG__(2)`syncd: before apply mutation batch for ${e}. mutations count: ${a.length}  ${n}`;const o=yield r.applyMutations(a,{setMutationsPendingToPersist:i,allSupportedSetMutations:c});__LOG__(2)`syncd: after apply mutation batch for ${e}  ${n}`;for(let e=0;e<_[t].length;e++){var h,y;i.push((0,O.setMutationToSyncAction)(_[t][e],o[e].actionState,_[t][e].actionName,null===(h=o[e].orphanModel)||void 0===h?void 0:h.modelId,null===(y=o[e].orphanModel)||void 0===y?void 0:y.modelType))}}return(0,m.logCriticalBootstrapStageIfNecessary)(C.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.APPLIED_MUTATIONS),__LOG__(2)`syncd: completed apply set mutations for ${e}  ${n}`,{setMutationsToPersist:i,pendingMutationsToDrop:u}}))).apply(this,arguments)}function J(){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.default)((function*(e,t){const{supportedMutations:r}=X(t),n=te(r);__LOG__(2)`syncd: before apply remove mutations for ${e}`;for(let t=0;t<n.length;t++){const r=n[t][0].actionHandler;yield r.applyMutations(n[t].map((t=>({operation:"remove",indexParts:re(e,t.index)}))),{setMutationsPendingToPersist:[],allSupportedSetMutations:[]})}__LOG__(2)`syncd: after apply remove mutations for ${e}`}))).apply(this,arguments)}function X(e){const t=[],r=[];return e.forEach((e=>{if(e.version>(0,f.maxSupportedVersion)())return void r.push(e);const n=re(e.collection,e.index),i=g.Actions.cast(n[0]);if(!i)return __LOG__(3)`syncd: invalid action ${n[0]}`,void r.push(e);const a=f.ActionHandlers.get(i);if(!a)return __LOG__(3)`syncd: no handler for action ${i}`,void r.push(e);t.push({collection:e.collection,index:e.index,indexMac:e.indexMac,keyId:e.keyId,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version,indexArr:n,actionName:i,actionHandler:a})})),{supportedMutations:t,unsupportedMutations:r}}function Z(e){const t=e.filter((e=>e.operation===c.SyncdMutationSyncdOperation.SET)),r=new Set(t.map((e=>e.index)));return e.filter((e=>e.operation===c.SyncdMutationSyncdOperation.REMOVE)).forEach((e=>{r.has(e.index)||t.push(e)})),t}function ee(e,t){const r=[],n=[];return t.forEach((t=>{if(t.version>(0,f.maxSupportedVersion)())return void n.push(t);const i=re(e,t.index),a=g.Actions.cast(i[0]);if(!a)return __LOG__(3)`syncd: invalid action ${i[0]}`,void n.push(t);const o=f.ActionHandlers.get(a);if(!o)return __LOG__(3)`syncd: no handler for action ${a}`,void n.push(t);r.push({collection:t.collection,index:t.index,indexMac:t.indexMac,keyId:t.keyId,timestamp:t.timestamp,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,valueMac:t.valueMac,version:t.version,indexArr:i,actionName:a,actionHandler:o})})),{supportedMutations:r,unsupportedMutations:n}}function te(e){return e.reduce(((e,t)=>(0!==e.length&&t.actionName===e[e.length-1][0].actionName?e[e.length-1].push(t):e.push([t]),e)),[])}function re(e,t){try{const e=JSON.parse(t);if(e.length<1)throw new Error;return e}catch(t){throw(0,S.uploadFatalErrorMetric)(C.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX,e),new P.SyncdFatalError("invalid action index")}}},13815:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeExternalBlobReference=function(e,t){try{return(0,o.decodeProtobuf)(i.ExternalBlobReferenceSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("external blob reference protobuf deserialization failed")}},t.decodeSyncActionData=function(e,t){try{return(0,o.decodeProtobuf)(a.SyncActionDataSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("action data protobuf deserialization failed")}},t.decodeSyncdMutations=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdMutationsSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("mutations protobuf deserialization failed")}},t.decodeSyncdPatch=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdPatchSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("patch protobuf deserialization failed")}},t.decodeSyncdSnapshot=function(e,t){try{return(0,o.decodeProtobuf)(i.SyncdSnapshotSpec,t)}catch(t){throw(0,s.uploadFatalErrorMetric)(l.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED,e),new c.SyncdFatalError("snapshot protobuf deserialization failed")}};var i=r(50073),a=r(381),o=r(84902),s=r(68254),l=n(r(11339)),c=r(85156)},58743:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.tryDecryptPatch=function(){return S.apply(this,arguments)},t.tryDecryptSnapshot=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(7589),o=r(50073),s=r(381),l=r(62109),c=r(32458),d=r(63109),u=r(60980),p=r(13815),f=r(68254),_=r(837),h=n(r(11339)),g=r(85156),m=n(r(16088));const y=new TextDecoder;function E(){return(E=(0,i.default)((function*(e,t){return yield Promise.all(t.records.map((t=>v(e,o.SyncdMutationSyncdOperation.SET,t))))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){return yield Promise.all(t.mutations.map((t=>v(e,t.operation,t.record))))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,r){const n=r.keyId.id,i=yield(0,_.getKeyData)(n);if(!i){if(t===o.SyncdMutationSyncdOperation.REMOVE)throw new g.SyncdFatalError("no key data for remove mutations");throw new g.SyncdMissingKeyError}const{syncAction:a,indexMac:l,valueMac:c,indexValueBinary:d}=yield C(e,n,i,t,r),{index:p,value:f,version:h}=a,m=f?(0,u.encodeProtobuf)(s.SyncActionValueSpec,f).readBuffer():f;return{index:y.decode(p),action:null,binarySyncAction:m,version:h,keyId:n,operation:t,indexMac:l,valueMac:c,collection:e,binarySyncData:d}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,r,n,i){const o=i.index.blob,s=i.value.blob,u=(0,l.valueMacFromIndexAndValueCipherText)(s),_=(0,d.split)(s,c.IV_LENGTH,s.byteLength-c.MAC_LENGTH-c.IV_LENGTH),y=_[0],E=_[1],S=_[2],v=yield(0,l.generateEncryptionKeys)(r),{indexKey:T,valueEncryptionKey:C,valueMacKey:A}=v,b=(0,d.combine)([y,E]),P=(0,l.generateAssociatedData)(n,t),M=yield(0,l.generateMac)(P,b,A);if(!(0,a.areBuffersEqual)(S,M))throw(0,f.uploadFatalErrorMetric)(h.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new g.SyncdFatalError("decryption failure: valueMAC mismatch");const O=yield(0,l.decryptCipherText)(new Uint8Array(y),C,E),I=(0,p.decodeSyncActionData)(e,O),w=m.default.validateSyncActionDataProtobuf(e,I),R=yield(0,l.generateIndexMac)(T,w.index);if(!(0,a.areBuffersEqual)(o,R))throw(0,f.uploadFatalErrorMetric)(h.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED,e),new g.SyncdFatalError("decryption failure: indexMAC mismatch");return{syncAction:w,indexMac:o,valueMac:u,indexValueBinary:O}}))).apply(this,arguments)}},59037:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadExternalPatch=function(){return g.apply(this,arguments)},t.downloadSnapshot=function(){return h.apply(this,arguments)};var a=i(r(81109)),o=i(r(48926)),s=r(15688),l=r(13815),c=r(26384),d=r(37115),u=r(68254),p=i(r(11339)),f=r(85156),_=i(r(89453));function h(){return(h=(0,o.default)((function*(e,t){try{const r=yield m(t),n=(0,l.decodeSyncdSnapshot)(e,r);return _.default.validateSnapshotProtobuf(e,n)}catch(r){if(__LOG__(2)`syncd: error downloading snapshot of expected size ${t.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(t.fileEncSha256).length} for collection ${e}`,r instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_EXPIRED,e),new f.SyncdFatalError("snapshot expired");throw r}}))).apply(this,arguments)}function g(){return(g=(0,o.default)((function*(e,t){try{const r=yield m(t);return(0,l.decodeSyncdMutations)(e,r).mutations.map((t=>_.default.validateMutationProtobuf(e,t)))}catch(r){if(__LOG__(2)`syncd: error downloading patch of expected size ${t.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(t.fileEncSha256).length} for collection ${e}`,r instanceof d.MediaNotFoundError)throw(0,u.uploadFatalErrorMetric)(p.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_PATCH_EXPIRED,e),new f.SyncdFatalError("external patch expired");throw r}}))).apply(this,arguments)}function m(e){const{mediaKey:t,directPath:r,fileSha256:i,fileEncSha256:o}=e,l={directPath:r,encFilehash:(0,s.encodeB64)(o),filehash:(0,s.encodeB64)(i),mediaKey:(0,s.encodeB64)(t),type:"md-app-state",userDownloadAttemptCount:0};return c.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new n).signal},l))}},11540:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.resolveConflict=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(45606),o=n(r(73407)),s=r(43402);function l(){return c.apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t){const r=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const r=t.get(e.index);if(r){const t=e.actionHandler;return{remoteMutationIndex:e.index,conflictResolutionState:yield t.resolveConflicts(r,e)}}}));return function(){return e.apply(this,arguments)}}())),n=new Map;return r.forEach((e=>{e&&n.set(e.remoteMutationIndex,e.conflictResolutionState)})),n}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const r=[];let n=[];const i=yield o.default.getPendingMutationsRows(["collection"],e),c=new Map(i.map((e=>[e.index,e]))),d=yield l(t,c);t.forEach((e=>{const t=d.get(e.index);if(t)switch(t){case a.ConflictResolutionState.SkipRemote:break;case a.ConflictResolutionState.ApplyRemoteAndDropLocal:r.push(e),n=n.concat(i.filter((t=>t.index===e.index)));break;case a.ConflictResolutionState.SkipRemoteAndDropLocal:n=n.concat(i.filter((t=>t.index===e.index)))}else r.push(e)}));const u=(0,s.sort)(r),p=[];for(let e=0;e<u.length;e++){const t=u[e].actionHandler;(yield t.dropMutationDueToCrossIndexConflict(u[e],c))||p.push(u[e])}return{remoteMutationsToApply:p,pendingMutationsToDrop:n.map((e=>e.id)).filter(Boolean)}}))).apply(this,arguments)}},43402:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._setDependency=function(e,t){l.set(e,t)},t.sort=function(e){const t=[],r=[];try{return e.forEach((n=>{t.push(n);const i=l.get(n.actionName);null!=i&&e.forEach((e=>{e!==n&&i.includes(e.actionName)&&function(e,t){const r=e.actionHandler.getChatJidAndMessageKey(e),n=t.actionHandler.getChatJidAndMessageKey(t);if(r&&n)return r.chatJid===n.chatJid&&(null==r.messageKey||null==n.messageKey||r.messageKey===n.messageKey);return!1}(e,n)&&(e.timestamp<n.timestamp?r.push([e,n]):r.push([n,e]))}))})),i.default.array(t,r)}catch(e){throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH,null),new s.SyncdFatalError("cyclic mutation dependency in patch")}};var i=n(r(94633)),a=(r(45606),r(68254)),o=n(r(11339)),s=r(85156);const l=new Map},6954:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedUploadMutationsToSyncActions=function(e,t){return e.map((e=>({index:e.index,action:e.action,binarySyncAction:e.binarySyncAction,actionState:t,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp})))},t.setMutationToSyncAction=function(e,t,r,n,i){return{index:e.index,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp,action:r,actionState:t,modelId:n,modelType:null!=i?i:void 0}},t.syncActionsToDecryptedMutation=function(e){return e.map((e=>({collection:e.collection,index:e.index,action:e.action,indexMac:e.indexMac,keyId:e.keyId,operation:n.SyncdMutationSyncdOperation.SET,binarySyncAction:e.binarySyncAction,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version})))};var n=r(50073)},72466:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.validateAndTypeSetMutations=function(e,t){return t.map((t=>{let r;if(t.binarySyncData){const e=t.binarySyncData;r=(0,s.decodeProtobuf)(o.SyncActionDataSpec,e).value}else t.binarySyncAction&&(r=(0,s.decodeProtobuf)(o.SyncActionValueSpec,t.binarySyncAction));if(!r)throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VALUE,e),new u.SyncdFatalError("missing action value");const n=(0,i.maybeNumberOrThrowIfTooLarge)(r.timestamp);if(null==n)throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_TIMESTAMP,e),new u.SyncdFatalError("missing action timestamp");return{index:t.index,version:t.version,keyId:t.keyId,indexMac:t.indexMac,valueMac:t.valueMac,collection:t.collection,binarySyncAction:t.binarySyncAction,binarySyncData:t.binarySyncData,timestamp:n}}))},t.validateNoDuplicatePatchVersionInCollection=function(e,t){const r=new Set;t.forEach((t=>{const n=t.version.version;if(r.has(n))throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.DUPLICATE_PATCH_VERSION_IN_COLLECTION,e),new u.SyncdFatalError("duplicate patch version in collection");r.add(n)}))},t.validateNoSameIndexForMultipleMutations=function(e,t,r){const n=new Set,i=new Set;t.forEach((t=>{let o=!1;if(t.operation===a.SyncdMutationSyncdOperation.SET&&(n.has(t.index)?o=!0:n.add(t.index)),t.operation===a.SyncdMutationSyncdOperation.REMOVE&&(i.has(t.index)?o=!0:i.add(t.index)),o)switch(r){case l.SyncDataType.Patch:throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH,e),new u.SyncdFatalError("same index for multiple mutations in patch");case l.SyncDataType.Snapshot:throw(0,c.uploadFatalErrorMetric)(d.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT,e),new u.SyncdFatalError("same index for multiple mutations in snapshot")}}))};var i=r(8243),a=r(50073),o=r(381),s=r(84902),l=r(45606),c=r(68254),d=n(r(11339)),u=r(85156)},89453:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(8243),a=r(68254),o=n(r(11339)),s=r(85156);class l{static validateSnapshotProtobuf(e,t){const{version:r,records:n,mac:c,keyId:d}=t,u=null==r?void 0:r.version;if(!r||null==u)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_VERSION,e),new s.SyncdFatalError("missing snapshot version");const p=n.map((t=>l.validateRecordProtobuf(e,t)));if(!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_MAC,e),new s.SyncdFatalError("missing snapshot mac");const f=l.validateKeyIdProtobuf(e,d,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_KEY_ID);return{version:{version:(0,i.numberOrThrowIfTooLarge)(u)},records:p,mac:c,keyId:f}}static validatePatchProtobuf(e,t){const{version:r,mutations:n,externalMutations:c,snapshotMac:d,patchMac:u,keyId:p,exitCode:f,deviceIndex:_}=t,h=null==r?void 0:r.version;if(!r||null==h)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_VERSION,e),new s.SyncdFatalError("missing patch version");if(n&&n.length>0&&c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS,e),new s.SyncdFatalError("patch with both inline and external mutations");if(!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_SNAPSHOT_MAC,e),new s.SyncdFatalError("missing patch snapshot mac");if(!u)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_MAC,e),new s.SyncdFatalError("missing patch mac");const g=l.validateKeyIdProtobuf(e,p,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_KEY_ID);if(c){const t=l.validateExternalBlobReference(e,c);return{version:{version:(0,i.numberOrThrowIfTooLarge)(h)},mutations:void 0,externalMutations:t,snapshotMac:d,patchMac:u,keyId:g,deviceIndex:_}}const m=n.map((t=>l.validateMutationProtobuf(e,t)));return{version:{version:(0,i.numberOrThrowIfTooLarge)(h)},mutations:m,externalMutations:void 0,exitCode:f,snapshotMac:d,patchMac:u,keyId:g,deviceIndex:_}}static validateExternalBlobReference(e,t){const{mediaKey:r,directPath:n,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}=t;if(!r)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY,e),new s.SyncdFatalError("missing external blob reference media key");if(!n)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH,e),new s.SyncdFatalError("missing external blob reference direct path");if(!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256,e),new s.SyncdFatalError("missing external blob reference file SHA256");if(!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256,e),new s.SyncdFatalError("missing external blob reference file enc SHA256");return{mediaKey:r,directPath:n,handle:i,fileSizeBytes:l,fileSha256:c,fileEncSha256:d}}static validateMutationProtobuf(e,t){const{operation:r,record:n}=t;if(null==r)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_OPERATION,e),new s.SyncdFatalError("missing mutation operation");if(!n)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_RECORD,e),new s.SyncdFatalError("missing mutation record");return{operation:r,record:l.validateRecordProtobuf(e,n)}}static validateRecordProtobuf(e,t){const{index:r,value:n,keyId:i}=t,c=null==r?void 0:r.blob,d=null==n?void 0:n.blob;if(!r||!c)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_INDEX,e),new s.SyncdFatalError("missing mutation index");if(!n||!d)throw(0,a.uploadFatalErrorMetric)(o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_VALUE,e),new s.SyncdFatalError("missing mutation value");return{index:{blob:c},value:{blob:d},keyId:l.validateKeyIdProtobuf(e,i,o.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_KEY_ID)}}static validateKeyIdProtobuf(e,t,r){const n=null==t?void 0:t.id;if(!t||!n)throw(0,a.uploadFatalErrorMetric)(r,e),new s.SyncdFatalError("missing mutation key id");return{id:n}}}t.default=l},16088:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(68254),a=n(r(11339)),o=r(85156);t.default=class{static validateSyncActionDataProtobuf(e,t){const{index:r,value:n,padding:s,version:l}=t;if(!r)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_INDEX,e),new o.SyncdFatalError("missing action index");if(null==l)throw(0,i.uploadFatalErrorMetric)(a.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VERSION,e),new o.SyncdFatalError("missing action version");return{index:r,value:n,padding:s,version:l}}}},35377:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMetricsForMutations=function(e){(0,o.logCriticalBootstrapStageIfNecessary)(s.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MUTATIONS_DECRYPTED),e.forEach(l)};var i=r(381),a=r(84902),o=r(58597),s=n(r(11339));function l(e){let t;const{binarySyncAction:r}=e;if(null==r)return;const n=(0,a.decodeProtobuf)(i.SyncActionValueSpec,r);n.archiveChatAction?t=n.archiveChatAction.messageRange:n.markChatAsReadAction?t=n.markChatAsReadAction.messageRange:n.clearChatAction?t=n.clearChatAction.messageRange:n.deleteChatAction&&(t=n.deleteChatAction.messageRange),null!=t&&new s.default.MdAppStateMessageRange({additionalMessagesCount:t.messages.length}).commit()}},62274:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitBootstrapAppStateDownloadMetric=function(){return d.apply(this,arguments)};var i=n(r(48926)),a=r(8243),o=r(92844),s=r(45606),l=r(49801),c=n(r(11339));function d(){return(d=(0,i.default)((function*(e,t,r,n){const i=new c.default.MdBootstrapAppStateDataDownloaded({mdBootstrapPayloadType:[s.CollectionName.CriticalBlock,s.CollectionName.CriticalUnblockLow].includes(e)?c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdTimestamp:(0,o.unixTimeMs)(),mdBootstrapStepDuration:(0,o.unixTimeMs)()-t,mdBootstrapStepResult:n?c.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:c.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,mdSessionId:yield l.MdSyncFieldStatsMeta.getMdSessionId()}),d=yield l.MdSyncFieldStatsMeta.getStorageEstimation();d.mdStorageQuotaBytes!==l.STORAGE_QUOTA_UNAVAILABLE&&(i.mdStorageQuotaUsedBytes=d.mdStorageQuotaUsedBytes,i.mdStorageQuotaBytes=d.mdStorageQuotaBytes);try{const e=(0,a.maybeNumberOrThrowIfTooLarge)(r);null!=e&&(i.mdBootstrapPayloadSize=e)}catch(e){}i.commit()}))).apply(this,arguments)}},65582:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyRequest=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(63109),o=n(r(73407)),s=r(26442);function l(){return(l=(0,i.default)((function*(e,t){const r=e.keyIds;if(r){const e=r.map((e=>e.keyId)).filter(Boolean);if(__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}
\t for keyIds: [${e.map(a.arrayBufferToHex)}]`,e){const r=[],n=[];return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield o.default.getSyncKey(new Uint8Array(e));t?r.push(t):n.push(e)}));return function(){return e.apply(this,arguments)}}())),__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}: about to send key share
\t keys with keydata: [${r.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)))}]
\t keys without keydata: [${n.map((e=>(0,a.arrayBufferToHex)(e)))}]`,(0,s.sendAppStateSyncKeyShare)({type:"missing_key",keys:r,orphanKeys:n,peerDeviceId:t})}}}))).apply(this,arguments)}},82568:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyShare=function(){return _.apply(this,arguments)};var i=n(r(48926)),a=r(8243),o=r(63109),s=r(58597),l=n(r(73407)),c=r(68254),d=r(4573),u=n(r(11339)),p=r(93932),f=r(38804);function _(){return(_=(0,i.default)((function*(e,t){(0,s.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_RECEIVED);const r=t.getDeviceId();__LOG__(2)`syncd: handling key share from device ${r} with ${e.keys.length} keys`;const n=[],_=e.keys;if(!_)return Promise.resolve();yield Promise.all(_.map(function(){var e=(0,i.default)((function*(e){var t;const i=null===(t=e.keyId)||void 0===t?void 0:t.keyId,s=e.keyData,p=null==s?void 0:s.keyData;if(!i)return void __LOG__(2)`syncd: received key with missing keyID from device ${r}`;const f=(0,o.arrayBufferToHex)(i);if(__LOG__(2)`syncd: received key share key id ${f} from device ${r} ${null!=p?"with":"without"} keyData`,6!==i.byteLength)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_ID}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`,SEND_LOGS(`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`),(0,c.handleFatalError)();if(n.push({keyId:i,keyData:p}),s){var _,h,g;const e=s.timestamp,t=null===(_=s.fingerprint)||void 0===_?void 0:_.currentIndex,n=null===(h=s.fingerprint)||void 0===h?void 0:h.rawId,o=null===(g=s.fingerprint)||void 0===g?void 0:g.deviceIndexes;if(!p||null==e||null==t||null==n||!o)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_DATA}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: invalid key share key data`,SEND_LOGS("syncd: fatal error: invalid key share key data"),(0,c.handleFatalError)();const m=new Uint8Array(i);(yield l.default.getSyncKey(m))||(yield l.default.createSyncKey({keyId:m,keyEpoch:(0,d.getKeyEpoch)(i),keyData:p,timestamp:(0,a.numberOrThrowIfTooLarge)(e),fingerprint:{rawId:n,currentIndex:t,deviceIndexes:o}}),__LOG__(2)`syncd: stored key share key id ${f} from device ${r}`)}}));return function(){return e.apply(this,arguments)}}())),n.some((e=>null!=e.keyData))||__LOG__(2)`syncd: key share from device ${r} has no keys with keydata.`,yield(0,p.updateMissingKeys)(n,t),(0,f.syncBlockedCollections)()}))).apply(this,arguments)}},84051:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMissingKeysInPatches=function(){return _.apply(this,arguments)},t.handleMissingKeysInSnapshot=function(){return f.apply(this,arguments)},t.requestAllMissingKeys=function(){return E.apply(this,arguments)};var i=n(r(48926)),a=r(7589),o=r(63109),s=r(93932),l=(r(45606),n(r(73407))),c=r(4573),d=r(65031),u=r(85156);const p=new ArrayBuffer(0);function f(){return(f=(0,i.default)((function*(e,t){const r=new Set,n=(yield l.default.getAllSyncKeys()).map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)));t.records.forEach((e=>{const t=e.keyId.id;if((0,a.areBuffersEqual)(t,p))throw new u.SyncdFatalError("snapshot has empty key");const i=(0,o.arrayBufferToHex)(t);n.includes(i)||r.add(i)})),__LOG__(2)`syncd: collection ${e}'s snapshot has missing keys ${Array.from(r)}`,yield h(r)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const r=new Set,n=(yield l.default.getAllSyncKeys()).map((e=>(0,o.arrayBufferToHex)(e.keyId.buffer)));t.forEach((e=>{const t=e.keyId.id;if((0,a.areBuffersEqual)(t,p))throw new u.SyncdFatalError("syncd: patch has empty key. patch device id: ${p.deviceIndex}");const i=(0,o.arrayBufferToHex)(t);n.includes(i)||(__LOG__(2)`syncd: handleMissingKeysInPatches: missing key: keyId: ${i}, patch version: ${e.version.version}, patch device id: ${e.deviceIndex}`,r.add(i))})),__LOG__(2)`syncd: collection ${e}'s patches has missing keys ${Array.from(r)}`,yield h(r)}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if(!r(28237).OfflineMessageHandler.isResumeFromRestartComplete())return void __LOG__(2)`syncd: _handleMissingKeys: skipping due to resume from restart in progress`;const t=Array.from(e);__LOG__(2)`syncd: _handleMissingKeys: missing keys [${t}]`;const n=new Set((yield l.default.bulkGetMissingKeys(t)).filter(Boolean).map((e=>e.keyHex))),i=t.filter((e=>!n.has(e)));if(__LOG__(2)`syncd: _handleMissingKeys: missing keys after filter: [${i}]`,0===i.length)return Promise.resolve();const a=i.map((e=>(0,o.hexToUint8Array)(e).buffer)),c=yield m(a);yield(0,s.addMissingKeys)(a,c.map((e=>e.getDeviceId())))}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=yield(0,c.getPeerDevices)();return yield(0,d.sendAppStateSyncKeyRequest)(e,t),t}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){const e=yield l.default.getAllMissingKeys();__LOG__(2)`syncd: requestAllMissingKeys: missing keys: [${e.map((e=>e.keyHex))}]`,0!==e.length&&(yield m(e.map((e=>e.keyId))))}))).apply(this,arguments)}},837:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearSyncKeysCache=function(){m=new Map},t.getActiveKey=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return y.enqueue((()=>E(e)))},t.getKeyData=function(){return C.apply(this,arguments)},t.getNewestKeyPair=v;var i=n(r(48926)),a=n(r(22762)),o=n(r(63105)),s=n(r(6162)),l=r(15688),c=r(27870),d=r(63109),u=n(r(73407)),p=r(9108),f=r(4573),_=n(r(11339)),h=r(26442),g=r(13722);let m=new Map;const y=new c.PromiseQueue;function E(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=yield v(),r=yield(0,p.getMyDeviceList)();const{currentIndex:n,devices:i,rawId:a}=r;if(null==n)throw new Error("syncd: missing current index for own device");r={currentIndex:n,deviceIndexes:i.map((e=>e.keyIndex)),rawId:a};const o=(0,g.hasKeyExpired)(t),s=(0,g.hasADeviceBeenRemoved)(t,r);return e&&(o||s)?(t=(0,g.rotateKey)(t,r),__LOG__(2)`syncd: stored key rotation key id ${(0,d.arrayBufferToHex)(t.keyId.buffer)}`,yield u.default.createSyncKey(t),yield(0,h.sendAppStateSyncKeyShare)({type:"key_rotation",keys:[t]}),o&&(__LOG__(2)`syncd: key rotation due to key expiry`,new _.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:_.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.APP_STATE_SYNC_KEY_EXPIRY}).commit()),s&&(__LOG__(2)`syncd: key rotation due to device removal`,new _.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:_.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.DEVICE_DEREGISTERATION}).commit()),E(e)):{keyId:t.keyId.buffer,keyData:t.keyData}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield u.default.getAllSyncKeys(),t=(0,s.default)(e.map((e=>(0,f.getKeyEpoch)(e.keyId.buffer)))),r=(0,o.default)(e,(e=>(0,f.getKeyEpoch)(e.keyId.buffer)===t));return(0,a.default)(r,(e=>(0,f.getKeyDeviceId)(e.keyId.buffer)))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){var t;let r=m.get((0,l.encodeB64)(e));return r?r.keyData:(r=yield u.default.getSyncKeyData(new Uint8Array(e)),r&&m.set((0,l.encodeB64)(e),r),null===(t=r)||void 0===t?void 0:t.keyData)}))).apply(this,arguments)}},4573:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDeviceId=function(e){return new DataView(e).getUint16(0)},t.getKeyEpoch=function(e){return new DataView(e).getUint32(2)},t.getPeerDevices=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45454),o=r(9108),s=r(99234);function l(){return(l=(0,i.default)((function*(){const e=[],t=(0,s.assertGetMe)();try{const r=yield(0,o.getMyDeviceList)();r.devices.forEach((n=>{n.id!==t.getDeviceId()&&e.push((0,a.createDeviceWidFromUserAndDevice)(r.id,n.id))}))}catch(e){return __LOG__(3,void 0,void 0,!0)`syncd: getPeerDevices: error ${e}. Future key requests will only be sent to primary device.`,SEND_LOGS(e.toString()),[(0,a.createDeviceWidFromUserAndDevice)(t.user,0)]}return e}))).apply(this,arguments)}},65031:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyRequest=function(){return f.apply(this,arguments)};var i=n(r(48926)),a=r(63109),o=n(r(65212)),s=r(52407),l=r(58597),c=r(99234),d=n(r(11339)),u=r(17304),p=r(238);function f(){return(f=(0,i.default)((function*(e,t){const r={keyIds:e.map((e=>({keyId:e})))},n=t.map((e=>{const t=new o.default({fromMe:!0,remote:(0,c.assertGetMeUser)(),id:o.default.newId()});return new u.Msg({id:t,to:e,type:"protocol",subtype:"app_state_sync_key_request",appStateSyncKeyRequest:r})})),i=t.map((e=>e.getDeviceId())),f=e.map((e=>(0,a.arrayBufferToHex)(e)));__LOG__(2)`syncd: send key request key id ${f} to peer deviceIds ${i}`,yield(0,p.storePeerMessages)(n),yield Promise.all(n.map(s.encryptAndSendKeyMsg)),(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_REQUESTED)}))).apply(this,arguments)}},26442:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyShare=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(63109),o=n(r(65212)),s=r(52407),l=r(99234),c=r(4573),d=r(17304),u=r(238);function p(){return(p=(0,i.default)((function*(e){let t,r;if("key_rotation"===e.type?(t=f(e.keys),r=yield(0,c.getPeerDevices)()):"missing_key"===e.type&&(t=f(e.keys,e.orphanKeys),r=[e.peerDeviceId]),null==r)return Promise.resolve();const n=r,i=n.map((e=>{const r=new o.default({fromMe:!0,remote:(0,l.assertGetMeUser)(),id:o.default.newId()});return new d.Msg({id:r,to:e,type:"protocol",subtype:"app_state_sync_key_share",appStateSyncKeyShare:t})})),p=n.map((e=>e.getDeviceId())),_=e.keys.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)));__LOG__(2)`syncd: send key share key id ${_} to peer deviceIds ${p} due to ${e.type}`,yield(0,u.storePeerMessages)(i),yield Promise.all(i.map(s.encryptAndSendKeyMsg))}))).apply(this,arguments)}function f(e,t){let r=e.map((e=>({keyId:{keyId:e.keyId.buffer},keyData:{keyData:e.keyData,fingerprint:{rawId:e.fingerprint.rawId,currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes},timestamp:e.timestamp}})));if(t){const e=t.map((e=>({keyId:{keyId:e},keyData:void 0})));r=r.concat(e)}return{keys:r}}},93932:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMissingKeys=function(){return T.apply(this,arguments)},t.setMissingKeyTimeout=g,t.updateMissingKeyDevices=function(){return h.apply(this,arguments)},t.updateMissingKeys=function(e,t){const r=t.getDeviceId(),n=[],a=[];return e.forEach((e=>{const t=e.keyData,r=(0,o.arrayBufferToHex)(e.keyId);t?n.push(r):a.push(r)})),__LOG__(2)`syncd: updateMissingKeys from device ${r}
\tkeys with keyData: ${n}
\tkeys without keyData: ${a}`,(0,f.getStorage)().lock(["missing-keys"],function(){var e=(0,i.default)((function*(){if(n.length>0&&(yield l.default.bulkRemoveMissingKeys(n),yield g()),a.length>0){const e=(yield l.default.bulkGetMissingKeys(a)).filter(Boolean);e.forEach((e=>e.deviceResponses.set(r,!1))),__LOG__(2)`syncd: updateMissingKeys: begin updating missing keys from device ${r}
\tmissingKeys: [${a}]`,yield l.default.createOrUpdateMissingKeys(e),__LOG__(2)`syncd: updateMissingKeys: finish updating missing keys from device ${r}`,yield S()}}));return function(){return e.apply(this,arguments)}}())};var i=n(r(48926)),a=n(r(22762)),o=r(63109),s=r(92844),l=n(r(73407)),c=r(68254),d=r(4573),u=n(r(11339)),p=r(64551),f=r(99069);let _;function h(){return(h=(0,i.default)((function*(){const e=(yield(0,d.getPeerDevices)()).map((e=>e.getDeviceId()));return(0,f.getStorage)().lock(["missing-keys"],function(){var t=(0,i.default)((function*(){const t=yield l.default.getAllMissingKeys();if(0===t.length)return Promise.resolve();t.forEach((t=>{t.deviceResponses.forEach(((r,n)=>{e.includes(n)||t.deviceResponses.delete(n)}))})),yield l.default.createOrUpdateMissingKeys(t),yield S()}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){clearTimeout(_),_=null;const e=yield l.default.getAllMissingKeys();if(0===e.length)return;__LOG__(2)`syncd: _setMissingKeyTimeout: missing keys: ${e.map((e=>(0,o.arrayBufferToHex)(e.keyId)))}`;const t=(0,a.default)(e,(e=>e.timestamp)),r=p.ServerProps.syncdWaitForKeyTimeoutDays*s.DAY_MILLISECONDS-(-t.timestamp+(0,s.unixTimeMs)());__LOG__(2)`syncd: earliest missing key: ${(0,o.arrayBufferToHex)(t.keyId)}, timestamp=${t.timestamp}, timeoutMs=${r}`,_=setTimeout(y,r)}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){0!==(yield l.default.getAllMissingKeys()).length&&(new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: timeout while waiting for missing key`,SEND_LOGS("syncd fatal error: timeout while waiting for missing key"),(0,c.handleFatalError)())}))).apply(this,arguments)}function S(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=yield l.default.getAllMissingKeys();for(const t of e){let e=!0;for(const r of t.deviceResponses.values())if(null==r){e=!1;break}if(e)return new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_KEY_ON_ALL_CLIENTS}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: missing key on all clients`,SEND_LOGS("syncd: fatal error: missing key on all clients"),void(0,c.handleFatalError)()}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const r=()=>{const e=new Map;return t.forEach((t=>e.set(t,null))),e},n=e.map((e=>({keyHex:(0,o.arrayBufferToHex)(e),keyId:e,timestamp:(0,s.unixTimeMs)(),deviceResponses:r()})));yield l.default.createOrUpdateMissingKeys(n),yield g()}))).apply(this,arguments)}},13722:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.hasADeviceBeenRemoved=function(e,t){const r=e.fingerprint,{rawId:n,currentIndex:a,deviceIndexes:o}=t,s=new Set(r.deviceIndexes);for(let e=r.currentIndex+1;e<=a;e++)s.add(e);return r.rawId!==n||!(0,i.default)(s,new Set(o))},t.hasKeyExpired=function(e){const t=e.timestamp,r=Math.min(90,Math.max(1,d.ServerProps.syncdKeyMaxUseDays));return(0,o.unixTimeMs)()-t>r*o.DAY_MILLISECONDS},t.rotateKey=function(e,t){const{keyId:r,keyEpoch:n}=function(e){const t=(0,c.getKeyEpoch)(e.keyId.buffer)+1,r=(0,l.assertGetMe)().getDeviceId();return{keyId:new Uint8Array((0,a.concatArrayBuffers)((0,s.intToBytes)(2,r).buffer,(0,s.intToBytes)(4,t).buffer)),keyEpoch:t}}(e),i=self.crypto.getRandomValues(new Uint8Array(32)).buffer,d=function(e){const{currentIndex:t,deviceIndexes:r,rawId:n}=e;return{rawId:n,currentIndex:t,deviceIndexes:r}}(t),u=(0,o.unixTimeMs)();return{keyId:r,keyEpoch:n,keyData:i,fingerprint:d,timestamp:u}};var i=n(r(18446)),a=r(32428),o=r(92844),s=r(11365),l=r(99234),c=r(4573),d=r(64551)},28900:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t._generateMutationsToUpload=G,t.buildSyncIqNode=function(){return A.apply(this,arguments)};var i=n(r(48926)),a=n(r(89734)),o=r(15688),s=r(7589),l=r(50073),c=r(31914),d=r(1377),u=n(r(18309)),p=r(45606),f=n(r(73407)),_=r(81122),h=r(66622),g=r(99234),m=n(r(52991)),y=r(837),E=r(4573),S=r(84527),v=r(2622),T=r(64551),C=n(r(78375));function A(){return(A=(0,i.default)((function*(e){const{collectionNodes:t,collectionWithEncryptedMutations:r,localCollectionVersions:n,collectionsToSkip:i}=yield b(e);return{syncIqNode:(0,c.wap)("iq",{to:c.S_WHATSAPP_NET,xmlns:"w:sync:app:state",type:"set",id:(0,c.generateId)()},(0,c.wap)("sync",null,t)),collectionWithEncryptedMutations:r,localCollectionVersions:n,collectionsToSkip:i}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){__LOG__(2)`syncd: start _buildCollectionNodes`;const t=[],r=function(){var e=(0,i.default)((function*(e,r){const n=yield f.default.getCollectionVersion(e);let i,a;if(null!=r&&r.length>0)if(null==n)__LOG__(2)`syncd: skipping ${e} in sync iq patch because initial full sync
is incomplete`,t.push(e);else{const{patchNode:t,encryptedMutations:n}=yield M(e,r);i=t,a=n}return{collection:e,version:n,patchNode:i,encryptedMutations:a}}));return function(){return e.apply(this,arguments)}}(),n=new Map,a=new Map,o=[];e.forEach(((e,t)=>o.push(r(t,e))));const s=(yield Promise.all(o)).map((e=>{const{collection:t,version:r,patchNode:i,encryptedMutations:o}=e;return o&&a.set(t,o),n.set(t,r),(0,c.wap)("collection",{name:(0,c.CUSTOM_STRING)(t),version:(0,c.INT)(null!=r?r:p.DEFAULT_COLLECTION_VERSION),return_snapshot:void 0===r?"true":"false"},i)}));return __LOG__(2)`syncd: end _buildCollectionNodes`,{collectionNodes:s,collectionWithEncryptedMutations:a,localCollectionVersions:n,collectionsToSkip:t}}))).apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const r=yield(0,y.getActiveKey)(!I(t)),n=(yield G(e,t,r)).map((e=>(0,h.encryptMutation)(e,r))),a=yield Promise.all(n),o=a.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),s=yield(0,d.computeLtHash)(e,o),{snapshotMac:l,patchMac:u}=yield(0,d.computeOutgoingSnapshotAndPatchMacs)(e,s,a,r.keyData),p=a.map((e=>k(e.keyId,e.operation,e.indexMac,e.indexAndValueCipherText))),f=L(p),_=function(){var e=(0,i.default)((function*(){const e=yield(0,S.uploadExternalPatch)(f);return D(yield w(e,f),r.keyId,l,u)}));return function(){return e.apply(this,arguments)}}();let g;(0,S.exceedInlineMutationCount)(p)?g=yield _():(g=N(p,r.keyId,l,u),(0,S.exceedPatchProtobufSize)(g)&&(g=yield _()));return{patchNode:(0,c.wap)("patch",null,g),encryptedMutations:a}}))).apply(this,arguments)}function I(e){return m.default.isLogoutInProgress&&e.some((e=>JSON.parse(e.index)[0]===p.Actions.Sentinel))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t){const{mediaKey:r,directPath:n,encFilehash:i,handle:a}=e;if(!a)throw new Error("Missing handle after uploading external patch to mms4");const s=yield(0,u.default)(t);return{mediaKey:(0,o.decodeB64)(r),directPath:n,handle:a,fileSizeBytes:t.byteLength,fileSha256:(0,o.decodeB64)(s),fileEncSha256:(0,o.decodeB64)(i)}}))).apply(this,arguments)}function D(e,t,r,n){const i=T.ServerProps.syncdPatchDeviceIndexIncluded?(0,g.assertGetMe)().getDeviceId():void 0;return(0,_.encodeSyncdPatch)({keyId:{id:t},externalMutations:e,snapshotMac:r,patchMac:n,deviceIndex:i})}function N(e,t,r,n){const i=T.ServerProps.syncdPatchDeviceIndexIncluded?(0,g.assertGetMe)().getDeviceId():void 0;return(0,_.encodeSyncdPatch)({keyId:{id:t},mutations:e,snapshotMac:r,patchMac:n,deviceIndex:i})}function L(e){return(0,_.encodeSyncdMutations)({mutations:e})}function k(e,t,r,n){return{operation:t,record:{keyId:{id:e},index:{blob:r},value:{blob:n}}}}function G(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e,t,r){const n=yield f.default.getSyncActionsRows(["collection"],[e]);let i=t;const a=F(e,n,t,r.keyId);i=i.concat(a);const o=x(n,i,r.keyId);return C.default.addKeyRotationRemoveCount(o.length),i=i.concat(o),i}))).apply(this,arguments)}function F(e,t,r,n){let i=t.filter((e=>!r.map((e=>e.index)).includes(e.index)&&!(0,s.areBuffersEqual)(e.keyId,n)));i=(0,a.default)(i,(e=>(0,E.getKeyEpoch)(e.keyId)));const o=Math.min(5,Math.max(1,T.ServerProps.syncdAdditionalMutations));return i=i.slice(0,o),(0,v.syncActionsToPendingMutations)(i,l.SyncdMutationSyncdOperation.SET)}function x(e,t,r){const n=t.map((e=>e.index)),i=e.filter((e=>n.includes(e.index))).filter((e=>!(0,s.areBuffersEqual)(e.keyId,r)));return(0,v.syncActionsToPendingMutations)(i,l.SyncdMutationSyncdOperation.REMOVE)}},81122:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSyncActionData=function(e){try{return(0,o.encodeProtobuf)(a.SyncActionDataSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("action data protobuf serialization failed")}},t.encodeSyncdMutations=function(e){try{return(0,o.encodeProtobuf)(i.SyncdMutationsSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("mutations protobuf serialization failed")}},t.encodeSyncdPatch=function(e){try{return(0,o.encodeProtobuf)(i.SyncdPatchSpec,e).readBuffer()}catch(e){throw new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_SERIALIZATION_FAILED}).commit(),new l.SyncdFatalError("patch protobuf serialization failed")}};var i=r(50073),a=r(381),o=r(60980),s=n(r(11339)),l=r(85156)},66622:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMutation=function(){return y.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(76100),s=r(50073),l=r(381),c=r(62109),d=r(32458),u=r(63109),p=r(84902),f=n(r(73407)),_=r(81122),h=r(837),g=n(r(11339)),m=r(85156);function y(){return(y=(0,a.default)((function*(e,t){const{index:r,operation:n}=e;let a=t.keyId,o=t.keyData;switch(n){case s.SyncdMutationSyncdOperation.SET:break;case s.SyncdMutationSyncdOperation.REMOVE:const e=yield f.default.getSyncAction(r);if(!e)throw new m.SyncdFatalError("no corresponding set mutation");const t=e.keyId;a=t,o=yield(0,h.getKeyData)(t)}const{indexMac:l,indexAndValueCipherText:d}=yield E(e,a,o),u=(0,c.valueMacFromIndexAndValueCipherText)(d);return(0,i.default)((0,i.default)({},e),{},{keyId:a,keyData:o,indexMac:l,indexAndValueCipherText:d,valueMac:u})}))).apply(this,arguments)}function E(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,r){try{const{index:n,binarySyncAction:i,operation:a,version:s}=e,l=(0,o.stringToArrayBuffer)(n),p=yield(0,c.generateEncryptionKeys)(r),{indexKey:f,valueEncryptionKey:_,valueMacKey:h}=p,g=yield self.crypto.getRandomValues(new Uint8Array(d.IV_LENGTH)),m=v(l,i,(0,c.generatePadding)(l.byteLength,i.byteLength),s),y=yield(0,c.generateCipherText)(g,_,m),E=(0,c.generateAssociatedData)(a,t),S=yield(0,c.generateMac)(E,y,h),T=(0,u.combine)([y,S]);return{indexMac:yield(0,c.generateIndexMac)(f,l),indexAndValueCipherText:T}}catch(e){throw new g.default.MdFatalError({mdFatalErrorCode:g.default.MD_SYNCD_FATAL_ERROR_CODE.ENCRYPTION_FAILED}).commit(),new m.SyncdFatalError("encryption failure")}}))).apply(this,arguments)}function v(e,t,r,n){return(0,_.encodeSyncActionData)({index:e,value:(0,p.decodeProtobuf)(l.SyncActionValueSpec,t),padding:r,version:n})}},84527:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.exceedInlineMutationCount=function(e){const t=Math.min(2e3,Math.max(o.ServerProps.syncdInlineMutationsMaxCount,100));return e.length>t},t.exceedPatchProtobufSize=function(e){const t=1e3*Math.min(100,Math.max(o.ServerProps.syncdPatchProtobufMaxSize,10));return e.byteLength>t},t.uploadExternalPatch=function(e){return s.default.encryptAndUpload({blob:e,signal:(new n).signal,type:"md-app-state",uploadOrigin:a.default.UPLOAD_ORIGIN_TYPE.UNKNOWN,userUploadAttemptCount:0,forwardedFromWeb:!1,isViewOnce:!1})};var a=i(r(11339)),o=r(64551),s=i(r(54824))},34089:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(28900),o=n(r(73407)),s=r(83853);function l(){return(l=(0,i.default)((function*(e){const t=new Map,r=new Map;yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const n=yield o.default.getPendingMutationsRows(["collection"],e),i=n.map((e=>e.id)).filter(Boolean);r.set(e,i);const a=(0,s.compactPatch)(n);t.set(e,a)}));return function(){return e.apply(this,arguments)}}()));const n=yield(0,a.buildSyncIqNode)(t);return{syncIqNode:n.syncIqNode,collectionWithPendingMutationsIds:r,collectionWithEncryptedMutations:n.collectionWithEncryptedMutations,localCollectionVersions:n.localCollectionVersions,collectionsToSkip:n.collectionsToSkip}}))).apply(this,arguments)}},2622:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncActionsToPendingMutations=function(e,t){return e.map((e=>{let r=e.binarySyncAction;if(!r){const t=(0,i.decodeProtobuf)(n.SyncActionDataSpec,e.binarySyncData).value;r=(0,a.encodeProtobuf)(n.SyncActionValueSpec,t).readBuffer()}return{collection:e.collection,index:e.index,binarySyncAction:r,operation:t,version:e.version,timestamp:e.timestamp,action:e.action}}))};var n=r(381),i=r(84902),a=r(60980)},83853:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.compactPatch=function(e){return(0,i.default)(e.reverse(),(e=>e.index)).reverse()};var i=n(r(45578))},61107:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncResponseParser=void 0;var i=r(71914),a=r(45606),o=r(13815),s=n(r(11339)),l=r(85156);const c=new i.WapParser("syncResponseParser",(e=>{__LOG__(2)`syncd: start parsing syncd collections`;const t=[];return e.child("sync").mapChildrenWithTag("collection",(e=>{const r={},n=a.CollectionName.cast(e.attrString("name"));if(!n)throw new l.SyncdFatalError("invalid collection name");r.name=n,r.state=function(e,t){if(!e.hasAttr("type")||"error"!==e.attrString("type"))return e.hasAttr("has_more_patches")?(__LOG__(2)`syncd: collection ${t} got server code has_mode_patches`,a.CollectionState.SuccessHasMore):(__LOG__(2)`syncd: collection ${t} did not get server error`,a.CollectionState.Success);{const r=e.child("error"),n=r.attrString("code"),i=r.attrString("text");switch(__LOG__(2)`syncd: collection ${t} got server error: ${n}`,n){case"409":return e.hasAttr("has_more_patches")?a.CollectionState.ConflictHasMore:a.CollectionState.Conflict;case"400":return new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_FOR_COLLECTION}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;case"404":return new s.default.MdFatalError({mdFatalErrorCode:s.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_FOR_COLLECTION}).commit(),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;default:return __LOG__(3,void 0,void 0,!0)`syncd: retryable error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: retryable error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorRetry}}}(e,r.name),e.hasAttr("version")&&(r.version=parseInt(e.attrString("version"),10)),e.hasChild("patches")&&(r.patches=e.child("patches").mapChildrenWithTag("patch",(e=>(0,o.decodeSyncdPatch)(n,e.contentBytes())))),e.hasChild("snapshot")&&(r.snapshot=(0,o.decodeExternalBlobReference)(n,e.child("snapshot").contentBytes())),t.push(r),null==r.version&&null==r.patches&&null==r.snapshot&&__LOG__(2)`syncd: collection ${n} has no version, patches or snapshot`,__LOG__(2)`syncd: successfully parsed collection ${n}`})),t}));t.syncResponseParser=c},23026:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.serverSync=function(){return h.apply(this,arguments)};var i=n(r(48926)),a=r(29938),o=r(24747),s=r(45606),l=r(58597),c=n(r(73407)),d=n(r(11339)),u=n(r(34089)),p=r(61107),f=r(85156),_=n(r(78375));function h(){return(h=(0,i.default)((function*(e){let t=[],r=[...e],n=0;for(;(n<5||r.length>0&&n<500)&&0!==r.length;){const{doneCollections:e,refetchCollections:i}=yield g(r);r=i,t=t.concat(e),n++}return r.length>0&&(__LOG__(4,void 0,new Error,!0,["syncd"])`syncd: reached max iterations for collections: ${r}`,SEND_LOGS("syncd: max iteration"),t=t.concat(r.map((e=>({state:s.CollectionState.ErrorRetry,name:e}))))),t}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){if(0===e.length)return{doneCollections:[],refetchCollections:[]};try{const{collectionDetails:t,localCollectionVersions:r,collectionsToUpload:n}=yield y(e);n.length>0&&__LOG__(2)`syncd: deferred local mutation upload for ${n}`,__LOG__(2)`syncd: local collection versions:`,r.forEach(((e,t)=>{__LOG__(2)`\n\t${t} v${null!=e?e:"(undefined)}"}`}));const o=[],l=[];t.forEach((e=>{switch(e.state){case s.CollectionState.ErrorRetry:case s.CollectionState.ErrorFatal:case s.CollectionState.Blocked:return void l.push(e);default:o.push(e)}e.state!==s.CollectionState.Conflict&&e.state!==s.CollectionState.ConflictHasMore||_.default.incConflict()})),__LOG__(2)`syncd: start apply collections: ${o.map((e=>e.name))}`;const d=yield Promise.all(o.map((e=>(0,a.applyAppStateSyncResponse)(e,r.get(e.name)))));__LOG__(2)`syncd: end apply collections: ${o.map((e=>e.name))}`;const u=[];return yield Promise.all(d.map(function(){var e=(0,i.default)((function*(e){if(e.state===s.CollectionState.Conflict){(yield c.default.hasPendingMutationForCollection(e.name))?u.push(e.name):(e.state=s.CollectionState.Success,l.push(e))}else e.state===s.CollectionState.ConflictHasMore||e.state===s.CollectionState.SuccessHasMore||e.state===s.CollectionState.Success&&n.some((t=>t===e.name))?u.push(e.name):l.push(e)}));return function(){return e.apply(this,arguments)}}())),{doneCollections:l,refetchCollections:u}}catch(t){if(t instanceof f.SyncdFatalError){__LOG__(4,void 0,new Error,!0)`syncd: fatal error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: fatal error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:s.CollectionState.ErrorFatal,name:e}))),refetchCollections:[]}}__LOG__(3,void 0,void 0,!0)`syncd: retryable error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: retryable error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:s.CollectionState.ErrorRetry,name:e,serverBackoff:t.errorBackoff}))),refetchCollections:[]}}}))).apply(this,arguments)}function y(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){const{syncIqNode:t,collectionWithPendingMutationsIds:r,collectionWithEncryptedMutations:n,localCollectionVersions:i,collectionsToSkip:a}=yield(0,u.default)(e);(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.REQUEST_BUILT),__LOG__(2)`syncd: sending sync request for collections: ${e.map((e=>{var t,n,a;return`\n\t${e} v${null!==(t=i.get(e))&&void 0!==t?t:"(undefined)"} ${(null!==(n=null===(a=r.get(e))||void 0===a?void 0:a.length)&&void 0!==n?n:0)>0&&null!=i.get(e)?" with local changes":""}`}))}`;const s=yield(0,o.sendIq)(t,p.syncResponseParser);if(__LOG__(2)`syncd: completed network operation for collections: ${e}`,(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_RECEIVED),s.success){(0,l.logCriticalBootstrapStageIfNecessary)(d.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_PARSED_VALID);const e=s.result;return __LOG__(2)`syncd: received sync response for collections: ${e.map((e=>{let t=`\n${e.name}`;return null!=e.version&&(t+=`\n\tupdated to version ${e.version}`),null!=e.snapshot&&(t+="\n\tcontains snapshot"),null!=e.patches&&(t+=`\n\tcontains ${e.patches.length} patches`),t}))}`,e.forEach((e=>{const t=r.get(e.name);t&&(e.syncedPendingMutationsId=t);const i=n.get(e.name);i&&(e.syncedEncryptedMutations=i)})),{collectionDetails:e,localCollectionVersions:i,collectionsToUpload:a}}const{errorCode:c,errorText:f,errorBackoff:_}=s;throw S(c,f,_)}))).apply(this,arguments)}function S(e,t,r){switch(e){case 400:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);case 404:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);case 405:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_METHOD_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);case 406:return new d.default.MdFatalError({mdFatalErrorCode:d.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR}).commit(),new f.SyncdFatalError(t);default:return new f.SyncdRetryableError(t,r)}}},68254:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleFatalError=function(){return m.apply(this,arguments)},t.uploadFatalErrorMetric=function(){return y.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=(r(45606),r(88102)),s=r(86945),l=r(65044),c=n(r(11339)),d=r(83578),u=r(93824),p=r(13983),f=r(89751),_=r(92844),h=r(52613);const g=(0,_.unixTime)();function m(){return(m=(0,a.default)((function*(e){__LOG__(2)`syncd: starting fatal flow for ${e}`;const t=(0,s.getABPropConfigValue)("should_deregister_on_syncd_fatal"),n=r(48277).default;let i=[];null!=e&&(i=e.map((e=>String(e)))),yield(0,h.asyncSleep)(5e3),__LOG__(2)`syncd: start notifying primary on fatal error`,yield(0,p.sendAppStateFatalExceptionNotification)(i),__LOG__(2)`syncd: end notifying primary on fatal error`,!1!==t?(__LOG__(4,!0,new Error)`syncd: Received fatal error and logged out`,l.Socket.logout(!1,d.LogoutReason.SyncdFailure)):n.isSyncDCriticalDataSyncInProcess()?(__LOG__(4,!0,new Error,!0)`syncd: critical sync failed during bootstrap`,SEND_LOGS("syncd: critical sync failed during bootstrap"),l.Socket.logout(!1,d.LogoutReason.SyncdErrorDuringBootstrap)):(__LOG__(4,!0,new Error)`syncd: Received fatal error and showed fatal flag`,(0,f.updateSyncdDisabledDueToFatalFlag)(!0),o.Cmd.handleFatalError())}))).apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t,n,a){const o=r(48277).default;let l={mdFatalErrorCode:e,collection:t?(0,u.collectionNameToMetric)(t):void 0,isBootstrap:o.isSyncDCriticalDataSyncInProcess()};null==n&&null==a||(yield(0,s.getABPropConfigValue)("md_app_state_gate_D34336913"))&&(l=(0,i.default)((0,i.default)({},l),{},{timeSinceRefreshMs:1e3*((0,_.unixTime)()-g),patchSnapshotMutationCount:n,patchVersion:a})),new c.default.MdFatalError(l).commit(!0)}))).apply(this,arguments)}},13983:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateFatalExceptionNotification=function(){return p.apply(this,arguments)};var i=n(r(48926)),a=r(92844),o=n(r(65212)),s=r(45454),l=r(52407),c=r(99234),d=r(17304),u=r(238);function p(){return(p=(0,i.default)((function*(e){const t={collectionNames:e,timestamp:(0,a.unixTimeMs)()},r=new o.default({fromMe:!0,remote:(0,c.getMeUser)(),id:o.default.newId()}),n=new d.Msg({id:r,to:(0,s.createDeviceWidFromUserAndDevice)((0,c.assertGetMe)().user,0),type:"protocol",subtype:"app_state_fatal_exception_notification",appStateFatalExceptionNotification:t});return yield(0,u.storePeerMessages)([n]),(0,l.encryptAndSendKeyMsg)(n)}))).apply(this,arguments)}},12600:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllOrphansAndUnsupported=function(){return g.apply(this,arguments)},t.checkOrphanChats=p,t.checkOrphanMessages=d,t.checkOrphanMutations=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(29938),o=r(89751),s=r(45606),l=n(r(73407));function c(){return(c=(0,i.default)((function*(e,t){if((0,o.isSyncdDisabled)())return Promise.resolve();yield Promise.all([d(e),p(t)])}))).apply(this,arguments)}function d(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){yield _(e,s.SyncModelType.Msg)}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){yield _(e,s.SyncModelType.Chat)}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){if((0,o.isSyncdDisabled)())return Promise.resolve();const r=yield l.default.getSyncActionsRows(["modelId","modelType","actionState"],e.map((e=>[e,t,s.SyncActionState.Orphan])));yield(0,a.applyIndividualMutations)(r)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){if((0,o.isSyncdDisabled)())return Promise.resolve();__LOG__(2)`syncd: start applyAllOrphansAndUnsupported`;const e=yield l.default.getSyncActionsRows(["actionState"],[s.SyncActionState.Orphan,s.SyncActionState.Unsupported]);yield(0,a.applyIndividualMutations)(e),__LOG__(2)`syncd: end applyAllOrphansAndUnsupported`}))).apply(this,arguments)}},37933:(e,t,r)=>{"use strict";var n=r(95318);t.Z=function(){return c.apply(this,arguments)};var i=n(r(48926)),a=r(45606),o=n(r(73407)),s=n(r(40108)),l=r(38804);function c(){return(c=(0,i.default)((function*(){const e=yield s.default.getSentinelMutations();return yield o.default.appendPendingMutationsRows(e),(0,l.markCollectionsForSync)(Array.from(a.CollectionName.members()))}))).apply(this,arguments)}},38804:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.SYNCD_INTERNAL_TABLES_TO_LOCK=void 0,t.initialize=function(){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND))return(0,y.isSyncdDisabled)()?Promise.resolve():(function(){const e=6e4,t=(0,o.default)((0,a.default)((function*(){const e=yield(0,S.getSyncActionsTable)().count();v.default.setStoredMutationCount(e);const t=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Malformed);v.default.setInvalidActionCount(t.length);const r=yield(0,S.getSyncActionsTable)().equals(["actionState"],c.SyncActionState.Unsupported);v.default.setUnsupportedActionCount(r.length);const n=yield d.default.getMissingKeyCount();v.default.setMissingKeyCount(n)})),e,{maxWait:3*e});E.Cmd.on(E.APP_STATE_SYNC_COMPLETED,t)}(),G(),l.default.loadStatesFromDb().then((()=>K())));return Promise.reject(new Error("This call is only supported in MD mode"))},t.lockForSync=function(e,t,r){const n=(0,f.getStorage)().lock([...e,...A],(e=>Promise.all([d.default.appendPendingMutationsRows(t),r(e)]))).then((()=>{D(t.map((e=>e.collection)))}));return Promise.resolve(n)},t.markCollectionsForSync=D,t.sanitizeActionInSyncActionsRow=G,t.syncBlockedCollections=function(){const e=l.default.getCollectionsInStateBlocked();return __LOG__(2)`syncd: sync blocked collections: ${e}`,l.default.moveCollectionsToDirty(e),O=new Set([...Array.from(O),...Array.from(M)]),__LOG__(2)`syncd: syncBlockedCollections:
\tmoving blocked collections to dirty: [${e}]
\tadding inflight collections to pending: [${Array.from(M)}]`,F()};var i=n(r(81109)),a=n(r(48926)),o=n(r(23279)),s=r(7293),l=n(r(11681)),c=r(45606),d=n(r(73407)),u=n(r(11339)),p=r(23026),f=r(99069),_=n(r(17072)),h=r(41796),g=r(12600),m=r(68254),y=r(89751),E=r(88102),S=r(76214),v=n(r(78375)),T=r(58052),C=r(58597);const A=["pending-mutations"];t.SYNCD_INTERNAL_TABLES_TO_LOCK=A;const b=36e5;let P,M=new Set,O=new Set,I=!1,w=0,R=0;if((0,h.isConnectedToPage)()){const e=r(8080).Stream,t=r(8080).StreamMode;(0,_.default)(e,"change:mode",(()=>e.mode===t.MAIN)).then((()=>{s.GK.supportsFeature(s.GK.F.MD_BACKEND)&&!(0,y.isSyncdDisabled)()&&((0,g.applyAllOrphansAndUnsupported)(),__LOG__(2)`syncd: syncing pending mutations and blocked collections due to app resume`,function(){Y.apply(this,arguments)}())}))}function D(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t){if(s.GK.supportsFeature(s.GK.F.MD_BACKEND)){const r=null!=t?yield L(e,t):e;return __LOG__(2)`syncd: marking for sync: ${r}`,r.forEach((e=>{const t=l.default.getCollectionState(e);__LOG__(2)`syncd: ${e} state before sync: ${t}`,t===c.CollectionSyncState.UpToDate?l.default.moveCollectionsToDirty([e]):t===c.CollectionSyncState.Dirty&&(O=new Set([...Array.from(O),e]))})),yield l.default.persistToDb(),F()}return Promise.reject(new Error("This call is only supported in MD mode"))}))).apply(this,arguments)}function L(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t){__LOG__(2)`syncd: start filter collections: ${e}`;const r=yield d.default.getCollectionVersions(e);return e.filter((e=>{const n=r.get(e);if(null==n)return __LOG__(2)`syncd: local version for ${e} missing; will mark for sync.`,!0;const i=t.get(e);return null==i?(__LOG__(2)`syncd: server version for ${e} missing; will mark for sync.`,!0):n<i?(__LOG__(2)`syncd: local version (${n}) for ${e} less than server version (${i}); will mark for sync.`,!0):(__LOG__(2)`syncd: local version (${n})for ${e} >= server version (${i}); will not mark for sync.`,!1)}))}))).apply(this,arguments)}function G(){return U.apply(this,arguments)}function U(){return(U=(0,a.default)((function*(){if(!(0,T.getMdSyncActionsActionSanitized)()){__LOG__(2)`syncd: sanitizing null 'action' property in sync-actions table`;const e=(yield(0,S.getSyncActionsTable)().all()).filter((e=>null==e.action)).map((e=>{const t=JSON.parse(e.index)[0];return c.Actions.cast(t)?(0,i.default)((0,i.default)({},e),{},{action:t}):(__LOG__(2)`syncd: invalid action ${t}`,(0,i.default)({},e))}));yield d.default.updateSyncActionRows(e),(0,T.setMdSyncActionsActionSanitized)(!0)}}))).apply(this,arguments)}function F(){return x.apply(this,arguments)}function x(){return(x=(0,a.default)((function*(){if((0,y.isSyncdDisabled)())return Promise.resolve();const e=l.default.getCollectionsInStateDirty();__LOG__(2)`syncd: dirty collections: ${e}`;const t=new Set(e.filter((e=>!M.has(e))));if(0===t.size)return __LOG__(2)`syncd: no collections to sync`,Promise.resolve();let r=[];try{M=new Set([...Array.from(M),...Array.from(t)]),__LOG__(2)`syncd: initiate server sync`,r=yield(0,p.serverSync)(Array.from(t)),__LOG__(2)`syncd: server sync successful`;const e=r.filter((e=>e.state===c.CollectionState.ErrorRetry));e.length>0&&(R=e[0].serverBackoff||0,w=0),j(r)}catch(e){l.default.moveCollectionsToFiniteRetry(Array.from(t))}finally{l.default.persistToDb(),M=new Set(Array.from(M).filter((e=>!t.has(e)))),K(),E.Cmd.trigger(E.APP_STATE_SYNC_COMPLETED,r)}}))).apply(this,arguments)}function B(){if((0,y.isSyncdDisabled)())return;const e=new Set(l.default.getCollectionsInStateRetry());var t,r;0!==e.size&&(P=setTimeout((0,a.default)((function*(){try{I=!0,w+=1,__LOG__(2)`syncd: initiate server sync retry`;const t=yield(0,p.serverSync)(Array.from(e));__LOG__(2)`syncd: server sync retry successful`,j(t)}catch(t){l.default.moveCollectionsToFiniteRetry(Array.from(e))}finally{!function(){const e=l.default.getExpiredCollections();e.length>0&&(l.default.moveCollectionsToFatal(e),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: expired collections`,SEND_LOGS("syncd: fatal error: expired collections"),new u.default.MdFatalError({mdFatalErrorCode:u.default.MD_SYNCD_FATAL_ERROR_CODE.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D}).commit())}(),l.default.persistToDb(),I=!1,K()}})),(t=w,r=R,Math.min(Math.max(2**t*1e3,r),b))))}function K(){if(__LOG__(2)`syncd: state machine tick`,l.default.getCollectionsInStateDirty().length>0&&(O=new Set(Array.from(O).filter((e=>M.has(e)))),F()),l.default.getCollectionsInStateRetry().length>0){if(I)return void __LOG__(2)`syncd: retry is in flight`;null!=P&&clearTimeout(P),B()}l.default.getCollectionsInStateFatal().length>0&&(0,m.handleFatalError)(l.default.getCollectionsInStateFatal())}function j(e){return e.forEach((e=>e.state!==c.CollectionState.Success||O.has(e.name)?e.state===c.CollectionState.ErrorRetry?((0,C.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ENTERED_RETRY_MODE),l.default.moveCollectionsToFiniteRetry([e.name])):e.state===c.CollectionState.ErrorFatal?l.default.moveCollectionsToFatal([e.name]):e.state!==c.CollectionState.Blocked||O.has(e.name)?void 0:l.default.moveCollectionsToBlocked([e.name]):l.default.moveCollectionsToUpToDate([e.name])))}function Y(){return(Y=(0,a.default)((function*(){__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections`;const e=yield d.default.getAllPendingMutationsRows(),t=l.default.getCollectionsInStateBlocked();l.default.moveCollectionsToDirty(t);const r=e.map((e=>e.collection)).concat(t);r.length>0&&(__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections: [${r}]`,D(r))}))).apply(this,arguments)}},89751:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.isSyncdDisabled=function(){return"true"===(0,i.default)(a.default,"localStorage").getItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL)},t.updateSyncdDisabledDueToFatalFlag=function(e){(0,i.default)(a.default,"localStorage").setItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL,e.toString())};var i=n(r(45095)),a=n(r(92417)),o=r(72407)},85156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionCheckError=t.SyncdRetryableError=t.SyncdMissingKeyError=t.SyncdFatalError=void 0;class r extends Error{constructor(){super(...arguments),this.name="SyncdMissingKeyError"}}t.SyncdMissingKeyError=r;class n extends Error{constructor(e,t){super(e),this.name="SyncdRetryableError",this.backoff=t,this.message=e}}t.SyncdRetryableError=n;class i extends Error{constructor(e){super(e),this.name="SyncdFatalError",this.message=e}}t.SyncdFatalError=i;class a extends Error{constructor(){super(...arguments),this.name="SyncdVersionCheckError"}}t.SyncdVersionCheckError=a},93824:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.collectionNameToMetric=function(e){switch(e){case s.CollectionName.CriticalBlock:return l.default.COLLECTION.CRITICAL_BLOCK;case s.CollectionName.CriticalUnblockLow:return l.default.COLLECTION.CRITICAL_UNBLOCK_LOW;case s.CollectionName.Regular:return l.default.COLLECTION.REGULAR;case s.CollectionName.RegularHigh:return l.default.COLLECTION.REGULAR_HIGH;case s.CollectionName.RegularLow:return l.default.COLLECTION.REGULAR_LOW}},t.constructMsgKeySegments=d,t.constructMuteChatKey=function(e){return JSON.stringify([s.Actions.Mute,e.id.remote.toString({legacy:!0})])},t.constructPinChatKey=function(e){return JSON.stringify([s.Actions.Pin,e.id.remote.toString({legacy:!0})])},t.constructStarMsgKey=function(e){return JSON.stringify([s.Actions.Star,...d(e)])},t.constructStarMsgKeyFromMsgKey=function(e){return JSON.stringify([s.Actions.Star,...u(e)])},t.extractParticipantForSync=p,t.getMsgKeyFromStarActionIndex=function(e){const t=JSON.parse(e);if(t.length<5)throw new Error("[sync-action] Star action index malformed, cannot create MsgKey");return new a.default({remote:(0,o.createWid)(t[1]),id:t[2],fromMe:"1"===t[3],participant:"0"===t[4]?void 0:(0,o.createWid)(t[4])})},t.isBootstrap=function(e){return null==e},t.isCriticalCollection=function(e){switch(e){case s.CollectionName.CriticalBlock:case s.CollectionName.CriticalUnblockLow:return!0;case s.CollectionName.Regular:case s.CollectionName.RegularHigh:case s.CollectionName.RegularLow:return!1}},t.logKeysInfoInIntern=function(){return f.apply(this,arguments)},t.uploadCriticalEventMetric=function(e){new l.default.MdCriticalEvent({mdCriticalEventCode:e}).commit()};var i=n(r(48926)),a=(r(63109),n(r(65212))),o=r(45454),s=r(45606),l=n(r(11339)),c=r(76214);function d(e){return u(e.id)}function u(e){const t=p(e);return[e.remote.toString({legacy:!0}),e.id,e.fromMe?"1":"0",t]}function p(e){let t="0";return!e.participant||e.remote.isUser()||e.fromMe||(t=e.participant.toString({legacy:!0})),t}function f(){return(f=(0,i.default)((function*(){(yield(0,c.getSyncKeysTable)().all()).forEach((()=>{}))}))).apply(this,arguments)}},35047:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToBucket=function(e){if(e<0)throw new Error("cannot convert negative number to a bucket");return 0===e?o.default.MUTATION_COUNT_BUCKET.ZERO:1===e?o.default.MUTATION_COUNT_BUCKET.ONE:e<10?o.default.MUTATION_COUNT_BUCKET.LT10:e<100?o.default.MUTATION_COUNT_BUCKET.LT100:e<500?o.default.MUTATION_COUNT_BUCKET.LT500:e<1e3?o.default.MUTATION_COUNT_BUCKET.LT1K:e<5e3?o.default.MUTATION_COUNT_BUCKET.LT5K:o.default.MUTATION_COUNT_BUCKET.GTE5K},t.generateActionStatCounts=function(){return l.apply(this,arguments)};var i=n(r(48926)),a=r(45606),o=n(r(11339)),s=r(34296);function l(){return(l=(0,i.default)((function*(){const e=new Map;return(yield(0,s.getTable)().all()).map((t=>{var r;const n=JSON.parse(t.index)[0],i=null!==(r=e.get(n))&&void 0!==r?r:{action:n,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(t.actionState){case a.SyncActionState.Success:case a.SyncActionState.Skipped:i.applied++;break;case a.SyncActionState.Malformed:i.invalid++;break;case a.SyncActionState.Orphan:i.orphan++;break;case a.SyncActionState.Unsupported:i.unsupported++;break;case a.SyncActionState.Failed:i.failed++}e.set(n,i)})),e}))).apply(this,arguments)}},78375:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(57319),a=r(88102),o=n(r(11339));let s=new o.default.MdAppStateSyncDaily;const l=new i.ShiftTimer((function(){const e=function(e){const t=new o.default.MdAppStateSyncDaily;e.mutationCount>0&&(t.mutationCount=e.mutationCount);e.invalidActionCount>0&&(t.invalidActionCount=e.invalidActionCount);e.unsupportedActionCount>0&&(t.unsupportedActionCount=e.unsupportedActionCount);e.keyRotationRemoveCount>0&&(t.keyRotationRemoveCount=e.keyRotationRemoveCount);e.storedMutationCount>0&&(t.storedMutationCount=e.storedMutationCount);e.uploadConflictCount>0&&(t.uploadConflictCount=e.uploadConflictCount);e.unsetActionCount>0&&(t.unsetActionCount=e.unsetActionCount);e.missingKeyCount>0&&(t.missingKeyCount=e.missingKeyCount);return t}(s);c(),e.commit()}));function c(){s=new o.default.MdAppStateSyncDaily}function d(){l.onOrBefore(3e5)}a.Cmd.on("logout",(()=>{l.isScheduled()&&l.forceRunNow()}));var u={clear:c,addMutationCount:function(e){0!==e&&(void 0===s.mutationCount&&(s.mutationCount=0),s.mutationCount+=e,d())},setInvalidActionCount:function(e){s.invalidActionCount=e,d()},setUnsupportedActionCount:function(e){s.unsupportedActionCount=e,d()},incConflict:function(){void 0===s.uploadConflictCount&&(s.uploadConflictCount=0),s.uploadConflictCount++,d()},addKeyRotationRemoveCount:function(e){0!==e&&(void 0===s.keyRotationRemoveCount&&(s.keyRotationRemoveCount=0),s.keyRotationRemoveCount+=e,d())},setStoredMutationCount:function(e){s.storedMutationCount=e,d()},addUnsetActionCount:function(e){0!==e&&(void 0===s.unsetActionCount&&(s.unsetActionCount=0),s.unsetActionCount+=e,d())},setMissingKeyCount:function(e){s.missingKeyCount=e,d()}};t.default=u},49332:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyStats=function(){return S.apply(this,arguments)};var i=n(r(81109)),a=n(r(48926)),o=r(66423),s=n(r(96222)),l=r(99234),c=r(28307),d=r(57701),u=r(55975),p=r(14111),f=r(10435),_=n(r(11339)),h=r(76214),g=r(72472),m=r(28826),y=r(75861),E=r(7595);function S(){return(S=(0,a.default)((function*(){const e=v(),t=yield T(),r=yield P(),n=O(),a=(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e),t),r),n),s=new _.default.Daily;s.set(a),s.commit(),(0,E.logDailyPrivateStatsTestEvents)();const l=o.DailyAggregatedStatsCollection.toArray().filter((e=>e.shouldBeSubmitted()));o.DailyAggregatedStatsCollection.remove(l),l.forEach((e=>{new _.default.PttDaily({eventTime:e.getEndTime(),pttCancelBroadcast:e.pttCancelBroadcast,pttCancelGroup:e.pttCancelGroup,pttCancelIndividual:e.pttCancelIndividual,pttDraftReviewBroadcast:e.pttDraftReviewBroadcast,pttDraftReviewGroup:e.pttDraftReviewGroup,pttDraftReviewIndividual:e.pttDraftReviewIndividual,pttFastplaybackBroadcast:e.pttFastplaybackBroadcast,pttFastplaybackGroup:e.pttFastplaybackGroup,pttFastplaybackIndividual:e.pttFastplaybackIndividual,pttLockBroadcast:e.pttLockBroadcast,pttLockGroup:e.pttLockGroup,pttLockIndividual:e.pttLockIndividual,pttOutOfChatBroadcast:e.pttOutOfChatBroadcast,pttOutOfChatGroup:e.pttOutOfChatGroup,pttOutOfChatIndividual:e.pttOutOfChatIndividual,pttPlaybackBroadcast:e.pttPlaybackBroadcast,pttPlaybackGroup:e.pttPlaybackGroup,pttPlaybackIndividual:e.pttPlaybackIndividual,pttRecordBroadcast:e.pttRecordBroadcast,pttRecordGroup:e.pttRecordGroup,pttRecordIndividual:e.pttRecordIndividual,pttSendBroadcast:e.pttSendBroadcast,pttSendGroup:e.pttSendGroup,pttSendIndividual:e.pttSendIndividual,pttPausedRecordBroadcast:e.pttPausedRecordBroadcast,pttPausedRecordGroup:e.pttPausedRecordGroup,pttPausedRecordIndividual:e.pttPausedRecordIndividual,pttStopTapBroadcast:e.pttStopTapBroadcast,pttStopTapGroup:e.pttStopTapGroup,pttStopTapIndividual:e.pttStopTapIndividual}).commit()}))}))).apply(this,arguments)}function v(){const e=p.deviceInfo.get();return{languageCode:e.lg,locationCode:e.lc,osBuildNumber:e.osBuild,simMcc:parseInt(e.mcc,10),simMnc:parseInt(e.mnc,10)}}function T(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(){const e=(0,l.getUserPrivacySettings)(),t={receiptsEnabled:"none"!==e.readReceipts};if((0,d.privacySettingsEnabled)()){var r,n,i,a;const o=yield(0,y.queryDisallowedLists)();t.privacySettingsAbout=A(e.about),t.privacySettingsAboutExceptNum="contact_blacklist"===e.about?b(null===(r=o.status)||void 0===r?void 0:r.disallowedList.length):null,t.privacySettingsGroups=A(e.groupAdd),t.privacySettingsGroupsExceptNum="contact_blacklist"===e.groupAdd?b(null===(n=o.groupadd)||void 0===n?void 0:n.disallowedList.length):null,t.privacySettingsLastSeen=A(e.lastSeen),t.privacySettingsLastSeenExceptNum="contact_blacklist"===e.lastSeen?b(null===(i=o.last)||void 0===i?void 0:i.disallowedList.length):null,t.privacySettingsProfilePhoto=A(e.profilePicture),t.privacySettingsProfilePhotoExceptNum="contact_blacklist"===e.profilePicture?b(null===(a=o.profile)||void 0===a?void 0:a.disallowedList.length):null}if((0,f.isDisappearingModeEnabled)()){var o;const e=(0,l.getMaybeMeUser)(),r=(0,c.getDisappearingModeSettingForUser)(e);t.defaultDisappearingDuration=null!==(o=null==r?void 0:r.duration)&&void 0!==o?o:0}return t}))).apply(this,arguments)}function A(e){if(null==e)return null;switch(e){case"all":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return _.default.PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function b(e){return null==e?null:0===e?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0:e<5?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1:e<10?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5:e<15?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10:e<20?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15:e<30?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20:e<40?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30:e<50?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40:e<60?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50:e<70?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60:e<80?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70:e<90?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80:e<100?_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:_.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function P(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(){const e=yield(0,h.getContactTable)().equals(["isAddressBookContact"],1).then((e=>e.length)),t=yield(0,s.default)(),r=yield u.LruMediaStore.count(),n=yield Promise.all([t,e,r]);let i=0,a=0;const o=n[0];return null!=o&&(i=o.available,a=o.quota),{addressbookWhatsappSize:I(n[1],10),storageAvailSize:I(i,100),storageTotalSize:I(a,100),mediaFolderFileCount:n[2]}}))).apply(this,arguments)}function O(){let e=_.default.NOTIFICATION_SETTING_TYPE.UNKNOWN;return null!=window.Notification&&(e=window.Notification.permission===m.PERMISSION_ALLOWED&&g.MuteCollection.getGlobalNotifications()?_.default.NOTIFICATION_SETTING_TYPE.ALLOWED:_.default.NOTIFICATION_SETTING_TYPE.BLOCKED),{osNotificationSetting:e}}function I(e,t){return Math.round(e/t)*t}},42862:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.registerTasks=function(){_.GK.supportsFeature(_.GK.F.MD_BACKEND)&&((0,a.startScheduler)({scheduledTimeResolver:{get:e=>(0,T.getTaskScheduledTime)(String(e)),set:(e,t)=>(0,T.updateTaskScheduledTime)(String(e),t)}}),A.filter((e=>e!==C.LOG_DB_ROW_COUNTS||!1)).forEach((e=>{const t=function(e){switch(e){case C.MONITOR_DB_STORAGE:return function(){var e=(0,i.default)((function*(){return a.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case C.CLEAN_TC_TOKENS:return function(){var e=(0,i.default)((function*(e){if(e)__LOG__(2)`CleanTcToken skip first run`;else try{yield(0,u.pruneExpiredTcTokens)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired TcTokens with error: ${e}`}return o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.LOG_DAILY_STATS:return()=>(0,f.logDailyStats)().catch((e=>{__LOG__(4,!0,new Error)`Failed to log daily stats: ${e}`})).then((()=>o.DAY_SECONDS));case C.LOG_DB_ROW_COUNTS:break;case C.ROTATE_KEY:return function(){var e=(0,i.default)((function*(e){return e?__LOG__(2)`RotateKeyTask skip first run`:yield(0,h.getJobManager)().waitUntilCompleted(m.jobSerializers.rotateKey()),27*o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.SYNC_AB_PROPS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,c.syncABPropsTask)()),(0,l.getRefresh)()}));return function(){return e.apply(this,arguments)}}();case C.SYNC_CONTACTS:return function(){var e=(0,i.default)((function*(e){if(!e){try{yield(0,g.getNonAddressBookContactsAndMarkAllContactsDirty)()}catch(e){__LOG__(4,!0,new Error)`Failed to sync non-address book contacts with error: ${e}`}try{yield(0,p.contactSync)()}catch(e){__LOG__(4,!0,new Error,!0)`contact sync failed`,SEND_LOGS("contact sync failed: "+e)}}return(0,S.getContactSyncRefreshSeconds)()}));return function(){return e.apply(this,arguments)}}();case C.REPORT_SYNCD_ACTION_STAT:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,y.reportSyncdStatsJob)()),o.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.LT_HASH_CHECK:return function(){var e=(0,i.default)((function*(e){const t=(0,s.getABPropConfigValue)("lthash_check_hours");return 0===t?24*o.HOUR_SECONDS:(e||(yield(0,d.checkLtHash)()),t*o.HOUR_SECONDS)}));return function(){return e.apply(this,arguments)}}();case C.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,E.requestAllSyncdMissingKeysJob)()),6*o.HOUR_SECONDS}));return function(){return e.apply(this,arguments)}}();case C.SYNCD_SYNC_ALL_COLLECTIONS:return function(){var e=(0,i.default)((function*(e){const t=(0,s.getABPropConfigValue)("syncd_periodic_sync_days");return 0===t?(__LOG__(2)`syncd: syncdPeriodicSyncDays is 0, skipping sync`,o.DAY_SECONDS):(e||(yield(0,v.syncdSyncAllCollectionsJob)()),o.DAY_SECONDS*t)}));return function(){return e.apply(this,arguments)}}()}}(e);null!=t&&(0,a.registerTask)(e,t)})))};var i=n(r(48926)),a=r(2821),o=r(92844),s=r(86945),l=r(64971),c=r(89981),d=r(1377),u=r(48285),p=r(9995),f=r(49332),_=r(7293),h=r(68819),g=r(24872),m=r(6684),y=r(66101),E=r(4454),S=r(66837),v=r(5474),T=r(60998);const C=r(76672)({CLEAN_TC_TOKENS:"cleanTcTokens",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys",SYNCD_SYNC_ALL_COLLECTIONS:"syncdSyncAllCollections"}),A=[C.CLEAN_TC_TOKENS,C.LOG_DAILY_STATS,C.LOG_DB_ROW_COUNTS,C.ROTATE_KEY,C.SYNC_AB_PROPS,C.SYNC_CONTACTS,C.MONITOR_DB_STORAGE,C.REPORT_SYNCD_ACTION_STAT,C.LT_HASH_CHECK,C.REQUEST_ALL_SYNCD_MISSING_KEYS,C.SYNCD_SYNC_ALL_COLLECTIONS]},47473:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByCountry=function(e){var t;return!!(0,i.countryGatingEnabled)()&&((null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===a.HostStorageEnumType.Facebook&&!(0,n.getFbBrandedNumber)(e.id.user))};var n=r(32990),i=r(57701),a=r(49714)},70768:(e,t,r)=>{"use strict";var n=r(59182).default,i=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.TosManager=t.TOS_3_ID=void 0;var a=i(r(48926)),o=r(13959),s=i(r(34342)),l=r(91903),c=r(99234),d=r(57701),u=r(72407),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=h(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}n.default=e,r&&r.set(e,n);return n}(r(53055)),f=r(99684),_=r(77591);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(h=function(e){return e?r:t})(e)}const g="20210210";t.TOS_3_ID=g;const m={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:(new n).signal};class y extends s.default{constructor(){super(...arguments),this._noticeIds=[g],this._refreshInterval=864e5}getState(e){const t=this._getStoreKey(e);return p._getUser(t)||"UNKNOWN"}setState(e,t){if((0,d.tosFetchEnabled)()){new Set(this._noticeIds).has(e)?(p._setUser(this._getStoreKey(e),t),this.trigger("change")):__LOG__(3)`ToS state manager unrecognized user notice id: ${e}`}}run(){var e=this;return(0,a.default)((function*(){if((0,d.tosFetchEnabled)()){try{yield(0,l.exponentialBackoff)(m,((t,r)=>e._query().catch((e=>{if(e instanceof _.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`ToS state manager query failed, retriable error: ${e.errorMessage}, failCount ${r}`,t(e)}throw e}))))}catch(e){if(__LOG__(4,!0,new Error,!0)`ToS state manager state pull failed, error: ${e}`,SEND_LOGS("ToS state manager run failed"),!(e instanceof _.ServerStatusCodeError&&500===e.statusCode))return}if(e._getNoticeIdsToRun().length>0){const t=(0,c.getMaybeMeUser)();yield(0,o.delayMs)(e._refreshInterval),(0,c.getMaybeMeUser)()===t&&e.run()}}}))()}_query(){var e=this;return(0,a.default)((function*(){if(!(0,c.getMaybeMeUser)())return;const t=e._getNoticeIdsToRun();if(t.length>0){const r=yield(0,f.queryTosState)(t);e._refreshInterval=1e3*r.refresh;const n=new Set(e._noticeIds);let i=!1;r.notice.filter((e=>n.has(e.id))).forEach((t=>{const r=t.state?"ACCEPTED":"NOT_ACCEPTED",n=e._getStoreKey(t.id);p._getUser(n)!==r&&(p._setUser(n,r),i=!0)})),p._setUser(u.KEYS.TOS_STATE_FETCH_ITERATION,(0,d.tosFetchIteration)()),i&&e.trigger("change")}}))()}_getNoticeIdsToRun(){const e=parseInt(p._getUser(u.KEYS.TOS_STATE_FETCH_ITERATION),10)||0;if((0,d.tosFetchIteration)()>e)return this._noticeIds;const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((e,r)=>"ACCEPTED"!==t[r]))}_getStoreKey(e){switch(e){case g:return u.KEYS.TOS_3}throw new Error("Unknown user notice id: "+e)}maybeUpdateServer(e){var t=this;return(0,a.default)((function*(){if((0,d.tosFetchEnabled)())try{const r=new Set(e);yield(0,l.exponentialBackoff)(m,((e,n)=>{const i=t._getAcceptedNoticeIds(r);return i.length>0?(0,f.updateTosState)(i).catch((t=>{if(t instanceof _.ServerStatusCodeError&&500===t.statusCode)return __LOG__(3)`ToS state manager server session state update failed, retriable error: ${t.errorMessage}, failCount ${n}`,e(t);throw t})):Promise.resolve()}))}catch(e){__LOG__(4,!0,new Error,!0)`ToS state manager server session state update failed, error: ${e}`,SEND_LOGS("ToS state manager server session state update failed")}}))()}_getAcceptedNoticeIds(e){if((0,c.getMaybeMeUser)()){const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((r,n)=>"ACCEPTED"===t[n]&&e.has(r)))}return[]}resetTosState(){}}const E=new y;t.TosManager=E},37894:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByTos=l,t.shouldBlockByTosB2C=function(e,t){if((0,a.tos3GatingEnabledB2C)()&&l(e)&&t)return t.type!==n.MSG_TYPE.DEBUG&&t.type!==n.MSG_TYPE.E2E_NOTIFICATION&&t.type!==n.MSG_TYPE.NOTIFICATION_TEMPLATE&&!t.isSentByMe;return!1};var n=r(15461),i=r(32990),a=r(57701),o=r(49714),s=r(70768);function l(e){var t;if((0,a.tos3GatingEnabled)()&&("NOT_ACCEPTED"===s.TosManager.getState(s.TOS_3_ID)&&(null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===o.HostStorageEnumType.Facebook&&!(0,i.getFbBrandedNumber)(e.id.user)))return!0;return!1}},66577:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncBusinessProtocol=void 0,t.businessParser=function(e){e.assertTag("business");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.maybeChild("verified_name");return{verifiedName:r?(0,a.default)(r):null}};var i=r(31914),a=n(r(27874));t.USyncBusinessProtocol=class{getQueryElement(){return(0,i.wap)("business",null,(0,i.wap)("verified_name",null))}getUserElement(){return null}}},93967:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncContactProtocol=void 0,t.contactParser=function(e){e.assertTag("contact");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{type:e.attrString("type")}};var n=r(31914);t.USyncContactProtocol=class{getQueryElement(){return(0,n.wap)("contact",null)}getUserElement(e){const t=e.getPhone();return t?(0,n.wap)("contact",null,t):null}}},81051:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDeviceProtocol=void 0,t.deviceParser=function(e){e.assertTag("devices");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.maybeChild("key-index-list"),n=e.maybeChild("device-list"),i=null==r?null:{ts:r.attrTime("ts"),signedKeyIndexBytes:r.hasContent()?r.contentBytes():null,expectedTs:r.hasAttr("expected_ts")?r.attrTime("expected_ts"):void 0};return{deviceList:null==n?void 0:n.mapChildrenWithTag("device",(e=>({id:e.attrInt("id"),keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null}))),keyIndex:i}};var n=r(31914),i=r(86945);t.USyncDeviceProtocol=class{getQueryElement(){return(0,n.wap)("devices",{version:(0,n.CUSTOM_STRING)(String(2))})}getUserElement(e){const t=e.getDeviceHash(),r=e.getTs(),a=e.getExpectedTs();return t||null!=r||null!=a?(0,n.wap)("devices",{device_hash:t?(0,n.CUSTOM_STRING)(t):n.DROP_ATTR,ts:null!=r?(0,n.INT)(r):n.DROP_ATTR,expected_ts:(0,i.getABPropConfigValue)("adv_v2_m4_m5")&&null!=a?(0,n.INT)(a):n.DROP_ATTR}):null}}},3776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDisappearingModeProtocol=void 0,t.disappearingModeParser=function(e){e.assertTag("disappearing_mode");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r=e.attrInt("duration",0),n=e.attrInt("t");return{duration:r,t:n}};var n=r(31914);t.USyncDisappearingModeProtocol=class{getQueryElement(){return(0,n.wap)("disappearing_mode",null)}getUserElement(){return null}}},35564:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncFeaturesProtocol=void 0,t.featureParser=function(e){e.assertTag("feature");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const r={};return Object.keys(i).forEach((t=>{const n=e.maybeChild(t);n&&(r[t]=n.attrString("value"))})),r};var n=r(31914);const i={document:(0,n.wap)("document",null),encrypt:(0,n.wap)("encrypt",null),encrypt_blist:(0,n.wap)("encrypt_blist",null),encrypt_contact:(0,n.wap)("encrypt_contact",null),encrypt_group_gen2:(0,n.wap)("encrypt_group_gen2",null),encrypt_image:(0,n.wap)("encrypt_image",null),encrypt_location:(0,n.wap)("encrypt_location",null),encrypt_url:(0,n.wap)("encrypt_url",null),encrypt_v2:(0,n.wap)("encrypt_v2",null),voip:(0,n.wap)("voip",null),multi_agent:(0,n.wap)("multi_agent",null)};t.USyncFeaturesProtocol=class{constructor(e){if(this.queries=e,0===e.length)throw new Error("must specify at least one query")}getQueryElement(){return(0,n.wap)("feature",null,this.queries&&this.queries.map((e=>i[e])))}getUserElement(){return null}}},52284:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncQuery=t.USYNC_SUPPORT_TYPE=void 0;var i=n(r(48926)),a=r(31914),o=r(71914),s=r(81663),l=n(r(89867)),c=r(66577),d=r(24747),u=r(93967),p=r(81051),f=r(3776),_=r(35564),h=r(60226),g=r(85880),m=r(39410);const y={FEATURE:"feature",DEVICE:"devices",CONTACT:"contact",PICTURE:"picture",STATUS:"status",BUSINESS:"business",DISAPPEARING_MODE:"disappearing_mode"};t.USYNC_SUPPORT_TYPE=y;const E={feature:_.featureParser,devices:p.deviceParser,contact:u.contactParser,picture:h.pictureParser,status:g.statusParser,business:c.businessParser,disappearing_mode:f.disappearingModeParser};function S(e){const t=[];return e.forEachChildWithTag("user",(e=>{const r={};e.hasAttr("jid")&&(Object.keys(y).forEach((t=>{const n=y[t],i=e.maybeChild(n);i&&E[n]&&(r[n]=E[n](i))})),r.id=(0,s.deviceJidToUserWid)(e.attrPhoneDeviceJid("jid")),t.push(r))})),t}const v=new o.WapParser("usyncParser",(e=>{e.assertAttr("type","result");const t={error:{},refresh:{},list:[],sideList:[]},r=e.child("usync"),n=r.child("result"),i=r.child("list"),a=r.maybeChild("side_list");return Object.keys(y).forEach((e=>{const r=y[e],i=n.maybeChild(r);if(i){const e=i.maybeChild("error");e?t.error[r]={errorCode:e.attrInt("code"),errorText:e.attrString("text"),errorBackoff:e.attrInt("backoff")}:i.hasAttr("refresh")&&(t.refresh[r]=i.attrInt("refresh",0))}})),t.list=S(i),a&&(t.sideList=S(a)),__LOG__(2)`usync query success!`,t}));t.USyncQuery=class{constructor(){this.context="interactive",this.mode="query",this.protocols=[],this.users=[]}withMode(e){return this.mode=e,this}withContext(e){return this.context=e,this}withContactProtocol(){return this.protocols.push(new u.USyncContactProtocol),this}withBusinessProtocol(){return this.protocols.push(new c.USyncBusinessProtocol),this}withDeviceProtocol(){return this.protocols.push(new p.USyncDeviceProtocol),this}withDisappearingModeProtocol(){return this.protocols.push(new f.USyncDisappearingModeProtocol),this}withPictureProtocol(){return this.protocols.push(new h.USyncPictureProtocol),this}withStatusProtocol(){return this.protocols.push(new g.USyncStatusProtocol),this}withFeaturesProtocol(e){return this.protocols.push(new _.USyncFeaturesProtocol(e)),this}withUser(e){return this.users.push(e),this}_buildStanza(){if(0===this.protocols.length)throw new Error("a usync query must have at least one protocol");const e=this.users.filter((e=>{const t=e.getId();return(!t||!l.default.isServer(t))&&e.validate()}));0===e.length&&__LOG__(3)`Usync warning: a usync query must have at least one user`;const t=(0,a.wap)("query",null,this.protocols.map((e=>e.getQueryElement()))),r=e.map((e=>{const t=e.getId();return(0,a.wap)("user",{jid:t?(0,m.USER_JID)(t):a.DROP_ATTR},this.protocols.map((t=>t.getUserElement(e))))})),n=(0,a.wap)("list",null,r);return(0,a.wap)("iq",{to:a.S_WHATSAPP_NET,xmlns:"usync",type:"get",id:(0,a.generateId)()},(0,a.wap)("usync",{sid:(0,a.generateId)(),index:"0",last:"true",mode:(0,a.CUSTOM_STRING)(this.mode),context:(0,a.CUSTOM_STRING)(this.context)},t,n))}execute(){var e=this;return(0,i.default)((function*(){const t=e._buildStanza(),r=yield(0,d.sendIq)(t,v);return r.success?r.result:{error:{all:{errorCode:r.errorCode,errorText:r.errorText,errorType:r.errorType}},refresh:{},list:[]}}))()}}},60226:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncPictureProtocol=void 0,t.pictureParser=function(e){e.assertTag("picture");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{id:e.attrInt("id")}};var n=r(31914);t.USyncPictureProtocol=class{getQueryElement(){return(0,n.wap)("picture",null)}getUserElement(){return null}}},85880:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncStatusProtocol=void 0,t.statusParser=function(e){e.assertTag("status");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};if(!e.hasContent())return e.hasAttr("code")&&401===e.attrInt("code")?null:i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString();return 0!==e.contentString().length?e.contentString():i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString()};var n=r(31914),i=r(48360);t.USyncStatusProtocol=class{getQueryElement(){return(0,n.wap)("status",null)}getUserElement(){return null}}},79942:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncUser=void 0;var n=r(47685);t.USyncUser=class{withId(e){return this._id=e,this}withDeviceHash(e){return this._deviceHash=e,this}withTs(e){return this._ts=e,this}withExpectedTs(e){return this._expectedTs=e,this}withPhone(e){return this._phone=e,this}getDeviceHash(){return this._deviceHash}getPhone(){return this._phone}getId(){return this._id}getTs(){return this._ts}getExpectedTs(){return this._expectedTs}validate(){const{_id:e,_phone:t}=this;if(null==e&&null==t)throw new Error("user must have an id or a phone");if(e){const t=(0,n.validateWid)(e.toString());return t||__LOG__(3)`USync user created with invalid jid: ${e.toString()}`,t}return!0}}},36129:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(8584);class i{static tag(e){return null==e?void 0:e[0]}static attr(e,t){return(null==t?void 0:t[1])?t[1][e]:void 0}static attrs(e){return e[1]}static child(e,t){const r=t[2];if(Array.isArray(r)){const t=r.length;for(let n=0;n<t;n++){const t=r[n];if(Array.isArray(t)&&t[0]===e)return t}}}static firstChild(e){const t=e[2];if(Array.isArray(t))return t[0]}static children(e,t){if(!t)return null==e?void 0:e[2];const r=e[2];return Array.isArray(r)?r.filter((e=>e[0]===t)):void 0}static dataStr(e){if(!e)return"";const t=e[2];return"string"==typeof t?t:t instanceof ArrayBuffer?new n.Binary(t).readString(t.byteLength):""}static toString(e,t){if(!e)return"undefined";const r=function(e,t){if(e){let r="";for(const n in e){r+=" "+n+"="+("string"==typeof e[n]?t?"...":'"'+e[n]+'"':e[n])}return r}return""}(e[1],t),n=function(e,t){if(e instanceof ArrayBuffer)return"<<bin:"+e.byteLength+">>";if("string"==typeof e)return t?"<<string:"+e.length+">>":e;if(Array.isArray(e))return e.map((e=>i.toString(e,t))).join("\n");return""}(e[2],t);return"<"+e[0]+r+(n?">\n"+n+"\n</"+e[0]+">":"/>")}}t.default=i},41090:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(21224),i={voipIndividualOutgoing:n.WebFeaturesFlag.FORCE_UPGRADE,groupsV3:n.WebFeaturesFlag.FORCE_UPGRADE,groupsV3Create:n.WebFeaturesFlag.DEVELOPMENT,changeNumberV2:n.WebFeaturesFlag.FORCE_UPGRADE,queryStatusV3Thumbnail:n.WebFeaturesFlag.DEVELOPMENT,liveLocations:n.WebFeaturesFlag.FORCE_UPGRADE,queryVname:n.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualIncoming:n.WebFeaturesFlag.FORCE_UPGRADE,quickRepliesQuery:n.WebFeaturesFlag.FORCE_UPGRADE,payments:n.WebFeaturesFlag.FORCE_UPGRADE,labelsDisplay:n.WebFeaturesFlag.FORCE_UPGRADE,labelsEdit:n.WebFeaturesFlag.FORCE_UPGRADE,stickerPackQuery:n.WebFeaturesFlag.FORCE_UPGRADE,liveLocationsFinal:n.WebFeaturesFlag.FORCE_UPGRADE,mediaUpload:n.WebFeaturesFlag.FORCE_UPGRADE,vnameV2:n.WebFeaturesFlag.FORCE_UPGRADE,videoPlaybackUrl:n.WebFeaturesFlag.FORCE_UPGRADE,statusRanking:n.WebFeaturesFlag.FORCE_UPGRADE,voipIndividualVideo:n.WebFeaturesFlag.DEVELOPMENT,thirdPartyStickers:n.WebFeaturesFlag.FORCE_UPGRADE,frequentlyForwardedSetting:n.WebFeaturesFlag.FORCE_UPGRADE,recentStickers:n.WebFeaturesFlag.FORCE_UPGRADE,recentStickersV2:n.WebFeaturesFlag.PRODUCTION,recentStickersV3:n.WebFeaturesFlag.PRODUCTION,groupsV4JoinPermission:n.WebFeaturesFlag.FORCE_UPGRADE,catalog:n.WebFeaturesFlag.FORCE_UPGRADE,starredStickers:n.WebFeaturesFlag.PRODUCTION,templateMessage:n.WebFeaturesFlag.PRODUCTION,templateMessageInteractivity:n.WebFeaturesFlag.DEVELOPMENT,ephemeralMessages:n.WebFeaturesFlag.PRODUCTION,e2ENotificationSync:n.WebFeaturesFlag.FORCE_UPGRADE,syncdRelease1:n.WebFeaturesFlag.PRODUCTION,userNotice:n.WebFeaturesFlag.PRODUCTION,syncdRelease11:n.WebFeaturesFlag.PRODUCTION,support:n.WebFeaturesFlag.PRODUCTION,groupUiiCleanup:n.WebFeaturesFlag.FORCE_UPGRADE,groupDogfoodingInternalOnly:n.WebFeaturesFlag.DEVELOPMENT,settingsSync:n.WebFeaturesFlag.PRODUCTION,ephemeral24HDuration:n.WebFeaturesFlag.DEVELOPMENT,archiveV2:n.WebFeaturesFlag.PRODUCTION,mdForceUpgrade:n.WebFeaturesFlag.FORCE_UPGRADE,disappearingMode:n.WebFeaturesFlag.PRODUCTION,externalMdOptInAvailable:n.WebFeaturesFlag.PRODUCTION,noDeleteMessageTimeLimit:n.WebFeaturesFlag.DEVELOPMENT};t.default=i},80208:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.settingsSync=t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=t.DISAPPEARING_MODE_SETTINGS_KEY=t.ARCHIVE_SETTINGS_KEY=void 0;var i=n(r(41609));const a="archive";t.ARCHIVE_SETTINGS_KEY=a;const o="disappearing_mode";t.DISAPPEARING_MODE_SETTINGS_KEY=o;const s="md_opt_in_deadline";t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=s;const l={querySettings:function(e){return new Promise(((t,r)=>{const n=this.queryNode({type:"settings"},void 0),a=e?"query,settings,resume":"query,settings";this.binSend("sendEphemeral",n,r,{onSend:this.binWrap((e=>{this.BinaryProtocol.read(e).then((e=>{const r={settings:[],status:parseInt(this.N.attr("code",e),10)||200};if(__LOG__(2)`bin-recv: response,settings`,"response"===this.N.tag(e)&&"settings"===this.N.attr("type",e)){const t=this.N.children(e);if(Array.isArray(t))for(let e=0;e<t.length;e++){const n=this.parseSetting(t[e]);(0,i.default)(n)||r.settings.push(n)}}t(r)})).catch(r)}),t),onDrop:this.wrap(r),serverCacheable:Boolean(e)},{debugString:a,metricName:"QUERY_SETTINGS"})}))},setArchiveSetting:function(e){return new Promise(((t,r)=>{const n=this.actionNode("set",[["archive_v2",{classic:e.toString()},void 0]]);this.binSend("send",n,r,{clientCacheable:!0,onSend:this.wrap(t),onDrop:this.wrap(r)},{debugString:"action,settings,archive",metrics:"SET_ARCHIVE_SETTING",ackRequest:!0})}))},parseSetting:function(e){switch(this.N.tag(e)){case"archive_v2":return{type:a,value:{classic:"true"===this.N.attr("classic",e),enabled:this.N.attr("enabled",e)&&"true"===this.N.attr("enabled",e)}};case"disappearing_mode":return{type:o,value:{duration:parseInt(this.N.attr("duration",e),10),settingTimestamp:parseInt(this.N.attr("t",e),10)}};case"md_opt_in_deadline":return{type:s,value:{timestamp:parseInt(this.N.attr("t",e),10)}};default:return}}};t.settingsSync=l},56891:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.instance}});var i=r(86875);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},78144:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.default.isWid,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.createWid,o=t;switch(e){case"author":case"broadcast":case"chat":case"descOwner":case"from":case"gid":case"id":case"jid":case"owner":case"participant":case"quotedRemoteJid":case"quotedParticipant":case"remote":case"subjectOwner":case"s_o":case"to":case"wid":case"changeNumberNewJid":case"changeNumberOldJid":case"recipient":case"paymentMessageReceiverJid":case"parentGroup":case"revokeSender":r(t)&&(o=n(t));break;default:const i=parseInt(e,10);!isNaN(i)&&r(t)&&(o=n(t))}return o};var i=n(r(89867)),a=r(45454)},77113:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.loadProtoVersions=function(){return s.apply(this,arguments)},t.protoMap=void 0;var i=n(r(48926)),a=r(46582);const o={};function s(){return(s=(0,i.default)((function*(){const e=yield(0,a.requireLoadProtoVersions)();Object.assign(o,e)}))).apply(this,arguments)}t.protoMap=o},7353:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(11865)),a=r(8584);const o={NEW:"REQUEST_STATE_NEW",SENT:"REQUEST_STATE_SENT",WEBDACKED:"REQUEST_STATE_WEBDACKED",WILL_RETRY:"REQUEST_STATE_WILL_RETRY"};class s{constructor(e){this.state=o.NEW,this.age=0,this.resends=0;const t=e.data;this.data=t,this.isToPhone=t instanceof ArrayBuffer,this.tag=e.tag,this.clientCacheable=!!e.clientCacheable,this.serverCacheable=!!e.serverCacheable,this.retryOn5xx=!!e.retryOn5xx,this.onSend=e.onSend,this.logOnSend=e.logOnSend,this.onDrop=e.onDrop,this.binaryOpts=e.binaryOpts,this.on5xx=e.on5xx,this.resendGuard=e.resendGuard,this.onTag=e.onTag,this.tagToCancel=e.tagToCancel,this.ephemeral=!!e.ephemeral,this.ignore=!!e.ignore,this.isCallOffer=!!e.isCallOffer,this.isWap4Bridge=!!e.isWap4Bridge}getTag(){return this.tag||(this.onSend?this.onSend.tag:void 0)}getName(){var e;return(null===(e=this.binaryOpts)||void 0===e?void 0:e.metricName)?this.binaryOpts.metricName.toLowerCase():`${this.data[0]}_${(0,i.default)(this.data[1])}`}toString(){const e=this.data;return this.binaryOpts?this.binaryOpts.debugString:Array.isArray(e)?0===e.length?"[]":1===e.length?`[${e[0]}]`:"query"===e[0]||"action"===e[0]?`[${e[0]}, ${e[1]}${e.length>2?", ...":""}]`:`Invalid request: ${e[0]}`:e instanceof Object?"{...}":`${String(e)}`}serialize(){const e=this.tag;if(this.binaryOpts){const t=this.binaryOpts,r=null!=t.metric?t.metric:0,n=(this.ignore?0:1)<<7|(!this.ignore&&t.ackRequest?1:0)<<6|(!0===t.available?1:0)<<5|(!1===t.available?1:0)<<4|(null!=t.expires&&0!==t.expires?1:0)<<3|(t.skipOffline?1:0)<<2;return a.Binary.build(e,",",r,n,this.data).readBuffer()}const t="string"==typeof this.data?this.data:JSON.stringify(this.data);return`${String(e)},,${String(t)}`}}t.default=s,s.STATE=o},66934:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.VoipSignaling=void 0,t.base64DecodeRecursively=function e(t){const r=t[2];Array.isArray(r)&&r.forEach((t=>{t&&(t[2]instanceof ArrayBuffer||"string"==typeof t[2]?t[2]=(0,a.decodeB64ToJsArray)(t[2]):t[2]&&e(t))}))};var i=n(r(78718)),a=r(15688),o=r(84902),s=r(60980),l=r(19380),c=r(24808),d=r(99234),u=n(r(36129)),p=r(45473),f=r(43067);const _={formatCallOffer:function(e,t,r){const n=r.payload,i={to:r.common.peer_jid,id:t,from:(0,d.getMaybeMeUser)().toString({legacy:!0})};let a,o;const l=n[2];l.forEach(((e,t)=>{switch(e[0]){case"enc":const i={call:{callKey:new Uint8Array(e[2])}},l={},d=n[1].retry_count;d&&(l.count=d);const u=["call",l,(0,f.cdataArrayBuffer)((0,s.encodeProtobuf)(c.MessageSpec,i))];a=u,o=t;break;default:(0,f.arrayToB64Recursively)(r.payload,!0)}})),l.splice(o,1),l.push(a),n[2]=l;return e.actionNode("relay",[["call",i,[n]]])},parseCallSignalingMsg:function(e){try{const t=l.ContactCollection.get(e.from),r={peer_jid:e.from.toString({legacy:!0}),isContact:null==t?void 0:t.isMyContact},n=["wrapper",{},e.data];switch(e.type){case"offer":{const t=h("offer",n);r.peer_platform=e.platform,e.version&&e.version.length&&(r.peer_version=e.version.join(".")),this.parseCallOffer(t,r,!1);break}case"accept":{const t=h("accept",n);r.type=p.TYPE.ACCEPT,r.call_id=u.default.attr("call-id",t)||"",r.peer_platform=e.platform,e.version&&e.version.length&&(r.peer_version=e.version.join("."));break}case"receipt":const t=e.data;switch(r.call_id=u.default.attr("call-id",t)||"",u.default.tag(t)){case"offer":r.type=p.TYPE.OFFER_RECEIPT;break;case"accept":r.type=p.TYPE.ACCEPT_RECEIPT;break;case"reject":default:return}break;case"terminate":const i=h("terminate",n);r.call_id=u.default.attr("call-id",i)||"",r.type=p.TYPE.TERMINATE;break;default:const a=function(e){const t=u.default.firstChild(e);if(!t)throw new Error("voip_signaling:Failed to get first child node");return t}(n);r.call_id=u.default.attr("call-id",a)}return(null==r?void 0:r.call_id)&&this.createCommonHeader(r),r}catch(e){return void __LOG__(3)`Error parsing voip signaling message`}},parseCallOffer:function(e,t,r){if(t.type=p.TYPE.OFFER,t.call_id=u.default.attr("call-id",e)||"",r){const r=h("call",e),i=u.default.children(r);if(i instanceof ArrayBuffer){var n;const e=(0,o.decodeProtobuf)(c.MessageSpec,i);(null===(n=e.call)||void 0===n?void 0:n.callKey)?this.receiveCallOfferKey(e.call.callKey,t):__LOG__(3)`voip_signaling:invalid messageProto.call`}else __LOG__(3)`voip_signaling:invalid serializedMessage`}else t.enc=this.parseRawE2EMaterial(e);const i=u.default.children(e,"video");t.video_count=Array.isArray(i)?i.length:void 0,t.isVideoCall=!!t.video_count,t.isGroupCall_DEPRECATED=!!t.group_info;const a=u.default.attr("t",e);a&&(t.t=a)},parseRawE2EMaterial:function(e){const t=u.default.child("enc",e);if(t)return(0,a.decodeB64ToJsArray)(u.default.dataStr(t));__LOG__(3)`voip_signaling:enc node not present`},receiveCallOfferKey:function(e,t){t&&(t[2]=Array.prototype.slice.call(new Uint8Array(e)))},createCommonHeader(e){e.common=(0,i.default)(e,["type","call_id","peer_jid"])}};function h(e,t){const r=u.default.child(e,t);if(!r)throw new Error(`voip_signaling:Failed to get child node ${e}`);return r}t.VoipSignaling=_},43067:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayToB64Recursively=o,t.cdataArrayBuffer=s,t.cdataB64=l,t.formatCallSignalingMsg=function(e,t){var r;const n=t.common.peer_jid;o(t.payload,!1);const i=t.payload;return["call",{from:null===(r=(0,a.getMaybeMeUser)())||void 0===r?void 0:r.toString({legacy:!0}),to:n,id:e},[i]]};var n=r(15688),i=r(8584),a=r(99234);function o(e,t){const r=e[2];Array.isArray(r)&&r.forEach((e=>{e&&(e[2]instanceof Array&&!(e[2][0]instanceof Array)?e[2]=t?s(new Uint8Array(e[2])):l(new Uint8Array(e[2])):e[2]&&o(e,t))}))}function s(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:e instanceof i.Binary?e.readBuffer():void 0}function l(e){return e instanceof Uint8Array||e instanceof ArrayBuffer?(0,n.encodeB64)(e):e instanceof i.Binary?(0,n.encodeB64)(e.readBuffer()):void 0}},86875:(e,t,r)=>{"use strict";var n=r(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.instance=void 0;var i=n(r(81109)),a=n(r(48926)),o=r(15688),s=r(81484),l=r(81576),c=r(11141),d=r(87614),u=n(r(45095)),p=r(20461),f=r(31914),_=n(r(89867)),h=r(45454),g=r(84902),m=r(72549),y=r(9978),E=k(r(5087)),S=r(24808),v=k(r(64103)),T=n(r(41090)),C=r(7293),A=r(90667),b=r(6822),P=r(77113),M=n(r(84644)),O=k(r(17117)),I=r(31515),w=r(43067),R=r(21224),D=r(77591),N=r(65044);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(L=function(e){return e?r:t})(e)}function k(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=L(t);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}let G,U;function F(e){return function(){if(!G)return Promise.reject(new v.ProtoVersionUndefined(`wap:${e}:not connected to phone yet`));const t=G[e];return t?t.apply(G,arguments):Promise.reject(new Error(`wap:${e}:unsupported`))}}const x=F("sendPresenceUpdate"),B=F("sendChatstateUpdate");const K=new class{constructor(){this.setSharedSecret=(0,p.promiseWrapSync)(function(){var e=(0,a.default)((function*(e){__LOG__(2)`Wap:saveSharedSecret start`;const t=(0,u.default)((0,o.decodeB64ToJsArray)(e),"decodeB64ToJsArray(payload)"),r=t.slice(0,32),n=t.slice(64),i=O.get().keyPair,a=(0,u.default)(i,"keyPair").privKey,d=yield E.sharedSecret(r,a).then((e=>(0,l.extractAndExpand)(e,"",80))),p=new Uint8Array(d,0,32),f=new Uint8Array(d,32,32),_=new Uint8Array(d,64,16),h=new Uint8Array(r.concat(n)),g=yield(0,c.hmacSha256)(f,h),m=(0,o.encodeB64)(g),y=(0,o.encodeB64)(t.slice(32,64));if(y!==m)return void __LOG__(3)`Wap:saveSharedSecret hmac mismatch ${y} ${m}`;const S=yield(0,s.aesCbcDecrypt)(p,_,new Uint8Array(n)),v=new Uint8Array(S,0,32),T=new Uint8Array(S,32,32);O.setSecretKeys("0.1",v,T),__LOG__(2)`Wap:saveSharedSecret done`}));return function(){return e.apply(this,arguments)}}()),this.addContact=F("addContact"),this.groupMetadataFindFromPhone=F("groupMetadataFindFromPhone"),this.resyncMessages=F("resyncMessages"),this.resyncReceipts=F("resyncReceipts"),this.queryReceivedActions=F("queryReceivedActions"),this.addParticipants=F("addParticipants"),this.changeSubject=F("changeSubject"),this.createGroup=F("createGroup"),this.leaveGroup=F("leaveGroup"),this.removeParticipants=F("removeParticipants"),this.promoteParticipants=F("promoteParticipants"),this.demoteParticipants=F("demoteParticipants"),this.setGroupDescription=F("setGroupDescription"),this.setGroupProperty=F("setGroupProperty"),this.setGroupEphemeralDuration=F("setGroupEphemeralDuration"),this.requestMediaReupload=F("requestMediaReupload"),this.sendMedia=F("sendMedia"),this.mediaUpload=F("mediaUpload"),this.sendConversationSeen=F("sendConversationSeen"),this.sendConversationUnseen=F("sendConversationUnseen"),this.sendConversationClear=F("sendConversationClear"),this.sendConversationDelete=F("sendConversationDelete"),this.sendConversationArchive=F("sendConversationArchive"),this.sendConversationMute=F("sendConversationMute"),this.sendConversationNotSpam=F("sendConversationNotSpam"),this.sendConversationPin=F("sendConversationPin"),this.sendConversationDismissChangeNumber=F("sendConversationDismissChangeNumber"),this.sendMessagePlayed=F("sendMessagePlayed"),this.sendMessageDelete=F("sendMessageDelete"),this.sendMessageStarred=F("sendMessageStarred"),this.sendUnstarAll=F("sendUnstarAll"),this.sendSetPicture=F("sendSetPicture"),this.deletePicture=F("deletePicture"),this.sendSetStatus=F("sendSetStatus"),this.setPushname=F("setPushname"),this.statusQuery=F("statusQuery"),this.sendStatusSeen=F("sendStatusSeen"),this.statusQueryThumbnail=F("statusQueryThumbnail"),this.sendSetBlock=F("sendSetBlock"),this.sendSpamReport=F("sendSpamReport"),this.chatFindQuery=F("chatFindQuery"),this.contactFindQuery=F("contactFindQuery"),this.queryIdentity=F("queryIdentity"),this.queryVname=F("queryVname"),this.msgCreateRecord=F("msgCreateRecord"),this.msgFindQuery=F("msgFindQuery"),this.queryLinkPreview=F("queryLinkPreview"),this.queryVcard=F("queryVcard"),this.queryMsgInfo=F("queryMsgInfo"),this.recentEmojiQuery=F("recentEmojiQuery"),this.clearBPQueue=F("clearBPQueue"),this.parseWebMessageInfo=F("parseWebMessageInfo"),this.subscribeLiveLocation=F("subscribeLiveLocation"),this.unsubscribeLiveLocation=F("unsubscribeLiveLocation"),this.queryActiveLiveLocation=F("queryActiveLiveLocation"),this.disableLiveLocation=F("disableLiveLocation"),this.findGroupPendingInvitesFromPhone=F("findGroupPendingInvitesFromPhone"),this.acceptGroupV4Invite=F("acceptGroupV4Invite"),this.revokeGroupV4Invite=F("revokeGroupV4Invite"),this.sendCallOffer=F("sendCallOffer"),this.queryCall=F("queryCall"),this.sendCallEnd=F("sendCallEnd"),this.queryLabels=F("queryLabels"),this.queryNextLabelColor=F("queryNextLabelColor"),this.queryLabelPalette=F("queryLabelPalette"),this.addOrRemoveLabels=F("addOrRemoveLabels"),this.deleteLabel=F("deleteLabel"),this.createLabel=F("createLabel"),this.editLabel=F("editLabel"),this.queryQuickReplies=F("queryQuickReplies"),this.flushQuickReplyCounts=F("flushQuickReplyCounts"),this.queryStickerPacks=F("queryStickerPacks"),this.queryStickersInStickerPack=F("queryStickersInStickerPack"),this.queryRecentStickers=F("queryRecentStickers"),this.queryStarredStickers=F("queryStarredStickers"),this.queryVideoPlaybackUrl=F("queryVideoPlaybackUrl"),this.queryNoticeState=F("queryNoticeState"),this.querySettings=F("querySettings"),this.setArchiveSetting=F("setArchiveSetting"),this.queryDisappearingMode=F("queryDisappearingMode"),this.sendMdOptIn=F("sendMdOptIn")}isInitialized(){return!!U}setVersion(e,t,r){const n=e[0],a=e[1],o=[n,a,t,r].join("."),s=U!==o;if(__LOG__(2)`wap:setVersion ${o} set: ${String(s)}`,!s)return;const l=G;switch(n){case 0:switch(a){case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:case 13:case 14:case 15:case 16:throw __LOG__(3)`wap:setVersion deprecated version: ${o}`,new v.DeprecatedProtocolVersion("wap_deprecated_version");case 17:G=(0,i.default)({},P.protoMap[a]),G.setSubProtocol(t);break;default:G=void 0}}if(!G)throw __LOG__(3)`wap:setVersion unknown version. attempting to update`,new v.UpdateImmediately("wap_unknown_version");U=o,G.supportsFeatureFlags&&this.processFeatureFlags(r),l&&G&&G.upgradeProtoVersion(l)}processFeatureFlags(e){if(!e)return;const t=(0,u.default)(G,"protoVersion"),r=t.implementedFeatures||{},n=(0,g.decodeProtobufWithUnknowns)(R.WebFeaturesSpec,(0,o.decodeB64)(e)),i=(0,g.getUnknownFields)(n);delete n.unsafeUnknownFields;for(const e in r)C.GK.setFeatureFromFlags(e,R.WebFeaturesFlag.FORCE_UPGRADE,R.WebFeaturesFlag.FORCE_UPGRADE);const a=Object.keys(R.WebFeaturesSpec.internalSpec),s=Object.keys(n);a.forEach((e=>{const t=(0,C.getProtobufFeatureName)(e);!s.includes(e)&&C.GK.supportsFeature(t)&&C.GK.setFeature(t,!1)}));for(const e in n){if(r[e])continue;const i=n[e],a=T.default[e];if(i===R.WebFeaturesFlag.FORCE_UPGRADE&&a!==R.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:${e} phone value is ${i} and web value is ${a}. updating...`,new v.UpdateImmediately("wap_feature_force_upgrade");if(C.GK.setFeatureFromFlags(e,a,i),C.GK.supportsFeatureFromFlags(e)){const r=P.protoMap.features[e];r&&Object.assign(t,r)}}for(const e in i){const t=i[e];if("number"==typeof t&&R.WebFeaturesFlag.cast(t)===R.WebFeaturesFlag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:unknown: ${e}: ${t}`,new v.UpdateImmediately("wap_feature_implemented_unknown")}}delete(){const e=G?G.delete.apply(G,arguments):void 0;return G=void 0,U=void 0,__LOG__(2)`wap:unsetVersion, which should only happen when logout`,e}cannotReachPhone(){G&&G.cannotReachPhone.apply(G,arguments)}handle(e,t,r,n){return(0,u.default)(G,"protoVersion").handle.apply(G,[e,t,r,n])}queryServerProps(){return N.Socket.sendEphemeral2({data:["query","props"],retryOn5xx:!1})}resyncPictures(e){const t=e.filter((e=>_.default.isWid(e.id)));return 0===t.length?Promise.resolve([]):N.Socket.sendEphemeral2({data:["query","resumePic",t],retryOn5xx:!0})}setRememberMe(e){return N.Socket.sendBasic({data:["admin","remember",!!e]})}queryMediaConnections(e){const t=new Date,r=N.Socket.send2({data:["query","mediaConn"]}).then((e=>{if(__LOG__(2,!0)`queryMediaConnections result: ${JSON.stringify(e)}`,200!==e.status){if(e.status>=400)throw new D.ServerStatusCodeError(e.status,"queryMediaConnections");throw new D.ServerStatusCodeError(e.status,"Invalid return status")}const{media_conn:r}=e;if(!(r&&r.auth&&r.ttl&&r.hosts&&Array.isArray(r.hosts)&&0!==r.hosts.length))throw __LOG__(2)`wap:queryMediaConnections mediaConn exists ${String(!!r)}`,r&&(__LOG__(2)`wap:queryMediaConnections mediaConn.auth exists ${String(!!r.auth)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.ttl exists ${String(!!r.ttl)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts exists ${String(!!r.hosts)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts isArray ${String(Array.isArray(r.hosts))}`,r.hosts&&__LOG__(2)`wap:queryMediaConnections mediaConn.hosts.length ${r.hosts.length}`),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("wap:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");const{auth:n,auth_ttl:a,ttl:o,max_buckets:s}=r;return{auth:n,authTTL:a,hosts:r.hosts.map((e=>{var t;const r=null===(t=e.rules)||void 0===t?void 0:t.map((e=>e.download_buckets?{downloadBuckets:e.download_buckets}:e));return(0,i.default)((0,i.default)({},e),{},{rules:r})})),queryStartTime:t,ttl:o,maxBuckets:s}}));return(0,M.default)(r,e)}acceptGroupInvite(e){return N.Socket.send2({data:["action","invite",e],retryOn5xx:!0})}revokeGroupInvite(e){return N.Socket.send2({data:["action","inviteReset",e],retryOn5xx:!0})}contactFindBroadcast(e){return N.Socket.send2({data:["query","contact",e],retryOn5xx:!0})}commonGroupsFind(e){return _.default.isServer(e)?Promise.resolve({status:200,groups:[]}):N.Socket.send2({data:["query","group","common",e]})}getCapabilities(e){return N.Socket.send2({data:["query","caps",e.filter(_.default.isUser)],retryOn5xx:!0})}queryExist(e){return _.default.isUser(e)?N.Socket.send2({data:["query","exist",e],retryOn5xx:!0}):Promise.resolve({status:400})}queryCtwaContext(e,t,r){return(0,a.default)((function*(){var n,i,a,o;const s={accountNumber:(0,h.createWid)(e).toString({legacy:!0}),code:t,expectedSourceUrl:r,id:(0,f.generateId)()},l=yield N.Socket.send2({data:["query","ctwa",s],retryOn5xx:!0});if(200!==l.status)throw new D.ServerStatusCodeError(l.status,`queryCtwaContext:fail ${l.status}`);const c={sourceId:l.data.source.id,sourceType:l.data.source.type,sourceUrl:l.data.source.url,description:l.data.body,title:l.data.headline,mediaType:(null===(n=l.data.video)||void 0===n?void 0:n.url)?S.ContextInfo$ExternalAdReplyInfoMediaType.VIDEO:S.ContextInfo$ExternalAdReplyInfoMediaType.IMAGE,isSuspiciousLink:l.data.source.url!==r,thumbnailUrl:null===(i=l.data.thumbnail)||void 0===i?void 0:i.url,mediaUrl:null===(a=l.data.video)||void 0===a?void 0:a.url};return(null===(o=l.data.thumbnail)||void 0===o?void 0:o.bytes)&&(c.thumbnail=l.data.thumbnail.bytes),c}))()}queryBusinessProfile(e,t){return(0,a.default)((function*(){const r=yield N.Socket.send2({data:["query","businessProfile",e.filter((e=>_.default.isUser(e.wid))),t],retryOn5xx:!0});switch(r.status){case 200:return r.profiles;default:throw new Error(`queryBusinessProfile:fail ${r} ${r.status}`)}}))()}queryMerchantCompliance(e){return(0,a.default)((function*(){const t=yield N.Socket.send2({data:["query","merchantCompliance",e.filter((e=>_.default.isUser(e.wid)))],retryOn5xx:!0});switch(t.status){case 200:return t.compliance_infos;default:throw new Error(`queryMerchantCompliance:fail ${t} ${t.status}`)}}))()}queryBusinessCategories(e){return(0,a.default)((function*(){const t={id:(0,f.generateId)(),query:e},r=yield N.Socket.send2({data:["query","businessCategories",t],retryOn5xx:!0});switch(r.status){case 200:const e=r.data.not_a_biz[0],t=e.id,n=r.data.categories.reduce(((t,r)=>(r.id!==e.id&&t.push({id:r.id,localized_display_name:r.name}),t)),[]);return n.unshift({id:t,localized_display_name:e.name,not_a_biz:!0}),{categories:n,notABizId:t};default:throw new Error(`queryBusinessCategories:fail ${r} ${r.status}`)}}))()}queryOrder(e,t,r,n){return(0,a.default)((function*(){const i={id:(0,f.generateId)(),orderId:e,imageWidth:t.toString(),imageHeight:r.toString(),token:n},a=yield N.Socket.send2({data:["query","order",i],retryOn5xx:!0});switch(a.status){case 200:const{data:e}=a;try{const{currency:t,subtotal:r,total:n,tax:i}=e.price,a=parseInt(e.creationTS,10);return{currency:t,createdAt:a,products:e.products.map((e=>{var t,r;return{id:e.id,price:e.price,thumbnailId:null===(t=e.image)||void 0===t?void 0:t.id,thumbnailUrl:null===(r=e.image)||void 0===r?void 0:r.url,currency:e.currency,name:e.name,quantity:parseInt(e.quantity||0,10)}})),subtotal:r,total:n,tax:i}}catch(e){throw new D.ServerStatusCodeError(a.status,`queryOrder:response malformed ${a.status}`)}case 404:throw new D.E404;default:throw new D.ServerStatusCodeError(a.status,`queryOrder:fail ${a.status}`)}}))()}createOrder(e,t){return(0,a.default)((function*(){const r={product:t.map((e=>({id:e.id,name:e.name,quantity:(0,I.isNumber)(e.quantity)?e.quantity.toString():void 0,price:(0,I.isNumber)(e.priceAmount1000)?e.priceAmount1000.toString():void 0,currency:e.currency}))),bizJID:e,id:(0,f.generateId)()},n=yield N.Socket.send2({data:["action","createOrder",r],retryOn5xx:!0});if(200===n.status)return n.data;throw new D.ServerStatusCodeError(n.status,`createOrder:fail wap action return status: ${n.status}`)}))()}refreshCart(e,t,r,n){return(0,a.default)((function*(){const i=t.map((e=>({id:e}))),a={id:(0,f.generateId)(),products:i,bizJID:_.default.user(e),imageDimensions:{width:r.toString(),height:n.toString()}},o=yield N.Socket.send2({data:["action","refreshOrder",a],retryOn5xx:!0});if(200===o.status)return o.data;throw new D.ServerStatusCodeError(o.status,`refreshCart:fail wap action return status: ${o.status}`)}))()}queryProductCatalog(e,t,r,n,i,o){return(0,a.default)((function*(){const a={catalogWid:e,afterCursor:t,limit:r,width:n,height:i,allowShopSource:o,type:"get_product_catalog_reh",stanza_id:(0,f.generateId)()},s=yield N.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(s.status){case 200:return"string"==typeof s.data||s.data instanceof String?JSON.parse(s.data):s.data;default:throw new D.ServerStatusCodeError(s.status,`queryProductCatalog:fail ${s.status}`)}}))()}queryProductList(e,t,r,n){return(0,a.default)((function*(){const i={catalogWid:e,product_ids:t,width:""+r,height:""+n,stanza_id:(0,f.generateId)()},a=yield N.Socket.send2({data:["action","getProductList",i],retryOn5xx:!0});switch(a.status){case 200:return a.data.data;default:throw new D.ServerStatusCodeError(a.status,`queryProductList:fail ${a.status}`)}}))()}queryProduct(e,t,r,n,i){return(0,a.default)((function*(){const a={catalogWid:e,productID:t,width:r,height:n,fetchComplianceInfo:i,type:"get_product_reh",stanza_id:(0,f.generateId)()},o=yield N.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(o.status){case 200:const e="string"==typeof o.data||o.data instanceof String?JSON.parse(o.data):o.data.product;return e.compliance_category===b.ProductComplianceCategory.CountryOriginExempt&&(e.compliance_info={country_code_origin:String(y.SyntheticCountryCode.NotApplicable)}),{data:e};case 404:case"not_found":return{error:"NOT_FOUND"};default:throw new D.ServerStatusCodeError(o.status,`queryProduct:fail ${o.status}`)}}))()}reportBusinessCatalogProduct(e,t,r){return(0,a.default)((function*(){const n={id:t,jid:e.toString(),reason:r,stanza_id:(0,f.generateId)()},i=yield N.Socket.send2({data:["action","reportProduct_reh",n],retryOn5xx:!0});if(200!==i.status)throw new D.ServerStatusCodeError(i.status,`reportBusinessCatalogProduct:fail ${i.status}`)}))()}deleteBusinessCatalogProduct(e){return(0,a.default)((function*(){const t=["action","deleteProduct_reh",{product_ids:e,stanza_id:(0,f.generateId)()}],r=yield N.Socket.send2({data:t,retryOn5xx:!0});if(200!==r.status)throw new D.ServerStatusCodeError(r.status,`deleteBusinessCatalogProduct:fail ${r.status}`);return{deletedCount:r.deletedCount}}))()}createBusinessCatalog(){return(0,a.default)((function*(){const e=["action","createCatalog_reh",{stanza_id:(0,f.generateId)()}],t=yield N.Socket.send2({data:e,retryOn5xx:!0});if(200!==t.status)throw new D.ServerStatusCodeError(t.status,`createBusinessCatalog:fail ${t.status}`)}))()}getComplianceInfoRequestParams(e){const{complianceInfo:t}=e,{isExempt:r,hasCountryCodeOrigin:n,hasImporterName:i,hasImporterAddress:a}=(0,m.scanComplianceInfoForMissingData)(t);if(r||!t||!(n||i||a))return;const o={compliance_info:{}};if(t.countryCodeOrigin&&(o.compliance_info.country_code_origin=t.countryCodeOrigin),t.importerName&&(o.compliance_info.importer_name=t.importerName),t.importerAddress){const e={};t.importerAddress.street1&&(e.street1=t.importerAddress.street1),t.importerAddress.street2&&(e.street2=t.importerAddress.street2),t.importerAddress.postalCode&&(e.postal_code=t.importerAddress.postalCode),t.importerAddress.city&&(e.city=t.importerAddress.city),t.importerAddress.region&&(e.region=t.importerAddress.region),t.importerAddress.countryCode&&(e.country_code=t.importerAddress.countryCode),Object.keys(e).length>0&&(o.compliance_info.importer_address=e)}return o}editBusinessCatalogProduct(e,t,r){var n=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({product_id:e.id,name:e.name,image_url:e.imageCdnUrl,url:e.url,additional_image_urls:e.additionalImageCdnUrl,width:t.toString(),height:r.toString(),stanza_id:(0,f.generateId)(),is_hidden:e.isHidden},n.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),e.description&&(s.description=e.description),e.retailerId&&(s.retailer_id=e.retailerId),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(y.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=b.ProductComplianceCategory.CountryOriginExempt);const l=yield 