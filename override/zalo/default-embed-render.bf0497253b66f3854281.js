"object"!=typeof globalThis&&(globalThis=window),(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{"+3r3":function(e,t,s){"use strict";s.d(t,"b",(function(){return d})),s.d(t,"c",(function(){return h})),s.d(t,"a",(function(){return m}));var a=s("rePB"),n=s("xQyS"),i=s("qtjR");class o{constructor(){Object(a.a)(this,"_handlers",new Set),Object(a.a)(this,"add",(e=>(this._handlers.add(e),()=>this.remove(e)))),Object(a.a)(this,"remove",(e=>this._handlers.delete(e))),Object(a.a)(this,"executeHandlers",(async e=>{const t=Array.from(this._handlers).map((t=>Object(n.b)(t,e)));await Promise.all(t)}))}}const r=(e,t)=>new Promise(((s,a)=>{Object(i.a)(t).then((()=>s({ok:!1,error:"timeout"}))),e.then((e=>s(e)))}));var l=s("z0WU");const c=new o,d=c.add,h=(c.remove,async()=>{const e=Object(n.b)(c.executeHandlers,{name:"before-logout"}),t=await r(e,3e3);t.ok||"timeout"!==t.error||l.default.logCoreError("before-logout","not finished yet")});const u=s("5KmB").c?s("vbkW").ipcRenderer:null,_=new o,m=_.add;_.remove;null==u||u.addListener("before-close",(async()=>{const e=Object(n.b)(_.executeHandlers,{name:"before-close"}),t=await r(e,3e3);t.ok||"timeout"!==t.error||l.default.logCoreError("before-close","not finished yet")}))},"+JmS":function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return o}));var a=s("q1tI"),n=s("ZBGy");function i(){const{zdispatch:e}=Object(a.useContext)(n.a);return e}function o(){const{zemitter:e}=Object(a.useContext)(n.a);return e}},"+OA7":function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"l",(function(){return l})),s.d(t,"i",(function(){return c})),s.d(t,"k",(function(){return d})),s.d(t,"m",(function(){return h})),s.d(t,"j",(function(){return u})),s.d(t,"c",(function(){return _})),s.d(t,"g",(function(){return m})),s.d(t,"h",(function(){return p})),s.d(t,"n",(function(){return g})),s.d(t,"o",(function(){return E})),s.d(t,"d",(function(){return f})),s.d(t,"a",(function(){return T})),s.d(t,"e",(function(){return v})),s.d(t,"f",(function(){return R}));s("wd/R");var a=s("BDVO"),n=(s("NDmK"),s("IZCB")),i=(s("4SEz"),s("G4qV"));s("z0WU");function o(e){return e.convImgs}const r=e=>Object(i.a)(o,(function(t){return t[e]})),l=e=>Object(i.a)(r(e),(function({toUid:e}={}){return e})),c=e=>Object(i.a)(r(e),(function(e){return!(null==e||!e.uploadUrl)&&!e.oriUrl})),d=e=>Object(i.a)(r(e),(function(e){return null==e?void 0:e.tinyThumb})),h=(e,t,s=!1)=>Object(i.a)(r(e),(function(e){if(t)return null==e?void 0:e[t+(s?"LocalUrl":"Url")]})),u=(e,t)=>Object(i.a)(r(e),(function(e){return null==e?void 0:e[`${t}Path`]})),_=({ciId:e,types:t,priorityContext:s,disableCache:n})=>Object(i.a)(r(e),(function(i){return i?t.filter((e=>!!i[e+"Url"])).map((t=>({key:`${e}-${t}`,ci:i,type:t,srcObj:{canBeExpired:Object(a.c)(i.sendDttm,i.toUid),canBeNotReady:Object(a.a)(i.sendDttm),url:i[t+"Url"],localUrl:i[t+"LocalUrl"],localPath:i[t+"Path"]},checkContext:{nTry:0,disableCache:n},priorityContext:s}))):[]})),m=(e,t)=>Object(i.a)(r(e),(function(e){return(null==e?void 0:e.fromUid)==t})),p=(e,t)=>Object(i.a)(r(e),(function(e){const s=String(null==e?void 0:e.toUid);return!s.startsWith("g")&&s!==t})),g=(e,t)=>Object(i.a)(r(e),(function(e){return e?t.map((t=>`${t}-${e[t+"Url"]}`)):[]})),E=e=>Object(i.a)(r(e),(function(e){var t;return null!=(t=null==e?void 0:e.vOrient)?t:n.a.None})),f=(e,t=!0)=>Object(i.a)(r(e),(function(e){const{vOrient:s,uploadOrient:a}=e;return t?s:Object(n.b)(a,s)})),I=[800,800],T=e=>Object(i.a)(r(e),(function(e){const{serverW:t,serverH:s,uploadW:a,uploadH:n,uploadOrient:i}=e,[o,r]=t?[t,s]:a?[a,n]:I;return[o,r]})),v=e=>Object(i.a)(T(e),E(e),(function([e,t],s){return Object(n.f)(e,t,s)})),R=e=>Object(i.a)(r(e),(e=>!(null==e||!e.hdParam)))},"+UDQ":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=(s("17x9"),s("XS0u")),o=s("z0WU"),r=s("NGyP"),l=s("Ydol"),c=s("97kL"),d=s("lCMA"),h=s("ro+J"),u=s("NDmK"),_=s("1pet"),m=s("+ezG"),p=(s("BKm0"),s("c51z"),s("6uTC"),s("Yi2m"),s("h0sc")),g=s("1PLK"),E=s("2fo3"),f=s("CzFt"),I=s("dpMp");let T=!0;class v extends n.a.Component{constructor(e){super(e);let t=[{key:"slide_0",image:"assets/inapp-welcome-screen-0.19afb7ab96c7506bb92b41134c4e334c.jpg",titleKey:"STR_WELCOME_SCREEN_TITLE_0",subtitleKey:"STR_WELCOME_SCREEN_SUBTITLE_0"},{key:"slide_1",image:"assets/inapp-welcome-screen-04.ade93b965a968b16f2203e9d63b283a7.jpg",titleKey:"STR_WELCOME_SCREEN_TITLE_4",subtitleKey:"STR_WELCOME_SCREEN_SUBTITLE_4"},{key:"slide_2",image:"assets/inapp-welcome-screen-03.3f97d49ceecb950d95382b3d8fd4f0f1.png",titleKey:"STR_WELCOME_SCREEN_TITLE_3",subtitleKey:"STR_WELCOME_SCREEN_SUBTITLE_3"},{key:"slide_3",image:"assets/inapp-welcome-screen-02.7f8cab265c34128a01a19f3bcd5f327a.jpg",titleKey:"STR_WELCOME_SCREEN_TITLE_2",subtitleKey:"STR_WELCOME_SCREEN_SUBTITLE_2"},{key:"slide_4",image:"assets/inapp-welcome-screen-01.469ad7daf26e0303dd0d54eb5262e795.jpg",titleKey:"STR_WELCOME_SCREEN_TITLE_1",subtitleKey:"STR_WELCOME_SCREEN_SUBTITLE_1"}];if(u.c.quick_message.enable){const e={key:"quick_message_onboard",image:"assets/quick-message-onboard.3950179c175f636e91e3169b65d1b3e2.png",titleKey:"STR_WELCOME_SCREEN_QUICK_MESSAGE_TITLE",subtitleRTF:[{text:"STR_WELCOME_SCREEN_QUICK_MESSAGE_SUBTITLE_1"},{text:"STR_WELCOME_SCREEN_QUICK_MESSAGE_SUBTITLE_2",style:"bold"},{text:"STR_WELCOME_SCREEN_QUICK_MESSAGE_SUBTITLE_3"}]};t.splice(0,0,e)}if(u.c.ttl.enable){const e={key:"vanish_onboard",image:E.a,titleKey:"STR_WELCOME_SCREEN_TITLE_VANISH",subtitleKey:"STR_WELCOME_SCREEN_SUBTITLE_VANISH"};t.splice(1,0,e)}this.state={topFriends:[],showWelcome:T,reRender:!0,exportImportFinished:!0,welcomeItems:t},this._onEventHandler=(e,t)=>{switch(e){case c.FetchActions.SERVER_CONFIG:let e=this.state.welcomeItems;0,this.setState({reRender:!this.state.reRender,welcomeItems:e})}}}shouldComponentUpdate(e,t){let s=!1;return!this.props.user&&e.user?(o.default.logCoreError("this.props dont have user info !!!"),!0):(e.user&&this.props.user&&(s=e.user.displayName!==this.props.user.displayName),this.state.topFriends!==t.topFriends||this.state.reRender!=t.reRender||s)}componentWillMount(){l.default.subscribe(this._onEventHandler),this.props.recentContact&&!(this.props.recentContact.length<6)||this.state.showWelcome||i.default.getFriends(10).then((e=>{e=e.slice(0,6),this.setState({topFriends:e})})).catch(o.default.logCoreError)}sendInvite(e,t=""){l.default.send(c.SideBarActions.SEND_INVITATION,{target:e,message:t,link:`https://${u.c.CONFIG_DOMAIN}/may-tinh`})}_sendInvite(){p.a.openModal({windowId:"1",name:_.ModalIdentitiesDefine.SHARE_MSG_COMPOSE,params:{disablePcUser:!0,disableGroup:!0,title:"Mời thêm bạn dùng Zalo Máy Tính",callback:this.sendInvite.bind(this)}})}_getAppBanner(){return u.c.emptyBanner&&u.c.emptyBanner.url?{backgroundImage:'url("'+u.c.emptyBanner.url+'")',backgroundRepeat:"no-repeat",backgroundPosition:"right bottom"}:null}componentWillUnmount(){T=!1,l.default.unsubscribe(this._onEventHandler)}_selectFriend(e){l.default.send(c.ChatBoxActions.SELECT_FRIEND,e)}_showCompose(){p.a.openModal({windowId:"1",name:_.ModalIdentitiesDefine.CREATE_GROUP_COMPOSE,params:!0})}_showSupport(){u.c.supportPage&&this.props.showZaloSupport()}_showExportPopup(){}_showImportPopup(){}_onOpenLink(e,t){t&&(t.preventDefault(),t.stopPropagation()),g.b.open(e)}_download(){window.open(`https://${u.c.CONFIG_DOMAIN}/may-tinh?utm_source=onboard_btn&utm_campaign=reinstallpc&utm_medium=web`,"_blank")}render(){let e=[];if(this.props.recentContact)for(let a=0;a<this.props.recentContact.length&&a<3;a++){let t=this.props.recentContact[a];e.push(t)}if(e.length<3)for(let a=0;a<this.state.topFriends.length&&e.length<3;a++)e.push(this.state.topFriends[a]);let t=null,s=this._getAppBanner();if(u.c.showNewWelcomeScreen)t=n.a.createElement("div",{className:"flx flx-col flx-al-c flx-center chat-onboard",style:s},n.a.createElement("div",{style:{width:"415px",textAlign:"center",color:"var(--neutral-base)",marginBottom:"50px"}},n.a.createElement("div",{style:{fontSize:"22px",marginBottom:"20px"}},n.a.createElement(d.a,{textKey:"STR_WELCOME_SCREEN_MAIN_TITLE"})," ",n.a.createElement("span",{style:{fontWeight:"600"}},"Zalo PC"),"!"),n.a.createElement(d.a,{textKey:"STR_WELCOME_SCREEN_MAIN_SUBTITLE",style:{fontSize:"14px"}})),n.a.createElement(m.a,{items:this.state.welcomeItems}));else{const a=n.a.createElement("div",{className:"chat-onboard__guide"},n.a.createElement("div",{className:"flx flx-al-c chat-onboard__guide__item clickable",onClick:this._sendInvite.bind(this)},n.a.createElement("div",{style:{backgroundImage:'url("assets/csc-empty-icon-invite.71a35fab184c8f40d74126d7b64f76c6.png")'},className:"chat-onboard__icon"}),n.a.createElement("div",{className:"chat-onboard__desc"},n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_1_1",style:{color:"var(--green-400)"},className:"semibold"})," ",n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_1_2"}))),n.a.createElement("div",{className:"flx flx-al-c  chat-onboard__guide__item clickable",onClick:this._showCompose.bind(this)},n.a.createElement("div",{style:{backgroundImage:'url("assets/csc-empty-icon-group.6e9cb9bcc61c69ef2996a01d7fdf02a5.png")'},className:"chat-onboard__icon"}),n.a.createElement("div",{className:"chat-onboard__desc"},n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_2_1",style:{color:"var(--purple-400)"},className:"semibold"})," ",n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_2_2"}))),n.a.createElement("div",{className:"flx flx-al-c  chat-onboard__guide__item clickable",onClick:this._download.bind(this)},n.a.createElement("div",{style:{backgroundImage:'url("assets/csc-empty-icon-download.08e408be992bc321add1d6ec956a056a.png")'},className:"chat-onboard__icon"}),n.a.createElement("div",{className:"chat-onboard__desc"},n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_3_1",style:{color:"var(--yellow-300)"},className:"semibold"})," ",n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_3_2"}))),n.a.createElement("div",{className:"flx flx-al-c chat-onboard__guide__item clickable",onClick:this._showSupport.bind(this)},n.a.createElement("div",{style:{backgroundImage:'url("assets/csc-empty-icon-contact.98c01dd0b69dca2168385744fd48174f.png")'},className:"chat-onboard__icon"}),n.a.createElement("div",{className:"chat-onboard__desc"},n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_4_1",style:{color:"var(--red-400)"},className:"semibold"})," ",n.a.createElement(d.a,{textKey:"STR_CHAT_BOARD_4_2"}))));t=this.state.showWelcome?n.a.createElement("div",{className:"flx flx-col flx-al-c flx-center chat-onboard",style:s},n.a.createElement("div",{className:"chat-onboard__title"},n.a.createElement(d.a,{textKey:"STR_HI"})," ",this.props.user.displayName,"!"),a):n.a.createElement("div",{className:"flx flx-col flx-al-c flx-center chat-onboard",style:s},n.a.createElement("div",{className:"chat-onboard__text"},n.a.createElement(d.a,{textKey:"STR_ONBOARD_MSG"})),n.a.createElement("div",{style:{width:"420px"}},e.map((e=>n.a.createElement("div",{key:e.userId,onClick:this._selectFriend.bind(this,e),className:"flx flx-col flx-al-c flx-center clickable",style:{display:"inline-block",margin:"30px 30px"}},n.a.createElement(r.b,{target:e,size:"xxl",showUnread:!1}),n.a.createElement("div",{className:"truncate",style:{width:"80px",marginTop:"10px",textAlign:"center"}},e.displayName))))),a)}return n.a.createElement(h.a,null,n.a.createElement("div",{id:"chatOnboard",className:"flx-1 w0"},t))}}t.a=Object(f.sidebarConnect)((e=>({recentContact:Object(I.conversationsSelector)(e).conversations})),void 0,void 0,{forwardRef:!0})(v)},"+V8v":function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return r}));var a=s("VTBJ"),n=s("q1tI"),i=s.n(n);const o=i.a.createContext();function r(e){const{children:t,value:s}=e;return i.a.createElement(o.Provider,{value:Object(a.a)({},s)},t)}},"+Wh9":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));s("z0WU");class a{constructor(){let[e,...t]=arguments;this._limit=e,this._map=new Map(t)}clear(){this._map.clear()}set(){if(this._limit){let e=this._map.size-this._limit+1;if(e>0){let t=this._map.keys();for(let s=0;s<e;s++)this._map.delete(t.next().value)}}this._map.set(...arguments)}get(){return this._map.get(...arguments)}has(){return this._map.has(...arguments)}delete(){return this._map.delete(...arguments)}forEach(){return this._map.forEach(...arguments)}keys(){return this._map.keys()}}},"+ZIR":function(e,t,s){"use strict";s.r(t),t.default="assets/tongketnhom.d0e4c653f987f7ceb9253db597852275.svg"},"+ZSp":function(e,t,s){"use strict";var a=s("wx14"),n=s("Ff2n"),i=s("q1tI"),o=s.n(i),r=s("/Z5y"),l=s("EIuX"),c=(s("17x9"),s("iuhU")),d=s("02jS"),h=(s("fB5U"),s("zRkS"));const u="file-progress-row";function _(e,t){const{progress:s,startText:a,endText:n,onCancel:i,className:r}=e,l=Object(c.a)(u,r);return o.a.createElement("div",{className:l},a&&o.a.createElement("div",{className:`${u}__start-text`},a),o.a.createElement(d.b,{ref:t,progress:s}),n&&o.a.createElement("div",{className:`${u}__end-text`},n),o.a.createElement(h.a,{className:`icon-solid-close-2 ${u}__cancel-button`,onClick:i}))}var m=o.a.memo(o.a.forwardRef(_)),p=s("z0WU"),g=s("3kX4");function E(e,t){const{pIdOrMsgId:s,file:i}=e,c=Object(n.a)(e,["pIdOrMsgId","file"]),d=Object(r.a)(s,l.D),h=Object(r.a)(s,l.r),u=o.a.useCallback((e=>(e&&(e.preventDefault(),e.stopPropagation()),Object(g.a)(i))),[i]),{downloadedText:_,totalText:E}=p.default.generateSizeProgress(d/100*h,+h,2);return o.a.createElement(m,Object(a.a)({},c,{ref:t,startText:`${_}/${E}`,progress:d,onCancel:u}))}const f=o.a.memo(o.a.forwardRef(E));t.a=f},"+ezG":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("iuhU"),i=s("q1tI"),o=s.n(i),r=(s("17x9"),s("NDmK"),s("z0WU"),s("lCMA")),l=s("1PLK");class c extends o.a.Component{constructor(e){super(e),this.isFireFoxBrowser=this.isFireFox(),this.state={currentIndex:0},this._selectPage=this._selectPage.bind(this),this._moveRepeat()}componentWillUnmount(){clearTimeout(this._timer)}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}_moveRepeat(){this.props.offAutoMove||(this._timer&&clearTimeout(this._timer),this._timer=setTimeout((()=>{this.move(1)}),5e3))}_selectPage(e){this.setState({currentIndex:e}),this.props.onChangePage&&this.props.onChangePage(e),this._moveRepeat()}move(e){let t=this.state.currentIndex+e;t<0?t=this.props.items.length-1:t>this.props.items.length-1&&(t=0),this._selectPage(t)}getIndexPageCurrent(){return this.state.currentIndex}render(){let e={};this.props.style&&(e=this.props.style);let t={height:"100%"};return this.props.containerStyle&&(t=Object(a.a)(Object(a.a)({},t),this.props.containerStyle)),o.a.createElement("div",{className:"flx flx-center slideshow",style:e},this.props.hideButtonMove?null:o.a.createElement("div",{className:"slideshow__prev slideshow__btn btn",onClick:this.move.bind(this,-1)},o.a.createElement("i",{className:"fa fa-chevron-left"})),o.a.createElement("div",{className:"flx flx-col slideshow__container flx-al-c",style:t},o.a.createElement("div",{className:"flx slideshow__content",style:{left:`-${this.state.currentIndex}00%`,height:"100%",width:`calc(100% * ${this.props.items.length})`,margin:"auto"}},this.props.items.map((e=>{let t=e.image||e.preview_image||e.thumb,s=e.subtitle||e.description,i={objectFit:"contain"};return this.props.imgStyle&&(i=Object(a.a)(Object(a.a)({},i),this.props.imgStyle)),o.a.createElement("div",{key:e.key,className:"slideshow__page",style:{height:"100%",width:`calc(100% / ${this.props.items.length})`,textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},o.a.createElement("img",{src:t,className:"slideshow__page__image",style:i}),o.a.createElement("div",{className:"flx flx-col slideshow__page__text"},e.titleKey?o.a.createElement(r.a,{textKey:e.titleKey,className:"slideshow__page__text__title"+(!0===this.isFireFoxBrowser?" ff":" truncate-2")}):e.title?o.a.createElement("span",{className:"slideshow__page__text__title"+(!0===this.isFireFoxBrowser?" ff":" truncate-2")},e.title):null,e.subtitleKey?o.a.createElement(r.a,{textKey:e.subtitleKey,className:"slideshow__page__text__subtitle"+(!0===this.isFireFoxBrowser?" ff":" truncate-5"),style:e.titleKey||e.title?null:{marginTop:"20px"}}):s?o.a.createElement("span",{className:"slideshow__page__text__subtitle"+(!0===this.isFireFoxBrowser?" ff":" truncate-5"),style:e.titleKey||e.title?null:{marginTop:"20px"}},s):null,e.href?o.a.createElement(r.a,{textKey:"STR_VIEWMORE",style:{color:"var(--blue-300)",cursor:"pointer",marginTop:"10px",fontSize:"13px"},onClick:t=>{l.b.open(e.href)}}):null,e.customLink&&e.customLink.onClickFunc&&e.customLink.titleKey?o.a.createElement(r.a,{textKey:e.customLink.titleKey,style:{color:"var(--blue-300)",cursor:"pointer",marginTop:"10px",fontSize:"13px"},onClick:e.customLink.onClickFunc.bind(this)}):null,e.subtitleRTF?o.a.createElement("span",{className:"subtitle-rtf"},e.subtitleRTF.map(((e,t)=>{const s=Object(n.a)("subtitle-rtf__text",e.style&&`--${e.style}`,this.isFireFoxBrowser&&"--ff"),a=e.text;return o.a.createElement(r.a,{className:s,textKey:a})}))):null))}))),o.a.createElement("div",{className:"slideshow__bottom"},this.props.items.map(((e,t)=>o.a.createElement("span",{key:e.key,onClick:this._selectPage.bind(this,t),className:"slideshow__bottom__dot "+(this.state.currentIndex===t?" selected":"")}))))),this.props.hideButtonMove?null:o.a.createElement("div",{className:"slideshow__next slideshow__btn btn",onClick:this.move.bind(this,1)},o.a.createElement("i",{className:"fa fa-chevron-right"})))}}c.propTypes={},c.defaultProps={},t.a=c},"+fIN":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a={SEND_TOP_MEMBER_GROUP:"SEND_TOP_MEMBER_GROUP"};const n=new class{constructor(){}_signalCallbackToFriendWorker(e,t){this._callbackToFriend&&this._callbackToFriend(e,t)}_signalCallbackToGroupWorker(e,t){this._callbackToGroup&&this._callbackToGroup(e,t)}setCallbackToFriendWorker(e){this._callbackToFriend=e}setCallbackToGroupWorker(e){this._callbackToGroup=e}sendToGroup(e,t){this._signalCallbackToGroupWorker(e,t)}sendToFriend(e,t){this._signalCallbackToFriendWorker(e,t)}};t.b=n},"+it+":function(e,t,s){"use strict";function a(e){return!!e&&("[object Array]"===Object.prototype.toString.call(e)||"Array"===e.constructor.name||e instanceof Array)}const n={isArray:a,isNum:function(e){let t=!0;return(null==e||"boolean"==typeof e||"object"==typeof e||e===1/0||e===-1/0||isNaN(e))&&(t=!1),t},isObject:function(e){const t=typeof e;return null!=e&&("object"===t||""===t)},isFn:function(e){return"function"==typeof e},isString:function(e){const t=typeof e,s="object"===t&&null!=e&&!a(e)&&"[object String]"===function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}(e);return"string"===t||s}};t.a=n},"+ou9":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=s("z0WU"),o=s("xxEM"),r=s("1pet"),l=s("1Kge"),c=s("ynGT"),d=s("vSga"),h=s("iuhU");let u;const _=i.default.isWeb();_||(u=s("Dprd").default);class m extends n.a.Component{constructor(e){super(e),this.timer=null,this._ver=0,String.prototype.replaceAll=function(e,t){return this.split(e).join(t)},this._getConfigs(e.sticker);let t=i.default.removeProtocol(this._getStickerThumbUrl());const s=_||o.a.preLoad(o.a.getStickerFilePath(e.sticker,t));this.state={frame:this.fkey,spriteLoaded:!1,thumbLoaded:s,stopped:!1},this._mounted=!0,this.onLoad=this.onLoad.bind(this)}_getConfigs(e){this.mLastFrame=0,this.mLastBackground="",this.totalFrames=e?e.totalFrames:1,this.fkey=e?e.fkey:0,this.fkey>=this.totalFrames&&(this.fkey=Math.max(0,this.totalFrames-1)),this._loadingSprite=!1,this._loadingThumb=!1,this.currentVersion=e?e.version:0}shouldComponentUpdate(e,t){return this.props.display!==e.display&&!this.state.thumbLoaded&&e.display&&this._loadThumb(),this.props.sticker!==e.sticker||this.state.thumbLoaded!==t.thumbLoaded||this.state.spriteLoaded!==t.spriteLoaded||this.state.frame!==t.frame||this.state.stopped!==t.stopped||this.props.fullScreenEffectId!==e.fullScreenEffectId||this.props.display!==e.display}_checkValid(){if(!_){let e=i.default.removeProtocol(this._getStickerUrl()),t=o.a.getStickerFilePath(this.props.sticker,e),s=()=>{o.a.removePathExist(t),this._ver++,this._loadSprite(!!this.timer)};u.isFile(t).then((e=>{e&&e.size||s()})).catch((e=>{e&&"ENOENT"===e.code&&s()}));let a=i.default.removeProtocol(this._getStickerThumbUrl()),n=o.a.getStickerFilePath(this.props.sticker,a),r=()=>{o.a.removePathExist(n),this._ver++,this._loadThumb()};u.isFile(n).then((e=>{e&&!e.size||r()})).catch((e=>{e&&"ENOENT"===e.code&&r()}))}}start(e=""){if(this.showThumb(!1),this.timer)return;let t=this.props.sticker;const s=Date.now();if(l.a.getSyncAnimationNextTs(t.id,t.cateId,this)-s>20)return void window.requestAnimationFrame((()=>{this.start(e)}));this.props.autoStop&&l.a.resetIterationCount(t.id,t.cateId,this);let a="";a=e||this._getBackgroundImageUrl(this._getStickerUrl()),this.mLastFrame=0,this.mLastBackground==a&&""==e||(this.mLastFrame=this.fkey,this.safe_setState({frame:this.mLastFrame,stopped:!1})),l.a.setSyncAnimationInfo(t.id,t.cateId,this.mLastFrame,this,Date.now()+(t.duration||250)),this.timer=setInterval((()=>{let e=0;if(t.ext===r.STICKER_EXT.WEBP);else{e=this.mLastFrame+1;const s=l.a.getSyncAnimationInfo(t.id,t.cateId);s&&s.frame&&(e=s.frame+1),e%=t.totalFrames}if(0==e&&this.props.autoStop){let e=l.a.getIterationCount(t.id,t.cateId,this);e++,e>=this.props.interation?this.stop():l.a.increaseIterationCount(t.id,t.cateId,this)}this.timer&&(this.mLastFrame=e,l.a.setSyncAnimationInfo(t.id,t.cateId,e,this,Date.now()+(t.duration||250)),this.safe_setState({frame:e}))}),t.duration?t.duration:250)}stop(){this.timer&&(clearInterval(this.timer),this.timer=null,l.a.clearSyncAnimationFrame(this.props.sticker.id,this.props.sticker.cateId,this),l.a.deleteIterationCount(this.props.sticker.id,this.props.sticker.cateId,this),this.safe_setState({frame:this.fkey,stopped:this.props.sticker&&this.props.sticker.ext===r.STICKER_EXT.WEBP}))}safe_setState(e){this._mounted&&this.setState(e)}componentWillUnmount(){this._mounted=!1,this.stop()}componentDidUpdate(){let e=this.props.sticker?this.props.sticker.version:0;e!==this.currentVersion&&(this.currentVersion=e,this._getConfigs(this.props.sticker),this.stop(),this.safe_setState({spriteLoaded:!1,thumbLoaded:!1}),this._checkValid())}componentDidMount(){this._mounted=!0,_?this.onLoad():this._checkValid()}_getStickerThumbUrl(){var e;const t=this.props.sticker;if(!t)return"";const s=null!=(e=t.stickerWebpUrl)?e:t.stickerUrl;return t.version?i.default.addParamToURL(s,{version:t.version}):s||""}_getStickerUrl(){let e=this.props.sticker,t=e.stickerGifUrl||e.stickerUrl;return t=e.stickerSpriteUrl&&(e.ext===r.STICKER_EXT.WEBP||e.totalFrames>1)?e.stickerSpriteUrl:t,_&&e.checksum&&t&&(t=i.default.addParamToURL(t,{checksum:e.checksum})),t}_loadSticker(e,t,s=null,a=null,n=!1,i=!1){if(_)return void t();let r=this.props.sticker,l=o.a.getStickerFilePath(r,e,n);o.a.loadSticker(e,l,this.props.highPriority,a,i).then((()=>{t()})).catch((()=>{s&&s()}))}_loadSprite(e=!0){if(!this._loadingSprite){this._loadingSprite=!0;let t=this.props.sticker,{checksum:s,totalFrames:a}=t,n=t.ext;if(!s||n!==r.STICKER_EXT.WEBP&&(0==a||1==a))return;let i=t.updateState===c.i.ALL||t.updateState===c.i.SPRITE_ONLY;const o=()=>{this.safe_setState({spriteLoaded:!0}),e&&this._playSticker(),i&&d.g.onUpdateResourceDone(t,c.f.SPRITE),this.onLoad()};this._loadSticker(this._getStickerUrl(),o,null,s,!0,i)}}_loadThumb(e=null,t=null){if(!this._loadingThumb){this._loadingThumb=!0;let s=this.props.sticker,a=s.updateState===c.i.ALL||s.updateState===c.i.THUMB_ONLY;const n=()=>{this.safe_setState({thumbLoaded:!0}),this.timer||this.showThumb(),e&&e(),a&&d.g.onUpdateResourceDone(s,c.f.THUMB),this.onLoad()};this._loadSticker(this._getStickerThumbUrl(),n,t,null,!1,a)}}_playSticker(){if(!0===this.props.disablePlay)return void this.showThumb();let e=this.props.sticker;e&&(e.stickerSpriteUrl&&(e.totalFrames&&e.totalFrames>=2||e.ext===r.STICKER_EXT.WEBP)&&!this.timer?this.start():this.showThumb(!0))}_getBackgroundImageUrl(e){let t="",s=i.default.removeProtocol(e);return t=_?'url("'+s+'")':'url("file:///'+o.a.getStickerFilePath(this.props.sticker,s).replaceAll("\\","/")+'")',t}componentWillMount(){!this.state.thumbLoaded&&this.props.display&&this._loadThumb(this.autoPlay.bind(this),(()=>{this.props.disablePlay||this._loadSprite()})),!1!==this.props.autoPlay&&this.state.thumbLoaded&&(this.state.spriteLoaded?this._playSticker():this._loadSprite())}autoPlay(){!1!==this.props.autoPlay&&(this.state.spriteLoaded||this._loadSprite())}_playWhenMouseOver(){this.props.onMouseEnterPrivate&&this.props.onMouseEnterPrivate(this.props.sticker.id),!0!==this.props.disablePlay?this.state.spriteLoaded?this._playSticker():this._loadSprite():this.showThumb()}_stopWhenMouseLeave(e){this.props.onMouseLeavePrivate&&this.props.onMouseLeavePrivate(e),0==this.props.autoPlay&&(this.stop(),this.state.thumbLoaded?this.showThumb():this._loadThumb())}showThumb(e=!0){setTimeout((()=>{this.safe_setState({thumbLoaded:!0})}),0)}onLoad(){if(this.props.onLoad)try{this.props.onLoad()}catch(e){}}render(){let e=null;if(!this.props.display)return null;let t=this.props.sticker,s=this.props.thumbSize,a=!1,i={width:s+"px",height:s+"px"};if(t.source===r.STICKER_SOURCE.TENOR&&(i.backgroundSize="contain"),!this.state.spriteLoaded||this.state.stopped||this.props.disablePlay)this.state.thumbLoaded?(i.backgroundImage=this._getBackgroundImageUrl(this._getStickerThumbUrl()),t.stickerWebpUrl&&(i.backgroundSize="contain")):a=!0;else{let e=this.state.frame*s;i.backgroundImage=this._getBackgroundImageUrl(this._getStickerUrl()),i.backgroundPosition="-"+e+"px 0px",t.source!==r.STICKER_SOURCE.TENOR&&(i.backgroundRepeat="repeat-x",i.backgroundSize=`${s*this.totalFrames}px ${s}px`)}t.ext===r.STICKER_EXT.WEBP&&(i.backgroundPosition="center"),this.mLastBackground=i.backgroundImage;const o=Object(h.a)("sticker",a?this.props.preloadClassname||"sticker-loading":this.props.className,this.props.isFlip&&"flip-sticker");e=n.a.createElement("div",{key:t.id+"_v"+this._ver,className:o,style:i,ref:e=>this.stickerContentRef=e,onMouseOut:this._stopWhenMouseLeave.bind(this),onMouseOver:this._playWhenMouseOver.bind(this),onClick:this.props.onClick});let l=null;return this.props.fullScreenEffectId&&(l=n.a.createElement("div",{key:"preload-spinner-container",className:"preload-spinner-container"},n.a.createElement("div",{className:"preload-spinner"}))),n.a.createElement("div",{ref:"cacheContainer",style:{position:"relative"}},n.a.createElement("div",{className:"card--sticker--container","data-id":"div_StickerMenu_RecentItem"},l,e))}}t.a=m},"+pp5":function(e,t,s){"use strict";s.d(t,"a",(function(){return A}));var a=s("VTBJ"),n=s("oMA/"),i=s("oTQY"),o=s("1QIM"),r=s("AO3Z"),l=s("HcYY"),c=s("hmKP"),d=s("vKkC"),h=s("KR8Z"),u=s("ZugZ"),_=s("PcZ+"),m=s("L0Gx"),p=s("H8+V"),g=s("P3Qp"),E=s("wIWa"),f=s("HIcU"),I=s("WkTr"),T=s("/Gw8"),v=s("X450"),R=s("Ix/i");class S extends R.a{constructor(e,t,s,a){super(),this.peerId=e,this.roomId=t,this.status=s,this.subCmd=a,this.request()}callApi(){return new Promise(((e,t)=>{r.a.peerChangeVideoStatus(this.peerId,this.roomId,this.status,this.subCmd).then(e).catch((e=>{e==m.c?t("ERR_NO_NETWORK"):t(e)}))}))}handleSucess(e){console.error("retry success: "+JSON.stringify(e))}handleError(e,t){super.handleError(e,t)}}var O=S,N=s("s2ie"),b=s("tGM2"),C=s("kpYN");const A={FREE:"free",IN_MEETING:"inMeeting",INIT_MEETING:"initMeeting",RESET:"reset",LEAVE_MEETING:"leaveMeeting"};const y=new class{constructor(){this._logError=i.a.logError.bind(i.a,"[call-manager] call-helper:"),this.callState=A.FREE,this.deviceListData=null,this.peerId=null,this.roomId=null,this.audioState=0,this.videoState=0,this.profile=null,this.interrupted=!1,this.stateNetworkCur=b.m.CONNECTED,this._handleSendSignalError=this._handleSendSignalError.bind(this),this._handleRecvSignal=this._handleRecvSignal.bind(this),this.eventHandler=this.eventHandler.bind(this),this.leaveCurrentRoom=this.leaveCurrentRoom.bind(this)}handleUpdate(e,t,s){this.processReceivedData(s)}handleSendSignal(e,t,s){const a=this.processReceivedData(s);let n;switch(this._logInfo("call-send-signal",JSON.stringify(a)),t){case"peerRequestUnmute":{let{peerId:e,roomId:t,subCmd:s}=a;n=r.a.peerRequestUnmute(e,t,s);break}}n&&n.then((()=>{})).catch(this._handleSendSignalError)}handleRequest(e,t,s){const a=this.processReceivedData(s);switch(this._logInfo("call-request",t,JSON.stringify(a)),t){case"uploadLog":this._uploadLog(a.fileName,a.callId,a.ownerId,a.partnerId,a.duration);break;default:this._logError("call-request not supported",t,a)}}sendConfigAppToNative(e,t=!1){if(t){if(!this._sendInitConfig)return}else this._sendInitConfig=!0;i.a.logInfo("sendConfigAppToNative:",t),this._sendLocalRequestToNative(e,I.N)}async handleLocalRequest(e,t,s,a){const l=this.processReceivedData(s);switch(this._logInfo("call-local-request",JSON.stringify(l)),t){case I.O:if(this._setCallState(l.state,l.roomId),1==l.exitcode){const e=r.a.getCurrentRoom(),t=r.a.getCurrentPeerId();i.a.logError(`leave room on crash app, r ${e}, p ${t}`),e&&t&&c.a.leaveRoom(e,t),E.a.createInfo(u.a.str("STR_YOU_HAVE_LEFT_THE_MEETING"))}break;case I.M:T.a.saveMeetingNotes(l.roomId,l.data);break;case I.E:o.a.getFriendList().then((e=>{const t={type:"response",command:"getFriendList",data:{friendList:e||[]}};this._sendToNative(t)}));break;case I.H:h.a.send(d.a.FORCE_PING);break;case I.Q:if(!l||!l.log)return i.a.logError("Invalid param to submit log str",l);g.a.uploadLogStr(l.log,l.room_id,l.owner_id,l.app_user_id);break;case I.P:if("object"!=typeof l)return i.a.logError("Invalid param to submit log file",l);g.a.uploadLogFile(l.fileName,l.roomId,l.ownerId,l.appUserId,l.joinTime,l.duration);break;case I.K:{const{roomId:e}=l,[s,n]=await T.a.loadMeetingNotes(e);s?i.a.logError("load notes failed",s):this._sendResponseLocalRequestToNative(a,t,n);break}case I.D:{const{roomId:e}=l,s=T.a.loadLastActionId(e);this._sendResponseLocalRequestToNative(a,t,{resp:s});break}case I.F:{let{roomId:e}=l;const s=T.a.getTranscriptOfflineLocal(e);this._sendResponseLocalRequestToNative(a,t,{resp:s});break}case I.G:{let{roomId:e}=l;const s=T.a.getHasMoreMsg(e);this._sendResponseLocalRequestToNative(a,t,{resp:s});break}case I.N:this.sendConfigAppToNative({feature:n.b.feature},!0);break;case I.J:this._setDeviceListData(l)}}handleServerRequest(e,t,s,a){I.l.includes(t)?this._handleSocketRequest(t,s,a):I.a.includes(t)&&this._handleHTTPRequest(t,s,a)}_handleHTTPRequest(e,t,s){const a=this.processReceivedData(t);let n;switch(e){case I.i:{let{roomId:e,status:t}=a;n=c.a.lockRoom(e,t);break}case I.c:{let{roomId:e}=a;n=c.a.endRoom(e);break}case I.h:{const{roomId:e,peerId:t,srcLeave:s}=a;i.a.logInfo("Recv leave room from native: "+e+", peerId"+t+", srcLeave = "+s),n=c.a.leaveRoom(e,t);break}case I.g:{const{roomId:e,noisedId:t}=a;if("string"==typeof e&&Array.isArray(t)&&t.length){const s=t.join(",");n=c.a.shareRoom(e,s)}else i.a.logError("[apiInvite] invalid params",a),n=Promise.resolve({err:-101,mess:"Invalid params"});break}case I.e:{let{roomId:e,peerId:t}=a;n=c.a.getRoomInfo(e,t);break}case I.k:{let{roomId:e,scrollId:t}=a;n=T.a.getTranscriptOffline(e,t);break}case I.j:{let{id:e,token:t}=a;n=c.a.shareScreen(e,t);break}case I.d:{let{roomId:e,scrollId:t}=a;n=T.a.getMessageOffline(e,t);break}case I.b:{let{id:e,name:t,startTime:s}=a;n=T.a.downloadMessage({id:e,name:t,startTime:s});break}case I.f:{let{id:e,scrollId:t}=a;n=c.a.getRoomUsers(e,t);break}}n&&n.then((t=>{t&&t.constructor==Array&&t.length>=2&&(t[0]?this._handleSendRequestHttpError(s,e,t[0],a):this._handleSendRequestHttpSuccess(s,e,t[1],a))})).catch((t=>{this._handleSendRequestHttpError(s,e,t,a)}))}_handleSocketRequest(e,t,s){const a=this.processReceivedData(t);let n;switch(e){case I.v:{let{peerId:e,roomId:t,status:s,subCmd:i}=a;n=r.a.peerChangeVideoStatus(e,t,s,i);break}case I.x:{let{peerId:e,roomId:t,isMute:s,subCmd:i}=a;null!==this.peerId&&this.peerId===e&&(1===i?this.audioState=s?0:1:2===i?this.videoState=s?0:1:3===i&&(this.audioState=s?0:1,this.videoState=s?0:1)),n=r.a.peerMuteDevice(e,t,s,i);break}case I.u:{let{peerId:e,roomId:t,name:s,avatar:i,audio:o,video:l,isOwner:c}=a;n=r.a.newPeerJoin(e,t,s,i,o,l,c);break}case I.r:{let{peerId:e,roomId:t,receiver:s,ban:i}=a;n=r.a.hostKickPeer(e,t,s,i);break}case I.s:{let{peerId:e,roomId:t,receiver:s,isMute:i,subCmd:o}=a;n=r.a.hostMute(e,t,s,i,o);break}case I.t:{let{peerId:e,roomId:t,subCmd:s}=a;n=r.a.hostMuteAll(e,t,s);break}case I.A:{let{peerId:e,roomId:t,enable:s}=a;n=r.a.toggleMeetingTranscript(e,t,s);break}case I.n:{let{peerId:e,roomId:t,actionId:s}=a;n=r.a.checkMsg(e,t,s);break}case I.w:{let{peerId:e,roomId:t,name:s,avatar:i}=a;n=r.a.peerLeaveMeeting(e,t,s,i);break}case I.q:{let{peerId:e,roomId:t}=a;n=r.a.hostEndMeeting(e,t);break}case I.y:{let{roomId:e,enable:t}=a;n=r.a.raiseHand([e],t);break}case I.B:{let{peerId:e,roomId:t,status:s}=a;n=r.a.userShareScreen(e,t,s);break}case I.p:{let{roomId:e,status:t,subCmd:s}=a;n=r.a.hostChangeSetting(e,t,s);break}case I.o:{let{roomId:e,receiver:t,ban:s}=a;n=r.a.hostBanShareScreen(e,t,s);break}case I.z:{let{roomId:e,msg:t,toIds:s,actionId:i}=a;n=r.a.sendTextMessage(e,t,s,i);break}case I.m:{let{roomId:e,userId:t}=a;n=r.a.changeHost(e,t);break}}n&&n.then((t=>{this._handleSendServerRequestSuccess(s,e,t)})).catch((t=>{this._handleSendServerRequestError(s,e,t,a)}))}eventHandler(e,t){switch(e){case d.b.FETCHED_FRIEND_LIST:{const e={type:"response",command:"getFriendList",data:{friendList:t||[]}};this._sendToNative(e);break}case d.c.NETWORK_STATUS:if(t!=this.stateNetworkCur&&t!=b.m.CHECKING){this.stateNetworkCur=t;const e={status:t};this._sendLocalRequestToNative(e,I.L)}}}startListeners(e){this.isCallSupported()&&(_.a.on("call-server-request",this.handleServerRequest.bind(this)),_.a.on("call-local-request",this.handleLocalRequest.bind(this)),_.a.on("call-send-signal",this.handleSendSignal.bind(this)),_.a.on("call-request",this.handleRequest.bind(this)),_.a.on("call-update",this.handleUpdate.bind(this)),_.a.on("call-active-native-app",this.handleActiveNativeApp.bind(this)),_.a.on("pc-shutting-down",this.leaveCurrentRoom),_.a.on("stop-sharing",this._callStopSharingScreen.bind(this)),this.onLangUpdate=()=>{this._updateLanguage(u.a.getCurrentLanguageName())},u.a.callUpdate(this.onLangUpdate),this._sendInitData(e),c.a.bindCallFunc(this.joinRoom.bind(this)),c.a.bindCallManager(this),h.a.subscribe(this.eventHandler))}stopListeners(){h.a.unsubscribe(this.eventHandler)}handleActiveNativeApp(){this.isCalling()&&this._sendLocalRequestToNative(null,I.C)}isCallSupported(){return false}isCalling(){return!this.interrupted&&this.callState!==A.FREE}bindDispatch(e){this.dispatch=e}processCurrentRoom(e,t){if(this.peerId=e,this.roomId=(t||{}).id,t&&t.setting){const e=t.setting;this.profile&&t.hasOwnProperty("owner")?t.owner.id===this.profile.id?(this.audioState=e.hostAudioOn?1:0,this.videoState=e.hostVideoOn?1:0):(this.audioState=e.memberAudioOn?1:0,this.videoState=e.memberVideoOn?1:0):(this.audioState=0,this.videoState=0)}else this.audioState=0,this.videoState=0}joinRoom(e){if(this.isCalling())return this._logError("in call, reject"),[{code:m.b.ALREADY_IN_CALL,message:"already in call"},null];this.interrupted=!1;const t={type:"request",command:"joinRoom",data:{callData:e}};this._logInfo("joinRoom",t);const s=p.b.get(p.a.currentProfile);return s&&this.setProfile(s),this._sendToNative(t),[null,e]}sendPingData(e){const t={type:"recvSignal",command:"pingData",data:e};this._sendToNative(t)}sendSocketData(e){const t={type:"recvSignal",command:"socketData",data:e};if(this._logInfo("sendSocketData",t),this._sendToNative(t),t&&t.data)switch(t.data.cmd){case f.i:if(t.data.data){let e=t.data.data.id;this.peerId===e&&E.a.createInfo(u.a.str("STR_YOU_HAVE_LEFT_THE_MEETING"))}break;case f.g:case f.j:case f.e:case f.f:case f.k:case f.d:case f.h:case f.a:}}sendInterrupt(e){this.interrupted=!0;const t={type:"update",command:"interrupt",data:e};this._sendToNative(t)}endCall(e=null){const t={type:"request",command:"endCall",data:{reason:e}};this._sendToNative(t),this.leaveCurrentRoom()}endCallByRoomId(e=null,t=null){if(!e)return;const s={type:"request",command:"endCall",data:{reason:t,roomId:e}};this._sendToNative(s)}setProfile(e){this._sendInitData(e,"updateLocal","zavi-call-send-to-native")}processReceivedData(e){if(!e)return e;const t=l.a.decryptcl(e);let s=t;try{s=JSON.parse(t)}catch(a){this._logError("process failed",a)}return s}getDeviceList(){return new Promise(((e,t)=>{this.pendingResolveDeviceList=e;const s="listDevice",a={type:"request",command:s,data:null};this._logInfo("getDeviceList",JSON.stringify(a)),this._sendToNative(a);const n="call-response-"+s,i=(t,s,a)=>{const n=this.processReceivedData(a);this._setDeviceListData(n),clearTimeout(o),e(n)},o=setTimeout((()=>{_.a.removeListener(n,i),t("timeout")}),25e3);_.a.once(n,i)}))}updateDeviceList(){this._sendInitData();const e={type:"update",command:"listDevice",data:this._getDefaultDevices()};this._logInfo("update listDevice",JSON.stringify(e)),this._sendToNative(e)}_preparePayload(e){if(!e)return e;let t=e;if(e.constructor!==String)try{t=JSON.stringify(e)}catch(s){this._logError("prepareData fail",s)}return l.a.encryptcl(t)}_sendToNative(e,t="zavi-call-send-to-native"){this.isCallSupported()||(e._optional=!0);const s=this._preparePayload(e);_.a.send(t,s)}_sendInitData(e,t="init",s="zavi-call-init"){const a={type:"update",command:t,data:this._getInitialData(e),_optional:!0};this._logInfo("sendInitData",JSON.stringify(a)),this._sendToNative(a,s),e&&(this.profile=e)}_getUserMode(e){return!e||e.type!==C.a.GUEST&&e.type!==C.a.ZALO?-1:e.type}_getInitialData(e){const t=s("vbkW").remote.app.getPath("userData"),i=s("Cwh7"),o=s("TcBx"),r=o.cpus()[0],l=`${r?r.model:"NA"}|${r?r.speed:"NA"}`,c=`${o.type()}_${o.release()}_${o.platform()}_${o.arch()}|${l}`;return Object(a.a)({local:e||this.profile,osInfo:c,renderType:0,logPath:i.join(t,"call.log"),zrtcLogPath:i.join(t,"zavi"),clientVersion:n.b.apiVersion,language:u.a.getCurrentLanguageName(),userMode:this._getUserMode(e||this.profile)},this._getDefaultDevices())}_logInfo(...e){}_handleRecvSignal(e,t){this._logInfo("call-recv-signal",e,JSON.stringify(t));const s={type:"recvSignal",command:e,data:t};this._sendToNative(s)}_handleSendSignalError(e){this._logError("call-send-signal error",e)}_sendResponseLocalRequestToNative(e,t,s){const a={type:"resLocalRequest",command:t,reqId:e,data:s};this._sendToNative(a)}_handleSendServerRequestSuccess(e,t,s){this._logError("call-server-request success",s);const a={type:"resServerRequest",command:t,reqId:e,err:0};s.hasOwnProperty("err")&&(a.err=s.err),s.hasOwnProperty("data")&&(a.data=s.data),s.hasOwnProperty("subCmd")&&(a.data||(a.data={}),a.data.subCmd=s.subCmd),this._sendToNative(a)}_handleSendServerRequestError(e,t,s,n){this._logError("call-server-request error",s),t==I.y&&this._logError("Send raise hand error",s);const i={type:"resServerRequest",command:t,reqId:e,err:s.err,data:Object(a.a)({},n)};if(this._sendToNative(i),t==I.v){let{peerId:e,roomId:t,isMute:s,subCmd:a}=n;new O(e,t,s,a)}}_handleSendRequestHttpSuccess(e,t,s,a){if(s){const a={type:"resServerRequest",command:t,reqId:e,err:0,data:s};this._sendToNative(a)}}_handleSendRequestHttpError(e,t,s,a){if(t==I.c&&s&&s.code&&"ERR_NO_NETWORK"==s.code)return void v.a.endRoom(a.roomId);const n={type:"resServerRequest",command:t,reqId:e,err:s};this._sendToNative(n)}sendDataSocketServerToNative(e){const t=e.cmd,s=e.data;e&&e.hasOwnProperty("subCmd")&&(s.subCmd=e.subCmd),this._sendLocalRequestToNative(s,t)}_sendLocalRequestToNative(e,t,s=-1){const a={type:"resLocalRequest",command:t,reqId:s,data:e};this._sendToNative(a)}_setCallState(e,t){if(this._logInfo(`[tadev] change call State curr[${this.callState},${this.roomId}] => [${e},${t}]`),t&&this.roomId&&this.roomId!=t)this._logInfo("[tadev] change state for invalid id => ignore");else if(e!==this.callState){N.a.setCallState(e),h.a.send(d.a.UPDATE_STATE,{state:e,id:t});const s="string"==typeof e&&e!==A.FREE;this.dispatch&&this.dispatch({type:d.a.UPDATE_CALL_STATE,inCall:s}),this.callState=e}}_setDeviceListData(e,t=!0){this._logInfo("getDeviceList result",JSON.stringify(e)),this.deviceListData=e,localStorage.setItem(this.userId+"_deviceSettings",JSON.stringify(e)),this.videoCallHelper&&t&&(this.videoCallHelper.setDeviceListData(e),this.videoCallHelper.updateDeviceList(!1)),"function"==typeof this.pendingResolveDeviceList&&(this.pendingResolveDeviceList(this.deviceListData),this.pendingResolveDeviceList=null)}_uploadLog(e,t,a,n,o){try{if(0==o)return;if(!e)return;const r=s("evry"),l=s("Iwwi"),c=e=>{const s=new XMLHttpRequest;s.open("POST","https://qos.talk.zing.vn/api/qos/uploadcalllog",!0),s.onload=()=>{this._logInfo("sendCallLogQos: log uploaded",s.responseText)},s.onerror=e=>{this._logError("sendCallLogQos: error uploading log:",e)};let i=new FormData;i.append("call_id",t+""),i.append("owner_id",a+""),i.append("partner_id",n+""),i.append("time_stamp",Date.now()+""),i.append("duration",o+""),i.append("file",new Blob([e])),s.send(i)};l.readFile(e,((e,t)=>{!e&&t?r.gzip(t,((e,t)=>{e?i.a.logError("timeonapp: gzip failed",e):c(new Uint8Array(t))})):i.a.logDev("timeonapp: no log to send",e)}))}catch(r){this._logError("err doSendLogQos",r)}}_getDefaultDevices(){let e=localStorage.getItem(this.userId+"_deviceSettings");return e=e?JSON.parse(e):{},e}_updateLanguage(e){this._sendInitData();const t={type:"update",command:"updateLang",data:{language:e}};this._logInfo("updateLanguage",JSON.stringify(t)),this._sendToNative(t)}leaveCurrentRoom(){this.roomId&&this.peerId&&c.a.leaveRoom(this.roomId,this.peerId).then((e=>{this.roomId=null,this.peerId=null})).catch((e=>{this._logInfo("sdw failed ",JSON.stringify(e))}))}_callStopSharingScreen(e,t){this._sendLocalRequestToNative(t,I.I)}binding(e,t){this.videoCallHelper=e,this.userId=t}};t.b=y},"+qY4":function(e,t,s){"use strict";s.d(t,"i",(function(){return i})),s.d(t,"b",(function(){return o})),s.d(t,"d",(function(){return r})),s.d(t,"k",(function(){return l})),s.d(t,"f",(function(){return c})),s.d(t,"j",(function(){return d})),s.d(t,"m",(function(){return h})),s.d(t,"e",(function(){return u})),s.d(t,"c",(function(){return _})),s.d(t,"h",(function(){return m})),s.d(t,"g",(function(){return p})),s.d(t,"l",(function(){return g})),s.d(t,"a",(function(){return E}));var a=s("gCKu"),n=s("K7J0");const i=new a.a(n.e.TYPE,n.e.RENDER),o=new a.a(n.e.TYPE,n.e.CORRECT_POSITION),r=new a.a(n.e.TYPE,n.e.ON_LOAD_MORE),l=new a.a(n.e.TYPE,n.e.SWITCH_ANIMATION_STATE),c=new a.a(n.e.TYPE,n.e.PENDING_SCROLL),d=new a.a(n.e.TYPE,n.e.SCROLL_TO),h=new a.a(n.e.TYPE,n.e.UPDATE_UI_WHEN_SCROLL),u=new a.a(n.e.TYPE,n.e.ON_RAISE_ITEM),_=new a.a(n.e.TYPE,n.e.INIT),m=new a.a(n.e.TYPE,n.e.RECHARGE),p=new a.a(n.e.TYPE,n.e.PLAY_ANIMATION_CHANGE_INDEX),g=new a.a(n.e.TYPE,n.e.UPDATE_ITEMS),E=new a.a(n.e.TYPE,n.e.PREPARE_LOAD_TOP)},"+wp8":function(e,t,s){"use strict";var a=s("bxVp"),n=s("z0WU");t.a=class{constructor(){}initCache(){console.error("func waiting implement!")}_log(e,t){n.default.stagingLog(`[DB][${e}] ${t}`)}_getAllData(e,t){this._log(e,"get all"),a.f.getAll(e,t)}_getDataByIds(e,t,s){this._log(e,"get by id "+(t?t.length:0)),a.f.getByIds(e,t,s)}_saveDataToDB(e,t,s,n){this._log(e,"save data: "+(t?t.length:0)),a.f.addOrUpdate(e,t,s,n)}_removeDataItemByIdToDB(e,t,s){this._log(e,"remove data: "),a.f.remove(e,t,s)}_setDataToStorage(e,t){e&&(t?window.localStorage.setItem(e,t):window.localStorage.removeItem(e))}_getDataFromStorage(e){return e?window.localStorage.getItem(e):null}_equalObject(e,t){if(!e||e.constructor!==Object)return!1;if(!t)return!1;for(const s in e){if(!t.hasOwnProperty(s))return!1;if(t[s]&&[Array,Object].includes(t[s].constructor)){if(JSON.stringify(t[s])!==JSON.stringify(e[s]))return!1}else if(t[s]!==e[s])return!1}return!0}_equalArray(e,t){return JSON.stringify(t)===JSON.stringify(e)}_equaValue(e,t){return!t&&!e||!(!t&&e)&&(!(t&&!e)&&(t.constructor===e.constructor&&(t.constructor==Object?this._equalObject(e,t):t.constructor==Array?this._equalArray(e,t):t+""==e+"")))}_mergeData(e,t){return t?e?Object.assign(e,t):t:e}}},"+y1A":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const a=["msgId","seenUids","deliveredUids","extraJson"];class n extends class{constructor(e){let t=this;this._init=this._init.bind(this),this.__listAttrs=[],e.forEach((e=>{e&&(t.__listAttrs.push(e),Object.defineProperty(t,e,{get:()=>t["_"+e],set(s){t["_"+e]=s}}))}))}_init(e){this.__listAttrs.forEach((t=>{this[t]=e[t]}))}toJson(){let e={};return this.__listAttrs.forEach((t=>{e[t]=this["_"+t]})),e}}{constructor(e){super(a),e&&"object"==typeof e&&this._init(e)}merge(e){["seenUids","deliveredUids"].forEach((t=>{let s={};this[t]=this[t]||[],this[t].forEach((e=>s[e]=!0)),(e[t]||[]).forEach((e=>{s[e]||(this[t].push(e),s[e]=!0)}))}))}}},"/+IU":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));const a={MsgNew:"CI:Msg:New",MsgMerge:"CI:Msg:Merge",MediaNew:"CI:Media:New",MediaMerge:"CI:Media:Merge",QuoteNew:"CI:Quote:New",QuoteMerge:"CI:Quote:Merge",QuoteInputNew:"CI:QuoteInput:New",QuoteInputMerge:"CI:QuoteInput:Merge",BannerNew:"CI:Banner:New",BannerMerge:"CI:Banner:Merge",StarNew:"CI:Star:New",StarMerge:"CI:Star:Merge",ImgShowNew:"CI:Show:New",ImgShowMerge:"CI:Show:Merge",UpdateVOrient:"CI:UpdateVOrient",GC:"CI:GC"}},"/3IL":function(e,t,s){"use strict";var a=s("wx14"),n=s("Ff2n"),i=s("q1tI"),o=s.n(i),r=s("17x9"),l=s.n(r),c=s("iuhU");function d(e){const{className:t,style:s,children:i}=e,r=Object(n.a)(e,["className","style","children"]),l=Object(c.a)("w100","bs",t);return o.a.createElement("div",Object(a.a)({},r,{className:l,style:s}),i)}d.propTypes={className:l.a.string,style:l.a.object},t.a=d},"/5+7":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("sANj"),i=s("EIuX"),o=s("XS0u"),r=s("tmLI"),l=s("WZS8");function c(e){switch(e){case n.FileActionType.Params:return h.bind(null);case n.FileActionType.Init:return u.bind(null);case n.FileActionType.Progress:return _.bind(null);case n.FileActionType.Upload:return m.bind(null);case n.FileActionType.Download:return p.bind(null);case n.FileActionType.ExtraInfo:return E.bind(null);case n.FileActionType.ConversationId:return I.bind(null);case n.FileActionType.FileUrl:return f.bind(null);case n.FileActionType.IndicatorState:return T.bind(null);case n.FileActionType.LocalPath:return v.bind(null);case n.FileActionType.AutoDownloadPath:return R.bind(null);case n.FileActionType.ForwardFail:return S.bind(null);case n.FileActionType.Status:return d.bind(null);case n.FileActionType.RestoreDefault:default:return g.bind(null)}}function d(e={},t){t&&e.fileKey&&e.status&&t._updateStore(e.fileKey,{status:e.status})}function h(e={},t){t&&e.params&&e.fileKey&&t._updateStore(e.fileKey,{params:e.params})}function u(e={},t){t&&e.data&&e.id&&(t.models.validModel(e.data)?t.init({id:e.id,data:e.data}):Object(r.b)(`[FileStore][Dispatch][Init] invalid model ${JSON.stringify(e.data)}`))}function _(e={},t){if(!t)return;if(!e.fileKey&&!e.progress)return;const s=t.get(e.fileKey);s&&s.actionState&&s.actionState==n.FileActionState.None&&Object(r.b)("[FileStore][Dispatch] warning: invalid progress logic"),t._updateStore(e.fileKey,{progress:e.progress})}function m(e={},t){if(!t)return;if(!e.fileKey)return;const s=t.get(e.fileKey);s&&s.fileUrl?Object(r.b)("[FileStore][Dispatch] warning: invalid upload logic"):t._updateStore(e.fileKey,{actionState:n.FileActionState.Upload,progress:0,extraInfo:{sendFileError:null,cancelUpload:!1}})}function p(e={},t){t&&e.fileKey&&t._updateStore(e.fileKey,{actionState:n.FileActionState.Download,progress:0,extraInfo:{downloadError:null,downloadTime:Date.now()}})}function g(e={},t){t&&e.fileKey&&t._updateStore(e.fileKey,n.FileDefaultStoreData)}function E(e={},t){if(t&&e.fileKey&&e.extraInfo){const s=t.get(e.fileKey)||{},{fileUrl:a,extraInfo:i}=s,{cancelUpload:o,sendFileError:c,downloadError:d}=e.extraInfo;if(a&&(o||c))return void Object(r.b)("[FileStore][Reducer] warning: fileUrl exist but still update invalid stale extraInfo");t._updateStore(e.fileKey,{extraInfo:e.extraInfo}),d&&Object(r.j)(d)&&T({fileKey:e.fileKey,indicatorState:l.a.on(0,n.IndicatorType.Expired)})}}function f(e={},t){t&&e.fileKey&&t._updateStore(e.fileKey,{fileUrl:e.fileUrl,extraInfo:{cancelUpload:!1,sendFileError:null}})}function I(e={},t){t&&e.fileKey&&t._updateStore(e.fileKey,{conversationId:e.conversationId})}function T(e={},t){if(!t)return;if(!e.fileKey)return;t._updateStore(e.fileKey,{indicatorState:e.indicatorState})}function v(e={},t){if(!t)return;if(!e.fileKey||!e.extraInfo)return;if(t._updateStore(e.fileKey,{extraInfo:e.extraInfo})){const s=t.getMsgIdFromStore(e.fileKey);if(s){const{folderPath:n,localPath:r}=e.extraInfo,l={},c=[];Object(i.A)(t.get(e.fileKey))?(l.folderPath=n||"",c.push("folderPath")):(l.localPath=r||"",c.push("localPath")),o.default.updateFile(s,Object(a.a)(Object(a.a)({},l),{},{msgId:s}),c),o.default.updateMessage(s,Object(a.a)(Object(a.a)({},l),{},{msgId:s}),c)}}}function R(e={},t){t&&e.fileKey&&t._updateStore(e.fileKey,{extraInfo:e.extraInfo})}function S(e={},t){t&&e.fileKey&&t._updateStore(e.fileKey,{extraInfo:e.extraInfo})}var O=s("PoHQ"),N=s("NDmK");function b(e){return function(e){if(Array.isArray(e)&&e.length>0)return e.map((e=>e&&"string"!=typeof e?JSON.stringify(e):e));if(e instanceof Object){let t=Object(a.a)({},e);for(let e in t)t[e]&&"string"!=typeof t[e]&&(t[e]=JSON.stringify(t[e]));return t}return e&&"string"!=typeof e?JSON.stringify(e):e}(e)}function C(e){if(!e)return"";let t=e.split(".");return 1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()}function A(e){let t=e.cliMsgId||e.clientId;if(!t)return"";const s=O.default.getSessionUserId();let a="0"==e.fromUid?s:e.fromUid,n="0"==e.toUid?s:e.toUid;return n||(n=e.userId||"undefined"),n!=N.c.sendToMeId||a||(a=s),t+"_"+a+"_"+n}var y={mergeShallowRight:function(e,t){if(null==e)return t===e;if(null==t)return e===t;for(const s in t)if(!(s in e))return!0;return!1},equalityFnShallow:function(e,t){if(null==e)return t===e;if(null==t)return e===t;for(const s in e)if(!(s in t)||e[s]!==t[s])return!1;for(const s in t)if(!(s in e)||e[s]!==t[s])return!1;return!0},equalityFn:function(e,t){return function(e,t){return e===t}(e,t)},equalityFnJSON:function(e,t){return function(e,t){return JSON.stringify(e)===JSON.stringify(t)}(e,t)},getPrimaryId:function(e){return A(e)},getPrimaryIdFromQuote:function(e,t){const s=O.default.getSessionUserId();let a="0"==(null==e?void 0:e.cliMsgId)?s:null==e?void 0:e.cliMsgId;a=0==a?s:a;let n=(null==e?void 0:e.ownerId)||(null==e?void 0:e.fromUid);return n=0==n?s:n,`${a}_${n}_${t}`},getPrimaryIdFromTopic:function(e,t){var s,a,n,i;const o=O.default.getSessionUserId();let r=null!=(s=null==e||null===(a=e.params)||void 0===a?void 0:a.client_msg_id)?s:null==e||null===(n=e.params)||void 0===n?void 0:n.cliMsgId;r=0==r?o:r;let l=null==e||null===(i=e.params)||void 0===i?void 0:i.senderUid;return l=0==l?o:l,`${r}_${l}_${t}`},normalize:b,getAllMessageIds:function(e){return function(e){if("object"!=typeof e)return[];return{p:A(e),s:e.msgId}}(e)},getMessageFileParams:function(e){return function(e){let t={};if(e)if(e.message&&e.message.params){try{const s=JSON.parse(e.message.params),a=e.subType==n.MSG_TYPE.MSG_FOLDER?n.FileMsgType.Folder:n.FileMsgType.File,i=((s.fileExt?s.fileExt:C(e.message.title||s.name))||"").toLowerCase();t={title:s.name||"",fileSize:s.fileSize,fileExt:i,fType:s.fType||a,fdata:s.fdata,checksum:s.checksum}}catch(s){}e.message.title&&!t.title&&(t.title=e.message.title)}else if(e.isErrorInfo){const s=e.message,a=e.subType==n.MSG_TYPE.MSG_FOLDER?n.FileMsgType.Folder:n.FileMsgType.File,i=((a==n.FileMsgType.Folder?"folder-normal":C(s))||"").toLowerCase();t={fileSize:e.fileSize,title:s,fileExt:i,fType:a}}else if(e.resend&&e.resend.content&&Array.isArray(e.resend.content.files)){const s=e.resend.content.files[0];if(s){const a=s.name||"",i=e.subType==n.MSG_TYPE.MSG_FOLDER?n.FileMsgType.Folder:n.FileMsgType.File,o=((i==n.FileMsgType.Folder?"folder-normal":C(a))||"").toLowerCase();t={fileSize:s.size,title:a,fileExt:o,fType:i}}}else if(n.isWeb&&e.__blockResend){const s=e.message||"";t={fileSize:e.fileSize||0,title:s,fileExt:C(s)||"",fType:n.FileMsgType.File}}return JSON.stringify(t)}(e)},getKeyByValue:function(e,t){return function(e,t){if(!e||!t)return"";t=b(t);let s="",a=[];if("function"==typeof Object.keys)a=Object.keys(e);else for(let n in e)a.push(n);return a.length<=0?"":(s=a.find((s=>e[s].p===t||[].concat(e[s].s).includes(t))),s||"")}(e,t)},getMessageConversationId:function(e){if("object"!=typeof e)return"";if(e.resend){if(e.resend.conversationId)return e.resend.conversationId;Object(r.b)(`[FileStore][Init] message.resend invalid, ${e.cliMsgId}`)}else{if(e.toUid)return e.toUid;if(e.userId)return e.userId;Object(r.b)(`[FileStore][Init] message.toUid invalid, ${e.cliMsgId}`)}},getFileMessageUrl:function(e){if("object"==typeof e)return e.message&&e.message.href?e.message.href:void 0},getFileMessageIndicatorState:function(e){if("object"==typeof e)return e.message&&e.message.indicatorState?e.message.indicatorState:void 0},getFolderPath:function(e){return function(e){const{message:t}=e;return e.folderPath?e.folderPath:t&&t.folderPath?t.folderPath:""}(e)},getLocalPath:function(e){return function(e){const{message:t}=e;return e.localPath?e.localPath:t&&t.localPath?t.localPath:""}(e)},getMessageObjectFileParams:function(e){return function(e){if("object"!=typeof e)return{};const t=e.content.files[0];if(t){const s=e.subType==n.MSG_TYPE.MSG_FOLDER?n.FileMsgType.Folder:n.FileMsgType.File,a=t.name||"",i=s==n.FileMsgType.Folder?"folder-normal":C(a);return{fileSize:t.size,title:a,fileExt:i,fType:s}}return{}}(e)},safeParseJSON:function(e){return function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return}else if("object"==typeof e)return Object(a.a)({},e);return}(e)},validateId:function(e){return function(e){if(!e)return{};const{p:t,s:s}=e;let a={};const n=b(t),i=b(s);"string"==typeof n&&(n.includes("undefined")||n.includes("null")?Object(r.b)("[FileStore][ValidateId] warning: undifined Pid"):a.p=n);"string"==typeof i&&(i.includes("undefined")||i.includes("null")?Object(r.b)("[FileStore][ValidateId] warining: undifined Sid"):a.s=i);return a}(e)},getFileMessageStatus:function(e){if("object"==typeof e)return e.status?e.status:void 0}};var D=class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.status=d,this.extraInfo=Object.assign({},l),void 0!==c&&(this.indicatorState=c),this._name="FileStoreModel"}};var M=class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.status=d,this.extraInfo=Object.assign({},l),void 0!==c&&(this.indicatorState=c),this._name="FileChatModel"}};var P=class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.extraInfo=Object.assign({},l),this.status=d,void 0!==c&&(this.indicatorState=c),this._name="FileQuoteModel"}};var w=class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.extraInfo=Object.assign({},l),this.status=d,void 0!==c&&(this.indicatorState=c),this._name="FileStarModel"}};var L=class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,params:i,progress:o,extraInfo:r,indicatorState:l,status:c}=t;this.actionState=s,this.conversationId=a,this.lastUpdate=Date.now(),this.params=i,this.progress=o,this.extraInfo=Object.assign({},r),this.status=c,void 0!==l&&(this.indicatorState=l),this._name="FileBannerModel"}};const k={FileStoreModel:D,FileChatModel:M,FileQuoteModel:P,FileStarModel:w,FileBannerModel:L,FileChatBoxInfoModel:class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.extraInfo=Object.assign({},l),this.status=d,void 0!==c&&(this.indicatorState=c),this._name="FileChatBoxInfoModel"}},FileSearchItemModel:class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.extraInfo=Object.assign({},l),this.status=d,void 0!==c&&(this.indicatorState=c),this._name="FileSearchItemModel"}},FileConvSearchItemModel:class{constructor(e){const t=Object.assign({},n.FileDefaultStoreData,e),{actionState:s,conversationId:a,fileUrl:i,params:o,progress:r,extraInfo:l,indicatorState:c,status:d}=t;this.actionState=s,this.conversationId=a,this.fileUrl=i,this.lastUpdate=Date.now(),this.params=o,this.progress=r,this.extraInfo=Object.assign({},l),this.status=d,void 0!==c&&(this.indicatorState=c),this._name="FileConvSearchItemModel"}}};var x=Object(a.a)(Object(a.a)({},k),{},{validModel:function(e){try{return k[e._name]===e.constructor}catch(t){return!1}}}),U=s("NMlV");const F=new class{constructor(){this._map={},this._holder={},this._idMap={},this._idMapS={},this.constants=n,this.utils=y,this.models=x}_clearStore(){this._map={},this._holder={},this._idMap={},this._idMapS={}}removeFileKeyIdMap(e){return this._removeFileKeyMap()}_removeFileKeyIdMap(e){e&&(e=this.utils.normalize(e),delete this._idMap[e])}setFileId(e,t){return this._setFileId(e,t)}_setFileId(e,t){if(e&&t)if(e=this.utils.normalize(e),t=this.utils.normalize(t),this._idMap[e]){const{p:s,s:a}=this._idMap[e],n=t.p,i=t.s;if(s){if(a){if(s&&a){if(n!=s)return;i!=a&&(this._idMap[e].s=[].concat(this._idMap[e].s,i),this._idMapS[i]=s)}}else if(s)if(n){if(n!=s)return;i&&(this._idMap[e]=Object.assign({},this._idMap[e],t))}else i&&(this._idMap[e]=Object.assign({},this._idMap[e],t))}else if(a){if(a!=i)return;n&&(this._idMap[e]=Object.assign({},this._idMap[e],t))}}else this._idMap[e]=t}getFileKey(e){return this._getFileKey(e)}_getFileKey(e){if(e=this.utils.normalize(e))return this.utils.getKeyByValue(this._idMap,e)}getFileId(e){return this._getFileId(e)}_getFileId(e){return e?(e=this.utils.normalize(e),this._idMap[e]?Object(a.a)({},this._idMap[e]):null):null}updateFileId(e,t){return this._updateFileId(e,t)}_updateFileId(e,t){e=this.utils.normalize(e),t=this.utils.normalize(t),e&&t&&this.setFileId(this._getFileKey(e),t)}_mapHolder(e,t){e&&t&&e!=t&&this._holder[e]&&this._holder[t]&&(this._holder[e]=Object.assign({},this._holder[e],this._holder[t]),delete this._holder[t])}getFileKeyByMessage(e){return this._getFileKeyByMessage(e)}_getFileKeyByMessage(e){if("object"!=typeof e)return"";const t=this.utils.getAllMessageIds(e);let s="";for(let a in t)if(s=this._getFileKey(t[a]),s)break;return s}set(e,t){return this._set(e,t)}_set(e,t){if(e&&(e=this.utils.normalize(e),!this._map[e]&&"object"==typeof t)){const{FileStoreModel:s}=this.models;this._map[e]=new s(Object(a.a)({},t))}}get(e){return this._get(e)}_get(e){return e?(e=this.utils.normalize(e),Object(a.a)({},this._map[e])):null}__get(e){return e?(e=this.utils.normalize(e),this._map[e]):null}update(e,t){return this._update(e,t)}_update(e,t){if(!e||!t)return!1;e=this.utils.normalize(e);let s=this.__get(e),a=!1;if(s&&"object"==typeof t)for(let i in t)t.hasOwnProperty(i)&&(n.FileDefaultStoreDataShallowCompare.includes(i)?(s[i]=Object.assign({},s[i],t[i]),a=!0):this.utils.equalityFn(s[i],t[i])||(s[i]=t[i],a=!0,Object(r.b)(`[FileStore][Update] ${i}, ${JSON.stringify(t)}`)));return a}remove(e){return this._remove(e)}_remove(e){e&&(this.utils.normalize(e),delete this._map[e])}getStoreByMessage(e){return this._getStoreByMessage(e)}_getStoreByMessage(e){const t=this._getFileKeyByMessage(e);return this.get(t)}subscribeById(e,t){return this._subscribeById(e,t)}_subscribeById(e,t){if(!e||!t)return;const s=this._getFileKey(e);if(s)return this.subscribe(s,t);{const s=U.a.next(),a=this.subscribe(s,t);return this.init({id:e,data:n.FileDefaultStoreData,fileKey:s}),this.notify(s,this.get(s)),a}}subscribe(e,t){return this._subscribe(e,t)}_subscribe(e,t){if(!e||"function"!=typeof t.fn)return;e=this.utils.normalize(e);const s=U.a.next();return this._holder[e]||(this._holder[e]={}),this._holder[e][s]=t,t.fn(this.get(e)),s}unsubscribe(e,t){this._unsubscribe(e,t)}_unsubscribe(e,t){if(!e||!t)return;e=this.utils.normalize(e),t=this.utils.normalize(t);let s=this._holder[e];s?s[t]&&(s[t]=null,delete s[t]):Object(r.b)(`[FileStore][Unsubscribe] key not valid ${e}`),this._holder[e]}notify(e,t){return this._notify(e,t)}_notify(e,t){if(!e)return;Object(r.b)(`[FileStore][Notify] ${e}, ${t}`),e=this.utils.normalize(e);let s=Object(a.a)({},this._holder);Date.now();try{let n=Object(a.a)({},s[e])||{};for(let s in n)if(n[s]){let a=!1,i=this._getDefaultDispatchData(e);if(n[s].options&&n[s].options.subs){n[s].options.subs.forEach((e=>{t&&t[e]&&(i[e]=t[e],a=!0)}))}else a=!0,i=this._get(e);a&&"function"==typeof n[s].fn&&n[s].fn(i)}}catch(n){}Date.now()}_getDefaultDispatchData(e){if(!e)return{};let t={};const s=this.get(e);for(let a in n.FileDefaultStoreDispatchData)s.hasOwnProperty(a)&&(t[a]=s[a]);return t}merge(e,t){return this._merge(e,t)}_merge(e,t){if(!e||!t)return;e=this.utils.normalize(e);let s=this.__get(e),a=!1;if(s)for(let i in t)t.hasOwnProperty(i)&&(n.FileDefaultStoreDataShallowCompare.includes(i)?this.utils.mergeShallowRight(s[i],t[i])&&(s[i]=Object.assign({},s[i],t[i]),a=!0,Object(r.b)(`[FileStore][Merge] ${i}, ${JSON.stringify(t)}`)):void 0===s[i]&&(s[i]=t[i]));else Object(r.b)(`[FileStore][Merge] warning: fileKey ${e} don't have store -> merge new data`),s[e]=Object.assign({},t[e]);return a}init(e){return this._init(e)}_init(e){if(!e.id)return;const{p:t,s:s}=this.utils.validateId(e.id);let a="";if(t){const e=this._getFileKey(t),i=this._get(e);if(s){if(this._idMapS[s]&&this._idMapS[s]!=t)return void Object(r.b)("[FileStore][Init][Error] warning: invalid logic 1");const o=this._getFileKey(s),l=this._get(o);i?l?a=e==o?n.StoreInitType.Merge:n.StoreInitType.InitMerge:(Object(r.b)("[FileStore][Init][Error] warning: invalid logic 4"),a=n.StoreInitType.Merge):a=l?n.StoreInitType.InitMerge:n.StoreInitType.Init}else a=i?n.StoreInitType.Merge:n.StoreInitType.Init}else{if(!s)return void Object(r.b)("[FileStore][Init][Error] warning: invalid logic 2");a=this._get(this._getFileKey(s))?n.StoreInitType.Merge:n.StoreInitType.Init}a&&(e.initType=a,this.__init(e))}__initInit(e){const{id:t}=e,{p:s,s:a}=t,i=e.key?e.key:U.a.next();e.data||(e.data=n.FileDefaultStoreData),a&&s&&!this._idMapS[a]&&(this._idMapS[a]=s),this.setFileId(i,e.id),this.set(i,e.data)}__initMerge(e){const{id:t}=e,{p:s,s:a}=t,n=this._getFileKey(s)||this._getFileKey(a);n&&(this._merge(n,e.data)&&this.notify(n,this.get(n)),a&&s&&!this._idMapS[a]&&(this._setFileId(n,t),this._idMapS[a]=s))}__initInitMerge(e){const{id:t}=e,{p:s,s:n}=t,i=this._getFileKey(s),o=this._get(i),l=this._getFileKey(n),c=this._get(l);if(i!=l)if(o)c?(this._remove(l),this._removeFileKeyIdMap(l),this._setFileId(i,t),this._mapHolder(i,l),this.__initMerge(e)):this.__initMerge(e);else if(c){const i=this.getFileId(l);let o=Object(a.a)({},e);i.p?i.p!=s&&(this.__initInit(e),o.id={p:i.p,s:n}):this._setFileId(l,t),this.__initMerge(e)}else Object(r.b)("[FileStore][Init][Error] warning: __initInitMerge wrong")}__init(e){const{initType:t}=e;switch(t){case n.StoreInitType.Init:Object(r.b)("[FileStore][Init] InitType Init"),this.__initInit(e);break;case n.StoreInitType.InitMerge:Object(r.b)("[FileStore][Init] InitType InitMerge"),this.__initInitMerge(e);break;case n.StoreInitType.Merge:Object(r.b)("[FileStore][Init] InitType Merge"),this.__initMerge(e);break;default:Object(r.b)("[FileStore][Init][Error] warning: InitType invalid")}}initByMessage(e,t){return this._initByMessage(e,t)}_initByMessage(e,t){if("object"!=typeof e)return;const s=this.utils.getAllMessageIds(e);this._getFileKeyByMessage(e)||this.init({id:s,data:t.data})}_updateStore(e,t){const s=this.update(e,t);return s&&this.notify(e,t),s}dispatch(e,t){return this._dispatch(e,t)}_dispatch(e,t){t&&(Object(r.b)(`[FileStore][Dispatch] ${e}, ${JSON.stringify(t)}`),c(e)(t,this))}getMsgIdFromStore(e){return this._getMsgIdFromStore(e)}_getMsgIdFromStore(e){return this._idMap[e]&&this._idMap[e].s}};t.a=F},"/7c0":function(e,t,s){"use strict";var a=s("rePB"),n=s("bxVp");var i=class{constructor(e,t){Object(a.a)(this,"db",void 0),Object(a.a)(this,"mainStore",void 0),Object(a.a)(this,"userId",void 0),this.db=e,this.mainStore=t}setUserId(e){this.userId=e}update(e,t,s,a,i){n.f.update(this.mainStore,e,t,s,a,i)}remove(e){return new Promise((t=>{n.f.remove(this.mainStore,e,t)}))}},o=s("4c4j"),r=s("mE25"),l=s("P6UB");const c=()=>{};var d=class extends i{getMessageFromConversationByLimit(e,t){const{sendDttm:s,msgId:a,count:i,numberPerBatch:r,inclusive:l,fPredicate:d,fIsAbortInternal:h,onProgressInternal:u}=t;return new Promise(((t,_)=>{this.db.runTransaction([this.mainStore],(o=>{let c=o[0];c&&c.getObjectsByIndexV2(n.c,[[e,"",""],[e,s,a]],i,r,n.b.PREV,l,d,h,u).then((e=>{t(e)})).catch((e=>{_(e)}))}),c,c,o.ZDB.TransMode.READONLY)}))}getNextMessageFrom(e,t,s){const{ts:a,count:i,include:o,fPredicate:l}=s;return new Promise(((s,c)=>{this.db.iterate(this.mainStore,n.c,{low:[e,a+"",t],high:[e,r.b,r.a],excludeLow:!o,excludeHigh:!o},n.b.NEXT,(e=>(l&&(e=l(e)),s(e))),c,i)}))}getLastMessageFrom(e,t,s){const{ts:a,count:i,include:o,fPredicate:r}=s;return new Promise(((s,l)=>{this.db.iterate(this.mainStore,n.c,{low:[e,"",""],high:[e,a+"",t],excludeLow:!o,excludeHigh:!o},n.b.PREV,(e=>{e&&r&&(e=r(e)),s(e)}),l,i)}))}getMessageByMsgId(e,t){return new Promise(((t,s)=>{if(!e)return s("Invalid MsgId");this.db.get(this.mainStore,e,t,s)}))}addMessage(e){return new Promise(((t,s)=>{if(!e.msgId)return s("Invalid MsgId");this.db.add(this.mainStore,e,t,s)}))}deleteMessageByMsgId(e,t){return new Promise(((t,s)=>{if(!e)return s("Invalid MsgId");this.db.remove(this.mainStore,e,t)}))}async getPreviewMessage(e){if(!e)throw{error:"Invalid params"};return new Promise(((t,s)=>{let a;this.db.runReadTransaction([this.mainStore],(i=>{i[0].getObjectsByIndex(n.c,[[e,"",""],[e,r.b,r.a]],1,n.b.PREV,!0,(e=>(!a&&e&&(a=e),l.b.isValidPreviewMessage(e)))).then((e=>{var s;t({previewMsg:e?e[0]:a,actualLastMsgId:null===(s=a)||void 0===s?void 0:s.msgId})})).catch((e=>{s(e)}))}))}))}async getFirstMessage(e){if(!e)throw{error:"Invalid params"};return new Promise(((t,s)=>{this.db.runReadTransaction([this.mainStore],(a=>{a[0].getObjectsByIndex(n.c,[[e,"",""],[e,r.b,r.a]],1,n.b.NEXT,!0).then((e=>{t({firstMsg:e?e[0]:undefined})})).catch((e=>{s(e)}))}))}))}getMessageByCliIdOwnerId(e,t,s){return new Promise(((a,i)=>{this.db.runReadTransaction([this.mainStore],(o=>{const[r]=o;r.getObjectsByIndex(n.e,[e,e],1,n.b.PREV,!0,(a=>{const n=!s||a.fromUid==s;return a.cliMsgId==e&&n&&a.toUid==t})).then((e=>e&&e.length?a(e[0]):a(null))).catch((e=>i(e)))}))}))}},h=s("z0WU");var u=class extends i{addOrUpdateInTransaction(e){return new Promise(((t,s)=>{this.db.addOrUpdateInTransaction(this.mainStore,e.userId,(t=>e),(e=>{t(e)}),(e=>{h.default.logCoreError("cross update conversation error",e),s(e)}))}))}update(e,t){return new Promise(((s,a)=>{this.db.update(this.mainStore,e.userId,t,e,s,a)}))}getAllConversations(){return new Promise((e=>{h.default.stagingLog("[DB][Conversation] Trigger db get all conversations"),this.db.getAll(this.mainStore,(t=>{e(t)}))}))}getConversation(e){return new Promise(((t,s)=>{h.default.stagingLog(`[DB][Conversation] Trigger db get conversation by ID ${e}`),this.db.get(this.mainStore,e,t,s)}))}addIfNotExists(e){return new Promise(((t,s)=>{this.db.addIfNotExists(this.mainStore,e,t,s)}))}};s("hAkD");const _=new class{constructor(){Object(a.a)(this,"_messageDBHandler",void 0),Object(a.a)(this,"_conversationDBHandler",void 0)}setCredentials(e,t){}get messageDBHandler(){return this._messageDBHandler||(this._messageDBHandler=new d(n.f,n.d.MESSAGE)),this._messageDBHandler}get conversationDBHandler(){return this._conversationDBHandler||(this._conversationDBHandler=new u(n.f,n.d.CONVERSATION)),this._conversationDBHandler}};t.a=_},"/Bne":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("z0WU"),i=s("1pet"),o=s("LV1a"),r=s("DPHK"),l=s("NDmK"),c=s("/YHU");const d=new class{_isHttp(e){return String(e).trim().toLowerCase().startsWith("http")}_parsePhotoParams(e){var t;let s;return this._isHttp(e)||(s=Object(c.a)(e)),null!=(t=s)?t:{}}_normalizeMessageJSON(e,t){switch(t){case i.MSG_PHOTO:case i.MSG_GIF:let t=e.content.href,d="";if(e.content.params){let a=null;try{if(a=this._parsePhotoParams(e.content.params),t=a.hd||t,d=a.hd,a&&void 0===a.rotation){let s=o.a.get(e.content.thumb)||o.a.get(t)||o.a.get(e.content.href);!s||void 0===s.rotation&&void 0===s.flip||(a.rotation=s.rotation,a.flip=s.flip,e.content.params=JSON.stringify(a))}}catch(s){}}return{title:e.content.title,description:e.content.description,childnumber:e.content.childnumber,action:e.content.action,params:e.content.params,type:e.content.type,thumbUrl:e.content.thumb,oriUrl:t,hdUrl:d,normalUrl:e.content.href};case i.MSG_VIDEO:{let t=Object(c.a)(e.content.params,{});return{action:e.content.action,description:e.content.description,childnumber:e.content.childnumber,duration:t.duration,params:e.content.params,oriUrl:e.content.href,thumbUrl:e.content.thumb,title:e.content.title,type:e.content.type}}case i.MSG_LOCATION:{let t=JSON.parse(e.content.params);return{action:e.content.action,desc:e.content.description,childnumber:e.content.childnumber,href:e.content.href,lat:t.latitude,lo:t.longitude,thumb:e.content.thumb,title:e.content.title,type:e.content.type}}case i.MSG_DOODLE:return e.content.oriUrl=e.content.href,delete e.content.href,e.content;case i.MSG_TEXT:return e.content;case i.MSG_ECARD:{let t=JSON.parse(e.content.params);return{action:e.content.action,description:e.content.description,childnumber:e.content.childnumber,href:e.content.href,params:t,thumb:e.content.thumb,title:e.content.title,type:e.content.type,versionEcardNewFr:e.content.type==i.ECARD_TYPE.FRIEND_ACCEPT||e.content.type==i.ECARD_TYPE.FRIEND_ACCEPT_PASSIVE?i.VERSION_ECARD_NEW_FR:0}}case i.MSG_TODO:if(e&&e.eventInfo&&e.message)return{message:e.message,params:Object(a.a)(Object(a.a)({},e.content),{},{params:Object(a.a)({},e.eventInfo.updateInfo)})};case i.MSG_FILE:if(!(e&&e.content&&e.content.title))return e.content;try{let t=e.content.title;if(e.content.params){let s=JSON.parse(e.content.params);return s.fileExt=s.fileExt.toLowerCase(),s&&s.fileExt?(!s.fileExt||l.c.unsupportFile.includes(s.fileExt)||e.content.title.toLowerCase().endsWith("."+s.fileExt)||(t=e.content.title+"."+s.fileExt),Object(a.a)(Object(a.a)({},e.content),{},{title:t})):e.content}return e.content}catch(r){return e.content}default:return n.default.log(e.msgType),e.content}}_normalizeRecommendMsgSubType(e){switch(e){case"recommened.link":case"recommened.user":case"recommened.stickerset":case"recommened.vip":case"recommened.misscall":case"recommened.calling":case"recommened.receivecall":case"recommened.calltime":return i.MSG_CONTACT;default:return n.default.log("Invalid recommended message type: "+e),i.MSG_UNKNOWN}}transformMessageFromServer(e,t){if(!e)return void 0;let s=this._normalizeMessageType(e.msgType);s==i.MSG_TEXT&&e.content&&e.content.constructor==Object&&"msginfo.actionlist"===e.content.action?s=i.MSG_INFO_CHAT:"chat.recommended"==e.msgType&&e.content&&(s=this._normalizeRecommendMsgSubType(e.content.action));let a={actionId:e.actionId,msgId:e.msgId+"",zglobalMsgId:e.zglobalMsgId,cliMsgId:e.cliMsgId+"",msgType:s,status:e.status,notify:e.notify,mentions:e.mentions,quote:e.quote,message:this._normalizeMessageJSON(e,s),sendDttm:e.ts,serverTime:e.serverTs||e.ts,fromUid:e.uidFrom,toUid:t,dName:e.dName,localDttm:r.a.getCurrentUnixTimeInMili(),properties:e.propertyExt,ttl:e.ttl,refMessageId:e.refMessageId,st:e.st||0===e.st?e.st:-1,at:e.at||0===e.at?e.at:-1,cmd:e.cmd||0===e.cmd?e.cmd:-1,originMsgType:e.msgType||""};return e.specialMsgType&&(a.urgency=e.specialMsgType),a}_normalizeMessageType(e){return n.default.normalizeMessageType(e)}};t.a=d},"/DvM":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("q1tI"),i=s.n(n),o=s("lCMA"),r=s("c51z"),l=s("1pet"),c=(s("egaF"),s("AM4K")),d=s("6uTC"),h=s("Q8hM"),u=s("z0WU"),_=(s("JDqX"),s("nUVR")),m=s("Jmku"),p=s("v/qp"),g=s("zRkS");class E extends i.a.Component{constructor(e){super(e);let{year:t,month:s,currentDate:a,hour:n,min:i}=this.__p(this.props);this.state={year:t,month:s,currentDate:a,hour:n,min:i,dateMap:[],showTimeSuggest:!1,forceHoverTime:!1,bodyShown:!1,isFocusTime:!1,invalidDate:!1,invalidTime:!1},this.onPageClick=this.onPageClick.bind(this),this.onClearDateTime=this.onClearDateTime.bind(this),this.close=this.onClose.bind(this),this.focusTime=this.focusTime.bind(this)}componentWillReceiveProps(e){let t=this.props.initDateTime,s=e.initDateTime;t&&s?t.getTime()!==s.getTime()&&this.setState(this.__p(e),(()=>{this.generateMonth(s.getFullYear(),s.getMonth())})):!!t!=!!s&&this.setState(this.__p(e),(()=>{let e=s;s||(e=new Date),this.generateMonth(e.getFullYear(),e.getMonth())}))}componentDidMount(){var e;(window.addEventListener("click",this.onPageClick),this.props.bodyOnly)?this.generateMonth(this.state.year,this.state.month):m.a.on("beforeClose",null===(e=this.props.popoverProps)||void 0===e?void 0:e.identity,(()=>{this.setState({bodyShown:!1}),this.onBlurTimeInputv2()}));if(this.props.bodyOnly){if(this.timeInput){let{hour:e,min:t}=this.state;this.timeInput.setValue(`${this.getTimeString(e)}:${this.getTimeString(t)}`)}if(this.dateInput){let{currentDate:e}=this.state;if(e){let{date:t}=e,s=`${this.getTimeString(t.getDate())}/${this.getTimeString(t.getMonth()+1)}/${t.getFullYear()}`;this.dateInput.setValue(s)}}}}componentWillUnmount(){var e;(window.removeEventListener("click",this.onPageClick),this.onCloseTimeSuggest(),this.onClose(),this.props.bodyOnly)||m.a.removeListener("beforeClose",null===(e=this.props.popoverProps)||void 0===e?void 0:e.identity,(()=>{this.setState({bodyShown:!1})}))}__p(e){if(!e)return;let{hour:t,min:s}=this.__getInitHourMin(e),a=null,n=null;return e.initDateTime?(n=this.__getDateItem(e.initDateTime),a=new Date(e.initDateTime)):a=new Date,{year:a.getFullYear(),month:a.getMonth(),currentDate:n,hour:t,min:s}}getDayInMonth(e,t){return new Date(e,t,0).getDate()}generateMonth(e,t){let s=this.getDayInMonth(e,t+1),a=[];for(let n=1;n<=s;n++){let s=new Date(e,t,n);a.push({solarDay:n,weekday:s.getDay(),date:s})}if(a&&a.length>0){let s=a[0];if(s){let n=s.weekday,i=this.getDayInMonth(e,t);for(let s=0;s<n;s++){let o=i-s,r={solarDay:o,weekday:n-s-1,date:new Date(e,t-1,o)};a.splice(0,0,{outside:r})}}let n=a[a.length-1];if(n){let s=n.weekday+1,i=1;const o=7;s===o&&a.length<42&&(s=0);for(let n=s;n<o;n++){let r={solarDay:i,weekday:n,date:new Date(e,t+1,i)};a.push({outside:r}),i++,a.length<42&&n===o-1&&(n=-1,s=0)}}}this.setState({dateMap:a})}onChangeMonth(e,t){t&&(t.stopPropagation(),t.preventDefault());let s=this.state.month,a=this.state.year;!0===e?s++:s--,s<0?(s=11,a--):s>11&&(s=0,a++),a>9999&&(a=9999),this.setState({year:a,month:s}),this.generateMonth(a,s)}onShow(e){if(!0===this.state.bodyShown)return void this.onClose();if(this.props.bodyOnly)return;this.generateMonth(this.state.year,this.state.month);let t=Date.now();if(this.state.currentDate&&this.state.currentDate.date){t=this.state.currentDate.date.getTime()}var s;(this.prepareSuggestTime(t),this.props.bodyOnly)||m.a.openPopover(Object(a.a)(Object(a.a)({},null===(s=this.props.popoverProps)||void 0===s?void 0:s.identity),{},{anchorEvent:e}));this.setState({bodyShown:!0},(()=>{if(this.timeInput){let{hour:e,min:t}=this.state;this.timeInput.setValue(`${this.getTimeString(e)}:${this.getTimeString(t)}`)}if(this.dateInput){let{currentDate:e}=this.state;if(e){let{date:t}=e,s=`${this.getTimeString(t.getDate())}/${this.getTimeString(t.getMonth()+1)}/${t.getFullYear()}`;this.dateInput.setValue(s)}}}))}onClose(e){var t;this.props.bodyOnly||(e&&(e.preventDefault(),e.stopPropagation()),m.a.closePopover(null===(t=this.props.popoverProps)||void 0===t?void 0:t.identity),this.onPopupClose())}onPopupClose(){this.props.onShowBody&&this.props.onShowBody(!1),this.setState({bodyShown:!1})}onPageClick(e){e.target!==window&&this.timeSuggestList&&e.target.compareDocumentPosition(this.timeSuggestList)&Node.DOCUMENT_POSITION_CONTAINS||this.onCloseTimeSuggest()}onSelectDate(e,t){if(!t)return;if(t.outside){let e=this.state.month,s=this.state.year,a=t.outside.date;if(a){let t=a.getMonth(),n=a.getFullYear();return void this.onChangeMonth(e<t||s<n)}}e&&(e.stopPropagation(),e.preventDefault());let s=(e=>e?e.outside&&e.outside.date?e.outside.date:e.date:null)(t);if(s){if(1===u.default.compareDate(s,this.getMinValidDate())&&this.getMinValidDate())return;if(1===u.default.compareDate(this.getMaxValidDate(),s)&&this.getMaxValidDate())return}if(this.props.maxValidTimeValue&&s){let e=this.state.hour,t=this.state.min;if(s.setHours(e||0),s.setMinutes(t||0),s.setSeconds(0),s.setMilliseconds(0),this.props.maxValidTimeValue<s)return void d.a.createWarning(r.default.str("STR_ERR_MAX_VALID_TIME"))}!0===this.props.closeWhenSelectDate&&this.onClose(),this.setState({currentDate:t,forceHoverTime:!0,showTimeSuggest:!1},(()=>{this.onChange()}))}onSelectTimeSuggest(e,t,s){e&&(e.stopPropagation(),e.preventDefault());let n=this.state.currentDate?Object(a.a)({},this.state.currentDate):null;if(n){if(!0===this.props.preventPastDate){let e=n;e.outside&&(e=e.outside);let a=new Date(e.date);if(a.setHours(t),a.setMinutes(s),a.setSeconds(0),a.setMilliseconds(0),!0!==this.compareTime(a,new Date))return void d.a.createWarning(r.default.str("STR_ERR_TIME_IN_PAST"))}if(!0===this.props.preventFutureDate){let e=n;e.outside&&(e=e.outside);let a=new Date(e.date);if(a.setHours(t),a.setMinutes(s),a.setSeconds(0),a.setMilliseconds(0),!0!==this.compareTime(new Date,a))return void d.a.createWarning(r.default.str("STR_ERR_TIME_IN_FUTURE"))}if(this.props.maxValidTimeValue){let e=new Date(n.date);if(e&&(e.setHours(t||0),e.setMinutes(s||0),e.setSeconds(0),e.setMilliseconds(0),this.props.maxValidTimeValue<e))return void d.a.createWarning(r.default.str("STR_ERR_MAX_VALID_TIME"))}}else n=new Date,n.setHours(t),n.setMinutes(s),n.setSeconds(0),n.setMilliseconds(0),!0!==this.compareTime(n,new Date)&&n.setDate(n.getDate()+1),n=this.__getDateItem(n);this.setState({currentDate:n,hour:t,min:s},(()=>{this.onChange()})),this.onCloseTimeSuggest()}prepareSuggestTime(e){this.timeSuggestionContent=[],this.startValue=null;for(let t=0;t<48;t++){let s=Math.floor(t/2),a=t%2==0?0:30,n=this.getTimeString(s),o=this.getTimeString(a),r=`${n} : ${o}`;!0!==this.isPast(e,{hour:n,min:o})&&(this.startValue||(this.startValue={hour:s,min:a}),this.timeSuggestionContent.push(i.a.createElement("div",{className:"td-sgg-item",onClick:e=>this.onSelectTimeSuggest(e,s,a),key:`sgg-item-${t}`},r)))}}getTimeString(e){return u.default.getTimeString(e)}onChangeTime(e){if(!e||!e.target)return;let t=e.target.value;if(t)if(t=u.default.validateTimeString(t),t){let{hh:e,mm:s}=t.timeObject,n={invalidTime:isNaN(e)&&isNaN(s)};isNaN(e)||(n=Object(a.a)(Object(a.a)({},n),{},{hour:e})),isNaN(s)||(n=Object(a.a)(Object(a.a)({},n),{},{min:s})),this.setState(n,(()=>{this.state.invalidTime||this.onChange()}))}else this.setState({invalidTime:!0});else this.setState({invalidTime:!1})}onTimeKeydown(e){const t=e=>{e.preventDefault(),e.stopPropagation()};if(e){let s=e.target;if(e.which===l.K_BACK_SPACE){if(s===this.timeInputMin&&0===s.value.length)return this.timeInputHour.focus(),void t(e)}else if(e.which===l.K_RIGHT){if(s===this.timeInputHour){if(this.timeInputHour.selectionEnd===s.value.length)return this.timeInputMin.focus(),void t(e)}}else if(e.which===l.K_LEFT){if(s===this.timeInputMin){if(0===this.timeInputMin.selectionStart)return this.timeInputHour.focus(),void t(e)}}else if(e.which===l.K_TAB){if(s===this.timeInputHour)return this.timeInputHour.focus(),void t(e)}else if(111===e.which||e.which===l.K_DEL||e.which===l.K_HOME||e.which===l.K_END||e.which===l.K_SHIFT||e.which===l.K_CTRL||e.which===l.K_ALT||e.which===l.K_CMD_LEFT||e.which===l.K_CMD_RIGHT);else if(e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105){if(s){let a=s.value,n=s.selectionStart;if(s.selectionEnd-n===a.length&&a.length>0)return;if(a.length>=2)return void t(e);if(s===this.timeInputHour)if(0===a.length){if(e.keyCode>50&&e.keyCode<=57||e.keyCode>98&&e.keyCode<=105)return}else{if(1!==a.length)return void t(e);{let s=parseInt(a[0]);if(s>2)return void t(e);if(2===s&&(e.keyCode>51&&e.keyCode<=57||e.keyCode>99&&e.keyCode<=105))return void t(e)}}else if(s===this.timeInputMin)if(0===a.length){if(e.keyCode>53&&e.keyCode<=57||e.keyCode>101&&e.keyCode<=105)return void t(e)}else if(1===a.length)return}}else{if(e.which!==l.K_ESC)return void t(e);if(e.preventDefault(),e.stopPropagation(),!1!==this.state.showTimeSuggest){let e=this.state.hour,t=this.state.min;this.setState({showTimeSuggest:!1,hour:e,min:t})}}}}onDateKeyDown(e){e&&e.which===l.K_TAB&&this.timeInput&&this.timeInput.focus()}onChangeDate(e){if(e){let t=e.target;if(t){let e=t.value;if(!e)return void this.setState({invalidDate:!1});if(e=u.default.validateDateString(e),e){let{dd:t,mm:s,yyyy:a}=e.dateObject,n=isNaN(t)||isNaN(s)||isNaN(a),i=!t&&!s&&!a||n,o=new Date(a,s-1,t);i||(i=1===u.default.compareDate(o,this.getMinValidDate())&&this.getMinValidDate()||1===u.default.compareDate(this.getMaxValidDate(),o)&&this.getMaxValidDate()),i||this.onSelectDate(null,this.__getDateItem(o)),this.setState({invalidDate:i})}else this.setState({invalidDate:!0})}}}onBlurDateInput(e){if(this.dateInput){let e=this.dateInput.value(),{invalidDate:t,currentDate:s={}}=this.state;if(t){let{date:e}=s;if(e){e=new Date(e);let t=`${this.getTimeString(e.getDate())}/${this.getTimeString(e.getMonth()+1)}/${e.getFullYear()}`;this.dateInput&&this.dateInput.setValue(t)}this.setState({invalidDate:!1})}else if(e=u.default.validateDateString(e),e){let{dateObject:t}=e;if(t){let e=new Date,{dd:s,mm:a,yyyy:n}=t;n||(n=e.getFullYear()),a||(a=e.getMonth()+1),s||(s=e.getDate()),this.onSelectDate(null,this.__getDateItem(new Date(n,a-1,s)));let i=`${this.getTimeString(s)}/${this.getTimeString(a)}/${n}`;this.dateInput&&this.dateInput.setValue(i)}}}}onBlurTimeInputv2(e){if(this.timeInput){let e=this.timeInput.value(),{invalidTime:t,hour:s,min:a}=this.state;if(t)this.timeInput&&this.timeInput.setValue(`${this.getTimeString(s)}:${this.getTimeString(a)}`),this.setState({invalidTime:!1});else if(e=u.default.validateTimeString(e),e){let{timeObject:t}=e;if(t){let{hh:e,mm:s}=t;e||(e=0),s||(s=0),this.timeInput&&this.timeInput.setValue(`${this.getTimeString(e)}:${this.getTimeString(s)}`),this.setState({hour:e,min:s})}}}}onShowTimeSuggest(){this.setState({showTimeSuggest:!0,forceHoverTime:!1}),setTimeout((()=>{if(this.scrollTimeSuggest){let e,t=new Date;e=void 0!==this.state.hour&&null!==this.state.hour?this.state.hour:t.getHours();let s,a=2*e;s=void 0!==this.state.min&&null!==this.state.min?this.state.min:t.getMinutes(),s>0&&s<30?a++:s>30&&(a+=2);let n=0,i=this.startValue||{};if(void 0!==i.hour&&(n=2*i.hour),void 0!==i.min){i.min>=30&&n++}a-=n,a>0&&this.scrollTimeSuggest.scrollTop(30*a)}}),0)}onCloseTimeSuggest(){this.setState({showTimeSuggest:!1,forceHoverTime:!1})}onChange(){let e=this.state.currentDate?Object(a.a)({},this.state.currentDate):null;e&&(e.outside&&e.outside.date?e=e.outside.date:e.date&&(e=e.date)),e=e?new Date(e):new Date,e.setMilliseconds(0),e.setSeconds(0);let t=this.state.hour||0,s=this.state.min||0;e.setHours(t),e.setMinutes(s),this.props.onChange&&this.props.onChange(e),this.prepareSuggestTime(e)}onClearDateTime(e){e&&(e.preventDefault(),e.stopPropagation());let{hour:t,min:s}=this.__getInitHourMin(this.props,!0);this.props.onChange&&this.props.onChange(null),this.setState({currentDate:null,hour:t,min:s})}__getInitHourMin(e,t=!1){let s,a;if(e.initDateTime&&!0!==t){let t=new Date(e.initDateTime);s=t.getHours(),a=t.getMinutes()}else e.defaultTime&&(s=e.defaultTime.hour,a=e.defaultTime.min);let n=new Date;return null==s&&(s=n.getHours()),null==a&&(a=n.getMinutes()),{hour:s,min:a}}__getDateItem(e){if(!e)return null;let t=new Date(e);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),{solarDay:t.getDate(),weekday:t.getDay(),date:t}}compareTime(e,t){return e||(e=-1),t||(t=-1),e=new Date(e),t=new Date(t),e.getTime()>t.getTime()}setTime(e){if(!e)return void this.__p(this.props);let t=new Date(e),s=t.getHours(),a=t.getMinutes(),n=t.getFullYear(),i=t.getMonth();t=this.__getDateItem(e),this.setState({currentDate:t,hour:s,min:a,year:n,month:i})}isPast(e,t){let s=new Date(e),a=new Date,n=0,i=0;return t?(n=t.hour,i=t.min):(a.setHours(0),a.setMinutes(0)),s.setHours(n),s.setMinutes(i),s.setSeconds(0),s.setMilliseconds(0),a.setSeconds(0),a.setMilliseconds(0),s<a}isFuture(e,t){let s=new Date(e),a=new Date,n=0,i=0;return t?(n=t.hour,i=t.min):(a.setHours(0),a.setMinutes(0)),s.setHours(n),s.setMinutes(i),s.setSeconds(0),s.setMilliseconds(0),a.setSeconds(0),a.setMilliseconds(0),s>a}focusTime(){this.onShow(),setTimeout((()=>{this.timeInputHour&&this.timeInputHour.focus()}),100)}getMaxValidDate(){let{maxDate:e,preventFutureDate:t}=this.props;return e||(t?Date.now():null)}getMinValidDate(){let{minDate:e,preventPastDate:t}=this.props;return e||(t?Date.now():null)}checkValidTime(e,{hh:t,mm:s}){let a=new Date(e);a.setHours(t),a.setMinutes(s),a.setSeconds(0),a.setMilliseconds(0);let n=this.getMinValidDate(),i=this.getMaxValidDate();return i&&i<a?1:n&&n>a?-1:0}onClickDateItem(e,t){if(this.onSelectDate(e,t),t){let{date:e}=t;if(e){let t=`${this.getTimeString(e.getDate())}/${this.getTimeString(e.getMonth()+1)}/${e.getFullYear()}`;this.dateInput&&this.dateInput.setValue(t),this.setState({invalidDate:!1})}}}render(){var e;let t=this.state.dateMap;t=t.map(((e,t)=>{if(!e)return null;let s=e.solarDay,n=e.date,o=e.weekday;e.outside&&(s=e.outside.solarDay,n=e.outside.date,o=e.outside.weekday);let r=new Date,l=r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()&&r.getDate()===n.getDate(),c=this.state.currentDate?Object(a.a)({},this.state.currentDate):null,d=!1;c&&(c.outside&&(c=c.outside),c=c.date,c&&c.getFullYear()===n.getFullYear()&&c.getMonth()===n.getMonth()&&c.getDate()===n.getDate()&&(d=!0));let h=!1;return 1===u.default.compareDate(this.getMaxValidDate(),n)&&this.getMaxValidDate()&&(h=!0),1===u.default.compareDate(n,this.getMinValidDate())&&this.getMinValidDate()&&(h=!0),i.a.createElement("div",{className:"cal-item"+(0===o?" cal-sunday":"")+(e.outside?" outside":"")+(!0===d?" selected-date":"")+(!0===h?" prevent-date":""),key:t,onClick:t=>e.outside?null:this.onClickDateItem(t,e)},!0===d?i.a.createElement("div",{className:"selected-date"}):null,!0===l&&!0!==d?i.a.createElement("div",{className:"today-dot"}):null,i.a.createElement("div",{className:"solar"},s))}));let s=new Date(this.state.year,this.state.month+1,0),n=null,d=this.state.currentDate?Object(a.a)({},this.state.currentDate):null;if(d){let e=d.date;if(d.outside&&(e=d.outside.date),e&&!this.props.hideTime){let t=new Date(e);t.setHours(this.state.hour),t.setMinutes(this.state.min),n=c.a.contextDate(t,{time:this.props.hideTime?void 0:"HH:mm",date:{type:"DD/MM/YYYY"},format:"time-first"})}}n||(n=i.a.createElement(o.a,{textKey:this.props.placeholderTextKey||"STR_SELECT_TIME"}));let E=s.toLocaleDateString(r.default.currentLanguage()===l.LANG_INDEX_EN?"en-EN":"vi-VI",{month:"long"}),f=this.props.previewStyle||{},I=this.props.popupStyle||{},T=void 0!==this.props.alwaysDueDate&&this.props.alwaysDueDate,v=i.a.createElement("div",{style:Object(a.a)({},I),className:"cal-popup"+(this.props.bodyOnly?" body-only":"")},i.a.createElement("div",{className:"cal-date-time"},i.a.createElement("div",{className:"cal-title"}," ",this.state.year?E+", "+this.state.year:r.default.str("STR_TIME_INVALID")),i.a.createElement(p.a,{size:"small",onClick:e=>this.onChangeMonth(!1,e),type:"tertiary",modifier:"text",format:"full-rounded",icon:"icon-solid-left"}),i.a.createElement(p.a,{size:"small",onClick:e=>this.onChangeMonth(!0,e),type:"tertiary",modifier:"text",format:"full-rounded",icon:"icon-solid-right"})),i.a.createElement("div",{className:"flx flx-wrap flx-center"},i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_SUN",className:"cal-weekday",tagName:"div"}),i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_MON",className:"cal-weekday",tagName:"div"}),i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_TUE",className:"cal-weekday",tagName:"div"}),i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_WED",className:"cal-weekday",tagName:"div"}),i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_THU",className:"cal-weekday",tagName:"div"}),i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_FRI",className:"cal-weekday",tagName:"div"}),i.a.createElement(o.a,{textKey:"STR_WEEDKDAYL_SAT",className:"cal-weekday",tagName:"div"})),i.a.createElement("div",{className:"flx flx-wrap flx-center"},t),this.props.hideTime?null:i.a.createElement("div",{className:"cal-time-section flx flx-al-c"},i.a.createElement(g.a,{className:"outline-date"}),i.a.createElement(_.a,{textKey:"DD/MM/YYYY",size:"large",type:"text",onKeyDown:this.onDateKeyDown.bind(this),onChange:this.onChangeDate.bind(this),onBlur:this.onBlurDateInput.bind(this),className:"time-input","data-id":this.props["data-id-info"]&&this.props["data-id-info"].expiredInput,error:this.state.invalidDate,ref:e=>this.dateInput=e,style:{padding:"0 8px"}}),i.a.createElement(g.a,{className:"time-reminder-icon"}),i.a.createElement(_.a,{textKey:"HH:mm",size:"large",type:"text",onChange:this.onChangeTime.bind(this),onBlur:this.onBlurTimeInputv2.bind(this),className:"time-input",ref:e=>this.timeInput=e,error:this.state.invalidTime,style:{padding:"0 8px"}})));return this.props.bodyOnly?i.a.createElement("div",{className:"cal-body",ref:e=>this.mainDOM=e,style:f},v):i.a.createElement("div",{className:"cal-body",ref:e=>this.mainDOM=e,style:f},i.a.createElement("div",{className:"cal-preview"+(!0===this.state.bodyShown?" body-shown":""),onClick:this.onShow.bind(this),ref:e=>this.previewRef=e,"data-id":this.props["data-id-info"]&&this.props["data-id-info"].calendar},i.a.createElement("div",null,n),this.state.currentDate&&!0!==T?i.a.createElement(h.a,{className:"fa fa-close cal-clear-icon",onClick:e=>this.onClearDateTime(e),tagName:"i",textKey:"STR_REMOVE_TIME"}):i.a.createElement("i",{className:"fa fa-calendar cal-icon"})),i.a.createElement(m.b,{identity:null===(e=this.props.popoverProps)||void 0===e?void 0:e.identity,content:v,placement:"top-left",anchorEl:this.previewRef,deltaPosition:{top:"-10px"}}))}}t.a=E},"/GXy":function(e,t,s){"use strict";var a={};s.r(a),s.d(a,"loading",(function(){return Os})),s.d(a,"isSentMsgStatus",(function(){return Ns})),s.d(a,"getPrimaryId",(function(){return Ms})),s.d(a,"fileRenderState",(function(){return ws}));var n=s("wx14"),i=s("VTBJ"),o=s("rePB"),r=s("q1tI"),l=s.n(r),c=s("17x9"),d=s.n(c),h=s("1pet"),u=s("XS0u"),_=s("kZNI"),m=s("eZmn"),p=s("g7Yi"),g=s("z0WU"),E=s("Ydol"),f=s("97kL"),I=s("PoHQ"),T=s("NDmK"),v=s("ofhN"),R=s("3nWQ"),S=s("KSx/"),O=s("iuhU");const N="VIDEO",b="TITLE";class C extends l.a.Component{constructor(e){super(e),this.state={containerWidth:this.props.containerWidth,downloadError:!1,titleSelected:!1,videoSelected:!1},this.updatedDimension=!1,this._onWindowResize=this._onWindowResize.bind(this),this._downloadCallback=this._downloadCallback.bind(this),this._retryDownload=this._retryDownload.bind(this),this._eventHandler=(e,t)=>{switch(e){case f.GeneralActions.LEFTPANEL_RESIZE:this._onWindowResize()}},E.default.subscribe(this._eventHandler)}componentWillReceiveProps(e){this.props.containerWidth!==e.containerWidth&&this.setState({containerWidth:e.containerWidth})}shouldComponentUpdate(e,t){return this.props.message!==e.message||this.props.thumb!==e.thumb||this.props.src!==e.src||this.props.showStar!==e.showStar||this.props.localPath!==e.localPath||this.props.resending!==e.resending||this.state.containerWidth!==t.containerWidth||this.props.sendTime!==e.sendTime&&(!this.props.sendTime||!e.sendTime)||this.props.hasReacts!==e.hasReacts||this.state.downloadError!==t.downloadError||this.props.isLast!==e.isLast||this.props.lastLocalMsg!==e.lastLocalMsg||this.state.titleSelected!==t.titleSelected||this.state.videoSelected!==t.videoSelected||this.props.isMultiSel!==e.isMultiSel||this.props.selectedType!==e.selectedType}componentDidMount(){window.addEventListener("resize",this._onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this._onWindowResize),E.default.unsubscribe(this._eventHandler)}_fullScreen(e,t,s,a){if(this.props.isMultiSel)return a.preventDefault(),void a.stopPropagation();let n=[];n.push(e);const i={user:s,selectedId:e.msgId,oriUrl:e.message.oriUrl,userId:e.userId,isVideo:e.msgType===h.MSG_VIDEO||2===e.subType,message:e,conversation:t,isMessageConv:!0,images:n,iconMap:v.a.getIconMap(),appConfig:Object(T.d)()};S.a.openPhotoViewer(i)}_onDoubleClick(e){e.preventDefault(),e.stopPropagation()}_renderDuration(e){if(!e||isNaN(e))return null;let t=Math.round(e/1e3),s=Math.floor(t/60);return t%=60,g.default.strPadLeft(s+"","0",2)+":"+g.default.strPadLeft(t+"","0",2)}_updateImageDimension(){if(this.updatedDimension)return;this.updatedDimension=!0;let e=this.props.message;if(e.message&&e.message.params&&e.status!=h.MSG_LOCAL&&e.status!=h.MSG_FAIL&&this.refs.video&&this.refs.video.getThumbEle())try{let t=this.refs.video.getThumbEle(),s=JSON.parse(e.message.params);s&&(s.video_width=t.naturalWidth,s.video_height=t.naturalHeight,1!=s.parsed&&Object.assign(s,{parsed:1}),e.message.params=JSON.stringify(s),g.default.log("video-message: _updateImageDimension "+e.message.params),u.default.updateMessageParams(e.msgId,{video_width:s.video_width,video_height:s.video_height,parsed:s.parsed},e))}catch(t){g.default.logCoreError(t)}}_onWindowResize(){let e=I.default.getChatViewRef();e&&this.setState({containerWidth:e.offsetWidth})}_downloadCallback(e,t){e?this.setState({downloadError:!0}):this.props.onFilePathUpdated&&this.props.onFilePathUpdated(t)}_retryDownload(){this.refs.video&&(this.refs.video.componentWillMount(),this.setState({downloadError:!1}))}_onVideoClick(e,t){if(this.props.isMultiSel){t.stopPropagation();const e=Object(i.a)({},this.props.message),{selectedMsg:s,onChooseMsg:a}=this.props,n=(e=!0)=>{this.setState({titleSelected:e,videoSelected:e})};if(s.hasOwnProperty(this.props.message.msgId)){let e=Object.assign({},e[this.props.message.msgId]);n(!1,!1),a&&a(e,t)}else e&&(e.message=Object(i.a)(Object(i.a)({},(null==e?void 0:e.message)||{}),{},{title:""}),n(!0,!0),a(e,t))}else this._fullScreen(this.props.message,this.props.conversation,this.props.user,t)}render(){var e,t,s;let a=null,o=null;this.props.message.message&&(a=""!=this.props.message.message.title?this.props.renderHtmlMessage(this.props.message.message.title):null,o=this.props.message.message.duration);let r={maxHeight:"368px"},c={},d={};const u=a&&this.props.isMultiSel&&this.props.message.msgType!==h.MSG_UNDO&&this.props.message.msgType!==h.MSG_DEL_EVERYONE;let _=g.default._estimateSize(this.props.message,this.state.containerWidth-201),p=T.c.image.bg_v?null:"transparent",E={width:_.width,height:_.height,backgroundColor:p,borderRadius:"8px"},f=this.props.onImageLoaded;if(_&&_.width?f=()=>{this._updateImageDimension()}:E={width:"368px",height:"368px"},a&&E.width){let e=0;try{e=parseInt(E.width)-24}catch(P){}d.width=e+"px",d.borderBottomRightRadius=(this.props.sendTime||this.props.hasReacts?0:8)+"px",d.borderBottomLeftRadius=d.borderBottomRightRadius}else{let e=0;try{e=parseInt(E.width)-24}catch(P){}d.width=e+"px",d.borderBottomRightRadius="8px",d.borderBottomLeftRadius=d.borderBottomRightRadius,d.backgroundColor="var(--blue-700)",d.height="15px"}let I,v={width:_.width,height:_.height,backgroundColor:p,borderRadius:this.props.sendTime&&a||a?"":"8px"};r=Object.assign(r,E),c=Object.assign(r,v),I=l.a.createElement("i",{className:"fa fa-play",style:{lineHeight:"17px",marginLeft:"4px"}});T.c.video_inline.enableFeature;Object(i.a)(Object(i.a)({},r),{},{borderTopRightRadius:"8px",borderTopLeftRadius:"8px",borderBottomLeftRadius:a?"0px":"8px",borderBottomRightRadius:a?"0px":"8px",borderRadius:"0px"});const S=this.props.selectedType,C=e=>S===h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL||this.props.selectedType===h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_PARTIAL&&(e===N&&this.state.videoSelected||e===b&&this.state.titleSelected);let A=()=>{};this.props.isMultiSel&&a&&(A=e=>this._onVideoClick(b,e));let y=this.props.sendTime;a&&(r.borderBottomLeftRadius=0,r.borderBottomRightRadius=0,y&&d&&(y=l.a.createElement(y.type,Object(n.a)({},y.props,{style:{width:d.width}}),y.props.children)));let D=this.props.reaction;D=a?!!D&&l.a.cloneElement(D,{style:Object(i.a)(Object(i.a)({},D.props.style),{},{width:d.width})}):!!D&&l.a.cloneElement(D,{style:Object(i.a)(Object(i.a)({},D.props.style),{},{width:r.width})});const M=null===(e=this.props.message)||void 0===e?void 0:e.ttl;return l.a.createElement(R.a,{ttl:a&&M,isAdmin:this.props.isSignAdminMsg,variant:"photo"},l.a.createElement("div",{className:Object(O.a)(this.props.className,(null===(t=this.props.message)||void 0===t?void 0:t.ttl)&&"-ttl")+" card--video  "+(a?"has-caption":"has-no-caption")+(this.props.localPath,"")+(u&&C(b)?" caption-selected":"")+(u&&C(N)?" image-selected":"")+" -bg-v-"+T.c.image.bg_v,onDoubleClick:this._onDoubleClick.bind(this),onContextMenu:this.props.onContextMenu},this.props.displayName,l.a.createElement(R.a,{ttl:!a&&(null===(s=this.props.message)||void 0===s?void 0:s.ttl),isAdmin:this.props.isSignAdminMsg,variant:"photo"},l.a.createElement("div",{style:{position:"relative"},className:"outline-bubble",style:r,onClick:this._onVideoClick.bind(this,N)},l.a.createElement("div",{className:this.state.isPlaying?"hidden overlay":`overlay${a?" _caption":""} overlay__video${a?"_caption":""}`,style:c},l.a.createElement("div",{className:"avatar avatar--xm flx-center"},l.a.createElement("div",{className:"avatar-img flx flx-center flx-al-c",style:{backgroundColor:"rgba(0,0,0,0.8)",color:"var(--white-300)",fontSize:"21px"}},I)),l.a.createElement("div",{className:"overlay__video__duration"},this._renderDuration(o))),l.a.createElement(m.a,{ref:"video",className:"chat-message-picture chat-message-picture__video"+(a?"_caption":""),onLoad:f,style:r,src:this.props.thumb,cacheFolderName:"Cache",userId:this.props.userId,message:this.props.message,downloadCallback:this._downloadCallback,conversation:this.props.conversation}))),a?l.a.createElement("div",{className:"chat-message-caption"+(null==this.props.sendTime?" chat-message-caption__border":""),style:d,onClick:A},a):null,a?null:D,y,a?D:null,this.props.msgAction))}}C.propTypes={src:d.a.string.isRequired,showFullImage:d.a.func.isRequired,onVideoLoaded:d.a.func};var A=C,y=s("c51z"),D=s("lCMA");l.a.Component;var M=s("4eSn"),P=s("r6Qt");class w extends l.a.Component{constructor(e){super(e),this._getMoveText=this._getMoveText.bind(this),this._getTitle=this._getTitle.bind(this)}shouldComponentUpdate(e){return this.props.requestGame!=e.requestGame}_getMoveText(e){try{if(6===(e=e.substring("move".length,"move".length+6)).length){let t=e[0],s=e.substring(1,3),a=e.substring(3,5);e[5];if(2!=t)return"Đã chọn vị trí bắt đầu";if(s=parseInt(s),a=parseInt(a),!isNaN(s)&&!isNaN(a))return`Di chuyển đến ô ${s} ${a}`}}catch(t){g.default.logCoreError(t)}return"Thực hiện nước đi"}_getTitle(e){if(null!=this._lastTitle)return this._lastTitle;let t="Thực hiện nước đi";switch(e[0]){case"đ":e.startsWith("đồng ý")&&(t="Đồng ý lời mời");break;case"c":e.startsWith("chơi củ đậu")&&(t="Gửi lời mời chơi game");break;case"h":e.startsWith("hết đường")&&(t="Thực hiện nước đi");break;case"k":e.startsWith("kết thúc")&&(t="Kết thúc game");break;case"m":e.startsWith("move")&&(t=this._getMoveText(e))}return this._lastTitle=t,t}render(){let e="",t="";if(e="fa-chat_bubble_icon_misscall",this.props.startGameMode)t="Chơi game củ đậu";else{t="Thực hiện nước đi";let e=this.props.cmdText;e&&(t=this._getTitle(e))}return l.a.createElement("div",{className:this.props.className},l.a.createElement("div",{className:"videocall-message-content"},l.a.createElement("img",{className:"zgame__icon__img",src:"https://api.zaloapp.com/api/emoticon/sticker/webpc?eid=20695&size=130"}),l.a.createElement("span",{className:"videocall-message-content__subtitle"},t)),this.props.startGameMode?l.a.createElement("div",{onClick:this.props.startGameMode,className:"videocall-message-content__callback"},"Đồng ý"):null)}}var L=w,k=s("Enw1");class x extends l.a.Component{constructor(e){super(e),this._toggleUpdateInfo=this._toggleUpdateInfo.bind(this)}shouldComponentUpdate(e){return this.props.updateData.meta.version!==e.updateData.meta.version||this.props.className!==e.className}_toggleUpdateInfo(){this.props.dispatch({type:f.PopupActions.SHOW_UPDATE_MODAL})}render(){if(!this.props.updateData||!this.props.updateData.meta)return null;let e=Object.assign({},I.default.getUpdateInfo());return l.a.createElement("div",{className:this.props.className},l.a.createElement("div",null,l.a.createElement("div",{className:"text"},this.props.content)),e&&e.meta&&e.meta.version&&this.props.updateData.meta.version===e.meta.version&&!isNaN(e.clientVersion)&&parseInt(T.c.apiVersion)<parseInt(e.clientVersion)?l.a.createElement("div",{onClick:this._toggleUpdateInfo,className:"card--update-msg__footer-btn"},y.default.str("STR_UPDATE").toUpperCase()):null)}}var U=x,F=(s("fBUP"),s("dGAM")),G=s("41Rw"),B=s("Rmax"),H=s("QQLV"),j=s("DWOr"),V=s("1PLK"),K=s("BZLJ"),W=s("Q8hM"),Y=s("DPHK"),z=s("0qCE"),q=s("qYNW"),X=s("6uTC"),J=s("l+V6"),Q=s("h0sc");class $ extends l.a.Component{constructor(e){super(e),this.state={lang:y.default.currentLanguage(),lastMsg:null},this.updateLanguage=()=>{this.setState({lang:y.default.currentLanguage()})},y.default.callUpdate(this.updateLanguage)}shouldComponentUpdate(e,t){return this.state.lang!==t.lang||this.props.data!==e.data||this.state.lastMsg!==t.lastMsg}componentWillReceiveProps(e){this.props.focusId===e.focusId&&this.props.data===e.data||this.onLoadLastMsg(e.data)}componentDidMount(){this.onLoadLastMsg(this.props.data)}componentWillUnmount(){y.default.removeUpdate(this.updateLanguage),K.i.clearTargetMsgTodoJump()}onLoadLastMsg(e){if(e){let t=K.i.getTargetMsgTodoJump()||"";if(this.taskCount()>1&&""===t)return;let s=null;if(""===t){for(let a in e)if(e.hasOwnProperty(a)){s=e[a];break}}else s=e[t];if(s){let e=s.lastMsg,t=K.i.getTodoMsg(e);if(t){const e=e=>{this.setState({lastMsg:e})};t.constructor===Promise?t.then((t=>{t&&e(t)})).catch((e=>{q.Core.error("[todo] get lastmsg: ",JSON.stringify(e))})):t.constructor===Object&&e(t)}}}}onEdit(){let e=this.getTodoData();if(!e)return;let t=e.id;K.i.getTodoDetail(t).then((e=>{e&&Q.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_EDITOR,params:Object(i.a)(Object(i.a)({},e),{},{isEdit:!0})})})).catch((e=>{this.processInvalidTodo(e)})),this.onClearUnreadTodo()}onReport(){let e=this.getTodoData();e&&(K.i.getTodoDetail(e.id).then((e=>{e&&z.a.todoDingACK(e,this.props.dispatch)})).catch((e=>{q.Core.error("[todo][org-msg] get detail failed: "+JSON.stringify(e)),this.processInvalidTodo(e)})),this.onClearUnreadTodo())}onReply(){let e=this.getTodoData();e&&(this.props.dispatch&&this.props.dispatch({type:f.TodoActions.INSERT_TODO_QUOTE_MSG,payload:{todoInfo:e}}),this.onClearUnreadTodo())}onReopen(){this.onChangeStatus(K.g.IN_PROCESS).then((e=>{})).catch((e=>{q.Core.error("[todo][org-msg] reopen error: "+JSON.stringify(e))}))}onDone(){this.onChangeStatus(K.g.DONE).then((e=>{})).catch((e=>{q.Core.error("[todo][org-msg] done error: "+JSON.stringify(e))}))}onReceive(){this.onChangeStatus(K.g.IN_PROCESS).then((e=>{})).catch((e=>{q.Core.error("[todo][org-msg] receivetask error: "+JSON.stringify(e))}))}onChangeStatus(e){return new Promise(((t,s)=>{let a=this.getTodoData();if(!a)return void s();let n=a.status;z.a.changeTaskStatus(n,e,a,this.props.user.userId,this.props.confirm).then(t).catch((e=>{this.processInvalidTodo(e),s(e)})),this.onClearUnreadTodo()}))}onRemind(){let e=this.getTodoData();e&&(z.a.remindTask(e,this.props.user.userId,this.props.dispatch),this.onClearUnreadTodo())}onClearUnreadTodo(){let e=this.getTodoData();if(!e)return null;let t=e.id;K.i.clearUnreadTodo(t),this.props.dispatch&&this.props.dispatch({type:f.TodoActions.MSG_CLEAR_UNREAD,payload:t})}getTodoData(){let e=this.state.lastMsg;if(!e)return null;let t=null;if(e.message){let s=e.message.params;s&&(t=s.params)}return t}onViewMulti(){let e=this.props.data;e&&(this.state.lastMsg||Q.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_MULTI_VIEW,params:e}))}taskCount(){let e=this.props.data||{},t=0;for(let s in e)e.hasOwnProperty(s)&&e[s]&&t++;return t}processInvalidTodo(e){if(e&&(212===e.error_code||166===e.error_code)){X.a.createWarning(y.default.str("STR_TODO_TOAST_NOT_FOUND_TODO"));let e=this.getTodoData();if(!e||!e.extra)return;let t=e.id,s={};s[t]={lastAct:"todo.delete"};let a=e.extra.msgId;u.default.getMessage(a).then((e=>{if(e&&e.length>0)for(let t=0;t<e.length;t++){let a=e[t];if(a){let e=a.conversation,t=a.messages;t&&t.length>0&&(t=t[0]),K.i.updateOrgTodoMsg(s,t).then((t=>{this.props.dispatch({type:f.FetchActions.UPDATE_MESSAGES,payload:{conversationId:e.userId,messages:[t]}})}))}}})).catch((e=>{q.Core.error("[todo][org-msg] invalid: "+JSON.stringify(e))}))}}render(){let e=this.props.htmlInner;if(!e)return null;let t=this.taskCount();if(t<1||1===t&&!this.state.lastMsg)return e;if(!this.state.lastMsg)return l.a.createElement("div",null,e,l.a.createElement("div",{className:"td-mul-task-button"},l.a.createElement(W.a,{textKey:"STR_VIEW_TODO_LIST",tagName:"div",className:"mul-container",onClick:this.onViewMulti.bind(this)},l.a.createElement("i",{className:"fa fa-todo-maintab"}),l.a.createElement("div",null,t))));let s=this.getTodoData();return s&&"todo.delete"!==s.act&&"delete"!==s.act?l.a.createElement("div",null,l.a.createElement(J.a,{todo:s,htmlInner:e,confirm:this.props.confirm,dispatch:this.props.dispatch,user:this.props.user,lastMsg:this.state.lastMsg})):e}}var Z=$,ee=s("Yi2m"),te=s("P6UB");var se=function(e){if(!e.urgency)return null;let t=Object(r.useMemo)((()=>e.urgency===h.URGENCY_MODE.URGENT?l.a.createElement("i",{className:"fa fa-urgent"}):l.a.createElement("i",{className:"fa fa-important"})),[e.urgency]),s=Object(r.useMemo)((()=>e.urgency===h.URGENCY_MODE.URGENT?l.a.createElement(D.a,{textKey:"STR_URGENT"}):l.a.createElement(D.a,{textKey:"STR_IMPORTANT"})),[e.urgency]);return l.a.createElement("div",{className:"msg-urgency-indicator"},t,s)},ae=s("L+5E"),ne=s("30XY");class ie extends l.a.Component{constructor(e){super(e),this.isDefaultThumb=e.content.message&&e.content.message.thumb&&-1!==Object.values(g.DEFAULT_THUMB_URLS).indexOf(e.content.message.thumb),this.state={bigThumb:!(this.isDefaultThumb||!e.content.message||!e.content.message.thumb),thumbError:!(e.content.message&&e.content.message.thumb),enablePreview:k.f.getYoutubePreview(e.userId),showPreviewConfig:!0,thumbUrl:null,rotation:0},this._eventHandler=(e,t)=>{switch(e){case f.GeneralActions.CHANGE_YOUTUBE_PREVIEW:this.setState({enablePreview:t})}},E.default.subscribe(this._eventHandler)}componentWillMount(){const e=this.props.content.message;if(e.href&&(g.default.checkGoogleDriveLinks(e.href)||g.default.isThumbFail(this.props.content.message.thumb)))this.setState({bigThumb:!1});else if(this.state.bigThumb&&e&&e.thumb){let s;try{s=JSON.parse(e.params)}catch(t){}s&&s.width?s.width<380&&this.setState({bigThumb:!1}):B.a.tryGetMediaSize(e.thumb).then((e=>{if(e){e.width<380&&this.setState({bigThumb:!1});const t=T.c.file_photo_limit;if(e.width<=t.width&&e.height<=t.height){const t=Object(i.a)({},this.props.content);t.status!==h.MSG_LOCAL&&t.status!==h.MSG_FAIL&&(s||(s={}),s.width=e.width,s.height=e.height,t.message.params=JSON.stringify(s),u.default.updateMessageParams(t.msgId,{width:s.width,height:s.height},t))}else this.setState({thumbError:!0})}else this.setState({bigThumb:!1})})).catch((()=>{this.setState({bigThumb:!1})}))}}componentWillUnmount(){this.stopLoad=!0,E.default.unsubscribe(this._eventHandler)}shouldComponentUpdate(e,t){return!(this.props.content.message===e.content.message&&this.props.content.extra===e.content.extra&&this.props.content.status===e.content.status&&this.props.content.staredDttm===e.content.staredDttm&&this.props.content.reacts===e.content.reacts&&this.props.showStar==e.showStar&&(this.props.sendTime===e.sendTime||this.props.sendTime&&e.sendTime)&&this.props.className===e.className&&this.state.bigThumb===t.bigThumb&&this.state.thumbError===t.thumbError&&this.state.enablePreview===t.enablePreview&&this.state.thumbUrl===t.thumbUrl&&this.state.rotation===t.rotation&&this.props.resending===e.resending&&(this.props.sendTime===e.sendTime||this.props.sendTime&&e.sendTime)&&this.props.thread===e.thread&&this.props.messageContainerWidth===e.messageContainerWidth)}_openUrl(e){const t=this.props.content.message.href,s=ae.a.parseUriInApp(t);if(T.c.groupLinkRegEx.test(t))Q.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.GROUP_PREVIEW,params:t});else if(H.a.checkLinkZaloShop(t))H.a.setLinkOpen(t),this.props.dispatch({type:f.SideBarActions.SELECT_TAB_ZALO_SHOP});else if(ne.b.isCatalogProductLink(t))this.props.dispatch({type:f.GeneralActions.OPEN_LINK_CATALOG,payload:t});else if(s)ae.a.handleUriAction(s,this.props.dispatch,this.props.conversationId||null,(()=>V.b.open(t)));else{V.b.open(t);this.props.content}e&&(e.stopPropagation(),e.preventDefault())}_augmentLink(e){let t=e.props.children?e.props.children:[];return l.a.createElement(e.type,e.props,t&&t.length>0?t:null)}_openSetting(e){Q.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.SETTINGS,params:"message"})}_dockPreview(e){let t=JSON.parse(this.props.content.message.params),s={title:t.mediaTitle||this.props.content.message.description,artist:t.artist,original:t.mediaTitle,url:this.props.content.message.href,src:t.src,originalMessage:this.props.content};this.props.dispatch({type:f.PopupActions.MP3_PREVIEW,payload:s}),e.stopPropagation(),e.preventDefault()}_onThumbError(){this.setState({bigThumb:!1})}_onDoubleClick(e){e.preventDefault(),e.stopPropagation()}_updateImageOrientation(e){this.setState({rotation:e.rotation})}render(){var e;let t={};if(""!==this.props.content.message.params)try{t=JSON.parse(this.props.content.message.params)}catch(O){return g.default.logCoreError(O),l.a.createElement("div",{className:this.props.className},this.props.displayName,l.a.createElement("div",null,"Tin nhắn không hiển thị được"),this.props.sendTime)}let s=null;if(this.state.enablePreview)switch(t.src){case F.a.mp3Src:case F.a.mp3SrcNewBeta:case F.a.mp3SrcNew:{let e=F.b.getMp3CodeFromUrl(this.props.content.message.href);e&&(s=l.a.createElement("iframe",{className:"video-youtube__frame",scrolling:"no",width:"640",height:"180",src:e,frameBorder:"0",allowFullScreen:!1}));break}case F.a.youtubeShortlinkSrc:case F.a.youtubeSrc:{let e=F.b.getYoutubeCodeFromUrl(this.props.content.message.href);e&&(s=l.a.createElement("iframe",{className:"video-youtube__frame",scrolling:"no",width:"640",height:"360",src:e,frameBorder:"0",allowFullScreen:!1}));break}case F.a.soundcloudSrc:{let e=F.b.getSoundCloudUrl(this.props.content.message.href);e&&(s=l.a.createElement("iframe",{className:"video-youtube__frame",scrolling:"no",width:"640",height:"360",src:e,frameBorder:"0",allowFullScreen:!1}));break}}let a=u.default.getTaskSetting()||{},n=!1;const i={};this.isDefaultThumb&&(i.background="none"),this.state.rotation&&(n=!0,i.transform=`rotate(${this.state.rotation}deg)`),this.state.bigThumb&&(i.maxWidth="100%",i.width="100%");let o,r={maxWidth:"calc(100% - 160px)",minWidth:"230px",width:s?"430px":"330px"},c=this.props.className+" card--link"+(this.state.bigThumb?" has-big-thumb":""),d=this.props.content.message.href,h=!0;const _=this.props.content&&this.props.content.message||{};if(te.b.isMultiURL(_.title,!0)&&(h=!1),h&&(_.thumb&&!this.state.thumbError||""==_.thumb)){const e=g.default.isWeb()?void 0:this.props.conversationId,t={userId:_.toUid||_.userId,msgId:_.msgId};o=l.a.createElement(j.a,{key:"link-thumb",className:"card--link-img",style:i,doNotShowRetry:!0,src:_.thumb,href:_.href,cacheFolderName:"richThumb",autoRetryWhenNetworkIsBack:!0,userId:this.props.userId,onClick:this._openUrl.bind(this),resizeThumb:this._onThumbError.bind(this),onError:this._onThumbError.bind(this),bigThumb:this.state.bigThumb,checkExifHandler:this._updateImageOrientation.bind(this),conversationId:e,simpleConvInfo:t})}else o=l.a.createElement("div",{className:"card--link-img"});let m="";"string"==typeof d&&(m=g.default.extractDomain(d));let p="";this.props.content&&this.props.content.message&&this.props.content.message.description&&(p=this.props.content.message.description);let E=p.split("..."),f=!(!this.props.content.extra||!this.props.content.extra.todoInfo||g.default.isEmptyObject(this.props.content.extra.todoInfo)||1!==a.ui_v2),I=l.a.createElement("div",null,this.props.title?l.a.createElement("div",{style:h?{marginBottom:"14px"}:{},className:"text",onDoubleClick:this._onDoubleClick.bind(this)},this._augmentLink(this.props.title)):null,h?l.a.createElement("div",{onDoubleClick:this._onDoubleClick.bind(this)},null!=s&&!0!==f?l.a.createElement("div",{key:"player",className:"flx flx-al-s "+(null!=s?" video-youtube":"")+" clickable"},this.state.showPreviewConfig?l.a.createElement("div",{className:"video-youtube__config"},l.a.createElement("i",{className:"video-youtube__config__btn fa fa-chat-video-icon-setting",onClick:e=>this._openSetting(e)}),l.a.createElement("i",{className:"video-youtube__config__close fa fa-chat-video-icon-float",onClick:e=>this._dockPreview(e)})):null,s):!0===f?null:l.a.createElement("div",{key:"player",className:"flx flx-al-s card--link-content text-is-card-link"+(null!=s?" video-youtube":"")+" clickable"+(this.state.bigThumb?" has-big-thumb":""),onContextMenu:e=>this.props.onContextMenu(e,!0),onClick:this._openUrl.bind(this)},l.a.createElement("div",{className:"card--link-container"},o),l.a.createElement("div",{key:"link-content",className:"card-content"},l.a.createElement("span",{className:"card-title on-hover"},t.mediaTitle||d),p&&(!this.props.content.message.title||this.props.content.message.title&&"string"==typeof this.props.content.message.title&&this.props.content.message.title.indexOf(E[0])<0)?l.a.createElement("span",{className:"card--link__sub clp clp--two"},p):null,l.a.createElement("span",{className:"card--link__src clp clp--one"},t.src||m)))):null);!0===f&&(I=l.a.createElement(Z,{data:this.props.content.extra.todoInfo,htmlInner:I,user:{userId:this.props.userId},confirm:this.props.confirm,dispatch:this.props.dispatch,focusId:this.props.focusId}),delete r.maxWidth);let T=this.props.thread,v=l.a.createElement("div",{className:"flx",style:{marginTop:"10px"}},this.props.sendTime,T);const S="0"===this.props.content.fromUid&&(this.props.content.isLastMsg?"div_LastSentMsg_Link":"div_SentMsg_Link")||this.props.content.isLastMsg&&"div_LastReceivedMsg_Link"||"div_ReceivedMsg_Link";return l.a.createElement(R.a,{ttl:null===(e=this.props.content)||void 0===e?void 0:e.ttl},l.a.createElement("div",{className:c,onContextMenu:this.props.onContextMenu,style:h?r:null,"data-id":S},this.props.displayName,l.a.createElement(se,{urgency:this.props.content.urgency}),I,this.props.isLast||h?v:null,this.props.msgAction,this.props.reaction))}}ie.propTypes={content:d.a.object.isRequired};var oe=ie;class re extends l.a.Component{constructor(e){super(e)}componentWillUnmount(){this.stopLoad=!0}shouldComponentUpdate(e,t){return this.props.content.message!==e.content.message||this.props.content.staredDttm!==e.content.staredDttm||this.props.sendTime!==e.sendTime&&(!this.props.sendTime||!e.sendTime)||this.props.className!==e.className||this.props.resending!==e.resending}_onDoubleClick(e){e.preventDefault(),e.stopPropagation()}render(){let e=this.props.content.message;return l.a.createElement("div",{className:Object(O.a)("sticker-set")},this.props.displayName,l.a.createElement("div",{onClick:this.props.onClick,onDoubleClick:this._onDoubleClick.bind(this),onContextMenu:this.props.onContextMenu,className:this.props.className+" card--business "},l.a.createElement("div",{className:"flx"},l.a.createElement("div",{title:"Bộ sticker",className:"avatar avatar--l"},l.a.createElement("div",{style:{backgroundImage:"url("+g.default.removeProtocol(e.thumb)+")"},className:"avatar-img"})),l.a.createElement("div",{className:"card-content"},l.a.createElement("span",{style:{fontSize:"13px",color:"rgba(0,0,0,0.6)"}},"Bộ sticker"),l.a.createElement("span",{style:{marginTop:"10px"}},e.title))),this.props.sendTime,this.props.msgAction))}}re.propTypes={content:d.a.object.isRequired,onClick:d.a.func.isRequired};var le=re,ce=(s("IvK1"),s("ro+J")),de=s("t77n"),he=s("sANj"),ue=s("Ff2n"),_e=s("gFKI"),me=s("yReG"),pe=s("6e5J"),ge=s("NMlV");const Ee=new(s("NzUN").a)(100);var fe=new class{constructor(){}getCacheThumbs(e){let t=this._getKey(e),s=t?Ee.get(t):null;return s||null}_getKey(e){let t="";return e&&e.cliMsgId&&null!=e.fromUid&&(t=e.cliMsgId+"_"+e.fromUid),t}setKey(e,t){let s=this._getKey(e);t&&Ee.set(s,t)}};let Ie,Te,ve,Re;g.default.isWeb()||(Ie=s("Iwwi"),Te=s("vbkW").ipcRenderer,Re=s("Dprd").default,ve=s("y4y9").default,ve.init({AppConfig:T.c,ZConst:h,ZClientId:ge.a,FileUtils:Re,GlobalVariable:I.default,ChatBoxActions:f.ChatBoxActions}));const Se="DEFAULT_BUBBLE_THUMB";class Oe extends l.a.Component{constructor(e){super(e);let t=Se,s=!1;e&&e.message&&(t=fe.getCacheThumbs(e.message),null!=t?s=!0:t=Se),this.state={bubbleThumb:t,imgLoaded:s,dimension:Object.assign({},this.props.message&&this.props.message.dimension)},this.bubbleHeight,this.thumbHit=!1,this.predownloadChannel="",this.checksum="",this.EventHandler=(e,t)=>{switch(e){case"UPDATE_THUMB_NAIL":if(t&&t.checksum){let e=this._getParam();(e&&e.checksum&&e.checksum==t.checksum||t.thumbKey==this.thumbKey||this.checksum==t.checksum)&&this._onThumbResult(Object(i.a)(Object(i.a)({},t),{},{thumbKey:this.thumbKey||"",clientId:this.props.message.cliMsgId}))}break;case"send-file-info":t&&t.file&&this._matchMessage(t.clientId)&&(this.checksum=t&&t.checksum,ve.valid(t.file,this.state.dimension)&&ve.handleLocalMsg(Object(i.a)({dimension:this.state.dimension},this.props.message),this.props.conversation,t))}},E.default.subscribe(this.EventHandler)}componentWillUnmount(){this.unMounted=!0,E.default.unsubscribe(this.EventHandler),me.a.removeCallBack(this.thumbKey),Te&&this.predownloadChannel&&Te.removeListener(this.predownloadChannel,this.handlePredownloadDone.bind(this))}componentWillMount(){this.state.bubbleThumb===Se&&(this.props.isPhoto?this.handlePhotoBubble():this.handleGenThumb())}shouldComponentUpdate(e,t){return this.state.bubbleThumb!=t.bubbleThumb||this.state.imgLoaded!=t.imgLoaded}handlePredownload(){try{const e=()=>{this.predownloadChannel=`predownload-file-done-${this.props.message.msgId}`,Te&&Te.once(this.predownloadChannel,this.handlePredownloadDone.bind(this))};Date.now()-this.props.message.sendDttm<3e4&&"0"!=this.props.message.fromUid&&e()}catch(e){}}handlePredownloadDone(e,t,s){if(!t&&s==this.props.message.msgId&&this.state.bubbleThumb==Se){if(this.thumbHit=!1,this.props.isPhoto)return void this.handlePhotoBubble();this.handleGenThumb()}}handleGenThumb(){if(!this.props.conversation||this.thumbHit)return;this.thumbHit=!0;let e=this._getParam();this.thumbKey=this.props.message.cliMsgId+"_"+me.b.genId(),me.a.add({localPath:this.props.localPath,options:{thumbKey:this.thumbKey,message:Object(i.a)(Object(i.a)({},this.props.message),{},{toUid:this.props.conversation.userId}),userId:this.props.userId,checksum:e?e.checksum:null,clientId:this.props.message.cliMsgId,dimension:this.state.dimension||null,pPoints:me.b.genId(),pCoefficient:1}})}handlePhotoBubble(){let e=this._getPhotoFileSize();if(e>this._getPhotoLimit());else{if(!e)return;if(0==Object.keys(this.state.dimension).length){let e=this._getParam();return void pe.default.getDimension({path:this.props.localPath||this.props.message.localPath,url:this.props.message&&this.props.message.message?this.props.message.message.href:null,key:this.props.message.cliMsgId,userId:this.props.userId,checksum:e?e.checksum:null,srcAction:4}).then((t=>{this.props.zdispatch({type:f.FileMessageActions.UPDATE_THUMB_DIMENSION,payload:{dimension:t,cliMsgId:this.props.message.cliMsgId,msgId:this.props.message.msgId}},!0),u.default.updateMessage(this.props.message.msgId,{dimension:t},["dimension"]),e&&u.default.updateFile(this.props.message.msgId,{msgId:this.props.message.msgId,dimension:t},["dimension"]),this.setState({dimension:t},(()=>{this.handleGenThumb()}))})).catch((e=>{}))}if(this.state.dimension&&this.state.dimension.bigRes)return;this.handleGenThumb()}}_matchMessage(e){return this.props.message.cliMsgId==e}_onThumbResult(e){if(e.error||this.state.bubbleThumb!=Se)this.thumbHit=!1;else if(e.savePath&&!this.unMounted){let t=this._getParam();if(e.thumbKey.includes(this.props.message.cliMsgId)||t&&t.checksum&&t.checksum==e.checksum){if(this.props.isPhoto){let e=this._getPhotoFileSize();if(!e||e>this._getPhotoLimit())return void E.default.unsubscribe(this.EventHandler)}E.default.unsubscribe(this.EventHandler),fe.setKey(this.props.message,e.savePath),this.setState({bubbleThumb:e.savePath})}}else this.thumbHit=!1}_getPhotoLimit(){return T.c.file_photo_limit.size}_getPhotoFileSize(){let e=this._getParam();if(e&&e.fileSize)return e.fileSize;try{let e=this.props.localPath||this.props.message.localPath,t=Ie.statSync(e);if(t)return t.size}catch(t){}return 0}_getLocalPathAsUrl(e){return e}_getParam(){try{return this.props.message.message.params?JSON.parse(this.props.message.message.params):null}catch(e){return null}}_renderNull(){return!!this.props.isPhoto&&(0==Object.keys(this.state.dimension).length||!(!this.state.dimension||!this.state.dimension.bigRes))}_onLoad(e){this.forceRerender=!1,this.bubbleHeight=e.target.naturalHeight,this.setState({imgLoaded:!0})}render(){if(this._renderNull())return null;if(this.state.bubbleThumb==Se)return l.a.createElement("div",{className:"card--file__bubble fadeInLoadingSlow "}," ");{let e=this.props.message,t=e.message&&e.message.title?e.message.title:e.message;t&&"string"==typeof t||(t="");let s,a=this.state.bubbleThumb,n="",i="";s=(()=>{const e=t.split(".");if(e.length>1){return e[e.length-1].toString()}})(),g.default.isSupportThumbnail(s)&&(this.state.bubbleThumb!==Se&&(a=this._getLocalPathAsUrl(this.state.bubbleThumb)),this.bubbleHeight&&(this.bubbleHeight<198&&(n+="center "),["pptx","ppt"].includes(s)&&(-1===n.indexOf("center")&&(n+="center "),i+="pptx ")));let o={};return this.state.imgLoaded&&a!=Se&&(o.background="initial"),l.a.createElement("div",{className:"card--file__bubble "+n,style:o},l.a.createElement("img",{onLoad:this._onLoad.bind(this),className:(this.state.imgLoaded?"file-thumb-bubble-image file-thumbnail fadeInLoadingSlow ":"file-thumb-bubble-image hide fadeInLoadingSlow ")+i,src:a,ref:e=>this.bubblepreview=e}))}}}var Ne=Oe,be=s("KRIz"),Ce=s("U7c1"),Ae=s("/Z5y"),ye=s("EIuX"),De=(s("wd/R"),s("aUrs")),Me=s("V7B8"),Pe=s("mmfo"),we=s("3gaR"),Le=s("tmLI"),ke=s("/MKj"),xe=s("Z2UN"),Ue=s("VPKu"),Fe=s("50Up"),Ge=s("v/qp");s("6Be5");s("zRkS");const Be="fl-th-txt",He={BlockName:Be,PreviewCN:"fl-th-txt__pr",LoadingCN:"fl-th-txt__loading",ErrorCN:"fl-th-txt__error",ExpiredCN:"fl-th-txt__expired",EditCN:"fl-th-txt__ed",RetryCN:"fl-th-txt__retry"};function je(){return l.a.createElement("div",{className:He.ExpiredCN})}function Ve(){return l.a.createElement("div",{className:He.ErrorCN})}function Ke(){return l.a.createElement("div",{className:He.LoadingCN})}const We=l.a.forwardRef((function(e,t){let{loading:s,data:a,error:o,name:c,mirrorOptions:d}=e,h=Object(ue.a)(e,["loading","data","error","name","mirrorOptions"]);const u=function(e){return r.useMemo((()=>{var t;const s=String(e).split(".").pop();return null!=(t=T.c.tfe.ext_type_map[s])?t:T.c.tfe.ext_type_map.txt}),[e])}(c),_=l.a.useMemo((()=>Object(i.a)(Object(i.a)({},Object(i.a)(Object(i.a)({},Object(Me.getDefaultOptions)()),{},{mode:"text/plain",readOnly:"nocursor",scrollbarStyle:"null",lineWrapping:!0})),{},{mode:u},d)),[u]);if(s)return l.a.createElement(Ke,null);if(o)throw o;return l.a.createElement(Me.UnControlled,Object(n.a)({ref:t,className:He.PreviewCN,value:a.content,options:_},h))}));var Ye=s("GSOH"),ze=s("T1Xd");const qe=Object(ze.c)({key:"textFilePreview",default:{loading:!0,error:null}});var Xe=s("xQyS"),Je=s("BDVO"),Qe=s("wA+B");var $e=function(e){const{pId:t}=e,s=Object(ke.f)(xe.a),a=l.a.useMemo((()=>[s,false,false]),[s,false,false]);return l.a.createElement("div",{className:"fl-th-txt"},l.a.createElement(De.a,{resetKeys:a,fallbackRender:ct,shouldLog:ot},l.a.createElement(et,e)))};const Ze=Object(we.a)(),et=function(e){const{url:t,name:s,pId:a,message:n}=e,{value:i,hasCache:o}=Ze(a,t);return l.a.createElement(l.a.Fragment,null,o&&l.a.createElement(tt,{pId:a,name:s,cache:i}),!o&&l.a.createElement(st,{key:"live-load",pId:a,name:s,message:n,url:t}))};function tt({pId:e,name:t,cache:s}){return _t(e,!1),l.a.createElement(l.a.Fragment,null,l.a.createElement(We,{name:t,data:s.data,loading:!1}))}function st({name:e,url:t,pId:s,message:a}){var n;const i=function(e,t){const s=Object(Ae.a)(e,ye.v),a=dt(e,t);return l.a.useMemo((()=>({url:s,canBeExpired:a})),[s,a])}(s,a),o=l.a.useRef(),r=Object(be.a)((()=>{o.current=i})),c=null!=(n=o.current)?n:i,d=!t&&rt,h=l.a.useMemo((()=>pt()),[]),u=!!t&&l.a.createElement(Ce.a,{key:"loader",resource:c,loadFn:h,placeholder:rt,errorRender:lt,onLoad:r},l.a.createElement(nt,{key:"live-load",pId:s,name:e}));return l.a.createElement(l.a.Fragment,null,d,u)}const at={end:1024};function nt(e){const{pId:t,name:s,resource:a}=e,n=a,{loading:i,data:o,error:r}=Object(Ye.a)(n,at),{setCache:c}=Ze(t,n);return l.a.useEffect((()=>{i||o&&c({data:o})}),[i,o]),_t(t,i,r),l.a.createElement(We,{name:s,data:o,loading:i,error:r})}const it=[Pe.b.NoNetError];function ot(e){if(!Array.isArray(e))return!0;for(const t of e)if(!it.find((e=>t instanceof e)))return!0;return!1}const rt=l.a.createElement(Ke,null);function lt(e){if(e instanceof Pe.b.ExpiredError)return l.a.createElement(je,null);if(e instanceof Qe.a.ExpireError||e instanceof Qe.a.ServerPersistError)return l.a.createElement(je,null);throw e}function ct({error:e,resetErrorBoundary:t}){return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ve,null),l.a.createElement(mt,{onClick:e=>{e.stopPropagation(),t()}}))}function dt(e,t){const s=Object(Ae.a)(e,ye.m),a=Object(Ae.a)(e,ye.r);return l.a.useMemo((()=>{let e=String(null==t?void 0:t.toUid);"0"==e&&(e=T.c.sendToMeId);const n=+s||0;return Object(Je.b)(n,a,e)}),[s,a,null==t?void 0:t.toUid])}function ht(e,t){const s=l.a.useMemo((()=>T.c.tfe.ext_list.includes(t)),[t]),a=Object(Ae.a)(e,ye.k),n=h.FILE_READER.TextEditor&a;return T.c.tfe.enable&&(s||n)}function ut({pId:e,message:t,name:s,fileSize:a}){const n=Object(Ue.c)(),i=dt(e,t);return Object(be.a)((function(t){null==t||t.stopPropagation();const o=de.a.get(de.a.getFileKey(e)),r=function(e){return e<=T.c.tfe.open_limit||(X.a.createError(y.default.trans("STR_TFP_OVERSIZE",Object(Le.h)(T.c.tfe.open_limit,{round:0,adjustType:"floor"}))),!1)}(a),l=ye.v(o);r&&pt()({url:l,canBeExpired:i,autoDownloadPath:false,localPath:false}).then((e=>{n({url:e,name:s})})).catch((e=>g.default.logCoreError("checkAliveFn failed",e)))}))}function _t(e,t,s){const a=Object(ze.l)(qe(e));l.a.useEffect((()=>a({loading:t,error:s})),[a,t,s])}const mt=Object(Fe.a)({onClick:2130105})((function(e){return l.a.createElement(Ge.a,Object(n.a)({className:He.RetryCN,size:"small",icon:"reload",type:"Tertiary"},e))}));function pt(){let e;return async function(t){if(e||(e=await Object(Xe.b)(Qe.b,{url:t.url,canBeExpired:t.canBeExpired,canBeNotReady:!1})),e.ok)return t.url;throw e.error}}var gt=s("3jCC"),Et=s("gwig"),ft=s("+JmS"),It=s("8v6h");const Tt=2;function vt(e){const{pId:t,message:s,shareMessage:a,_common:n,_commonStore:i}=e,{isFolder:o,isPhoto:r,isVideo:c}=n,{fileExt:d,params:h,folderType:u,fileName:_}=i,{localPath:m,fileUrl:E}=Object(Ae.a)(t,ye.x),f=ht(t,d),I=Object(ft.a)(),[v]=Object(It.a)(k.f.getEnableFileThumbnail);if(!v)return null;if(!h)return null;if(!he.isWeb){if(g.default.isSupportThumbnail(d)){let{userId:t,conversation:a}=e;return l.a.createElement(Ne,{message:s,userId:t,conversation:a,localPath:m,isPhoto:r,zdispatch:I})}if(o&&u==Tt)return l.a.createElement(gt.a,{shareFolder:a,message:s,fileParams:h})}if(c&&!he.isWeb){if(T.c.video_inline.enableFeature&&E){const t={width:"100%",maxHeight:"368px"},s=m||E,a=Et.b.getStateNetwork()==Et.a.CONNECTED;return l.a.createElement(p.a,{setLocalPath:e.setLocalPath,isOnline:a,downloadVideo:e.downloadVideo,styleObj:t,localPath:m,message:e.message,dispatch:e.dispatch,userId:e.userId,isFileMessage:!0,scrollToBottom:e.scrollToBottom,path:s})}}return f?l.a.createElement($e,{url:E,name:_,pId:t,message:s}):void 0}var Rt=l.a.memo(vt),St=s("IQef"),Ot=s("m06p");const Nt="file-message-icon";function bt(e){const{pId:t}=e,s=Object(Ae.a)(t,ye.n),a=Object(Ae.a)(t,ye.u),n=Object(Ae.a)(t,ye.B),i=Object(O.a)(Nt,n&&"file-message-icon--from-me",a===St.b.None&&"file-message-icon--none");return l.a.createElement(Ot.a,{size:"large",className:i,extension:s,status:a,iconProps:{className:"file-message-icon__icon"},tickProps:{className:"file-message-icon__tick",detailTipProps:{placement:n?"left":"right"}}})}var Ct=l.a.memo(bt),At=s("boAc");function yt(e){let{fileName:t="",fileExt:s="",params:a}=e;return t||(t=a.title),s||(s=a.fileExt),l.a.createElement("div",{className:"file-message__content-title",title:t},l.a.createElement(At.a,{fileName:t,position:"FILE_TITLE"}))}var Dt=l.a.memo(yt),Mt=s("02jS");function Pt(e){const{pId:t,actionState:s}=e,a=Object(Ae.a)(t,ye.r),n=Object(Ae.a)(t,ye.D),[i,o]=l.a.useState(""),[r,c]=l.a.useState("");if(l.a.useEffect((()=>{const{downloadedText:e,totalText:t}=g.default.generateSizeProgress(n/100*a,a);o(t),c(e)}),[n,a]),he.FileActionState.None==s||!s||!t)return null;let d=[],h=null;if(r.includes("NaN")){let e=n||0;h=l.a.createElement("div",{className:"file-progress-no"},e+"%")}else d=["file-progress-no__percentage"],r.length>5?d.push("file-progress-no__percentage--x-long"):r.length>4&&d.push("file-progress-no__percentage--long"),h="0 B"===i?l.a.createElement("div",{className:"file-progress-no"},n+"%"):l.a.createElement("div",{className:"file-progress-no"},l.a.createElement("span",{className:d.join(" ")},r)," ","/ ",i);return l.a.createElement(Mt.b,{progress:n},h)}var wt=l.a.memo(Pt),Lt=(s("dThN"),s("0bqf")),kt=s("xHgQ"),xt=s("UYGI"),Ut=s("eB4W"),Ft=s("LMLI"),Gt=s("wz4q"),Bt=s("/5+7");var Ht=s("JprO"),jt=s("uP4a");let Vt;function Kt(e){return Wt.bind(e)}function Wt(e){this.message&&this.conversation&&(Ut.a.selectItem(this.message,this.emitter),Lt.d.log(Lt.d.ACT.VIEW_FOLDER,{src:Lt.a.CHAT,targetId:(this.conversation||{}).userId,key:(this.message||{}).msgId})),e&&(e.preventDefault(),e.stopPropagation())}function Yt(e){return zt.bind(e)}function zt(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.message&&this.conversation){var t;let e=g.default.getConversationType(null==this||null===(t=this.conversation)||void 0===t?void 0:t.userId);const s=new jt.c(jt.a.ChatBoxView).getBuilder().withType(jt.f.File).withConvType(jt.b[e]).withMode(jt.e.Manual).withCode(jt.d.CBVMessage).build();Object(Gt.a)(this.message,!0,{entrySerial:s}),Lt.b.downloadMessage(this.message||{},{src:Lt.a.CHAT,targetId:(this.conversation||{}).userId})}}function qt(e){return Xt.bind(e)}function Xt(e){e&&(e.preventDefault(),e.stopPropagation()),this.message&&this.conversation&&this.showInFolder&&("function"==typeof this.showInFolder&&this.showInFolder(e),Lt.b.showMessageInFolder(this.message||{},{src:Lt.a.CHAT,targetId:(this.conversation||{}).userId}))}function Jt(e){return Qt.bind(e)}function Qt(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.message&&this.conversation){var t;let e=g.default.getConversationType(null==this||null===(t=this.conversation)||void 0===t?void 0:t.userId);const s=new jt.c(jt.a.ChatBoxView).getBuilder().withType(jt.f.File).withConvType(jt.b[e]).withMode(jt.e.Manual).withCode(jt.d.CBVMessage).build();!function(e,t={}){const{msgId:s}=e;if(!s)return;const a=Bt.a.getFileKey(s);if(!a)return;const n=Bt.a.get(a);if(n){const{fileUrl:e}=n;e&&V.b.open(e)}}(this.message,{entrySerial:s}),Lt.c.log(Lt.c.ACT.VIEW,{src:Lt.a.CHAT,targetId:(this.conversation||{}).userId,key:(this.message||{}).msgId})}}function $t(e){return Zt.bind(e)}function Zt(e){e&&(e.preventDefault(),e.stopPropagation());const{conversation:t,message:s}=this,a=s?s.message.href:"";Object(kt.a)(a),Lt.c.log(Lt.c.ACT.DOWNLOAD,{src:Lt.c.SRC.CHAT,targetId:(t||{}).userId,key:(s||{}).msgId})}function es(e){return ts.bind(e)}function ts(e){e&&(e.preventDefault(),e.stopPropagation());let t=function(e){if(e.fileName&&e.url){let t,s,a=y.default.getCurrentLanguageName(),n=e.fileName.lastIndexOf(".");if(n>0){let a=e.fileName.substr(n+1).toLowerCase();t=!!he.WebviewType.Office.includes(a),s=!!he.WebviewType.Text.includes(a)}if(t)return"https://view.officeapps.live.com/op/embed.aspx?src="+encodeURIComponent(e.url);if(s)return"https://drive.google.com/viewerng/viewer?url="+encodeURIComponent(e.url)+"&embedded=true&hl="+a}return e&&e.url||""}({fileName:this.fileName,url:this.url});t&&this.dispatch({type:f.PopupActions.TOGGLE_FILE_PREVIEW,payload:{isAlive:!0,isOnline:this.isOnline,message:this.message,url:this.url,preview:t,label:this.fileName,context:"file"}})}function ss(e){return as.bind(e)}function as(e){e&&(e.stopPropagation(),e.preventDefault()),"function"==typeof this.props.resendMessage?this.props.resendMessage(e):Object(Le.b)("[FileMessage][CSC] resendMessage defFN")}function ns(e){return is.bind(e)}function is(e){e&&(e.preventDefault(),e.stopPropagation()),"function"==typeof this.props.uploadFilesNative?this.props.uploadFilesNative(e):Object(Le.b)("[FileMessage][CSC] resendMessageNative defFN")}function os(e){return rs.bind(e)}function rs(e){e&&(e.preventDefault(),e.stopPropagation()),this.message?Ht.a.abortByMsg(this.message):Object(Le.b)("[FileMessage][cancelDownload] defFN")}function ls(e){return cs.bind(e)}function cs(e){e&&(e.preventDefault(),e.stopPropagation());let{cliMsgId:t,zipKey:s}=this.message,{conversationId:a}=this.conversation;he.isWeb||Vt.cancel({cliMsgId:t,conversationId:a,zipKey:s},!0),setTimeout((()=>{const e=`${t}_${I.default.getSessionUserId()}_${a}`,s=de.a.getFileKey(e);de.a.get(s).fileUrl?Object(Le.b)("[FileMessage][CSC][cancelUploadAndZip] warning: fileUploaded"):(xt.a.cancelUpload(+t),Ft.a.abort(Ft.a.helper.getKeyFromMsgObj(this.message),Ft.a.errors.GENERAL_WORKER_CANCEL),de.a.dispatch(he.FileActionType.ExtraInfo,{fileKey:s,extraInfo:{cancelUpload:!0,localPath:null,folderPath:null}}),de.a.dispatch(he.FileActionType.RestoreDefault,{fileKey:de.a.getFileKey(e)}))}),800)}function ds(e,t){let{message:s,conversation:a,_commonStore:n}=e;const{actionState:i}=n;let o=null;switch(i){case he.FileActionState.Download:o=os({message:s});break;case he.FileActionState.Upload:o=ls({message:{cliMsgId:s.cliMsgId,zipKey:s.zipKey},conversation:{conversationId:a.userId}});break;default:o=()=>{Object(Le.b)("[FileMessage][CSC][fileCancelButton] defFn")}}return o?l.a.createElement("div",{className:"file-message__button-cancel",onClick:o},l.a.createElement("i",{className:"fa fa-icon-solid-close-2 clickable",key:"cancel"})):null}var hs=l.a.memo(l.a.forwardRef(ds));function us(e){return function(e){const{_commonStore:t}=e,{actionState:s,extraInfo:a}=t;switch(function(e){let{actionState:t,extraInfo:s}=e,a=he.isWeb?"Web":"",n="";[he.FileActionState.Download,he.FileActionState.Upload].includes(t)&&(n="DownloadOrUpLoad");s&&s.cancelUpload&&(n="Cancelled");n||(n="None");return he.FileMsgState[`${n}${a}`]}({actionState:s,extraInfo:a})){case he.FileMsgState.None:return function(e){const{props:t,pId:s,_common:a,_commonStore:i}=e,{isFolder:o}=a;let{showInFolder:r,manualDownload:c,message:d,conversation:h}=t;const{extraInfo:u,onCloud:_,status:m,fileExt:p}=i;let{localPath:g,folderPath:E,downloadError:f,sendFileError:I}=u;const T=Object(Le.j)(f||{});let v=[];if(!he.MessageStatusValidGroup.includes(m)||I||T&&!_);else{if(v.push(l.a.createElement(_s,Object(n.a)({key:"text-file-viewer-action",pId:s,message:d},i))),o&&E||!o&&g){let e=Object(O.a)("fa fa-media-folder","file-message__actions-icon");const t="function"==typeof r?r:Le.a.bind(null,"[FileMessage][CSC] showInFolder defFN");v.push(l.a.createElement(W.a,{tagName:"a",key:"openfolder",className:Object(O.a)("clickable","file-message__actions open"),textKey:"STR_VIEW_IN_FOLDER",onClick:qt({showInFolder:t,message:d,conversation:h})},l.a.createElement("i",{className:e})))}let e=Object(O.a)("fa fa-file-preview-download-icon","file-message__actions-icon");const t="function"==typeof c?c:Le.a.bind(null,"[FileMessage][CSC] manualDownload defFN");v.push(l.a.createElement(W.a,{tagName:"a",key:"downloadtofolder",className:Object(O.a)("clickable","file-message__actions download"),onClick:Yt({manualDownload:t,message:d,conversation:h}),textKey:"STR_DOWNLOAD_FILE"},l.a.createElement("i",{className:e})))}return v}(e);case he.FileMsgState.NoneWeb:return function(e){const{_commonStore:t,props:s,pId:a}=e,{extraInfo:i,status:o,fileExt:r}=t;let{cancelUpload:c}=i,{message:d,conversation:h}=s,u=[];if(c||!he.MessageStatusValidGroup.includes(o));else{u.push(l.a.createElement(_s,Object(n.a)({key:"text-file-viewer-action",pId:a,message:d},t)));let e=Object(O.a)("fa fa-file-preview-download-icon","file-message__actions-icon");const s=$t({message:d,conversation:h});u.push(l.a.createElement(W.a,{tagName:"a",key:"downloadtofolder",className:Object(O.a)("clickable","file-message__actions download"),onClick:s,textKey:"STR_DOWNLOAD_FILE"},l.a.createElement("i",{className:e})))}return u}(e);case he.FileMsgState.DownloadOrUpLoad:case he.FileMsgState.DownloadOrUpLoadWeb:return function(e){const{pId:t,_common:s,_commonStore:a,props:n}=e,{message:i,conversation:o}=n,{fileSize:r,actionState:c}=a;let d=[];const h=l.a.createElement(wt,{key:"filemessageprogress",pId:t,status:s.isError?Mt.a.Pause:Mt.a.Play,actionState:c,fileSize:r}),u=l.a.createElement(hs,{key:"filemessagecancelbutton",pId:t,message:i,conversation:o,_commonStore:a});return d.push(h,u),d}(e);case he.FileMsgState.Cancelled:case he.FileMsgState.CancelledWeb:return function(e){const{_commonStore:t,props:s}=e,{extraInfo:a}=t;let{cancelUpload:n}=a,i=[];if(n){let e=ss({props:s});i.push(l.a.createElement("div",{className:"file-message__actions",key:"cancelretry"},l.a.createElement(D.a,{textKey:"STR_CANCELLED"}),l.a.createElement(D.a,{textKey:"STR_RESEND_MSG",key:"retry",tagName:"a",className:"clickable file-message__actions-item",onClick:e})))}else if(!he.isWeb){let t=ns({props:e.props});i.push(l.a.createElement("div",{className:"file-message__actions",key:"cancelretry"},l.a.createElement(D.a,{textKey:"webDownload"}),l.a.createElement(D.a,{textKey:"STR_REUPLOAD_MSG",tagName:"a",key:"retry",className:"clickable file-message__actions-item",onClick:t})))}return i}(e);default:return[]}}(e)}function _s(e){const{pId:t,fileExt:s}=e;return ht(t,s)?l.a.createElement(ms,e):null}function ms({pId:e,fileSize:t,fileName:s}){const{loading:a,error:n,message:i}=Object(ze.j)(qe(e)),o=ut({pId:e,message:i,name:s,fileSize:t}),r=!a&&!n;return l.a.createElement(l.a.Fragment,null,r&&!!T.c.tfe.enable_edit&&l.a.createElement(ps,{onClick:o}),r&&!T.c.tfe.enable_edit&&l.a.createElement(gs,{onClick:o}))}const ps=Object(Fe.a)({onClick:2130101})((function(e){return l.a.createElement(W.a,Object(n.a)({tagName:"div",className:Object(O.a)("clickable","file-message__actions"),textKey:"STR_TFE_MAKE_NEW_FROM_TIP"},e),l.a.createElement("i",{className:Object(O.a)("fa fa-file-view","file-message__actions-icon")}))})),gs=Object(Fe.a)({onClick:2130101})((function(e){return l.a.createElement(W.a,Object(n.a)({tagName:"div",className:Object(O.a)("clickable","file-message__actions"),textKey:"STR_TFE_VIEW_TIP"},e),l.a.createElement("i",{className:Object(O.a)("fa fa-file-view","file-message__actions-icon")}))}));function Es(e){let{pId:t,_commonStore:s,_common:a}=e,n=Object(Ae.a)(t,ye.s);n=n||{};const{actionState:o,extraInfo:r,status:c}=n,d=(r||{}).cancelUpload,h=Object(ye.C)(n,T.c.file);s=Object.assign(Object(i.a)({},s),{status:c,actionState:o,extraInfo:r||{},onCloud:h});const u=us({pId:t,props:e,_commonStore:s,_common:a})||[];return l.a.createElement("div",{className:Object(O.a)("file-message__content-actions",d?"flx-s":"flx-e",o)},u.map((e=>e)))}var fs=l.a.memo(Es),Is=s("H7mg");const Ts="file-message__content-info";function vs(e){const{pId:t,_commonStore:s,_common:a}=e,{isFolder:n}=a;let{fileSize:i,canPreview:o}=s;const r=l.a.useMemo((()=>i&&Object(Le.h)(i)),[i]),c=Object(Ae.a)(t,ye.d),d=Object(O.a)(Ts,n?`${Ts}-folder`:null,o?`${Ts}-preview`:null),h=Object(Ae.a)(t,ye.B),{actionState:u,status:_}=Object(Ae.a)(t,ye.t),m=Object(Ae.a)(t,ye.o),p=Object(Ae.a)(t,ye.C);let g;if(u==he.FileActionState.None){if(m)g=l.a.createElement("span",{className:"file-message__content-error"},l.a.createElement("b",{style:{color:"var(--red-300)"}},"!")," ",l.a.createElement(D.a,{title:y.default.trans(m.strKey,m.strKeyParams),textKey:m.strKey,textArguments:m.strKeyParams}));else{if(!he.MessageStatusValidGroup.includes(_))return null;g=l.a.createElement("span",null,r?l.a.createElement("span",{className:`${Ts}-size`,title:r},r):null,l.a.createElement("span",{className:`${Ts}-preview-file truncate`},l.a.createElement(D.a,{textKey:"STR_CLICK_TO_VIEW"})),l.a.createElement("span",{className:`${Ts}-preview-folder truncate`},l.a.createElement(D.a,{textKey:"STR_VIEW_FOLDER"})))}return g?l.a.createElement("div",{className:d},l.a.createElement(Is.a,{isOnCloud:p,size:c,className:"file-message__content-cloud",detailTipProps:{placement:h?"left":"right",popperProps:{padding:0}}}),g):null}return null}var Rs=l.a.memo(vs),Ss=s("HMNi");function Os(e){return function(e){if(e.props&&e.store&&!Object(Le.i)(e.store.params)){const{message:t,conversation:s,shareMessage:a,userId:o,downloadError:r,errorHandler:c,sendTime:d}=e.props,u=function(e){return function(e){let t,s,a,n,i,o,r;return s=function(e){return!(!e||!e.fromUid||"0"!=e.fromUid)}(e),a=bs(e),t=function(e){return Cs(e)?he.FileMsgType.Folder:ys(e)?he.FileMsgType.Photo:As(e)?he.FileMsgType.Video:he.FileMsgType.File}(e),n=function(e){return!(!e||!e.status)&&e.status===h.MSG_FAIL}(e),i=Cs(e),o=ys(e),r=As(e),{isMe:s,isSent:a,fileType:t,isError:n,isFolder:i,isPhoto:o,isVideo:r}}(e)}(e.props.message),_=Ds(e.store),m=Ps(e.props.message);return{fileIcon:l.a.createElement(Ct,{pId:m,_commonStore:_,_common:u}),fileThumb:l.a.createElement(Rt,Object(n.a)({pId:m,userId:o,message:t,conversation:s,shareMessage:a,localPath:e.props.localPath||t.localPath,folderPath:e.props.folderPath||t.folderPath,_commonStore:_,_common:u},e.props)),fileTitle:l.a.createElement(Dt,Object(n.a)({pId:m},_)),fileTextInfo:l.a.createElement(Rs,{pId:m,downloadError:r,_commonStore:_,_common:u,message:t}),fileActionDisplay:l.a.createElement(fs,Object(n.a)({pId:m,_commonStore:_,_common:u},e.props)),clickAction:function(e){return function(e){return t=>{t&&(t.preventDefault(),t.stopPropagation());const{pId:s,props:a}=e,n=de.a.get(de.a.getFileKey(s))||{};let{actionState:o,extraInfo:r}=n;r=r||{};const l=Ds(n);e._commonStore=l;const{downloadError:c,sendFileError:d}=r,h=Object(Le.j)(c||{}),u=Object(ye.C)(n,T.c.file);if(!o||!a)return Le.a.bind(null,"[FileMessage][CSC][_getClickAction][Error] warning: invalid actionState || props")();if(h&&!u)return Le.a.bind(null,"[FileMessage][CSC][_getClickAction] File Expired")();if(d)return Le.a.bind(null,"[FileMessage][CSC][_getClickAction] sendFileError")();switch(Ls({actionState:o,extraInfo:r})){case he.FileMsgState.None:return function(e){try{const{props:t,_common:s}=e,{message:a,conversation:n,emitter:o}=t,{isSent:r,isFolder:l}=s,c={message:a,conversation:n};if(!r||!l)return Jt(Object(i.a)({},c))();Kt(Object(i.a)(Object(i.a)({},c),{},{emitter:o}))()}catch(t){Le.a.bind(null,`[FileMessage][CSC][_getClickActionNone] error: ${t}`)()}}(e);case he.FileMsgState.NoneWeb:return function(e){try{const{props:t,_common:s,_commonStore:a}=e,{message:n,conversation:o,dispatch:r,isOnline:l,emitter:c}=t,{isSent:d,isFolder:h}=s,{canPreview:u,fileName:_}=a,m={message:n,conversation:o};return d&&h?Kt(Object(i.a)(Object(i.a)({},m),{},{emitter:c}))():u?n.message&&n.message.href&&_?es({fileName:_,url:n.message.href,isOnline:l,message:n,dispatch:r})():Le.a.bind(null,"[FileMessage][CSC][_getClickActionNoneWeb] webPreview defFn")():n.message&&n.message.href?$t(Object(i.a)({},m))():Le.a.bind(null,"[FileMessage][CSC][_getClickActionNoneWeb] webPreview defFn")()}catch(t){return Le.a.bind(null,`[FileMessage][CSC][_getClickActionNoneWeb] error: ${t}`)()}}(e);case he.FileMsgState.Cancelled:case he.FileMsgState.CancelledWeb:case he.FileMsgState.DownloadOrUpLoad:case he.FileMsgState.DownloadOrUpLoadWeb:default:return Le.a.bind(null,"[FileMessage][CSC][_getClickAction] invalid actionType")()}}}(e)}(Object(i.a)(Object(i.a)({},e),{},{_common:u,pId:m})),isMe:u.isMe}}return{notLoading:!0}}(e)}function Ns(e){return bs(e)}function bs(e){return Object(Ss.a)(null==e?void 0:e.status)}function Cs(e){if(e){if(e.subType===he.MSG_TYPE.MSG_FOLDER)return!0;if(e.message&&e.message.params){const t=Object(Le.l)(e.message.params);if(t&&t.fType==he.FileMsgType.Folder)return!0}}return!1}function As(e){if(e&&e.message){var t,s;const a=Object(Le.l)(e.message.params);let n=a&&a.fileExt?a.fileExt:"";return n=null===(t=n)||void 0===t||null===(s=t.toLowerCase)||void 0===s?void 0:s.call(t),"mp4"==n}return!1}function ys(e){if(e&&e.message){const t=Object(Le.l)(e.message.params);let s=t&&t.fileExt?t.fileExt:"",a=e.message&&e.message.title?e.message.title:e.message;return a&&"string"==typeof a||(a=""),g.default.isPhoto(a,s)}return!1}function Ds(e){let t,s,a,n,i,{params:o,fileUrl:r}=e;return o=Object(Le.m)(o),t=Object(Le.d)(o),s=Object(Le.f)(o),a=Object(Le.c)(o),n=Object(Le.g)(o),i=function(e){const{fileSize:t,fileExt:s}=e,a=g.default.isOverPreviewSize(t,s);return function(e){if(!e||"string"!=typeof e)return!1;if(e=e.toLocaleLowerCase(),!T.c.enable_file_preview||he.WebviewType.Office.includes(e)&&!T.c.enable_file_preview_microsoft)return!1;if(he.WebviewType.Office.includes(e)||he.WebviewType.Text.includes(e)||he.WebviewType.SelfOpen.includes(e))return!!he.isWeb;return!1}(s)&&!a}({fileSize:s,fileExt:a,fileName:t}),{fileName:t,fileSize:s,fileExt:a,params:o,folderType:n,fileUrl:r,canPreview:i}}function Ms(e){return Ps(e)}function Ps(e){let t=e.cliMsgId||e.clientId;return t?t+"_"+("0"==e.fromUid?I.default.getSessionUserId():e.fromUid)+"_"+("0"==e.toUid?I.default.getSessionUserId():e.toUid):""}function ws(e){return Ls(e)}function Ls(e){let{actionState:t,extraInfo:s}=e,a=he.isWeb?"Web":"",n="";return[he.FileActionState.Download,he.FileActionState.Upload].includes(t)&&(n="DownloadOrUpLoad"),s&&s.cancelUpload&&(n="Cancelled"),n||(n="None"),he.FileMsgState[`${n}${a}`]}const ks=he.isWeb;let xs;ks||(xs=s("AH6V").default);class Us extends l.a.Component{constructor(e){super(e),this.state={store:{}},this._utils=a,this._onProgress.bind(this),this._bindProgress()}shouldComponentUpdate(){return!1}componentWillUnmount(){this._unmounted=!0,this.subIdx&&de.a.unsubscribe(this._getFileKey(),this.subIdx)}componentDidCatch(e,t){g.default.logCoreError(`[FileMessage][Render][Error] ${e} , ${t}`)}componentDidMount(){this.subIdx||(this.subIdx=de.a.subscribe(this._getFileKey(),{fn:this._eventStore.bind(this)}))}_eventStore(e){!this._unmounted&&e&&this.setState({store:Object.assign({},this.state.store,e)})}_onProgress(e){this.unmounted||e.error||de.a.dispatch(he.FileActionType.Progress,{fileKey:this._getFileKey(),progress:Math.round(e.percentage)})}_getPId(){return de.a.utils.getPrimaryId(this.props.message)}_getFileKey(){return de.a.getFileKeyByMessage(this.props.message)}_bindProgress(){[h.MSG_LOCAL,h.MSG_FAIL].includes(this.props.message.status)&&this.props.message.cliMsgId&&(this._bindingProgress=this.props.message.cliMsgId,xt.a.bindProgress(this.props.message.cliMsgId,this._onProgress.bind(this)),!ks&&this.props.message.subType&&this.props.message.subType===h.MSG_FOLDER&&this.props.message.subState===h.MSG_FOLDER_STATE.ZIPPING&&xs.bindProgress(this.props.message.cliMsgId,this._onProgress.bind(this)))}render(){return null}}function Fs(e){const{isMe:t}=e;return l.a.createElement(ce.a,null,l.a.createElement("div",{className:"file-message "+(t?"me":"")},l.a.createElement("div",{className:"file-message__content-container",style:{height:"49px"}})))}var Gs=l.a.memo(Fs);class Bs extends Us{constructor(e){super(e),this.state=Object(i.a)({},this.state)}shouldComponentUpdate(e,t){return this.props.message.reacts!==e.message.reacts||this.props.shouldShowStatus!==e.shouldShowStatus||this.state.store.params!==t.store.params||this.props.message.status!==e.message.status||this.props.message.isLastMsg!==e.message.isLastMsg||this.props.message.isErrorInfo!==e.message.isErrorInfo||this.props.message.sendError!==e.message.sendError||this.props.onContextMenu!==e.onContextMenu||this.props.showInFolder!==e.showInFolder||this.props.className!==e.showInFolder}_loading(){return this._utils.loading({store:this.state.store,props:this.props})}render(){var e;const{msgAction:t,reaction:s,onContextMenu:a,className:i,sendTime:o,thread:r,displayName:c,onDoubleClick:d,onMouseOver:h,onMouseLeave:u,onTouchStart:_,onTouchEnd:m,isSignAdminMsg:p}=this.props,{fileIcon:g,fileThumb:E,fileTitle:f,fileTextInfo:I,fileActionDisplay:T,clickAction:v,isMe:S,notLoading:N}=this._loading(),b={onMouseOver:h,onMouseLeave:u,onTouchStart:_,onTouchEnd:m};if(N)return l.a.createElement(Gs,Object(n.a)({isMe:S},this.props));let C=l.a.createElement("div",{className:"flx",style:{marginTop:"10px"}},o);const A="0"===this.props.message.fromUid&&(this.props.message.isLastMsg?"div_LastSentMsg_File":"div_SentMsg_File")||this.props.message.isLastMsg&&"div_LastReceivedMsg_File"||"div_ReceivedMsg_File";return l.a.createElement(R.a,{ttl:null===(e=this.props.message)||void 0===e?void 0:e.ttl,isAdmin:p},l.a.createElement("div",Object(n.a)({ref:this.props.forwardedRef},b,{className:Object(O.a)("file-message","card--file",S&&"me",i),"data-id":A,onClick:v,onContextMenu:a,onDoubleClick:d}),c,l.a.createElement("div",{className:"file-message__container"},E,l.a.createElement("div",{className:"file-message__content-container",style:{minHeight:"49px"}},g,l.a.createElement("div",{className:"file-message__content"},f,l.a.createElement("div",{className:"file-message__content-info-container"},I,T)))),l.a.createElement("div",{className:"file-message__others"},C,t,s)))}}var Hs=s("XIhW"),js=s("bhNC");function Vs(e,t){const{className:s}=e,a=Object(ue.a)(e,["className"]),{pIdOrMsgId:i}=e,[o]=Object(Hs.a)(i),r=Object(_e.a)(t,o),[c]=Object(js.a)(e),d=Object(Ae.a)(i,ye.z),h=Object(O.a)(s,d&&"-expired");return l.a.createElement(l.a.Fragment,null,l.a.createElement(Bs,Object(n.a)({},a,{className:h,forwardedRef:r})),l.a.createElement("div",{ref:c,className:"fmsg-observers__item"}))}var Ks=l.a.memo(l.a.forwardRef(Vs)),Ws=s("ggG7"),Ys=s("8euG"),zs=s("/YHU");function qs(e){e&&(e.preventDefault(),e.stopPropagation())}function Xs(e,t){const s=l.a.useMemo((()=>function(e){var t,s;const a=e.message||e.file;let n=`${a.msgId}`.includes("_")?null:""+a.msgId,i="0"==a.fromUid?I.default.getSessionUserId():a.fromUid;const o=de.a.utils.getPrimaryId(a),{FileChatModel:r}=de.a.models;let l=null;(a.isErrorInfo||a.status==h.MSG_FAIL)&&(a.cancelled||(l=a.subType&&23==a.subType?{strKey:"STR_ERR_UPLOAD_FILE_FOLDER_ERROR",strKeyParams:[]}:{strKey:"STR_ERR_UPLOAD_FILE_ERROR",strKeyParams:[]}));const c=de.a.utils.getMessageFileParams(a),d=Object(zs.a)(c),u=(null==d?void 0:d.fdata)&&Object(zs.a)(null==d?void 0:d.fdata),_=null!=(t=null==u?void 0:u.upSrc)?t:a.upSrc,m=null!=(s=null==u?void 0:u.reader)?s:a.reader,p=new r({params:c,conversationId:de.a.utils.getMessageConversationId(a),fileUrl:de.a.utils.getFileMessageUrl(a),status:de.a.utils.getFileMessageStatus(a),indicatorState:de.a.utils.getFileMessageIndicatorState(a),extraInfo:{fromUid:i,localPath:de.a.utils.getLocalPath(e),folderPath:de.a.utils.getFolderPath(e),sendTime:a.sendDttm,cancelUpload:a.cancelled,sendFileError:l,upSrc:_,reader:m}});return de.a.dispatch(he.FileActionType.Init,{data:p,id:{p:o,s:n}}),o}(e)),[]),{setTrustedFileMsg:a}=e,o=function(e){const{showActionInjectable:t,pIdOrMsgId:s}=e,a=Object(Ws.a)(e),n=Object(Ae.a)(s,ye.j),i=Object(Ae.a)(s,ye.i);return l.a.useCallback((e=>t(e,{contextMenu:!0,message:a,localPath:n,folderPath:i})),[a,t,n,i])}(e=Object(i.a)(Object(i.a)({},e),{},{pIdOrMsgId:s})),r=Object(Ws.a)(e);l.a.useEffect((()=>{a&&a(r)}),[r,a]);const c=function(e){const t=Object(Ys.a)(e);return l.a.useCallback((function(e){return e&&(e.preventDefault(),e.stopPropagation()),t&&t()}),[t])}(e);return l.a.createElement(Ks,Object(n.a)({ref:t},e,{onContextMenu:o,onDoubleClick:qs,showInFolder:c}))}var Js=l.a.memo(l.a.forwardRef(Xs));var Qs=l.a.forwardRef((function(e,t){return l.a.createElement(ce.a,null,l.a.createElement(Js,Object(n.a)({},e,{ref:t})))})),$s=(s("qhFK"),s("FqlO")),Zs=s("kzSZ"),ea=s("PcUO"),ta=s("AM4K"),sa=s("lCn6"),aa=s("nxrR"),na=s("sAzz");let ia;g.default.isWeb()||(ia=s("Dprd").default);let oa=150;const ra=200,la="IMAGE",ca="TITLE";class da extends l.a.Component{constructor(e){super(e),this.hasCaption=!1,this.state={isError:!1,isStopped:!1,hasExif:!1,titleSelected:!1,imageSelected:!1},this._onLoaded=()=>{this.setState({isStopped:!0,isError:!1}),delete this.props.message.error},this._onError=e=>{this.error=e,this.setState({isStopped:!0,isError:!0}),this.props.message&&(this.props.message.error=e),na.g(e,this.props.message)},this._onReload=()=>{this.setState({isStopped:!1,isError:!1})},this._eventHandler=(e,t)=>{switch(e){case f.GeneralActions.LEFTPANEL_RESIZE:}},E.default.subscribe(this._eventHandler),oa=242}shouldComponentUpdate(e,t){return!g.default.objectEqual(this.props.message,e.message)||this.props.sendTime!==e.sendTime&&(!this.props.sendTime||!e.sendTime)||this.props.className!==e.className||this.state.isStopped!==t.isStopped||this.state.isError!==t.isError||this.state.titleSelected!==t.titleSelected||this.state.imageSelected!==t.imageSelected||this.props.resending!==e.resending||this.props.localPath!==e.localPath||this.state.hasExif!=t.hasExif||this.props.hasReacts!==e.hasReacts||this.props.containerWidth!==e.containerWidth||this.props.showShareError!==e.showShareError||this.props.isMultiSel!==e.isMultiSel||this.props.selectedType!==e.selectedType}_updateImageDimension(){let e=this.props.message;if(e.message&&e.message.params&&e.status!=h.MSG_LOCAL&&e.status!=h.MSG_FAIL&&this.refs.mainImage&&(this.refs.mainImage.getImgDom()||this._imgEle))try{let t=this.refs.mainImage.getImgDom()||this._imgEle,s=JSON.parse(e.message.params);if(s){s.width=t.naturalWidth,s.height=t.naturalHeight;let a={width:t.naturalWidth,height:t.naturalHeight};this._checkExifResult&&(s.rotation=this._checkExifResult.rotation,s.flip=this._checkExifResult.flip,a.rotation=s.rotation,a.flip=s.flip),e.message.params=JSON.stringify(s),g.default.log("image-message: _updateImageDimension "+e.message.params),u.default.updateMessageParams(e.msgId,a,e)}}catch(t){g.default.logCoreError(t)}}_updateImageOrientation(e){let t=this.props.message;if(t.message&&t.message.params&&t.status!=h.MSG_LOCAL&&t.status!=h.MSG_FAIL)try{let s=JSON.parse(t.message.params);s&&(s.rotation=e.rotation,s.flip=e.flip,t.message.params=JSON.stringify(s),g.default.log("image-message: _updateImageRotation "+t.message.params),u.default.updateMessage(t.msgId,{flip:e.flip,rotation:e.rotation},t),(s.rotation||s.flip)&&(this.setState({hasExif:!0}),E.default.send(f.ChatBoxActions.IMG_HAS_EXIF,{msgId:t.msgId,orientation:s})))}catch(s){g.default.logCoreError(s)}}componentDidMount(){}componentDidUpdate(){this._rotateImgEle()}_rotateImgEle(){let e=this._imgEle||this.refs.mainImage&&this.refs.mainImage.getImgDom(),t=this.refs.rotateCanvas;if(t&&e&&this._toLayoutImageManually&&e.naturalHeight>0&&e.naturalWidth>0){g.default.log("image-message: rotate 2");let s=e.src+"_"+t.width+"_"+t.height;if(s==this._rotated)return;let a=t.getContext("2d");a.save(),a.translate(t.width/2,t.height/2),a.rotate(this._toLayoutImageManually*Math.PI/180),a.drawImage(e,-t.height/2,-t.width/2,t.height,t.width),a.restore(),this._rotated=s}}componentWillUnmount(){E.default.unsubscribe(this._eventHandler)}_onImgRefAvail(e){this._imgEle=e}_onDoubleClick(e){g.default.isPhotoStickerMessage(this.props.message)&&this.props.replyMessage(this.props.message),e.preventDefault(),e.stopPropagation()}_selectedPhoto(e,t){if(t.stopPropagation(),this.props.isMultiSel){const{onChooseMsg:e,message:s,selectedMsg:a}=this.props,n=e=>{this.setState({titleSelected:e,imageSelected:e})};if(a.hasOwnProperty(s.msgId)){let a=Object.assign({},a[s.msgId]);n(!1,!1),e&&e(a,t)}else s&&(s.message=Object(i.a)(Object(i.a)({},(null==s?void 0:s.message)||{}),{},{title:""}),n(!0,!0),e(s,t))}else e===la&&this.props.imageClickHandler&&this.props.imageClickHandler(t)}_editPhoto(){let e=this.props.localPath;if(!e){e=ia.getZaloImagesPath(this.props.conversation.userId,this.props.userId)+ia.getCachedMainImageName(this.props.message.message.oriUrl,this.props.message.msgId)}ea.a.openEditor(e,this.props.message.message.hdUrl||this.props.message.message.oriUrl)}_deriveSize(e,t={}){const s=e.width||t.width,a=e.height||t.height;return{width:s||798,height:a||368,defaultSize:null==s||null==a}}render(){let e=this.props.message,t=this.props.imageClickHandler,s=Object(O.a)(this.props.className,"card--picture ","image-message","-bg-v-"+T.c.image.bg_v," "),a=u.default.getTaskSetting()||{},o=this.props.reaction,r=this.props.thread,c=this.props.sendTime;if(c){let e=c.props,{children:t}=e,s=Object(ue.a)(e,["children"]);c=l.a.createElement(c.type,s,t,r)}else r&&(c=l.a.createElement("div",{className:"card-send-time"},r));let d=!1;if(!e||null==e.fromUid||"0"!=e.fromUid&&e.fromUid!=this.props.userId||(d=!0),e&&e.message){g.default.log("image-message: render image-message "+e.cliMsgId,JSON.stringify(e.message));let u,E=g.default.removeProtocol(e.message.oriUrl),f=null,I={maxHeight:"368px"},T=!E||"function"!=typeof E.startsWith||!E.startsWith("blob:"),v=this.props.conversation?{userId:this.props.conversation.userId,lastMessageTime:this.props.conversation.lastMessageTime,msgType:e.msgType,msgId:e.msgId}:{};this.props.conversation?u=this.props.conversation.isGroup:e&&e.toUid&&e.toUid.constructor===String?u=e.toUid.startsWith(h.GROUPID_PREFIX):(g.default.logCoreError("cant detect group!! fallback to false"),u=!1);const S=e.status===h.MSG_LOCAL||e.status===h.MSG_FAIL;let N=e.message.title;switch(!N&&r&&(N=" "),e.msgType){case h.MSG_TEXT:if(this.props.forceType!=h.MSG_SUBTYPE_PHOTO&&this.props.forceType!=h.MSG_SUBTYPE_GIF)break;case h.MSG_PHOTO:case h.MSG_PHOTO_2:{var _,m,p;let c=this.props.containerWidth-oa+40,u=null,b={},C={};const A=g.default.safeParseJson(e.message&&e.message.params)||{},y=this._deriveSize(e,A),{width:M,height:P}=g.default.clampSizeToContain({srcWidth:y.width,srcHeight:y.height,minWidth:180,minHeight:110,maxWidth:Math.min(798,isNaN(c)?798:c),maxHeight:368});let w={defaultSize:y.defaultSize,rotation:A.rotation,flip:A.flip,width:M,height:P},L="var(--grey-600)",k=!1;(e.properties&&e.properties.type===h.MSG_BUBBLE_LAYOUT_TYPE_NO_BORDER||g.default.isPhotoStickerMessage(e))&&(this._toLayoutImageManually=!0,k=!0,L="transparent");let x={width:w.width,height:w.height,backgroundColor:L},U=!1;I=Object.assign(I,x);const F=parseFloat(w.width),B=parseFloat(w.height);let H=!1;const j=!0;if(N){if(null||(u=this.props.renderHtmlMessage(N,e.mentions)),H=this.props.isMultiSel&&e.msgType!==h.MSG_UNDO&&e.msgType!==h.MSG_DEL_EVERYONE&&u,u){if(this.hasCaption=!0,N){6.5*e.message.title.length-F>=50&&(U=!0,b.width=Math.max(F,ra)-24+"px",C.width=Math.max(F,ra)-24+"px",I.minWidth="200px")}U||(b.width=F-24+"px",C.width=F-24+"px")}e&&e.extra&&e.extra.todoInfo&&u&&1===a.ui_v2&&(u=l.a.createElement(Z,{data:e.extra.todoInfo,htmlInner:u,user:{userId:this.props.userId},confirm:this.props.confirm,dispatch:this.props.dispatch,focusId:this.props.focusId}))}(F<=150||F<=ra&&U)&&F<=ra&&U&&(I.minHeight=`${Math.min(368,ra/(F/B))}px`);let V=this._onLoaded;w.defaultSize&&(V=e=>{this._onLoaded(),this._updateImageDimension()});let K=null,W=Object(i.a)({},I),Y=!1;if(void 0===w.rotation&&this._checkExifResult&&(Object.assign(w,this._checkExifResult),this._updateImageOrientation(this._checkExifResult)),void 0===w.rotation)K=this._updateImageOrientation.bind(this);else{if(this._checkExifResult={rotation:w.rotation,flip:w.flip},w.rotation)if(W=Object(i.a)({},I),90==Math.abs(w.rotation)){let e=W.width;W.maxWidth=W.maxHeight,delete W.maxHeight,W.width=W.height,W.height=e;const t=(B-F)*(w.rotation>0?1:-1);W.transform=`rotate(${w.rotation}deg)`,I.minHeight||(W.transform+=` translate(${Math.round(t/2)}px, ${Math.round(t/2)}px)`)}else W.transform="rotate("+w.rotation+"deg)";w.flip&&(null==W.transform?W.transform="scaleX(-1)":W.transform+=" scaleX(-1)"),g.default.log("image-message: render obj "+JSON.stringify(W))}delete W.backgroundColor;const z=this.props.selectedType,q=e=>z===h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL||this.props.selectedType===h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_PARTIAL&&(e===la&&this.state.imageSelected||e===ca&&this.state.titleSelected);let X,J=()=>{};this.props.isMultiSel&&u&&(J=e=>this._selectedPhoto(ca,e)),X=ia?ia.getImageTimestamp(e.msgId):e.timestamp;const Q=this.props.message&&this.props.message.previewThumb,$=null!=(_=null===(m=this.props.message)||void 0===m?void 0:m.cliMsgId)?_:null===(p=this.props.message)||void 0===p?void 0:p.msgId,ee=!this.state.isStopped||this.state.isError,te=na.h(this.state.isError,this.error);ee&&(W.backgroundColor="transparent"),ee&&(W.opacity=0);let se=l.a.createElement(R.a,{variant:"photo",ttl:null==e?void 0:e.ttl,isAdmin:this.props.isSignAdminMsg},l.a.createElement(G.d,{key:"img-main",ref:"mainImage",isDoomCached:!0,simpleConvInfo:v,userId:this.props.userId,checkExifHandler:K,conversationId:this.props.conversation.userId,className:Object(O.a)("chat-message-picture chat-message-picture__photo ",u&&"caption",ee&&"-has-lqip",te===$s.a.Expired&&"-expired"),checkUrls:!0,src:E,alternates:Object(G.e)(G.a.QualityOnly,e),refProp:this._onImgRefAvail.bind(this),style:W,timestamp:X,onLoad:V,onError:this._onError,onReload:te===$s.a.Expired?void 0:this._onReload,msgId:e.msgId,isLocalMsg:S,onFilePathUpdated:this.props.onFilePathUpdated,autoRetryWhenNetworkIsBack:!1,checkRedirect:!this.props.forceType,showLoadingIconOnChecking:!0,onClick:this._selectedPhoto.bind(this,la),draggable:T,doNotShowRetry:te===$s.a.Expired})),ae=this.props.sendTime;r&&(r=l.a.createElement("div",{style:{margin:`0 -5px ${d?10:0}px`}},r)),ae&&ae.props?ae=l.a.createElement(ae.type,Object(n.a)({},ae.props,{onClick:J,style:Object(i.a)(Object(i.a)({},ae.props.style),{},{width:C.width})}),ae.props.children,r):r&&(ae=l.a.createElement("div",{className:"card-send-time",onClick:J,style:{width:b.width}},r)),f=l.a.createElement("div",{className:s+(u?" has-caption":"has-no-caption")+(H&&q(ca)?" caption-selected":"")+(H&&q(la)?" image-selected":""),key:"img-container",onContextMenu:this.props.onContextMenu},this.props.displayName,l.a.createElement(aa.a,{key:"img-overlay",value:{isImageMessage:!0,conversationId:this.props.message&&this.props.message.toUid,sendDttm:this.props.message&&this.props.message.sendDttm}},l.a.createElement("div",{className:(k?"":"flx flx-center chat-message-picture__photooverlay")+(u?"__caption":""),onDoubleClick:this._onDoubleClick.bind(this),ref:e=>this._overlay=e,key:"img-overlay",style:Object(i.a)(Object(i.a)({},I),{},{display:"block",position:"relative"}),onContextMenu:e=>this.props.onContextMenu(e,!0)},ee&&l.a.createElement($s.b,{className:"chat-message-picture__lqip",previewThumb:Q,seed:$,variant:te,blurLevel:"medium",caption:!0}),l.a.createElement("div",{className:"card--picture__high-definition "+(e.message.hdUrl&&!H?" show":" hidden")},"HD"),ea.a.isEnableFeature()?l.a.createElement("div",{className:"card--picture__edit-photo "+(j?" show":" hidden"),onClick:this._editPhoto.bind(this)},l.a.createElement("i",{className:"btn fa fa-edit-icon",style:{fontSize:"16px",position:"absolute",right:"5px"}})):null,this.props.showShareError?l.a.createElement("div",{style:{height:"100%"}},l.a.createElement("div",{className:Object(O.a)("expired-image-overlay",ee&&"-bg-blur")},l.a.createElement("div",{className:"expired-container"},l.a.createElement("i",{className:"fa fa-alert-circle icon-size-l"}),l.a.createElement(D.a,{textKey:"STR_EXPIRED",className:"text-size-l"}))),se):l.a.createElement("div",{className:"flx flx-center chat-message-picture__doodleoverlay"},l.a.createElement("div",{className:"flx chat-message-picture__doodleoverlay__container"},se)),Y?l.a.createElement("canvas",{key:"rotateCanvas",ref:"rotateCanvas",style:{borderRadius:"8px",cursor:"pointer"},onClick:t,width:parseFloat(W.width),height:parseFloat(W.height)}):null)),u?l.a.createElement("div",{key:"img-caption",className:"chat-message-caption"+(null!=this.props.sendTime||r?"":" chat-message-caption__border"),onClick:J,style:b},u):null,u?null:o,ae,u?o:null,this.props.msgAction);break}case h.MSG_GIF:{let t={height:"160px"},a=g.default._estimateSize(e,this.props.containerWidth-oa),n=!this.props.localPath&&!this.state.isStopped&&e.message.thumbUrl&&e.message.thumbUrl!=E;g.default.log("msg-gif: load thumb first "+n);let i="transparent",r={width:a.width,height:a.height,backgroundColor:i};t=Object.assign(t,r);let d={};n&&(d={width:t.width,height:t.height,display:"flex",justifyContent:"center",alignContent:"center",position:"absolute",top:0,left:0});const h="0"===this.props.message.fromUid&&(this.props.message.isLastMsg?"div_LastSentMsg_GIF":"div_SentMsg_GIF")||this.props.message.isLastMsg&&"div_LastReceivedMsg_GIF"||"div_ReceivedMsg_GIF";f=l.a.createElement("div",{className:s,key:"img-container",onContextMenu:this.props.onContextMenu},this.props.displayName,l.a.createElement("div",{style:t,key:"img-main-wrapper",className:"chat-message-picture__gif__wrapper","data-id":h},n?l.a.createElement("div",{style:d,key:"gif-preload"},l.a.createElement("div",{className:"preloader-container",style:{borderRadius:"8px"},key:"preload-container"},l.a.createElement("div",{className:"preloader"})),l.a.createElement("img",{src:g.default.removeProtocol(e.message.thumbUrl),key:"gif-thumb",className:"chat-message-picture__gif__thumb",style:t})):null,l.a.createElement(R.a,{variant:"photo",ttl:null==e?void 0:e.ttl,isAdmin:this.props.isSignAdminMsg},l.a.createElement(G.d,{key:"img-main",message:e,source:"message",isGif:!0,refProp:e=>this._imgEle=e,userId:this.props.userId,isDoomCached:!0,simpleConvInfo:v,conversationId:this.props.conversation.userId,style:t,className:"chat-message-picture chat-message-picture__gif",onLoad:this._onLoaded,onError:this._onError,src:E,msgId:e.msgId,isLocalMsg:S,onFilePathUpdated:this.props.onFilePathUpdated,autoRetryWhenNetworkIsBack:!0,checkRedirect:!this.props.forceType,placeholder:l.a.createElement(Zs.a,{size:30}),draggable:T}))),o,c,this.props.msgAction);break}case h.MSG_DOODLE:{let a,n=g.default._estimateSize(e,this.props.containerWidth-oa),i={width:n.width,height:n.height};I=Object.assign(I,i),a=ia?ia.getImageTimestamp(e.msgId):e.timestamp;let r=l.a.createElement(R.a,{variant:"photo",ttl:null==e?void 0:e.ttl,isAdmin:this.props.isSignAdminMsg},l.a.createElement(G.d,{userId:this.props.userId,conversationId:this.props.conversation.userId,className:"chat-message-picture chat-message-picture__doodle",style:I,refProp:e=>this._imgEle=e,isDoomCached:!0,simpleConvInfo:v,src:E,alternates:[{src:e.localPath,isLocal:!0}],msgId:e.msgId,isLocalMsg:S,onFilePathUpdated:this.props.onFilePathUpdated,autoRetryWhenNetworkIsBack:!0,timestamp:a,hideBroken:!0,showLoadingIconOnChecking:!0,onClick:t,placeholder:l.a.createElement(Zs.a,{size:30}),draggable:T}));f=l.a.createElement("div",{className:s,onContextMenu:this.props.onContextMenu,onDoubleClick:this._onDoubleClick.bind(this)},this.props.displayName,this.props.showShareError?l.a.createElement("div",{style:{height:"100%"}},l.a.createElement("div",{className:"expired-image-overlay"},l.a.createElement("div",{className:"expired-container"},l.a.createElement("i",{className:"fa fa-alert-circle icon-size-l"}),l.a.createElement(D.a,{textKey:"STR_EXPIRED",className:"text-size-l"}))),r):l.a.createElement("div",{className:"flx flx-center chat-message-picture__doodleoverlay"},l.a.createElement("div",{className:"flx chat-message-picture__doodleoverlay__container"},r)),o,c,this.props.msgAction);break}}return f}return l.a.createElement("div",{className:s+" loading"},this.props.displayName,l.a.createElement(se,{urgency:e.urgency}),l.a.createElement("img",{src:T.c.staticNew+"/images/loading.gif",width:"24"}),o,c,this.props.msgAction)}}var ha=da,ua=s("8G4C"),_a=s("xrk1"),ma=s("n4Tl");var pa=function({ciId:e,show:t=!0}){const s=_a.g(ma.l,e);return l.a.createElement("div",{className:Object(O.a)("qu-ba",s&&t?"-hd":"-none")})},ga=s("bavj"),Ea=(s("IZCB"),s("fjQr")),fa=s("h9Os");var Ia=function(e){const{children:t,selected:s,zIndex:a,className:n}=e,o=Object(ue.a)(e,["children","selected","zIndex","className"]),r=l.a.useMemo((()=>Object(i.a)(Object(i.a)({},t.props.style),{},{"--overlay-zindex":a})),[a,t.props.style]);return l.a.cloneElement(t,Object(i.a)(Object(i.a)({},o),{},{style:r,className:Object(O.a)("msg-select-overlay",s&&"-msg-selected",n,t.props.className)}))},Ta=s("xxem");var va=function(e,t){},Ra=s("bt3N");function Sa(e){var t;null==e||null===(t=e.dataTransfer)||void 0===t||t.setData("_zlabel_img_","z_label_img_item")}function Oa(e){return Object(be.c)(Sa,e)}var Na=s("oxAw");const ba=e=>l.a.createElement("button",{className:"clickable flx flx-center flx-al-c extra-btn",style:null==e?void 0:e.btnStyle,key:e.id,onClick:t=>{t.preventDefault(),t.stopPropagation(),e.clickHandler(t)},onMouseOver:e=>e.stopPropagation()},e.iconClass&&l.a.createElement("i",{className:"fa "+e.iconClass+" extra-btn__icon",style:e.iconStyle||{}}),l.a.createElement(D.a,{className:"extra-btn__text",textKey:e.text}));var Ca=(e,t)=>l.a.createElement("div",{className:"chat-message__extra-btn-wrapper"},l.a.createElement("div",{className:"extra-btns flx "+t},e.map((e=>ba(e))))),Aa=s("mmLN"),ya=s("1F3s");const Da="img-msg-v2",Ma="img-msg-v2__rct";function Pa(e,t,s){Na.a.showReactBtnForKey(null==s?void 0:s.msgId);let a=(null==e?void 0:e.style)||{},n=null==e?void 0:e.message,o=null==n?void 0:n.items;return l.a.createElement("div",null,l.a.createElement("div",{style:Object(i.a)({userSelect:"none",display:"flex",justifyContent:"center"},a.txtContainer||{})},null!=o&&o.length?l.a.createElement("div",{style:{whiteSpace:"pre-wrap"}},o.map(((e,t)=>function(e,t){return e?l.a.createElement("span",{style:Object(i.a)({whiteSpace:"pre-wrap"},e.s||{})},e.t):null}(e)))):null),0!=s.fromUid&&null!=n&&n.btn?l.a.createElement("div",{className:"seasonal__template__bubble__textv2",onClick:e=>{e.stopPropagation(),e.preventDefault(),Na.a.clickReactBtn(s)},style:a.styleContainer},a.icon?l.a.createElement("i",{className:a.icon+" seasonal__template__bubble__text_icon",style:a.styleIcon}):null,l.a.createElement("div",{className:"seasonal__template__bubble__text_content",style:a.styleText},t)):null)}function wa(e,t){return l.a.createElement(Ea.a,{className:"img-msg-v2__err",errorName:e,errorArgs:t,caption:!0})}const La=l.a.createElement(fa.a,{className:"img-msg-v2__expr",caption:!0}),ka=Object(Aa.a)(6),xa=l.a.forwardRef((function(e,t){var s,a;const{message:n,containerWidth:o,displayName:r,isSignAdminMsg:c,highlight:d,onDragStart:u,msgAction:_,reaction:m,sendTime:p,showActionInjectable:E,onFilePathUpdated:f,className:v}=e,S=l.a.useMemo((()=>_a.f.extractLocalCiIdFromMsg(n)),[null==n?void 0:n.cliMsgId]);ka(T.c.image.enable_con_rt,T.c.image.con_rt_msg_wave,T.c.image.con_rt_msg_len,S);let N=Object(be.a)((e=>E(e,{contextMenu:!0,message:n})));Object(Ra.b)(S),va(S,f),Object(ya.a)(S);const b=_a.j(ma.m(S,I.default.getSessionUserId())),[C,A]=_a.g(ma.j,S),[y,D]=function(e,t,s){const a=l.a.useMemo((()=>Math.min(798,s-237)),[s]);return l.a.useMemo((()=>{let[s,n]=Object(ga.d)(e,t,a,368);return[Math.max(150,s),Math.max(110,n)]}),[e,t,a])}(C,A,o),M=function(e,t,s,a){return l.a.useDebugValue({correctedW:e,correctedH:t,thumbConWidth:s,title:a}),l.a.useMemo((()=>!(t/e<=T.c.img_msg.unlock_cap_width_ratio)&&String(a).length*T.c.char_width/s>T.c.img_msg.unlock_cap_width_line),[e,t,s,a])}(C,A,y,null==n||null===(s=n.message)||void 0===s?void 0:s.title),[P,w,L]=function(e,t){const[s,a]=_a.g(ma.b,e);return l.a.useMemo((()=>t?["scale-down"]:s<T.c.cover_threshold_w||a<T.c.cover_threshold_h?s<a?["cover","width",T.c.cover_threshold_w]:["cover","height",T.c.cover_threshold_h]:["scale-down"]),[s,a,t])}(S,M),k=l.a.useMemo((()=>({width:M?void 0:y,height:D})),[y,D,M]),x=null==n||null===(a=n.message)||void 0===a?void 0:a.title,[U,F,G,B,H]=function(e){const t=l.a.useRef();t.current=e;const[[s,a],n]=l.a.useState([!0,!0]),o=l.a.useCallback((function(e,s){if(s.stopPropagation(),t.current.isMultiSel){const e=Object(i.a)({},t.current.message),{selectedMsg:a,onChooseMsg:o}=t.current;if(a.hasOwnProperty(t.current.message.msgId)){const e=a[t.current.message.msgId];n([!1,!1]),o(e,s)}else e&&e.message&&(e.message=Object(i.a)(Object(i.a)({},(null==e?void 0:e.message)||{}),{},{title:""}),n([!0,!0]),o(e,s))}else e===Fa&&t.current.imageClickHandler&&t.current.imageClickHandler(s)}),[]),r=l.a.useCallback((function(e){var s,a;t.current.isMultiSel&&null!==(s=t.current.message)&&void 0!==s&&null!==(a=s.message)&&void 0!==a&&a.title&&o(Ga,e)}),[]),c=l.a.useCallback((function(e){o(Fa,e)}),[]),[[d,u],_]=l.a.useState([!1,!1]);return l.a.useEffect((()=>{var e,n;const i=!(null===(e=t.current.message)||void 0===e||null===(n=e.message)||void 0===n||!n.title);t.current.selectedType!==h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL?t.current.selectedType!==h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_PARTIAL?_([!1,!1]):_([a,i&&s]):_([!0,i])}),[a,s,e.selectedType]),l.a.useDebugValue(d,u),[e.isMultiSel,d,u,c,r]}(e),j=Oa(u),V=_a.g(ma.k,S),K=g.default.getConversationType((null==n?void 0:n.toUid)||(null==n?void 0:n.userId)),W=new jt.c(jt.a.ChatBoxView).getBuilder().withType(jt.f.Photo).withMode(jt.e.Manual).withCode(jt.d.CBVMessage).withConvType(jt.b[K]).build(),Y=b&&(e.message.isLastMsg?"div_LastSentMsg_Photo":"div_SentMsg_Photo")||e.message.isLastMsg&&"div_LastReceivedMsg_Photo"||"div_ReceivedMsg_Photo";return _a.i(S,{comp:"image-msg"}),l.a.createElement(Ta.a,{weight:1e6},l.a.createElement("div",{ref:t,className:Object(O.a)(v,Da,x&&"-caption",b&&"-me",n.status==h.MSG_FAIL&&"-fail",M&&"-unlock-cap-width",U&&"-multi-select",c&&n.message.title&&!n.ttl&&"-admin",d&&"-highlight",w&&`-min-dim-${w}`,"-bg-v-"+T.c.image.bg_v),style:{"--thumb-cw":`${y}px`,"--min-threshold":`${L}px`},onContextMenu:N,"data-id":Y},l.a.createElement("div",{className:"img-msg-v2__dn"},r),l.a.createElement(R.a,{ttl:x&&n.ttl,isAdmin:c,variant:"photo"},l.a.createElement("div",{className:"img-msg-v2__bub"},l.a.createElement(R.a,{ttl:!x&&(null==n?void 0:n.ttl),isAdmin:c,variant:"photo"},l.a.createElement(Ia,{selected:F},l.a.createElement(ua.a,{className:"img-msg-v2__th",ciId:S,thumbWidth:y,thumbHeight:D,style:k,errorRenderer:wa,expired:La,onClick:B,maxLoss:T.c.image.msg_photo_max_loss,fit:P,onDragStart:j,dragSrc:V,entrySerial:W}))),l.a.createElement(pa,{ciId:S}),l.a.createElement(Ia,{selected:G},l.a.createElement("div",{className:"img-msg-v2__ft",onClick:H},x&&l.a.createElement("div",{className:"img-msg-v2__cap"},l.a.createElement(se,{urgency:n.urgency}),function(e){var t;const{message:s,renderHtmlMessage:a,forceShowCardBtnTitle:n}=e;if(n){let e=Na.a.getMessageReact();if(e)return Pa(e,n,s)}const i=s.mentions;return a(null===(t=s.message)||void 0===t?void 0:t.title,i)}(e)),function(e){var t;const{message:s,msgAction:a,reaction:n,sendTime:i}=e,o=null===(t=s.message)||void 0===t?void 0:t.title;return l.a.createElement(l.a.Fragment,null,!o&&l.a.createElement("div",{className:Ma},n),i&&l.a.createElement("div",{className:"img-msg-v2__st"},i),!!o&&l.a.createElement("div",{className:Ma},n),a)}(e)))))))}));var Ua=Object(ce.b)(xa);const Fa="IMAGE",Ga="TITLE";var Ba=s("6U8Z");class Ha extends l.a.Component{constructor(e){super(e),this._openMap=this._openMap.bind(this)}_openMap(e,t){e.stopPropagation(),e.preventDefault(),V.b.open(t,!1,!0)}render(){let e=null;1===T.c.map_embeded_mode?e="https://maps.google.com/maps?ll="+this.props.content.lat+","+this.props.content.lo+"&z=14&output=embed":2===T.c.map_embeded_mode&&T.c.map_api_key&&(e=`https://www.google.com/maps/embed/v1/view?key=${T.c.map_api_key}&center=${this.props.content.lat},${this.props.content.lo}&zoom=14`);let t="https://maps.google.com/maps?q="+this.props.content.lat+","+this.props.content.lo+"&z=14&t=m&mapclient=embed";return l.a.createElement("div",{className:Object(O.a)(this.props.className+" card--location"),onContextMenu:this.props.onContextMenu},this.props.displayName,this.props.content.title?l.a.createElement("div",{style:{marginBottom:"5px",fontWeight:"500"}},this.props.content.title):null,this.props.content.title&&this.props.content.desc?l.a.createElement("div",{style:{marginBottom:"10px"}},this.props.content.desc):null,e?l.a.createElement("div",{className:"flx flx-center flx-al-s rel clickable",onClick:e=>this._openMap(e,t)},l.a.createElement("div",{className:"marker-icon"},l.a.createElement("div",{className:"marker-icon__avatar",style:{backgroundImage:"url('"+this.props.senderAvatar+"')"}})),l.a.createElement("iframe",{style:{pointerEvents:"none"},width:"100%",frameBorder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:e})):l.a.createElement("div",null,!this.props.content.title&&l.a.createElement("div",null,this.props.content.desc),l.a.createElement("div",null,ta.a.getHtmlFromText(t,!0,this._openMap))),this.props.sendTime,this.props.msgAction,this.props.reaction)}}Ha.propTypes={content:d.a.object.isRequired};var ja=Ha,Va=s("k/Tv");class Ka extends l.a.Component{constructor(e){super(e),this._oaContextMenu=this._oaContextMenu.bind(this)}_oaContextMenu(e,t){this.props.oaContextMenu&&this.props.oaContextMenu(e,t)}openLink(e){H.a.checkLinkZaloShop(e)?(H.a.setLinkOpen(e),this.props.dispatch({type:f.SideBarActions.SELECT_TAB_ZALO_SHOP})):ne.b.isLinkRegister(e)?Va.a.registerFeature(!0):ne.b.isCatalogProductLink(e)?this.props.dispatch({type:f.GeneralActions.OPEN_LINK_CATALOG,payload:e}):window.open(e,"_blank")}renderHeader(e,t,s=!1){return l.a.createElement("div",{key:e.type+"_"+t,className:"oa-msg-header"+(s?" last ":""),onClick:()=>this.openLink(e.href),onContextMenu:e=>{this._oaContextMenu(e,t)}},l.a.createElement("div",{style:{backgroundImage:'url("'+g.default.removeProtocol(e.thumb)+'")',backgroundPosition:"center",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"},className:"oa-msg-header__img"}),l.a.createElement("div",{className:"oa-msg-header__title"},e.title),l.a.createElement("div",{className:"oa-msg-header__desc"},e.description))}renderChild(e,t,s=!1){return l.a.createElement("div",{key:e.type+"_"+t,onClick:()=>this.openLink(e.href),className:"oa-msg-child flx"+(s?" last ":""),onContextMenu:e=>{this._oaContextMenu(e,t)}},l.a.createElement("div",{style:{backgroundImage:'url("'+g.default.removeProtocol(e.thumb)+'")'},className:"oa-msg-child__img flx-fix"+(e.thumb?" no-bg":"")}),l.a.createElement("div",{className:"oa-msg-child__title flx flx-al-c"},e.title))}render(){let e=[];for(let t=0;t<this.props.message.length;t++){let s=this.props.message[t],a=t==this.props.message.length-1;switch(s.type){case"l.a.header.only":case"l.a.header.full":e.push(this.renderHeader(s,t,a));break;case"l.a.child.full":e.push(this.renderChild(s,t,a));break;default:g.default.logCoreError("OAMessage:unkown part type "+s.type)}}return l.a.createElement("div",{className:this.props.className+" card--oa",onContextMenu:this.props.onContextMenu},this.props.displayName,e,this.props.sendTime,this.props.msgAction)}}var Wa=Ka,Ya=s("MmWw");class za extends l.a.Component{constructor(e){super(e),this.state={thumbUrl:"",enablePreview:k.f.getYoutubePreview(e.userId)},this._thumbLink=this.props.url,this.active=!0}componentDidMount(){this._thumbLink&&this.checkLink()}componentWillUnmount(){this.active=!1}shouldComponentUpdate(e,t){return t.thumbUrl!=this.state.thumbUrl}checkHeaderFirst(){let e,t=this._thumbLink,s=["https://","http://","ftp://"];for(let a of s)if(t.startsWith(a))return e=a+"user:password@"+t.substr(a.length),void this.tryLoadImg(e);e="user:password@"+this._thumbLink,this.tryLoadImg(e)}checkLink(){1}tryLoadImg(e){if(g.default.isBlockedDomainImage(e))return;if(!g.default.validOpenUrl(e))return;let t=new Image;t.onload=()=>{this.active&&this.setState({thumbUrl:e})},t.onerror=e=>{},t.src=e}_openUrl(){V.b.open(this.state.thumbUrl)}render(){let e=this.props.url,t=null;if(e&&this.state.enablePreview)if(this.firstTime=!1,e=F.b.removeProtocol(e),e&&e.startsWith("mp3.zing.vn")){let s=F.b.getMp3CodeFromUrl("http://"+e);s&&(this._thumbLink=null,t=l.a.createElement("iframe",{className:"video-youtube__frame",scrolling:"no",width:"640",height:"180",src:s,frameBorder:"0",allowFullScreen:!1}))}else if(e&&(e.startsWith("youtube.com")||e.startsWith("youtu.be"))){let s=F.b.getYoutubeCodeFromUrl("https://www."+e);s&&(this._thumbLink=null,t=l.a.createElement("iframe",{className:"video-youtube__frame",allowFullScreen:!1,scrolling:"no",width:"640",height:"360",src:s,frameBorder:"0"}))}if(null==t&&!this.state.thumbUrl)return null;let s=this.props.onImageLoaded;return s=e=>{e.target&&this.props.onThumbUpdateSize&&this.props.onThumbUpdateSize({width:e.target.naturalWidth,height:e.target.naturalHeight})},l.a.createElement("div",{className:"image-link "+(t?"video-youtube":""),style:{textAlign:"center"}},t||l.a.createElement("img",{className:"chat-message-picture",onLoad:s,src:this.state.thumbUrl,style:{maxHeight:"200px"},onClick:this._openUrl.bind(this)}))}}var qa=za,Xa=s("NGyP"),Ja=s("79BI"),Qa=s("aQZC"),$a=s("Iawr"),Za=s("JDlE");const en=g.default.isWeb();let tn;en||(tn=s("Dprd").default);class sn extends l.a.Component{constructor(e){super(e),this.state={localPath:"",downloadError:!1},this._downloadCallback=this._downloadCallback.bind(this),this._retryDownload=this._retryDownload.bind(this)}shouldComponentUpdate(e,t){return this.state.localPath!==t.localPath||this.state.downloadError!==t.downloadError||!g.default.objectEqual(this.props.style,e.style)}_renderDuration(e){if(!e||isNaN(e))return null;let t=Math.round(e/1e3),s=Math.floor(t/60);return t%=60,g.default.strPadLeft(s+"","0",2)+":"+g.default.strPadLeft(t+"","0",2)}_downloadCallback(e,t){e?this.setState({downloadError:!0}):(this.setState({localPath:t}),this.props.onFilePathUpdated&&this.props.onFilePathUpdated(t))}_retryDownload(){this.refs.video&&(this.refs.video.componentWillMount(),this.setState({downloadError:!1}))}render(){const e=Object(i.a)({},this.props);let t;return t=en||this.state.localPath||this.state.downloadError?l.a.createElement("div",{className:"card--group-photo__row__item__content__play clickable",onClick:e.onClick,key:"video_play"},l.a.createElement("i",{className:"fa fa-play",style:{lineHeight:"17px",marginLeft:"4px"}})):l.a.createElement("div",{className:"card--group-photo__row__item__content__play clickable",key:"video_play"},l.a.createElement("i",{className:"fa fa-img-retry fa-spin spinner",style:{fontSize:"16px",padding:"0 2px 2px 2px"}})),delete e.onFilePathUpdated,l.a.createElement("div",{className:"card--group-photo__row__item__content",key:"msg_video"},l.a.createElement(m.a,Object(n.a)({ref:"video"},e,{downloadCallback:this._downloadCallback})),l.a.createElement("span",{className:"card--group-photo__row__item__content__duration"},this._renderDuration(e.message.message.duration)),t)}}sn.propTypes={userId:d.a.string.isRequired};var an=sn,nn=s("HhqI"),on=s("l+Fo");const rn="img-g-v2";function ln(e,t){return l.a.createElement(Ea.a,{className:"img-g-v2__err",errorName:e,errorArgs:t,caption:!1})}const cn=l.a.createElement(fa.a,{className:"img-g-v2__expr",caption:!1}),dn=90,hn=dn,un=Object(Aa.a)(5);let _n=l.a.forwardRef((function(e,t){const{message:s,className:a,style:i,onFilePathUpdated:o,isDynamicLayout:r,onDragStart:c,isMultiSelect:d}=e,h=Object(ue.a)(e,["message","className","style","onFilePathUpdated","isDynamicLayout","onDragStart","isMultiSelect"]),u=l.a.useMemo((()=>_a.f.extractLocalCiIdFromMsg(s)),[]);un(T.c.image.enable_con_rt,T.c.image.con_rt_grthumb_wave,T.c.image.con_rt_grthumb_len,u),Object(Ra.b)(u),Object(ya.a)(u);const{width:_=dn,height:m=hn}=i,[p,g,E]=function(e,t,s,a){const[n,i]=_a.g(ma.j,e),o=l.a.useMemo((()=>{const e=Math.max(s/n,a/i);return 1-s*a/(Math.pow(e,2)*n*i)}),[n,i,s,a]),[r,c]=_a.g(ma.b,e);return r<T.c.cover_threshold_w||c<T.c.cover_threshold_h?r<c?["cover","width",T.c.cover_threshold_w]:["cover","height",T.c.cover_threshold_h]:t&&o>T.c.image.msg_group_max_loss?["scale-down"]:["cover"]}(u,r,_,m),f=function(e,t,s,a){const n=_a.g(ma.n,e,T.c.sendToMeId),i=l.a.useMemo((()=>n&&t?[on.c]:[]),[n,t]);return Object(on.d)(e,s,a,i)}(u,r,_,m),I=Oa(c),v=l.a.useMemo((()=>({"--min-threshold":`${E}px`})),[E]),R=_a.g(ma.k,u);return _a.i(u,{comp:"image-group"}),l.a.createElement(l.a.Fragment,null,l.a.createElement(ua.a,Object(n.a)({},h,{ref:t,className:Object(O.a)(rn,a,g&&`-min-dim-${g}`),ciId:u,srcSet:f,thumbWidth:_,thumbHeight:m,errorRenderer:ln,expired:cn,maxLoss:T.c.image.msg_group_max_loss,fit:p,style:v,onDragStart:I,dragSrc:R})),l.a.createElement(pa,{ciId:u,show:!d}))}));_n=Object(ce.b)(_n);var mn=_n,pn=(s("W4HJ"),s("Z2tZ")),gn=s("G4W6"),En=s("5tQl"),fn=s("oNsl"),In=s("7fJY");const Tn=g.default.isWeb(),vn=1,Rn=2,Sn=3,On=4;let Nn,bn;Tn||(Nn=s("Dprd").default,bn=s("Cwh7"));class Cn extends l.a.Component{constructor(e){if(super(e),!Tn){const{ipcRenderer:e}=s("vbkW");this.ipc=e}this.imageLocalPath={},this.state={checkedLocalPath:!1,resetLayout:!1,forceRender:!1},this.limitShowDynamic=T.c.dynamic_layout_photo.total_limit,this.border=4,T.c.dynamic_layout_photo&&(this.props.photos&&this._preGridPhoto(this.props.photos),this._configDynamicLayout()),this.focusedElement=[],this._groupPhotoRowRefs=new Map,this.selectedPhoto={},this._onFilePathUpdated=this._onFilePathUpdated.bind(this),this.findPhotoByIdInGroup=this.findPhotoByIdInGroup.bind(this),this.onResize=g.default.throttle((()=>{var e;(null===(e=this.props.photos)||void 0===e?void 0:e.length)<4&&(this._configDynamicLayout(),this._preGridPhoto(this.props.photos),this.setState({forceRender:!this.state.forceRender}))}),500),this.enableFileStoreComp=fn.a.isActivated("enable_file_store_comp")}_configDynamicLayout(e){var t;let s=280;if((this.gridPhotoMap?En.a.getLengthSkeleton(this.gridPhotoMap):this.props.photos.length)<4&&(!e||(null==e||null===(t=e.photos)||void 0===t?void 0:t.length)<4)){let e=document.getElementById("messageViewContainer");s=Math.ceil(e.offsetWidth-150),s<280?s=280:s>450&&(s=450)}this.gridPhotoMap&&this.gridPhotoMap.length==En.a.getLengthSkeleton(this.gridPhotoMap)&&(s=335),this.maxWidth=s}_equalSendTime(e,t){return!e&&!t||!(!e&&t||!t&&e)&&(!(!e||!t)&&e.key==t.key)}shouldComponentUpdate(e,t){return!this.props.photos.equals(e.photos)||!this._equalSendTime(this.props.sendTime,e.sendTime)||this.props.className!==e.className||!g.default.arraysEqual(this.props.focusId,e.focusId)||this.state.resetLayout!==t.resetLayout||this.state.checkedLocalPath!==t.checkedLocalPath||this.props.isSelected!==e.isSelected||this.state.forceRender!==t.forceRender||this.props.isMultiSel!==e.isMultiSel||this.props.selectedMsg!==e.selectedMsg||this.props.isMouseMoveSelecting!==e.isMouseMoveSelecting}componentWillMount(){window.addEventListener("resize",this.onResize),g.default.log("image-group-message: Mount")}componentWillUpdate(e){var t,s,a,n;this.props.photos.equals(e.photos)||(((null===(t=this.props.photos)||void 0===t?void 0:t.length)>=4&&(null===(s=e.photos)||void 0===s?void 0:s.length)<4||(null===(a=this.props.photos)||void 0===a?void 0:a.length)<4&&(null===(n=e.photos)||void 0===n?void 0:n.length)>=4)&&this._configDynamicLayout(e),this._preGridPhoto(e.photos),this.props.photos.length>e.photos.length&&this.props.message&&En.a.disableGroupPhotoSkeleton(this.props.message))}componentDidMount(){for(let[e,t]of this._groupPhotoRowRefs.entries())gn.a.observe(t,{identifier:e,onIntersect:this.props.onMsgIntersect.bind(null,e),threshold:.7})}componentWillUnmount(){this.timeoutSkeleton&&(clearTimeout(this.timeoutSkeleton),this.cacheId&&En.a.deleteCache(this.cacheId)),window.removeEventListener("resize",this.onResize),g.default.log("image-group-message: componentWillUnmount");for(let[e,t]of this._groupPhotoRowRefs.entries())gn.a.unobserve(t)}componentWillReceiveProps(e){this.props.focusId!==e.focusId&&(this.focusedElement=[]),this.props.isSelected&&!e.isSelected?this.selectedPhoto={}:(e.isSelected&&!Object.keys(this.selectedPhoto).length||this.props.isSelected&&e.isSelected&&Object.keys(this.selectedPhoto).length&&Object.keys(this.selectedPhoto).length!==this.props.selectedMsg[this.props.message.msgId].message.length||this.props.isSelected&&this.reMapSelected)&&(this.selectedPhoto={},e.selectedMsg[this.props.message.msgId].message.forEach((e=>{this.selectedPhoto[e.msgId]=!0,this.setState({forceRender:!this.state.forceRender})})),this.reMapSelected=!1)}mountCallback(e){if(g.default.log("image-group-focus: not mounted"),this.focusedElement&&this.focusedElement.length){let t=[];this.focusedElement.forEach((e=>{e&&t.push({ele:e,ref:null})})),e(t,null,!0)}}_onFilePathUpdated(e,t){e&&e.msgId&&(this.imageLocalPath[e.msgId]=t,this.setState({checkedLocalPath:!this.state.checkedLocalPath}),e.msgType!==h.MSG_VIDEO&&e.subType!==h.MSG_SUBTYPE_MEDIA_VIDEO&&e.msgType!==h.MSG_PHOTO||(u.default.updateImage(e.msgId,{msgId:e.msgId,localPath:t},["localPath"]),u.default.updateMessage(e.msgId,{msgId:e.msgId,localPath:t},["localPath"]),this.props.dispatch({type:f.ChatBoxActions.FILEPATH_UPDATED,payload:e})))}_resendMessage(e,t){if(t.resend&&t.resend.content&&t.resend.content.photos)for(let s=0;s<t.resend.content.photos.length;s++){let e=t.resend.content.photos[s];e.photoBundle&&(e.photoBundle=null)}t.forwardFail?this.props.shareMessage(e,t,t.toUid):t.resend&&this.props.resendMessage(t.resend,t),e&&(e.preventDefault(),e.stopPropagation())}_showInFolder(e,t){t&&(t.preventDefault(),t.stopPropagation());let s=this.imageLocalPath[e.msgId];Nn&&s&&Nn.fileExists(s).then((t=>{t?Nn.showInFolder(s):(X.a.createError(y.default.str("STR_TOAST_FILE_NOT_FOUND")),this.imageLocalPath[e.msgId]="",this.setState({checkedLocalPath:!this.state.checkedLocalPath}))})),ee.e.logAction(107190903)}_onDownloadFileDone(e,t,s,a=!0,n=""){if(!e&&g.default.isWindows()&&(s||n)){const e=Date.now();T.c.recent_photo.enableFeature&&g.default.isWindows()&&pn.a.setPhotoDownload({isLocalFile:!0,path:s,lastModified:e,name:bn.basename(s),shortenPath:g.default.getShortenPath(s,40),fromSource:"DownloadedPhoto"})}}showAction(e,t){t=Object(In.a)(t),this.props.showMessageAction(e,!0,t,this.imageLocalPath[t.msgId],this._resendMessage.bind(this),this._showInFolder.bind(this,t),(e=>{if(e&&(e.preventDefault(),e.stopPropagation()),!Tn&&t&&(t.msgType===h.MSG_PHOTO||t.msgType===h.MSG_DOODLE||t.msgType===h.MSG_VIDEO)&&t.message.oriUrl){var s;const e=t.msgType===h.MSG_VIDEO?Ht.a.constants.DownloadType.Video:Ht.a.constants.DownloadType.Photo;let a=g.default.getConversationType(null===(s=this.props.conversation)||void 0===s?void 0:s.userId),n=new jt.c(jt.a.ChatBoxView).getBuilder().withType(t.msgType===h.MSG_VIDEO?jt.f.Video:jt.f.Photo).withMode(jt.e.Manual).withCode(jt.d.CBVPhotoGr).withConvType(jt.b[a]).build();Ht.a.runByMsg(t,{entry:n,type:e,options:{srcAction:Ht.a.constants.srcAction.Manual,saveAs:!0,showProgress:{progressBar:!1,taskBar:!0},duplicate:!1}}).then((e=>{this.setState({isDownloading:!1});const{isFolder:s,savePath:a}=e||{};let n=s?"":a,i=s?i:"";this._onDownloadFileDone(!1,t&&t.msgId,n,!1,i)})).catch((e=>{this._onDownloadFileDone(e)}))}}))}_extractThumbSrcs(e,t){if(!e||!e.message)return[];const s=this.props.photos&&this.props.photos.length;if(!s)return[];const a=s>T.c.image.image_group_hd_limit?G.a.SmallFirst:G.a.QualityFirst;return Object(G.e)(a,e,t)}_extractThumbUrl(e){return g.default.removeProtocol(e&&e.message&&e.message.thumbUrl)}_renderDuration(e){if(!e||isNaN(e))return null;let t=Math.round(e/1e3),s=Math.floor(t/60);return t-=60*s,g.default.strPadLeft(s+"","0",2)+":"+g.default.strPadLeft(t+"","0",2)}_onClickNoPhoto(e){}_preGridPhoto(e){if(this.isDynamicLayout=this.props.photos.length<=this.limitShowDynamic,e&&e.length){const t=de.a.utils.safeParseJSON(e[0].message.params);let s=null;const a=e=>{this.gridPhotoMap=En.a.genSkeleton(e,this.props.message.msgId)};if(null!=t&&t.group_layout_id&&(this.cacheId=t.group_layout_id+"_"+e[0].fromUid,s=En.a.getGroupPhotoSkeleton(this.cacheId)),s){let n=En.a.normalizeSkeleton(s),i=En.a.getLengthSkeleton(n);this.hasSkeleton=!0,n&&i>=e.length?(i>e.length&&!this.timeoutSkeleton?this.timeoutSkeleton=setTimeout((()=>{En.a.deleteCache(t.group_layout_id+"_"+e[0].fromUid),a(e),this.hasSkeleton=!1,this.setState({forceRender:!this.state.forceRender})}),T.c.time_clear_cache_skeleton_group_photo):i==e.length&&this.timeoutSkeleton&&(clearTimeout(this.timeoutSkeleton),this.timeoutSkeleton=null),this.gridPhotoMap=n,this.isDynamicLayout=i<=this.limitShowDynamic):a(e)}else this.hasSkeleton=!1,a(e)}}findPhotoByIdInGroup(e){if(this.hasSkeleton){for(let s of this.props.photos)try{let t=JSON.parse(s.message.params);if(t.id_in_group>=0&&t.id_in_group==e)return s}catch(t){g.default.logCoreError("show dynamic layout",t)}return null}return this.props.photos[e]}render(){g.default.log("image-group-message: render "+this.props.photos.length),this.focusedElement=[];let e=Object(O.a)(this.props.className,"card--group-photo","-bg-v-"+T.c.image.bg_v),t=0,s=0,a=[];const o=(e,a,o,r=null,c)=>{var d;let u=this.props.photos[s];this.isDynamicLayout&&(u=this.findPhotoByIdInGroup(s));let _=a,m=o,p=u?g.default.removeProtocol(u.message.oriUrl):null,E=u?g.default.removeProtocol(u.message.thumbUrl):null,f=(u&&g.default.removeProtocol(u.message.normalUrl),null),I=e=>{if(e.stopPropagation(),!this.props.isMultiSel||this.props.isMouseMoveSelecting){if(!this.props.isMultiSel){if(u.msgType===h.MSG_VIDEO){let e=[];e.push(u);const t={user:this.props.user,selectedId:u.msgId,oriUrl:u.message.oriUrl,userId:this.props.userId,isVideo:u.msgType===h.MSG_VIDEO||2===u.subType,message:u,conversation:this.props.conversation,isMessageConv:!0,images:e,iconMap:v.a.getIconMap(),appConfig:Object(T.d)()};return void S.a.openPhotoViewer(t)}this.props.onClickImage(u)}}else{if(this.props.selectedMsg.hasOwnProperty(this.props.message.msgId)){let t=!1,s=Object.assign({},this.props.selectedMsg[this.props.message.msgId]);for(let a=0;a<s.message.length;a++){let n=s.message[a];if(n.msgId==u.msgId){s.message.splice(a,1),delete this.selectedPhoto[n.msgId],s.message.length&&Object.keys(this.selectedPhoto).length?this.props.increaseCountMsg&&!g.default.isPreventCountSelectMessage(n)&&this.props.increaseCountMsg(-1):(this.props.onChooseMsg(s,e),this.selectedPhoto={},t=!0),this.setState({forceRender:!this.state.forceRender});break}if(a==s.message.length-1){this.props.increaseCountMsg&&!g.default.isPreventCountSelectMessage(u)&&this.props.increaseCountMsg(1)&&(s.message.push(u),this.selectedPhoto[u.msgId]=!0,this.setState({forceRender:!this.state.forceRender}));break}}t||this.props.onMultiSelGroupPhoto(this.props.message.msgId,s)}else{let t=Object.assign({},this.props.message);for(let e=0;e<t.message.length;e++){let s=t.message[e];if(s.msgId==u.msgId){t.message=[s],this.selectedPhoto[u.msgId]=!0,this.setState({forceRender:!this.state.forceRender});break}}this.props.onChooseMsg(t,e)}e.preventDefault()}},N=this.props.isSelected&&u&&this.selectedPhoto.hasOwnProperty(u.msgId);N&&t++;let b="row_"+s;if(u)if(u.msgType===h.MSG_UNDO||u.msgType===h.MSG_DEL_EVERYONE)f=l.a.createElement("div",{key:"gimgu_"+u.cliMsgId,onClick:this.props.isMultiSel?I:this._onClickNoPhoto.bind(this),style:{width:_,height:m,borderRadius:"0px"},className:"card--group-photo__row__item__img chat-message-picture__photooverlay no-shadow-border undo flx flx-col flx-al-c flx-center"+("0"==u.fromUid?" me":"")+(N?" selected-overlay":"")},l.a.createElement("i",{className:"fa fa-icon-outline-picture",style:{fontSize:"30px",marginBottom:"5px"}}),l.a.createElement(D.a,{style:{fontSize:"14px"},textKey:u.msgType===h.MSG_UNDO?"STR_RECALLED":"STR_DEL_EVERYONE_GROUP_PHOTO"}));else if(u.status===h.MSG_FAIL)f=l.a.createElement("div",{className:"card--group-photo__row__item__content"+(N?" selected-overlay":""),key:"msg_fail",style:{width:_,height:m,borderRadius:"0px"}},l.a.createElement("div",{className:"card--group-photo__row__item__content__cover",style:{borderRadius:"0px"}},l.a.createElement("div",{className:"card--group-photo__row__item__content__retry clickable",onClick:e=>{this._resendMessage(e,u)}},l.a.createElement("i",{className:"fa fa-img-retry"}))),l.a.createElement(G.d,{key:u.cliMsgId,className:"card--group-photo__row__item__img "+("0"==u.fromUid?" me":""),style:{width:_,height:m,borderRadius:"0px"},onClick:I,src:p,alternates:[{src:u.localPath,isLocal:!0}],isLocalMsg:!0,userId:this.props.userId}));else if(u.msgType===h.MSG_PHOTO){var C;const e=this._extractThumbUrl(u)?"Cache":null,t=this._extractThumbSrcs(u,e);let s={alternates:t,src:null==t||null===(C=t[0])||void 0===C?void 0:C.url,cacheFolderName:e};s=window.devicePixelRatio>1?Object(i.a)(Object(i.a)({},s),{},{msgId:u.msgId,conversationId:this.props.conversation.userId,message:u}):Object(i.a)(Object(i.a)({},s),{},{message:u,msgId:u?u.msgId:null});const a={backgroundColor:"var(--grey-500)",overflow:"hidden",width:_,height:m,borderRadius:"0px"};f=l.a.createElement("div",{className:Object(O.a)("chat-message-picture__photooverlay",N&&"selected-overlay","no-shadow-border",u.message.hdUrl&&!this.props.isMultiSel&&!this.enableFileStoreComp&&"card--picture__high-definition-group"),key:"msg_photo",style:a},!this.enableFileStoreComp&&l.a.createElement(nn.a,Object(n.a)({key:u.cliMsgId,style:{width:_,height:m,borderRadius:"0px",objectFit:this.isDynamicLayout?"contain":"cover"},className:Object(O.a)("card--group-photo__row__item__img card--group-photo__row__item__photo clickable","0"==u.fromUid&&"me"),userId:this.props.userId,onClick:I},s,{mainImage:{src:p,msgId:u.msgId,conversationId:this.props.conversation.userId,alternates:[],onFilePathUpdated:e=>this._onFilePathUpdated(u,e)}})),this.enableFileStoreComp&&l.a.createElement(Ta.a,{key:u.cliMsgId,bonus:-c,weight:1e6},l.a.createElement(mn,Object(n.a)({key:u.cliMsgId,onClick:I,style:{width:_,height:m,borderRadius:"0px",objectFit:this.isDynamicLayout?"contain":"cover"},isDynamicLayout:this.isDynamicLayout,onFilePathUpdated:e=>this._onFilePathUpdated(u,e),isMultiSelect:this.props.isMultiSel},s))))}else u.msgType===h.MSG_VIDEO&&(f=l.a.createElement("div",{className:"card--group-photo__row__item__content"+(N?" selected-overlay":""),key:"msg_video",onClick:I,style:{width:_,height:m,borderRadius:"0px"}},l.a.createElement(an,{key:u.cliMsgId,className:"card--group-photo__row__item__img card--group-photo__row__item__video clickable "+("0"==u.fromUid?" me":""),style:{width:_,height:m,borderRadius:"0px"},userId:this.props.userId,cacheFolderName:"Cache",src:E,message:u,msgId:u.msgId,onFilePathUpdated:e=>this._onFilePathUpdated(u,e),conversation:this.props.conversation})));else f=l.a.createElement("div",{key:"msg_skeleton",style:{width:_,height:m,borderRadius:"0px"},className:"card--group-photo__row__item__img chat-message-picture__photooverlay no-shadow-border undo flx flx-col flx-al-c flx-center"+(N?" selected-overlay":"")});let A=(null!=r&&r.hasOwnProperty(vn)?" 8px":" 0px")+(null!=r&&r.hasOwnProperty(Rn)?" 8px":" 0px")+(null!=r&&r.hasOwnProperty(Sn)?" 8px":" 0px")+(null!=r&&r.hasOwnProperty(On)?" 8px":" 0px");return e.push(l.a.createElement(R.b,{key:b,ttl:null===(d=u)||void 0===d?void 0:d.ttl,isAdmin:this.props.isSignAdminMsg,width:_,height:m,tl:null!=r&&r[vn]?8:0,tr:null!=r&&r[Rn]?8:0,br:null!=r&&r[Sn]?8:0,bl:null!=r&&r[On]?8:0},l.a.createElement("div",{key:b,ref:e=>{u&&this._groupPhotoRowRefs.set(u.msgId,e),u&&this.props.focusId.indexOf(u.msgId)>=0&&this.focusedElement.push(e)},className:"card--group-photo__row__item"+(this.isDynamicLayout?"":" no-dynamic")+(u&&this.props.focusId.indexOf(u.msgId)>=0?" highlighted":""),style:{width:_,height:m,borderRadius:A,zIndex:this.props.isMultiSel?3:null},onContextMenu:e=>this.showAction(e,u)},f,(u&&u.loadSrc,null),this.props.isMultiSel?l.a.createElement("div",{className:"select-btn",style:{lefImgLoaderCtx:"5px",top:"6px"},onClick:I},l.a.createElement("i",{className:N?"fa fa-multiselect_checkbox_hover selected-msg ":" fa fa-multiselect-stroke-checkbox unselect-msg"}),N?null:l.a.createElement("i",{className:"fa fa-multiselect_checkbox_hover hover-unselected-msg"})):null))),s++,e};if(this.isDynamicLayout)for(let n=0;n<this.gridPhotoMap.length;n++){let e=[],t=this.gridPhotoMap[n],s=this.border*(t.length-1),i=0,r=0;for(let a of t)r+=parseFloat(a.w);r&&1-r>0&&(i=1-r);for(let a=0;a<t.length;a++){let r=t[a],l=(parseFloat(r.w)+i/t.length)*this.maxWidth-parseFloat(s/t.length),c=parseFloat(r.h)*this.maxWidth,d={};0==n&&0==a&&(d[vn]=1),0==n&&a==t.length-1&&(d[Rn]=1),n==this.gridPhotoMap.length-1&&a==t.length-1&&(d[Sn]=1),n==this.gridPhotoMap.length-1&&0==a&&(d[On]=1),o(e,l,c,d,n)}a.push(e)}else{let e=Math.ceil(this.props.photos.length/3);for(let t=0;t<this.props.photos.length;t++){let n=[];for(let a=0;a<3&&s<this.props.photos.length;a++){let s=90,a=90,i={};0==t&&(i[vn]=1),2==t&&(i[Rn]=1),t==3*e-1&&(i[Sn]=1),t==3*e-3&&(i[On]=1),o(n,s,a,i,e),t++}a.push(n),t--}}t<Object.keys(this.selectedPhoto).length&&(this.reMapSelected=!0,t=0);let r=0,c=!(d=this.props.message).message||!d.message.every((e=>e.msgType===h.MSG_UNDO||e.msgType===h.MSG_DEL_EVERYONE));var d;let u=null,_=this.props.sendTime?null:this.props.thread,m=this.props.message.fromUid===this.props.userId||"0"===this.props.message.fromUid,p="thread-photo-ico thr-photo"+(this.props.message.root>0&&!this.props.message.refMessageId?" rootmsg":"");u=c?!this.props.isMultiSel&&_?l.a.createElement("div",{className:"rl-react-thread"},this.props.reaction,l.a.createElement("div",{className:p,style:m?null:{margin:0}},_)):_?l.a.createElement("div",{style:{zIndex:3,position:"inherit"}},this.props.reaction,l.a.createElement("div",{className:p,style:m?null:{margin:0}},_)):l.a.createElement("div",{style:{zIndex:3,position:"inherit"}},this.props.reaction):null;const E="0"===this.props.photos[0].fromUid&&([...this.props.photos].pop().isLastMsg?"div_LastSentMsg_GrpPhoto":"div_SentMsg_GrpPhoto")||[...this.props.photos].pop().isLastMsg&&"div_LastReceivedMsg_GrpPhoto"||"div_ReceivedMsg_GrpPhoto";return l.a.createElement("div",{className:e,"data-id":E},this.props.displayName,a.map((e=>l.a.createElement(aa.a,{key:"row_"+r++},l.a.createElement("div",{className:"card--group-photo__row "+("0"==this.props.photos[0].fromUid?" me":"")},e)))),u,this.props.sendTime)}}Cn.propTypes={userId:d.a.string.isRequired};var An=Cn,yn=s("vSga"),Dn=s("u0hE"),Mn=s("vFc7"),Pn=s("Ys8R"),wn=s("r7Y6"),Ln=(s("XbxG"),s("Anfm")),kn=(s("yFRN"),s("x4D7"),s("outC")),xn=s("Py3H"),Un=s("RZHG"),Fn="assets/chat_btn_down_normal.e5d47e6206f9915ccf73ca193625a58a.png",Gn=s("1Kge");const Bn=g.default.isWeb();class Hn extends l.a.Component{constructor(e){if(super(e),!Bn){const{ipcRenderer:e}=s("vbkW");this.ipc=e}this.state={forceRender:!1},this.focusedElement=[],this.selectedPhoto={},this._groupStickerRowRefs=new Map}componentWillMount(){g.default.log("sticker-group-message: Mount")}componentDidMount(){for(let[e,t]of this._groupStickerRowRefs.entries())gn.a.observe(t,{identifier:e,onIntersect:this.props.onMsgIntersect.bind(null,e),threshold:.7})}componentWillReceiveProps(e){this.props.focusId!==e.focusId&&(this.focusedElement=[])}shouldComponentUpdate(e,t){return!this.props.items.equals(e.items)||!this._equalSendTime(this.props.sendTime,e.sendTime)||this.props.className!==e.className||!g.default.arraysEqual(this.props.focusId,e.focusId)||this.props.isSelected!==e.isSelected||this.state.forceRender!==t.forceRender||this.props.isMultiSel!==e.isMultiSel||this.props.selectedMsg!==e.selectedMsg||this.props.resending!==e.resending||this.props.isMouseMoveSelecting!==e.isMouseMoveSelecting}componentWillUnmount(){g.default.log("sticker-group-message: componentWillUnmount"),this.props.message&&this.props.message.message&&this.props.message.message.forEach((e=>{Gn.a.clearGroupId(e.msgId)}));for(let[e,t]of this._groupStickerRowRefs.entries())gn.a.unobserve(t)}_equalSendTime(e,t){return!e&&!t||!(!e&&t||!t&&e)&&(!(!e||!t)&&e.key==t.key)}mountCallback(e){if(g.default.log("sticker-group-focus: not mounted"),this.focusedElement&&this.focusedElement.length){let t=[];this.focusedElement.forEach((e=>{e&&t.push({ele:e,ref:null})})),e(t,null,!0)}}showAction(e,t){this.props.showMessageAction(e,!0,t,"",this.props.resendMessage,null,(e=>{e&&(e.preventDefault(),e.stopPropagation())}))}_onClickNoPhoto(e){this.props.isMultiSel&&e&&(e.stopPropagation(),e.preventDefault())}_onClickItem(e,t){if(!e.shiftKey)if(e.stopPropagation(),!this.props.isMultiSel||this.props.isMouseMoveSelecting)this.props.isMultiSel;else{if(this.props.selectedMsg.hasOwnProperty(this.props.message.msgId)){let s=!1,a=Object.assign({},this.props.selectedMsg[this.props.message.msgId]);for(let n=0;n<a.message.length;n++){let i=a.message[n];if(i.msgId==t.msgId){a.message.splice(n,1),delete this.selectedPhoto[i.msgId],a.message.length&&this.getSelectedMessages().length?this.props.increaseCountMsg&&!g.default.isPreventCountSelectMessage(i)&&this.props.increaseCountMsg(-1):(this.props.onChooseMsg(a,e),this.selectedPhoto={},s=!0),this.setState({forceRender:!this.state.forceRender});break}if(n==a.message.length-1){this.props.increaseCountMsg&&!g.default.isPreventCountSelectMessage(t)&&this.props.increaseCountMsg(1)&&(this.setState({forceRender:!this.state.forceRender}),a.message.push(t),this.selectedPhoto[t.msgId]=!0);break}}s||this.props.onMultiSelGroupPhoto(this.props.message.msgId,a)}else{let s=Object.assign({},this.props.message);for(let e=0;e<s.message.length;e++){let a=s.message[e];if(a.msgId==t.msgId){s.message=[a],this.selectedPhoto[t.msgId]=!0,this.setState({forceRender:!this.state.forceRender});break}}this.props.onChooseMsg(s,e)}e.preventDefault()}}getSelectedMessages(){return this.props.isSelected&&this.props.selectedMsg&&this.props.message&&this.props.selectedMsg[this.props.message.msgId]&&this.props.selectedMsg[this.props.message.msgId].message?this.props.selectedMsg[this.props.message.msgId].message:[]}isItemSelected(e){const t=this.getSelectedMessages();return!!t.length&&-1!==t.findIndex((t=>t.msgId===e))}render(){g.default.log("sticker-group-message: render "+this.props.items.length),this.focusedElement=[];let e=this.props.className+" card--group-sticker",t=[],s=0;const a=[],n=!(this.props.items.length>1&&this.props.items.every((e=>e.status===h.MSG_FAIL)));for(let o=0;o<this.props.items.length;o++){const i=this.props.items[o];let r=null;const c=this.isItemSelected(i.msgId),d=!!i.message.extInfo;c&&s++,(0==o||t.length>=3)&&(a.push(t),t=[]);const u=o===this.props.items.length-1&&0===t.length;if(i.msgType===h.MSG_UNDO||i.msgType===h.MSG_DEL_EVERYONE)r=l.a.createElement("div",{key:"gimgu_"+i.cliMsgId,className:"card--group-sticker__row__item__sticker no-shadow-border undo flx flx-col flx-al-c flx-center"+("0"==i.fromUid?" me":"")+(this.props.isMultiSel?" multi-select-mode":"")+(c?" selected-overlay":"")+(d?" fss":"")},l.a.createElement("i",{className:"fa fa-photo-undo",style:{fontSize:"30px",marginBottom:"5px"}}),l.a.createElement(D.a,{textKey:i.msgType===h.MSG_UNDO?"STR_RECALLED":"STR_DEL_EVERYONE_GROUP_PHOTO"}));else if(i.status===h.MSG_FAIL){let t=null;t=n?l.a.createElement("div",{className:"card--group-sticker__row__item__content__cover clickable",onClick:e=>{this.props.resendMessage(e,i)}},l.a.createElement("div",{className:"card--group-sticker__row__item__content__retry"},l.a.createElement("i",{className:"fa fa-img-retry"}))):l.a.createElement("div",{className:"card--group-sticker__row__item__content__cover clickable",onClick:e=>{e.preventDefault(),e.stopPropagation()}}),r=l.a.createElement("div",{className:"card--group-sticker__row__item__sticker"+(this.props.isMultiSel?" multi-select-mode":"")+(c?" selected-overlay":"")+" no-shadow-border"+(d?" fss":""),key:"msg_fail"},t,l.a.createElement(Ba.a,{content:i.message,message:i,className:e,disablePlay:!0}))}else i.msgType===h.MSG_STICKER&&(r=l.a.createElement("div",{className:"card--group-sticker__row__item__sticker"+(this.props.isMultiSel?" multi-select-mode":"")+(c?" selected-overlay":"")+" no-shadow-border"+(d?" fss":""),key:i.cliMsgId,onClick:e=>this._onClickItem(e,i),onDoubleClick:e=>this.props.onDoubleClick(i,!0,e)},l.a.createElement(Ba.a,{content:i.message,message:i,className:e,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,showStickerSet:this.props.showStickerSet,dispatch:this.props.dispatch})));t.push(l.a.createElement("div",{key:i.cliMsgId,ref:e=>this.props.focusId.indexOf(i.msgId)>=0?this.focusedElement.push(e):null,className:"card--group-sticker__row__item"+(this.props.focusId.indexOf(i.msgId)>=0&&1===this.props.focusType?" highlighted":""),onClick:e=>this._onClickItem(e,i),onContextMenu:e=>this.showAction(e,i),style:{zIndex:this.props.isMultiSel?3:null}},r,(i&&i.loadSrc,null),!u&&this.props.isMultiSel&&i.msgType!==h.MSG_UNDO&&i.msgType!==h.MSG_DEL_EVERYONE?l.a.createElement("div",{className:"select-btn",style:{left:"5px",top:"6px"}},l.a.createElement("i",{className:c?"fa fa-multiselect_checkbox_hover selected-msg ":" fa fa-multiselect-stroke-checkbox unselect-msg"}),c?null:l.a.createElement("i",{className:"fa fa-multiselect_checkbox_hover hover-unselected-msg"})):null))}t.length&&a.push(t),s<this.getSelectedMessages().length&&(this.reMapSelected=!0,s=0);let i=0;return l.a.createElement("div",{className:e+" card--sticker"},this.props.displayName,a.map((e=>l.a.createElement("div",{key:"row_"+i++,ref:e=>{this._groupStickerRowRefs.set(this.props.items[0].msgId,e)},className:"flx flx-row"+("0"==this.props.items[0].fromUid?" me":"")},e))),this.props.sendTime)}}Hn.propTypes={userId:d.a.string.isRequired};var jn=Hn,Vn=s("ptyt"),Kn=s("Ullg"),Wn=s("dLnH");const Yn="photo-sticker-message";var zn=function(e){const{children:t,isHighlight:s}=e,a=l.a.useMemo((()=>Object(i.a)({},t.props.style)),[t.props.style]);return l.a.cloneElement(t,{style:a,className:Object(O.a)(".msg-highlight",s&&"-highlighted",t.props.className)})};const qn=Kn.a.Constant.DisplayModeProps;function Xn(e={}){const{data:t={},message:s={},displayName:a,sendTime:n,isSelected:o,isHighlight:c,showMessageAction:d=((...e)=>e),resendMessage:u=(()=>{})}=e,_=Object(r.useMemo)((()=>{const[e,s]=Kn.a.Helper.getMessageSizeRender(t.width,t.height);return{width:e,height:s}}),[t.width,t.height]),m=Object(r.useCallback)((e=>{const a=Object(i.a)({},s);a.message=Object(i.a)(Object(i.a)({},a.message),{},{catId:t.cateId,id:t.stickerId}),d(e,!0,a,"",u,null,(function(e){e&&(e.preventDefault(),e.stopPropagation())}))}),[s.cliMsgId,t.stickerId,s.msgId]),p=Kn.a.Config.getMessageAnimationDuration(),g=Object(O.a)(Yn,s.status===h.MSG_FAIL&&"-fail");return l.a.createElement("div",{className:g},l.a.createElement("div",null,a),l.a.createElement(zn,{isHighlight:c},l.a.createElement(Ia,{selected:o},l.a.createElement(Wn.a,{className:"photo-sticker-message__content",data:t,width:_.width,height:_.height,mode:qn.PLAY_FIRST,animationDuration:p,onContextMenu:m,onlyUseLocal:!1}))),l.a.createElement("div",{className:"photo-sticker-message__st"},n))}Xn.propTypes={data:d.a.object.isRequired,message:d.a.object.isRequired,displayName:d.a.object,sendTime:d.a.object,isSelected:d.a.bool,isHighlight:d.a.bool,showMessageAction:d.a.func,resendMessage:d.a.func};var Jn=Xn,Qn=s("NSWB"),$n=s("UiPd"),Zn=s("f08i"),ei=s("k+R1");const ti=new Set([h.MSG_GIF,h.MSG_DOODLE,h.MSG_STICKER,h.MSG_STICKER_2,h.MSG_PHOTO_GROUP,h.MSG_STICKER_GROUP,h.MSG_VOICE,h.MSG_LOCATION]),si=new Set([h.MSG_PHOTO,h.MSG_PHOTO_2,h.MSG_VIDEO]),ai=new Set(["recommened.user","recommened.vip","recommened.misscall","recommened.calling","recommened.calltime","recommened.receivecall","recommened.stickerset"]);var ni=s("e5U2");const ii=g.default.isWeb();let oi,ri,li;ii||(oi=s("Dprd").default,ri=s("g+8e"),li=s("Cwh7"));class ci extends l.a.Component{constructor(e){var t;super(e),Object(o.a)(this,"onMsgIntersect",((e,t)=>{var s;t&&(null===(s=this.props.newMsgIds)||void 0===s?void 0:s.length)>0&&this.props.newMsgIds.includes(t)&&(this.props.clearLatestMessageAction&&this.props.clearLatestMessageAction(),this.props.newMsgIds[0]===t&&this.props.onSeeNewMsg&&this.props.onSeeNewMsg());const a=Vn.a.getLastSavedPosition(e);if(a){const{msgId:s}=a;s===t&&Vn.a.clearSavedPosition(e)}})),Object(o.a)(this,"_showMessageAction",((e,...t)=>{var s,a,n,i;return e?(e._isLast=this.props.isLast,null===(s=(a=this.props).showMessageAction)||void 0===s?void 0:s.call(a,e,...t)):null===(n=(i=this.props).showMessageAction)||void 0===n?void 0:n.call(i,e,...t)})),Object(o.a)(this,"onClickCallCallback",((e,t)=>{Object(P.f)(e,t,this.props.onCallCallback)}));let s=0,a=!1;oi&&e.message&&(s=oi.getDownloadProgress(e.message.msgId),a=void 0!==s,s=s||0),this.state={resending:!1,localPath:"",folderPath:"",downloadProgress:s,isDownloading:a,showShareError:!1,progressInBytes:0,downloadError:!1,thumbSize:{width:-1,height:-1},isContextMenuShown:!1,mouseOver:!1,stickerDownloadState:!1,forceUpdate:!1,blocked:!1,isShowTip:!1,aniHighlight:!1,enableEditUndo:!1,msgStatus:e.message?e.message.status:null},this.active=!0,this.parsed=!1,this.isSendTimeOutside=!1,this._parsedItem={},this.updatedThumbSize={},this._renderHtmlMessage=this._renderHtmlMessage.bind(this),this.getMemberFriendlyName=this.getMemberFriendlyName.bind(this),this._handleFileEvents=this._handleFileEvents.bind(this),this._onFilePathUpdated=this._onFilePathUpdated.bind(this),this._thumbUpdateSize=this._thumbUpdateSize.bind(this),this._oaOnContextMenu=this._oaOnContextMenu.bind(this),this._handleDoubleClick=this._handleDoubleClick.bind(this),this._shareMessage=this._shareMessage.bind(this),this._onChangeDownloadStickerCategories=this._onChangeDownloadStickerCategories.bind(this),this._imageClickHandler=this._imageClickHandler.bind(this),this._setTrustedFileMsg=this._setTrustedFileMsg.bind(this),this._showFileMsgQuickAction=this._showFileMsgQuickAction.bind(this),this._handleRef=this._handleRef.bind(this),this._resendMessage=this._resendMessage.bind(this),this.onMsgIntersect=this.onMsgIntersect.bind(this,null===(t=this.props.conversation)||void 0===t?void 0:t.userId),e.topMember&&(this.isGroup=!0),e.message&&e.message.quote&&this._updateQuoteOwnerDisplayName(e),this._handleSelection=this._handleSelection.bind(this),this.showActionInjectable=this.showActionInjectable.bind(this),this._enableDoubleClickReply=k.f.getFlag(this.props.user.userId,k.b,1),this.eventSettingHandler=(e,t)=>{switch(e){case f.GeneralActions.SETTING_CHANGED:this._enableDoubleClickReply=k.f.getFlag(this.props.user.userId,k.b,1);break;case f.ChatBoxActions.RESEND_PHOTO_THUMB:if(t&&t.message&&t.message.cliMsgId===this.props.message.cliMsgId&&t.message.conversationId===this.props.conversation.userId){let e=this.props.message.oriPath;ri.stat(t.filePath,((s,a)=>{if(s)return;let n;n=e&&"string"==typeof e?li.basename(e):"";let i={name:n,path:t.filePath,size:a.size,needReadBlob:!0,supportCached:!1};this.props.message.resend.content.photos[0].file=i,this._resendMessage()}))}}},this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),E.default.subscribe(this.eventSettingHandler)}componentWillMount(){let e=this.props.message;if(!this.timeOutEditUndo&&this.props.message&&this.props.message.msgType===h.MSG_UNDO){let e=Date.now()-this.props.message.sendDttm;e<T.c.time_enable_edit_undo_msg&&(this.setState({enableEditUndo:!0}),this.timeOutEditUndo=setTimeout((()=>{this.setState({enableEditUndo:!1})}),T.c.time_enable_edit_undo_msg-e))}if(!ii){let t=e.msgType;if(t===h.MSG_FILE){let t=e.msgId;u.default.getFilesByMsgIds([t]).then((s=>{let a=s[t];if(a&&t===a.msgId){if(a){let t={};return a.localPath&&(t.localPath=a.localPath),a.folderPath&&(t.folderPath=a.folderPath||e.folderPath),void((t.localPath||t.folderPath)&&this.setState(Object(i.a)(Object(i.a)({},t),{},{isDownloading:!1})))}if(a.downloadError)return void this.setState({downloadError:!0})}})),E.default.subscribe(this._handleFileEvents)}else t!==h.MSG_PHOTO&&t!==h.MSG_GIF&&t!==h.MSG_DOODLE&&t!==h.MSG_VIDEO||e.message&&e.message.oriUrl&&E.default.subscribe(this._handleFileEvents)}this.checkStickerDownloadState(),this.props.message&&(this._eventHandler=(e,t)=>{switch(e){case f.ConversationListActions.BLOCK_CONVERSATION:if(!t||!t.userId||this.props.message.msgType===h.MSG_CONTACT)break;if(this.props.message.msgType===h.MSG_CONTACT){let e=this.props.message.message;if(e&&"recommened.user"===e.action){e.params===t.userId&&this.setState({blocked:!!t.blocked})}}break;case f.ChatBoxActions.UPDATE_MSG_SUBSTATE:t&&t.entries[h.SHARE_FROM_MESSAGE]&&t.subState===h.MSG_FILE_EXPIRED&&t.originalMsgIds&&t.originalMsgIds[this.props.message.msgId]&&(this.setState({showShareError:!0}),this.errorTimer&&(clearTimeout(this.errorTimer),this.errorTimer=null),this.errorTimer=setTimeout((()=>{this.setState({showShareError:!1})}),5e3))}},E.default.subscribe(this._eventHandler))}getSingleStickerInGroup(e=this.props){return e.message?e.message.msgType!==h.MSG_STICKER_GROUP?null:e.message.message&&1===e.message.message.length&&e.message.message[0]?e.message.message[0].msgType===h.MSG_UNDO||e.message.message[0].msgType===h.MSG_DEL_EVERYONE?null:e.message.message[0]:null:null}checkStickerDownloadState(e=this.props){const t=this.getSingleStickerInGroup(e);if(e.message.msgType==h.MSG_STICKER||e.message.msgType==h.MSG_STICKER_2||t){const s=t||e.message;yn.g.getDownloadedCateIds().then((e=>{!e||e.length<=0||(this.downloadedStickerIds=e,s.message&&s.message.catId&&(this.downloadedStickerIds.indexOf(s.message.catId)>=0?this.setState({stickerDownloadState:!1}):yn.g.getStickerCategoriesV2().then((e=>{this.storeStickerIds=e.map((e=>e.id)),this.storeStickerIds.indexOf(s.message.catId)>=0?this.setState({stickerDownloadState:!0}):this.setState({stickerDownloadState:!1})}))))}))}}componentWillReceiveProps(e){if(this.props.message&&this.props.message.quote&&e.message&&e.message.quote&&this.props.message.quote.fromD!==e.message.quote.fromD&&this._updateQuoteOwnerDisplayName(e),this.props.message.msgType===h.MSG_FILE&&e.message.localPath&&this.setState({localPath:e.message.localPath}),this.props.message.msgType===h.MSG_FILE&&e.message.folderPath&&this.setState({folderPath:e.message.folderPath}),this.props.handleUpdateMsgIdInSelectMode&&this.props.isMultiSel&&this.props.message&&e.message){let t=this.props.message.msgId!==e.message.msgId;if(this.props.message.msgType===h.MSG_PHOTO_GROUP){t=this.props.message.message!==e.message.message}t&&this.props.handleUpdateMsgIdInSelectMode(this.props.message.msgId,e.message)}if(this.props.message.msgType===h.MSG_TEXT&&g.default.isSuccessfulMessage(this.props.message)){let s=Object(i.a)({},e.message),a=null;if(s.properties&&s.properties.ext&&!this.parseLink)try{a=JSON.parse(s.properties.ext)}catch(t){}if(a&&a.shouldParseLinkOrContact&&"string"==typeof s.message){let e=te.b.findFirstUrl(s.message,!0,!1);e&&(this.parseLink=!0,B.a.preParseLink(e).then((t=>{if(t&&t.href){if(t.href=e||t.href,t.thumb){B.a.tryGetMediaSize(t.thumb)}let a={action:"recommened.link",childnumber:0,description:t.desc,href:t.href,params:JSON.stringify({mediaTitle:t.title,artist:"",src:t.src,stream_icon:"",streamUrl:"",type:2}),thumb:t.thumb,title:s.message,type:""};s.msgType=h.MSG_CONTACT,s.message=a;let n=s.toUid.startsWith(h.GROUPID_PREFIX)||s.toUid==T.c.sendToMeId?1:1e3;setTimeout((()=>{Zn.a.receiveUpdate(s.toUid,s,"link",["message","ttl"])}),n),this.props.updateMessage(s)}})).catch((e=>{})))}}this.props.message.msgType===h.MSG_STICKER_GROUP&&this.props.message.message&&e.message.message&&1!==this.props.message.message.length&&1===e.message.message.length&&this.checkStickerDownloadState(e),Qn.b.isSameMsg(this.props.message,e.message)&&Un.a.shouldChangeStatus(this.state.msgStatus,e.message.status,this.props.message,e.message)&&Qn.b.isLastMsg(e.message)&&this.setState({msgStatus:e.message.status})}shouldComponentUpdate(e,t){if(this.props.message&&this.props.message.quote&&e.message&&e.message.quote&&this.props.message.quote.msg!=e.message.quote.msg)return!0;if(this.props.message.staredDttm!==e.message.staredDttm)return!0;if((e.message.msgType===h.MSG_PHOTO_GROUP||e.message.msgType===h.MSG_STICKER_GROUP)&&e.message.message&&e.message.message.length>0){if(e.message.message.length!==this.props.message.message.length)return!0;for(let t=0;t<e.message.message.length;t++)if(e.message.message[t].staredDttm!==this.props.message.message[t].staredDttm||e.message.message[t].status!==this.props.message.message[t].status||e.message.message[t].reacts!==this.props.message.message[t].reacts||e.message.message[t].msgType!==this.props.message.message[t].msgType)return!0}if(this.props.message&&206===this.props.message.sendErrorCode&&(this.props.conversation&&e.conversation&&this.props.conversation.isFr!==e.conversation.isFr||this.props.hasFriendRequest!==e.hasFriendRequest))return!0;if(this.props.message&&this.props.lastMsgIdFromFriend===this.props.message.msgId&&e.lastMsgIdFromFriend!==this.props.message.msgId)return!0;if(this.props.isSelected&&(this.props.message.msgType===h.MSG_PHOTO_GROUP||this.props.message.msgType===h.MSG_STICKER_GROUP)&&this.props.selectedMsg.hasOwnProperty(this.props.message.msgId)&&e.selectedMsg.hasOwnProperty(this.props.message.msgId)&&this.props.selectedMsg[this.props.message.msgId].message.length!==e.selectedMsg[this.props.message.msgId].message.length)return!0;if(this.props.isSelected&&this.props.message.msgType===h.MSG_PHOTO&&this.props.message.msgType===h.MSG_PHOTO_2&&this.props.selectedMsg.hasOwnProperty(this.props.message.msgId)&&e.selectedMsg.hasOwnProperty(this.props.message.msgId)&&this.props.selectedMsg[this.props.message.msgId].multipleSelectedType!==e.selectedMsg[this.props.message.msgId].multipleSelectedType)return!0;let s=!this.props.message&&e.message||this.props.message.status!=e.message.status||this.props.message.extra!==e.message.extra||this.props.message.subState!==e.message.subState||!g.default.objectEqual(this.props.message.message,e.message.message)&&e.message.msgType!==h.MSG_PHOTO_GROUP||this.props.message.msgType!==e.message.msgType||this.props.message.mentions!==e.message.mentions||this.props.message.reacts!==e.message.reacts||this.props.message.z_parsedTokens!==e.message.z_parsedTokens||this.props.message.root!==e.message.root||this.props.message.quote!==e.message.quote||this.props.isSelected!==e.isSelected||this.props.isShowReply!==e.isShowReply||this.props.isShowRemind!==e.isShowRemind||this.props.isShowSuggestCreateTodo!==e.isShowSuggestCreateTodo||this.props.isShowPromoteTodo!==e.isShowPromoteTodo||this.props.signAdminMsg!==e.signAdminMsg||this.state.showShareError!==t.showShareError||this.state.hasKeyword!==t.hasKeyword||e.focusId&&e.focusId.length>0&&this.props.message.searchKeyWord!=e.message.searchKeyWord||this.state.mouseOver!=t.mouseOver||this.props.isMultiSel!==e.isMultiSel||this.props.isMouseMoveSelecting!==e.isMouseMoveSelecting||this.props.isLast!==e.isLast||this.props.isFirst!==e.isFirst||this.state.resending!==t.resending||this.state.localPath!==t.localPath||this.state.folderPath!==t.folderPath||this.state.downloadProgress!==t.downloadProgress||this.state.progressInBytes!==t.progressInBytes||this.state.isDownloading!==t.isDownloading||this.props.shouldShowStatus!==e.shouldShowStatus||this.state.downloadError!==t.downloadError||this.props.isOnline!==e.isOnline||this.state.isContextMenuShown!==t.isContextMenuShown||this.state.stickerDownloadState!==t.stickerDownloadState||this.state.forceUpdate!==t.forceUpdate||this.state.blocked!==t.blocked||this.props.needRefresh!==e.needRefresh||this.state.isShowTip!==t.isShowTip||this.state.aniHighlight!==t.aniHighlight||this.state.enableEditUndo!==t.enableEditUndo||this.props.containerWidth!==e.containerWidth||this.state.msgStatus!==t.msgStatus;return this.props.focusId||e.focusId?!!(!this.props.focusId&&e.focusId||this.props.focusId&&!e.focusId)||(this.props.focusId.length!=e.focusId.length||s):s}_showPromoteTodo(e){!this.props.isShowPromoteTodo||e&&e.isShowPromoteTodo||(K.i.updatePromoteTodo(this.props.message.sendDttm,null,!0),this.showPromoteTimer&&(clearTimeout(this.showPromoteTimer),this.showPromoteTimer=null),this.showPromoteTimer=setTimeout((()=>{this.processOnMouseEnter({showPromoteTodo:!0,highLightTodoBtn:!0})}),100))}componentDidUpdate(e,t){if(this.refs&&this.refs.item_message&&(this.props.focusId.indexOf(this.props.message.msgId)>=0?(g.default.log("chatbox: focus handler"),this.props.focusHandler(this.refs.item_message)):this.props.message.msgType===h.MSG_PHOTO_GROUP&&this.imageGroupMessage?this.props.message.message.filter((e=>this.props.focusId.indexOf(e.msgId)>=0)).length&&this.imageGroupMessage.mountCallback(this.props.focusHandler):this.props.message.msgType===h.MSG_STICKER_GROUP&&this.imageGroupMessage&&this.props.message.message.filter((e=>this.props.focusId.indexOf(e.msgId)>=0)).length&&this.imageGroupMessage.mountCallback(this.props.focusHandler),!this.setupSelectListener&&g.default.canCopyText(this.props.message)?(this.refs.item_message.addEventListener("selectstart",this._handleSelection,!1),this.setupSelectListener=!0):this.setupSelectListener&&!g.default.canCopyText(this.props.message)&&(this.refs.item_message.removeEventListener("selectstart",this._handleSelection,!1),this.setupSelectListener=!1)),this._showPromoteTodo(e),this.props.onUpdateHeight&&this.refs.item_message){let e=this.refs.item_message.offsetHeight;this.props.onUpdateHeight(e)}!this.timeOutEditUndo&&this.props.message&&this.props.message.msgType!==e.message.msgType&&this.props.message.msgType===h.MSG_UNDO&&(this.setState({enableEditUndo:!0}),this.timeOutEditUndo=setTimeout((()=>{this.setState({enableEditUndo:!1})}),T.c.time_enable_edit_undo_msg))}componentDidMount(){this.refs&&this.refs.item_message&&(this.props.showTipQuickReply&&!this.state.isShowTip&&this.props.conversation&&0!=this.props.conversation.lastMessageUidFrom&&this.props.message.msgId==this.props.conversation.lastSmsLocalId&&this.refs.item_message.childNodes[0]&&this.refs.item_message.offsetWidth-this.refs.item_message.childNodes[0].offsetWidth>320&&this.setState({isShowTip:!0}),this.props.focusId.indexOf(this.props.message.msgId)>=0?(g.default.log("chatbox: focus handler"),this.props.focusHandler(this.refs.item_message)):this.props.message.msgType===h.MSG_PHOTO_GROUP&&this.imageGroupMessage?this.props.message.message.filter((e=>this.props.focusId.indexOf(e.msgId)>=0)).length&&this.imageGroupMessage.mountCallback(this.props.focusHandler):this.props.message.msgType===h.MSG_STICKER_GROUP&&this.imageGroupMessage&&this.props.message.message.filter((e=>this.props.focusId.indexOf(e.msgId)>=0)).length&&this.imageGroupMessage.mountCallback(this.props.focusHandler),g.default.canCopyText(this.props.message)&&(this.refs.item_message.addEventListener("selectstart",this._handleSelection,!1),this.setupSelectListener=!0),(this.props.message.msgType!==h.MSG_PHOTO_GROUP&&this.props.message.msgType!==h.MSG_STICKER_GROUP||!this.imageGroupMessage)&&gn.a.observe(this.refs.item_message,{identifier:this.props.message.msgId,onIntersect:this.onMsgIntersect.bind(null,this.props.message.msgId),threshold:.7},(()=>{const e=this.props.message.msgId;e&&this.props.newMsgIds&&this.props.newMsgIds[0]===e&&e&&this.props.newMsgIds&&this.props.newMsgIds[0]===e&&(gn.a.isElementInView(this.refs.item_message)||this.props.onNewMsgOutOfView&&this.props.onNewMsgOutOfView())})),Qn.b.isLastMsg(this.props.message)&&this.props.shouldShowStatus&&T.c.message_status.enable&&Un.a.isMsgBeforeOverflow(this.props.message)&&Un.a.getMessageStatus(this.props.message,this.props.conversation).then((e=>{this.setState({msgStatus:e})})).catch((e=>{g.default.logCoreError("cannot get status for msg",this.props.message.msgId)}))),this._showPromoteTodo(null)}_handleSelection(){this.props.handleSelection(this.props.message)}componentWillUnmount(){if(E.default.unsubscribe(this.eventSettingHandler),this._eventHandler&&(E.default.unsubscribe(this._eventHandler),delete this._eventHandler),this.refs&&this.refs.item_message&&(this.props.message.msgType!==h.MSG_PHOTO_GROUP&&this.props.message.msgType!==h.MSG_STICKER_GROUP||!this.imageGroupMessage)&&gn.a.unobserve(this.refs.item_message),!ii){this.props.message.msgType;h.MSG_FILE,E.default.unsubscribe(this._handleFileEvents)}this.setupSelectListener&&(this.refs&&this.refs.item_message&&this.refs.item_message.removeEventListener("selectstart",this._handleSelection,!1),this.setupSelectListener=!1),this.active=!1,this._clearQuickAction(),this._bindChangeDownloadSticker&&yn.g.removeChangeDownloadedStickerCategoriesCallback(this._bindChangeDownloadSticker),this.aniTimeout&&(clearTimeout(this.aniTimeout),this.aniTimeout=null),this.showPromoteTimer&&(clearTimeout(this.showPromoteTimer),this.showPromoteTimer=null),this.timeOutEditUndo&&(clearTimeout(this.timeOutEditUndo),this.timeOutEditUndo=null)}static renderUnicodeEmoji(e,t,s={},a="",n={}){return Ja.a.renderUnicodeEmoji(e,t,s,a,n)}static renderHtmlMessage(e,t,s,a,n,i,o=!1,r=null,c=!1,d=null,h=!1,u=!1,_,m,p,g=!1){return l.a.createElement(Ja.a,{msg:e,msgObj:d,key:"mtc",mentions:t,onShowProfile:s,getMemberFriendlyName:a,isFocus:o,setFirstLink:n,setEmojiOnly:()=>this._emoji=!0,searchKeyWord:r,preventBubbleEvent:c,dispatch:i,noWrap:h,shouldHighlightKeyword:u,maxLength:_,maxExtraLength:m,messageContainerWidth:p,showShortLink:g})}setFirstLink(e){this.firstLink=e,!0===this.forceParsingFailed&&(this.forceParsingFailed=!1,this.setState({forceUpdate:!this.state.forceUpdate}))}_updateQuoteOwnerDisplayName(e){if(!e.message)return;const t=e.message.quote,s=t.fromUid||t.ownerId;if(s===e.user.userId)t.fromD=e.user.displayName;else if(this.props.topMember){const a=$n.default.getDName(s);if(a)t.fromD=a;else{const a=e.topMember;for(let e of a)if(e.id===s){t.fromD=e.dName;break}}}else{const a=$n.default.getDName(s);t.fromD=a||e.senderName}}_renderHtmlMessage(e,t){let s=this.props.focusId.indexOf(this.props.message.msgId)>=0;return ci.renderHtmlMessage(e,t,this._showInfoHandler.bind(this),this.getMemberFriendlyName,this.setFirstLink.bind(this),this.props.dispatch,s,s?this.props.message.searchKeyWord:null,!1,this.props.message,!1,this.props.isShowRemind,void 0,void 0,this.props.containerWidth,!0)}_showInfoHandler(e,t){e===T.c.sendToMeId?u.default.getConversation(e).then((e=>{e?this.props.dispatch({type:f.ConversationListActions.SELECT_CONVERSATION,payload:e}):u.default.createEmptyConversationForUser(T.c.sendToMeId,0).then((e=>{e.conversation&&$n.default.getProfileFriendById(T.c.sendToMeId).then((t=>{const s=t;if(s){const t=Object.assign(e.conversation,s);this.props.dispatch({type:f.FetchActions.ADD_MESSAGES,payload:{conversationId:e.conversation.userId,messages:[],conversation:t}}),this.props.dispatch({type:f.ConversationListActions.SELECT_CONVERSATION,payload:t}),k.f.setFlag(this.props.user.userId,"z_sendtome_",Date.now())}}))}))})):(null==t&&(t=this.props.conversation.userId.startsWith(h.GROUPID_PREFIX)?h.FRIEND_REQUEST_SRC_GROUP_CHAT:h.FRIEND_REQUEST_SRC_CHAT),this.props.showInfoHandler(e,t))}_showStickerSet(e){try{if(e.constructor==Object)this.props.showStickerSet(e);else{let t=JSON.parse(e);this.props.showStickerSet(t)}}catch(t){}}_resendPhotoThumbMessage(e,t=!1){e&&(e.preventDefault(),e.stopPropagation());let s=this.props.message,a=s.localPath,n=s.oriPath,o=s.oriCheckSum||(a?li.basename(a).split(".").slice(0,-1).join("."):"");if(a&&n&&o)try{let t,i=ri.statSync(a);t=n&&"string"==typeof n?li.basename(n):"";let o={name:t,path:a,size:i.size,needReadBlob:!0,supportCached:!1};s.resend.content.photos[0].file=o,this._resendMessage(e)}catch(r){if(t)return;let a,l=this.props.message.cliMsgId+"_"+me.b.genId();a=setTimeout((()=>{clearTimeout(a),a=null,me.a.removeCallBack(l)}),15e3);let c={userId:this.props.user.userId,cliMsgId:s.cliMsgId,isSendThumbPhoto:!0,localPath:s.oriPath,message:{params:JSON.stringify({checksum:o}),title:li.basename(n)},dimension:{width:s.resend.content.photos[0].width,height:s.resend.content.photos[0].height},conversationId:this.props.conversation.userId};me.a.add({localPath:s.oriPath,options:{thumbKey:l,message:Object(i.a)(Object(i.a)({},c),{},{toUid:this.props.conversation.userId}),userId:this.props.user.userId,checksum:o||null,clientId:this.props.message.cliMsgId,dimension:this.props.message.dimension||null,callback:t=>{!t.error&&t.savePath&&(a&&(clearTimeout(a),a=null),this._resendPhotoThumbMessage(e,!0))}}})}}_resendMessage(e,t){if(e&&(e.preventDefault(),e.stopPropagation()),!this.state.resending||this.props.message.msgType===h.MSG_STICKER_GROUP){var s;let e,a=!0;t||(t=this.props.message),e=t.message.constructor===Array?t.message:[t],(null===(s=e)||void 0===s?void 0:s.length)>1&&(a=!1),this.setState({resending:!0}),e.forEach((e=>{if(e.forwardFail){let t=this.props.shareMessage(e,e.toUid,null,h.SHARE_FROM_MESSAGE);t&&t.then((()=>this.setState({resending:!1}))).catch((e=>{g.default.logCoreError(e),this.setState({resending:!1})}))}else if(e.resend){if(e.resend&&e.resend.content&&e.resend.content.photos)for(let t=0;t<e.resend.content.photos.length;t++){let s=e.resend.content.photos[t];s.photoBundle&&a&&(s.photoBundle=null)}this.props.resendHandler(e.resend,e).then((e=>{this.setState({resending:!1})})).catch((e=>{g.default.logCoreError(e),this.setState({resending:!1})}))}}))}}_deleteMessage(e){e.preventDefault(),e.stopPropagation();let t=this.props.message;this.props.deleteMessage(t)}getMemberFriendlyName(e){let t=$n.default.getDName(e);return t?"@"+t:null}_oaOnContextMenu(e,t){this.showAction(e,!1,!1,t)}showAction(e,t=!1,s=!1,a=0){this._showMessageAction(e,t,this.props.message,this.state.localPath,this._resendMessage.bind(this),this._showInFolder.bind(this),ii?this._manualWebDownload.bind(this):this._manualDownload.bind(this),s,a,this.state.folderPath)}showActionInjectable(e,{contextMenu:t=!1,onExtension:s=!1,indexOAChild:a=0,message:n=this.props.message,localPath:i=this.state.localPath,folderPath:o=this.state.folderPath}){this._showMessageAction(e,t,n,i,this._resendMessage.bind(this),this._showInFolder.bind(this),ii?this._manualWebDownload.bind(this):this._manualDownload.bind(this),s,a,o)}showTodoAction(e){this.props.showTodoAction&&this.props.showTodoAction(e,!1,this.props.message)}showMultiSelectAction(e){this.props.showMultiSelectAction(e,!0,this.props.message),e.preventDefault()}_onFilePathUpdated(e,t=""){const s=this.props.message;this.active&&this.setState({localPath:e,folderPath:t,isDownloading:!1}),s.msgType===h.MSG_FILE&&(s.localPath=e,s.folderPath=t,u.default.updateFile(s.msgId,{msgId:s.msgId,localPath:e,folderPath:t},["localPath","folderPath"])),s.msgType!==h.MSG_VIDEO&&s.msgType!==h.MSG_PHOTO||u.default.updateImage(s.msgId,{msgId:s.msgId,localPath:e},["localPath"]),u.default.updateMessage(s.msgId,{msgId:s.msgId,localPath:e,folderPath:t},["localPath","folderPath"]),this.props.dispatch({type:f.ChatBoxActions.FILEPATH_UPDATED,payload:s})}_handleFileEvents(e,t){switch(e){case f.ChatBoxActions.DOWNLOAD_MULTI_FILE_PROGRESS:case f.ChatBoxActions.DOWNLOAD_PROGRESS:t.msgId===this.props.message.msgId&&this.setState({downloadProgress:t.progress,isDownloading:!0,downloadError:!1,progressInBytes:t.progressInBytes});break;case f.ChatBoxActions.FILEPATH_UPDATED:if(t.msgId===this.props.message.msgId){const e={isDownloading:!1,downloadProgress:0,progressInBytes:0};t.ignoreDownloadPath||(t.error?e.downloadError=!0:(t.folderPath?e.folderPath=t.folderPath:this.props.message.folderPath&&(this.props.message.folderPath=t.folderPath),t.localPath?e.localPath=t.localPath:this.props.message.localPath&&(this.props.message.localPath=t.localPath),e.downloadError=!1)),this.setState(e)}}}_onDownloadFileDone(e,t,s,a=!0,n=""){if(!e&&(s||n)){if("granted"===$a.a.getPermissionNotifyLevel()&&!Qa.a.isActive()&&$a.a.isEnabled(this.props.user.userId)){let e;e=()=>{}}this.props.message&&(this.props.message.localPath=s,this.props.message.folderPath=n),ii||a||E.default.send(f.FetchActions.DOWNLOAD_DONE,{msgId:t,localPath:s,folderPath:n}),k.f.isSetSound(this.props.user.userId)&&Za.a.playNoti(),u.default.updateFile(t,{msgId:t,localPath:s,folderPath:n,downloadError:!1},["localPath","downloadError","folderPath"]),E.default.send(f.ChatBoxActions.FILEPATH_UPDATED,{msgId:t,localPath:s,folderPath:n});const e=Date.now();if(u.default.updateMessage(t,{msgId:t,localPath:s,folderPath:n},["localPath","folderPath"]),T.c.recent_photo.enableFeature&&g.default.isWindows()&&pn.a.setPhotoDownload({isLocalFile:!0,path:s,lastModified:e,name:li.basename(s),shortenPath:g.default.getShortenPath(s,40),fromSource:"DownloadedPhoto"}),a){if(n)return void oi.showInFolder(n);oi.openItem(s)}}}_openFile(e){e&&(e.preventDefault(),e.stopPropagation()),ee.e.logAction(1071910);const t=this.props.message;let s=g.default.isFolder(t.message.params);const a=s?this.state.folderPath:this.state.localPath;let n;try{n=JSON.parse(t.message.params)}catch(o){}const i=()=>{if(!this.props.isOnline)return void X.a.createError(y.default.str("STR_TOAST_CONNECTION_FAILED"));this.setState({isDownloading:!0});let e=t.message&&t.message.title?t.message.title:t.message;e&&"string"==typeof e||(e=""),oi.downloadFile(t,{completeChannel:`download-file-done-${t.msgId}`,completeCallback:this._onDownloadFileDone.bind(this),testChecksum:n.checksum,directory:oi.getZaloFilesPath(),fileName:e,existingPath:this.state.localPath},this.props.user.userId)};if(a)oi.fileExists(a).then((e=>{e?(ee.e.logAction(1560301),oi.openItem(a)):i()}));else{i();{let e={src:Lt.a.CHAT,targetId:(this.props.conversation||{}).userId,key:(t||{}).msgId};s?Lt.d.log(Lt.d.ACT.VIEW_FOLDER,e):Lt.c.log(Lt.c.ACT.VIEW,e)}}}_manualWebDownload(e){e.preventDefault(),e.stopPropagation(),this.messageAction&&this.messageAction.close();const t=this.props.message.message.href||"";Object(kt.a)(t),Lt.c.log(Lt.c.ACT.VIEW,{src:Lt.c.SRC.CHAT,targetId:(this.props.conversation||{}).userId,key:(this.props.message||{}).msgId})}_manualDownload(e){if(e.preventDefault(),e.stopPropagation(),this.messageAction&&this.messageAction.close(),ee.e.logAction(1071908),!this.props.isOnline)return void X.a.createError(y.default.str("STR_TOAST_CONNECTION_FAILED"));let t=new jt.c(jt.a.ChatBoxView).getBuilder().withMode(jt.e.Manual).withCode(jt.d.CBVMessage);const s=this.props.message,a=s.msgType==h.MSG_UNDO?-1:g.default.getSubtypeMessage(s),n=s.msgId;let o=!1;const r={};s.msgType===h.MSG_FILE?(t.withType(jt.f.File),this.setState({isDownloading:!0}),r.type=Ht.a.constants.DownloadType.File,r.options={saveAs:!0,srcAction:Ht.a.constants.srcAction.Manual,showProgress:{progressBar:!0,taskBar:!0}}):s.msgType===h.MSG_VIDEO?(t.withType(jt.f.Video),s.message&&s.message.oriUrl&&(o=!0,r.type=Ht.a.constants.DownloadType.Video,r.options={saveAs:!0,srcAction:Ht.a.constants.srcAction.Manual,showProgress:{progressBar:!1,taskBar:!0}})):s.msgType===h.MSG_GIF?(t.withType(jt.f.Photo),s.message&&s.message.oriUrl&&(o=!0,r.type=Ht.a.constants.DownloadType.Photo,r.options={saveAs:!0,srcAction:Ht.a.constants.srcAction.Manual,showProgress:{progressBar:!1,taskBar:!0}})):s.msgType!==h.MSG_PHOTO&&s.msgType!==h.MSG_DOODLE&&a!=h.MSG_SUBTYPE_PHOTO&&a!=h.MSG_SUBTYPE_GIF||(t.withType(jt.f.Photo),s.message&&s.message.oriUrl&&(o=!1,r.type=Ht.a.constants.DownloadType.Photo,r.options={saveAs:!0,srcAction:Ht.a.constants.srcAction.Manual,duplicate:!1,showProgress:{progressBar:!1,taskBar:!0}}));let l=g.default.getConversationType(null==s?void 0:s.toUid);t.withConvType(jt.b[l]),r.entry=t.build(),Ht.a.runByMsg(s,Object(i.a)({},r)).then((e=>{this.setState({isDownloading:!1});const{savePath:t,isFolder:s}=e,a=s?"":t,i=s?t:"";this._onDownloadFileDone(!1,n,a,o,i)})).catch((e=>{this._onDownloadFileDone(e,n)}))}_showInFolder(e){e.preventDefault(),e.stopPropagation(),this.messageAction&&this.messageAction.close();let t=g.default.isFolder(this.props.message.message.params);const s=t?this.state.folderPath:this.state.localPath;s&&oi.fileExists(s).then((e=>{e?oi.showInFolder(s):(X.a.createError(y.default.str("STR_TOAST_FILE_NOT_FOUND")),t?(this._onFilePathUpdated(this.state.localPath||this.props.message.localPath,""),E.default.send(f.ChatBoxActions.FILEPATH_UPDATED,{msgId:this.props.message.msgId,localPath:this.state.localPath||this.props.message.localPath,folderPath:""})):(this._onFilePathUpdated("",""),E.default.send(f.ChatBoxActions.FILEPATH_UPDATED,{msgId:this.props.message.msgId,localPath:"",folderPath:""})))})),this.props.message&&(this.props.message.msgType===h.MSG_FILE?ee.e.logAction(107190901):ee.e.logAction(107190902))}_isStared(){if(this.props.message){if(this.props.message.staredDttm)return!0;if(this.props.message.msgType===h.MSG_PHOTO_GROUP){let e=this.props.message.message;for(let t=0;t<e.length;t++)if(e[t].staredDttm&&e[t].msgType!==h.MSG_UNDO&&e[t].status!==h.MSG_FAIL)return!0}}return!1}_onAddFriend(e,t,s){s=g.default.getGroupIdFromConversationId(s),xn.a.setFriendRequestSource(e,h.FRIEND_REQUEST_SRC_ECARD,{uidTo:s}),this.props.dispatch({type:f.ChatBoxActions.SHOW_ADD_FRIEND,payload:e}),t&&t.stopPropagation(),ee.e.logAction(1550102)}_shareMessage(e,t=null,s=null){ee.e.logAction(1063803),t=t&&t.msgId?t:this.props.message,this.state.localPath&&(t.localPath=this.state.localPath),this.props.shareMessage(t,s,null,h.SHARE_FROM_MESSAGE),e&&(e.preventDefault(),e.stopPropagation())}_updateDBMessage(e,t=h.MSG_SUBTYPE_PHOTO){let s=this.props.message;if(s.status===h.MSG_LOCAL||s.status===h.MSG_FAIL)return;let a={};if(s.message.params&&(a=s.message.params),s.message)try{let n=this.firstLink;if(t===h.MSG_SUBTYPE_PHOTO||t===h.MSG_SUBTYPE_GIF){let i=s.message;a={width:e.width,height:e.height,hd:n,subType:t},s.message={action:"",childnumber:0,description:"",normalUrl:n,thumbUrl:n,oriUrl:n,title:i,type:""},Object.assign(s.message,{params:JSON.stringify(a)}),u.default.updateMessage(s.msgId,s,["message"])}else t===h.MSG_SUBTYPE_LINK&&(s.subType=t,u.default.updateMessage(s.msgId,s,["subType"]).then((()=>{if(s.status===h.MSG_LOCAL)return;let e=Object(i.a)({},s),t=s.message;e.msgType=h.MSG_CONTACT;let a={mediaTitle:this.firstLink,artist:"",src:g.default.getHostname(this.firstLink),stream_icon:"",streamUrl:"",type:0,subType:h.MSG_SUBTYPE_LINK},n=g.default.getIconGoogleDrive(this.firstLink);e.message=n?{action:"recommened.link",childnumber:0,description:this.firstLink,href:this.firstLink,oriUrl:this.firstLink,params:JSON.stringify(a),thumb:n,thumbUrl:n,title:t,type:""}:{action:"recommened.link",childnumber:0,description:this.firstLink,href:this.firstLink,oriUrl:this.firstLink,params:JSON.stringify(a),thumb:"",thumbUrl:"",title:t,type:""},Zn.a.receiveMediaFromMessage(s.toUid,[],[],[{msgId:s.msgId,userId:s.toUid,message:e.message,sendDttm:s.sendDttm,cliMsgId:s.cliMsgId,fromUid:s.fromUid,type:"link",ttl:s.ttl}]),E.default.send(f.ChatBoxActions.ADD_MESSAGE_LINK,{conversation:this.props.conversation,conversationId:this.props.conversation.userId,messages:[e]})})))}catch(n){g.default.logCoreError(n)}}_thumbUpdateSize(e){e.width!=this.updatedThumbSize.width&&e.height!=this.updatedThumbSize.height&&this._updateDBMessage(e),this.setState({thumbSize:{width:e.width,height:e.height}})}_onContextMenuStateUpdate(e){this.setState({isContextMenuShown:e})}_onCall(e,t){if(e&&(e.preventDefault(),e.stopPropagation()),!t||!t.message)return;let s=t.message.params;s&&u.default.getConversation(s).then((e=>{$n.default.getProfileFriendById(s).then((t=>{e=e||g.default.reformatConversationFromFriend(t),this.props.dispatch({type:f.GeneralActions.DO_CALL,payload:{conversation:e}})}))})),ee.e.logAction(1550104)}_onMessaging(e,t,s=!1){e&&(e.preventDefault(),e.stopPropagation());let a="0";if(!0===s?a=t.fromUid:t&&t.message&&(a=t.message.params),a&&"0"!=a){if(a){const e=e=>{this.props.dispatch({type:f.ConversationListActions.SELECT_CONVERSATION,payload:e})};u.default.getConversation(a).then((t=>{if(t)return e(t);$n.default.getProfileFriendById(a).then((t=>{t&&e(t)}))})).catch((e=>{g.default.logCoreError(e)}))}ee.e.logAction(1550103),ee.e.logAction(178003)}}_clearQuickAction(e=!0){this._quickActionTimer?(clearTimeout(this._quickActionTimer),this._quickActionTimer=null):e&&this._havingMenu&&(this._havingMenu=!1,this.props.showMessageQuickAction(null))}_onChangeQuickAction(){this._messageReaction&&this._messageReaction.showIcon(!1),this.setState({mouseOver:!1})}_getCurrentPosition(){let e=0,t=this.props.getBottomPos();if(!this.refs||!this.refs.item_message)return e;let s=this.refs.item_message.offsetTop+this.refs.item_message.clientHeight;return e=Math.abs(t-s),e}_setTrustedFileMsg(e){this.trustedFileMsg=e}_showFileMsgQuickAction(e={}){const{position:t,extraData:s}=e;this.props.showMessageQuickAction(this.trustedFileMsg,t,this.trustedFileMsg&&this.trustedFileMsg.localPath||this.state.localPath,this._resendMessage.bind(this),this._showInFolder.bind(this),ii?this._manualWebDownload.bind(this):this._manualDownload.bind(this),this._onChangeQuickAction.bind(this),this.trustedFileMsg&&this.trustedFileMsg.folderPath||this.state.folderPath,s)}processOnMouseEnter(e=null){if(this.props.showMessageQuickAction&&!this.props.message._friendRequestData&&!this.props.isMultiSel&&this.refs.quickAct){let t=0==this.props.message.fromUid;this._havingMenu=!0;let s,a=this.refs.quickAct,n=0,i=0,o=0,r=0;if(this.props.message.msgType===h.MSG_PHOTO_GROUP||this.props.message.msgType===h.MSG_STICKER_GROUP)a.parentNode&&a.parentNode.parentNode&&a.parentNode.parentNode.parentNode&&(s=a.parentNode.parentNode.parentNode,n+=a.parentNode.offsetLeft);else if(n+=a.offsetLeft,a&&a.parentNode&&a.parentNode.parentNode){s=a.parentNode.parentNode;const e=60;t?r+s.offsetLeft+s.offsetWidth-e<a.offsetLeft+a.offsetWidth&&(o=-r+a.offsetLeft+a.offsetWidth-s.offsetLeft-s.offsetWidth+e+5):a.offsetLeft<0&&(o=a.offsetLeft-5)}s&&(n+=s.offsetLeft-o,i+=s.offsetTop+a.clientHeight-24,this.isSendTimeOutside?i-=28:i-=15,i+=a.offsetTop,s.offsetParent&&-1!==s.offsetParent.className.indexOf("chat-item")&&s.parentNode&&s.parentNode.parentNode&&(n+=r));let l=this.props.message;this.props.message.msgType===h.MSG_STICKER_GROUP&&(l=this.props.message.message&&1===this.props.message.message.length?this.props.message.message[0]:null),l&&(this.props.message.msgType===h.MSG_FILE?this._showFileMsgQuickAction({position:{x:n,y:i},extraData:e}):this.props.showMessageQuickAction(l,{x:n,y:i},this.state.localPath,this._resendMessage.bind(this),this._showInFolder.bind(this),ii?this._manualWebDownload.bind(this):this._manualDownload.bind(this),this._onChangeQuickAction.bind(this),this.state.folderPath,e)),this._messageReaction&&this._messageReaction.showIcon(!0),this.setState({mouseOver:!0}),this._quickActionTimer=null}}processOnMouseLeave(){this.setState({mouseOver:!1}),this._clearQuickAction(),this._messageReaction&&this._messageReaction.closeIfShow()}onMouseLeave(e){this.processOnMouseLeave()}onMouseEnter(){this.processOnMouseEnter()}_onMouseEnter(e){this._clearQuickAction(!1),this._quickActionTimer=setTimeout((()=>{let e={showPromoteTodo:this.props.isShowPromoteTodo,highLightTodoBtn:this.props.isShowPromoteTodo};this.processOnMouseEnter(e)}),100)}_onMouseLeave(e){"sticker "!=(e.toElement||e.relatedTarget).className&&setTimeout((()=>{let e=this.props.getMessageQuickAction();e&&e.isHoverInMessage(this.props.message)||this.processOnMouseLeave()}),80)}_onDownloadStickerButtonClicked(){if(this.props.showStickerSet){const e=this.getSingleStickerInGroup()||this.props.message;e.message&&this.props.showStickerSet({stickerId:e.message.id,id:e.message.catId})}}_onChangeDownloadStickerCategories(e){let t=this.props.message.msgId;const s=this.getSingleStickerInGroup();s&&(t=s.msgId),t==e&&this.checkStickerDownloadState()}_onDownloadButtonEnter(){this.downloadButtonRef&&(this.downloadButtonRef.style.background="url(assets/chat_btn_down_selected.26be62c3a9c736cfecdd6225c124809a.png)")}_onDownloadButtonLeave(){this.downloadButtonRef&&(this.downloadButtonRef.style.background=`url(${Fn})`)}_onClickMessage(e){this.props.isMultiSel&&(this.props.onSelectMsg(e),e.preventDefault(),e.stopPropagation())}_onDoubleClick(e,t,s){if(this._enableDoubleClickReply&&t&&e.status!==h.MSG_LOCAL&&!this.props.isMultiSel&&s.target&&s.target.className&&"string"==typeof s.target.className&&"text"!=s.target.className&&"card-sender-name ws-pre"!=s.target.className&&s.target.className.indexOf("emoji-outer")<0){const t=this.getSingleStickerInGroup();if(t)this.props.replyMessage(t);else{if(e.msgType===h.MSG_STICKER_GROUP)return;this.props.replyMessage(e)}ee.e.logAction(10726),this.setState({aniHighlight:!0}),this.aniTimeout&&(clearTimeout(this.aniTimeout),this.aniTimeout=null),this.aniTimeout=setTimeout((()=>{this.setState({aniHighlight:!1})}),1e3),this.isGroup?ee.e.logAction(1072602):ee.e.logAction(1072601)}s.preventDefault(),s.stopPropagation()}_handleDoubleClick(e){k.f.getFlag(this.props.user.userId,k.b,1)&&(this._enableDoubleClickReply=e)}onContactCreateGroup(e){let t=this.props.message;if(!t)return;e&&(e.stopPropagation(),e.preventDefault());let s=t.message.params,a=this.props.conversation.userId,n=this.props.conversation.isGroup,o=this.props.user,r=$n.default.getMiniInfo(o.userId),l=[Object(i.a)(Object(i.a)({},o),r)],c=$n.default.getMiniInfo(s);if(c&&(c=Object(i.a)(Object(i.a)({},c),{},{userId:s}),l.push(c)),!this.props.conversation.isGroup){let e=$n.default.getMiniInfo(a);e&&(e=Object(i.a)(Object(i.a)({},e),{},{userId:a}),l.push(e))}if(Ln.c.markStart(Ln.a.CREATE_GROUP,Ln.b.Group.CREATE_GR_CONTACT_MSG),this.props.dispatch){if(!0===n){return void ei.a.getChatBoxControllerByConvId(this.props.conversation.userId).doShowAddMember({params:{initMembers:[c]}})}Q.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.CREATE_GROUP_COMPOSE,params:Object(i.a)(Object(i.a)({},this.props.conversation),{},{initMembers:[c]})})}}onShowThreadMsgsClicked(e,t){let s=1910100;!0!==t&&(s=1910101),ee.e.logAction(s),this.onShowThreadMsgs(e)}onQuoteClicked(){this.props.conversation&&!0===this.props.conversation.isGroup&&ee.e.logAction(1910102)}onShowThreadMsgs(e,t=!0,s=!1){if(e&&(e.stopPropagation(),e.preventDefault()),this.props.conversation&&!0===this.props.conversation.isGroup){const e=e=>{sa.a.showThreadList(e,this.props.emitter,t)};if(!0===s){let t=g.default.getRefMsgID(this.props.message);t?u.default.getMessage(t).then((t=>{e(t||this.props.message)})).catch((t=>{e(this.props.message)})):e(this.props.message)}else e(this.props.message)}}_imageClickHandler(e){e&&e.stopPropagation(),this.props.onClickImage(this.props.message)}_handleRef(e){"function"==typeof this.props.forwardedRef&&this.props.forwardedRef(e)}render(){var e,t,s;let a=this.props.message,i=a.msgType&&a.msgType===h.MSG_CONTACT&&a.message&&a.message.action&&("recommened.user"===a.message.action||"recommened.vip"===a.message.action),o=this.props.onClickImage,r=a.status==h.MSG_FAIL,c=a.cliMsgId,d=this.props.conversation.userId.startsWith(h.GROUPID_PREFIX),m="",p=a.status!==h.MSG_UNDO&&a.status!==h.MSG_FAIL;const E=this.props.focusId.indexOf(a.msgId)>=0&&1===this.props.focusType||this.state.aniHighlight;d&&"0"!==a.fromUid&&this.props.signAdminMsg&&""!==this.props.signAdminMsg&&(m=this.props.signAdminMsg);let f=!T.c.off_message_reaction&&(g.default.isMessagePinReaction(a)||this.props.lastMsgIdFromFriend===a.msgId),I=!1;if(a.reacts&&a.reacts.reactions)I=g.default.mapHasItem(a.reacts.reactions);else if(a.msgType===h.MSG_PHOTO_GROUP&&a.message&&a.message.length)for(let n=0;n<a.message.length;n++){let e=a.message[n];if(e&&e.reacts&&e.reacts.reactions&&(I=g.default.mapHasItem(e.reacts.reactions),I))break}this.props.isMultiSel&&a&&a.msgType!=h.MSG_PHOTO_GROUP&&a.msgType!=h.MSG_PHOTO&&(a.msgType,h.MSG_VIDEO);let v="card ",S=("0"==a.fromUid?" me ":"")+(f?" pin-react ":"")+(I?" card-has-react ":"")+(this.props.isLast||a.status==h.MSG_FAIL?" last-msg":"")+(this.props.shouldShowStatus?" has-status ":"")+(this.props.senderName&&this.isGroup&&"0"!=a.fromUid&&this.props.isFirst?" show-sender":"")+(this.props.isMultiSel&&a&&a.msgType!=h.MSG_PHOTO_GROUP&&a.msgType!=h.MSG_PHOTO&&a.msgType!=h.MSG_STICKER_GROUP?" prevent-pointer-event ":"")+(this.props.focusId.indexOf(a.msgId)>=0&&1===this.props.focusType?" highlighted":"")+(this.state.aniHighlight?0==this.props.message.fromUid?" ani__me":" ani__you":"");v+=S;let N=!1;a&&a.msgType!=h.MSG_PHOTO_GROUP&&a.msgType!=h.MSG_STICKER_GROUP&&a.msgType!=h.MSG_UNDO&&a.status!==h.MSG_FAIL?N=this._isStared():(a.msgType,h.MSG_UNDO);!function(e={}){var t;if(e.msgType!=h.MSG_CONTACT)return!1;if(hi.has(null===(t=e.message)||void 0===t?void 0:t.action))return!0}(a);let b=null,C=!1;if(a&&a.msgType===h.MSG_PHOTO_GROUP){let e=a.message;if(e&&e.length>0)for(let t=0;t<e.length;t++){let s=e[t];if(s&&s.refMessageId){C=!0;break}}}let P=!(!a||a.msgType===h.MSG_UNDO||a.msgType===h.MSG_STICKER||a.msgType===h.MSG_STICKER_2||a.msgType===h.MSG_PHOTO_GROUP);if(a&&!0===P&&(a.quote||a.refMessageId||!0===C||a.root>0)&&!0===h.ON_FEATURE.ENABLE_THREADS_LIST&&this.props.conversation&&!0===this.props.conversation.isGroup){let e=!0;(a.quote||a.refMessageId||!0===C)&&(e=!1),b=ta.a.getThreadMsgEntry((t=>this.onShowThreadMsgsClicked(t,e)),e,this.props.lastThreadMsgId===a.msgId)}let w=!(a.msgType!==h.MSG_PHOTO&&a.msgType!==h.MSG_PHOTO_2&&a.msgType!==h.MSG_VIDEO&&a.msgType!==h.MSG_GIF&&a.msgType!==h.MSG_CONTACT),k=null,x=this.props.isFirst&&this.props.senderName&&this.isGroup?l.a.createElement("div",{key:"sn_"+c,className:"card-sender-name ws-pre "+("0"==a.fromUid?"hidden":"")},l.a.createElement("span",{style:{padding:"2px 10px 0 2px",cursor:"pointer"},onClick:e=>this._onMessaging(e,a,!0)},"0"==a.fromUid?"":this.props.senderName)):null,F=Y.a.getHourTimeFromMilisecond(a.sendDttm),G=F,H=null,j=null;const V=!!(a.ttl||null!==(e=a.message)&&void 0!==e&&null!==(t=e[0])&&void 0!==t&&t.ttl),K=V&&function(e={msgType:1,message:{}}){var t,s;const a=e.msgType;return!!ti.has(e.msgType)||!(!si.has(e.msgType)||null!==(t=e.message)&&void 0!==t&&t.title)||!(a!==h.MSG_CONTACT||!ai.has(null===(s=e.message)||void 0===s?void 0:s.action))}(a),W=K?ni.b:ni.c,z=V&&l.a.createElement(W,{isLast:this.props.isLast,message:a}),q=V?" "+Object(O.a)(K&&"-variant-badge",V&&"-ttl"):" ";if(a.status!=h.MSG_FAIL||a.cancelled)if(this.props.isLast){if(this.props.shouldShowStatus&&this.props.message&&this.props.message.msgType!==h.MSG_UNDO){let e="";switch(this.state.msgStatus){case h.MSG_LOCAL:let t="STR_SENDING";a.subState&&a.subState===h.MSG_FOLDER_STATE.ZIPPING&&(t="STR_ZIPPING"),e=l.a.createElement(D.a,{textKey:`${t}`});break;case h.MSG_SENT:e=l.a.createElement(D.a,{textKey:"STR_SENT"});break;case h.MSG_DELIVERED:e=l.a.createElement(D.a,{textKey:"STR_RECEIVED"});break;case h.MSG_SEEN:e=l.a.createElement(D.a,{textKey:"STR_SEEN"});break;case h.MSG_FAIL:case h.MSG_READ:break;default:g.default.logCoreError("Chatboxlistitem: this status is not defined!",a.status)}H=l.a.createElement("span",{key:"chat-status",className:"card-send-status flx-1"},e)}let e=w?null:b;G=H?l.a.createElement("div",{key:`st_${c}_${this.state.msgStatus}`,className:"card-send-time flx flx-al-c flx-1 "+("0"==a.fromUid?"me ":"")+q},l.a.createElement("span",{className:"card-send-time__sendTime"},z,F),e,H):l.a.createElement("div",{key:"st_"+c,className:"card-send-time flx flx-al-c flx-1 "+("0"==a.fromUid?"me ":"")+q},l.a.createElement("span",{className:"card-send-time__sendTime"},z,G),e)}else G=null;else{let e,t=a.msgType!==h.MSG_FILE||a.resend;a.status!==h.MSG_FAIL||this.state.resending||a.msgType==h.MSG_PHOTO_GROUP||a.msgType==h.MSG_STICKER_GROUP?this.state.resending&&a.msgType!=h.MSG_STICKER_GROUP&&(j=l.a.createElement("span",{className:"card-send-status__resend "},l.a.createElement("i",{className:"chat-resending fa fa-circle-o-notch fa-spin spinner"}))):j=l.a.createElement("span",{className:"card-send-status__resend "},t?l.a.createElement(D.a,{className:"clickable txt-highlight",onClick:a.isThumbPhoto?this._resendPhotoThumbMessage.bind(this):this._resendMessage.bind(this),textKey:"STR_RESEND"}):null,t?l.a.createElement(D.a,{textKey:"STR_OR_WITH_SPACE"}):null,l.a.createElement(D.a,{className:"clickable txt-highlight",onClick:this._deleteMessage.bind(this),textKey:"STR_DELETE"})),a.msgType!==h.MSG_FILE?e=l.a.createElement("span",{className:"card-send-time__sendTime error"},z,l.a.createElement(D.a,{textKey:"STR_MESSAGE_ERROR"})):(e=l.a.createElement("span",{className:"card-send-time__sendTime"},z,Y.a.getHourTimeFromMilisecond(a.sendDttm)),G=F),G=l.a.createElement("div",{key:"st_"+c,className:"card-send-time flx flx-al-c error"+("0"==a.fromUid?" me ":"")+q},e,l.a.createElement("div",{className:"card-send-time__spacer"}),l.a.createElement("span",{className:"card-send-status"},j))}let X=N?" stared-message":"",J=u.default.getTaskSetting()||{},$=null,ee=a.reacts&&a.reacts.reactions&&g.default.mapHasItem(a.reacts.reactions);g.default.canReactMsg(a)&&($=l.a.createElement(wn.a,{key:"message-reaction",ref:e=>this._messageReaction=e,hideQuickAction:this.props.showMessageQuickAction,message:a,dispatch:this.props.dispatch,pinReaction:ee,isLastFromFriend:this.props.lastMsgIdFromFriend===a.msgId,isBeingObserved:this.props.isBeingObserved,conversation:this.props.conversation,showReactionPopup:this.props.showReactionPopup,sendTime:G,handleDoubleClick:this._handleDoubleClick,getCurrentPosition:this._getCurrentPosition.bind(this),forceTitle:!!b}));let te={showStar:N,displayName:x,sendTime:G,msgAction:null,resending:this.state.resending,reaction:$,thread:b,shouldShowStatus:this.props.shouldShowStatus},ae=[],ne=null,ie=null;if(a){if(null===a.message||void 0===a.message)return g.default.log(a),null;{var re;let e=null;a.isErrorInfo||(e=this._imageClickHandler);let t=a.message&&a.message.message?a.message.message:a.message;if((a.msgType===h.MSG_PHOTO||a.msgType===h.MSG_DOODLE||a.msgType===h.MSG_CONTACT&&"recommened.link"===a.message.action)&&(t=a.message.title),this.props.isShowRemind&&!0!==this.props.isShowSuggestCreateTodo){let e=a.z_parsedTokens;e&&e.constructor===Array&&e.forEach((e=>{if(e.subType===Mn.b.TIME_REMIND&&Object(Dn.g)(a)){let t=a.message.title||a.message,s=!!this.props.conversation&&this.props.conversation.isGroup,n=h.CREATE_NOTICE_SRC_KEYWORD;!0!==s&&(n=h.REMINDER_SRC_MSG_SUGGESTION_BUTTON),ae.push(((e,t,s=null,a=null,n=h.CREATE_NOTICE_SRC_KEYWORD)=>({id:"remind_"+t.msgId,type:h.EXTRA_BUTTON_REMIND,text:"STR_CREATE_REMINDER_FOOTER",iconClass:"fa-footer-remind",clickHandler:()=>{Q.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.REMINDER_COMPOSE,params:{isVisiblePopup:!0,isEdit:!0,createSource:n,initData:{startTime:s,params:{title:a,type:h.PARSE_FROM_KEYWORD}}}})}}))(this.props.dispatch,a,Object(Dn.h)(e.extInfo),t,n))}}))}if(!0===this.props.isShowSuggestContact&&a&&a.message&&a.message.params!==this.props.user.userId){let e=this.props.conversation.isGroup;ie=l.a.createElement("div",{className:"msg-contact-footer inner-suggest",onClick:this.onContactCreateGroup.bind(this)},l.a.createElement("i",{className:"v0 fa fa-"+(e?"icon-outline-add-member-2":"outline-create-group")}),l.a.createElement(D.a,{style:{width:"max-content"},textKey:e?"STR_GROUP_ADD_MEM_TO_GROUP":"STR_CREATE_GROUP_FOR_INTRODUCTION",tagName:"div"}))}if(this.props.isShowReply)ae.push(((e,t)=>({id:"reply_"+t.msgId,type:h.EXTRA_BUTTON_REPLY,text:"STR_REPLY_MSG",iconClass:1===T.c.quote_icon?"fa-footer-reply":"fa-csc-menu-icon-quote",iconStyle:1===T.c.quote_icon?null:{fontSize:"13px"},clickHandler:()=>{e(t)}}))(this.props.replyMessage,a));else if(206===a.sendErrorCode&&this.props.hasFriendRequest)ae.push(((e,t,s)=>({id:"addfr_"+t.msgId,type:h.EXTRA_BUTTON_ADD_FRIEND,text:"STR_TITLE_ADD_FRIEND",iconClass:"",clickHandler:()=>{sa.a.doAddFriend(e,h.FRIEND_REQUEST_SRC_CHAT,s,{toUid:e})}}))(this.props.conversation.userId,a,this.props.dispatch));else if(g.default.isSuccessfulMessage(a)&&"0"===a.fromUid&&t&&t.length>=10&&a.mentions){a.mentions.filter((e=>e.uid===h.MENTION_ALL_ID)).length>0&&ae.push(((e,t)=>({id:"pin_"+t.msgId,type:h.EXTRA_BUTTON_PIN,text:"STR_PIN_MESSAGE_2",iconClass:"fa-footer-remind",clickHandler:()=>{e(t)}}))(this.props.addMessageNotice,a))}else this.props.isShowCreateProduct&&this.props.onCreateProductFromMsg&&ae.push(((e,t)=>({id:"sg_product_"+t.msgId,type:h.EXTRA_BUTTON_CREATE_PRODUCT_CATALOG,text:"STR_TEXT_CATALOG_SUGGEST_CREATE",iconClass:"fa-solid-product",iconStyle:{fontSize:"13px"},clickHandler:()=>{e(t)}}))(this.props.onCreateProductFromMsg,a));let r="";var de;if((null==a?void 0:a.msgType)===h.MSG_PHOTO&&null!=a&&null!==(re=a.message)&&void 0!==re&&re.title)r=Na.a.isCardTitle(null==a||null===(de=a.message)||void 0===de?void 0:de.title,d);switch(ae.length>0&&(ae.length>2&&ae.splice(0,2),v+=" has-"+ae.length+"-extra-btns"),a.msgType){case h.MSG_ARTICLE:{let e=a.message.map((e=>l.a.createElement("li",null,e.title)));k=l.a.createElement("div",{className:v+m+X},l.a.createElement("ul",null,e));break}case h.MSG_TEXT:if("recommened.link"==a.message.action){let e=this._renderHtmlMessage(t,a.mentions);k=l.a.createElement(oe,Object(n.a)({key:c,test:c,content:a,title:e,className:v+m+X,userId:this.props.user.userId,dispatch:this.props.dispatch,confirm:this.props.confirm,focusId:this.props.focusId,conversationId:this.props.conversation.userId,isLast:this.props.isLast,messageContainerWidth:this.props.containerWidth},te));break}if(g.default.validUpdateMessage(a)){k=l.a.createElement(U,{key:c,dispatch:this.props.dispatch,updateData:a.__updateData,content:this._renderHtmlMessage(a.content,null),className:v+" card--text card--update-msg"+m+X});break}if(this.props.startGameMode){if(g.default.validRequestPlayGameMessage(this.props.conversation,a)){let e=a.message;k=l.a.createElement(L,{key:c,requestGame:!0,startGameMode:()=>{this.props.startGameMode(!1,e)},className:v+m+X});break}{let e=g.default.validGameMessage(this.props.conversation,a);if(e){k=l.a.createElement(L,{key:c,requestGame:!1,cmdText:e,className:v+m+X});break}}}case 10:{let s={};if(a.message.params&&(s=JSON.parse(a.message.params)),s&&(s.subType==h.MSG_SUBTYPE_PHOTO||s.subType==h.MSG_SUBTYPE_GIF)){let t=h.MULTI_PHOTO_SELECTED_TYPE.TYPE_UNSELECTED;this.props.isSelected&&this.props.selectedMsg[this.props.message.msgId]&&(t=this.props.selectedMsg[this.props.message.msgId].multipleSelectedType||h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL),k=l.a.createElement(ha,Object(n.a)({userId:this.props.user.userId,conversation:this.props.conversation,containerWidth:this.props.containerWidth,showShareError:this.state.showShareError,imageClickHandler:e,renderHtmlMessage:this._renderHtmlMessage,key:c,className:v+(a.message.title?m+X:""),message:a,localPath:this.state.localPath,onFilePathUpdated:this._onFilePathUpdated,forceType:s.subType,isStared:N,dispatch:this.props.dispatch,confirm:this.props.confirm,selectedType:t,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,onChooseMsg:this.props.onChooseMsg,increaseCountMsg:this.props.increaseCountMsg,isSignAdminMsg:m},te));break}let i,o=this._renderHtmlMessage(t,a.mentions);if(a.quote)if(a.quote.cliMsgType===h.CLI_MSG_TYPE_FILE){const e=this.props.conversation&&this.props.conversation.userId;i=l.a.createElement(kn.a,{quote:a.quote,style:"0"==a.fromUid?{backgroundColor:"var(--blue-650)"}:{backgroundColor:"var(--grey-600)"},msgId:a.quote.msgId||a.quote.globalMsgId,quote:a.quote,onClick:()=>this.onQuoteClicked(),conversationId:e||0})}else i=l.a.createElement(Ya.a,{style:"0"==a.fromUid?{backgroundColor:"var(--blue-650)"}:{backgroundColor:"var(--grey-600)"},quote:a.quote,dispatch:this.props.dispatch,onQuoteClicked:()=>this.onQuoteClicked(),conversation:this.props.conversation,message:a});if(this.firstLink){let t=T.c.enable_image_link_preview?B.a.getMediaSize(this.firstLink):null;if(t&&t.width&&t.height){let s=h.MSG_SUBTYPE_PHOTO;switch(t.type){case h.IMAGE_TYPE_GIF:s=h.MSG_SUBTYPE_GIF;break;case h.IMAGE_TYPE_JPEG:case h.IMAGE_TYPE_PNG:}this.updatedThumbSize={width:t.width,height:t.height},this._updateDBMessage(this.updatedThumbSize,s);let i=h.MULTI_PHOTO_SELECTED_TYPE.TYPE_UNSELECTED;this.props.isSelected&&this.props.selectedMsg[this.props.message.msgId]&&(i=this.props.selectedMsg[this.props.message.msgId].multipleSelectedType||h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL),k=l.a.createElement(ha,Object(n.a)({userId:this.props.user.userId,conversation:this.props.conversation,showShareError:this.state.showShareError,containerWidth:this.props.containerWidth,imageClickHandler:e,renderHtmlMessage:this._renderHtmlMessage,key:c,className:v+(a.message.title?m+X:""),message:a,localPath:this.state.localPath,onFilePathUpdated:this._onFilePathUpdated,forceType:s,isStared:N,dispatch:this.props.dispatch,confirm:this.props.confirm,selectedType:i,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,onChooseMsg:this.props.onChooseMsg,increaseCountMsg:this.props.increaseCountMsg,isSignAdminMsg:!0},te));break}a.subType!==h.MSG_SUBTYPE_LINK&&this._updateDBMessage(null,h.MSG_SUBTYPE_LINK)}else this.forceParsingFailed=!0;let r={};if(this.state.thumbSize.width>0&&this.state.thumbSize.height>0){r={maxWidth:200/this.state.thumbSize.height*this.state.thumbSize.width+"px"}}let d=e=>e.indexOf(T.c.authDomain)<0&&e.indexOf("youtube.com")<0,u=this.firstLink&&d(this.firstLink)&&T.c.enable_image_link_preview?l.a.createElement(qa,{userId:this.props.user.userId,onThumbUpdateSize:this._thumbUpdateSize,url:this.firstLink}):null,_=!1;this.footerInfo&&(this.footerInfo.type,Mn.b.TIME_REMIND);a.msgType===h.MSG_TEXT&&a.extra&&a.extra.todoInfo&&1===J.ui_v2&&(ne=l.a.createElement(Z,{data:a.extra.todoInfo,htmlInner:o,user:this.props.user,confirm:this.props.confirm,dispatch:this.props.dispatch,focusId:this.props.focusId}));const p=this.props.message.extra&&this.props.message.extra.todoInfo?"0"===this.props.message.extra.fromUid?"div_TskASGD_Msg":"div_TskRECD_Msg":"0"===this.props.message.fromUid&&(this.props.message.isLastMsg?"div_LastSentMsg_Text":"div_SentMsg_Text")||this.props.message.isLastMsg&&"div_LastReceivedMsg_Text"||"div_ReceivedMsg_Text";k=l.a.createElement("div",{className:Object(O.a)(v+(this._emoji?" card--emoji"+(m+X):" card--text"+(m+X))+(_?" size-video":"")),style:r,"data-id":p},i,l.a.createElement(se,{urgency:a.urgency}),u,ne||l.a.createElement("div",null,o));break}case h.MSG_VOICE:k=l.a.createElement(_.a,Object(n.a)({key:c,className:v+m+X,message:a,msgId:a.msgId,isSignAdminMsg:m,content:a.message},te));break;case h.MSG_PHOTO:case h.MSG_PHOTO_2:case h.MSG_GIF:case h.MSG_DOODLE:a.message&&(this.isSendTimeOutside=!a.message.title);let u=!1;Na.a.isCardTitle(null==a||null===(s=a.message)||void 0===s?void 0:s.title,d)&&(u=!0);let f=h.MULTI_PHOTO_SELECTED_TYPE.TYPE_UNSELECTED;if(this.props.isSelected&&this.props.selectedMsg[this.props.message.msgId]&&(f=this.props.selectedMsg[this.props.message.msgId].multipleSelectedType||h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL),Kn.a.Config.isEnablePhotoSticker()&&g.default.isPhotoStickerMessage(a)){const e=Kn.a.Helper.convertMessageToPhotoStickerData(a);if(Kn.a.Helper.isValidPhotoStickerData(e)){let t=!1;this.props.isMultiSel&&this.props.selectedMsg[this.props.message.msgId]&&(t=!0),k=l.a.createElement(Jn,Object(n.a)({message:a,data:e,showMessageAction:this._showMessageAction,resendMessage:this._resendMessage,isSelected:t,isHighlight:E},te));break}}k=fn.a.isActivated("enable_file_store_comp")&&a.msgType===h.MSG_PHOTO?l.a.createElement(Ua,Object(n.a)({comp:Ua},te,{key:c,containerWidth:this.props.containerWidth,message:a,imageClickHandler:e,renderHtmlMessage:this._renderHtmlMessage,selectedType:f,forceShowCardBtnTitle:r,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,onChooseMsg:this.props.onChooseMsg,increaseCountMsg:this.props.increaseCountMsg,isSignAdminMsg:m,highlight:E,onFilePathUpdated:this._onFilePathUpdated,showActionInjectable:this.showActionInjectable})):l.a.createElement(ha,Object(n.a)({userId:this.props.user.userId,showShareError:this.state.showShareError,conversation:this.props.conversation,containerWidth:this.props.containerWidth,imageClickHandler:e,renderHtmlMessage:this._renderHtmlMessage,onImageLoaded:this.props.onImageLoaded,key:c,className:v+(a.message.title?m+X:""),message:a,localPath:this.state.localPath,onFilePathUpdated:this._onFilePathUpdated,isStared:N,openSeasonalCardEditor:this.props.openSeasonalCardEditor,dispatch:this.props.dispatch,observeElement:this.props.observeElement,hasReacts:I,unobserveElement:this.props.unobserveElement,confirm:this.props.confirm,focusId:this.props.focusId,selectedType:f,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,onChooseMsg:this.props.onChooseMsg,increaseCountMsg:this.props.increaseCountMsg,isSignAdminMsg:m},te)),b=null;break;case h.MSG_CONTACT:switch(a.message.action){case"recommened.link":{var he;let e=this._renderHtmlMessage(t,a.mentions);k=l.a.createElement(oe,Object(n.a)({key:c,test:c,content:a,title:e,className:v+m+X,userId:this.props.user.userId,dispatch:this.props.dispatch,confirm:this.props.confirm,focusId:this.props.focusId,conversationId:null===(he=this.props.conversation)||void 0===he?void 0:he.userId,isLast:this.props.isLast,messageContainerWidth:this.props.containerWidth,isSignAdminMsg:m},te))}break;case"recommened.stickerset":this.isSendTimeOutside=!0,k=l.a.createElement(le,Object(n.a)({onClick:e=>{e.stopPropagation(),e.preventDefault(),this._showStickerSet.call(this,a.message.params)},key:c,content:a,className:v+m+X},te));break;case"recommened.misscall":case"recommened.calling":case"recommened.receivecall":case"recommened.calltime":k=l.a.createElement(M.a,{key:c,message:a,onCallback:this.onClickCallCallback,sentTime:G,ttl:a.ttl,isSignAdminMsg:m});break;default:{let e={userId:a.message.params,avatar:a.message.thumb,displayName:a.message.title},t=$n.default.getDName(a.message.params),s="recommened.vip"===a.message.action;t||(t=a.message.title);let n=this.props.user.userId===a.message.params,o=a.message.params===T.c.sendToMeId,r="";if("recommened.user"==a.message.action&&a.message.description&&a.message.description.constructor==String)try{const e=JSON.parse(a.message.description);e&&e.phone&&(r=e.phone)}catch(Ne){}let c=null,d=null;!0===o?c=l.a.createElement(D.a,{textKey:"STR_SEND2ME_SHARE",textArguments:[{textKey:"KEY_NAME_SEND2ME"}],tagName:"div",className:"ct-btn-left",onClick:e=>this._onMessaging(e,a)}):!0!==n&&((!0!==this.props.isFriendWithNameCard||this.state.blocked)&&(s||(c=l.a.createElement(D.a,{textKey:"STR_ADD_FRIEND_BUTTON",tagName:"div",className:"ct-btn-left",onClick:e=>this._onAddFriend(a.message.params,e,this.props.conversation.userId)}))),ie||(d=l.a.createElement(D.a,{textKey:"STR_CHAT",tagName:"div",className:"ct-btn-right",onClick:e=>this._onMessaging(e,a),style:c?null:{borderRight:"none"}}))),this.isSendTimeOutside=!0;const u="0"===this.props.message.fromUid&&(this.props.message.isLastMsg?"div_LastSentMsg_Contact":"div_SentMsg_Contact")||this.props.message.isLastMsg&&"div_LastReceivedMsg_Contact"||"div_ReceivedMsg_Contact";k=l.a.createElement("div",{className:Object(O.a)(i&&"name-card"),style:{maxWidth:"100%",width:"300px",position:"relative"}},x,l.a.createElement(R.a,{ttl:null==a?void 0:a.ttl},l.a.createElement("div",{onClick:this._showInfoHandler.bind(this,a.message.params,h.FRIEND_REQUEST_SRC_ECARD),className:v+" card--business "+m+X,"data-id":u},l.a.createElement("div",{className:"flx",style:"0"===a.fromUid||this.props.isFriendWithNameCard||a.message.params===this.props.user.userId?{paddingLeft:"12px",paddingRight:"12px"}:{paddingLeft:"12px",marginLeft:"-12px",paddingRight:"12px",marginRight:"-12px"}},l.a.createElement(Xa.b,{target:e,size:"xl",outline:!0,className:"card--business--outline"}),l.a.createElement("div",{className:"card-content",style:{maxWidth:"calc(100% - 95px)"}},l.a.createElement(D.a,{tagName:"div",textKey:"STR_NAMECARD",style:{fontSize:"13px",color:"rgba(0,0,0,0.6)"}}),l.a.createElement("div",{className:"truncate",style:{marginTop:r?"0px":"6px",maxWidth:"100%",fontWeight:"600"}},t),r?l.a.createElement("div",{className:"flx",style:{color:"var(--neutral-500)",marginTop:"6px",fontSize:"14px"}},l.a.createElement("div",{className:"fa fa-chatbar-icon-contact"}),l.a.createElement("div",{style:{marginLeft:"6px",marginTop:"-2px",maxWidth:"100%",fontSize:"13px"}},r)):null)),d||c?l.a.createElement("div",{className:"msg-contact-footer"},c,d):null,ie)),G),b=null}}break;case h.MSG_STICKER:case h.MSG_STICKER_2:this.isSendTimeOutside=!0;let S=!1;this.props.isMultiSel&&this.props.selectedMsg[this.props.message.msgId]&&(S=!0),k=l.a.createElement(Ba.a,Object(n.a)({imageClickHandler:e,content:a.message,message:a,key:c,className:v,onMouseEnter:this.onMouseEnter.bind(this),onMouseLeave:this.onMouseLeave.bind(this),showStickerSet:this._showStickerSet.bind(this),dispatch:this.props.dispatch,isMultiSel:this.props.isMultiSel,selectedFss:S,showMessageAction:this._showMessageAction},te));break;case h.MSG_LOCATION:k=l.a.createElement(ja,Object(n.a)({content:a.message,key:c,senderAvatar:this.props.senderAvatar,className:v+m+X},te));break;case h.MSG_VIDEO:this.isSendTimeOutside=!0;let C=h.MULTI_PHOTO_SELECTED_TYPE.TYPE_UNSELECTED;this.props.isSelected&&this.props.selectedMsg[this.props.message.msgId]&&(C=this.props.selectedMsg[this.props.message.msgId].multipleSelectedType||h.MULTI_PHOTO_SELECTED_TYPE.TYPE_SELECTED_FULL),k=l.a.createElement(A,Object(n.a)({className:v+m+(a.message.title?X:""),showFullImage:e,onFilePathUpdated:this._onFilePathUpdated,message:a,key:c,renderHtmlMessage:this._renderHtmlMessage,thumb:g.default.removeProtocol(a.message.thumbUrl),userId:this.props.user.userId,hasReacts:I,src:g.default.removeProtocol(a.message.oriUrl),localPath:this.state.localPath,containerWidth:this.props.containerWidth,dispatch:this.props.dispatch,isOnline:this.props.isOnline,isLast:this.props.isLast,lastLocalMsg:this.props.conversation.lastSmsLocalId,scrollToBottom:this.props.scrollToBottom,conversation:this.props.conversation,user:this.props.user,selectedType:C,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,onChooseMsg:this.props.onChooseMsg,increaseCountMsg:this.props.increaseCountMsg,isSignAdminMsg:m},te));break;case h.MSG_FILE:k=l.a.createElement(Qs,Object(n.a)({userId:this.props.user.userId,localPath:this.state.localPath,folderPath:this.state.folderPath,key:c,showShareError:this.state.showShareError,dispatch:this.props.dispatch,emitter:this.props.emitter,className:v+m+X,conversation:this.props.conversation,message:a,clickAction:this._openFile.bind(this),downloadProgress:this.state.downloadProgress,isDownloading:this.state.isDownloading,progressInBytes:this.state.progressInBytes,manualDownload:this._manualDownload.bind(this),downloadError:this.state.downloadError,shareMessage:this._shareMessage,resendMessage:this._resendMessage.bind(this),uploadFiles:this.props.uploadFiles,uploadFilesNative:this.props.uploadFilesNative,showInFolder:this._showInFolder.bind(this),isOnline:this.props.isOnline,downloadVideo:this._openFile.bind(this),scrollToBottom:this.props.scrollToBottom,errorHandler:j,onFilePathUpdated:(e,t,s)=>this._onFilePathUpdated(t,s),showActionInjectable:this.showActionInjectable,setTrustedFileMsg:this._setTrustedFileMsg,isSignAdminMsg:m},te)),b=null;break;case h.MSG_UNDO:p=!1,k=l.a.createElement("div",{className:v+" card--undo"+m+X},l.a.createElement(D.a,{textKey:"STR_UNDO_MSG"}));break;case h.MSG_DEL_EVERYONE:p=!1,k=a.uidSenderDel?l.a.createElement("div",{className:v+" card--undo"+m+X},a.uidSenderDel==$n.default.getUidMe()||"0"==a.uidSenderDel?l.a.createElement(D.a,{textKey:"STR_ME_DEL"}):l.a.createElement("span",null,$n.default.getDName(a.uidSenderDel)),l.a.createElement(D.a,{textKey:"STR_DEL_EVERYONE_MSG"})):l.a.createElement("div",{className:v+" card--undo"+m+X},l.a.createElement(D.a,{textKey:"STR_DEL_EVERYONE"}));break;case h.MSG_OA:p=!1,k=l.a.createElement(Wa,Object(n.a)({key:c,oaContextMenu:this._oaOnContextMenu,className:v,message:a.message,dispatch:this.props.dispatch},te));break;case h.MSG_PHOTO_GROUP:p=!1,this.isSendTimeOutside=!0,k=l.a.createElement(An,Object(n.a)({key:c,showMessageAction:this._showMessageAction,userId:this.props.user.userId,user:this.props.user,conversation:this.props.conversation,photos:this.props.message.message,replyMessage:this.props.replyMessage,deleteMessage:this.props.deleteMessage,recallMessage:this.props.recallMessage,shareMessage:this._shareMessage,resendMessage:this.props.resendHandler,onClickImage:o,focusId:this.props.focusId,focusType:this.props.focusType,message:this.props.message,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,isSelected:this.props.isSelected,isMouseMoveSelecting:this.props.isMouseMoveSelecting,onMultiSelGroupPhoto:this.props.onMultiSelGroupPhoto,onChooseMsg:this.props.onChooseMsg,dispatch:this.props.dispatch,increaseCountMsg:this.props.increaseCountMsg,className:v+m+X,onMsgIntersect:this.onMsgIntersect,isSignAdminMsg:m},te));break;case h.MSG_STICKER_GROUP:this.isSendTimeOutside=!0,k=l.a.createElement(jn,Object(n.a)({key:c,showMessageAction:this._showMessageAction,userId:this.props.user.userId,user:this.props.user,conversation:this.props.conversation,focusId:this.props.focusId,focusType:this.props.focusType,selectedMsg:this.props.selectedMsg,isMultiSel:this.props.isMultiSel,isSelected:this.props.isSelected,onMultiSelGroupPhoto:this.props.onMultiSelGroupPhoto,onChooseMsg:this.props.onChooseMsg,imageClickHandler:e,items:this.props.message.message,message:this.props.message,className:v,onMouseEnter:this.onMouseEnter.bind(this),onMouseLeave:this.onMouseLeave.bind(this),showStickerSet:this._showStickerSet.bind(this),onDoubleClick:this._onDoubleClick.bind(this),dispatch:this.props.dispatch,isMouseMoveSelecting:this.props.isMouseMoveSelecting,increaseCountMsg:this.props.increaseCountMsg,resendMessage:this._resendMessage.bind(this),deleteMessage:this._deleteMessage.bind(this),onMsgIntersect:this.onMsgIntersect},te));break;default:return g.default.log(a),null}}}this.isSendTimeOutside=this.isSendTimeOutside&&this.props.isLast;let ue=k.props.children;ue=ue?ue.constructor!==Array?[ue]:[...ue]:[],G||ue.push(l.a.createElement("div",{style:{margin:"3px -5px 0"}},b)),"div"!=k.type||i||((x||G)&&(x&&ue.unshift(x),G&&ue.push(l.a.createElement("div",{style:{marginTop:"10px"}},G))),ue.push($),ue.push(null));const _e=e=>{switch(a.msgType){case h.MSG_PHOTO_GROUP:case h.MSG_STICKER_GROUP:this.imageGroupMessage=e}};k=l.a.createElement(k.type,Object(n.a)({},k.props,{ref:e=>_e(e),onContextMenu:(e,t)=>this.showAction(e,!0,t)}),[...ue]),function(e){if(null==e||!e.ttl)return!1;if(di.includes(e.msgType))return!0;if(g.default.isStickerSetMessage(e))return!0;return!1}(a)&&(k=l.a.createElement(R.a,{ttl:null==a?void 0:a.ttl,isAdmin:m},k));let me=Ca(ae,0==a.fromUid?"flx-e":""),pe=[h.MSG_PHOTO,h.MSG_PHOTO_2,h.MSG_GIF,h.MSG_DOODLE].indexOf(a.msgType)>=0&&this.isGroup&&"0"==a.fromUid&&this.props.isFirst&&this.props.senderName?" pushdown":"",ge=this._renderMenuActions(a,S),Ee=null;const fe=this.getSingleStickerInGroup();if(fe&&(p=!0),a.msgType==h.MSG_STICKER||a.msgType==h.MSG_STICKER_2||fe){const e=fe?fe.msgId:a.msgId;if(e&&(this._bindChangeDownloadSticker&&this._bindChangeDownloadSticker!=e&&(yn.g.removeChangeDownloadedStickerCategoriesCallback(this._bindChangeDownloadSticker,this._onChangeDownloadStickerCategories),this._bindChangeDownloadSticker=null),this._bindChangeDownloadSticker||(this._bindChangeDownloadSticker=e,yn.g.setChangeDownloadedStickerCategoriesCallback(e,this._onChangeDownloadStickerCategories))),this.state.stickerDownloadState){let e=0==a.fromUid;Ee=l.a.createElement("div",{className:"sticker-download-button"+(x?" avatar":"")+(e?" isMe":" notMe"),onClick:this._onDownloadStickerButtonClicked.bind(this),onDoubleClick:e=>{e.preventDefault(),e.stopPropagation()},style:{background:`url(${Fn})`,width:"24px",height:"24px"},onMouseEnter:this._onDownloadButtonEnter.bind(this),onMouseLeave:this._onDownloadButtonLeave.bind(this),ref:e=>this.downloadButtonRef=e,title:y.default.str("STR_DOWNLOAD_STICKER")})}}let Ie=g.default.canSelectMessage(a),Te="",ve=this.props.isSelected;if(this.props.isSelected&&(a.msgType===h.MSG_PHOTO_GROUP||a.msgType===h.MSG_STICKER_GROUP)&&this.props.selectedMsg.hasOwnProperty(a.msgId)){let e=0,t=0;a.message.forEach((t=>{t.msgType!==h.MSG_UNDO&&t.msgType!==h.MSG_DEL_EVERYONE&&e++})),this.props.selectedMsg[a.msgId].message.forEach((e=>{e.msgType!==h.MSG_UNDO&&e.msgType!==h.MSG_DEL_EVERYONE&&t++})),e>t&&(ve=!1),this.props.updateSelectedGroupPhoto(a.msgId,ve)}let Re=!fe&&a.msgType===h.MSG_STICKER_GROUP,Se=null;if(Re&&a.msgType===h.MSG_STICKER_GROUP&&a.message.forEach((e=>{Re&&e.status!==h.MSG_FAIL&&(Re=!1)})),Re&&!this.props.isMultiSel&&(Se=l.a.createElement("div",{className:"card--group-sticker__row__content__cover",onClick:this._resendMessage.bind(this)},l.a.createElement("div",{className:"card--group-sticker__row__content__retry clickable retry-all"},l.a.createElement("i",{className:"fa fa-img-retry"})))),this.props.isSelected&&a.msgType===h.MSG_PHOTO&&this.props.selectedMsg.hasOwnProperty(a.msgId)){const e=this.props.selectedMsg[a.msgId];e&&(e.msgType===h.MSG_TEXT||e.message&&e.message.title!==a.message.title)&&(ve=!1)}this.props.isMultiSel&&(Te=" multi-select-mode ",ve?(Te+=" multi-select-mode-selected",this.props.isFirst&&(Te+=" first-selected "),this.props.isLast&&(Te+=" last-selected "),this.props.isFirst||this.props.isLast||(Te+=" selected ")):Ie?(this.props.isFirst&&(Te+=" first-unselected "),this.props.isLast&&(Te+=" last-unselected "),this.props.isFirst||this.props.isLast||(Te+=" unselected ")):Te=" prevent-select ");let Oe={display:"flex",width:"100%"};return"0"===a.fromUid&&(Oe.justifyContent="flex-end"),ae.length>0&&(Oe.marginBottom="40px"),l.a.createElement(ce.a,null,l.a.createElement("div",{className:"chat-message "+(p?"wrap-message ":" ")+"rotate-container "+Te+(E?"highlighted ":"")+(r?"failed ":"")+("0"===a.fromUid?"me ":"")+pe+" "+Object(O.a)(G&&"-send-time"),onMouseOver:this._onMouseEnter.bind(this),onMouseLeave:this._onMouseLeave.bind(this),onClick:this._onClickMessage.bind(this),onDoubleClick:this._onDoubleClick.bind(this,a,p),onContextMenu:this.showMultiSelectAction.bind(this),key:"msg_"+c,id:h.BUBBLE_MSG_ID+"_"+c,"data-node-type":"bubble-message",ref:"item_message"},l.a.createElement(ui,{message:a,isShowReply:this.props.isShowReply}),l.a.createElement("div",{style:Oe,className:""},window._showMsgIdBubble?l.a.createElement("div",null,a.msgId):null,"0"==a.fromUid?ge:null,"0"===a.fromUid?Ee:null,"0"===a.fromUid?Se:null,k,(a&&a.loadSrc,null),ae.length>0&&me,"0"!==a.fromUid?Ee:null,"0"!==a.fromUid?ge:null),this.state.isShowTip?l.a.createElement(Pn.c,{position:Pn.b.RIGHT,clearArrow:!0,vDelta:0,hDelta:17,styleThumb:{width:"40px",margin:"auto"},style:{width:"275px",position:"relative",alignSelf:"center"},tipKey:"client.msg.quote"}):null))}onShowPopupMoreOption(){ee.e.logAction(1063804)}_renderMenuActions(e,t){let s=null,a=!0,n=e.msgType===h.MSG_CONTACT&&this.props.isFirst&&this.props.senderName&&this.isGroup,i=this.props.isFirst&&this.props.senderName&&"0"!==e.fromUid&&this.isGroup&&(e.msgType===h.MSG_STICKER||e.msgType===h.MSG_DOODLE||e.msgType===h.MSG_VIDEO||e.msgType===h.MSG_PHOTO_GROUP||e.msgType===h.MSG_GIF||e.msgType===h.MSG_PHOTO),o=!1;switch((e.msgType===h.MSG_PHOTO||e.msgType===h.MSG_PHOTO_2)&&e.message&&e.message.title&&(o=!0),e.msgType){case h.MSG_OA:a=!1;case h.MSG_CONTACT:e.message.params===T.c.sendToMeId&&(a=!1);case h.MSG_TEXT:case h.MSG_STICKER:case h.MSG_STICKER_2:case h.MSG_VOICE:case h.MSG_LOCATION:case h.MSG_PHOTO:case h.MSG_DOODLE:case h.MSG_FILE:case h.MSG_VIDEO:case h.MSG_GIF:case h.MSG_STICKER_GROUP:case h.MSG_PHOTO_GROUP:if((e.msgType==h.MSG_PHOTO_GROUP||e.msgType==h.MSG_STICKER_GROUP)&&e.message&&e.message.filter((e=>e.msgType!=h.MSG_UNDO)).length>0){this._isStared();s=l.a.createElement("div",{key:"other_act",className:"chat-message__photogroup "+t},l.a.createElement("div",{ref:"quickAct",className:"chat-message__actionholder photo-group "+(n?" act-contact ":"")+(i?" margin-sender-name ":"")+t}))}else{let r=null;if(a){r={minWidth:"116px"}}s=l.a.createElement("div",{key:"other_act",ref:"quickAct",className:"chat-message__actionholder "+(i?" margin-sender-name ":"")+(e.msgType==h.MSG_PHOTO_GROUP||e.msgType==h.MSG_STICKER_GROUP?" photo-group ":"")+(g.default.isTextPhoto(e)?" photo ":"")+(o?" has-caption ":"")+t+(n?" act-contact ":""),style:r})}break;case h.MSG_UNDO:s="0"===e.fromUid&&this.state.enableEditUndo&&"string"==typeof e.message?l.a.createElement("div",{className:"chat-message__actions",style:{position:"unset",width:"24px",alignSelf:"center",marginRight:"10px",borderRadius:"50px",justifyContent:"center",cursor:"pointer"},onClick:t=>this.props.addEditMsg(e)},l.a.createElement(W.a,{tagName:"div",textKey:"STR_EDIT",key:"edit-btn",className:"chat-message__actions__btn__edit"},l.a.createElement("i",{className:"fa "}))):null}return s}}ci.propTypes={replyMessage:d.a.func.isRequired,resendHandler:d.a.func.isRequired,recallMessage:d.a.func.isRequired,deleteMessage:d.a.func.isRequired,showInfoHandler:d.a.func.isRequired,message:d.a.object.isRequired,focusId:d.a.array.isRequired,dispatch:d.a.func.isRequired,focusHandler:d.a.func.isRequired};t.a=ci;const di=[h.MSG_TEXT,h.MSG_ARTICLE,h.MSG_LOCATION,h.MSG_UNDO,h.MSG_DEL_EVERYONE];const hi=new Set(["recommened.misscall","recommened.calling","recommened.receivecall"]);function ui({message:e,isShowReply:t}){const s=Qn.b.getMsgSrcDev(e);if(!s)return null;const a=e.msgType==h.MSG_PHOTO_GROUP||e.msgType==h.MSG_STICKER_GROUP;return s===h.MSG_SRC.SOCKET||s===h.MSG_SRC.MISS_MSG||s===h.MSG_SRC.GET_PREVIEW?T.c.socket.debug.show_msg_src?l.a.createElement("i",{style:{position:"absolute",bottom:t?45:a?15:5,zIndex:1,color:s===h.MSG_SRC.MISS_MSG?"#db342e":"#0068ff",opacity:.7,["0"===e.fromUid?"right":"left"]:1},className:"fa fa-"+(s===h.MSG_SRC.GET_PREVIEW?"jump-newmsg":"icon_sort")}):null:s===h.MSG_SRC.AUTO_LOADER&&T.c.cloud.debug.show_msg_src?l.a.createElement("i",{style:{position:"absolute",bottom:t?45:a?15:5,zIndex:1,color:"#0068ff",opacity:.7,["0"===e.fromUid?"right":"left"]:1},className:"fa fa-icon-solid-download"}):null}},"/Gw8":function(e,t,s){"use strict";var a=s("oMA/"),n=s("O9h/"),i=s("y+6h");let o,r,l,c,d;new Map;class h{static writeFile(e,t){return new Promise((async(s,a)=>{try{await undefined(r.dirname(e))}catch(n){return a(n)}o.writeFile(e,t,(e=>e?a(e):s(!0)))}))}static readFile(e){return new Promise(((t,s)=>{o.readFile(e,((e,a)=>e?s(e):t(a.toString())))}))}static readDir(e){d}static showInFolder(e){c.send("show-in-folder",e)}static openFile(e){}static deleteFile(e){return undefined(o.unlink)(e)}static join(...e){return r.join(...e)}static dirname(...e){return r.dirname(...e)}static getAppLogDirectory(){const e=this.getDataDirectory();return r.join(e,"logs",r.sep)}static getAppDirectory(){return r.join(r.dirname(l.remote.app.getPath("exe")),"..")}static getDataDirectory(){return""}static async getSaveAsPath(e){const t="zavi_download_dir";let s=h.join(localStorage.getItem(t)||h.getDataDirectory(),e);const{dialog:a}=l.remote,n=l.remote.getCurrentWindow();n.setAlwaysOnTop(!0),setTimeout((()=>{n.setAlwaysOnTop(!1)}),500);const i=await a.showSaveDialog(n,{title:"Save As",defaultPath:s,properties:[]}),{canceled:o,filePath:r}=i;if(o||!r)return null;const c=h.dirname(r);return localStorage.setItem(t,c),r}}var u=h;var _=s("HcYY"),m=s("oTQY"),p=s("diyV"),g=s("ZugZ"),E=s("MbiH"),f=s("KR8Z"),I=s("vKkC");const T="notes";class v extends n.b{constructor(e){super(e),this.uid=null,this.dkey=null,this.roomNotesPathMap=new Map,this.msgLastActionIdMap=new Map,this.msgMap=new Map}isTranscriptEnabled(){return a.b.feature.transcript.enable}isNoteEnabled(){return a.b.feature.note.enable}init(e,t){this.dkey=e,this.uid=t,this.loadAllMeetingNotes()}saveLastActionId(e,t){this.isTranscriptEnabled()&&(this.msgLastActionIdMap.set(e,t),localStorage.setItem(`${this.uid}_mact_${e}`,t))}loadLastActionId(e){if(this.msgLastActionIdMap.has(e))return this.msgLastActionIdMap.get(e);const t=localStorage.getItem(`${this.uid}_mact_${e}`),s=parseInt(t)||0;this.msgLastActionIdMap.set(e,s)}getMsgStorageKey(e){return`${this.uid}_msg_${e}`}setHasMoreMsg(e,t){t?localStorage.setItem(`${this.uid}_mhasm_${e}`):localStorage.removeItem(`${this.uid}_mhasm_${e}`)}getHasMoreMsg(e){const t=localStorage.getItem(`${this.uid}_mhasm_${e}`);return!!t&&+t}_processMsgOfflineData(e,t){if(!t)return;const s=this.msgMap.get(e)||this.loadMessages(e)||[];t&&t.data&&s.push(...t.data),t.hasMore?this.msgMap.set(e,s):this.msgMap.delete(e),this.setHasMoreMsg(e,+t.hasMore),this.saveMessages(e,s)}async getTranscriptOffline(e,t){const[s,a]=await this.request(i.a.getTranscriptOffline(e,t));if(s)throw s;return this._processMsgOfflineData(e,a),a}async getMessageOffline(e,t){const[s,a]=await this.request(i.a.getMessageOffline(e,t));if(s)throw s;return[s,a]}getTranscriptOfflineLocal(e){return this.loadMessages(e)}loadMessages(e){const t=localStorage.getItem(this.getMsgStorageKey(e));return this.denoise(t,!0)}addMessage(e,t){if(t)if(this.msgMap.has(e)){const s=this.msgMap.get(e)||[];s.unshift(t),this.msgMap.set(e,s)}else{const s=this.loadMessages(e)||[];s.unshift(t),this.saveMessages(e,s)}}saveMessages(e,t){if(!this.isTranscriptEnabled())return;const s=this.noise(t);if(s){if(localStorage.setItem(this.getMsgStorageKey(e),s),t&&t.length>0){const s=t[0].actionId;this.saveLastActionId(e,s)}}else m.a.logError("[msg-manager] cannot save messages")}roomHasMeetingNote(e){return this.roomNotesPathMap.has(e)}getMeetingNotePath(e){return u.join(u.getDataDirectory(),T,`${e}_${this.uid}`)}async saveMeetingNotes(e,t){if(!this.isNoteEnabled())return;const s=this.noise(t),a=this.getMeetingNotePath(e);try{t&&t.trim()?(await u.writeFile(a,s),this.roomNotesPathMap.set(e,a)):(await u.deleteFile(a),this.roomNotesPathMap.delete(e)),f.a.send(I.c.MEETING_NOTES_LOADED)}catch(n){m.a.logError("[msg-manager]","error save notes",e)}}async loadMeetingNotes(e){const t=this.getMeetingNotePath(e);try{const e=await u.readFile(t);return[null,this.denoise(e,!1)]}catch(s){return[s,null]}}async loadAllMeetingNotes(){if(this.isNoteEnabled())try{const e=u.join(u.getDataDirectory(),T),t=await u.readDir(e);for(let s of t){const t=s.split("_");2===t.length&&this.roomNotesPathMap.set(t[0],u.join(e,s))}f.a.send(I.c.MEETING_NOTES_LOADED)}catch(e){m.a.logError("[msg-manager]","loadAllMeetingNotes err",e)}}noise(e){if(!this.dkey)return"";if(!e)return"";let t=e;if("object"==typeof t)try{t=JSON.stringify(t)}catch(s){}return _.a.encrypt(t,this.dkey)}denoise(e,t=!1){if(!this.dkey)return null;if(!e)return null;let s=_.a.decrypt(e,this.dkey);if(t)try{s=JSON.parse(s)}catch(a){return s}return s}async downloadTranscript(e){const[t,s]=await this.request(i.a.downloadTranscript(e.id));if(t)return[t,null];const a=`${g.a.str("STR_TRANSCRIPT")}_${p.d.sanitizeFileName(e.name)}_${E.a.getConvertDateFromMilisecond(e.startTime,{type:"YYYY-MM-DD"}).d}.txt`,n=await u.getSaveAsPath(a);if(!n)return[null,null];try{return await u.writeFile(n,s),[null,n]}catch(t){return[t,null]}}async downloadMessage(e){const[t,s]=await this.request(i.a.downloadMessage(e.id));if(t)return[t,null];const a=`${g.a.str("STR_MESSAGE")}_${p.d.sanitizeFileName(e.name)}_${E.a.getConvertDateFromMilisecond(e.startTime,{type:"YYYY-MM-DD"}).d}.txt`,n=await u.getSaveAsPath(a);if(!n)return[null,null];try{return await u.writeFile(n,s),[null,n]}catch(t){return[t,null]}}async downloadMeetingNotes(e){const[t,s]=await this.loadMeetingNotes(e.id);if(t)return[t,null];const a=`${g.a.str("STR_NOTES")}_${p.d.sanitizeFileName(e.name)}_${E.a.getConvertDateFromMilisecond(e.startTime,{type:"YYYY-MM-DD"}).d}.txt`,n=await u.getSaveAsPath(a);if(!n)return[null,null];try{return await u.writeFile(n,s),[null,n]}catch(t){return[t,null]}}}const R=new v;t.a=R},"/Wz1":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s("VTBJ"),n=s("BTf5");const i=Object.freeze({type:"image/jpeg",noTransparent:!1,quality:1});async function o(e){var t,s;let o=Object(a.a)(Object(a.a)({},i),e),r=await Object(n.a)(o.src),{width:l,height:c}=r;o.width=null!=(t=o.width)?t:l,o.height=null!=(s=o.height)?s:c;let d=document.createElement("canvas");d.width=o.width,d.height=o.height;let h=d.getContext("2d");if(!h)throw new Error("ctx is null");return o.noTransparent&&(h.fillStyle="#fff",h.fillRect(0,0,o.width,o.height)),h.drawImage(r,0,0,o.width,o.height),await async function(e,t,s){return new Promise(((a,n)=>{e.toBlob((e=>{e?a(e):n(new Error("blob is null"))}),t,s)}))}(d,o.outputType,o.quality)}},"/YHU":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const a=s("z0WU").default.logCoreError;function n(e,t){if("object"==typeof e)return e;try{e=JSON.parse(e)}catch(s){a("parse json failed",String(e).slice(0,10),String(e).slice(-10)),e=t}return e}},"/Z5y":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s("q1tI");s("Ff2n"),s("ob4f");var n=s("t77n"),i=s("NDmK");const o=(e,t)=>e===t;function r(e,t,s=o){const[,r]=Object(a.useReducer)((e=>e+1),0),l=Object(a.useMemo)((()=>function(e){const t={_pIdOrMsgId:e,_fileKey:n.a.getFileKey(e),_idx:null},s={fn:e=>{"function"==typeof t.onStateChange&&t.onStateChange(e)}};return t.trySubscribe=()=>{t._idx=n.a.subscribe(t._fileKey,s)},t.tryUnsubscribe=()=>t._idx&&n.a.unsubscribe(t._fileKey,t._idx),t}(e)),[e]),c=Object(a.useRef)(),d=Object(a.useRef)(),h=Object(a.useRef)();let u;try{u=t(n.a.get(l._fileKey),i.c.file)}catch(_){throw h.current&&(_.message+=`\nThe error may be correlated with this previous error:\n${h.current.stack}\n\n`),_}return Object(a.useEffect)((()=>{c.current=t,d.current=u,h.current=void 0})),Object(a.useEffect)((()=>{function e(){try{const e=c.current(n.a.get(l._fileKey),i.c.file);if(s(e,d.current))return;d.current=e}catch(_){h.current=_}r({})}return l.onStateChange=e,l.trySubscribe(),e(),l.tryUnsubscribe}),[l,s]),u}},"/czl":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=(s("17x9"),s("Ydol")),o=s("kcd5"),r=s("Ys8R"),l=s("dThN"),c=s("XS0u"),d=s("PoHQ"),h=s("1pet");s("z0WU");class u extends n.a.Component{constructor(e){super(e),this.timer=null,this.delay=null,this.selectConvTimes=0,this.selectGroupConvTimes=0,this._eventHandler=(e,t)=>{if(t&&void 0!==t.payload&&null!==t.payload)switch(e){case l.DataTypes.TOOLTIPS:o.b.getQueue().length;o.b.pushQueue(t.payload),this.target||this.run();break}},i.default.subscribe(this._eventHandler);let t=c.default.getOfflineTip();t.length>0&&(t.filter((e=>"client.sendtome"===e.position)).length>0&&d.default.setHasShownSendToMeTip(!1),o.b.pushQueue(t),t.filter((e=>"sidebar.editprofile"===e.position)).length>0&&o.b.removeOfflineTip("sidebar.editprofile"));let s=o.a;s&&s.constructor===Array&&(s=s.filter((e=>{const t=c.default.checkClientOneTimeTip(e.position);return"client.sendtome"===e.position&&t&&d.default.setHasShownSendToMeTip(!1),!!e&&t})),o.b.pushQueue(s)),o.b.getQueue().length>0&&this.run(!0),this._handleClose=this._handleClose.bind(this),this.addedEvent||(this.addedEvent=!0,document.body.addEventListener("mouseup",this._handleClose,!0))}componentWillReceiveProps(e){e&&e.conversation&&(!this.props.conversation&&e.conversation||this.props.conversation&&e.conversation&&this.props.conversation.userId!==e.conversation.userId)&&(this.selectConvTimes++,e&&e.conversation&&e.conversation.userId&&e.conversation.userId.startsWith(h.GROUPID_PREFIX)&&this.selectGroupConvTimes++)}run(e=!1){this.delay&&(clearTimeout(this.delay),this.delay=null),this.delay=setTimeout((()=>{if(this.preventClose=!1,o.b.getQueue().length<=0)return this.target=void 0,void this._stopTimer();let e=o.b.getTipInQueue(this.selectConvTimes,this.selectGroupConvTimes);e?(this.target=o.b.get(e.position),this._stopTimer(),this.target.showTip(e,this._proc.bind(this))):this._startTimer(!0)}),e?10:1e3)}_proc(e,t){switch(e){case r.a.close:o.b.popQueue(t),o.b.popPendingTip(t),this.target=void 0,this.run();break;case r.a.pending:o.b.pushPendingTip(t),this.target=void 0,this.run();break;case r.a.closeOtherReddot:{let e=o.b.getCurrentReddot();if(e){let t=e.key,s=o.b.get(t);s&&s.hideReddot()}break}}}_handleClose(){if(1!=this.preventClose)if(this._stopTimer(),this.target)this.target.close().then((e=>{1==e.success&&this.run()})).catch();else{let e=o.b.getCurrentReddot();if(e){let t=e.key;if(e.ref){let s=e.ref.data;if(s&&t&&t.length>0){let e=o.b.get(t);e&&e.addParentEvent(s)}}}this.run(!0)}}_startTimer(e=!1){e&&this._stopTimer(),this.timer||(this.timer=setInterval((()=>{o.b.getQueue().length>0&&this.run(!0)}),5e3))}_stopTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}componentWillUnmount(){i.default.unsubscribe(this._eventHandler),this.addedEvent&&document.body.removeEventListener("mouseup",this._handleClose)}render(){return null}}t.a=u},"/gep":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=s("iuhU"),o=s("lCMA"),r=s("Da1s");const l="media",c="file",d="link",h="folderview",u="navigator";function _(e){let{type:t,className:s,screen:a}=e,_=4;const m="loadingDefault";let p=null,g=null,E=[];switch(t){case l:{g=Object(i.a)(m,s,"media-store-preview-item","fadeInLoading");let e={width:2==a?"98px":"72px",height:2==a?"98px":"72px"};_=2==a?50:8;for(let t=0;t<_;t++)E.push(n.a.createElement("div",{className:g,style:e}));if(2==a){p=n.a.createElement("div",{className:"loading"},n.a.createElement("div",{className:"loading__filterMedia"},n.a.createElement("div",{className:"loading__filterMedia--member"},n.a.createElement("div",{className:"loading__filterMedia--member--content loadingDefault"})),n.a.createElement("div",{className:"loading__filterMedia--date"},n.a.createElement("div",{className:"loading__filterMedia--date--content loadingDefault"}))),n.a.createElement(r.c,{className:"loading__defaultContainer",type:r.b.FLUID,size:r.a.LARGE,totalColumn:3},E));break}p=n.a.createElement("div",{className:""},n.a.createElement("div",{className:"chat-info-general__section__header"},n.a.createElement(o.a,{textKey:"STR_MENU_PHOTO_VIDEO",className:"chat-info-general__section__header--title"})),n.a.createElement(r.c,{className:"loading__defaultContainer",type:r.b.FLUID,size:r.a.LARGE,totalColumn:4},E));break}case d:{g=Object(i.a)(m,s,"loadingMediaText");let e={width:"60px",height:"60px"},t={width:"180px",height:"20px"},r={width:"100px",height:"20px",marginTop:"10px"};_=2==a?20:3;for(let s=0;s<_;s++)E.push(n.a.createElement("div",{className:"media-item library-media flx  chat-info-link"},n.a.createElement("div",{className:m,style:e}),n.a.createElement("div",{className:"z-ml chat-info-link__right"},n.a.createElement("div",{className:g,style:t}),n.a.createElement("div",{className:g,style:r}))));if(2==a){p=n.a.createElement("div",{className:"loading"},n.a.createElement("div",{className:"loading__filterFileSearch"},n.a.createElement("div",{className:"loading__filterFileSearch--search loadingDefault"})),n.a.createElement("div",{className:"loading__filterFile"},n.a.createElement("div",{className:"loading__filterFile--type"},n.a.createElement("div",{className:"loading__filterFile--type--content loadingDefault"})),n.a.createElement("div",{className:"loading__filterFile--sender"},n.a.createElement("div",{className:"loading__filterFile--sender--content loadingDefault"})),n.a.createElement("div",{className:"loading__filterFile--dateTime"},n.a.createElement("div",{className:"loading__filterFile--dateTime--content loadingDefault"}))),n.a.createElement("div",{className:"loading__defaultContainer"},E));break}p=n.a.createElement("div",{className:""},n.a.createElement("div",{className:"chat-info-general__section__header"},n.a.createElement(o.a,{textKey:"STR_LINKS",className:"chat-info-general__section__header--title"})),n.a.createElement("div",{className:"chat-info-link__group__items"},E));break}case c:{g=Object(i.a)(m,s,"loadingMediaText");let e={width:"60px",height:"60px"},t={width:"180px",height:"20px"},r={width:"100px",height:"20px",marginTop:"10px"};_=2==a?20:3;for(let s=0;s<_;s++)E.push(n.a.createElement("div",{className:"media-item library-media flx  chat-info-file"},n.a.createElement("div",{className:m,style:e}),n.a.createElement("div",{className:"z-ml chat-info-link__right"},n.a.createElement("div",{className:g,style:t}),n.a.createElement("div",{className:g,style:r}))));if(2==a){p=n.a.createElement("div",{className:"loading fadeInLoading"},n.a.createElement("div",{className:"loading__filterFileSearch"},n.a.createElement("div",{className:"loading__filterFileSearch--search loadingDefault"})),n.a.createElement("div",{className:"loading__filterFile"},n.a.createElement("div",{className:"loading__filterFile--type"},n.a.createElement("div",{className:"loading__filterFile--type--content loadingDefault"})),n.a.createElement("div",{className:"loading__filterFile--sender"},n.a.createElement("div",{className:"loading__filterFile--sender--content loadingDefault"})),n.a.createElement("div",{className:"loading__filterFile--dateTime"},n.a.createElement("div",{className:"loading__filterFile--dateTime--content loadingDefault"}))),n.a.createElement("div",{className:"loading__defaultContainer"},E));break}p=n.a.createElement("div",{className:"fadeInLoading"},n.a.createElement("div",{className:"chat-info-general__section__header"},n.a.createElement(o.a,{textKey:"STR_FILES",className:"chat-info-general__section__header--title"})),n.a.createElement("div",{className:"chat-info-link__group__items"},E));break}case h:{g=Object(i.a)(m,s,"loadingMediaText");let e={width:"152px",height:"190px",flex:"1",marginRight:"10px",marginTop:"10px"};if(2==a){_=10;for(let t=0;t<_;t++)E.push(n.a.createElement("div",{style:{display:"flex"}},n.a.createElement("div",{className:m,style:e}),n.a.createElement("div",{className:m,style:e})));p=n.a.createElement("div",{className:"loading fadeInLoading"},n.a.createElement("div",{className:"loading__defaultContainer"},E));break}_=20;for(let t=0;t<_;t++)E.push(n.a.createElement("div",{style:{width:"100%"}},n.a.createElement("div",{className:"loading__folderviewImage"},n.a.createElement("div",{className:"loading__folderviewImage__imageContainer"},n.a.createElement("div",{className:"loadingDefault loading__folderviewImage__image "}," ")),n.a.createElement("div",{className:"loading__folderviewImage__contentContainer"},n.a.createElement("div",{className:"loadingDefault loading__folderviewImage__title "}," "),n.a.createElement("div",{className:"loadingDefault loading__folderviewImage__size "}," ")))));p=n.a.createElement("div",{className:"loading fadeInLoading"},n.a.createElement("div",{className:"loading__defaultContainer",style:{padding:"0 0"}},E));break}case u:g=Object(i.a)(m,s,"loadingMediaText"),p=n.a.createElement("div",{className:"loading fadeInLoading"},n.a.createElement("div",{className:"loading__defaultContainer",style:{justifyContent:"space-between",marginTop:"10px"}},n.a.createElement("div",{className:"loading__navigator loadingDefault"}),n.a.createElement("div",{className:"loading__image loadingDefault"})));break;default:p=n.a.createElement("div",null)}return p}const m=n.a.memo(_);t.a=m},"0+y6":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=s("17x9"),o=s.n(i),r=s("ro+J"),l=s("97kL"),c=s("6uTC"),d=s("dThN"),h=s("z0WU"),u=s("K6EZ"),_=s("NDmK"),m=s("1pet"),p=s("Yi2m"),g=s("c51z"),E=s("lCn6"),f=s("egaF"),I=s("O8ue"),T=s("JDqX"),v=s("nUVR"),R=s("AM4K"),S=s("v/qp"),O=s("Ydol"),N=s("lCMA"),b=s("qwjY"),C=s("h0sc"),A=s("YCoq"),y=s("jnJr"),D=s("Ja3U");f.a;class M extends n.a.Component{constructor(e){super(e),this.state={countChoice:2,questionLenght:0,needPin:!1,question:null,checkMaxQuestion:!1},this.genId=1,this.firstTime=!0,this.listChoiceItems=[],this.listChoiceRefs={},this._addList(2),this.max_options=_.c.settings.group_poll?_.c.settings.group_poll.max_options:30,this.min_options=_.c.settings.group_poll?_.c.settings.group_poll.min_options:2,this._setPin=this._setPin.bind(this),this.eventHandler=(t,s)=>{switch(t){case l.FetchActions.GROUP_LEAVE:e.conversation.userId==s&&this._cancel(!1);break;case l.PopupActions.TOGGLE_PIN_LIMIT_CONFIRM:this.setState({needPin:this.state.needPin})}},O.default.subscribe(this.eventHandler)}componentWillUnmount(){O.default.unsubscribe(this.eventHandler)}shouldComponentUpdate(e,t){return this.state.countChoice!==t.countChoice||this.state.questionLenght!==t.questionLenght||this.state.isEditing!==t.isEditing||this.state.needPin!==t.needPin||this.state.checkMaxQuestion!==t.checkMaxQuestion}componentWillMount(){if(this.props.groupData&&this.props.groupData.convId){let e=this.props.groupData.convId.substring(1,this.props.groupData.convId.length);if(this.props.groupData.question){let e=this.props.groupData.question;e.length>121&&(e=e.slice(0,118)+"..."),this.draft={question:e,option:[]}}else this.draft=u.a.getDraft(e)}}componentDidMount(){if(this.draft){let e=0;if(this.draft.options&&this.draft.options.length>0){for(let t in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(t)){let s=this.listChoiceRefs[t];s&&this.draft.options[e]&&(s.setValue(this.draft.options[e]),e++)}if(e<this.draft.options.length)for(let t=e;t<this.draft.options.length;t++)this._addNewChoice(this.draft.options[t]);this.draft.options.length<this.max_options&&this._addNewChoice()}}this.question&&this.question.focus()}componentDidUpdate(){if(0!=this.listChoiceItems.length){if(1==this.didRemoveLast){this.didRemoveLast=!1;let e=this.listChoiceItems[this.listChoiceItems.length-1];if(e){let t=e.id,s=this.listChoiceRefs[t];s&&s.getValue().length>0&&this.listChoiceItems.length<this.max_options&&this._addNewChoice()}}}else this._addNewChoice()}_createPoll(){if(p.e.logAction(1350205),this.state.question&&0==this.state.question.trim().length)return void c.a.createWarningModal(g.default.str("STR_POLL_TOAST_CREATE_QUESTION"));let e=[];for(let n in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(n)){let t=this.listChoiceRefs[n];if(t){let s=t.getValue().trim();s.length>0&&(-1==e.indexOf(s)?e.push(s):(c.a.createWarningModal(g.default.str("STR_POLL_TOAST_DUPLICATE_OPTION")+` "${s}"`),this._removeChoice(n)))}}if(e.length<this.min_options)return void c.a.createWarningModal(g.default.str("STR_POLL_TOAST_MIN_OPTIONS")+` ${this.min_options} `+g.default.str("STR_OPTION_2"));let t=this.props.conversation.setting&&0==this.props.conversation.setting.setTopicOnly,s=this.state.needPin;t||h.default.isAdminPoll(this.props.conversation,!1,this.props.userId)||(s=!1,this.setState({needPin:!1}));let a=!1;if(this.props.groupData){let t=this.props.groupData.convId.substring(1,this.props.groupData.convId.length),n={question:this.state.question,options:e,allow_multi_choices:!0,allow_add_new_option:!0,is_anonymous:!1,poll_type:0,expired_time:0,pinAct:s?1:0};if(Object(A.f)()&&s){const e={type:m.POLL_TOPIC,pollData:n,src:this.props.createSource,isCreated:!0,isOverAnotherModal:!0};let s=null;n.pinAct&&(a=!0,s=()=>{this._cancel(!1)}),y.a.checkPinTopic(t,e,null,s)}else d.default.createPoll(t,n,this.props.createSource).then((e=>{s&&!Object(A.f)()&&this._setPin(t,e.poll_id)})).catch((e=>{e&&(e.code&&"ERR_NO_NETWORK"===e.code?c.a.createErrorModal(g.default.str("STR_CONNECTION_ERROR")):161===e.error_code?E.a.handleInvalidGroup(m.GROUPID_PREFIX+t,this.props.dispatch):c.a.createErrorModal(g.default.str("STR_POLL_TOAST_CREATE_POLL_FAILED")+(e.error_code?" ("+e.error_code+")":"")))}))}a||this._cancel(!1)}_itemNavigate(e,t,s){this._nav(!1,e,t,s)}_isAdmin(){let e=!1;if(this.props.conversation.userId.startsWith(m.GROUPID_PREFIX))return this.props.conversation.topMember.forEach((t=>{t.id===this.props.userId&&(t.id==this.props.conversation.creatorId||t.isAdmin)&&(e=!0)})),e}_getCaretPosition(){return window.getSelection&&window.getSelection().getRangeAt?window.getSelection().getRangeAt(0).startOffset:-1}_onFocusItem(e){let t="";for(let s in this.listChoiceRefs)this.listChoiceRefs.hasOwnProperty(s)&&this.listChoiceRefs[s]&&(t=s);e==t&&this.listChoiceRefs[t]&&this.listChoiceItems.length<this.max_options&&this._addNewChoice()}nextItem(e){this.listChoiceRefs[`id_${e+1}`]?this.listChoiceRefs[`id_${e+1}`].setFocus():(e+=1,this.nextItem(e))}onItemFinish(e,t){let s=parseInt(e.replace("id_",""));for(let a=0;a<this.listChoiceItems.length;a++){let n=this.listChoiceItems[a];if(n&&n.id===e){a==this.state.countChoice-1&&this._itemNavigate(e,t,!0),a<this.state.countChoice-1&&this.nextItem(s);break}}}_addList(e,t=""){for(let s=0;s<e;s++){let e="id_"+this.genId;const a=["txt_CreatePoll_Opt1","txt_CreatePoll_Opt2"];this.listChoiceItems.push({id:e,ui:n.a.createElement(b.a,{onFinish:this.onItemFinish.bind(this),onRemoveItem:this._removeChoice.bind(this),index:e,key:`poll_choice_item_${e}`,placeholder:g.default.str("STR_OPTION")+` ${this.listChoiceItems.length+1}`,ref:t=>this.listChoiceRefs[e]=t,onTextChange:this._textChangeItem.bind(this),onNavigate:this._itemNavigate.bind(this),valueDefault:t,showChecked:!1,onFocus:this._onFocusItem.bind(this),"data-id":a[s]})}),this.genId++}}_addNewChoice(){return this.listChoiceItems.length>=this.max_options?(c.a.createWarningModal(g.default.str("STR_POLL_TOAST_MAX_OPTIONS")),!1):(this.setState({countChoice:this.listChoiceItems.length}),!0)}_onAddItem(){return this._addList(1),this.listChoiceItems.length==this.max_options&&c.a.createMessageModal(g.default.str("STR_POLL_TOAST_MAX_OPTIONS")),this.setState({countChoice:this.listChoiceItems.length,isEditing:!0},(()=>{R.a.scrollToBottomDiv(this.mainView)})),!0}_removeChoice(e){let t=this.listChoiceItems.map((e=>e.id));if(!t||t.length<=this.min_options)return void c.a.createWarningModal(g.default.str("STR_POLL_TOAST_MIN_OPTIONS")+` ${this.min_options} `+g.default.str("STR_OPTION_2"));if(1==this.listChoiceItems.length){let t=this.listChoiceRefs[e];if(t&&""==t.getValue())return void h.default.logCoreError(`[poll] cannot remove choice ${t.getValue()}`)}e==this.listChoiceItems[this.listChoiceItems.length-1].id&&(this.didRemoveLast=!0);let s=t.indexOf(e);s>-1&&(this.listChoiceRefs[e]=null,this.listChoiceItems.splice(s,1));let a=null;for(let n=0;n<this.listChoiceItems.length;n++){let e=this.listChoiceItems[n];if(e){let t=e.id,s=this.listChoiceRefs[t];s&&(a=s,s.changePlaceholder(g.default.trans("STR_OPTION")+" "+`${n+1}`))}}a&&""!==a.getValue()&&(this.didRemoveLast=!0),this.listChoiceRefs[this.listChoiceItems[this.listChoiceItems.length-1].id].input.focus(),this.setState({countChoice:this.listChoiceItems.length})}_focusQuestion(){this.question&&this.question.focus()}_onChangev2(e){let t=e.target.value;0==t.trim().length?this.setState({checkMaxQuestion:!1}):t.length>121?(c.a.createWarning(g.default.str("STR_TOAST_MAX_CHARACTERS")),this.setState({checkMaxQuestion:!1})):this.setState({questionLenght:t.length,isEditing:t.length>0,question:t,checkMaxQuestion:!0})}_cancel(e=!0){let t=this.props.groupData.convId.substring(1,this.props.groupData.convId.length);if(e){let e=!1,s=this.state.question;s.trim().length>0&&(e=!0);let a=[];for(let t in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(t)){let s=this.listChoiceRefs[t];if(s){let t=s.getValue().trim();t.length>0&&(a.push(t),e=!0)}}if(e){let e={question:s,options:a};u.a.addDraft(t,e)}}else u.a.clearDraft(t);C.a.closeModal({windowId:"1",name:m.ModalIdentitiesDefine.GROUP_POLL_CREATE}),0==e?p.e.logAction(1350204):p.e.logAction(1350206)}_textChangeItem(e){this.listChoiceRefs[e].getValue().length>0?this.setState({isEditing:!0}):this.setState({isEditing:!1}),this._allHasValue()==this.listChoiceItems.length&&this.listChoiceItems.length<this.max_options&&this._addNewChoice()}_allHasValue(){let e=0;for(let t in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(t)){let s=this.listChoiceRefs[t];s&&s.getValue().length>0&&e++}return e}_questionKeyDown(e){let t=this.state.question;return e.keyCode==m.K_TAB&&e.shiftKey?this._nav(!0,"",e,!1):e.keyCode==m.K_ENTER||e.keyCode==m.K_DOWN&&this._getCaretPosition()>=t.length?this._nav(!0,"",e,!0):e.keyCode==m.K_UP&&0==this._getCaretPosition()&&this._nav(!0,"",e,!1),!0}_nav(e,t,s,a=!0){if(this.listChoiceItems.length==this.max_options)return c.a.createMessageModal(g.default.str("STR_POLL_TOAST_MAX_OPTIONS")),!1;if(e)if(a){for(let n in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(n)){let e=this.listChoiceRefs[n];if(e){e.setFocus();break}}}else{let e="";for(let t in this.listChoiceRefs)this.listChoiceRefs.hasOwnProperty(t)&&this.listChoiceRefs[t]&&(e=t);if(e){let t=this.listChoiceRefs[e];t&&t.setFocus()}}else{let e="",n=!1,i="",o="";for(let t in this.listChoiceRefs)this.listChoiceRefs.hasOwnProperty(t)&&(this.listChoiceRefs[t]&&""===o&&(o=t),this.listChoiceRefs[t]&&(i=t));for(let r in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(r)){if(1==n){let e=null;if(a){if(e=this.listChoiceRefs[r],e){e.setFocus(),n=!1;break}if(r==i&&s.keyCode!=m.K_TAB&&s.keyCode!=m.K_ENTER){this._focusQuestion();break}}}if(r===t){if(n=!0,!a){if(r==o){this._focusQuestion();break}let t=this.listChoiceRefs[e];if(t){t.setFocus();break}}if(s.keyCode!=m.K_TAB){if(s.keyCode==m.K_ENTER){if(this.listChoiceRefs){let e=1;for(let t in this.listChoiceRefs)if(this.listChoiceRefs.hasOwnProperty(t)){let s=t.slice(3);e=Math.max(e,parseInt(s))}this.listChoiceRefs[`id_${e}`];this._onAddItem()}this._nav(!0,"",s,!1);break}this._focusQuestion();break}if(this.listChoiceItems.length>=this.max_options){c.a.createWarningModal(g.default.str("STR_POLL_TOAST_MAX_OPTIONS")),this._focusQuestion();break}}else this.listChoiceRefs[r]&&(e=r)}}s.preventDefault()}_onBodyClick(e){this._focusQuestion()}_setPin(e,t){let s=m.POLL_TOPIC;d.default.pinBoardItem(e,t,s).then((e=>{e&&c.a.createMessage(g.default.trans("STR_PIN_POLL",this.data.question),3e3)})).catch((e=>{h.default.logCoreError("[group board] pin board item failed: "+JSON.stringify(e))}))}_setNeedPin(){this.setState({needPin:!this.state.needPin})}_onBackgroundClicked(e){if(this.state.isEditing){let e="STR_POLL_DRAFT_CONFIRM";D.a.openConfirm({windowId:"1",name:m.MODAL_CONFIRM.confirmIdentities,params:{message:g.default.str(e),okText:g.default.str("STR_NO"),okType:"primary",cancelText:g.default.str("STR_POLL_DRAFT_CONFIRM_CREATE"),showCloseButton:!1,onCancel:()=>{this._cancel(!1),p.e.logAction(1711317)},preventPageClickForceClose:!0}})}else this._cancel(!1)}render(){let e=this.listChoiceItems.map((e=>e.ui)),t=Math.min(this.state.countChoice,4),s=(Math.min(165,46*t+8-1),this.props.conversation.setting&&0==this.props.conversation.setting.setTopicOnly),a=!1;return this.state.isEditing&&this.state.questionLenght>0&&this.listChoiceItems.length<=this.max_options&&this.state.checkMaxQuestion&&(a=!0),n.a.createElement(r.a,null,n.a.createElement(C.d,{visible:!0,showCloseButton:!0,title:g.default.str("STR_CREATE_POLL_RAW"),width:460,noPadding:!1,onTitleClick:this._onBodyClick.bind(this),onCancel:this._onBackgroundClicked.bind(this),footer:{cancel:{textKey:"STR_CANCEL",click:this._onBackgroundClicked.bind(this,!1)},confirm:{textKey:"STR_CREATE_POLL_RAW",click:this._createPoll.bind(this),type:"primary",disabled:!a}},shadow:!0,"data-id":{title:"btn_CreatePoll_CXL",confirmBtn:"btn_CreatePoll_Create",cancelBtn:"btn_CreatePoll_CXL"},zIndex:this.props.zIndex},n.a.createElement("div",{className:"group-poll-create scroll-body-modal",ref:e=>this.mainView=e},this.state.countChoice>0?n.a.createElement("div",{className:"group-poll-create-content",id:"group-poll-create-content"},n.a.createElement(T.a,{textKey:"STR_POLL_QUESTION"},n.a.createElement(v.a,{textKey:"STR_ENTER_QUESTION",inputRef:e=>this.question=e,"data-id":"txt_CreatePoll_Question",onChange:this._onChangev2.bind(this),onKeyDown:e=>this._questionKeyDown(e)})),n.a.createElement(T.a,{textKey:"STR_OPTION_3",className:"group-poll-create-content__options-label"}),e,n.a.createElement(S.a,{icon:"ic_plus",type:"primary",size:"medium",disabled:this.listChoiceItems.length==this.max_options,modifier:"text","data-id":"div_CreatePoll_AddOpt",onClick:this._onAddItem.bind(this)},n.a.createElement(N.a,{textKey:"STR_ADD_OPTION"}))):null),s||h.default.isAdminPoll(this.props.conversation,!1,this.props.userId)?n.a.createElement(I.a,{textKey:"STR_PIN_POLL_CHBX",onChange:this._setNeedPin.bind(this),checked:this.state.needPin,shape:"square",className:"zl-notice-pin group-poll-create-content__setPin","data-id":"chk_CreatePoll_Pin"}):""))}}M.propTypes={groupData:o.a.object.isRequired},t.a=M},"01qV":function(e,t,s){"use strict";t.a="assets/folder_v2.f9e320808daff6c3119e4613a86d37b1.svg"},"01r8":function(e,t,s){"use strict";var a=s("UYGI"),n=(s("z0WU"),s("Ydol")),i=s("97kL");class o{constructor(e){this.toUid=e,this.total=0,this.holder={},this.savedPercentage={},this.recentlyPercentage=0,this.throttle=null}updateChild(e,t){null===this.throttle&&(this.savedPercentage[e]=t,this.updateTotal(),this.throttle=setTimeout((()=>{this.throttle=null}),500))}updateTotal(){let e=0;for(let t in this.savedPercentage)this.savedPercentage[t]&&!isNaN(this.savedPercentage[t])&&(e+=this.savedPercentage[t]);e/=this.total,this.recentlyPercentage=e<this.recentlyPercentage?this.recentlyPercentage++:e,this.dispatchUpdate(this.recentlyPercentage)}removeListener(e){this.holder[e]&&(this.holder[e]=void 0,delete this.holder[e],this.total--,delete this.savedPercentage[e],this.total<=0&&(this.recentlyPercentage=0,this.allUploaded()))}allUploaded(){n.default.send(i.ChatBoxActions.UPLOAD_TOTAL_PROGRESS,{conversationId:this.toUid,inProgress:!1})}dispatchUpdate(e){n.default.send(i.ChatBoxActions.UPLOAD_TOTAL_PROGRESS,{conversationId:this.toUid,inProgress:!0,progress:e})}}const r=new class{constructor(){this._holderBinding={}}addFileToUploadQueue(e,t,s,n){this._holderBinding[s]||(this._holderBinding[s]=new o(s));let i=this._holderBinding[s];if(i.holder[e])return console.error("something wrong ??? bind 2 times");i.total++,i.holder[e]=t=>{i.updateChild(e,t.percentage)};let r=a.a.bindProgress(e,i.holder[e]);r&&i.holder[e]({percentage:r})}removeFileFromUploadQueue(e,t,s){if(!this._holderBinding[t])return console.error("something wrong ??? call remove but not listen");let n=this._holderBinding[t];n.holder[e]&&a.a.removeProgress(e,n.holder[e]),n.removeListener(e)}};t.a=r},"02Ha":function(e,t,s){"use strict";var a=s("wx14"),n=s("q1tI"),i=s.n(n),o=s("ilwW"),r=s("DwXV"),l=s("Yi2m"),c=s("NDmK"),d=s("0twL"),h=s("9x5b"),u=s("6uTC"),_=s("z0WU"),m=s("c51z"),p=(s("Q8hM"),s("GQ8g")),g=s("jLRg"),E=s("AM4K"),f=s("1pet");class I extends p.a{constructor(e){super(e),this.setToolConfig(g.c),this.checkWindowSize=this.checkWindowSize.bind(this),this.checkWindowSize()}componentDidMount(){window.addEventListener("resize",this.checkWindowSize)}checkWindowSize(){const e=this.getChatViewWidth();e<=450&&this.config.length!==g.d.length?this.setToolConfig(g.d):e>450&&this.config.length!==g.c.length&&this.setToolConfig(g.c)}getChatViewWidth(){const e=window.innerWidth,t=parseInt(E.a.getLeftPannelWidth()),s=document.getElementById("chatViewContainer");return e-t-(s&&s.className&&s.className.indexOf("expand-right")>=0?f.SIZE_WINDOW.WIDTH_RIGHT_SIDEBAR:0)}componentWillUnmount(){window.removeEventListener("resize",this.checkWindowSize)}render(){return i.a.createElement("div",{id:"textFormatTools"},i.a.createElement("div",{className:"flx flx-al-c",id:"rtfTool"},this.buildFormatTool()))}}var T=I,v=s("Ydol"),R=s("97kL"),S=(s("lCMA"),s("p31x"));var O=function(e){const{urgencyMode:t,isFormattingText:s,quote:a,hasImgs:o,inputRef:r}=e;if(!t||t===f.URGENCY_MODE.NORMAL)return null;const c=Object(n.useMemo)((()=>{let e="";return t===f.URGENCY_MODE.IMPORTANT?e="solid-important":t===f.URGENCY_MODE.URGENT&&(e="solid-alert"),{pre:e}}),[t]),d=Object(n.useMemo)((()=>t===f.URGENCY_MODE.IMPORTANT?"STR_IMPORTANT":t===f.URGENCY_MODE.URGENT?"STR_URGENT":void 0),[t]);return i.a.createElement("div",{className:"urgency-indicator "+(s?"rtf-on":"")},i.a.createElement(S.a,{type:"warning",size:"l",onClose:()=>{v.default.send(R.ChatBoxActions.TOGGLE_IMPORTANT_MESSAGE,{mode:f.URGENCY_MODE.NORMAL}),t===f.URGENCY_MODE.IMPORTANT&&(r&&r._getText&&!r._getText()&&l.e.logAction(2100209),a&&l.e.logAction(2100210),o&&l.e.logAction(2100211),s&&l.e.logAction(2100212)),t===f.URGENCY_MODE.URGENT&&(r&&r._getText&&!r._getText()&&l.e.logAction(2100309),a&&l.e.logAction(2100310),o&&l.e.logAction(2100311),s&&l.e.logAction(2100312))},icon:c,textKey:d}))};let N="";function b(e,t){const{isFormattingText:s,currentUserId:p,handleCallbackTextChange:g,handleSendTextMessage:E,onKeyDown:I,placeholder:b,currentState:C,uploadFileFromPaths:A,pasteContact:y,sendExcel:D,uploadPhoto:M,quote:P,editorController:w,hasImgs:L,currentDisplayName:k}=e,[x,U]=Object(n.useState)(!0),[F,G]=Object(n.useState)(f.URGENCY_MODE.NORMAL),B=Object(n.useRef)(null),H=()=>{let e=document.getElementById("chatView");if(e){let t=x?5:3,s=Math.floor(e.clientHeight/t)-40;return s=Math.max(s,150),P&&(s+=84),F!==f.URGENCY_MODE.NORMAL&&(s+=32),s}return 150},j=Object(n.useMemo)((()=>_.default.throttleReal((()=>{if(s&&t&&t.current&&t.current.style){let e=H();t.current.style.minHeight=e+"px",t.current.style.maxHeight=e+50+"px"}}),100)),[s,x]),V=Object(n.useCallback)(((e,t)=>{switch(e){case R.ChatBoxActions.TOGGLE_IMPORTANT_MESSAGE:G(t.mode)}}),[]);Object(n.useEffect)((()=>(window.addEventListener("resize",j),v.default.subscribe(V),()=>{window.removeEventListener("resize",j),v.default.unsubscribe(V)})),[]),Object(n.useImperativeHandle)(t,(()=>({getInputRef:()=>B.current})));let K={};const W=e=>{N=e||""},Y=t=>{let s=(t.clipboardData||t.originalEvent.clipboardData).items,a=null,n=!1,i=!1,o=!1,r=null,l=null,c=null;for(let d in s)if(s.hasOwnProperty(d)){let a=s[d];if("file"==a.kind&&a.type.indexOf("image/")>=0){if(!0===e.preventPasteMedia)return u.a.createWarning(m.default.str("STR_TOAST_PASTE_TEXT_ONLY")),!0;i=!0,r&&!r.hasOwnProperty("img")&&(l=a.getAsFile(),r.img=!0)}else if("string"==a.kind&&"text/plain"==a.type){if(r&&!r.hasOwnProperty("plain_text")){r.plain_text=!0,c=(t.clipboardData||window.clipboardData).getData("Text"),c=c.replace(/\r/g,"")}}else"string"==a.kind&&"text/rtf"==a.type&&(o=!0)}if(r&&r.img&&r.plain_text&&!o)return z(t,c,l),!0;if(i){if(o){return"ERR_NULL_DATA"!=e.sendExcel(t)}return!1}if(!e.isFormattingText){if(i&&!o)return!1;for(let e in s)if(s.hasOwnProperty(e)){let i=s[e];if("string"==i.kind)if("text/plain"==i.type){a=(t.clipboardData||window.clipboardData).getData("Text"),a=a.replace(/\r/g,"")}else if("text/html"==i.type){let e=(t.clipboardData||t.originalEvent.clipboardData).getData("Text");n=!0,i.getAsString((t=>{let s=h.a.getRaw_v2(t);s||(s=e),s=d.g.replaceNonBreakingSpace(s),s=s.replace(/\r/g,""),B.current._callInsertText(s,!0)}))}}if(a){n||B.current._callInsertText(a,!0);const t=window.getSelection().toString();return(""==K.text||t==K.text)&&a.length<20&&e.pasteContact&&e.pasteContact(a),!0}}return s.length,!1},z=(e,t,s)=>{0},q=(e,t,a=!1,n=!0)=>{if(g)if(s){let s=c.c.rtf_config.disable_suggest;g(e,t,x&&a&&!s,x&&!s)}else g(e,t,a,n)},X=(e,t,s,a)=>{if(!E)return;let n=null;F!==f.URGENCY_MODE.NORMAL&&(n={urgency:F}),e&&(n={eventObject:e}),E(t,s,a,n)},J=i.a.useCallback((t=>{e.onFocus&&"function"==typeof e.onFocus&&e.onFocus(t)}),[e.onFocus]);return i.a.createElement("div",{className:"chat-input-container ",ref:t,style:(()=>{let e={};if(s){let t=H();e.minHeight=t+"px",e.maxHeight=t+50+"px"}return e})()},(()=>{let e=null;return e=s?i.a.createElement("div",null,i.a.createElement(T,{editorController:w}),P):P,e})(),i.a.createElement(O,{urgencyMode:F,isFormattingText:s,quote:P,hasImgs:L,inputRef:B.current}),i.a.createElement("div",{className:"flx w100 "+(s?" flx-col flx-1 h100 ovf-hidden":"")},(()=>{let e=null;const t={currentUserId:p,handleCallbackTextChange:q,handleSendTextMessage:X,ref:B,onKeyDown:I,currentState:C,uploadPhoto:M,uploadFileFromPaths:A,setHtmlString:W,htmlString:N,onFocus:J,_callPasteData:Y,placeholder:b};return e=s?i.a.createElement(o.a,Object(a.a)({quote:P,editorController:w},t)):i.a.createElement(r.a,Object(a.a)({currentDisplayName:k,pasteContact:y,sendExcel:D},t)),e})(),i.a.createElement("div",{className:"chat-input-btns "+(s?" rtf-mode":"")},s?i.a.createElement(S.a,{icon:{pre:{svg:x?"solid-expand":"solid-collapse"}},textKey:x?"STR_RTF_EXPAND":"STR_RTF_COLLAPSE",onClick:()=>{x?l.e.logAction(2011501):l.e.logAction(2011502),U(!x)},type:"action",style:{marginBottom:"10px"}}):null,i.a.createElement("div",{className:"flx-1"}),e.children)))}t.a=i.a.forwardRef(b)},"02c9":function(e,t,s){"use strict";var a=s("XS0u"),n=s("Yi2m");const i=new class{constructor(){}__onCreate(){this.tabTime={tab:0,ts:Date.now()},this.focusOutTs=0,this.idleTs=0,this.__onFocus();try{let e=a.default.getConvTrackingInfo();null!=e&&e.deltaTs&&this.trackingTabUsage(e,!1)}catch(e){throw e}}__onBeforeDestroy(){this.trackingTabUsage()}__onFocus(e){if(this.focusOutTs){this.blurTimer&&(clearTimeout(this.blurTimer),this.blurTimer=null);let e=Date.now(),t=this.idleTs||0,s=this.focusOutTs||0;this.idleTs=t+(e-s),this.focusOutTs=0}}__onBlur(e){this.blurTimer&&(clearTimeout(this.blurTimer),this.blurTimer=null),this.blurTimer=setTimeout((()=>{this.focusOutTs=Date.now()}),1e3)}onChangeTab(e){this.tabTime.tab!==e&&(this.trackingTabUsage(),this.tabTime={tab:e,ts:Date.now()})}trackingTabUsage(e=null,t=!0){var s,i;let o=Date.now(),r=(null==e?void 0:e.deltaTs)||o-((null===(s=this.tabTime)||void 0===s?void 0:s.ts)||o)-(this.idleTs||0);this.idleTs&&(this.idleTs=0);let l=(null==e?void 0:e.tab)||(null===(i=this.tabTime)||void 0===i?void 0:i.tab)||0;t&&a.default.setConvTrackingInfo({tab:l,deltaTs:r});try{n.e.logActionInfo(n.b.ConversationUX,2,[l?"Unread":"All",r])}catch(c){}a.default.removeConvTrackingInfo()}};t.a=i},"02jS":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s("q1tI"),n=s.n(a),i=s("iuhU");const o={Play:"play",Pause:"pause"},r=0;function l(e,t){const{status:s=o.Play,progress:a=r,className:l,children:c}=e,d=Object(i.a)("file-progress",l),h=`file-progress__fill--${s}`;return n.a.createElement("div",{ref:t,className:d},n.a.createElement("div",{className:"file-progress__track"},n.a.createElement("div",{style:{width:a+"%"},className:h})),c)}const c=n.a.memo(n.a.forwardRef(l));t.b=c},"07hl":function(e,t,s){"use strict";var a=s("rePB"),n=s("q1tI"),i=s.n(n),o=s("z0WU"),r=s("97kL"),l=(s("DPHK"),s("aQZC")),c=s("XS0u"),d=s("Ydol"),h=s("JDlE"),u=s("Iawr"),_=s("Enw1"),m=s("pYbT"),p=s("Yi2m"),g=s("c51z"),E=s("6uTC"),f=s("1pet"),I=s("dGAM"),T=s("NGyP"),v=s("Q8hM"),R=s("gwig"),S=s("AM4K"),O=s("1PLK"),N=s("UiPd"),b=s("tjbP"),C=s("mWZ/");const A=o.default.isWeb(),y=new Set(["doc","xlsx","ppt","pptx","xls","docx"]);let D;A||(D=s("Dprd").default);class M extends i.a.Component{constructor(e){if(super(e),this.state={loaded:!this.props.isAlive,arrFileDonwloadDone:[],localPath:this.props.message.localPath,isDownloading:!1,isMaximized:!1,isError:!1},!A){const e=s("vbkW");this.ipc=e.ipcRenderer,this._onWindowStateChanged=(e,t)=>{switch(t){case"maximize":this.setState({isMaximized:!0});break;case"unmaximize":this.setState({isMaximized:!1})}}}let t=this.props.message.message&&this.props.message.message.title?this.props.message.message.title:this.props.message.message;t&&"string"==typeof t||(t=""),this.previewSupport=I.b.isWebViewSupported(t),this.active=!0,this.retry=!1,this._countRetry=0,this.retryInterval,this._onKeyPress=this._onKeyPress.bind(this)}componentDidMount(){var e;if(this._document=(null===(e=this.context)||void 0===e?void 0:e.document)||document,window.addEventListener("keydown",this._onKeyPress,!1),this.props.isAlive&&(this.retryInterval=window.setInterval((()=>{this.retry?this.forceUpdate():clearInterval(this.retryInterval)}),3500),this._webView&&(this._webView.addEventListener("did-fail-load",this._onFrameLoaded.bind(this)),this._webView.addEventListener("did-finish-load",this._onFrameError.bind(this)))),!A&&this.ipc&&this.ipc.on("visibility-change",this._onWindowStateChanged),window._fileData){let e="Zalo File";this.props.convName&&(e+=` (${this.props.convName})`),window.document.title=e}}componentWillUnmount(){this.props.isAlive&&(this._webView&&(this._webView.removeEventListener("did-fail-load",this._onFrameError.bind(this)),this._webView.removeEventListener("did-finish-load",this._onFrameLoaded.bind(this))),clearInterval(this.retryInterval)),window.removeEventListener("keydown",this._onKeyPress,!1)}componentWillMount(){this.props.message&&this.setState({isPhoto:this._isPhoto(this.props.message)})}shouldComponentUpdate(e,t){return this.state.loaded!=t.loaded||this.state.arrFileDonwloadDone!==t.arrFileDonwloadDone||this.state.isDownloading!==t.isDownloading||this.state.isMaximized!==t.isMaximized||this.state.isError!==t.isError||this.props.previewUrl!==e.previewUrl}componentWillReceiveProps(e){this.props.previewUrl!==e.previewUrl&&this.setState({loaded:!1})}componentDidUpdate(){if(window._fileData){let e="Zalo File";this.props.convName&&(e+=` (${this.props.convName})`),window.document.title=e}}_hide(e){this.props.dispatch({type:r.PopupActions.TOGGLE_FILE_PREVIEW}),e&&(e.stopPropagation(),e.preventDefault()),this.props.onClose&&this.props.onClose()}_onKeyPress(e){27==e.keyCode&&this._hide(e)}_onFrameLoaded(){if(R.b.getStateNetwork()){if(!A&&this._iframe){let e=this._iframe.contentDocument,t=".ndfHFb-c4YZDc-Wrql6b, .ndfHFb-c4YZDc-rovI0b-haAclf {display:none}",s=document.createElement("style");s.innerHTML=t,e.head.appendChild(s)}this.setState({loaded:!0})}else this.setState({loaded:!0,isError:!0});this.retry=!1}_isPhoto(e){let t=!1;if(e.message.title&&!this.state.isDownloading){let a=null;try{a=e.message.params?JSON.parse(e.message.params):null}catch(s){o.default.logCoreError(s)}t=o.default.isPhoto(e.message.title,a.fileExt)}else t=e.cancelled?o.default.isPhoto(e.message,""):o.default.isPhoto(this.state.isDownloading?e.message.title:e.message,"");return t}_onFrameError(){this.setState({isError:!0}),o.default.logCoreError("file-preview: frame error")}_onDownloadFileDone(e,t,s,a=!0){if(!e&&s){if("granted"===u.a.getPermissionNotifyLevel()&&!l.a.isActive()&&u.a.isEnabled(this.props.user.userId)){let e;e=()=>{}}if(!A&&!a){let e=this.state.arrFileDonwloadDone.slice();e.push({msgId:t,localPath:s}),this.setState({arrFileDonwloadDone:e,localPath:s})}_.f.isSetSound(this.props.user.userId)&&h.a.playNoti(),c.default.updateFile(t,{msgId:t,localPath:s,downloadError:!1},["localPath","downloadError"]),a&&(this.setState({isDownloading:!1,localPath:s}),D.openItem(s))}}_removeItemNotifyDownload(e){if(e)for(let t=0;t<this.state.arrFileDonwloadDone.length;++t){let s=this.state.arrFileDonwloadDone[t];if(e.msgId===s.msgId&&e.localPath===s.localPath){let e=this.state.arrFileDonwloadDone.slice();e.splice(t,1),this.setState({arrFileDonwloadDone:e})}}}_handleDownloadFile(e){e.preventDefault(),e.stopPropagation();const t=this.props.message;let s={};t.message.params&&(s=JSON.parse(t.message.params)),D.downloadFile(t,{completeChannel:`download-file-done-${t.msgId}`,completeCallback:(e,t,s)=>{this._onDownloadFileDone(e,t,s,!1)},testChecksum:s.checksum,saveAs:!0,existingPath:this.state.localPath},this.props.user.userId)}_onFilePathUpdated(e){const t=this.props.message;this.active&&this.setState({localPath:e}),t.msgType===f.MSG_FILE&&(c.default.updateFile(t.msgId,{msgId:t.msgId,localPath:e},["localPath"]),c.default.updateMessage(t.msgId,{msgId:t.msgId,localPath:e},["localPath"]))}_openFile(e){e.preventDefault(),e.stopPropagation(),p.e.logAction(1071910);const t=this.props.message,s=this.state.localPath;if(s)return void D.fileExists(s).then((e=>{e?(p.e.logAction(1071910),D.openItem(s)):(E.a.createError(g.default.str("STR_TOAST_FILE_NOT_FOUND")),this._onFilePathUpdated(""),d.default.send(r.ChatBoxActions.FILEPATH_UPDATED,{msgId:t.msgId,localPath:""}))}));if(!this.props.isOnline)return void E.a.createError(g.default.str("STR_TOAST_CONNECTION_FAILED"));let a={};if(t.message.params)try{a=JSON.parse(t.message.params)}catch(e){o.default.logCoreError(e)}this.setState({isDownloading:!0}),D.downloadFile(t,{completeChannel:`download-file-done-${t.msgId}`,completeCallback:this._onDownloadFileDone.bind(this),testChecksum:a.checksum,directory:D.getZaloFilesPath(),existingPath:this.state.localPath},this.props.user.userId)}_webDownload(e){var t;e.stopPropagation(),e.preventDefault();let s=null;null!==(t=this.context)&&void 0!==t&&t.window&&(s=this.context.window.open()),O.b.openWithTab(o.default.removeProtocol(this.props.message.message.href),s,null,null,this._document)}minimize(){this.ipc&&this.ipc.send("frame-minimize",this.props.windowType)}maximize(){this.ipc&&(this.ipc.send("frame-maximize",this.state.isMaximized,this.props.windowType),this.setState({isMaximized:!this.state.isMaximized}))}render(){let e,t,s,a=null,n=null,r=!1,l=this.props.label.lastIndexOf("."),c=null;l>0&&(c=this.props.label.substr(l+1).toLowerCase(),y.has(c)&&(r=!0));try{a=this.props.message.message.params?JSON.parse(this.props.message.message.params):null}catch(u){return void o.default.logCoreError(u)}let d=this.props.message.sendDttm;if(e=this.props.message.fromUid,this.props.fromName||this.props.fromAvatar)t=this.props.fromName||"",s=this.props.fromAvatar||"";else if("0"===e)t=this.props.user.displayName;else{let a=N.default.getMiniInfo(e);a&&(t=a.dName,s=a.avatar)}if(this.props.isAlive&&!this.state.isError){let e=!1;if(this.props.url==this.props.previewUrl&&this.props.label)n=["mov","avi","flv","mov","mp3","mp4","mpeg4","webm"].indexOf(c)>=0?i.a.createElement("video",{key:"c1",width:"100%",style:{height:"calc(100vh - 60px)"},controls:!0,autoPlay:!0},i.a.createElement("source",{src:o.default.removeProtocol(this.props.url),type:"video/mp4"}),"Your browser does not support the video tag."):i.a.createElement("div",{style:{margin:"auto auto"}},i.a.createElement("img",{src:this.props.url,style:{width:"100%",height:"auto"}})),this.setState({loaded:!0});else{let t,s=this.props.previewUrl;this.retry&&!this.state.loaded?(s+="&retry="+this._countRetry++,4===this._countRetry&&(clearInterval(this.retryInterval),e=!0,this.setState({isError:!0,loaded:!0}))):this.state.loaded||(this.retry=!0),this.state.loaded?s=this._lastRetrySrc:this._lastRetrySrc=s,t="calc(100vh - 50px)","ppt"===c||"pptx"===c?t="calc(100vh - 60px)":"xls"===c||"xlsx"===c?t="calc(100vh - 34px)":"doc"!==c&&"docx"!==c||(t="calc(100vh - 60px)"),!y.has(c)||A||e?e||(n=i.a.createElement("iframe",{ref:e=>this._iframe=e,scrolling:"yes",key:"iframe",width:"100%",onLoad:this._onFrameLoaded.bind(this),onError:this._onFrameError.bind(this),style:{height:t},src:s,frameBorder:"0"})):n=i.a.createElement("webview",{ref:e=>this._webView=e,src:s,style:{height:t,width:"100%"}})}}else n=i.a.createElement("div",{className:"file-preview__error"},i.a.createElement("div",{className:"error-img"},i.a.createElement("img",{src:"assets/file-error.f8d1e9e4747f309ace804fe702f92ff3.png"})),i.a.createElement("div",{className:"error-text"},i.a.createElement("div",{className:"text-1"},g.default.str("STR_SORRY")),i.a.createElement("div",{className:"text-2"},g.default.str("STR_PREVIEW_ERROR"))));let h=[];return A||(h.push(i.a.createElement("i",{key:"minimize",className:"fa fa-frame-icon-minimize minimize",style:{fontSize:"2px"},onClick:this.minimize.bind(this)})),this.state.isMaximized?h.push(i.a.createElement("i",{key:"maximize",className:"fa fa-frame-icon-restoredown maximize",style:{fontSize:"10px"},onClick:this.maximize.bind(this)})):h.push(i.a.createElement("i",{key:"maximize",className:"fa fa-frame-icon-maximize maximize",onClick:this.maximize.bind(this)}))),window._fileData||h.push(i.a.createElement("i",{key:"close",className:"fa fa-file-preview-close close",onClick:this._hide.bind(this)})),i.a.createElement("div",{className:"file-preview",style:{position:"absolute",width:"100vw",height:"100vh",zIndex:"9999",display:"flex",flexDirection:"column"},ref:e=>this._filePreview=e},i.a.createElement("div",{className:"file-preview__main flx",style:{overflowX:"auto",flex:"1 1 auto"}},this.state.loaded?null:i.a.createElement("div",{style:{position:"absolute",backgroundColor:"rgba(0,0,0,0)",zIndex:9999},className:"preloader-container",key:"preload-container"},i.a.createElement("div",{className:"preloader"})),i.a.createElement("div",{className:"file-preview__main-iframe"},i.a.createElement("div",{className:"file-preview__notify"},i.a.createElement(m.a,{key:"notify",arrDownloadDone:this.state.arrFileDonwloadDone,removeItemNotify:this._removeItemNotifyDownload.bind(this)})),this.props.url==this.props.previewUrl&&this.props.label&&!this.state.isError&&this.state.isAlive?i.a.createElement("div",{className:"icon"},i.a.createElement("img",{src:C.a,className:"music"})):null,n,r?i.a.createElement("div",{className:"tool-hide"}):null),i.a.createElement("div",{className:"file-preview__main-comments"}),this.state.loaded?null:i.a.createElement("div",{className:"white-screen"})),i.a.createElement("div",{className:"file-preview__header flx flx-sp-btw"},i.a.createElement("div",{className:"file-preview__header-left"},i.a.createElement(T.b,{target:s?{avatar:s,displayName:t}:this.props.user,size:"m"}),i.a.createElement("div",{className:"file-preview__header__title"},`${this.props.label}`),i.a.createElement("div",{className:"file-preview__header__send-time"},`${t} -`," ",S.a.contextDate(d,{time:"HH:mm",date:{type:"DD/MM/YYYY"}})," ",` - ${o.default.sizeToString(+a.fileSize)}`)),i.a.createElement("div",{className:"file-preview__header-right"},i.a.createElement("span",{className:"file-preview__controls-container"},A?null:i.a.createElement(v.a,{tagName:"a",key:"open",className:"clickable view",onClick:this._openFile.bind(this),textKey:"STR_OPEN_EDITOR"},this.state.isDownloading?i.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner"}):i.a.createElement("i",{className:"fa fa-file-icon-edit-file"})),A?i.a.createElement(v.a,{tagName:"a",key:"save",className:"clickable download",onClick:this._webDownload.bind(this),textKey:"STR_DOWNLOAD_FILE"},i.a.createElement("i",{className:"fa fa-file-preview-download-icon"}," ")):i.a.createElement(v.a,{tagName:"a",key:"save",className:"clickable download",onClick:this._handleDownloadFile.bind(this),textKey:"STR_DOWNLOAD_FILE"},i.a.createElement("i",{className:"fa fa-file-preview-download-icon"}," "))),h.length>0?i.a.createElement("span",{className:"file-preview__buttons-container"},h):null)))}}Object(a.a)(M,"contextType",b.a);t.a=M},"09cJ":function(e,t,s){"use strict";s.d(t,"a",(function(){return _}));var a=s("q1tI"),n=s.n(a),i=s("c51z"),o=(s("1PLK"),s("/GXy"),s("NDmK"),s("h0sc")),r=s("1pet"),l=s("fe4A"),c=s("lCMA"),d=(s("v/qp"),s("zRkS")),h=s("B8k8"),u=s("Yi2m");const _=n.a.memo((e=>{const{text:t,textArgs:s,onClick:a}=e;return n.a.createElement("div",{className:"flx flx-al-c"},n.a.createElement(c.a,{textKey:t,textArguments:s,onClick:a,tagName:"div",className:"snack-description clickable"}),n.a.createElement(d.a,{onClick:a,role:"button",title:i.default.trans(t,s),className:"solid-right-1 snack-link-icon clickable"}))})),m="fallback-update-key";t.b=e=>{const{updateInfo:t}=e,s=Object(a.useRef)(0);Object(a.useEffect)((()=>{var e;return h.a.closeByKey(m+s.current),s.current=s.current+1,t&&t.meta&&t.notify&&Object(l.b)("fallback-update",{icon:"download",title:"STR_UPDATE_FALLBACK_TITLE",descriptionHtml:n.a.createElement(_,{text:"STR_UPDATE_FALLBACK_DESCRIPTION",textArgs:null===(e=t.meta)||void 0===e?void 0:e.version,onClick:i}),key:m+s.current,showUpdatePopup:i,primary:{textKey:"STR_UPDATE",onClick:c},secondary:{textKey:"STR_SUPPORT_UPDATE_BTN_CANCEL"}}),u.e.logAction(1280703),()=>{h.a.closeByKey(m+s.current)}}),[]);const i=()=>{o.a.openModal({windowId:"1",name:r.ModalIdentitiesDefine.APP_DOWNLOAD_UPDATE,params:t}),u.e.logAction(128070301)},c=()=>{0};return null}},"0KKY":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("q1tI"),i=s.n(n),o=s("1pet"),r=s("NGyP"),l=s("/GXy"),c=s("MmWw"),d=s("41Rw"),h=s("0qCE"),u=s("AM4K"),_=s("6U8Z"),m=s("x4D7"),p=s("IvK1"),g=s("lCMA"),E=s("z0WU"),f=s("NDmK"),I=(s("qYNW"),s("BZLJ")),T=s("XS0u"),v=s("UiPd");class R extends i.a.Component{constructor(e){super(e),this.state={conversationInfo:null}}shouldComponentUpdate(e,t){return this.props.data!==e.data||this.props.data.status!==e.data.status||this.props.count!==e.count||this.state.conversationInfo!==t.conversationInfo}componentDidMount(){this.updateToParent();let e=R.verifyMsgData(this.props.data,this.props.isGroup);if(e.message&&e.message.constructor===Object&&e.msgType===o.MSG_TODO){let t=e.message.params.params;if("todo.create"===t.action||"todo.create"===t.act){if(t.extra){let e=I.i.getToUid(t,this.props.user.userId);T.default.getConversationForSearch(e).then((e=>{e&&this.setState({conversationInfo:e})}))}}}}componentDidUpdate(){this.updateToParent()}updateToParent(){if(this.props.onUpdateItem&&this.mainDOM){let e=this.mainDOM?this.mainDOM.offsetHeight:0,t=this.mainDOM.parentNode?this.mainDOM.parentNode.offsetTop:0;this.props.onUpdateItem(this.props.index,e,t)}}onJump(e){e&&(e.preventDefault(),e.stopPropagation());let t=R.verifyMsgData(this.props.data);if(!t)return;let s=t.isHistory;this.props.onJump&&!s&&this.props.onJump(R.verifyMsgData(this.props.data,this.props.isGroup))}onJumpOrgMsg(){R.verifyMsgData(this.props.data)&&this.props.onJumpOrgMsg&&this.props.onJumpOrgMsg(this.props.data)}onComment(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.onComment&&this.props.onComment(R.verifyMsgData(this.props.data,this.props.isGroup))}static verifyMsgData(e,t){return e?Object(a.a)(Object(a.a)({},e),{},{cliMsgId:e.cliMsgId,dName:e.dName,fromUid:e.uidFrom||e.fromUid,mentions:e.mentions,message:e.content||e.message,msgId:e.msgId,msgType:isNaN(e.msgType)?E.default.normalizeMessageType(e.msgType):e.msgType,properties:e.property||e.properties,quote:e.quote,refMessageId:e.refMessageId,sendDttm:e.ts||e.sendDttm,serverTime:e.ts||e.serverTime,status:e.status,toUid:(!0===t?o.GROUPID_PREFIX:"")+E.default.getRawGroupId(e.idTo||e.toUid),topOut:e.topOut,topOutImprTimeOut:e.topOutImprTimeOut,topOutTimeOut:e.topOutTimeOut}):e}onViewMore(){let e=R.verifyMsgData(this.props.data);e&&this.props.onViewMore&&this.props.onViewMore(e)}onGotoConversation(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.state.conversationInfo){let e=this.state.conversationInfo.userId;this.props.onGotoConversation&&this.props.onGotoConversation(e)}}renderHistoryMsg(){let e=R.verifyMsgData(this.props.data,this.props.isGroup);if(!e)return null;let t=null;if(e&&e.sendDttm){let s=parseInt(e.sendDttm);s>1&&(t=u.a.contextDate(s,{time:"HH:mm",date:{type:"DD/MM"},format:"time-first"}))}let s=e.fromUid,n=null;"0"!==s&&s!==this.props.user.userId&&s!==f.c.sendToMeId||(s=this.props.user.userId),s?(n=v.default.getMiniInfo(s),n=n?Object(a.a)(Object(a.a)({},n),{},{userId:s}):{dName:"",userId:s}):n={dName:"",userId:s};let l=null,c=!1;if(e.message)if(e.message.constructor===Object){if(e.msgType===o.MSG_TODO){let t=e.message.params.params;if("todo.create"!==t.action&&"todo.create"!==t.act||!this.state.conversationInfo)l=h.a.generateMsg(t,this.props.user.userId),l=l?l.msg:null;else{if(t.extra){let e=t.creator,s="STR_ASSIGNED_TASK_FROM";if(this.props.isGroup)s="STR_ASSIGNED_TASK_FROM_GROUP";else{let t=e;this.state.conversationInfo&&(t=this.state.conversationInfo.userId),s=t===this.props.user.userId?"STR_ASSIGNED_TASK_FROM":"STR_ASSIGNED_TASK_FROM_CONVERSATION"}e=v.default.getDName(e)||"",c=!0;let a=v.default.getDName(this.state.conversationInfo.userId);a||(a=this.state.conversationInfo.displayName),l=i.a.createElement("span",null,i.a.createElement("span",{style:{fontWeight:600}},e)," ",i.a.createElement(g.a,{textKey:s})," ",i.a.createElement("span",{style:{color:"var(--blue-300)",cursor:"pointer"}},a))}else l=null}}}else e.message.constructor===String&&(l=e.message);if(!l)return null;let d=this.onJump.bind(this);return!0===c&&(d=this.onJumpOrgMsg.bind(this)),i.a.createElement("div",null,i.a.createElement("div",{className:"rl-msg is-history"+(c?" clickable":""),ref:e=>this.mainDOM=e,onClick:d},this.props.hideAvatar?null:i.a.createElement(r.b,{target:n,outline:!1,showUnread:!1,size:"xs",className:"rl-avatar"}),i.a.createElement("div",{className:"rl-content msg-history",id:`rl-msg-${e.msgId}`},i.a.createElement("div",{className:"rl-msg-content v0",style:{marginTop:0}},i.a.createElement("div",null,l)),i.a.createElement("div",{style:{display:"flex"}},t?i.a.createElement("div",{className:"rl-msg-time v2"},t):null))))}renderRelatedMsg(){let e=R.verifyMsgData(this.props.data);if(!e)return null;let t=e.isHistory;if(t)return this.renderHistoryMsg();let s=this.props.index,n=null;if(e&&e.sendDttm){let t=parseInt(e.sendDttm);t>1&&(n=u.a.contextDate(t,{time:"HH:mm",date:{type:"DD/MM"},format:"time-first"}))}let h=e.fromUid,f=null,I=!1;"0"!==h&&h!==this.props.user.userId||(h=this.props.user.userId,I=!0),h?(f=v.default.getMiniInfo(h),f=f?Object(a.a)(Object(a.a)({},f),{},{userId:h}):{dName:"",userId:h}):f={dName:"",userId:h};let T=null,S=null,O=null,N=null,b=null,C=e.msgType;if(C===o.MSG_UNDO)b=i.a.createElement(g.a,{textKey:"STR_UNDO_MSG",className:"rl-undo-msg"});else if(e.message)if(e.message.constructor===Object){let t;switch(T=e.message.title||e.message.name,C){case o.MSG_PHOTO:case o.MSG_PHOTO_2:case o.MSG_GIF:t=e.message.normalUrl||e.message.oriUrl;case o.MSG_DOODLE:{t||(t=e.message.thumbUrl||e.message.thumb||e.message.href);let s=e.status===o.MSG_LOCAL||e.status===o.MSG_FAIL;t&&(S=i.a.createElement(d.d,{userId:this.props.user.userId,src:E.default.removeProtocol(t),msgId:e.msgId,autoRetryWhenNetworkIsBack:!0,className:"rl-thumb",isGif:C===o.MSG_GIF,conversationId:e.toUid,isLocalMsg:s,alternates:s?[{src:t,isLocal:!0}]:[]}));break}case o.MSG_CONTACT:if("recommened.link"===e.message.action){let s=e.message.params;if(s&&s.constructor===String)try{s=JSON.parse(s)}catch(w){}if(s){let a=s.mediaTitle;t=e.message.thumb;let n=e.message.href;S=i.a.createElement("div",{className:"rl-link-thumb"},i.a.createElement(d.d,{userId:this.props.user.userId,src:t,msgId:e.msgId,autoRetryWhenNetworkIsBack:!0,className:"rl-thumb-lnk",isGif:!1,conversationId:e.toUid}),i.a.createElement("div",{className:"rl-thumb-lnk-content"},i.a.createElement("div",{className:"tt truncate"},a),i.a.createElement("div",{className:"ref truncate"},n)))}}else if("recommened.user"===e.message.action){let t=e.message.params,s=v.default.getMiniInfo(t)||{userId:t,avatar:e.message.thumb,displayName:e.message.title};T=null,S=i.a.createElement("div",{className:"rl-contact-item"},i.a.createElement(r.b,{target:s,size:"xs",outline:!1,showUnread:!1,className:"rl-contact-avatar"}),i.a.createElement("div",{className:"rl-contact-content"},i.a.createElement(g.a,{textKey:"STR_NAMECARD",className:"rl-contact-title"}),i.a.createElement("div",{className:"rl-contact-name"},s.dName||e.message.title)))}break;case o.MSG_STICKER:O=i.a.createElement(_.a,{content:e.message,message:e,dispatch:this.props.dispatch});break;case o.MSG_FILE:{let t=e.message.title||e.message.name;N=i.a.createElement("div",{className:"rl-file-thumb",style:{backgroundImage:`url("${p.a.getFileThumb(t)}")`}});break}case o.MSG_FOLDER:N=i.a.createElement("div",{className:"rl-file-thumb",style:{backgroundImage:`url("${m.d.getFolderThumb()}")`}})}}else e.message.constructor===String&&(T=e.message);let A=null;b?A=b:T&&(A=l.a.renderHtmlMessage(T,e.mentions,(()=>{}),(e=>{let t=v.default.getDName(e);return t?"@"+t:null}),null,this.props.dispatch,!1,null,!0));let y=C===o.MSG_STICKER||C===o.MSG_STICKER_2,D=e.quote,M=null;D&&D.globalMsgId!=this.props.orgMsgId&&(M=i.a.createElement(c.a,{quote:D,style:{backgroundColor:!0===I?"var(--blue-650)":"var(--grey-600)",marginTop:"6px",marginBottom:0,padding:"8px 9px 8px 13px"},dispatch:this.props.dispatch,quoteTextClassName:"td-quote-text"+(!0===this.props.isFireFox?" truncate ":""),noName:0!==s,preventMouseEvent:!0}));let P=null;if(this.props.orgMsgId===e.msgId&&this.props.count&&this.props.count>1){let e=this.props.count-1;P=i.a.createElement("div",{className:"rl-footer"},i.a.createElement(g.a,{textKey:"STR_N_RESPONSE",textArguments:[e>99?"99+":e]}),i.a.createElement("div",{className:"rl-ft-line"}))}return e.message||e.msgType!==o.MSG_TEXT?i.a.createElement("div",null,i.a.createElement("div",{className:"rl-msg"+(!0===t?" is-history":"")+(!0===this.props.noSeparate?" no-separate":""),ref:e=>this.mainDOM=e,onClick:this.onJump.bind(this)},this.props.hideAvatar?null:i.a.createElement(r.b,{target:f,outline:!1,showUnread:!1,size:"xs",className:"rl-avatar"}),i.a.createElement("div",{className:"rl-content clickable"+(y?"":I?" msg-from-me":" msg-from-other")+(O?" rl-no-background":""),id:`rl-msg-${e.msgId}`},i.a.createElement("div",{className:"rl-username"},f.dName),S,M,O,i.a.createElement("div",{className:"rl-msg-content v0"},N,i.a.createElement("div",{className:"flx-1"},A)),i.a.createElement("div",{style:{display:"flex"}},n?i.a.createElement("div",{className:"rl-msg-time v2"},n):null)),!0===t&&!0!==this.props.lastItem&&!0!==this.props.noSeparate?i.a.createElement("div",{style:{height:"1px",background:"var(--grey-500)",position:"absolute",bottom:"10px",width:"calc(100% - 28px)",left:"14px"}}):null),P):null}renderThreadedMsg(){let e=R.verifyMsgData(this.props.data);if(!e)return null;let t=null;if(e&&e.sendDttm>0){let s=parseInt(e.sendDttm);t=u.a.contextDate(s,{time:"HH:mm",date:{type:"DD/MM"},format:"time-first"})}let s=e.fromUid,n=null;"0"!==s&&s!==this.props.user.userId&&s!==f.c.sendToMeId||(s=this.props.user.userId),s?(n=v.default.getMiniInfo(s),n=n?Object(a.a)(Object(a.a)({},n),{},{userId:s}):{dName:"",userId:s}):n={dName:"",userId:s};let l=null,c=null,h=null,I=null,T=null;if(e.message)if(e.message.constructor===Object){l=e.message.title||e.message.name;let t,s=e.msgType;switch(s){case o.MSG_PHOTO:case o.MSG_PHOTO_2:T=i.a.createElement(g.a,{textKey:"STR_PHOTO_MSG"});case o.MSG_GIF:t=e.message.normalUrl||e.message.oriUrl,T||(T=i.a.createElement(g.a,{textKey:"STR_GIF"}));case o.MSG_DOODLE:{t||(t=e.message.thumbUrl||e.message.thumb||e.message.href);let a=e.status===o.MSG_LOCAL||e.status===o.MSG_FAIL;t&&(c=i.a.createElement(d.d,{userId:this.props.user.userId,src:E.default.removeProtocol(t),msgId:e.msgId,autoRetryWhenNetworkIsBack:!0,className:"rl-thumb thr-item",isGif:s===o.MSG_GIF,conversationId:e.toUid,isLocalMsg:a,alternates:a?[{src:t,isLocal:!0}]:[]})),T||(T=i.a.createElement(g.a,{textKey:"STR_DOODLE_MSG"}));break}case o.MSG_CONTACT:if("recommened.link"===e.message.action){let s=e.message.params;if(s&&s.constructor===String)try{s=JSON.parse(s)}catch(S){}if(s){let a=s.mediaTitle;t=e.message.thumb;let n=e.message.href;c=i.a.createElement("div",{className:"rl-link-thumb"},i.a.createElement(d.d,{userId:this.props.user.userId,src:t,msgId:e.msgId,autoRetryWhenNetworkIsBack:!0,className:"rl-thumb-lnk",isGif:!1,conversationId:e.toUid}),i.a.createElement("div",{className:"rl-thumb-lnk-content"},i.a.createElement("div",{className:"tt truncate"},a),i.a.createElement("div",{className:"ref truncate"},n)))}T=i.a.createElement(g.a,{textKey:"STR_LINK_MSG"})}else if("recommened.user"===e.message.action){let t=e.message.params,s=v.default.getMiniInfo(t)||{userId:t,avatar:e.message.thumb,displayName:e.message.title};l=null,c=i.a.createElement("div",{className:"rl-contact-item"},i.a.createElement(r.b,{target:s,size:"xs",outline:!1,showUnread:!1,className:"rl-contact-avatar"}),i.a.createElement("div",{className:"rl-contact-content"},i.a.createElement(g.a,{textKey:"STR_NAMECARD",className:"rl-contact-title"}),i.a.createElement("div",{className:"rl-contact-name"},s.dName||e.message.title))),T=i.a.createElement(g.a,{textKey:"STR_CONTACT_MSG"})}break;case o.MSG_STICKER:h=i.a.createElement(_.a,{content:e.message,message:e,dispatch:this.props.dispatch}),T=i.a.createElement(g.a,{textKey:"STR_STICKER"});break;case o.MSG_FILE:{let t=e.message.title||e.message.name;I=i.a.createElement("div",{className:"rl-file-thumb",style:{backgroundImage:`url("${p.a.getFileThumb(t)}")`}}),T=i.a.createElement(g.a,{textKey:"STR_FILE_MSG"});break}case o.MSG_FOLDER:I=i.a.createElement("div",{className:"rl-file-thumb",style:{backgroundImage:`url("${m.d.getFolderThumb()}")`}}),T=i.a.createElement(g.a,{textKey:"STR_FOLDER_MSG"});break;case o.MSG_VOICE:T=i.a.createElement(g.a,{textKey:"STR_VOICE_MSG"})}}else e.message.constructor===String&&(l=e.message);return i.a.createElement("div",{onClick:this.onViewMore.bind(this)},i.a.createElement("div",{className:"rl-msg is-history rl-thread-body fthread-list",ref:e=>this.mainDOM=e},this.props.hideAvatar?null:i.a.createElement(r.b,{target:n,outline:!1,showUnread:!1,size:"s",className:"rl-avatar"}),i.a.createElement("div",{className:"rl-content clickable msg-history",id:`rl-msg-${e.msgId}`,style:{width:`calc(100% - ${c?155:95}px)`}},i.a.createElement("div",{className:"rl-msg-content v0",style:{marginTop:0}},i.a.createElement("div",{className:"truncate"},T," ",l)),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("div",{className:"rl-msg-sender truncate"},n.dName),t?i.a.createElement("div",{className:"rl-msg-time"},t):null)),c?i.a.createElement("div",{className:"rl-threads-item"},c):null,!0!==this.props.lastItem?i.a.createElement("div",{style:{height:"1px",background:"var(--grey-500)",position:"absolute",bottom:0,width:"calc(100% - 28px)",left:"14px"}}):null))}render(){let e=this.props.type;return"history"===e?this.renderHistoryMsg():"threaded"===e?this.renderThreadedMsg():this.renderRelatedMsg()}}t.a=R},"0QEL":function(e,t,s){"use strict";s.d(t,"a",(function(){return Q}));var a=s("q1tI"),n=s.n(a),i=(s("OU7N"),s("c51z")),o=s("lCMA"),r=s("zRkS"),l=s("v/qp"),c=s("Enw1"),d=(s("d+hT"),s("Ydol")),h=s("97kL"),u=s("1pet"),_=s("dThN"),m=s("z0WU"),p=s("egaF"),g=s("G5kb"),E=s("fP8I"),f=s("m/y0");var I=e=>{const{user:t,loginMode:s}=e;let r=!1;const l=[{text:"Tiếng Việt",value:u.LANG_INDEX_VI},{text:"English",value:u.LANG_INDEX_EN}];t&&(r=!!c.f.getConfigShowAllUser(t.userId));const[E,I]=Object(a.useState)(r),[T,v]=Object(a.useState)(!1),[R,S]=Object(a.useState)(c.f.isRememberMe()),[O,N]=Object(a.useState)(i.default.currentLanguage());Object(a.useEffect)((()=>{0}),[]);const b=e=>{I(e),c.f.setConfigShowAllUser(t.userId,e?1:0),d.default.send(h.FriendListActions.CHANGE_MODE_SHOW_CONTACT,null)};return n.a.createElement(p.b,null,n.a.createElement("div",{className:"setting--bottom"},s?null:n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label general"},n.a.createElement(o.a,{textKey:"STR_SETTING_CONTACT"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{borderBottom:"none",paddingTop:"0",paddingBottom:"8px"}},n.a.createElement(o.a,{className:"setting-section-content__description",textKey:"STR_SETTING_CONTACT_DES"})),n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{borderBottom:"none",paddingTop:"8px",paddingBottom:"8px"}},n.a.createElement(o.a,{textKey:"STR_SHOW_ALL_CONTACT"}),n.a.createElement(g.a,{onChange:()=>b(!0),useExternalValue:!0,checked:E})),n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{paddingTop:"8px"}},n.a.createElement(o.a,{textKey:"STR_SHOW_ACTIVE_CONTACT"}),n.a.createElement(g.a,{onChange:()=>b(!1),useExternalValue:!0,checked:!E})))),n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"setting-section-label general"},n.a.createElement(o.a,{textKey:"STR_SETTINGS_MENU_LANGUAGE"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},n.a.createElement(o.a,{textKey:"SET_SETTINGS_CHANGE_LANGUAGE"}),n.a.createElement(f.a,{popoverProps:{identity:{windowId:"1",name:u.PopoverIdentitiesDefine.DROPDOWN_LANGUAGE}},options:l,value:O,onChange:e=>{const s=()=>{i.default.changeToLang(e),N(e)};t&&t.userId?_.default.updateLanguage(e).then(s).catch((e=>{m.default.logCoreError(e),s()})):s()}}))))),s?null:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"setting-section"},null))))},T=(s("XS0u"),s("qYNW"),s("Yi2m")),v=s("EFQ6"),R=s("6uTC"),S=s("NDmK"),O=s("O8ue"),N=s("17x9"),b=s.n(N),C=s("huGB"),A=s("l53Q"),y=s("Bdpz"),D=s("oBev"),M=s("4mSp"),P=s("h/gz"),w=s("UUop");let L=0;function k(e){const{data:t={},windowId:s}=e,r=!!y.a.FeatureSettings.getFeatureStatus(),[c,d]=Object(a.useState)(r),[h,u]=Object(a.useState)(Object(P.q)());Object(a.useEffect)((()=>()=>{L=t.showQRToolTipTime||0}),[]);if(!y.a.Config.isEnableQuickReply())return null;const _=t.showQRToolTipTime>L&&!c;return n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"flx setting-section-content"},n.a.createElement("div",{className:"setting-section-content-left"},n.a.createElement("div",{className:"flx setting-section-label"},n.a.createElement("div",{className:"rel"},n.a.createElement(o.a,{textKey:"STR_TITLE_QUICK_MESSAGES"}),h?n.a.createElement("i",{className:`fa fa-red_dot ${C.o}`}):null)),n.a.createElement("div",{className:"setting-section-content__has-desc"},n.a.createElement(o.a,{textKey:"STR_INTRODUCTION_QUICK_MESSAGES",className:"setting-section-content__item__block__sub"}))),n.a.createElement("div",{className:"setting-section-content-right ml-8"},n.a.createElement("div",{className:"w100 flx flx-e setting-section-label"},n.a.createElement(M.a,{title:n.a.createElement(o.a,{textKey:"STR_QR_SETTINGS_TOOLTIPS"}),open:_,delay:500,placement:"bottom-end"},n.a.createElement("div",null,n.a.createElement(E.a,{key:"enableDoubleClickReply",onChange:e=>{e?Object(w.b)(w.a.Feature.ON_FEATURE):Object(w.b)(w.a.Feature.OFF_FEATURE),d(e),L=t.showQRToolTipTime||0;D.a.onUpdateFeatureStatus(e,null,((e,t)=>{d(e),null!=t&&t.rawError&&"ERR_NO_NETWORK"===t.rawError.code&&A.a.error(i.default.str("STR_CONNECTION_ERROR"))}))},checked:c,size:"m"})))),n.a.createElement("div",{className:"w100 flx flx-e"},n.a.createElement(l.a,{className:"setting-section-content__message__btn",disabled:!c,onClick:()=>{h&&(u(!1),Object(P.d)()),Object(w.b)(w.a.Management.ON_OPEN_IN_SETTINGS),D.a.showManagerModal(s,{from:"settings"}),D.a.closeSettings(s)},type:"tertiary",size:"medium"},n.a.createElement(o.a,{textKey:"STR_MANAGE"}))))))}k.propTypes={windowId:b.a.string.isRequired};var x=k;var U=e=>{const{data:t,user:s,dispatch:r,windowId:_}=e;let m,g,f,I,R,S,N,b=!1;s&&(m=c.f.getEnableAutoDownload(s.userId),g=c.f.getEnableFileThumbnail(s.userId),f=c.f.getFlag(s.userId,c.b,1),I=c.f.getConfigCopyExcelMode(s.userId),R=c.f.getYoutubePreview(s.userId),S=c.f.getConfigShowTypingTabMsg(s.userId),N=c.f.getInlineVideoAutoPlaying(s.userId),b=c.f.getVideoInlineSound(s.userId));const[C,A]=Object(a.useState)(m),[y,D]=Object(a.useState)(g),[M,P]=Object(a.useState)(null),[w,L]=Object(a.useState)(f),[k,U]=Object(a.useState)(I),[F,G]=Object(a.useState)(R),[B,H]=Object(a.useState)(S),[j,V]=Object(a.useState)(N),[K,W]=Object(a.useState)(b),[Y,z]=Object(a.useState)(!0);Object(a.useEffect)((()=>{const e=(e,t)=>{switch(e){case h.GeneralActions.UPDATE_SETTING_HIDDEN_CHAT:z(!Y)}};return d.default.subscribe(e),()=>{d.default.unsubscribe(e)}}),[M,Y]);const q=e=>{U(e),c.f.setConfigCopyExcelMode(s.userId,e)};return n.a.createElement(p.b,null,n.a.createElement("div",{className:"setting--bottom"},n.a.createElement(x,{data:t,windowId:_}),n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_TITLE_SETTING_HIDDEN_PRIVACY"})),n.a.createElement("div",{key:"hidden_chat",className:"flx-sp-btw setting-section-content__item suggestion"},n.a.createElement("div",{className:"setting-section-content__has-desc"},n.a.createElement(o.a,{textKey:"STR_DES_SETTING_HIDDEN_HIDE_CONV",className:"setting-section-content__item__block__sub"})),v.a.getPIN()?n.a.createElement("div",null,n.a.createElement(l.a,{className:"setting-section-content__message__btn",onClick:()=>{T.e.logAction(1970401),r&&r({type:h.PopupActions.SHOW_POPUP_HIDDEN_CHAT,payload:{screenCurrent:u.SCREEN_POPUP_HIDDEN_CHAT.CHANGE_PIN_STEP_1}})},type:"tertiary",size:"medium",title:i.default.str("STR_HINT_SETTING_HIDDEN_CHANGE_PIN")},n.a.createElement(o.a,{textKey:"STR_BUTTON_SETTING_HIDDEN_CHANGE_PIN"})),n.a.createElement(l.a,{className:"setting-section-content__message__btn",onClick:()=>{T.e.logAction(1970501),r&&r({type:h.PopupActions.SHOW_POPUP_HIDDEN_CHAT,payload:{screenCurrent:u.SCREEN_POPUP_HIDDEN_CHAT.REMOVE_PIN}})},type:"secondary-red",size:"medium",title:i.default.str("STR_HINT_SETTING_HIDDEN_RESET_PIN")},n.a.createElement(o.a,{textKey:"STR_BUTTON_SETTING_HIDDEN_RESET_PIN"}))):n.a.createElement(l.a,{className:"setting-section-content__message__btn",onClick:()=>{T.e.logAction(1970301),r&&r({type:h.PopupActions.SHOW_POPUP_HIDDEN_CHAT,payload:{screenCurrent:u.SCREEN_POPUP_HIDDEN_CHAT.CREATE_PIN_FROM_SETTING}})},type:"secondary",size:"medium"},n.a.createElement(o.a,{textKey:"STR_BUTTON_SETTING_HIDDEN_SET_PIN"})))),!1,n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label general"},n.a.createElement(o.a,{textKey:"STR_SETTING_COPY_EXCEL"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{borderBottom:"none",paddingTop:"8px",paddingBottom:"8px"}},n.a.createElement(o.a,{className:"setting-section-content__description",textKey:"STR_SETTING_COPY_EXCEL_DES"})),n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{borderBottom:"none",paddingTop:"8px",paddingBottom:"8px"}},n.a.createElement(o.a,{textKey:"STR_SEND_EXCEL_PHOTO_SETTINGS"}),n.a.createElement(O.a,{onChange:()=>q(1),checked:1==k,useExternalValue:!0})),n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{borderBottom:"none",paddingTop:"8px",paddingBottom:"8px"}},n.a.createElement(o.a,{textKey:"STR_SEND_EXCEL_TEXT_SETTINGS"}),n.a.createElement(O.a,{onChange:()=>q(2),checked:2==k,useExternalValue:!0})),n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{paddingTop:"8px"}},n.a.createElement(o.a,{textKey:"STR_SETTING_ASK"}),n.a.createElement(O.a,{onChange:()=>q(0),checked:0==k,useExternalValue:!0})))),n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_SETTINGS_OTHER"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},n.a.createElement(o.a,{textKey:"STR_DOUBLE_CLICK_REPLY"}),n.a.createElement(E.a,{key:"enableDoubleClickReply",onChange:e=>{L(e),c.f.setFlag(s.userId,c.b,e),d.default.send(h.GeneralActions.SETTING_CHANGED,e)},checked:w,size:"m"}))),!1,n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},n.a.createElement(o.a,{textKey:"STR_FILES_CONF_SEC_THUMB_ENABLE"}),n.a.createElement(E.a,{onChange:e=>{D(e),c.f.setEnableFileThumbnail(s.userId,e)},checked:y,size:"m"}))),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},n.a.createElement(o.a,{textKey:"STR_SETTING_DESC_SHOW_TYPING_TAB_MESSAGE"}),n.a.createElement(E.a,{onChange:e=>{H(e),c.f.setConfigTypingTabMsg(s.userId,e),d.default.send(h.GeneralActions.CHANGE_STATUS_SHOW_TYPING,e)},size:"m",checked:B}))),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general",style:{borderBottom:"none",paddingTop:"8px",paddingBottom:"8px"}},n.a.createElement(o.a,{textKey:"STR_SETTING_MSG_YOUTUBE"}),n.a.createElement(E.a,{onChange:e=>{G(e),c.f.setYoutubePreview(s.userId,e),d.default.send(h.GeneralActions.CHANGE_YOUTUBE_PREVIEW,e)},size:"m",checked:F})),null,null))))},F=(s("Lqdh"),s("h0sc"));var G=s("JDqX"),B=s("TsEa"),H=s("nUVR");var j=e=>{const{onSettingsChange:t,loginMode:s}=e,[r,l]=Object(a.useState)("default"),[c,d]=Object(a.useState)(i.default.str("STR_SETTINGS_AUTO")),[h,_]=Object(a.useState)(i.default.str("STR_SETTINGS_AUTO")),[m,g]=Object(a.useState)(i.default.str("STR_SETTINGS_AUTO")),[E,I]=Object(a.useState)(i.default.str("STR_SETTINGS_AUTO")),[T,v]=Object(a.useState)(!1),R=Object(a.useRef)(null),S=Object(a.useRef)(null),O=Object(a.useRef)(null),N=Object(a.useRef)(null),b=Object(a.useRef)(null),C=[{text:n.a.createElement(o.a,{textKey:"STR_AUTO_PROXY"}),value:"default"},{text:n.a.createElement("span",null,"HTTP/HTTPS proxy"),value:"http"},{text:n.a.createElement("span",null,"SOCK2/SOCK5 proxy"),value:"sock"}],A=(e,t)=>{let s=t||{protocol:"default",host:i.default.str("STR_SETTINGS_AUTO"),port:i.default.str("STR_SETTINGS_AUTO"),username:i.default.str("STR_SETTINGS_AUTO"),pass:i.default.str("STR_SETTINGS_AUTO")};I(s.host),d(s.port),_(s.username),g(s.pass),l(s.protocol)};Object(a.useEffect)((()=>{T&&((!1).send("proxy-set",{protocol:r,host:E,port:c,username:h,pass:m}),t&&t())}),[r,m,h,c,E]),Object(a.useEffect)((()=>(v(!0),()=>{false.removeListener("proxy-get-resp",A)})),[]);const y=(e,t)=>{if(t.which=t.which||t.keyCode,t.which==u.K_TAB)switch(parseInt(e)){case 0:S.current.focus();break;case 1:O.current.focus();break;case 2:N.current.focus();break;case 3:R.current.focus()}};return n.a.createElement(p.b,{onScroll:()=>{b&&b.current&&b.current.close()}},n.a.createElement("div",{className:"setting--bottom"},n.a.createElement("div",{className:"setting-section"},s?null:n.a.createElement(o.a,{textKey:"STR_PROXY_CONFIGURATION",tagName:"div",className:"setting-section-label"}),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"setting-section-content__item proxy"},n.a.createElement(G.a,{textKey:"STR_SETTINGS_PROXY_TYPE",style:{marginTop:"16px"}},n.a.createElement(f.a,{popoverProps:{identity:{windowId:"1",name:u.PopoverIdentitiesDefine.DROPDOWN_PROXY}},options:C,value:r,onChange:e=>(e=>{l(e),"default"==e&&(I(i.default.str("STR_SETTINGS_AUTO")),d(i.default.str("STR_SETTINGS_AUTO")),_(i.default.str("STR_SETTINGS_AUTO")),g(i.default.str("STR_SETTINGS_AUTO")))})(e),ref:b}))),n.a.createElement("div",{className:"setting-section-content__item proxy",tabindex:"-1"},n.a.createElement(G.a,{textKey:"STR_SERVER"},n.a.createElement(H.a,{ref:R,disabled:"default"===r,value:E,onKeyUp:e=>y("0",e),onChange:e=>(e=>{I(e.target.value.trim())})(e)}))),n.a.createElement("div",{className:"setting-section-content__item proxy",tabindex:"-1"},n.a.createElement(G.a,{textKey:"STR_PORT"},n.a.createElement(H.a,{ref:S,disabled:"default"===r,key:"",value:c,onKeyUp:e=>y("1",e),onChange:e=>(e=>{d(e.target.value.trim())})(e)}))),n.a.createElement("div",{className:"setting-section-content__item proxy"},n.a.createElement(G.a,{textKey:"STR_ACCESS_NAME"},n.a.createElement(H.a,{ref:O,disabled:"default"===r,value:h,onKeyUp:e=>y("2",e),onChange:e=>(e=>{_(e.target.value.trim())})(e)}))),n.a.createElement("div",{className:"setting-section-content__item proxy"},n.a.createElement(G.a,{textKey:"STR_MEETING_PASSWORD"},n.a.createElement(H.a,{ref:N,disabled:"default"===r,type:"password",onKeyUp:e=>y("3",e),value:m,onChange:e=>(e=>{g(e.target.value.trim())})(e)})))))))};var V=e=>{const{user:t}=e;let s=!0;t&&(s=c.f.useChatBg(t.userId));const[i,r]=Object(a.useState)(s);return n.a.createElement("div",{className:"setting--bottom"},n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_SETTINGS_THEMES_SETUP"})),n.a.createElement("div",{className:"setting-section-content setting-section-content__theme"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item"},n.a.createElement("div",{className:"flexcontainer--col setting-section-content__item"},n.a.createElement(o.a,{className:"setting-section-content__theme--bt10 etting-section-content__description",textKey:"STR_SETTINGS_SELECTE"}),n.a.createElement("img",{width:"105px",src:"assets/apparel-chat.49e41f9493fa4c799230e0b59d74d4a0.png",alt:"Zalo Web"}),n.a.createElement("div",{className:"flx middle-flex setting-section-content__theme__default"},n.a.createElement(O.a,{checked:!0,nonEditable:!0}),n.a.createElement(o.a,{className:"setting-section-content__theme__default__text",textKey:"STR_SETTINGS_DEFAULT"})))))),n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_SETTINGS_BACKGROUND"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},n.a.createElement(o.a,{textKey:"STR_USER_AVATAR_AS_BACKGROUND"}),n.a.createElement(E.a,{onChange:e=>{r(e),c.f.setUseChatBg(t.userId,e),d.default.send(h.GeneralActions.CHANGE_BG_CHAT,e)},checked:i,size:"m"})))))},K=s("Iawr");var W=e=>{const{user:t,dispatch:s}=e;let r,l=!0;const _=u.USER_MODE.AVAILABLE;t&&(r=K.a.isEnabled(t.userId)&&"granted"===K.a.getPermissionNotifyLevel(),l=c.f.isSetSound(t.userId));const[p,g]=Object(a.useState)(r),[f,I]=Object(a.useState)(l);Object(a.useEffect)((()=>{const e=(e,t)=>{switch(e){case h.GeneralActions.SET_PASS_CODE_STATUS_CHANGED:I(!f)}};return d.default.subscribe(e),()=>{d.default.unsubscribe(e)}}),[f]);const T=e=>{if(_===u.USER_MODE.BUSY&&1===S.c.enable_busy_mode)return;let s=e?1:0;g(e),K.a.setEnabled(t.userId,s);let a=e=>{switch(m.default.log(e),e){case"denied":case"default":K.a.setEnabled(t.userId,0),g(0),R.a.createWarningModal(i.default.str("STR_TURN_ON_NOTI_BROWSER"))}};if(K.a.isEnabled(t.userId)&&"granted"!=K.a.getPermissionNotifyLevel()){if("default"!==K.a.getPermissionNotifyLevel())return void F.a.closeModal({windowId:"1",name:u.ModalIdentitiesDefine.NOTI_GUIDE});K.a.requestPermissionNotify(a)}};return n.a.createElement("div",null,n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_SETTINGS_NOTICATIONS_SHOW"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement(o.a,{className:"setting-section-content__theme__title setting-section-content__description",textKey:"STR_SETTINGS_NOTICATIONS_CONTENT"}),n.a.createElement("div",{className:"flx flx-al-c setting-section-content__notications"},n.a.createElement("div",{className:"flexcontainer--col setting-section-content__item"},n.a.createElement("img",{width:"105px",src:p?"assets/settings-noti-mac.edf1d8c452d005e90af5a0f6ecc2d8dd.png":"assets/settings-noti-mac-off.9d7b347511fdf2e0ed063eae76c97ff0.png",alt:"Zalo Web"}),n.a.createElement("div",{className:"flx flx-center-row setting-section-content__theme__default"},n.a.createElement(O.a,{onChange:()=>T(!0),checked:p,useExternalValue:!0}),n.a.createElement(o.a,{className:"setting-section-content__theme__default__text",textKey:"STR_ON"}))),n.a.createElement("div",{className:"flexcontainer--col setting-section-content__item setting-section-content__notications__off"},n.a.createElement("img",{width:"105px",src:p?"assets/settings-noti-off.bea226f9588e00b3fbe56d3d46076a7a.png":"assets/settings-noti-off-active.64ff656a12a78afc99ea03daca9f4854.png",alt:"Zalo Web"}),n.a.createElement("div",{className:"flx flx-center-row setting-section-content__theme__default"},n.a.createElement(O.a,{onChange:()=>T(!1),checked:!p,useExternalValue:!0}),n.a.createElement(o.a,{className:"setting-section-content__theme__default__text",textKey:"STR_OFF"})))))),n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_SETTINGS_NOTICATIONS_SOUND"})),n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},n.a.createElement(o.a,{textKey:"SET_SETTINGS_SOUND_CONTENT",style:_===u.USER_MODE.BUSY&&1===S.c.enable_busy_mode?{color:"#8c95a3"}:{}}),n.a.createElement(E.a,{onChange:e=>{_===u.USER_MODE.BUSY&&1===S.c.enable_busy_mode||(I(e),c.f.setSound(t.userId,+e))},checked:f,size:"m",disabled:_===u.USER_MODE.BUSY&&1===S.c.enable_busy_mode})))))},Y=(s("VTBJ"),s("ettF"),s("PoHQ"));s("bUXd"),s("338D");window.innerHeight;s("fBUP");var z=s("NGyP");var q=e=>{const{user:t,sub_title:s}=e;let i=!1;t&&(i=c.f.getFlag(t.userId,c.d,1));const[r,l]=Object(a.useState)(i);return n.a.createElement("div",{className:"setting-section-content"},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item general"},s?n.a.createElement("div",{className:""}," ",n.a.createElement(o.a,{className:"setting-section-content__sub-title",textKey:"STR_SETTINGS_STICKER_SUGGEST"})," ",n.a.createElement(o.a,{className:"setting-section-content__description",textKey:"STR_SETTINGS_STICKER_CONTENT"})):n.a.createElement(o.a,{className:"setting-section-content__description",textKey:"STR_SETTINGS_STICKER_CONTENT"}),n.a.createElement(E.a,{size:"m",onChange:e=>{l(e),c.f.setFlag(t.userId,c.d,e),d.default.send(h.GeneralActions.SETTING_CHANGED,e)},checked:r})))};var X=e=>{const{user:t,sub_title:s}=e;let i=!1;t&&(i=c.f.getFlag(t.userId,c.a,1));const[o,r]=Object(a.useState)(i);return n.a.createElement("div",{className:"setting-section-content"},!1)};var J=e=>{const{inLoginMenu:t,user:s}=e,[r,l]=Object(a.useState)(!0),u=(e,t)=>{e&&(m=c.f.getScreenshotShortcut(e.userId),g=c.f.getScreenshotShortcutWithoutZalo(e.userId));const s=m.split("+"),a=g.split("+");return t?{modifierCtrl:m.indexOf("CommandOrControl")>-1,modifierAlt:m.indexOf("Alt")>-1,modifierShift:m.indexOf("Shift")>-1,hotkey:s[s.length-1]}:{modifierCtrl:g.indexOf("CommandOrControl")>-1,modifierAlt:g.indexOf("Alt")>-1,modifierShift:g.indexOf("Shift")>-1,hotkey:a[a.length-1]}};let _,m,g=!1;s&&(_=c.f.getShowSuggestMentions(s.userId));const[f,I]=Object(a.useState)(_),[T,v]=Object(a.useState)(u(s,!0)),[O,N]=Object(a.useState)(u(s,!1));let b={};B.g.forEach((e=>{(e.type!==B.b.GUGGY||e.type===B.b.GUGGY&&S.c.enable_guggy)&&(b["cmd_"+e.type]=B.f.isEnabled(e.type))}));const[C,A]=Object(a.useState)(b);Object(a.useEffect)((()=>{O.modifierCtrl!=T.modifierCtrl||O.modifierAlt!=T.modifierAlt||O.modifierShift!=T.modifierShift||O.hotkey!=T.key||R.a.createWarningModal(i.default.str("STR_SHORTCUT_OTHER_KEY_WITH_ZALO"))}),[T,O]),Object(a.useEffect)((()=>{d.default.send(h.GeneralActions.SETTING_CHANGED,C)}),[r]);return n.a.createElement(p.b,null,n.a.createElement("div",{className:"setting--bottom"},!1,n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-content"},n.a.createElement(q,{sub_title:!0,user:s}),n.a.createElement(X,{sub_title:!0,user:s}))),n.a.createElement("div",{className:"setting-section"},n.a.createElement("div",{className:"setting-section-label"},n.a.createElement(o.a,{textKey:"STR_SETTING_COMMAND_SUGGESTION"})),n.a.createElement("div",{className:""},n.a.createElement("div",{className:"flx flx-al-c flx-sp-btw setting-section-content__item suggestion"},n.a.createElement("div",{className:"flx flx-al-c"},n.a.createElement(z.b,{size:"s",target:{avatar:"assets/icon-suggest-mention.ccbf8676e70875d411d8eb3cbcf8c821.png"}}),n.a.createElement("div",{className:"setting-section-content__item__block"},n.a.createElement("div",{className:"setting-section-content__item__block__main"},n.a.createElement(o.a,{textKey:"STR_SETTING_SUGGEST_MENTION_TITLE"})),n.a.createElement("div",{className:"setting-section-content__item__block__sub"},n.a.createElement(o.a,{textKey:"STR_SETTING_SUGGEST_MENTION"})))),n.a.createElement("div",null,n.a.createElement(E.a,{onChange:e=>(e=>{I(e),c.f.setShowSuggestMentions(s.userId,e),d.default.send(h.GeneralActions.SHOW_SUGGEST_MENTIONS,{data:e})})(e),checked:f,size:"m"}))),n.a.createElement("div",null,B.g.map((e=>{if(e.type===B.b.GUGGY&&!S.c.enable_guggy)return null;let t=B.c[e.type],s=!C||C["cmd_"+e.type];return n.a.createElement("div",{key:e.id,className:"flx flx-al-c flx-sp-btw setting-section-content__item suggestion"},n.a.createElement("div",{className:"flx flx-al-c"},n.a.createElement(z.b,{size:"s",target:{avatar:e.avatar,displayName:e.title}}),n.a.createElement("div",{className:"setting-section-content__item__block"},n.a.createElement("div",{className:"setting-section-content__item__block__main"},e.title),n.a.createElement("div",{className:"setting-section-content__item__block__sub"},t?n.a.createElement(o.a,{textKey:t.placeholder}):null))),n.a.createElement("div",null,n.a.createElement(E.a,{onChange:t=>{return s=e.type,C["cmd_"+s]=!C["cmd_"+s],A(C),B.f.setEnable(s,C["cmd_"+s]),void l(!r);var s},checked:s,size:"m"})))})))))))};const Q={GENERALS:"Generals",MESSAGES:"Messages",NOTIFICATIONS:"Notifications",PROXY:"Proxy",SECURITY:"Security",SYNC:"Sync",THEME:"Theme",CALL:"call",UTILITIES:"utilities"},$=({icon:e="",title:t="",onItemClicked:s=(()=>!1),isActive:a=!1})=>n.a.createElement("div",{className:"setting-menu__item flx middle-flex clickable "+(a?"selected":""),onClick:s},n.a.createElement(r.a,{className:e+" setting-menu__icon"}),n.a.createElement("p",{className:"setting-menu__name"},n.a.createElement(o.a,{textKey:t})));t.b=e=>{const{user:t,dispatch:s,cancel:r,setting:c,contactList:d,loginMode:h,customData:m={},windowId:p}=e,g=Object.values(Q).indexOf(m.tab)>-1,[E,f]=Object(a.useState)(g&&m.tab||Q.GENERALS),[T,v]=Object(a.useState)(!1),[R,S]=Object(a.useState)(!1),O={height:window.innerHeight-160+"px",maxHeight:"517px",minHeight:"428px"};Object(a.useEffect)((()=>{h&&f(Q.PROXY),h||N()}),[]);const N=()=>{_.default.checkHasPassword().then((e=>{S(1===e.has_password),Y.default.checkHasPw(1===e.has_password)})).catch((e=>{e&&e.hasOwnProperty("has_password")&&(S(1===e.has_password),Y.default.checkHasPw(1===e.has_password))}))},b=e=>{r&&r()},C=()=>{v(!T)},A=[];h?A.push({id:Q.PROXY,title:"STR_SETTINGS_PROXY",icon:"icon-outline-network",content:n.a.createElement(j,{dispatch:s,onSettingsChange:C,loginMode:!0})}):(A.push({id:Q.GENERALS,title:"STR_GENERAL",icon:"icon-outline-settings",content:n.a.createElement(I,{user:t,dispatch:s})}),A.push({id:Q.THEME,title:"STR_SETTINGS_THEME",icon:"icon-outline-apprearance",content:n.a.createElement(V,{user:t})},{id:Q.NOTIFICATIONS,title:"STR_CONFIG_NOTI",icon:"icon-outline-notification",content:n.a.createElement(W,{user:t,dispatch:s})},{id:Q.MESSAGES,title:"STR_SETTING_MSG",icon:"icon-outline-chat",content:n.a.createElement(U,{data:m,dispatch:s,user:t,windowId:p})}),A.push({id:Q.UTILITIES,title:"STR_UTILITIES",icon:"icon-outline-setting",content:n.a.createElement(J,{dispatch:s,user:t,inLoginMenu:!t,onSettingsChange:C,configSize:t?O:null})}));let y=null;h||(y=A.map((({id:e,icon:t,title:s})=>n.a.createElement($,{key:s,icon:t,title:s,onItemClicked:()=>f(e),isActive:E===e}))));const D=A.map((({id:e,content:t})=>E===e?t:""));return n.a.createElement(F.d,{visible:!0,title:h?i.default.str("STR_SETTINGS_PROXY"):null,border:"no-border",showCloseButton:!0,noPadding:!0,onCancel:b,width:h?400:600,isSetting:!0,zIndex:F.a.getZIndex({windowId:p,name:u.ModalIdentitiesDefine.SETTINGS})},n.a.createElement("div",{id:"setting",className:"setting flx "+(h?"login-mode":"")},y?n.a.createElement("div",{className:"setting-menu"},n.a.createElement(o.a,{target:"p",className:"setting-menu__title",textKey:"STR_ZALO_SETTING"}),y):null,n.a.createElement("div",{className:"flx flx-col flx-1 w0 "+(h?"":"setting--content-right")},h?null:n.a.createElement(l.a,{modifier:"text",type:"tertiary",size:"medium",className:"setting__close",icon:"close f16",onClick:b}),D)))}},"0QdE":function(e,t,s){"use strict";t.a="assets/check-rounded.79aa56778645469077a054de61afa9b2.svg"},"0SAd":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("q1tI"),i=s.n(n),o=s("c7k8"),r=s("NGyP"),l=s("1pet"),c=s("z0WU"),d=s("97kL"),h=s("XS0u"),u=s("lCMA"),_=s("Yi2m"),m=s("qYNW"),p=s("dThN"),g=s("OONb"),E=s("Ydol"),f=s("c51z"),I=s("6uTC"),T=s("NDmK"),v=s("AM4K"),R=s("PoHQ"),S=s("d+hT"),O=(s("zRkS"),s("MEZx")),N=s("v/qp"),b=s("O8ue"),C=(s("nUVR"),s("bLSv")),A=s("EFQ6"),y=s("Ja3U"),D=s("h0sc");const M="1",P=1,w=2;class L extends i.a.Component{constructor(e){super(e),this.onShowContextMenu=this.onShowContextMenu.bind(this),this.onWindowResize=this.onWindowResize.bind(this),window.addEventListener("resize",this.onWindowResize)}shouldComponentUpdate(e,t){return this.props.isSelected!==e.isSelected||this.props.data!==e.data||this.props.type!==e.type||this.props.hasMyGroup!==e.hasMyGroup||this.props.enableMultiSelect!==e.enableMultiSelect}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}onWindowResize(){this.closePopover()}onRemove(e){e&&(e.stopPropagation(),e.preventDefault()),this.props.onRemoveItem&&this.props.onRemoveItem(this.props.data),this.closePopover()}onShowContextMenu(e,t,s=!1){t&&(e&&(e.preventDefault(),e.stopPropagation()),this.menu&&this.menu.show(e))}onEnableMultiSelect(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.onEnableMultiSelect&&this.props.onEnableMultiSelect(),this.closePopover(),this.props.onClick()}closePopover(){this.menu&&this.menu.close()}render(){let e=this.props.type,t=this.props.data;if(!t)return null;if(e===w){let e=t.textKey;return i.a.createElement("div",{className:"mg-item mg-title"},i.a.createElement(u.a,{textKey:e}))}let s=i.a.createElement(r.b,{target:t,outline:!1,showUnread:!1,size:"m",className:"mg-avatar"}),a=t.displayName,n=!!t.isMyGroup,o=1!==T.c.multi_group_settings.enable_my_group||!0!==this.props.hasMyGroup,c=this.props.enableMultiSelect,d=[];!0!==c&&!0===n&&d.push({textKey:"STR_REMOVE_FROM_GROUP",onclick:this.onRemove.bind(this)}),!0!==c&&!0===n&&d.push({textKey:"STR_SELECT_MULTI_GROUP",onclick:e=>this.onEnableMultiSelect(e)}),d=d.filter((e=>!!e));let h=!0===n?this.props.onClick:null,_=this.props.onOpen,m=d.length>0;return i.a.createElement("div",{className:"mg-item"+(!0===n?"":" no-action"),onClick:!0===c?h:_,onContextMenu:e=>!0===m?this.onShowContextMenu(e,n,!0):null},!0===o||!0!==c?null:i.a.createElement(b.a,{onChange:h,checked:this.props.isSelected,className:"mg-check-icon",type:"remove",disabled:!n}),s,i.a.createElement("div",{className:"mg-name truncate",title:a},a),i.a.createElement("div",{style:{flex:1}}),!0===n&&!0===m?i.a.createElement(N.a,{type:"tertiary",modifier:"text",onClick:e=>!0===m?this.onShowContextMenu(e,!0,!1):null,icon:"icon-solid-more",format:"full-rounded",size:"medium",className:"mg-more-func-group-icon","data-id":"div_MutualGrp_GrpItemCX"}):null,i.a.createElement(O.default,{popoverProps:{identity:{windowId:M,name:`${l.PopoverIdentitiesDefine.CHAT_BOX_MUTUAL_GROUP}-${this.props.index}`}},ref:e=>this.menu=e,items:d}))}}class k extends i.a.Component{constructor(e){super(e);let t=!!this.props.openMyGroupFromInit;this.state={items:[],scrollToOffset:0,selectAll:!1,filterMyGroups:t,loadState:l.DEFAULT_LOAD_STATE.LOADING,selectedItems:null,inlineKickOutContent:null,hasMyGroup:!1,enableMultiSelect:t,searchText:"",typingTimeout:0,loadingType:!1,mul:[]},this.isFireFoxBrowser=this.isFireFox(),this.cacheMutual=null,this.focusInputSearchS=!1,this.hasSearchMutual=!1,this.eventHandler=(e,t)=>{switch(e){case d.FetchActions.UPDATE_GROUP:case d.FetchActions.UPDATE_GROUP_AVATAR:{let e=Object(a.a)({},this.state.mul);if(t&&e){let s=c.default.getRawGroupId(t.grid||t.userId);if(e.hasOwnProperty(s)){let a=t.avatar,n=t.displayName;a&&(e[s].avatar=a),n&&(e[s].displayName=n),this.setState({mul:e},(()=>{this.onLoadMutualGroup(this.props)}))}}break}case d.FetchActions.GROUP_LEAVE:this.onReload(this.props)}},E.default.subscribe(this.eventHandler)}shouldComponentUpdate(e,t){return this.state.items!==t.items||this.state.scrollToOffset!==t.scrollToOffset||this.state.selectAll!==t.selectAll||this.state.filterMyGroups!==t.filterMyGroups||this.state.loadState!==t.loadState||this.state.selectedItems!==t.selectedItems||this.state.inlineKickOutContent!==t.inlineKickOutContent||this.props.mutualGroup!==e.mutualGroup||this.state.hasMyGroup!==t.hasMyGroup||this.state.enableMultiSelect!==t.enableMultiSelect||this.state.mul!==t.mul||this.state.searchText!==t.searchText}componentWillReceiveProps(e){this.props.mutualGroup!==e.mutualGroup&&this.onReload(e)}componentDidMount(){this.onReload(this.props)}componentWillUnmount(){E.default.unsubscribe(this.eventHandler)}onReload(e){this.onLoadMutualGroup(e)}onLoadMutualGroup(e,t=!1){let s=e.mutualGroup;if(!s||this.state.searchText&&this.hasSearchMutual)return;s.constructor===Array&&(s=s.reduce(((e,t)=>(t&&(e[t]=t),e)),{}));const n=e=>{if(!e)return void this.onBack();let s=e.myGroups,n=e.otherGroups,i=[],o=[],r=0,d=Object(a.a)(Object(a.a)({},n),s);for(let t in d)if(d.hasOwnProperty(t)){let e=c.default.getRawGroupId(t),n=!1;this.state.selectedItems&&this.state.selectedItems.hasOwnProperty(t)&&(n=!0);let l={data:d[t],type:P};if(s&&s.hasOwnProperty(e)){l.data=Object(a.a)(Object(a.a)({},l.data),{},{isMyGroup:!0}),o.push(l),!0===n&&r++;continue}!0!==this.state.filterMyGroups&&(i.push(l),!0===n&&r++)}this.totalItem=o.length,i=[...i,...o].sort(((e,t)=>{if(!e||!e.data)return 1;if(!t||!t.data)return-1;let s=e.data.displayName||"",a=t.data.displayName||"";return s.localeCompare(a)}));let h=this.state.selectedItems;if(!0===t)h=null;else if(h){let e=i.reduce(((e,t)=>(t&&(e[t.userId]=t),e)),{});for(let t in h)!e.hasOwnProperty(t)&&h.hasOwnProperty(t)&&delete h[t]}this.setState({items:[...i],loadState:l.DEFAULT_LOAD_STATE.RESULT,selectAll:!0!==t&&r>=this.totalItem,selectedItems:h,hasMyGroup:o.length>0,mul:d}),this.cacheMutual=[...i],this.state.searchText&&this._getSearch(this.state.searchText,this.cacheMutual)};this.onLoadGroupInfos(e.mutualGroup).then((e=>{n(e||null)})).catch((e=>{n(null)}))}onLoadGroupInfos(e){return new Promise(((t,s)=>{if(1!==T.c.multi_group_settings.enable_my_group)return void s();if(!e||e.length<=0)return void s({err_msg:"invalid data"});let n=[];for(let a=0;a<e.length;a++)n.push(c.default.getRawGroupId(e[a]));p.default.getGroupInfos(n).then((e=>{if(e){let s={},n={};for(let t in e)if(e.hasOwnProperty(t)){let a=e[t];if(a){let e=c.default.getRawGroupId(a.userId);if(a.creatorId===this.props.user.userId){s[e]=a;continue}let t=a.topMember,i=!1,o=(this.props.target||{}).userId;if(t){for(let n=0;n<t.length;n++){let r=t[n];if(r&&(r.id===this.props.user.userId||r===this.props.user.userId)&&!0===r.isAdmin&&o!==a.creatorId){s[e]=a,i=!0;break}}if(!0===i)continue}n[e]=a}}this.groupInfosCache={myGroups:s,otherGroups:n},t(Object(a.a)({},this.groupInfosCache))}else s({err_msg:"no data"})})).catch((e=>{m.Core.error("[mg] get group info error: "+JSON.stringify(e)),s(e)}))}))}onResizer({width:e,height:t}){this.clientHeight=t}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}_getItemHeight(e){let t=this.state.items;return!t||e<0||e>t.length||this.hideHiddenChat(t[e])?0:t[e]&&t[e].type===w?30:62}handleVirtualizedScroll(e){e&&null!=e.scrollTop&&this.customScrollBar&&this.customScrollBar.scrollTop(e.scrollTop)}hideHiddenChat(e){var t,s;return!(this.state.searchText&&""!=this.state.searchText||null==e||null===(t=e.data)||void 0===t||!t.userId||!A.a.isThreadHidden(null===(s=e.data)||void 0===s?void 0:s.userId))}getView(e,t){if(!this.state.items||e<0||e>this.state.items.length)return null;let s=this.state.items[e];if(!s)return null;let a=s.data,n=s.type,o=!1;return s&&this.hideHiddenChat(s)?null:(this.state.selectedItems&&a&&(o=this.state.selectedItems[a.userId]),i.a.createElement(L,{key:`mgi_${e}`,index:e,data:a,type:n,onClick:e=>this.onChooseItem(e,s),onOpen:e=>this.onOpenGroup(e,s),isSelected:o,onRemoveItem:this.onRemoveItem.bind(this),hasMyGroup:this.state.hasMyGroup,onEnableMultiSelect:this.onEnableMultiSelect.bind(this),enableMultiSelect:this.state.enableMultiSelect}))}handleCustomScroll(e){if(e){const{target:t}=e;if(!(t instanceof HTMLDivElement))return;this.setState({scrollToOffset:t.scrollTop})}}onOpenGroup(e,t){if(e&&(e.stopPropagation(),e.preventDefault()),!t)return;_.e.logAction(178010);let s=t.data;if(!s)return;let a=s.userId,n=this.props.groupRef;if(n){this.props.setNullGroupRef();let e=n.props.infoGroup.userId.startsWith(l.GROUPID_PREFIX);D.a.openModal({windowId:M,name:l.ModalIdentitiesDefine.FRIEND_PROFILE,params:{group_profile:{disableButton:!0,data:s}}}),this.props.onViewProfileGroup(s,e)}else h.default.getGroupInfo([a]).then((e=>{e&&e[a]&&D.a.openModal({windowId:M,name:l.ModalIdentitiesDefine.FRIEND_PROFILE,params:{group_profile:{disableButton:!0,data:e[a]}}}),this.state.mul&&this.state.mul[a.replace("g","")]?D.a.openModal({windowId:M,name:l.ModalIdentitiesDefine.FRIEND_PROFILE,params:{group_profile:{disableButton:!0,data:this.state.mul[a.replace("g","")]}}}):c.default.logCoreError("group-profile => show-group-member-from-mutual-group: ")})).catch((e=>{c.default.logCoreError("group-profile => show-group-member-from-mutual-group: ",e)}))}onFilterMyGroups(e,t=!0){e&&(e.stopPropagation(),e.preventDefault()),!0===t?this.logAction(403):this.logAction(404),this.state.searchText&&(this.hasSearchMutual=!1),this.setState({filterMyGroups:t,enableMultiSelect:!1},(()=>{this.onLoadMutualGroup(this.props),this.state.searchText&&this.setState({items:this.cacheMutual})}))}onToggleSelectAll(){if(this.groupInfosCache){let e=this.groupInfosCache.myGroups;if(e){let t=null;if(!0===!this.state.selectAll)for(let s=0;s<this.state.items.length;s++){let a=this.state.items[s];a&&(a&&(a.type===P||a.data&&a.data.type===P)&&a.data&&e.hasOwnProperty(c.default.getRawGroupId(a.data.userId))&&(t||(t={}),t[a.data.userId]=!0))}this.setState({selectAll:!this.state.selectAll,enableMultiSelect:!0,selectedItems:t})}}}onChooseItem(e,t,s,n=!0){if(e&&e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!t||!t.data)return;let i=Object(a.a)({},this.state.selectedItems),o=t.data.userId,r=!1;i&&(r=i[o]);let l=401;!0===s||!0!==r?(i||(i={}),i[o]=!0):(delete i[o],l=402);let c=0;for(let a in i)i.hasOwnProperty(a)&&c++;!0===n&&this.onHideKickoutInlinePopup(),this.setState({selectedItems:i,selectAll:c>=this.totalItem}),this.logAction(l)}getLoadingUI(){return i.a.createElement(g.a,{size:26,style:{marginTop:"50px"}})}getEmptyUI(){return i.a.createElement("div",null)}onKickout(){let e=[],t=[];if(this.state.selectedItems)for(let s in this.state.selectedItems)this.state.selectedItems.hasOwnProperty(s)&&(e.push(c.default.getRawGroupId(s)),t.push(this.state.mul[s]));if(e.length>0&&this.props.target){1===e.length?this.logAction(300):this.logAction(400);const s=()=>{let t=l.MULTI_GROUP_INTERACTION_SRC.PROFILE;this.props.conversation&&(t=l.MULTI_GROUP_INTERACTION_SRC.MEDIA_STORE),p.default.kickoutMemberMulti(e,this.props.target.userId,t).then((e=>{if(e){let t=e.grid_message_map,s=[],a={};if(t)for(let e in t)if(t.hasOwnProperty(e)){let n=t[e];n&&(0===n.error_code?s.push(l.GROUPID_PREFIX+e):a[e]={grid:l.GROUPID_PREFIX+e,error_code:n.error_code})}this.onPostProcessKickout(s,a)}this.onClose()})).catch((e=>{m.Core.error("[mg] kickout failed: "+JSON.stringify(e)),"ERR_NO_NETWORK"===e.code?I.a.createError(f.default.str("STR_SIGNIN_ERROR_NO_NETWORK")):I.a.createError(f.default.str("STR_REMOVE_MULTI_ERROR"))})),this.onHideKickoutInlinePopup()};let a=this.getKickoutText(t);y.a.openConfirm({windowId:M,name:l.MODAL_CONFIRM.confirmIdentities,params:{message:a,okText:f.default.str("STR_ACCEPT"),cancelText:f.default.str("STR_NO"),onOk:()=>{s()}}})}else;}onInvite(){if(this.onClose(),this.logAction(200),this.props.conversation&&1!==this.props.conversation.isFr)return void I.a.createWarning(f.default.str("STR_MAKE_FRIEND_TO_ADD_GROUP"));if(this.props.target&&1!==this.props.target.isFr)return void I.a.createWarning(f.default.str("STR_MAKE_FRIEND_TO_ADD_GROUP"));let e=l.MULTI_GROUP_INTERACTION_SRC.PROFILE;this.props.conversation&&(e=l.MULTI_GROUP_INTERACTION_SRC.CONTEXT_MENU),R.default.setMultiGroupInteractionSrc(e),D.a.openModal({windowId:M,name:l.ModalIdentitiesDefine.INVITE_MULTI,params:{common:this.props.mutualGroup,target:this.props.target}})}onClose(){this.onDisableMultiSelect(),this.props.onClose&&this.props.onClose()}onRemoveItem(e){if(!e)return;this.onChooseItem(null,{data:e,type:P},!0,!1);let t=this.state.selectedItems;t=t?Object(a.a)({},t):{},t[e.userId]=!0,this.setState({selectedItems:t},(()=>{this.onKickout()}))}getKickoutText(e){return v.a.getKickoutText(e,this.props.target)}getKickoutInlinePopup(e,t,s){return i.a.createElement("div",{className:"mg-inline-popup",ref:e=>this.kickoutInlineRef=e},i.a.createElement("div",null,this.getKickoutText(e)),i.a.createElement("div",{className:"mg-btns flx flx-center"},i.a.createElement(N.a,{textKey:"STR_NO",type:"tertiary",modifier:"outline",size:"medium",onClick:t,className:"margin-right-8"}),i.a.createElement(N.a,{textKey:"STR_ACCEPT",type:"danger",modifier:"outline",size:"medium",onClick:s})))}onShowKickoutInlinePopup(e,t,s){this.setState({inlineKickOutContent:this.getKickoutInlinePopup(e,t,s)})}onHideKickoutInlinePopup(){this.kickoutInlineRef&&(this.kickoutInlineRef.className+=" mg-hide-popup",setTimeout((()=>{this.setState({inlineKickOutContent:null})}),300))}onPostProcessKickout(e,t){if(e||(e=[]),t||(t={}),e.length<=0&&t.length<=0)return;let s=[];for(let a in t)t.hasOwnProperty(a)&&s.push(a)}logAction(e){let t=1e4*R.default.getMutualGroupSrc();_.e.logAction(182e6+t+e)}onEnableMultiSelect(){this.setState({enableMultiSelect:!0})}onDisableMultiSelect(){this.setState({enableMultiSelect:!1,selectedItems:[],mul:[]})}_getSearch(e,t){let s={},a=this;t.forEach((e=>{if(!e)return;let t=e.data.userId;s[t]||(s[t]=e.data)})),S.a.search(e,s).then((e=>{if(e&&e.all.length>0){let t=e.all,s=[];for(let e=0;e<t.length;e++){const a=t[e];let n={};n.data=a,s.push(n)}a.setState({items:s,loadingType:!1})}else this.state.searchText&&e&&0==e.all.length?a.setState({items:[],loadingType:!1}):a.setState({items:a.cacheMutual,loadingType:!1})}))}_onSearchNameChange(e){let t=e.target.value,s=this.cacheMutual;this.hasSearchMutual=!0,this.setState({loadingType:!0,searchText:t}),this._getSearch(t,s)}_onKeyPressInput(e){let t=e.target.value,s=this.cacheMutual,a=this;e.keyCode==l.K_BACK_SPACE&&(t?this._getSearch(t,s):a.setState({items:s,loadingType:!1}))}_focusInSearchBoxEvent(){this.focusInputSearch=!0}onBack(){this.props.onBack?this.props.onBack():this.onClose()}render(){if(this.state.loadState===l.DEFAULT_LOAD_STATE.LOADING)return this.getLoadingUI();let e=this.state.items?this.state.items.length:0;this.fullHeight=0;for(let i=0;i<e;i++)this.fullHeight+=this._getItemHeight(i);let t=null;t=e<=0?this.getEmptyUI():i.a.createElement("div",{style:{flex:1}},i.a.createElement(o.a,{onResize:this.onResizer.bind(this)},(({width:t,height:s})=>i.a.createElement("div",{style:{height:`${s}px`,width:`${t}px`,position:"relative",overflowX:"hidden",outline:"none"},"data-id":"div_MutualGrp_GrpList"},i.a.createElement(o.d,{id:"react-v-list",ref:e=>this.mainList=e,style:{zIndex:"1",position:"absolute",willChange:"auto",paddingTop:"10px"},width:t+(this.isFireFox()&&this.fullHeight>this.clientHeight?16:0),height:s,columnWidth:0,rowCount:e,rowHeight:e=>this._getItemHeight(e.index),overscanRowCount:5,onScroll:this.handleVirtualizedScroll.bind(this),scrollTop:this.state.scrollToOffset,rowRenderer:({index:e,style:t})=>i.a.createElement("div",{key:e,style:t,"data-id":"div_MutualGrp_GrpItem"},this.getView(e,t))}),v.a.getScrollBar({height:s},(e=>this.customScrollBar=e),this.handleCustomScroll.bind(this),this.fullHeight)))));let s=!c.default.isEmptyObject(this.state.selectedItems),a=null;a=s?this.onKickout.bind(this):this.onInvite.bind(this);let n=1!==T.c.multi_group_settings.enable_my_group,r=i.a.createElement("div",{style:{padding:"5px 20px",display:"flex",alignItems:"center"}},i.a.createElement(b.a,{shape:"square",onChange:this.onToggleSelectAll.bind(this),checked:this.state.selectAll,textKey:"STR_SELECT_ALL",disabled:!!this.state.searchText}));return i.a.createElement("div",{style:{height:"100%"},className:"flx flx-col"},!0===this.state.hasMyGroup?i.a.createElement("div",{className:"mg-header-container"},i.a.createElement(u.a,{tagName:"div",style:{fontWeight:"500"},textKey:"STR_ALL_GROUP_2",className:"mg-button"+(!0!==this.state.filterMyGroups?" selected":""),onClick:e=>this.onFilterMyGroups(e,!1)}),i.a.createElement(u.a,{tagName:"div",style:{fontWeight:"500"},textKey:"STR_MY_GROUP",className:"mg-button"+(!0===this.state.filterMyGroups?" selected":""),onClick:e=>this.onFilterMyGroups(e,!0)}),i.a.createElement("div",null),this.props.isProfilePopup?null:i.a.createElement("div",{className:"mg-choose",style:{position:"absolute",top:this.props.isMediaDock?"12px":"24px",right:"10px"}},i.a.createElement(N.a,{textKey:this.state.enableMultiSelect?"STR_CANCEL_SELECT":"STR_MULTI_SELECT",type:"tertiary",size:"small",modifier:"text",format:"full-rounded",onClick:this.state.enableMultiSelect?this.onDisableMultiSelect.bind(this):this.onEnableMultiSelect.bind(this)}))):null,this.state.searchText&&this.hasSearchMutual&&T.c.search_mutual_group_member>0||this.props.mutualGroup.length>10&&T.c.search_mutual_group_member>0?i.a.createElement("div",{className:"searchMutualGroup",style:{padding:"12px 16px 0px"}},i.a.createElement(C.a,{textKey:"STR_SEARCH_GROUP",inputRef:e=>this._searchInput=e,onChange:this._onSearchNameChange.bind(this),size:"small",appearance:"rounded"})):"",this.state.enableMultiSelect?r:null,t,0==e?i.a.createElement("i",{className:"fa fa-emptylist searchMutualGroup__null-icon",style:{height:"100%"}}):"",!0===n?null:this.state.inlineKickOutContent||i.a.createElement("div",{className:"mutual-group__btn"},!0===s&&this.state.selectedItems?i.a.createElement(N.a,{type:"secondary-red",onClick:a,icon:"icon-outline-remove-account",format:"rounded",size:"medium",textKey:"STR_REMOVE_FROM_GROUPS",className:"wi","data-id":"btn_MutualGrp_AddToGrp"}):i.a.createElement(N.a,{type:"tertiary",onClick:a,icon:"add-member-group",format:"rounded",size:"medium",textKey:"STR_ADD_TO_GROUP",className:"wi"})))}}t.a=k},"0bqf":function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return r})),s.d(t,"e",(function(){return _})),s.d(t,"f",(function(){return m})),s.d(t,"c",(function(){return p})),s.d(t,"d",(function(){return g}));var a=s("Yi2m"),n=s("z0WU"),i=s("1pet");const o=Object.freeze({CHAT:1,MEDIA_PREVIEW:2,MEDIA_FULL:3,MEDIA_FILTER:4,STAR_LIST:5,FOLDER_VIEW:6,INPUTBOX_PREVIEW:7});class r{constructor(e,t,s={},a={}){this.trackType=e,this.subType=t,this.SRC=s,this.ACT=a}log(e,{key:t,src:s,targetId:n,details:i}){e&&!isNaN(e)&&setTimeout((()=>{a.e.logActionDetails({ts:Date.now(),action:e,type:this.trackType,subType:this.subType,src:s,key:t,targetId:n,details:i})}),0)}static logFile(e,t,s){n.default.isFolder(((e||{}).message||{}).params)?g.log(t,s):p.log(t,s)}static showMessageInFolder(e,{targetId:t,src:s}){let a=e||{},n={src:s,targetId:t,key:a.msgId};switch(a.msgType){case i.MSG_PHOTO:case i.MSG_PHOTO_2:_.log(_.ACT.VIEW_IN_FOLDER,n);break;case i.MSG_FILE:this.logFile(a,g.ACT.VIEW_IN_FOLDER,n)}}static downloadMessage(e,{targetId:t,src:s}){let a=e||{},n={src:s,targetId:t,key:a.msgId};switch(a.msgType){case i.MSG_PHOTO:case i.MSG_PHOTO_2:_.log(_.ACT.DOWNLOAD,n);break;case i.MSG_FILE:this.logFile(a,g.ACT.DOWNLOAD,n)}}static forwardMessage(e,{targetId:t,src:s}){let a=e||{},n={src:s,targetId:t,key:a.msgId};switch(a.msgType){case i.MSG_PHOTO:case i.MSG_PHOTO_2:_.log(_.ACT.FORWARD,n);break;case i.MSG_FILE:this.logFile(a,g.ACT.FORWARD,n)}}}const l=Object.assign({},o),c={VIEW:1,FORWARD:2,DOWNLOAD:3,VIEW_IN_FOLDER:4,COPY_PHOTO:5,FORWARD_GROUP_PHOTO:6,FORWARD_MULTI_PHOTO:7,JUMP_TO_MESSAGE:8,DELETE:9,FORWARD_PART_GROUP_PHOTO:12},d=Object.assign({},o),h={VIEW:1,VIEW_FOLDER:2,FORWARD:3,DOWNLOAD:4,VIEW_IN_FOLDER:5,FORWARD_MULTI_FILE:6},u=Object.assign({DIRECTION:12,ROTATE:13,CLOSE:14},c),_=new r(3,1,l,c),m=new r(3,2,l,u),p=new r(4,1,d,h),g=new r(4,2,d,h)},"0cAX":function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var a=s("z0WU"),n=s("qYNW");const i=a.default.isWeb();let o;i||(o=s("vbkW"));const r=2,l={TO_BACKGROUND_PROCESS:"TO_BACKGROUND_PROCESS",TO_MAIN_PROCESS:"TO_MAIN_PROCESS"},c=1e7,d="send-ipc-chunk",h=new a.LocalId;let u=new class{constructor(){this.maxSendPerSec=3e3,this.queue=[],this.priorityObj={},this._isRunning=!1,i||(this.ipcRenderer=o.ipcRenderer)}_log(e){n.Huynh.debug("ipc-communicator:",e)}_error(e){n.Core.error("ipc-communicator:",e)}_enqueueEvent(e,t,s){const a=`${e}_${Date.now()}`;if(null!=t){let n=t;t.constructor!==String&&(n=JSON.stringify(t));const i=n.length;this.priorityObj[s]||(this.priorityObj[s]=0);const o=Math.ceil(i/c);if(o>1)for(let t=0;t<o;t++){const i=this.priorityObj[s]++,r=n.slice(t*c,(t+1)*c),l={channel:d,payload:{eventId:a,channel:e,totalChunks:o,content:r,order:i},priority:s,sortValue:i};this.queue.push(l)}else{const t=this.priorityObj[s]++,i={channel:d,payload:{eventId:a,channel:e,totalChunks:o,content:n,order:t},priority:s,sortValue:t};this.queue.push(i)}}else{const t=this.priorityObj[s]++,n={channel:d,payload:{eventId:a,channel:e,totalChunks:1,content:JSON.stringify(null),order:t},priority:s,sortValue:t};this.queue.push(n)}}send(e,t,s=!0,a=r){if(i)return;let n;if(s){const s=`${e}_${h.next()}`;n=new Promise(((e,t)=>{this.ipcRenderer.once(s,((s,a)=>a?a._error?t(a.result):e(a.result):t(null)))})),t._callbackChannel=s}return this._enqueueEvent(e,t,a),this.queue.sort(((e,t)=>t.priority>e.priority?1:t.priority===e.priority?e.sortValue-t.sortValue:-1)),this.wakeQueue(),n}wakeQueue(){this._isRunning?this._log("is running"):this.queue.length<=0?this._log("queue empty"):(this._isRunning=!0,this.sendInterval=setInterval((()=>{if(this.queue.length<=0)return this._log("queue empty"),this.sendInterval&&clearInterval(this.sendInterval),void(this._isRunning=!1);const e=this.queue.shift();e&&this.ipcRenderer.send(e.channel,e.payload)}),1e3/3e3))}};t.b=u},"0iyf":function(e,t,s){"use strict";(function(e,a){s.d(t,"a",(function(){return p}));var n=s("VTBJ"),i=s("aSg2"),o=s("z0WU"),r=(s("NFKh"),s("NDmK")),l=s("LV1a"),c=s("aaBP"),d=s.n(c),h=s("zCSk"),u=s("BTf5"),_=s("5qIm"),m=s("wFH2");const p="Z_GET_CHECKSUM_LATER_";let g,E;o.default.isWeb()||(g=s("Iwwi"),E=s("3Dr5"));let f=6e4;class I{constructor(e=!1){this._useSpark=!0,this._useSpark?this._zhash=new d.a.ArrayBuffer:this._zhash=E.createHash("md5")}append(e){this._useSpark?this._zhash.append(e):this._zhash.update(e,"utf8")}end(){return this._useSpark?this._zhash.end():this._zhash.digest("hex")}}const T="Chrome"!==Object(h.a)().browser||parseInt(Object(h.a)().browserVersion)<81;class v{static getMd5LargeFile(e){return new Promise(((t,s)=>e?e.constructor===File?t(this.getMd5LargeFileObject(e)):e.constructor===Object&&e.path?t(this.readAndGetMd5FileObject(e.path)):s("not support"):s("not valid file")))}static readAndGetMd5FileObject(e){return new Promise(((e,t)=>t("not support readAndGetMd5FileObject for web")))}static getMd5LargeFileObject(e){return new Promise(((t,s)=>{let a=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice;const n=2097152,i=Math.ceil(e.size/n);let o=0;const r=new I(!0),l=new FileReader;let c,d=!0,h=Date.now();const u=()=>!!d&&(c&&(clearInterval(c),c=void 0),d=!1,!0);c=setInterval((()=>{Date.now()-h>=f&&u()&&(s("Timeout_get_MD5"),l&&l.abort())}),f),l.onload=e=>{if(d)if(h=Date.now(),r.append(e.target.result),o++,o<i)_();else if(u()){let e=r.end();t(e)}},l.onabort=e=>{u()&&s(e)},l.onerror=e=>{u()&&s(e)};const _=()=>{if(!d)return;let t=o*n,s=t+n>=e.size?e.size:t+n;l.readAsArrayBuffer(a.call(e,t,s))};_()}))}static readChunksArray(e,t,s){return new Promise(((a,n)=>{if(!e)return n("invalid file");a(this._readChunksArrayWeb(e,t,s))}))}static _readChunksArrayWeb(e,t,s){return new Promise(((a,i)=>{let o=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,r=Math.ceil(e.size/t),l=t,c=new FileReader,d=[];const h={startChunkId:1,endChunkId:r};s||(s={});let{startChunkId:u,endChunkId:_,checksum:m,refHash:p}=Object(n.a)(Object(n.a)({},h),s),g=u-1;c.onload=e=>{d.push(e.target.result),g++,p&&p.hash&&p.hash.append&&e.target.result&&Number.isInteger(e.target.result.byteLength)&&(p.hash.append(e.target.result),p.size+=e.target.result.byteLength),g<_?E():a({chunks:d,noChunk:r})},c.onerror=i;const E=()=>{let t=g*l,s=t+l>=e.size?e.size:t+l;c.readAsArrayBuffer(o.call(e,t,s))};E()}))}static _readChunksArray(t,s,a){return new Promise(((i,o)=>{let r=Math.ceil(t.size/s),l=s,c=[];const d={startChunkId:1,endChunkId:r};a||(a={});let h,{startChunkId:u,endChunkId:_,checksum:m,refHash:p}=Object(n.a)(Object(n.a)({},d),a),E=(u-1)*l,I=Math.min(t.size,_*l),T=[],v=g.createReadStream(t.path,{start:E,end:I-1}),R=Date.now();h=setInterval((()=>{Date.now()-R>=f&&(clearInterval(h),o("TimeoutReadChunk"),v&&v.destroy())}),f);let S=0;v.on("data",(e=>{R=Date.now(),T.push(e),S+=e.length,p&&p.hash&&p.hash.append&&(p.hash.append(e),p.size+=e.length)})),v.on("end",(t=>{let s=e.concat(T,S);s=s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);for(let e=u;e<=_;e++){let t=(e-u)*l,a=new DataView(s,t,e===_?S-t:l);c.push(a)}h&&(clearTimeout(h),h=void 0),i({chunks:c,noChunk:r})})),v.on("error",o)}))}static blobToChunk(e,t,s,a){let n=Math.ceil(e.size/t),r=t,l=new FileReader,c=[];l.onload=t=>{i.a.md5(t.target.result).then((t=>{let i=t.hash,l=t.buffer;if(!l||!i||i.constructor!==String)return o.default.logCoreError("md5 invalid resp"),a("invalid data");let d=0;for(let s=1;s<=n;s++){let t=s===n?e.size-d:r,a=new DataView(l,d,t);c.push(a),d+=t}s(i,c,r,l,n)})).catch((e=>{o.default.logCoreError(e),a&&a(e)}))},l.onerror=e=>{o.default.logCoreError(e),e&&e.target&&e.target.error&&o.default.logCoreError(e.target.error),a&&a(e)},l.readAsArrayBuffer(e)}static base64ToBlob(e,t="image/jpeg"){let s=atob(e.split(",")[1]),a=new ArrayBuffer(s.length),n=new Uint8Array(a);for(let i=0;i<s.length;i++)n[i]=s.charCodeAt(i);return new Blob([n],{type:t})}static blobToFileObject(e,t,s){return new File([e],t,s)}static blobToFile(e,t){return e.lastModifiedDate=new Date,e.name=t,e}static getMD5FromString(t){if(!t)return"";const s=new I;let a=e.from(t);return s.append(a),s.end()}static imgUrlToUploadable(e){return new Promise(((t,s)=>{let a=e.lastIndexOf("/"),n=a>=0?e.substr(a+1):e;const i=(s,a,i,o=null)=>{let r=this.blobToFile(s,n);t({width:a,isGif:false,height:i,resized:!1,originalSize:s.size,originalType:"image/jpeg",thumbGif:null,file:r,img:e})};{if(!o.default.validOpenUrl(e))return s();let t=new Image;t.crossOrigin="Anonymous",t.onload=()=>{let e=document.createElement("canvas");e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height),e.toBlob((e=>{i(e,t.width,t.height)}))},t.onerror=e=>{o.default.logCoreError(e),s(e)},t.src=o.default.removeProtocol(e)}}))}static dimensionsPhoto_v2(e,t=null,s=!1,a={}){return new Promise(((n,i)=>{let c=e.name,d=o.default.getExtension(e.name),h="gif"==d,u=r.c.settings&&r.c.settings.sharefile&&r.c.settings.sharefile.max_size_photo?r.c.settings.sharefile.max_size_photo:10,_=new FileReader,m=1024*u*1024,p=r.c.file_photo_limit.width,g=r.c.file_photo_limit.height,E=h||"png"==d?"image/png":"image/jpeg";_.onload=async r=>{try{let i=l.b.checkExifData(r.target.result);const d=v.normalizeQuality(null==a?void 0:a.quality,E),u=h;o.default.log("blob-helper: original size "+e.size+" type= "+E),null==t||t("start");let{output:_,width:f,height:I,resized:R}=await v.reducePhotoSizeForUpload({src:e,maxSize:m,maxWidth:p,maxHeight:g,outputType:E,quality:d,alwaysResize:u,reduceStep:.9,noTransparent:s});o.default.log("blob-helper: reduce file size to "+_.size+" w = "+f+" h = "+I),null==t||t("done"),_.fileName=c,n({width:f,height:I,resized:R,originalSize:e.size,originalType:E,file:_,orientation:T?i:void 0,img:URL.createObjectURL(e)})}catch(d){i(d)}},_.readAsArrayBuffer(e)}))}static async reducePhotoSizeForUpload({src:e,alwaysResize:t=!1,noTransparent:s=!1,outputType:a="image/jpeg",quality:n=.9,reduceStep:i=.9,maxWidth:o=r.c.file_photo_limit.width,maxHeight:l=r.c.file_photo_limit.height,maxSize:c=10485760}){let d,h,p,g=!1,E=await Object(u.a)(e),[f,I]=[E.width,E.height],T=()=>{d=e.size>c,h=f>o||I>l,p=t||d||h};T();let v=()=>({output:e,width:f,height:I,resized:g});if(!p)return v();if(h){g=!0;let t=await Object(m.a)({src:e,maxWidth:o,maxHeight:l,outputType:a,quality:n,noTransparent:s});e=t.output,[f,I]=[t.width,t.height]}if(T(),d){g=!0;let t=await Object(_.a)({src:e,maxSize:c,outputType:a,quality:n,reduceStep:i,noTransparent:s});e=t.output,[f,I]=[t.width,t.height]}if(!g&&t){g=!0;let t=await Object(m.a)({src:e,maxWidth:f,maxHeight:I,outputType:a,quality:n,noTransparent:s});e=t.output,[f,I]=[t.width,t.height]}return v()}static normalizeQuality(e,t){return null==e?1:e>=0&&e<=1?e:"default"===e?"image/jpeg"===t?.92:"image/webp"===t?.8:1:1}}t.b=v,a&&a.env}).call(this,s("Q40w").Buffer,s("ckNr"))},"0qCE":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("q1tI"),i=s.n(n),o=s("UiPd"),r=s("lCMA"),l=s("Q8hM"),c=s("BZLJ"),d=s("97kL"),h=s("XS0u"),u=s("1pet"),_=s("c51z"),m=s("qYNW"),p=s("6uTC"),g=s("z0WU"),E=s("lCn6"),f=s("AM4K"),I=s("h0sc"),T=s("Ja3U");class v{static getStatusView(e,t,s,a,n,o,d,h,u,_,m,p=null,g=null,E=null){let f=null,I=!(!p||!p.noTooltip);if(!0===e||!0===t&&!0!==s)if(a>0){let e=i.a.createElement("i",{className:"fa todo-icon-head fa-"+(a<d?"icn_todo_mobile_status_working_multi":"icn_todo_mobile_status_completed"),style:{top:"3px",color:"var(--green-300)"}});p&&!0===p.noIcon&&(e=null),f=i.a.createElement("div",{className:"todo-take-job-button job-txt done "+(p?p.textClassName:"")+(m?"":" no-action"),onClick:m,style:p?p.textStyle:null,onMouseEnter:g,onMouseLeave:E},e,i.a.createElement(r.a,{textKey:"STR_TODO_COMPLETED"})," ",d>1?i.a.createElement("span",null,"(",a,"/",d,")"):null)}else if(n>0){let t=i.a.createElement("i",{className:"fa todo-icon-head fa-icn_todo_mobile_status_accepted",style:{top:"3px",color:"var(--purple-300)"}});p&&!0===p.noIcon&&(t=null),f=i.a.createElement(l.a,{textKey:!0===s&&!0===e||!0===I?"":"STR_TODO_TOOLTIP_2",tagName:"div",textArguments:[_],className:"todo-take-job-button job-txt in-process "+(p?p.textClassName:"")+(m?"":" no-action"),onClick:m,style:p?p.textStyle:null,onMouseEnter:g,onMouseLeave:E},t,i.a.createElement(r.a,{textKey:"STR_TODO_RECEIVED_2"})," ",d>1?i.a.createElement("span",null,"(",n,"/",d,")"):null)}else{let t=i.a.createElement("i",{className:"fa todo-icon-head fa-icn_todo_mobile_status_open",style:{top:"3px",color:"var(--blue-500)"}});p&&!0===p.noIcon&&(t=null),f=i.a.createElement(l.a,{textKey:!0===s&&!0===e||!0===I?"":!0===s?"STR_TODO_TOOLTIP_3":"STR_TODO_TOOLTIP_1",tagName:"div",textArguments:1==s?[u]:[_],tagName:"div",className:"todo-take-job-button job-txt waiting "+(p?p.textClassName:"")+(m?"":" no-action"),onClick:m,style:p?p.textStyle:null,onMouseEnter:g,onMouseLeave:E},t,i.a.createElement(r.a,{textKey:"STR_OPENING"}))}else if(h===c.g.WAITING_FOR_RESPONSE){let t=i.a.createElement("i",{className:"fa todo-icon-head fa-icn_todo_mobile_status_open",style:{top:"3px",color:"var(--blue-500)"}});p&&!0===p.noIcon&&(t=null),f=i.a.createElement(l.a,{textKey:!0===s&&!0===e||!0===I?"":!0===s?"STR_TODO_TOOLTIP_3":"STR_TODO_TOOLTIP_1",tagName:"div",textArguments:1==s?[u]:[_],tagName:"div",className:"todo-take-job-button job-txt waiting "+(p?p.textClassName:"")+(m?"":" no-action"),onClick:m,style:p?p.textStyle:null,onMouseEnter:g,onMouseLeave:E},t,i.a.createElement(r.a,{textKey:"STR_OPENING"}))}else if(h===c.g.IN_PROCESS){let t=i.a.createElement("i",{className:"fa todo-icon-head fa-icn_todo_mobile_status_accepted",style:{top:"3px",color:"var(--purple-300)"}});p&&!0===p.noIcon&&(t=null),f=i.a.createElement(l.a,{textKey:!0===s&&!0===e||!0===I?"":"STR_TODO_TOOLTIP_2",tagName:"div",textArguments:[_],className:"todo-take-job-button job-txt in-process "+(p?p.textClassName:"")+(m?"":" no-action"),onClick:m,style:p?p.textStyle:null,onMouseEnter:g,onMouseLeave:E},t,i.a.createElement(r.a,{textKey:"STR_TODO_RECEIVED_2"}))}else if(h===c.g.DONE){let e=i.a.createElement("i",{className:"fa todo-icon-head fa-"+(a<d?"icn_todo_mobile_status_working_multi":"icn_todo_mobile_status_completed"),style:{top:"3px",color:"var(--green-300)"}});p&&!0===p.noIcon&&(e=null),f=i.a.createElement("div",{className:"todo-take-job-button job-txt done "+(p?p.textClassName:"")+(m?"":" no-action"),onClick:m,style:p?p.textStyle:null,onMouseEnter:g,onMouseLeave:E},e,i.a.createElement(r.a,{textKey:"STR_TODO_COMPLETED"}))}return f}static getStatusUI(e,t){if(!e)return null;let s=e.creator,a=e.assignees,n=e.watchers,o=c.i.getMyStatus(e,t),l="";switch(o){case c.g.IN_PROCESS:l="td-received";break;case c.g.DONE:l="td-completed"}let d=!(!n||-1===n.indexOf(t));if(t===s||!0===d){let e=0,t=0,s=0,n=a.length;for(let i=0;i<n;i++){let n=a[i];if(n&&n.constructor===Object){switch(n.status){case c.g.WAITING_FOR_RESPONSE:e++;break;case c.g.IN_PROCESS:t++;break;case c.g.DONE:s++}}}let d=null;return o===c.g.DONE?d=i.a.createElement("div",{className:"rel",style:{top:"-1px"}},i.a.createElement(r.a,{textKey:"STR_TODO_COMPLETED"})," ",n>1?i.a.createElement("span",null,"(",s,"/",n,")"):null):o===c.g.IN_PROCESS&&t>0?d=i.a.createElement("div",{className:"rel",style:{top:"-1px"}},i.a.createElement(r.a,{textKey:"STR_TODO_RECEIVED_2"})," ",n>1?i.a.createElement("span",null,"(",t,"/",n,")"):null):(d=i.a.createElement(r.a,{textKey:"STR_OPENING",tagName:"div",className:"rel",style:{top:"-1px"}}),l=""),i.a.createElement("div",{className:"pr-status-content "+l},i.a.createElement("div",{className:"ddot "+l}),d)}{let e="";switch(o){case c.g.WAITING_FOR_RESPONSE:e="STR_OPENING";break;case c.g.IN_PROCESS:e="STR_TODO_RECEIVED_2";break;case c.g.DONE:e="STR_TODO_COMPLETED"}return i.a.createElement("div",{className:"pr-status-content "+l},i.a.createElement("div",{className:"ddot "+l}),i.a.createElement(r.a,{textKey:e,tagName:"div"}))}}static getPreviewAssignee(e){if(!e)return null;let t=e.assignees;return f.a.getPreviewMembers(t)}static getPreviewCC(e){if(!e)return null;let t=e.watchers;return f.a.getPreviewMembers(t)}static getSimpleStatusView(e,t,s,a=null,n=null,i=null){if(!e)return null;let o=e.status,r=e.creator,l=e.assignees,d=r===t,h=c.i.classifyTodoItem(e,t),u=!1,_=!(!h||!h.isWatcher),m=0,p=0,g=0;if(l)for(let E=0;E<l.length;E++){let e=l[E];if(e){let s=c.i.getUserId(e);switch(e.status){case c.g.WAITING_FOR_RESPONSE:g++;break;case c.g.IN_PROCESS:p++;break;case c.g.DONE:m++}s===t&&(u=!0,o=e.status)}}return this.getStatusView(d,_,u,m,p,g,l.length,o,null,null,s,a,n,i)}static remindTask(e,t,s,n=!1){return new Promise(((i,o)=>{let r=e;r?c.i.todoDing([r.id]).then((e=>{p.a["createInfo"+(!0===n?"Modal":"")](_.default.str("STR_TIP_YOU_REMINDED"));let o=Object(a.a)(Object(a.a)({sender:t,task_id:r.id},r),{},{dingTimes:r.dingTimes?r.dingTimes+1:1});s&&s({type:d.TodoActions.REMIND_TODO_INTERNAL,payload:o}),i(o),setTimeout((()=>{let e=r.extra;if(e){let a=e.toUid;!0===e.isGroup&&(a=u.GROUPID_PREFIX+a),a!==t&&E.a.gotoConversation(a,s)}}),0)})).catch((e=>{m.Core.error("[todo] ding failed: "+JSON.stringify(e)),o(e)})):o()}))}static changeTaskStatus(e,t,s,a,n,i=!1){return new Promise(((n,r)=>{if(!s)return void r();let l=s.assignees;if(!l)return void r();let d=!1;for(let e=0;e<l.length;e++){let t=l[e];if(t){if((t.id||t.uid||t.userId)===a){d=!0;break}}}const g=()=>{let a="";i&&(a="Modal"),c.i.updateTodoStatus(s.id,t).then((i=>{s.status=t,e===c.g.WAITING_FOR_RESPONSE&&t===c.g.IN_PROCESS?p.a[`createInfo${a}`](_.default.str("STR_YOU_RECEIVED_TASK")):e===c.g.IN_PROCESS&&t===c.g.DONE?p.a[`createInfo${a}`](_.default.str("STR_TODO_TOAST_DONE_TASK")):e===c.g.DONE&&t===c.g.IN_PROCESS&&p.a[`createInfo${a}`](_.default.str("STR_YOU_REOPEN_TASK")),n(i)})).catch((e=>{m.Core.error("[todo] updateTodoStatus failed#2 : "+JSON.stringify(e)),p.a[`createError${a}`](_.default.str("STR_UPDATE_TODO_FAILED")),r(e)}))};if(e===c.g.WAITING_FOR_RESPONSE&&t===c.g.IN_PROCESS)return void g();let E=0;if(E=t===c.g.DONE?l.length>1?h.default.isAutoMarkAsDoneTodoMulti():h.default.isAutoMarkAsDoneTodo():h.default.isAutoReopenTodo(),1===E)g();else{let e=s.creator,n=o.default.getDName(e)||"",i="",m="",p={};t!==c.g.DONE?e===a?(i="STR_TODO_CONFIRM_REOPEN_TASK_2",m="STR_TITLE_REASSIGN_TODO",p={title:"btn_ReopenTsk_Title",confirmBtn:"btn_ReopenTsk_Confirm",cancelBtn:"btn_ReopenTsk_CXL"}):i="STR_TODO_CONFIRM_REOPEN_TASK":a===e?(m="STR_TITLE_CLOSE_TODO",p={title:"btn_DoneTsk_Title",confirmBtn:"btn_DoneTsk_Confirm",cancelBtn:"btn_DoneTsk_CXL"},i=d&&l.length<=1?"STR_CLOSE_TASK_WARNING_REPORT_ONLY":"STR_CLOSE_TASK_WARNING_ASSIGNEE"):(i="STR_TODO_CONFIRM_COMPLETE_TASK",m="STR_TITLE_DONE_TODO"),T.a.openConfirm({windowId:"1",name:u.MODAL_CONFIRM.confirmIdentities,params:{title:_.default.str(m),message:_.default.trans(i,n),okText:_.default.str("STR_YES"),cancelText:_.default.str("STR_NO"),onOk:e=>{e&&e.remember&&(t===c.g.DONE?l.length>1?h.default.rememberAutoMarkAsDoneTodoMulti(1):h.default.rememberAutoMarkAsDoneTodo(1):h.default.rememberAutoReopenTodo(1)),g()},onCancel:()=>{r({err_msg:"reject_action"})},options:[{title:"STR_TODO_CONFIRM_DONT_ASK_AGAIN",key:"remember",default_val:0}]}})}}))}static todoDingACK(e,t,s=-1){return new Promise(((t,n)=>{let i=e;if(i){const o=()=>{i=Object(a.a)(Object(a.a)({},i),{},{dingTimes:0}),c.i.clearDingTodo(i.id),I.a.openModal({windowId:"1",name:u.ModalIdentitiesDefine.TODO_PREVIEW,params:Object(a.a)(Object(a.a)({},i),{},{focusComment:!0})}),t(i)};i.dingTimes>0&&e.creator!==s?c.i.todoDingACK([i.id]).then((e=>{o()})).catch((e=>{m.Core.error("[todo] dingack failed: "+JSON.stringify(e)),n(e)})):o()}else n()}))}static getAssigneeHTML(e,t,s,a){let{onViewProfile:n,onViewStatus:l}=s||{};if(!e)return{msg:"",html:null};let d=e.creator||e.creatorId,h=e.assignees||[],u=d===t,m=e.editor===t,p="",E="",f=null,I=null;if(h.length>0){if(!0===a)p=_.default.str(1==m?"STR_YOURSELF_2":"STR_YOU_LOWERCASE"),f=i.a.createElement(r.a,{textKey:!0===u?"STR_YOURSELF_2":"STR_YOU",style:{textTransform:"lowercase"}});else{let e=c.i.getUserId(h[0]),t=o.default.getDName(e)||h[0].dpn||"";p=t,f=i.a.createElement("span",{className:"td-msg-profile-style",onClick:t=>n(t,e)},g.default.getStringByLength(t))}return h.length>1&&(E=_.default.str("STR_AND")+_.default.trans(h.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",h.length-1),I=i.a.createElement("span",null,i.a.createElement(r.a,{textKey:"STR_AND"}),i.a.createElement(r.a,{textKey:h.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",textArguments:[h.length-1],onClick:e=>l(e),className:"td-msg-profile-style"}))),p+=E,f=i.a.createElement("span",null,f,I),{msg:p,html:f}}return{msg:"",html:null}}static generateMsg(e,t,s=null){if(!e)return null;let a=e.extra;if(!a)return null;if(a.constructor===String)try{a=JSON.parse(a)}catch(x){}if(!a)return null;let n=e.act,l=e.creator||e.creatorId,d=e.assignees,h=e.watchers,u=e.editor,m=!1,p=!1,g=l===t,E=u===t,f=e.updateData,I=0,T=0,v=0,R=e.status,{onViewProfile:S,onViewStatus:O}=s||{},N=o.default.getDName(l)||"",b=o.default.getDName(u)||"";if(!0===g&&(N=_.default.str("STR_YOU")),!0===E&&(b=_.default.str("STR_YOU")),d&&d.constructor===String)try{d=JSON.parse(d)}catch(x){}d||(d=[]);for(let i=0;i<d.length;i++){let e=d[i];if(e){let s=c.i.getUserId(e),a=e.status;switch(s===t&&(m=!0,void 0!==a&&(R=a)),a){case c.g.WAITING_FOR_RESPONSE:v++;break;case c.g.IN_PROCESS:T++;break;case c.g.DONE:I++}}}let C=this.getAssigneeHTML(e,t,s,m),A=C.msg,y=C.html;if(h&&h.constructor===String)try{h=JSON.parse(h)}catch(x){}h||(h=[]);for(let i=0;i<h.length;i++){let e=h[i];if(e){if(c.i.getUserId(e)===t){p=!0;break}}}let D=null;let M,P=null,w=null,L=!1,k=!1;switch(n){case"create":case"todo.create":if(!0===g){if(R===c.g.WAITING_FOR_RESPONSE){M=_.default.trans("STR_YOUR_WAITING_FOR_TASK_RESPONSE",A),D=i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOUR_WAITING_FOR_TASK_RESPONSE_2"})," ",y);break}M=d&&d.length>0?_.default.str("STR_YOU")+" "+_.default.str("STR_ASSIGN_TASK_TO_A")+" "+A:_.default.str("STR_YOU_CREATE_TODO"),D=i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_ASSIGN_TASK_TO_X"})," ",y);break}if(!0===p&&!0!==m){M=_.default.trans("STR_A_ADD_YOU_AS_WATCHER",[N]),D=i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_X_ADD_YOU_AS_WATCHER"}));break}if(R===c.g.WAITING_FOR_RESPONSE){M=_.default.trans("STR_A_WAITING_FOR_TASK_RESPONSE",[N,_.default.str("STR_YOU_LOWERCASE")]),D=i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_X_WAITING_FOR_TASK_RESPONSE"})," ",i.a.createElement(r.a,{textKey:"STR_YOU_LOWERCASE"}));break}M=N.length>0?_.default.trans("STR_A_CREATE_YOUR_TASK",N):_.default.str("STR_ASSIGN_TASK"),D=i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_X_CREATE_YOUR_TASK"}));break;case"update":case"todo.update":if(f){if(f["assignees.add"]&&f["assignees.remove"]&&(f["assignees.add"].length>0||f["assignees.remove"].length>0)||f.addAssignees&&f.addAssignees.length>0||f.removeAssignees&&f.removeAssignees.length>0){let e=((e,s)=>{let a=null,n=null,c=null,d=null,h=!1,m=!1;if(e){let s=[];for(let a=0;a<e.length;a++)if(e[a]===t){h=!0;break}if(e.length>0){if(!0===h)a=_.default.str(!0===g?"STR_YOURSELF_2":"STR_YOU_LOWERCASE"),s.push(i.a.createElement(r.a,{textKey:!0===g?"STR_YOURSELF_2":"STR_YOU_LOWERCASE",key:"e-you"}));else{let t=o.default.getDName(e[0]);t&&(a=t,s.push(i.a.createElement("span",{className:"td-msg-profile-style",onClick:t=>S(t,e[0]),key:"a_0",key:"e-name"},t)))}e.length>1&&(a+=_.default.str("STR_AND")+_.default.trans(e.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",e.length-1),s.push(i.a.createElement("span",{key:"e-other"},i.a.createElement(r.a,{textKey:"STR_AND"}),i.a.createElement(r.a,{textKey:e.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",textArguments:[e.length-1],onClick:e=>O(e),className:"td-msg-profile-style"})))),n=s}else a=null,n=null}else a=null,n=null;if(s){let e=[];for(let a=0;a<s.length;a++)if(s[a]===t){h=!0,m=!0;break}if(s.length>0){if(!0===h)c=_.default.str(!0===g?"STR_YOURSELF_2":"STR_YOU_LOWERCASE"),e.push(i.a.createElement(r.a,{textKey:!0===g?"STR_YOURSELF_2":"STR_YOU_LOWERCASE",key:"e-you"}));else{let t=o.default.getDName(s[0]);t&&(c=t,e.push(i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,s[0]),key:"a_0",key:"e-name"},t)))}s.length>1&&(c+=_.default.str("STR_AND")+_.default.trans(s.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",s.length-1),e.push(i.a.createElement("span",{key:"e-other"},i.a.createElement(r.a,{textKey:"STR_AND"}),i.a.createElement(r.a,{textKey:s.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",textArguments:[s.length-1],onClick:e=>O(e),className:"td-msg-profile-style"})))),d=e}else c=null,d=null}else c=null,d=null;return!0===E?s&&s.constructor===Array&&-1!==s.indexOf(t)&&!0!==g?{msg:_.default.str("STR_YOU_REJECTED_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REJECTED_TASK"}))}:e&&e.constructor===Array&&e.length>0?e.indexOf(t)>-1&&1===e.length?{msg:_.default.str("STR_YOU_ASSIGN_TASK_TO_X")+" "+a,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_ASSIGN_TASK_TO_X"})," ",n)}:{msg:_.default.str("STR_YOU_ADD_ASSIGNEES_TASK")+": "+a,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_ADD_ASSIGNEES_TASK"}),": ",n)}:s&&s.constructor===Array&&s.length>0?s.indexOf(t)>-1?{msg:_.default.str("STR_YOU_REMOVE")+" "+c+" "+_.default.str("STR_FROM_TASK_LIST"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REMOVE"})," ",d," ",i.a.createElement(r.a,{textKey:"STR_FROM_TASK_LIST"}))}:{msg:_.default.str("STR_YOU_REMOVE_ASSIGNEES_TASK")+": "+c,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REMOVE_ASSIGNEES_TASK"}),": ",d)}:{msg:"",html:null}:s&&s.constructor===Array&&-1!==s.indexOf(u)&&u!==l?{msg:b+" "+_.default.str("STR_A_REJECTED_TASK"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_A_REJECTED_TASK"}))}:e&&e.constructor===Array&&!m?e.indexOf(t)>-1?{msg:b+" "+_.default.str("STR_X_WAITING_FOR_TASK_RESPONSE")+" "+_.default.str("STR_YOU_LOWERCASE"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_WAITING_FOR_TASK_RESPONSE"})," ",i.a.createElement(r.a,{textKey:"STR_YOU_LOWERCASE"}))}:{msg:b+" "+_.default.str("STR_X_ADD_ASSIGNEES_TASK")+": "+a,html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_ADD_ASSIGNEES_TASK"}),": ",n)}:s&&s.constructor===Array?s.indexOf(t)>-1?{msg:b+" "+_.default.str("STR_X_CHANGE_OTHER_ASSIGNEES_TASK"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_CHANGE_OTHER_ASSIGNEES_TASK"}))}:{msg:b+" "+_.default.str("STR_X_REMOVE_ASSIGNEES_TASK")+": "+c,html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_REMOVE_ASSIGNEES_TASK"}),": ",d)}:""})(f["assignees.add"]||f.addAssignees,f["assignees.remove"]||f.removeAssignees);M=e.msg,D=e.html}else if(f["watchers.add"]&&f["watchers.remove"]&&(f["watchers.add"].length>0||f["watchers.remove"].length>0)||f.addWatchers&&f.addWatchers.length>0||f.removeWatchers&&f.removeWatchers.length>0){let e=((e,s)=>{let a=null,n=null,c=null,d=null,h=!1,m=!1;if(e){let s=[];for(let a=0;a<e.length;a++)if(e[a]===t){h=!0;break}if(e.length>0){if(!0===h)a=_.default.str("STR_YOU_LOWERCASE"),s.push(i.a.createElement(r.a,{textKey:"STR_YOU_LOWERCASE",key:"e-you"}));else{let t=o.default.getDName(e[0]);t&&(a=t,s.push(i.a.createElement("span",{className:"td-msg-profile-style",onClick:t=>S(t,e[0]),key:"a_0",key:"e-name"},t)))}e.length>1&&(a+=_.default.str("STR_AND")+_.default.trans(e.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",e.length-1),s.push(i.a.createElement("span",{key:"e-other"},i.a.createElement(r.a,{textKey:"STR_AND"}),i.a.createElement(r.a,{textKey:e.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",textArguments:[e.length-1],onClick:e=>O(e),className:"td-msg-profile-style"})))),n=s}else a=null,n=null}else a=null,n=null;if(s){let e=[];for(let a=0;a<s.length;a++)if(s[a]===t){h=!0,m=!0;break}if(s.length>0){if(!0===h)c=_.default.str("STR_YOU_LOWERCASE"),e.push(i.a.createElement(r.a,{textKey:"STR_YOU_LOWERCASE",key:"e-you"}));else{let t=o.default.getDName(s[0]);t&&(c=t,e.push(i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,s[0]),key:"a_0",key:"e-name"},t)))}s.length>1&&(c+=_.default.str("STR_AND")+_.default.trans(s.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",s.length-1),e.push(i.a.createElement("span",{key:"e-other"},i.a.createElement(r.a,{textKey:"STR_AND"}),i.a.createElement(r.a,{textKey:s.length>2?"STR_X_OTHER_PEOPLE":"STR_A_OTHER_PERSON",textArguments:[s.length-1],onClick:O,className:"td-msg-profile-style"})))),d=e}else c=null,d=null}else c=null,d=null;return!0===E?e&&e.constructor===Array&&e.length>0?{msg:_.default.str("STR_YOU_ADD_CC")+": "+a,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_ADD_CC"}),": ",n)}:s&&s.constructor===Array&&s.length>0?-1!==s.indexOf(t)&&!0!==g?{msg:_.default.str("STR_YOU_UNFOLLOW"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_UNFOLLOW"}))}:{msg:_.default.str("STR_YOU_REMOVE_CC")+": "+c,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REMOVE_CC"}),": ",d)}:{msg:"",html:null}:e&&e.constructor===Array&&e.length>0&&!m?e.indexOf(t)>-1?{msg:b+" "+_.default.str("STR_X_ADD_YOU_AS_WATCHER"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_ADD_YOU_AS_WATCHER"}))}:{msg:b+" "+_.default.str("STR_X_ADD_CC")+": "+a,html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_ADD_CC"}),": ",n)}:s&&s.constructor===Array&&s.length>0?-1!==s.indexOf(u)&&u!==l?{msg:b+" "+_.default.str("STR_A_UNFOLLOW"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_A_UNFOLLOW"}))}:s.indexOf(t)>-1?{msg:b+" "+_.default.str("STR_X_REMOVE_YOU_AS_WATCHER"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_REMOVE_YOU_AS_WATCHER"}))}:{msg:b+" "+_.default.str("STR_X_REMOVE_CC")+": "+c,html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_REMOVE_CC"}),": ",c)}:{msg:"",html:null}})(f["watchers.add"]||f.addWatchers,f["watchers.remove"]||f.removeWatchers);M=e.msg,D=e.html}else if(f.dueDate&&f.dueDate.length>0||f.extraInfos&&f.extraInfos.dueDate&&f.extraInfos.dueDate.length>0){w=f.dueDate||f.extraInfos.dueDate;let e=((e="add")=>{switch(e){case"add":return!0===E?{msg:_.default.trans("STR_YOU_ADD_DUE_DATE_TO_TASK_2",A),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU"})," ",i.a.createElement(r.a,{textKey:"STR_X_ADD_DUE_DATE_TO_TASK_TO_Y"})," ",y)}:b?{msg:_.default.trans("STR_A_ADD_DUE_DATE_TO_TASK",[b,A]),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_ADD_DUE_DATE_TO_TASK_TO_Y"})," ",y)}:{msg:_.default.str("STR_ADD_DUE_DATE_TO_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_ADD_DUE_DATE_TO_TASK"}))};case"remove":return!0===E?{msg:_.default.trans("STR_YOU_REMOVE_DUE_DATE_TO_TASK_2",A),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU"})," ",i.a.createElement(r.a,{textKey:"STR_X_REMOVE_DUE_DATE_TO_TASK_2"})," ",y)}:b?{msg:_.default.trans("STR_A_REMOVE_DUE_DATE_TO_TASK",[b,A]),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_REMOVE_DUE_DATE_TO_TASK_2"})," ",y)}:{msg:_.default.str("STR_REMOVE_DUE_DATE_TO_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_REMOVE_DUE_DATE_TO_TASK"}))};case"update":return!0===E?{msg:_.default.trans("STR_YOU_CHANGE_DUE_DATE_TO_TASK",A),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU"})," ",i.a.createElement(r.a,{textKey:"STR_X_CHANGE_DUE_DATE_TO_TASK"})," ",y)}:b?{msg:_.default.trans("STR_A_CHANGE_DUE_DATE_TO_TASK",[b,A]),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_CHANGE_DUE_DATE_TO_TASK"})," ",y)}:{msg:_.default.str("STR_CHANGE_DUE_DATE_TO_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_CHANGE_DUE_DATE_TO_TASK"}))}}return""})(w);M=e.msg,D=e.html}else if(f.hasOwnProperty("status.update")||f.extraInfos&&void 0!==f.extraInfos["status.update"]&&null!==f.extraInfos["status.update"]){let e=(()=>{if(!f||!f.extraInfos||!f.extraInfos["status.update"])return"";let e=parseInt(f.extraInfos["status.update"]),t=parseInt(f.extraInfos.lastStatus);return e==c.g.DONE?!0===E?!0===g?{msg:_.default.trans("STR_YOU_DONE_TASK_2",A),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_DONE_TASK_TO_X_2"})," ",y)}:N&&N.length>0?{msg:_.default.str("STR_YOU_DONE_TASK")+" "+N+" "+_.default.str("STR_ASSIGN"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_DONE_TASK"})," ",i.a.createElement("span",{onClick:e=>S(e,l),className:"td-msg-profile-style"},N)," ",i.a.createElement(r.a,{textKey:"STR_ASSIGN"}))}:{msg:_.default.str("STR_YOU_DONE_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_DONE_TASK"}))}:b?{msg:_.default.trans("STR_A_DONE_TASK",b),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_DONE_TASK"})," ",i.a.createElement(r.a,{textKey:"STR_ASSIGN_TO"})," ",y)}:{msg:_.default.str("STR_DONE_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_DONE_TASK"}))}:e==c.g.IN_PROCESS?t!==c.g.DONE?!0===g?{msg:b+" "+_.default.str("STR_X_RECEIVED_TASK_FROM_YOU"),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_RECEIVED_TASK_FROM_YOU"}))}:!0===E?{msg:_.default.trans("STR_YOU_RECEIVED_TASK_FROM_A",N),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_RECEIVED_TASK_FROM_A_2"})," ",i.a.createElement("span",{onClick:e=>S(e,l),className:"td-msg-profile-style"},N)," ",i.a.createElement(r.a,{textKey:"STR_ASSIGN"}))}:{msg:_.default.trans("STR_A_RECEIVED_TASK_FROM_YOU",[b,N]),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_RECEIVED_TASK_FROM_A"})," ",i.a.createElement("span",{onClick:e=>S(e,l),className:"td-msg-profile-style"},N)," ",i.a.createElement(r.a,{textKey:"STR_ASSIGN"}))}:!0===E?!0===g?{msg:_.default.trans("STR_YOU_REOPEN_TASK_2",A),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REOPEN_TASK_TO_X_2"})," ",y)}:{msg:_.default.trans("STR_YOU_REOPEN_TASK_3",N),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REOPEN_TASK"})," ",i.a.createElement("span",{onClick:e=>S(e,l),className:"td-msg-profile-style"},N)," ",i.a.createElement(r.a,{textKey:"STR_ASSIGN"}))}:b?{msg:_.default.trans("STR_A_REOPEN_TASK",b),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:"STR_X_REOPEN_TASK"}))}:{msg:_.default.str("STR_REOPENED_TASK"),html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_REOPENED_TASK"}))}:""})();M=e.msg,D=e.html,L=!0}else if(f.extraInfos&&f.extraInfos.schedule){let e=(e=>{if(!e)return{msg:"",html:null};let t="";switch(e){case"add":t="STR_TODO_ADD_REMINDER";break;case"update":t="STR_TODO_UPDATE_REMINDER";break;case"remove":t="STR_TODO_REMOVE_REMINDER"}return t?{msg:b+" "+_.default.str(t)+" "+A,html:i.a.createElement("span",null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:t})," ",y)}:{msg:"",html:null}})(f.extraInfos.schedule);M=e.msg,D=e.html}else if(f.description&&f.description.length>0||f.extraInfos&&f.extraInfos.description&&f.extraInfos.description.length>0){let e=(e=>{switch(e){case"add":return!0===E?{msg:_.default.str("STR_YOU_ADD_DESCRIPTION")+" "+A,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_ADD_DESCRIPTION"})," ",y)}:{msg:_.default.trans(!0===m?"STR_A_ADD_DESCRIPTION":"STR_A_ADD_DESCRIPTION_CC",b),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:!0===m?"STR_X_ADD_DESCRIPTION":"STR_X_ADD_DESCRIPTION_CC"}))};case"update":return!0===E?{msg:_.default.trans("STR_YOU_UPDATE_DESCRIPTION")+" "+A,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_UPDATE_DESCRIPTION"})," ",y)}:{msg:_.default.trans(!0===m?"STR_A_UPDATE_DESCRIPTION":"STR_A_UPDATE_DESCRIPTION_CC",b),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:!0===m?"STR_X_UPDATE_DESCRIPTION":"STR_X_UPDATE_DESCRIPTION_CC"}))};case"remove":return!0===E?{msg:_.default.trans("STR_YOU_REMOVE_DESCRIPTION")+" "+A,html:i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REMOVE_DESCRIPTION"})," ",y)}:{msg:_.default.trans(!0===m?"STR_A_REMOVE_DESCRIPTION":"STR_A_REMOVE_DESCRIPTION_CC",b),html:i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,u)},b)," ",i.a.createElement(r.a,{textKey:!0===m?"STR_X_REMOVE_DESCRIPTION":"STR_X_REMOVE_DESCRIPTION_CC"}))}}return""})(f.description||f.extraInfos.description);M=e.msg,D=e.html}if(M||D)break}M=N+" "+_.default.str("STR_X_UPDATE_TASK"),D=i.a.createElement("span",null,null,!0===g?i.a.createElement(r.a,{textKey:"STR_YOU"}):i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_X_UPDATE_YOUR_TASK"}));break;case"delete":case"todo.delete":if(k=!0,!0===g){M=_.default.trans("STR_YOU_REMOVE_TASK_TO_A",A),D=i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REMOVE_TASK_TO_X"})," ",y);break}!0===m?(M=N.length>0?_.default.trans("STR_A_REMOVE_YOUR_TASK",N):_.default.str("STR_REMOVED_TASK"),D=i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_X_REMOVE_YOUR_TASK"}))):!0===p&&(M=N+" "+_.default.str("STR_REMOVE_TASK_TO_A")+" "+A,D=i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_REMOVE_TASK_TO_A"})," ",y));break;case"todo.ding":case"ding":{let t=e.dingTimes,s="",a="";if(1===t)s=_.default.str("STR_FIRST_TIME"),a=i.a.createElement(r.a,{textKey:"STR_FIRST_TIME"});else if(2===t)s=_.default.str("STR_SEC_TIME"),a=i.a.createElement(r.a,{textKey:"STR_SEC_TIME"});else if(3===t)s=_.default.str("STR_THIRD_TIME"),a=i.a.createElement(r.a,{textKey:"STR_THIRD_TIME"});else{let e="STR_N_TIME";if(t>20)switch(t%10){case 1:e="STR_ST_TIME";break;case 2:e="STR_ND_TIME";break;case 3:e="STR_RD_TIME"}s=_.default.trans(e,t),a=i.a.createElement(r.a,{textKey:e,textArguments:[t]})}if(!0===g){M=_.default.str("STR_YOU_REMIND_A")+" "+A+" "+s,D=i.a.createElement("span",null,null,i.a.createElement(r.a,{textKey:"STR_YOU_REMIND_A"})," ",y," ",a);break}M=N+" "+_.default.str("STR_A_REMIND_YOU")+" "+s,P=_.default.trans("STR_TIP_A_REMINDED",N),D=i.a.createElement("span",null,null,i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)," ",i.a.createElement(r.a,{textKey:"STR_A_REMIND_YOU"})," ",a);break}case"todo.ding_ack":case"ding_ack":!0===g?(M=b+" "+_.default.str("STR_YOU_ACK_FROM_A"),D=i.a.createElement("span",null,null,b," ",i.a.createElement(r.a,{textKey:"STR_YOU_ACK_FROM_A"}))):(M=b+" "+_.default.str("STR_YOU_ACK_FROM_A_2")+" "+N,D=i.a.createElement("span",null,null,b," ",i.a.createElement(r.a,{textKey:"STR_YOU_ACK_FROM_A_2"})," ",i.a.createElement("span",{className:"td-msg-profile-style",onClick:e=>S(e,l)},N)));break;case"reminder":case"todo.remind":M=_.default.str("STR_TODO_COMPLETE_REMIND");break;case"todo.repeat":M=_.default.str("STR_TODO_REPEAT_REMIND")}return{msg:M,html:D,tip_text:P,iAmCreator:g,iAmInAssignees:m,iAmAWatcher:p,changeDueDate:w,changeStatus:L,isDeleted:k,pendingCount:v,receivedCount:T,completedCount:I}}static remindMyself(e,t){if(!e)return;let s=c.i.classifyTodoItem(e,t).isAssignee,a=e.assignees||[];return!!(s&&a.length<=1)&&(p.a.createInfo(_.default.str("STR_TODO_REMIND_MYSELF")),!0)}static getBottomButton(...e){let[t,s,n,o,d,h,u,_,m,p,g,E]=e;if(!t)return null;let f=null,I=null,T=null,v=t.act,R=t.assignees,S=(t.editor,c.i.classifyTodoItem(t,s)),O=(t.updateData,{});!0!==E&&(O={top:0,marginRight:0});const N=(S.isCreator?"btn_TskASGD_Detail":S.isAssignee&&"btn_TskRECD_Detail")||"btn_TskFOL_Detail";if(T=i.a.createElement(l.a,{tagName:"div",textKey:"STR_VIEW_DETAIL","data-id":N,className:"td-msg-btn",onClick:d},i.a.createElement("i",{className:"fa fa-icn_todo_csc_detail",style:Object(a.a)({fontSize:"13px",top:"2px"},O)}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_VIEW_DETAIL",tagName:"div"})),"todo.ding"!==v&&"ding"!==v||!0!==S.isAssignee||!0===S.isCreator){const e=(S.isCreator?"btn_TskASGD_Cmt":S.isAssignee&&"btn_TskRECD_Cmt")||"btn_TskFOL_Cmt";f=i.a.createElement(l.a,{tagName:"div",textKey:"STR_COMMENT_MSG",className:"td-msg-btn","data-id":e,onClick:u},i.a.createElement("i",{className:"fa fa-icn_todo_mobile_comment_active",style:Object(a.a)({fontSize:"12px",top:"3px"},O)}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_COMMENT_MSG",tagName:"div"}))}else f=i.a.createElement(l.a,{tagName:"div",textKey:"STR_REPORT",className:"td-msg-btn",onClick:h},i.a.createElement("i",{className:"fa fa-icn_todo_mobile_comment_active",style:O}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_REPORT",tagName:"div"}));return!0===S.isCreator?I=n===c.g.DONE?i.a.createElement(l.a,{tagName:"div",textKey:"STR_REOPEN",className:"td-msg-btn","data-id":"btn_TskASGD_Reopen",onClick:_},i.a.createElement("i",{className:"fa fa-icn_todo_csc_reopen",style:O}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_REOPEN",tagName:"div"})):o===c.g.DONE&&n===c.g.IN_PROCESS?i.a.createElement(l.a,{tagName:"div",textKey:"STR_COMPLETED",className:"td-msg-btn",onClick:m},i.a.createElement("i",{className:"fa fa-icn_todo_csc_complete",style:O}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_COMPLETED",tagName:"div"})):!0===S.isAssignee&&R.length<=1?i.a.createElement(l.a,{tagName:"div",textKey:"STR_COMPLETED",className:"td-msg-btn","data-id":"btn_TskASGD_Done",onClick:m},i.a.createElement("i",{className:"fa fa-icn_todo_csc_complete",style:O}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_COMPLETED",tagName:"div"})):i.a.createElement(l.a,{tagName:"div",textKey:"STR_REMIND_1",className:"td-msg-btn","data-id":"btn_TskASGD_RMD",onClick:g},i.a.createElement("i",{className:"fa fa-icn_todo_csc_ping",style:Object(a.a)({fontSize:"13px",top:"2px"},O)}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_REMIND_1",tagName:"div"})):!0===S.isAssignee&&(I=n===c.g.DONE?i.a.createElement(l.a,{tagName:"div",textKey:"STR_REOPEN","data-id":"btn_TskRECD_Reopen",className:"td-msg-btn",onClick:_},i.a.createElement("i",{className:"fa fa-icn_todo_csc_reopen",style:O}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_REOPEN",tagName:"div"})):n===c.g.WAITING_FOR_RESPONSE?i.a.createElement(l.a,{tagName:"div",textKey:"STR_TODO_RECEIVE_TASK",className:"td-msg-btn","data-id":"btn_TskRECD_Accept",onClick:p},i.a.createElement("i",{className:"fa fa-icn_todo_list_menu_confirm",style:Object(a.a)({top:"2px",fontSize:"15px"},O)}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_TODO_RECEIVE_TASK",tagName:"div"})):i.a.createElement(l.a,{tagName:"div",textKey:"STR_COMPLETED",className:"td-msg-btn","data-id":"btn_TskRECD_Done",onClick:m},i.a.createElement("i",{className:"fa fa-icn_todo_csc_complete",style:O}),!0!==E?null:i.a.createElement(r.a,{textKey:"STR_COMPLETED",tagName:"div"}))),{btn1:f,btn2:I,btn3:T}}static checkUpdateOrgTodoMsg(e,t,s,a){return new Promise(((n,i)=>{if(t){const o=()=>{c.i.getHistoryMsg(t.msgId,e).then((o=>{if(o&&o.length>0){let r=o[0];if(r){let o={};o[e]={lastMsg:r.msgId},c.i.updateOrgTodoMsg(o,t).then((e=>{a({type:d.FetchActions.UPDATE_MESSAGES,payload:{conversationId:s,messages:[e]}}),n()})).catch(i)}}}))};let r=t.extra;if(r){let t=r.todoInfo;if(t){let s=t[e];if(s){s.lastMsg?i():o()}else o()}else o()}else o()}else i()}))}static todoJumpMsg(e,t,s){return new Promise(((a,n)=>{let i=e||this.currentData;if(!i)return void n({err_msg:"invalid data"});let o=i.extra;if(!o)return void n({err_msg:"invalid extra"});if(o.constructor===String)try{o=JSON.parse(o)}catch(d){}if(!o)return void n({err_msg:"invalid extra json"});let r=o.msgId||o.msg_id,l=c.i.getToUid(i,t);c.i.setTargetMsgTodoJump(i.id),E.a.gotoMessage(r,l,s).then((e=>{if(e&&e.length>0){let t=e.filter((e=>e.msgId===r));if(t&&t.length>0){let e=t[0];e&&v.checkUpdateOrgTodoMsg(i.id,e,l,s)}}a(e)})).catch(n)}))}static deleteTodo(e,t,s,a){return new Promise(((t,n)=>{e?T.a.openConfirm({windowId:"1",name:u.MODAL_CONFIRM.confirmIdentities,params:{title:_.default.str("STR_REMOVE_TODO"),message:_.default.str("STR_CONFIRM_DELETE_TODO"),okText:_.default.str("STR_REMOVE_TODO"),cancelText:_.default.str("STR_CANCEL"),onOk:i=>{a&&a(i);let o=e.id;c.i.deleteTodo(o).then((e=>{s&&s({type:d.TodoActions.REMOVE_TODO,payload:o}),t(o)})).catch(n)},"data-id":{confirmBtn:"btn_DeleteTsk_Delete",cancelBtn:"btn_DeleteTsk_CXL"}}}):n()}))}}t.a=v},"0twL":function(e,t,s){"use strict";s.d(t,"e",(function(){return i})),s.d(t,"f",(function(){return o})),s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return l})),s.d(t,"c",(function(){return c})),s.d(t,"d",(function(){return d}));var a=s("z0WU"),n=s("9LuW");const i="input_line_",o="input_part_",r="clnMention",l="chat-input__content",c=10,d={START_ELEMENT:-20,END_ELEMENT:-21,START_LINE:-22};class h{static getPadddingTop(e){if(this.paddingTop)return this.paddingTop;try{let t=getComputedStyle(e,null).getPropertyValue("padding-top");return this.paddingTop=parseInt(t.substring(0,t.length-2)),this.paddingTop}catch(t){return a.default.logCoreError(t),10}}static findLineIndex(e){let t=e;for(;t&&t.nodeName;){if("DIV"==t.nodeName&&null!=t.id&&t.id.startsWith(i)){let e=t.id.substring(11);try{return parseInt(e)}catch(s){return a.default.logCoreError(s),0}}t=t.parentNode}return 0}static isUbuntu(){return window.navigator.appVersion.indexOf("Ubuntu")>0}static isWin32(){return"Win32"==window.navigator.platfrom}static findAncestor(e,t){let s=e;for(;(s=s.parentElement)&&!s.classList.contains(t););return s}static isActive(e){return e&&e==document.activeElement}static getCurrentTextIn(e){let t=e.childNodes;if(!t||0==t.length)return"";let s=[];for(let n=0;n<t.length;n++){let e=t[n];if("DIV"==e.nodeName&&e.id&&e.id.startsWith(i)){let e=t[n].childNodes;for(let t=0;t<e.length;t++){let a=e[t];s.push(h.getContentOf(a))}n!=t.length-1&&s.push("\n")}else s.push(h.getContentOf(e))}let a=s.join("");return a=h.replaceNonBreakingSpace(a),1==a.length&&"\n"==a&&this.isFireFox()?"":a}static isFireFox(){return null!=this.stupidFireFox?this.stupidFireFox:navigator.userAgent.search("Firefox")>-1}static replaceNonBreakingSpace(e){let t=new RegExp(String.fromCharCode(160),"g");return e.replace(t," ")}static getPreviousNode(e){return e?e.previousElementSibling?e.previousElementSibling:e.previousSibling&&"#text"==e.previousSibling.nodeName?e.previousSibling:null:null}static getContentOf(e){if(!e||!e.nodeName)return"";switch(e.nodeName){case"SPAN":return e.innerText.replace(/\n/g,"");case"IMG":return e.alt;case"DIV":return e.getAttribute("data-name");case"#text":return e.textContent.replace(/\n/g,"");default:a.default.log("not support that type",e.nodeName)}return""}static stupidCaseNeedFocusAfterChangeRange(){return h.isFireFox()}static checkIdInputText(e,t){return(null!=e||null!=t)&&(null!=e&&(e.startsWith(i)||e.startsWith(o))||null==e&&"#text"==t)}static translatePosToPosition(e,t){let s={row:0,column:0,offset:d.END_ELEMENT},a=0;for(let i=0;i<t.length;i++){let o=t[i];for(let r=0;r<o.length;r++){let o=t[i][r];o.pos<=e&&o.pos+o.len>=e&&(s={},s.row=i,s.column=r,(e>=o.pos+o.len||o.type!=n.a.SPAN)&&o.type!=n.a.SPAN?e>=o.pos+o.len?s.offset=d.END_ELEMENT:s.offset=d.START_ELEMENT:s.offset=e-o.pos),a+=o.len?o.len:0}a++,a==e&&(s={row:i+1,column:0,offset:d.START_ELEMENT})}return s}}t.g=h},1:function(e,t){},"1+6A":function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return n}));const a={File:1,Photo:2},n={SendMsg:1,UploadPersist:2}},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},"13iL":function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return g}));var a=s("VTBJ"),n=s("gwig"),i=s("338D"),o=s("fBUP"),r=s("PoHQ"),l=s("z0WU"),c=s("ej3F"),d=s("kCOK"),h=s("NDmK"),u=s("P6UB"),_=s("1pet"),m=s("mea/");const p=new l.LocalId,g=Object.freeze({SEND_SEEN:1,SEND_SEEN_V2:2});class E{constructor({startedTime:e,duration:t}){if(void 0===e||isNaN(e))throw new Error("configs not have startedTime");if(void 0===t||isNaN(t))throw new Error("duration is not valid ");this._startedTime=e,this._duration=t,this._timeoutWake=new i.a(3e4)}set startedTime(e){this._startedTime=e}get startedTime(){return this._startedTime}set duration(e){this._duration=e}get duration(){return this._duration}isExpire(){return this._startedTime+this._duration<Date.now()}getTimeoutWake(){return this._timeoutWake.next()}toPureObject(){return{startedTime:this._startedTime,duration:this._duration}}}class f{constructor({type:e,params:t,configs:s,retryId:a=null}){if(this._type=e,this._params=t,!s)throw new Error("config must be not null");this._retryId=a||this._getNextId(),s.constructor===E?this._configs=s:this._configs=new E(s)}_getNextId(){return Date.now()+"_"+Math.random().toString(36).slice(4)+"_"+p.next()}get type(){return this._type}get configs(){return this._configs}get params(){return this._params}get retryId(){return this._retryId}toString(){let e=this._configs;return{retryId:this._retryId,type:this._type,params:this._params,configs:e&&e.constructor===E?e.toPureObject():e}}}class I{static sendSeen(e){return new Promise(((t,s)=>{let a,[n,i,r]=[...e];r?(r&&(i=l.default.getGroupIdFromConversationId(i)),a=o.a.sendGroupSeen(n,i)):a=o.a.sendSeen(n,i),a.then(d.a).then((e=>{l.default.logCoreInfo(`[RetryHandler] send seen done ${i} |${(n||[]).join(",")}|`),t(e)})).catch((e=>{if(l.default.logCoreInfo(`[RetryHandler] send seen err ${i} |${(n||[]).join(",")}| ${e&&(e.error_code||e.code)?e.error_code||e.code:e}`),e&&e.error_code){let s=[114,-69];if(h.c.retrySendSeen&&h.c.retrySendSeen.not_retry&&h.c.retrySendSeen.not_retry.constructor===Array&&(s=h.c.retrySendSeen.not_retry),s.includes&&s.includes(e.error_code))return l.default.logCoreInfo("[RetryHandler] error but dont retry"),t(!0)}s(e)}))}))}static sendSeenV2(e){return new Promise(((t,s)=>{var n;let[i,r,c,p]=[...e];p||(p=m.a.newReq()),c&&(r=l.default.getGroupIdFromConversationId(r));const g=Object.keys(i);let E=Object.values(i);(null===(n=E)||void 0===n?void 0:n.length)>50&&(E.sort(((e,t)=>u.b.compareSort(e,t))),E=E.slice(-50));const f={data:E.map((e=>{let t=e.uidFrom||e.fromUid,s=e.idTo||e.toUid;return s&&s.startsWith(_.GROUPID_PREFIX)&&(s=s.slice(1)),{cmi:e.cliMsgId,gmi:e.msgId,si:t,di:c||s!=t?s:"0",mt:e.originMsgType||e.msgType,st:e.st||0===e.st?e.st:-1,at:e.at||0===e.at?e.at:-1,cmd:e.cmd||0===e.cmd?e.cmd:-1,ts:e.ts||e.sendDttm||-1}}))};let I;if(c){var T,v;const e=Object(a.a)(Object(a.a)({},f),{},{grid:r});I=null===h.c||void 0===h.c||null===(T=h.c.ack_seen)||void 0===T||!T.v2_enable||null!==h.c&&void 0!==h.c&&null!==(v=h.c.ack_seen)&&void 0!==v&&v.v1_retry?o.a.sendGroupSeen(g,r):o.a.sendGroupSeenV2({msgInfos:JSON.stringify(e)},p)}else{var R,S;const e=Object(a.a)(Object(a.a)({},f),{},{senderId:r});I=null===h.c||void 0===h.c||null===(R=h.c.ack_seen)||void 0===R||!R.v2_enable||null!==h.c&&void 0!==h.c&&null!==(S=h.c.ack_seen)&&void 0!==S&&S.v1_retry?o.a.sendSeen(g,r):o.a.sendSeenV2({msgInfos:JSON.stringify(e)},p)}I.then(d.a).then((e=>{l.default.logCoreInfo(`[RetryHandler] send seen done ${r} |${(g||[]).join(",")}|`),t(e)})).catch((e=>{if(l.default.logCoreInfo(`[RetryHandler] send seen err ${r} |${(g||[]).join(",")}| ${e&&(e.error_code||e.code)?e.error_code||e.code:e}`),e&&e.error_code){let s=[114,-69];if(h.c.retrySendSeen&&h.c.retrySendSeen.not_retry&&h.c.retrySendSeen.not_retry.constructor===Array&&(s=h.c.retrySendSeen.not_retry),s.includes&&s.includes(e.error_code))return l.default.logCoreInfo("[RetryHandler] error but dont retry"),t(!0)}s(e)}))}))}}const T=new class{constructor(){this._retryActions=[],this._storageDB=[],this._holderType={[g.SEND_SEEN]:I.sendSeen,[g.SEND_SEEN_V2]:I.sendSeenV2},this._connected=!0,r.default.listenEvent(r.NETWORK_CHANGE,(e=>{e===n.a.CONNECTED?(this._connected=!0,this._retryActions&&this._retryActions.length&&(l.default.logCoreInfo("[RetryHandler] network connected start retry"),this._doRetry())):this._connected=!1})),this._doRetry=this._doRetry.bind(this),this._doAfterRetry=this._doAfterRetry.bind(this),this._canRetry=this._canRetry.bind(this),this._loadFromDb=this._loadFromDb.bind(this),this._flushItem=this._flushItem.bind(this),this._removeFromStore=this._removeFromStore.bind(this),this._flushToDB=this._flushToDB.bind(this),this.retryAction=this.retryAction.bind(this)}setUserId(e){this._myDbKey||(this._myDbKey="zretry_v1__"+e,setTimeout((()=>{this._loadFromDb()}),15e3))}_loadFromDb(){if(this._alreadyLoadDB)return;this._alreadyLoadDB=!0;let e=c.b.getItem(this._myDbKey),t=[];try{e&&(t=JSON.parse(e))}catch(s){l.default.logCoreInfo(`[RetryHandler][_loadFromDb] err: ${s}`)}t?(l.default.logCoreInfo(`[RetryHandler][_loadFromDb] load ${t.length} from db`),t.forEach((e=>{if(e&&e.retryId&&e.type&&e.configs&&e.params){let t=new f({type:e.type,params:e.params,configs:e.configs,retryId:e.retryId});this._addEvent(t)}}))):l.default.logCoreInfo(`[RetryHandler][_loadFromDb] load ${t} from db`),this._storageDB.push.apply(this._storageDB,t)}_flushItem(e){var t;if(!e||e.constructor!==f)return;let s=e.toString();s.params=(null===(t=s.params)||void 0===t?void 0:t.slice(0,3))||[],this._storageDB.push(s),this._flushToDB()}_removeFromStore(e){if(!e||!e.retryId)return;let t=this._storageDB.length;this._storageDB=this._storageDB.filter((t=>!(!t||t.retryId===e.retryId))),t!=this._storageDB.length&&this._flushToDB()}_flushToDB(){if(this._alreadyLoadDB)if(this._lastFlush&&Date.now()-this._lastFlush<=2e3){if(this._timeoutFlushDB)return;this._timeoutFlushDB=setTimeout((()=>{this._timeoutFlushDB=null,this._flushToDB()}),2e3)}else this._lastFlush=Date.now(),this._timeoutFlushDB&&(clearTimeout(this._timeoutFlushDB),this._timeoutFlushDB=null),this._storageDB&&c.b.setItem(this._myDbKey,JSON.stringify(this._storageDB))}_canRetry(){return this._connected}_doAfterRetry(e,t,s){setTimeout(this._doRetry,0),l.default.logCoreInfo(`[RetryHandler] ${e} ${t?t.type:-1} ${s}`),e?this._removeFromStore(t):(s&&s.code,this._checkValidRetry(t))}_addEvent(e){this._retryActions.push(e),this._doRetry()}_doWithItem(e){return new Promise(((t,s)=>{let a,n,i;if(a=e.type,n=e.params,i=e.configs,i&&i.isExpire&&"function"==typeof i.isExpire&&i.isExpire())return l.default.logCoreInfo(`[RetryHandler] expire when do action ${a} ${n}`),s("expired");this._holderType.hasOwnProperty(a)?t(this._holderType[a](n)):s(`[RetryHandler] type ${a} isnt support`)}))}_checkValidRetry(e){if(e&&e.configs&&e.configs.constructor===E){let t=e.configs;if(t.isExpire())return this._removeFromStore(e);let s=t.getTimeoutWake();t.delayTimeout&&clearTimeout(t.delayTimeout),t.delayTimeout=setTimeout((()=>{t.delayTimeout=null,this._addEvent(e)}),s)}return!1}_doRetry(){if(!this._canRetry())return;if(!this._retryActions.length)return;if(this._doingRetry)return;let e=this._retryActions.shift();this._doingRetry=!0,this._doWithItem(e).then((()=>{this._doingRetry=!1,this._doAfterRetry(!0,e)})).catch((t=>{this._doingRetry=!1,this._doAfterRetry(!1,e,t)}))}retryAction(e,t,s){let a=new f({type:e,params:t,configs:s});this._flushItem(a),this._addEvent(a)}};t.b=T,e&&e.env}).call(this,s("ckNr"))},14:function(e,t){},"16K1":function(e,t,s){"use strict";function a(e,t){if(!e&&t||!t&&e)return!1;if(!e&&!t)return!0;if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=e.length;s--;)if(e[s]!=t[s])return!1;return!0}function n(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&(e===t||e.length===t.length&&e.every(((e,s)=>e===t[s])))}s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return n}))},"1Abx":function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s("z0WU"),n=s("fAKS"),i=s("XS0u"),o=s("NDmK");const r={GET_LAST_SEEN:"GET_LAST_SEEN"};const l=new class{constructor(){this._holdConverUnread=Object.create(null),this._hasUpdate=!1}init(){let e=i.default.getUnreadPoint();e&&e.length&&e.forEach((e=>{e.msgId=e.mId,e.actionId=e.actId,e.receivedAt=e.timestamp||0,this.update(e)})),n.b.getAllUnreadPoint().then((e=>{e&&e.length&&e.forEach((e=>{e.msgId=e.mId,e.actionId=e.actId,e.receivedAt=e.timestamp||0,this.update(e)}))})),window.addEventListener("beforeunload",(()=>{let e=Object.values(this._holdConverUnread);e.length>40&&(e.sort(((e,t)=>t.mId-e.mId)),e.splice(40)),i.default.setUnreadPoint(e)})),this._flushInterval()}_flushInterval(){let e=setTimeout((()=>{this._saveUnreadPoint(),clearTimeout(e),this._flushInterval()}),6e5)}_saveUnreadPoint(){if(!this._hasUpdate)return;this._hasUpdate=!1;let e=Object.values(this._holdConverUnread);e=e.filter((e=>e.mId||e.actId||e.timestamp)),n.b.setUnreadPoint(e)}_getMax(e,t){return void 0===e?+t:void 0===t?+e:Math.max(+e,+t)}update({msgId:e,actionId:t,userId:s,receivedAt:n,unreadSource:i}){let{mId:o,actId:l,timestamp:c}=this._holdConverUnread[s]||{};-1===e&&(o=void 0,l=void 0),i===r.GET_LAST_SEEN&&(a.default.stagingLog(`[Unread] update: got lastseen ${s}, ${o}, ${e}`),o==e)||(o=this._getMax(o,e),l=this._getMax(l,t),c=this._getMax(c,n),this._holdConverUnread[s]={mId:o,actId:l,userId:s,timestamp:c},this._hasUpdate=!0)}isRead({userId:e,msgId:t,actionId:s,msgSendDttm:n,msgLocalId:i}){if(!this._holdConverUnread[e])return!1;let r=!1;(i=i||t)&&"string"==typeof i&&(r=i.includes("_"));let{mId:l,actId:c,timestamp:d}=this._holdConverUnread[e];if(t=a.default.toInt(t),n=a.default.toInt(n),0!=l){if(l>t)return!0;if(l==t&&!r)return!0;if(l<t)return!1}return o.c.enable_unread_v2&&null!=d?d>=n:c>=(s=a.default.toInt(s))}};t.b=l},"1EWQ":function(e,t,s){"use strict";var a=s("NDmK"),n=s("9Gk3"),i=s("1pet");const o=new class{constructor(){}getAPITimeout(){return a.c.cloud.api_timeout||25e3}isSendToMe(e){return e&&e===a.c.sendToMeId}getRetryTimes(){return a.c.cloud.retry}enableClientRetry(){return!!a.c.cloud.enableClientRetry}getCount(e){return e||(e=a.c.cloud.countP.WEB),e}getNumberOfMessage(){return a.c.numberMessage}apiEnable(e,t){let s=a.c.cloud.enable;if(s)switch(e){case n.d.OVER_QUEUE:s=a.c.cloud.load_last_msg_enable;break;case n.d.NEW_TO_OLD:s=a.c.cloud.scroll_top_enable;break;case n.d.JUMP:s=a.c.cloud.jump_enable;break;case n.d.OLD_TO_NEW:s=a.c.cloud.scroll_bottom_enable;break;default:s=!1}const o=t.startsWith(i.GROUPID_PREFIX)||t===a.c.sendToMeId&&a.c.cloud.OA_enable;return s&&o}getPreventCloudLoadPollingDuration(){var e,t;return null!=(e=null===(t=a.c.cloud)||void 0===t?void 0:t.preventCloudLoadPolling)?e:3e5}getPreventCloudSameParamsDuration(){var e,t;return null!=(e=null===(t=a.c.cloud)||void 0===t?void 0:t.preventCloudLoadSameParams)?e:1e4}getJumpCount(e){return e?this.getCount():a.c.numSearchResultMessage}};t.a=o},"1F3s":function(e,t,s){"use strict";s.d(t,"b",(function(){return _})),s.d(t,"a",(function(){return m}));var a=s("q1tI"),n=s.n(a),i=s("xrk1"),o=s("sxU/"),r=s("n4Tl"),l=s("9/5/"),c=s.n(l),d=s("5KmB"),h=s("NDmK"),u=s("75pU");function _(e){return d.c?n.a.useCallback((()=>{h.c.image.enable_preload_local_hd&&p(e)}),[e]):n.a.useCallback((()=>{}),[])}function m(e){d.c&&n.a.useEffect((()=>{h.c.image.enable_preload_local_hd&&p(e)}),[])}function p(e){g.push(e),I(h.c.image.preload_wait,h.c.image.preload_max_wait)()}let g=[];function E(){let e=g;g=[],e=Array.from(new Set(e));const t=i.e.getState(),s=e.map((e=>{let s=e;const a=r.r(e,"hd")(t);if(a)return s+="-hd",{ciId:e,key:s,path:a};const n=r.r(e,"normal")(t);return n?(s+="-hd",{ciId:e,key:s,path:n}):void 0})).filter((e=>e));d.b()?o.a.instance.emit("preload-local-hd",s):d.d()&&i.e.dispatch(i.a.Checks.createPreloadLocalHD(s))}let f=null;const I=s.n(u)()((function(e,t){return f&&f.flush(),f=c()(E,e,{maxWait:t}),f}))},"1FaF":function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"c",(function(){return l}));var a=s("Ydol"),n=s("97kL"),i=s("5tQl");const o={default:1e4,typing:1e4,fsending:2e4},r={Send:1,Cancel:2,sendGroupPhoto:3,clearGroupSkeleton:4},l={File:1,Folder:2},c="typing",d="fsending";const h=new class{constructor(){this.mapIdTyping={},this.typingTimeOutMap={}}addItemTyping(e){return this._addItemTyping(e)}_addItemTyping(e){e&&this._canAdd(e)&&(this.mapIdTyping[e.conId]=e,this.startUpdateUI(e))}_canAdd(e){const t=e&&e.conId;if(!this.mapIdTyping.hasOwnProperty(t))return!!t;{const a=this.mapIdTyping[t];if(e.action!=d)return!1;{const t=e.fdata,n=a.fdata;try{if(JSON.parse(t).clientId!=JSON.parse(n).clientId)return!0}catch(s){}}}}_canRemove(e){if(this.mapIdTyping.hasOwnProperty(e)){let t=this.mapIdTyping[e];if(t.action==c)return!0;if(t.action==d)return!1}}removeItemTyping(e,t=!1){return this._removeItemTyping(e,t)}_removeItemTyping(e,t){return!this.mapIdTyping.hasOwnProperty(e)||!(!t&&!this._canRemove(e))&&(delete this.mapIdTyping[e],!0)}hasTyping(e){return this.mapIdTyping[e]}startUpdateUI(e){e&&e.conId&&this.typingTimeOutMap[e.conId]&&(clearTimeout(this.typingTimeOutMap[e.conId]),delete this.typingTimeOutMap[e.conId]);let t=t=>{e.isTyping=t,a.default.send(n.FetchActions.USER_TYPING,e)};t(!0);const s=o[e&&e.action]||o.default;this.typingTimeOutMap[e.conId]=setTimeout((()=>{this.removeItemTyping(e.conId,!0),t(!1)}),s)}unMountUIIfHave(e,t){if(this.mapIdTyping.hasOwnProperty(e)){const i=`${t.cliMsgId||t.clientId}`,o=this.mapIdTyping[e]||{},r=o.fdata;if(r)try{JSON.parse(r).clientId==i&&this.removeItemTyping(e,!0)&&(o.isTyping=!1,setTimeout((()=>{a.default.send(n.FetchActions.USER_TYPING,o)}),0))}catch(s){}}}unMountUI(e={}){const{conId:t}=e;if(this.mapIdTyping.hasOwnProperty(t)){const i=this.mapIdTyping[t].action,o=this.mapIdTyping[t].fdata,r=e.action,l=e.fdata;if(i&&r&&r===i&&o&&l)try{JSON.parse(o).clientId==JSON.parse(l).clientId&&this.removeItemTyping(e.conId,!0)&&(e.isTyping=!1,setTimeout((()=>{a.default.send(n.FetchActions.USER_TYPING,e)}),0))}catch(s){}}}groupPhotoSending(e){e&&e.groupLayoutId&&e.skeletonLayout&&e.fromUid&&i.a.setGroupPhotoSkeleton(e.groupLayoutId+"_"+e.fromUid,e.skeletonLayout)}clearGroupPhotoSkeleton(e){e&&e.groupLayoutId&&e.fromUid&&i.a.setGroupPhotoSkeletonEdit(e.groupLayoutId+"_"+e.fromUid)}};t.a=h},"1Kge":function(e,t,s){"use strict";var a=s("1pet"),n=s("Yi2m");const i=3e5;const o=new class{constructor(){this._mapGroupId=new Map,this._mapFrame=new Map,this._mapIterationCount=new Map,this._trackSendMultiSticker=new Map,this._currentItemsPerRow=0}setGroupId(e,t){this._mapGroupId.set(e,t)}getGroupId(e){return this._mapGroupId.get(e)}clearGroupId(e){this._mapGroupId.delete(e)}increaseIterationCount(e,t,s){const a=this._mapIterationCount.get(`${e}_${t}`);a&&a.instance===s&&this._mapIterationCount.set(`${e}_${t}`,{instance:s,count:a.count+1})}resetIterationCount(e,t,s){const a=this._mapIterationCount.get(`${e}_${t}`);this._mapIterationCount.set(`${e}_${t}`,{instance:a?a.instance:s,count:0})}deleteIterationCount(e,t,s){const a=this._mapIterationCount.get(`${e}_${t}`);a&&a.instance===s&&this._mapIterationCount.delete(`${e}_${t}`)}getIterationCount(e,t,s){const a=this._mapIterationCount.get(`${e}_${t}`);return void 0!==a?a.count:(this.resetIterationCount(e,t,s),0)}setSyncAnimationInfo(e,t,s,a,n){const i=this.getSyncAnimationInfo(e,t);i&&i.instance!==a||this._mapFrame.set(`${e}_${t}`,{frame:s,instance:a,nextTs:n})}getSyncAnimationInfo(e,t){const s=this._mapFrame.get(`${e}_${t}`);return s||null}getSyncAnimationNextTs(e,t){const s=this.getSyncAnimationInfo(e,t);return s?s.nextTs:-1}clearSyncAnimationFrame(e,t,s){const a=this.getSyncAnimationInfo(e,t);a&&a.instance===s&&this._mapFrame.delete(`${e}_${t}`)}setCurrentItemsPerRow(e){this._currentItemsPerRow=e}trackSendMultiSticker(e){if(!e)return;const t=e.userId,s=Date.now()-e.lastMessageTime;(e.lastType!==a.MSG_STICKER||"0"!==e.lastMessageUidFrom||s>i)&&this.submitSendMultiStickerTracking(t);const n=this._trackSendMultiSticker.get(t);let o=1,r=-1;n&&(o=n.times+1,r=n.timer,-1===r&&(r=setTimeout((()=>{this.submitSendMultiStickerTracking(t)}),i-s))),this._trackSendMultiSticker.set(t,{times:o,timer:r})}submitSendMultiStickerTracking(e){const t=this._trackSendMultiSticker.get(e);if(t){if(-1!==t.timer&&clearTimeout(t.timer),t.times>1){let e=t.times;e>50&&(e=50);let s="1070422"+("00"+e).slice(-2);s=parseInt(s),s&&n.e.logAction(s)}this._trackSendMultiSticker.delete(e)}}};t.a=o},"1ORX":function(e,t,s){"use strict";var a=s("oTQY"),n=s("vKkC"),i=s("z0WU");const o=new class{constructor(){this.dispatch=()=>{a.a.logError("[popup-manager]","dispatch func not bound")},this.currentModalId=new i.LocalId(99)}bindDispatch(e){this.dispatch=e}getNextModalId(){return this.currentModalId.next()}showPopup(e,t,s=!1){const a=this.getNextModalId();return this.dispatch({type:n.e.SHOW_POPUP,payload:{popupType:e,popupData:t,stacking:s,modalId:a}}),a}closePopup(e){this.dispatch({type:n.e.CLOSE_POPUP,payload:e})}closeAllPopups(){this.dispatch({type:n.e.CLOSE_ALL_POPUPS})}showConfirm(e){this.dispatch({type:n.e.SHOW_CONFIRM,payload:e})}};t.a=o},"1PLK":function(e,t,s){"use strict";s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return h}));var a=s("c51z"),n=s("6uTC"),i=s("z0WU"),o=s("NDmK"),r=s("XS0u"),l=(s("1ORX"),s("4MXZ"),s("GNR+"),s("Yi2m"),s("tGM2")),c=(s("s2ie"),s("Ja3U"));s("L+5E");const d=new class{constructor(){this.confirm=null}setConfirmCallback(e){this.confirm=e}getConfirmCallback(){return this.confirm}};class h{static openWithTab(e,t,s=!0,l=!1,c=null){if(!i.default.isZaviLink(e)&&o.c.open_link_config&&o.c.open_link_config.enable&&o.c.open_link_config.enable>0&&o.c.open_link_config.time_refetch){let t=o.c.open_link_config.nretry;(t>0||l)&&(t=l?t:t-1,o.c.open_link_config.nretry=t,r.default.getTimeRefetchJumpUrl()&&void 0!==r.default.getTimeRefetchJumpUrl().time&&r.default.setTimeRefetchJumpUrl(r.default.getTimeRefetchJumpUrl().time,t),null!==o.c.open_link_config.jumpUrl&&(e=o.c.open_link_config.jumpUrl+encodeURIComponent(e)))}return!e||e.startsWith("http://")||e.startsWith("https://")||(e="//"+e),i.default.validOpenUrl(e)?"Safari"===i.default.getBrowserName()?(t&&t.close(),h.openUrlInSandBox(e),!0):((t=t||window.open())?(t.opener=null,t.location=e,setTimeout((()=>{t.close()}),200)):n.a.createMessageMultiWindow(a.default.str("STR_POPUP_OPEN_ERR"),c),!0):(s&&n.a.createWarning(a.default.str("STR_UNSAFE_LINK")),!1)}static open(e,t=!0,s=!1,d=null){if(!i.default.isZaviLink(e)&&o.c.open_link_config&&o.c.open_link_config.enable&&o.c.open_link_config.enable>0&&o.c.open_link_config.time_refetch){let t=o.c.open_link_config.nretry;(t>0||s)&&(t=s?t:t-1,o.c.open_link_config.nretry=t,r.default.getTimeRefetchJumpUrl()&&void 0!==r.default.getTimeRefetchJumpUrl().time&&r.default.setTimeRefetchJumpUrl(r.default.getTimeRefetchJumpUrl().time,t),null!==o.c.open_link_config.jumpUrl&&(e=o.c.open_link_config.jumpUrl+encodeURIComponent(e)))}if(!e||e.startsWith("http://")||e.startsWith("https://")||(e="//"+e),!i.default.validOpenUrl(e))return t&&n.a.createWarning(a.default.str("STR_UNSAFE_LINK")),!1;if("Safari"===i.default.getBrowserName()){let t=i.default.iframeOpen(e);return t&&-1===t.error_code&&c.a.openConfirm({windowId:"1",name:l.MODAL_CONFIRM.confirmIdentities,params:{message:a.default.str("STR_WARNING_OPEN_UNSECURE_LINK"),okText:a.default.str("STR_CONT_OPEN"),cancelText:a.default.str("STR_CANCEL"),onOk:()=>{i.default.iframeOpen(e,"","",!0)}}}),!0}{const t=window.open();t?(t.opener=null,t.location=e):n.a.createMessageMultiWindow(a.default.str("STR_POPUP_OPEN_ERR"),d)}return!0}static openUrlInSandBox(e,t=5e3){let s,a,n,i;s=document.createElement("iframe"),s.style.display="none",document.body.appendChild(s),a=s.contentDocument||s.contentWindow.document,n=a.createElement("script"),n.type="text/javascript",n.text="window.parent=null;window.top=null;window.frameElement=null",a.body.appendChild(n),i=a.createElement("iframe"),i.src=e,a.body.appendChild(i),setTimeout((()=>{document.body.removeChild(s)}),t)}}},"1Pr5":function(e,t,s){"use strict";(function(e){var a=s("ypFI"),n=s("jPsE"),i=s("4prX");let o,r;let l=0;let c=1e3;const d=["http","https"],h=/^http:\/\//i;t.a={nextThumbLocalId:function(){return l+=1},nextThumbLocalServiceId:function(){return c+=1},isUrl:function(e){if("string"==typeof e){const t=e.toLocaleLowerCase();if(d.some((e=>t.startsWith(e))))return!0}return!1},xhrBuffer:function(t,s=0,i=a.a.MaxHeaderSize){return new Promise(((a,o)=>{const r=new XMLHttpRequest;let l="string"!=typeof(c=t)?c:c.replace(h,"https://");var c;r.open("GET",l),r.responseType="arraybuffer",r.setRequestHeader("Range",`bytes=${s}-${i}`),r.timeout=5e3,r.onload=()=>{const t=r.response;t&&206===r.status?a(e.from(t)):o(n.a.OTHER_HELPER_XHR_BUFFER_ON_LOAD_INVALID_STATUS_OR_RESP)},r.onerror=()=>o(n.a.OTHER_HELPER_XHR_BUFFER_ON_ERROR),r.ontimeout=()=>o(n.a.OTHER_HELPER_XHR_BUFFER_ON_TIMEOUT),r.onabort&&(r.onabort=()=>o(n.a.OTHER_HELPER_XHR_BUFFER_ON_ABORT)),r.send()}))},localBuffer:function(t,s=0,n=a.a.MaxHeaderSize){return new Promise(((a,i)=>{let r=[],l=o.createReadStream(t,{start:s,end:s+n});l.on("error",i),l.on("data",(e=>r.push(e))),l.on("end",(()=>a(e.concat(r))))}))},isValidBuffer:function(t){return t instanceof Uint8Array||t instanceof ArrayBuffer||e.isBuffer(t)},clampSizeToContain:function({srcWidth:e,srcHeight:t,maxWidth:s=9999,maxHeight:a=9999,minWidth:n=1,minHeight:i=1}){let o=e,r=t;if(e>s||t>a){const n=Math.min(s/e,a/t);o=e*n,r=t*n}return o=Math.max(n,o),r=Math.max(i,r),[o,r]},clampSizeToCover:function({srcWidth:e,srcHeight:t,maxWidth:s=9999,maxHeight:a=9999,minWidth:n=1,minHeight:i=1}){let o=e,r=t;if(e<n||t<i){const s=Math.max(n/e,i/t);o=e*s,r=t*s}return o=Math.min(s,o),r=Math.min(a,r),[o,r]},getThumbObjTimeOut:function(e={}){var t,s;return(null==e||null===(t=e.data)||void 0===t||null===(s=t.config)||void 0===s?void 0:s.timeOut)||a.a.timeOut.Services},useFastServices:function(e={}){var t,s,a;return null==(t=null==e||null===(s=e.data)||void 0===s||null===(a=s.config)||void 0===a?void 0:a.useFastServices)||t},isTypeSupport:function(e){return!!a.a.ThumbType[e]},ensureDir:function(e){if("string"==typeof e)try{o.ensureDir(r.dirname(r.resolve(e)),(e=>{}))}catch(t){}},logQos:function(e,t,s,a){try{if(!a)return;t?i.a.increaseSuccess(a,0,Date.now()-s):i.a.increaseFailed(a,0,Date.now()-s,1,s)}catch(n){}}}}).call(this,s("Q40w").Buffer)},"1QIM":function(e,t,s){"use strict";var a=s("Ix/i"),n=s("cJs5"),i=s("y+6h"),o=s("tGM2"),r=s("oMA/"),l=s("HcYY"),c=s("vKkC"),d=s("KR8Z"),h=s("oTQY"),u=s("L0Gx");class _ extends a.a{constructor(){super(),this.enableRetryNoNetwork(!0),this._url="",this._onSuccess=null,this._onFail=null,this._totalRetry=0,this._wait=500}callApi(){return new Promise(((e,t)=>{fetch(this._url).then((()=>{setTimeout(e,this._wait)})).catch(t)}))}handleSucess(){this._onSuccess&&this._onSuccess()}handleError(e){this._totalRetry++,(this._totalRetry>3||!super.handleError(e))&&this._onFail()}start(e,t,s,a){this._onSuccess=s,this._onFail=a,this._url=e,this._wait=t,this.request()}}var m=_;class p extends a.a{constructor(e){super(e),this.uid=null,this.dkey=null,this._OAuthManager=null,this._lastRunOAath=0}callApi(){return new Promise(((e,t)=>{let s=[];const a=(n=0)=>{i.a.listFriend(50*n,50).then((i=>i&&i.data?i.data.err!==u.a.SUCCESS?t(i.data):void(i.data.data&&i.data.data.listFriend&&Array.isArray(i.data.data.listFriend)?(Array.prototype.push.apply(s,i.data.data.listFriend),++n>=100||!i.data.data.more||this._valueValid(i.total)&&s.length>=i.total?e(s):a(n)):(h.a.logError("Invalid response data ",i.data),e(s))):(h.a.logError("Invalid response data ",i.data),t()))).catch((e=>{h.a.logError("Call api error: "+e),t(e)}))};a()}))}saveLastFetch(){const e=Date.now();try{localStorage.setItem(o.j,e)}catch(t){h.a.logError("[saveLastFetch] error ",t)}}handleError(e,t){if(-118===e&&t&&t.data)return void this._reqOAuth(t.data).then((()=>{this.request()})).catch((e=>{h.a.logError("[FriendListManager] handle error 118 fail ",e),this._setTimerRequest(r.b.timeRefetchFriendList,n.e.INTERVAL)}));super.handleError(t)||this._setTimerRequest(r.b.timeRefetchFriendList,n.e.INTERVAL),h.a.logError("[FriendListManager] error on request ",e)}_reqOAuth(e){return new Promise(((t,s)=>{try{let a=Date.now();if(a-this._lastRunOAath<=9e5)return s("prevent hit OAuth");if(e&&e.constructor===String){let n=JSON.parse(e);if(n&&n.url){const e=n.url,i=n.time_wait_ms||500;return this._lastRunOAath=a,this._OAuthManager||(this._OAuthManager=new m),void this._OAuthManager.start(e,i,t,s)}}return s()}catch(a){return s(a)}}))}_isValidData(e){return Array.isArray(e)}handleSucess(e){this._setTimerRequest(r.b.timeRefetchFriendList,n.e.INTERVAL),this._isValidData(e)&&this.setFriendList(e)}reset(){this.uid=null,this.dkey=null}init(e,t){this.uid&&this.uid===t||(this.uid=t,this.dkey=e,this.startFetching())}startFetching(){return h.a.logInfo("[FriendListManager] starting"),this.request()}_getFriendListFromStorage(){if(!this.dkey||!this.uid)return[];try{const e=window.localStorage.getItem(o.c+this.uid);if(!e)return[];return JSON.parse(l.a.decrypt(e,this.dkey))}catch(e){return h.a.logError("[PersistRoomManager] cannot get value",e),[]}}getFriendList(){return new Promise(((e,t)=>{let s=this._getFriendListFromStorage();if(s)return e(s);this.callApi((t=>e(t))).catch((()=>e([])))}))}signalToNative(e){d.a.send(c.b.FETCHED_FRIEND_LIST,e)}setFriendList(e){if(this.dkey&&this.uid)try{const t=o.c+this.uid,s=window.localStorage.getItem(t),a=l.a.encrypt(JSON.stringify(e),this.dkey);s&&s===a||(window.localStorage.setItem(t,a),this.signalToNative(e))}catch(t){h.a.logError("[setFriendList] error on saving listroom",t)}else this.signalToNative(e)}}const g=new p;t.a=g},"1YlR":function(e,t,s){"use strict";var a=s("wx14"),n=s("VTBJ"),i=s("q1tI"),o=s.n(i),r=s("c7k8"),l=s("AM4K");class c extends o.a.Component{constructor(e){super(e),this.isFireFoxBrowser=this.isFireFox(),this.state={scrollToOffset:0},this.getScrollTop=this.getScrollTop.bind(this),this.scrollTop=this.scrollTop.bind(this),this.getClientHeight=this.getClientHeight.bind(this),this.getScrollHeight=this.getScrollHeight.bind(this),this.refresh=this.refresh.bind(this)}onResizer({width:e,height:t}){this.clientHeight=t,this.props.onResize&&this.props.onResize(e,t)}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}handleCustomScroll(e){if(e){const{target:t}=e;if(!(t instanceof HTMLDivElement))return;this.setState({scrollToOffset:t.scrollTop})}}handleVirtualizedScroll(e){e&&null!=e.scrollTop&&this.customScrollBar&&this.customScrollBar.scrollTop(e.scrollTop),this.props.onScroll&&this.props.onScroll(e)}getItemHeight(e){return this.props.itemHeight?this.props.itemHeight(e):50}rowRender(e,t){if(this.props.rowRender){let s=this.props.items,a=null;return s.length>0&&e>=0&&e<=s.length-1&&(a=s[e]),this.props.rowRender(e,t,a)}return null}getScrollTop(){return this.state.scrollToOffset}scrollTop(e=0){this.mainList&&this.mainList.scrollToPosition(e),this.customScrollBar&&this.customScrollBar.scrollTop(e)}scrollBottom(){var e;let t=0,s=(null===(e=this.props.items)||void 0===e?void 0:e.length)||0;for(let a=0;a<s;a++)t+=this.getItemHeight(a);this.scrollTop(t-this.clientHeight)}refresh(e=0){this.mainList&&this.mainList.recomputeRowHeights(e)}getClientHeight(){return this.customScrollBar?this.customScrollBar.getClientHeight():0}getScrollHeight(){return this.customScrollBar?this.customScrollBar.getScrollHeight():0}render(){let e=this.props.items;if(!e||e.length<=0)return null;let t=0,s=e.length;for(let a=0;a<s;a++)t+=this.getItemHeight(a);return o.a.createElement(r.a,{onResize:this.onResizer.bind(this)},(({width:e,height:i})=>o.a.createElement("div",{"data-id":this.props["data-id-info"]&&this.props["data-id-info"].list,className:"virtualized-scroll",style:{height:`${i}px`,width:`${e}px`}},o.a.createElement(r.d,Object(a.a)({ref:e=>this.mainList=e,style:Object(n.a)({position:"absolute",willChange:"auto"},this.props.style),width:e+(this.isFireFox()&&t>this.clientHeight?16:0),height:i},this.props,{columnWidth:0,rowCount:s,rowHeight:({index:e})=>this.getItemHeight(e),overscanRowCount:5,scrollTop:this.state.scrollToOffset,onScroll:this.handleVirtualizedScroll.bind(this),rowRenderer:({index:e,style:t})=>o.a.createElement("div",{key:e,style:t,"data-id":this.props["data-id-info"]&&this.props["data-id-info"].item},this.rowRender(e,t))})),l.a.getScrollBar({height:i},(e=>this.customScrollBar=e),this.handleCustomScroll.bind(this),t))))}}t.a=c},"1ZEA":function(e,t,s){"use strict";var a=s("wx14"),n=s("Ff2n"),i=s("q1tI"),o=s.n(i),r=s("c51z");class l extends o.a.Component{constructor(e){super(e)}render(){let e,t,s=this.props,{textKey:i,trailerText:l,tagName:c,inputRef:d,title:h}=s,u=Object(n.a)(s,["textKey","trailerText","tagName","inputRef","title"]);return c?(e=c,t=!0):(e="input",t=!1),void 0===l&&(l=""),t?o.a.createElement(e,Object(a.a)({},u,{"data-translate-placeholder":i,"data-translate-title":h,title:r.default.str(h),placeholder:r.default.str(i)+" "+l,ref:this.props.inputRef,"data-trailer":l})):o.a.createElement(e,Object(a.a)({},u,{ref:this.props.inputRef,"data-translate-placeholder":i,"data-translate-title":h,title:r.default.str(h),placeholder:r.default.str(i)+" "+l}))}}t.a=l},"1egx":function(e,t,s){"use strict";s.d(t,"a",(function(){return v})),s.d(t,"b",(function(){return f})),s.d(t,"c",(function(){return L}));var a=s("Yii+"),n=s("VTBJ"),i=s("fBUP"),o=s("kCOK"),r=s("xQyS"),l=s("338D"),c=s("D5aG"),d=s("NDmK"),h=s("Erqw"),u=s("kAQj"),_=s("bUXd"),m=s("qtjR"),p=s("iRKH"),g=s("IoRb");const E=(e=0)=>async t=>{var s,h,u;if(e>=d.c.ttl.maxtry_renew)return;Object(c.b)();const m=_.a.getTimeNow()-d.c.ttl.max_ts_deviation,f=await Object(r.b)((()=>i.a.getAutoDeleteConvers().then(o.a)));if(!f.ok&&d.c.ttl.retry_codes.includes(+(null===(s=f.error)||void 0===s?void 0:s.code)))return Object(c.c)(),setTimeout((()=>t(E(e+1))),1e3*Object(l.b)(8+e));const I=Object(c.c)();if(!f.ok)return void Object(g.a)("createRenewConversNTry failed, no retry",f.error);const T=(null!=(h=null===(u=f.value)||void 0===u?void 0:u.convers)?h:[]).filter((e=>e)).map((e=>{const t=Object(p.a)(e.destId,e.isGroup);return Object(n.a)(Object(n.a)({},e),{},{toUid:t,ts:m})}));t(a.a.actions.renewConvers({ts:m,getConvers:T}));for(const e of I)t(e)},f=()=>e=>{if(I())return e(E(0))},I=()=>{if(d.c.ttl.always_renew)return!0;if(!Object(u.d)())return!0;let e=Object(u.b)();return e=isNaN(e)?0:e,!!h.a.isOverflowAtTime(e)||_.a.getTimeNow()-e>d.c.ttl.max_store_cache_duration};var T=s("/YHU");const v=()=>async e=>{e(R()),await e(f())},R=()=>e=>{var t;const s=localStorage.getItem(Object(u.a)().state),n=null===(t=Object(T.a)(s))||void 0===t?void 0:t.convers;e(a.a.actions.rehydrateCache({cache:n}))};s("WW1m");var S=s("VXdX"),O=s("c51z"),N=s("1pet"),b=s("6uTC"),C=s("Yi2m"),A=(s("PoHQ"),s("UiPd"));const y=[112,272],D=async(e,t,s,a)=>{var n;let c=await(({threadId:e,isGroup:t,ttl:s})=>Object(r.b)((()=>i.a.updateAutoDeleteConvers({threadId:e,isGroup:t?1:0,ttl:s}).then(o.a))))({threadId:e,isGroup:t,ttl:s});return a>=d.c.ttl.maxtry_update?c:!c.ok&&y.includes(null===(n=c.error)||void 0===n?void 0:n.code)?(await Object(m.a)(1e3*Object(l.b)(a)+2e3),await D(e,t,s,a+1)):c},M=864e5,P=7*M,w=30*M,L=(e,t,s)=>async a=>{var n;setTimeout((()=>a(((e,t)=>(s,a)=>{const n=a(),i=Object(S.a)(e)(n),o=!(null==e||!e.startsWith(N.GROUPID_PREFIX));if(C.e.logAction("21800001"),!i)if(C.e.logAction("21800101"),t===M?C.e.logAction("21800102"):t===P?C.e.logAction("21800103"):t===w&&C.e.logAction("21800104"),o){const e="21800106";C.e.logAction(e),t===M?C.e.logAction(e+"01"):t===P?C.e.logAction(e+"02"):t===w&&C.e.logAction(e+"03")}else{const e="21800105";C.e.logAction(e),t===M?C.e.logAction(e+"01"):t===P?C.e.logAction(e+"02"):t===w&&C.e.logAction(e+"03")}if(i)if(C.e.logAction("21800107"),i===M&&t===P?C.e.logAction("21800108"):i===M&&t===w?C.e.logAction("21800109"):i===P&&t===M?C.e.logAction("21800110"):i===P&&t===w?C.e.logAction("21800111"):i===w&&t===M?C.e.logAction("21800112"):i===w&&t===P&&C.e.logAction("21800113"),t&&!o){const e="21800114";C.e.logAction(e),i===M&&t===P?C.e.logAction(e+"01"):i===M&&t===w?C.e.logAction(e+"02"):i===P&&t===M?C.e.logAction(e+"03"):i===P&&t===w?C.e.logAction(e+"04"):i===w&&t===M?C.e.logAction(e+"05"):i===w&&t===P&&C.e.logAction(e+"06")}else if(t){const e="21800115";C.e.logAction(e),i===M&&t===P?C.e.logAction(e+"01"):i===M&&t===w?C.e.logAction(e+"02"):i===P&&t===M?C.e.logAction(e+"03"):i===P&&t===w?C.e.logAction(e+"04"):i===w&&t===M?C.e.logAction(e+"05"):i===w&&t===P&&C.e.logAction(e+"06")}t||(C.e.logAction("21800002"),i===M?C.e.logAction("21800201"):i===P?C.e.logAction("21800202"):i===w&&C.e.logAction("21800203"),o?C.e.logAction("21800205"):C.e.logAction("21800204"))})(e,t))),0);let i=e;const o=!(null==e||!e.startsWith(N.GROUPID_PREFIX));o&&(i=e.substr(1));const r=await D(i,o,t,0);let l,c=!1;r.ok?null!==(n=r.value)&&void 0!==n&&n.error_code&&(c=!0,l=r.value,a(B({error:r.value,toUid:e,destId:i,isGroup:o}))):(c=!0,l=r.error,a(B({error:r.error,toUid:e,destId:i,isGroup:o}))),null==s||s(c?{}:{ok:!0,value:r.value})},k=276,x=277,U=278,F=279,G=[x,U],B=({error:e,destId:t,isGroup:s})=>a=>{if(setTimeout((()=>a(H({error:e,destId:t,isGroup:s}))),0),276!=(null==e?void 0:e.error_code)||s)null!=e&&e.error_message?b.a.createError(e.error_message):b.a.createError(O.default.str("STR_UPDATE_TTL_FAIL"));else{const e=A.default.getDName(t);b.a.createError(O.default.trans("STR_VANISH_VER_NOT_SUPPORT",[e]))}},H=({error:e,destId:t,isGroup:s}={})=>()=>{const t="218005";if(C.e.logAction(t+"00"),s){const s=t+"02";C.e.logAction(s),(null==e?void 0:e.error_code)==k&&C.e.logAction(s+"01"),(null==e?void 0:e.error_code)==U&&C.e.logAction(s+"02"),(null==e?void 0:e.error_code)==x&&C.e.logAction(s+"03"),(null==e?void 0:e.error_code)==F&&C.e.logAction(s+"04")}else{const s=t+"01";C.e.logAction(s),(null==e?void 0:e.error_code)==k&&C.e.logAction(s+"01"),(null==e?void 0:e.error_code)==U&&C.e.logAction(s+"02"),(null==e?void 0:e.error_code)==x&&C.e.logAction(s+"03")}if(G.includes(null==e?void 0:e.error_code)){const e=t+"05";C.e.logAction(e)}}},"1fyS":function(e,t,s){"use strict";var a=s("1pet");const n={Folder:"Folder",FileEexc:"FileEexc",PhotoBlob:"PhotoBlob",FileBlob:"FileBlob",None:"None"},i={[n.FileBlob]:{execSamePid:!0},[n.FileEexc]:{execSamePid:!1,qos:{commandId:91074}}},o={FileEexc:a.MSG_SUBTYPE_FILE_EEXC},r={File:a.FILE_FTYPE.FILE,Folder:a.FILE_FTYPE.FOLDER};t.a={UploadType:n,WorkerState:{Idle:"Idle",Run:"Run"},ErrorType:{General:"General",Sys:"Sys",FileBlob:"FileBlob",FileEexc:"FileEexc"},Channels:{UFMReq:"ufm-req",UFMResp:"ufm-resp",UFMAbort:"ufm-abort",PhotoViewPingMainRenderer:"photoview-ping-main-renderer"},WorkerTimeOut:6e4,Config:i,MsgSubType:o,Ftype:r}},"1hAc":function(e,t,s){"use strict";var a=s("Ff2n"),n=s("q1tI"),i=s.n(n),o=(s("fB5U"),s("iuhU")),r=(s("c51z"),s("v/qp"));s("zRkS");const l="file-actions-row";function c(e,t){const{onPreview:s,onShowInFolder:n,onDownload:c,onForward:d,onMore:h,className:u}=e,_=(Object(a.a)(e,["onPreview","onShowInFolder","onDownload","onForward","onMore","className"]),Object(o.a)(l,u));return i.a.createElement("div",{ref:t,className:_},s&&i.a.createElement("div",{style:{marginRight:"5px",background:"white"}},i.a.createElement(r.a,{type:"tertiary",onClick:s,icon:"icon-outline-search",size:"small",className:`${l}__icon`,modifier:"outline"})),n&&i.a.createElement("div",{style:{marginRight:"5px",background:"white"}},i.a.createElement(r.a,{type:"tertiary",onClick:n,icon:"icon-outline-folder",size:"small",className:`${l}__icon`,modifier:"outline"})),c&&i.a.createElement("div",{style:{marginRight:"5px",background:"white"}},i.a.createElement(r.a,{type:"tertiary",onClick:c,icon:"icon-solid-download",size:"small",className:`${l}__icon`,modifier:"outline"})),d&&i.a.createElement("div",{style:{marginRight:"5px",background:"white"}},i.a.createElement(r.a,{type:"tertiary",onClick:d,icon:"icon-outline-share",size:"small",className:`${l}__icon`,modifier:"outline"})),h&&i.a.createElement("div",{style:{background:"white"}},i.a.createElement(r.a,{type:"tertiary",onClick:h,icon:"icon-solid-more",size:"small",className:`${l}__icon`,modifier:"outline"})))}const d=i.a.memo(i.a.forwardRef(c));t.a=d},"1iR4":function(e,t,s){"use strict";s.d(t,"b",(function(){return p})),s.d(t,"a",(function(){return g}));var a=s("NDmK"),n=s("z0WU"),i=s("PoHQ");class o{constructor({qosId:e,settingOnKey:t}){this._qosId=e,this._settingOnKey=t,this._trackParamsPolling=[],this.__offpollinglatestAction=!1,this.__numberOverFlow=0,this.__lastOverFlow=Date.now(),this._actionIds=[],this.getLastActionIdsArray=this.getLastActionIdsArray.bind(this),this.reset=this.reset.bind(this),this.rollbackTo=this.rollbackTo.bind(this),this.onOverflowQueue=this.onOverflowQueue.bind(this)}rollbackTo(e){this._latestActionId=e,this._actionIds=[],this._trackParamsPolling=[]}getLatestActionId(e,t=0){return this._latestActionId=this._latestActionId||t,this._latestActionId=Math.max(+this._latestActionId,+e),this._latestActionId+""}onOverflowQueue(e){if(!e||isNaN(e))return;this.__numberOverFlow++;let t=Math.abs(Date.now()-this.__lastOverFlow);this.__lastOverFlow=Date.now(),i.default.triggerEvent(i.INTERNAL_CHANNEL_QOS_LOG,[{successs:!1,commandId:e,subCommandId:0,duration:t,errorCode:this.__numberOverFlow,startTime:Date.now()}])}reset(){this._actionIds=[],this.__offpollinglatestAction=!1}getLastActionIdsArray(e){if(!this.onPollingWithLatestActionId())return[];e=+e,this._actionIds=this._actionIds||[];let t=[...this._actionIds];for(;t.length&&+t[0]>e;)t.shift();return t.reverse()}getLastActionIds(e){e=+e,this._actionIds=this._actionIds||[];let t=[...this._actionIds];for(;t.length&&+t[0]>e;)t.shift();return t.length>1&&this.onPollingWithLatestActionId()?`${e},${t.length},${t.reverse().join(",")}`:`${e}`}_addLastActionIds(e){if(e&&e.length){if(this._actionIds=this._actionIds||[],this._actionIds.push.apply(this._actionIds,e),this._actionIds.sort(((e,t)=>+t-+e)),this._actionIds.length>=2){let e=this._actionIds;this._actionIds=[e[0]];let t=e[0];for(let s=1;s<e.length;s++)e[s]!=t&&(this._actionIds.push(e[s]),t=e[s])}this._actionIds.length>10&&(this._actionIds=this._actionIds.slice(0,10))}}addLastActionIds(e,t,s,a=null,o="[PollingMsg]",r){if(e&&e.length){let o=0;null!=r?o=r:e.forEach((e=>{+e<t&&o++})),o&&(i.default.triggerEvent(i.INTERNAL_CHANNEL_QOS_LOG,[{successs:!1,commandId:a||this._qosId,subCommandId:0,duration:Date.now()-s,errorCode:o,startTime:Date.now()}]),n.default.stagingLog("[polling][resp] has missing data "+o)),this._addLastActionIds(e)}}onPollingWithLatestActionId(){return this._settingOnKey&&a.c[this._settingOnKey]&&!this.__offpollinglatestAction}addHasRespPolling(e){if(this._trackParamsPolling=this._trackParamsPolling||[],this.__offpollinglatestAction)this.__offpollinglatestAction++,this.__offpollinglatestAction>=20&&(this.__offpollinglatestAction=0);else{let t=0;for(let s=0;s<this._trackParamsPolling.length;s++)this._trackParamsPolling[s]===e&&t++;t>=3&&(this.__offpollinglatestAction=1,i.default.triggerEvent(i.INTERNAL_CHANNEL_QOS_LOG,[{successs:!1,commandId:this._qosId,subCommandId:0,duration:0,errorCode:-1,startTime:Date.now()}]),n.default.logCoreInfo(`[polling] loop detected ${e} ${JSON.stringify(this._trackParamsPolling)}`))}for(this._trackParamsPolling.push(e);this._trackParamsPolling.length>10;)this._trackParamsPolling.shift()}}var r=s("NzUN"),l=s("Erqw"),c=s("Ydol"),d=s("97kL"),h=s("ZcVI"),u=s("ISTE");class _{constructor(e){this.CONFIG=e,this.devLog=()=>{},this.pollSaveLocalId=new n.LocalId,this.saveActionIdData=new r.a(1e3),this.pollId={},this.lastActionId=1,this.lastActionIdOther=1,this.last_success_resp={counter:0,status:{},lastActionId:0,lastActionIdOther:0},this.__lastResetId=0,this.isWarning=!1,this.__avoidLoop=this.__avoidLoop.bind(this),this.__verifyLoop=this.__verifyLoop.bind(this),this.__triggerOverflow=this.__triggerOverflow.bind(this),this.saveData=this.saveData.bind(this),this.mergeBatch=this.mergeBatch.bind(this),this.resetId=this.resetId.bind(this),this.__waitId=new Set,this.__waitCounter={},this.__maxDoneId=0}removeWaitId(){this.__waitId&&(n.default.stagingLog("[ChatSocket] remove waiting on swap "+[...this.__waitId].join(","),!0),this.__waitId=new Set)}_int(e){return e&&!isNaN(+e)?+e:1}create(e,t=1){this.pollId[e]={control:new o({qosId:this.CONFIG.qosId,settingOnKey:this.CONFIG.settingOnKey}),lastId:t}}getDataToSave(){let e={lastActionId:this.lastActionId,lastActionIdOther:this.lastActionIdOther,multi:{}};for(let t in this.pollId){let s=this.pollId[t];s&&s.lastId&&!isNaN(s.lastId)&&(e.multi[t]=s.lastId)}return e}resetId(e){if(n.default.logCoreInfo(`[Polling][${this.CONFIG.type}][mulQueueId] reset to ${e}`),!isNaN(e)){e=+e,this.storeActionId&&this.storageId&&this.storeActionIdOther&&(this.storeActionId.set(e),this.storeActionIdOther.delete(),this.storageId.delete()),this.lastActionId=e,this.lastActionIdOther=1,this.last_success_resp={counter:0,status:{},lastActionId:0,lastActionIdOther:0};for(let t in this.pollId)this.pollId[t]&&this.pollId[t].control&&(this.pollId[t].control.rollbackTo(e),this.pollId[t].lastId=e);this.__lastResetId=this.pollSaveLocalId.next(),this.devLog(`[reset] in mem done ${this.__lastResetId}`)}}__markWaitId(e){this.__checkReset(),this.devLog(`[new_id] __markWaitId ${e}`),this.__waitId.add(e)}__removeId(e){this.__maxDoneId=Math.max(this.__maxDoneId,e),delete this.__waitCounter[e],this.__waitId.delete(e)}__checkReset(){if(this.__waitId.size>0){let e=Math.min(...Array.from(this.__waitId));if(this.__maxDoneId>e&&this.__maxDoneId-e>a.c.polling_conf.reset_max_diff){0,n.default.logCoreInfo(`Bug happend reset all for continue using ${this.__waitId.size}`);for(let e of this.__waitId)this.__removeId(e);n.default.logCoreInfo(`Bug happend save max done id ${this.__maxDoneId} ${this.__waitId.size}`),this._saveData(this.__maxDoneId)}}}addCounter(e,t){e&&this.__waitId.has(e)&&!isNaN(t)?this.__waitCounter[e]?this.devLog(`[new_id] addCounter 2 times ${e} ${this.__waitCounter[e]} ${t}`):(this.devLog(`[new_id] addCounter ${e} ${t}`),this.__waitCounter[e]=t):this.devLog(`[new_id] addCounter but not valid [${e}] [${t}]`)}mergeBatch(e,t){e&&t&&this.__waitId.has(e)&&(this.__waitId.has(t)?(this.devLog(`[new_id] [mergeBatch] delete wait ${e} cause merge to next ${t}`),this.__removeId(e)):this.devLog(`[new_id] [mergeBatch] something wrong ${e} => ${t}`))}saveData(e,t=!1){if(this.devLog("[new_id] saveData id",e,this.__waitCounter[e]?this.__waitCounter[e]:1),this.__waitCounter[e]&&this.__waitCounter[e]>1)this.__waitCounter[e]--;else if(!i.default.getWaitRestart()){if(a.c.polling_conf.force_save_curr_id||!this.CONFIG.enableWaitSaveId)return this.__removeId(e),void this._saveData(e,t);if(this.__waitId.has(e)){this.devLog(`[new_id] delete ${e} remain ${Array.from(this.__waitId).join(",")}`);let s=Math.min(...Array.from(this.__waitId));if(this.__removeId(e),s==e)if(0==this.__waitId.size){let s=Math.max(e,this.__maxDoneId);this._saveData(s,t)}else this._saveData(e,t);else this.__checkReset(),n.default.stagingLog(`[ChatSocket] id > minid ${e} > ${s}`,!0)}else this.devLog(`[new_id] something wrong not wait this id ${e}`)}}_saveData(e,t=!1){if(this.devLog("[new_id] _saveData id",e),!i.default.getWaitRestart())if(this.__lastResetId&&e<this.__lastResetId)n.default.logCoreInfo("[poll] ignore trigger before reset");else if(e){let s=this.saveActionIdData.peek(e);s&&s.lastActionId&&s.lastActionIdOther&&s.multi&&(this.storeActionId.set(s.lastActionId),this.storeActionIdOther.set(s.lastActionIdOther),this.storageId.setObject(s.multi),!t&&this.CONFIG.syncIds&&setTimeout((()=>{this.CONFIG.syncIds(s.multi)}),0)),this.devLog("[new_id] saveData id ",e)}else this.devLog("[new_id] saveData id",e,"not have data")}init(e){this.storageId=new u.a(this.CONFIG.KEY_MSG+e),this.storeActionId=new u.a(this.CONFIG.KEY_ACTION+e,{defaultInt:1}),this.storeActionIdOther=new u.a(this.CONFIG.KEY_ACTION_OTHER+e,{defaultInt:1}),this.lastActionId=this.storeActionId.getInt(),this.lastActionIdOther=this.storeActionId.getInt();let t=this.storageId.getObject();if(t)for(let a in t){if(!a||!t.hasOwnProperty(a))continue;let e=this._int(t[a]);this.create(a,e)}else if(this.CONFIG.getLastIdsFromOther)try{n.default.logCoreInfo("[multiqueue] sync queuId on init"),this.CONFIG.getLastIdsFromOther()}catch(s){n.default.logCoreError("[multiqueue] got error on sync ids init",s)}for(let a of this.CONFIG.queueIds)this.pollId[a]||this.lastActionId&&this.create(a,this.lastActionId)}_makeTestOver(e){if(null==window.onMakeMiss&&(window.onMakeMiss=!1),window.makeMiss=window.makeMiss||0,window.onMakeMiss&&window.makeMiss%4==0){let t=Math.floor(3*Math.random())+1;for(let s in e){if(e[s]&&e[s].ids&&10==e[s].ids.length){let a=Math.floor(3*Math.random())+1;for(;a--;){let a=Math.floor(e[s].ids.length*Math.random());a>0&&a<e[s].ids.length-1&&(this.devLog("make miss ",e[s].ids[a]),e[s].ids.splice(a,1),window.makeMiss++,t--)}}if(t<=0)break}}else window.makeMiss++}getIdsForParam(){let e={};for(let t in this.pollId){let s=this.pollId[t];e[t]={lastId:s.lastId+"",ids:s.control.getLastActionIdsArray(s.lastId).slice(0,10)}}return e}getLastActionIds(){let e=this.getIdsForParam();return this.devLog(e),`${this.lastActionId},${this.lastActionIdOther},`+encodeURIComponent(btoa(JSON.stringify(e))+",1")}getLastActionIdsForSocket(e){const t={lastId:1,preIds:[]};return this.pollId.hasOwnProperty(e)?{lastId:this.pollId[e].lastId,preIds:this.pollId[e].control.getLastActionIdsArray(this.pollId[e].lastId).slice(0,10)}:t}swapMsgSrc(e){n.default.logCoreInfo("[ChatSocket] prepare multiqueue to new src "+e),this.removeWaitId(),this.resetControlIds()}__avoidLoop(){this.devLog("__avoidLoop"),this.isWarning=!0,this.resetControlIds()}resetControlIds(){for(let e in this.pollId)this.pollId[e]&&this.pollId[e].control&&this.pollId[e].control.reset()}__verifyLoop(e,t,s){if(!e)return;let{status:a,lastActionId:n,lastActionIdOther:i}=this.last_success_resp,o=!1;if(t==n&&s==i){o=!0;let t=Object.keys(a);if(a&&e&&t.length==Object.keys(e).length){for(let s of t)if(!a[s]||!e[s]||a[s]!=e[s].lastId){o=!1;break}}else o=!1}if(this.devLog("__verifyLoop",o,this.last_success_resp.counter),o)this.last_success_resp.counter++,this.last_success_resp.counter>=3&&this.__avoidLoop();else{this.last_success_resp.counter=0,this.last_success_resp.lastActionId=t,this.last_success_resp.lastActionIdOther=s,this.last_success_resp.status={};for(let t in e)e[t]&&e[t].lastId&&(this.last_success_resp.status[t]=e[t].lastId)}}__triggerOverflow(e){try{this.CONFIG&&"CTRL"===this.CONFIG.type&&4==e?(n.default.logCoreInfo(`[poll] onOverflowQueue ${e} ${Date.now()}`),l.a.setCtrlOverflow(Date.now())):this.CONFIG&&("MSG"===this.CONFIG.type||"SOCK_MSG"===this.CONFIG.type)&&this.CONFIG.MSG_QUEUES&&this.CONFIG.MSG_QUEUES.some((t=>e==t))&&(n.default.logCoreInfo(`[poll] onOverflowQueue ${e} ${Date.now()}`),c.default.send(d.FetchActions.CHECK_OVERFLOW_QUEUE_BY_FLAG,{queueId:e}),i.default.triggerEvent(i.INTERNAL_CHANNEL_QOS_LOG,[{commandId:91027,subCommandId:0,duration:this.end-this.start,params:[this.count],errorCode:2,startTime:this.start}]))}catch(t){n.default.logCoreError(`[poll] onOverflowQueue  error ${e}`)}}addLastActionIds(e,t,{lastActionId:s,lastActionIdOther:a},i,o=!1){this.devLog("queueStatus",e);let r=this.pollSaveLocalId.next();if(this.isWarning=!1,o||this.__verifyLoop(e,s,a),s&&!isNaN(s)&&(this.lastActionId=Math.max(this.lastActionId,+s)),a&&!isNaN(a)&&(this.lastActionIdOther=Math.max(this.lastActionIdOther,+a)),e)for(let c in e)if(c&&e.hasOwnProperty(c)){let s=e[c];if(!s||!s.lastId||isNaN(+s.lastId))continue;this.pollId[c]||(n.default.logCoreInfo(`[Polling] add more queue ${c} ${s.lastId} ${this.CONFIG.type}`),this.create(c,1));let a=this.pollId[c],r=+a.lastId;if(a.lastId=Math.max(+s.lastId,r),!o){let e=this.CONFIG.QOS_CMD.MISS,n=this.CONFIG.QOS_CMD.OVERFLOW;if(c){let t=c;"string"==typeof t&&t.includes("_")&&(t=t.replace("_",""),t=t.slice(-3)),isNaN(t)||(e+=+t,n+=+t)}s&&1==s.evict&&(a.control.onOverflowQueue(n),this.__triggerOverflow(c)),a.control.addLastActionIds(s.ids,r,t,e,`${null!=i?"[ChatSocket]":"[Polling]"}[${this.CONFIG.type}]`,i)}}let l=this.getDataToSave();return this.devLog("saveActionIdData, ",r,l),this.saveActionIdData.set(r,l),this.__markWaitId(r),r}}const m=new _({type:"MSG",qosId:91021,queueIds:[1,2,3],enableWaitSaveId:!0,settingOnKey:"enablePollingLastAction",MSG_QUEUES:[1,6],QOS_CMD:{MISS:92e3,OVERFLOW:93e3},syncIds:e=>{if(!a.c.socket.sync_id_from_lp||!e)return;const t=a.c.socket.queue_actionid_map||{},s={};let n=!1;for(let a in e)for(let o in t){var i;if(t[o]==a)null!=e[a]&&(null===(i=p.pollId[o])||void 0===i?void 0:i.lastId)!=e[a]&&(n=!0,s[o]={lastId:e[a]})}if(n){const e=p.addLastActionIds(s,null,{},null,!0);p.saveData(e,!0)}},KEY_MSG:h.z+"_",KEY_ACTION:h.y+"_",KEY_ACTION_OTHER:h.A+"_"}),p=new _({type:"SOCK_MSG",qosId:97107,queueIds:["510_0","511_0"],enableWaitSaveId:!0,MSG_QUEUES:["510_0","511_0"],QOS_CMD:{MISS:92e3,OVERFLOW:93e3},getLastIdsFromOther:()=>{if(!a.c.socket.init_lastid_lp)return;const e=m.getDataToSave();e&&e.multi&&m.CONFIG.syncIds&&(n.default.logCoreInfo("[ChatSocket] sync last id on init",e.multi),m.CONFIG.syncIds(e.multi))},syncIds:e=>{if(!a.c.socket.sync_id_to_lp||!e)return;const t={};let s=!1;for(let i in e)if(a.c.socket.queue_actionid_map&&a.c.socket.queue_actionid_map.hasOwnProperty(i)){const o=a.c.socket.queue_actionid_map[i];var n;if(null!=o)null!=e[i]&&(null===(n=m.pollId[o])||void 0===n?void 0:n.lastId)!=e[i]&&(t[o]={lastId:e[i]},s=!0)}if(s){const e=m.addLastActionIds(t,null,{},null,!0);m.saveData(e,!0)}},KEY_MSG:h.J+"_",KEY_ACTION:h.H+"_",KEY_ACTION_OTHER:h.I+"_"}),g=new _({type:"CTRL",qosId:91036,queueIds:[4,5],enableWaitSaveId:!1,settingOnKey:"enablePollingLastActionCtrl",QOS_CMD:{MISS:94e3,OVERFLOW:95e3},KEY_MSG:h.w+"_",KEY_ACTION:h.v+"_",KEY_ACTION_OTHER:h.x+"_"});t.c=m},"1jfs":function(e,t,s){"use strict";s.d(t,"d",(function(){return ae})),s.d(t,"b",(function(){return ne})),s.d(t,"a",(function(){return ie})),s.d(t,"c",(function(){return oe}));const a="Image",n="SELECT_CONVERSATION";var i=s("z0WU");class o{constructor({channel:e,data:t}){this.channel=e,(e=>!(!e||"object"!=typeof e||"[object Array]"===Object.prototype.toString.call(e)))(t)?this.data=t:(this.data={},((e,t)=>{i.default.logCoreError("Create event emit model with unexpected type!",`channel: ${e}, data: ${t}`)})(e,t))}}const r=new class{constructor(){this._storageEvents={}}on(e,t){if(!this._storageEvents)return;const s=e=>{try{t(e)}catch(s){i.default.logCoreError("EventEmitter"+s)}};this._storageEvents.hasOwnProperty(e)?this._storageEvents[e].push(s):this._storageEvents[e]=[s]}emit(e){if(!this._storageEvents)return;const{channel:t,data:s}=e;if(this._storageEvents.hasOwnProperty(t)){var a;((null===(a=this._storageEvents[t])||void 0===a?void 0:a.constructor)===Array?this._storageEvents[t]:[]).forEach((e=>{try{e(s)}catch(t){i.default.logCoreError("Emit fn has failed",t)}}))}}};var l=class{constructor(e){var t;this.type=null!=(t=null==e?void 0:e.type)?t:"",this._isInit=!1}initialize(){this._isInit=!0}handleInternalEvents(){}handleExternalEvents(){}addOrUpdate(e,t){}getMediaToAdd(e,t){if(t){let s=-1;return(e||[]).find(((e,a)=>{if((null==e?void 0:e.msgId)===t)return s=a,!0})),s>0?e.slice(s+1):e}return e}delete(e,t){}get isInit(){return this._isInit}},c=s("VTBJ"),d=s("YqGK");var h=class{constructor({toModule:e,payload:t,needResp:s,id:a,priority:n}){this.toModule=e,this.payload=t,this.needResp=s,this.id=a,this.priority=n}get Payload(){return this.payload}get Id(){return this.id}get Priority(){return this.priority}},u=s("Eio/");var _=new class{constructor(){}sendRequest(e,t){const s=new h({payload:e.payload});u.a.receiveEvent(s)}},m=s("pRs7");var p=class{constructor({action:e,data:t,sentTime:s}){this.action=e,this.data=t,this.sentTime=s}},g=s("22X3");var E=class{constructor(e){this.controllerName=e,this.logger=new g.a(this.controllerName),this._transship=this._transship.bind(this)}sendDataAdd(e){const t=new p({action:m.b.ADD,data:e});this._transship(t)}sendDataAddMulti(e){const t=new p({action:m.b.ADD_MULTI,data:e});this._transship(t)}sendDataUpdate(e){const t=new p({action:m.b.UPDATE,data:e});this._transship(t)}sendDataUpdateMulti(e){const t=new p({action:m.b.UPDATE_MULTI,data:e});this._transship(t)}sendDataDelete(e){const t=new p({action:m.b.DELETE,data:e});this._transship(t)}sendDataDeleteMulti(e){const t=new p({action:m.b.DELETE_MULTI,data:e});this._transship(t)}_transship(e,t=!1){const s={type:this.controllerName,fragment:e};this._sendToUI(null,s,t)}_sendToUI(e,t,s,a){const n={needResp:s,payload:t};null!=e&&(n.id=e),_.sendRequest(n)}},f=s("q4pX"),I=s("+it+");var T=class{constructor(e){if(this.viewModel={},this.dataSending=e&&e.dataSending||new E,this.ctrlName=e&&e.controllerName||"need set!",e)if(e.viewModel)this.viewModel=e.viewModel;else{const t={data:e.data,keyName:e.keyName,name:e.viewModelName};this.viewModel=new d.c(t)}this.logger=new g.a(e&&e.logPrefix||this.ctrlName),this.logInfoDev=()=>{}}add(e,t){I.a.isNum(e)&&t&&this.viewModel.Instance===d.a&&(this.viewModel.addItem(e,t),this.dataSending.sendDataAdd({index:e,item:t}))}addMulti(e,t){I.a.isNum(e)&&I.a.isArray(t)&&this.viewModel.Instance===d.a&&(this.viewModel.addItems(e,t),this.dataSending.sendDataAddMulti({index:e,items:t}))}update(e,t){I.a.isNum(e)&&t&&this.viewModel.Instance===d.a&&(this.viewModel.updateItemAt(e,t),this.dataSending.sendDataUpdate({index:e,item:t}))}updateMulti(e,t){if(I.a.isNum(e)&&I.a.isArray(t)&&this.viewModel.Instance===d.a){for(let s=0;s<t.length;s++)this.viewModel.updateItemAt(e,t[s]);this.dataSending.sendDataUpdateMulti({index:e,items:t})}}delete(e){I.a.isNum(e)&&this.viewModel.Instance===d.a&&(this.viewModel.removeItemsAt(e,1),this.dataSending.sendDataDelete({index:e}))}deleteMulti(e,t=1){I.a.isNum(e)&&I.a.isNum(t)&&this.viewModel.Instance===d.a&&(this.viewModel.removeItemsAt(e,t),this.dataSending.sendDataDeleteMulti({index:e,count:t}))}modifyViewModel(e={},t){if(e.intersections=[],Object(f.a)(e,this.viewModel,t),e.type!==m.d.NO_ACTION){const t=Date.now();this.logger.info("Send data change",t),this.dataSending.sendModify(e,t)}}get ViewModel(){return this.viewModel}getViewModel(){return this.viewModel}},v=s("+Wh9");var R=class{constructor(e){this._cache=new v.a(e)}reset(){this._cache.clear()}getMessages(e){return this._cache.get(e)}setMessages(e,t){this._cache.set(e,t)}hasConversation(e){return this._cache.has(e)}deleteConversation(e){this._cache.delete(e)}deleteMsg(e,t){if(null==t)return void this._findAndDeleteMsg(e);if(!this.hasConversation(t))return;const s=this.getMessages(t),a=(s||[]).length;for(let n=0;n<a;n++){if(s[n].msgId===e)return s.splice(n,1),void this.setMessages(t,s)}}_findAndDeleteMsg(e){const t=this._cache.keys();let s=t.next(),a=!1;for(;!s.done&&!a;){const n=s.value,i=this._cache.get(n),o=(i||[]).length;for(let t=0;t<o;t++)if(i[t].msgId===e){a=!0,i.splice(t,1);break}s=t.next()}}},S=s("1pet");function O(e){return!(e&&(e.member||e.date&&(e.date.start||e.date.end)||e.name||e.ext))}function N(e,t){if(O(t))return!0;if(!t.member||e.fromUid&&e.fromUid===t.member){let a,n,o;if(t.name){if(e.message&&e.message.params&&e.message.href)try{let t=JSON.parse(e.message.params);a=t.mediaTitle?i.default.simpleStripVietnamese(t.mediaTitle):i.default.simpleStripVietnamese(e.message.title),n=t.src}catch(s){return!1}o=i.default.simpleStripVietnamese(t.name)}if(!t.name||i.default.searchContent(a,o)||i.default.searchContent(n,o)){let s=!1;if(t.ext&&(s=S.fileExt[t.ext].some((t=>e.message&&e.message.title&&e.message.title.endsWith(t)))),!t.ext||s)return!t.date.start||!t.date.end||t.date.end<e.sendDttm&&e.sendDttm<t.date.start+864e5}}return!1}var b=s("vaZ4");function C(e=[],t=[],s={},a="itemId"){let n=[],i=[],o=[],r=[];const l={};e.forEach((e=>{const t=e[`${a}`];l[t]={classificationValue:1}})),t.forEach(((e,t)=>{const s=e[`${a}`],n={values:e,index:t};let i=l.hasOwnProperty(s)?2:3;l[s]={classificationValue:i,item:n}}));for(const u in l){const e=l[u];e&&(1===e.classificationValue?i.push(u):3===e.classificationValue?n.push(e.item):s&&s.hasOwnProperty(u)?o.push(e.item):r.push(e.item))}var c,d,h;return{additions:n,removals:i,updates:o,intersections:r,type:(d=i,h=o,0===(c=n).length&&0===d.length&&0===h.length?m.d.NO_ACTION:c.length>0&&0===d.length&&0===h.length?m.d.ADD:d.length>0&&0===c.length&&0===h.length?m.d.DELETE:h.length>0&&0===c.length&&0===d.length?m.d.UPDATE:m.d.MIXED)}}var A=s("2Atq");function y(e){return e&&e.itemId}function D(e){return e&&e.data&&e.data.dataUI}const M={notifyToList:!1,isPlayAnimation:!1,needReRender:!1,shouldNotify:!1};var P=class extends T{constructor(e,t,s,a){super(e),this._cache=new R(s||10),this._limitMsg=a||1/0,this._isInit=!1,this._mediaType=t||"",this._currentConversationId="",this._messages=[],this._filter=null,this.deletedMediaId={},this.initialize=this.initialize.bind(this),this.selectConversation=this.selectConversation.bind(this),this.setMediaStoreType(this._mediaType),r.on(n,this.selectConversation)}initialize(){const e=Date.now();this._isInit=!0,this.dataSending.init(e),this.logger.info("Init",e)}reset(){this._isInit=!1,this.freeMemory(this.currentConversation),this._setCurrentConversation("")}setMediaStoreType(e){switch(e){case A.g.IMAGE:return void(this._mediaStoreType=A.f.IMAGE);case A.g.FILE:return void(this._mediaStoreType=A.f.FILE);case A.g.LINK:return void(this._mediaStoreType=A.f.LINK);default:return void(this._mediaStoreType="Not set!")}}selectConversation(e){const t=e.newId;null!=t&&this.currentConversation!==t&&(this.logger.info("selectConversation",`OLD: ${e.oldId} ::: NEW: ${t}`),this._changeConversation(t))}freeMemory(e,t={}){if(e!==this.currentConversation)return;const{clearCache:s=!0,clearViewModel:a=!0,clearMessages:n=!0,clearFilter:i=!0}=t;s&&this._cache.reset(),n&&this._resetMessages(),a&&this._clearViewModel(),i&&this._resetFilter()}_changeConversation(e){this._setCurrentConversation(e),this.freeMemory(e)}_initData(e){this._setMessages(e),this._clearViewModel();const t=this._createThread(e);this.__makeEmptyThreadIfPossible(t),this.logger.info("initData",`messages: ${e.length} ::: thread: ${t.length}`),this.viewModel.addTop(t,M);const s=Date.now();this.dataSending.recharge(t,s)}_clearViewModel(){this.viewModel.clear(),this.dataSending.reset(Date.now())}receiveLoadMedia(e,t,s){const a=O(s)?null:s;e===this.currentConversation&&(function(e,t){if(null==e&&null==t)return!1;if(e&&null==t)return!0;if(null==e&&t)return!0;if(e.date&&t.date){if(e.date.start!==t.date.start)return!0;if(e.date.end!==t.date.end)return!0;if(e.date.type!==t.date.type)return!0}else if(e.date!=t.date)return!0;return e.ext!=t.ext||e.member!=t.member||e.name!=t.name}(this.filter,a)&&(this.logger.info("receiveLoadMedia: Changed filter"),this.logger.info("receiveLoadMedia changed filter",this.filter,a),this._setFilter(a),this._resetMessages(),this._clearViewModel()),this.addOrUpdate(t))}addOrUpdate(e){if(!I.a.isArray(e))return;if(!this.isInit)return;const t=e.reduce(((e,t)=>{var s;const a=null!=(s=t.userId)?s:t.toUid;return a?(e.hasOwnProperty(a)?e[a].push(t):e[a]=[t],e):e}),{});let s=[];Object.keys(t).forEach((e=>{e===this.currentConversation&&(s=t[e]),this._updateCache(e,t[e])})),this._hasFilter&&(s=function(e,t){if(O(t))return I.a.isArray(e)?e:[e];if(I.a.isArray(e)){const s=[];for(let a=0;a<e.length;a++){const n=e[a];N(n,t)&&s.push(n)}return s}return N(e,t)?[e]:[]}(s,this.filter)),0===this.messages.length?this._initData(s):this._processAddOrUpdate(s)}_processAddOrUpdate(e){const t=this.__categoryAdditionAndUpdateMsg(e),{additions:s,updates:a}=t,n={};a.length>0&&(this.__updateMsg(a),a.forEach((e=>{const t=this._getItemId(e.msgId);n[t]=!0})));let i=this.messages;s.length>0&&(i=i.concat(s),i=Object(b.d)(i),this._setMessages(i)),this._detectChangeAndUpdateViewModel(i,n)}delete(e){I.a.isArray(e)&&this.isInit&&(this.logger.info("delete",e),this._processDelete(e))}_processDelete(e){Object(b.a)(this.messages,(t=>e.includes(t.msgId))),this._detectChangeAndUpdateViewModel(this.messages)}_detectChangeAndUpdateViewModel(e,t={}){const s=this._createThread(e);this.__makeEmptyThreadIfPossible(s);const a=this.viewModel.getData(),n=function(e,t){const s={};if(!Array.isArray(e)||!Array.isArray(t))return s;const a={};return e.forEach((e=>{const t=y(e);(function(e){return e&&e.data&&e.data.type})(e)===A.e.ITEM&&(a[t]=D(e))})),t.forEach((e=>{const t=y(e),n=a[t];n&&function(e,t){return e.isFirst!==t.isFirst||e.isLast!==t.isLast}(n,D(e))&&(s[t]=!0)})),s}(a,s),i=C(a,s,t=Object.assign(t,n)),o={needReRender:!1,isPlayAnimation:!1,notifyToList:!1,shouldNotify:!1},r={delete:o,update:o,addition:Object(c.a)(Object(c.a)({},o),{},{enableAddMulti:!0})};super.modifyViewModel(i,r)}loadMedia(e,t,s,a){a||(a={filter:this.filter,inFullMode:!0}),this._getMedia(e,t,s,a).then((e=>{this.__handleGetMediaSuccess(e)})).catch(this.__handleGetMediaFailure)}__handleGetMediaSuccess(e){I.a.isArray(e)&&(this.logger.info("handleGetMediaSuccess",`messages: ${e.length}`),this.addOrUpdate(e))}__handleGetMediaFailure(e){this.logger.error("Get images failed",e)}_setToCache(e,t){I.a.isArray(t)&&(this._cache.hasConversation(e)?this._updateCache(e,t):this._cache.setMessages(e,t.slice(0,this._limitMsg)))}_updateCache(e,t){if(!I.a.isArray(t))return;if(!this._cache.hasConversation(e))return;let s=this._cache.getMessages(e)||[];if(0===s.length)this._cache.setMessages(e,t.slice(0,this._limitMsg));else{const e={};t.forEach((t=>{e[t.msgId]=t})),s.forEach(((t,a)=>{const n=t.msgId;e.hasOwnProperty(n)&&(s[a]=e[n],delete e[n])}));const a=Object.keys(e);a&&a.length>0&&a.forEach((t=>{s.push(e[t])})),s=Object(b.d)(s)}s.length>this._limitMsg&&(s=s.slice(0,this._limitMsg),this._cache.setMessages(e,s))}_getMessagesInCache(e){return this._cache.getMessages(e)||[]}_hasConversationInCache(e){return this._cache.hasConversation(e)}_deleteConversationInCache(e){this._cache.deleteConversation(e)}_deleteMsgInCache(e,t){this._cache.deleteMsg(e,t)}__categoryAdditionAndUpdateMsg(e){const t={};e.forEach((e=>{t[e.msgId]=!0}));const s=C(this.messages,e,t,"msgId"),{additions:a,updates:n}=s,i=n.reduce(((e,t)=>(e.push(t.values),e)),[]);return{additions:a.reduce(((e,t)=>(e.push(t.values),e)),[]),updates:i}}_resetMessages(){this._messages=[]}_resetFilter(){this._filter=null}__updateMsg(e=[]){const t={};e.forEach((e=>{t[e.msgId]=e}));const s=this.messages.slice(),a=s.length;for(let n=0;n<a;n++){const e=s[n];e&&t.hasOwnProperty(e.msgId)&&(s[n]=t[e.msgId])}this._setMessages(s)}__makeEmptyThreadIfPossible(e){if(0===e.length)if(this._hasFilter){const t=this._getFilterEmpty();e.push(t)}else{const t=this._getEmpty();e.push(t)}}_setMessages(e){this._messages=e}get messages(){return this._messages}_setCurrentConversation(e){this._currentConversationId=e}get currentConversation(){return this._currentConversationId}get isInit(){return this._isInit}_getMedia(e,t,s=A.c,a={}){}getData(){return this.viewModel.getData()}_setFilter(e){null!=e?(this._filter={date:null,ext:null,member:null,name:null},e.date&&(this._filter.date=Object(c.a)({},e.date)),e.ext&&(this._filter.ext=e.ext),e.member&&(this._filter.member=e.member),e.name&&(this._filter.name=e.name)):this._filter=null}get filter(){return this._filter}get _hasFilter(){return!O(this._filter)}_createThread(){throw Error("Expected implement!")}_getItemId(){throw Error("Expected implement!")}_getFilterEmpty(){return null}_getEmpty(){return null}},w=s("3+UV");var L=class extends E{constructor(e){super(m.a.MEDIA),this.subType=e}init(e){const t=new p({action:m.c.INIT,data:[],sentTime:e});this._transship(t)}reset(e){const t=new p({action:m.c.RESET,data:[],sentTime:e});this._transship(t)}recharge(e,t){const s=new p({action:m.c.RECHARGE,data:e,sentTime:t});this._transship(s)}sendModify(e,t){const s=new p({action:m.c.MODIFY,data:e,sentTime:t});this._transship(s)}_transship(e,t=!1){const s={type:this.controllerName,subType:this.subType,fragment:e};super._sendToUI(null,s,t)}},k=s("P6UB"),x=s("V0G9"),U=s("DPHK");function F(e,t){return x.a.conform(A.e.DATE,{ts:e,config:t})}function G(e,t={},s){return x.a.conform(A.e.ITEM,e,t,s)}var B=new class extends P{constructor(){super({viewModel:new w.a({keyName:"itemId",name:"MediaImageViewModel"}),dataSending:new L(A.g.IMAGE),logPrefix:"[MediaImageController]",controllerName:"MediaImageController"},A.g.IMAGE,10,50)}initData(e){}_processAddOrUpdate(e){const t=Object(b.c)(e,this.viewModel.getData()),s=C(this._messages,e,{},"msgId"),{additions:a,updates:n}=s,i=n.reduce(((e,t)=>(e.push(t.values),e)),[]);this.__updateMsg(i);const o=a.reduce(((e,t)=>(e.push(t.values),e)),[]);let r=this._messages;o.length>0&&(r=this._messages.concat(o),r=Object(b.d)(r),this._setMessages(r)),this._detectChangeAndUpdateViewModel(r,t)}_processDelete(e){const t={},s={};let a=0;if(this._messages.forEach((t=>{e.includes(t.msgId)&&(s[t.msgId]=t,a++)})),0===a)return;Object.keys(s).forEach((e=>{const a=this.__getItemIdPrefixOfMsg(s[e]);t[a]=!0}));Object(b.a)(this._messages,(e=>s.hasOwnProperty(e.msgId)));const n=Object.keys(t),i=this.viewModel.getData(),o={};i.forEach((e=>{if(e.type===A.e.ITEM){const t=e.itemId;for(let e=0;e<n.length;e++)t.includes(n[e])&&(o[t]=!0)}})),this._detectChangeAndUpdateViewModel(this._messages,o)}__handleGetMediaSuccess(e){this.addOrUpdate(e)}__handleGetMediaFailure(e){this.logger.error("Get images failed",e)}__updateMsg(e=[]){const t={};e.forEach((e=>{t[e.msgId]=e}));const s=this._messages.length;for(let a=0;a<s;a++){const e=this._messages[a];e&&t.hasOwnProperty(e.msgId)&&(this._messages[a]=t[e.msgId])}}__getItemIdPrefixOfMsg(e){const t=e.sendDttm;return Object(b.b)(t)}_createThread(e){return function(e,t){const s=[],a=k.b.groupMessageByDate(e);let n=(new Date).getFullYear().toString(),i={date:{type:"DDDD/MMMM"}};for(let o=0;o<a.length;o++){const e=a[o],r=U.a.getDateYears(e.ts);n!==r&&(i={date:{type:"DDDD/MMMM,YYYY"}});const l=F(e.ts,i);s.push(l);const c=e.items||[];let d=[],h=1;const u=null!=t?t:A.a;for(let t=0;t<c.length;t++){const e=c[t];if(d.length<u&&d.push(e),d.length===u||t===c.length-1){const e={isFirst:t===u-1,isLast:t===c.length-1},a=G(d.slice(),e,h);s.push(a),d=[],h++}}n=r}return s}(e,3)}_getFilterEmpty(){return x.a.conform(A.e.FILTER_EMPTY)}_getEmpty(){return x.a.conform(A.e.EMPTY)}};var H=new class extends l{constructor(){super(a)}initialize(){super.initialize(),B.initialize()}freeMemory(e){B.freeMemory(e)}addOrUpdate(e,t,s,a){const n=this.getMediaToAdd(t,s);B.receiveLoadMedia(e,n,a)}delete(e,t){B.delete(t)}};var j=s("jlg7");class V{static conform(e,t,s={},a,n){switch(e){case A.e.DATE:{const e=V.makeIdForDate(t.ts)||"local_"+n;return{itemId:A.d.DATE+e,type:A.e.DATE,data:{config:t.config,ts:t.ts}}}case A.e.ITEM:{const e=t&&t.msgId||"local_"+n;return{itemId:V.getItemId(e),type:A.e.ITEM,data:t,dataUI:s}}case A.e.PREV_YEAR:{const e=t.year||(new Date).getFullYear();return{itemId:A.d.PREV_YEAR+e,type:A.e.PREV_YEAR,data:{year:t.year||(new Date).getFullYear()}}}case A.e.FILTER_EMPTY:return{itemId:A.d.FILTER_EMPTY,type:A.e.FILTER_EMPTY};case A.e.EMPTY:return{itemId:A.d.EMPTY,type:A.e.EMPTY};default:return{}}}static makeIdForDate(e){return`${Object(b.b)(e)}`}static getItemId(e){return A.d.ITEM+e}}var K=V;function W(e,t){return K.conform(A.e.DATE,{ts:e,config:t})}function Y(e,t={},s){return K.conform(A.e.ITEM,e,t,s)}var z=new class extends P{constructor(){super({viewModel:new j.a({keyName:"itemId",name:"MediaFileViewModel"}),dataSending:new L(A.g.FILE),logPrefix:"[MediaFileController]",controllerName:"MediaFileController"},A.g.FILE,10,A.b)}_createThread(e){return function(e){const t=[],s=k.b.groupMessageByDate(e);let a=(new Date).getFullYear().toString(),n={date:{type:"DDDD/MMMM"}};for(let i=0;i<s.length;i++){const e=s[i],o=U.a.getDateYears(e.ts);a!==o&&(n={date:{type:"DDDD/MMMM,YYYY"}});const r=W(e.ts,n);t.push(r);const l=e.items;for(let s=0;s<l.length;s++){const e=l[s];if(!e)continue;const a=Y(e);t.push(a)}a=o}return t}(e)}_getItemId(e){return K.getItemId(e)}_getFilterEmpty(){return K.conform(A.e.FILTER_EMPTY)}_getEmpty(){return K.conform(A.e.EMPTY)}};var q=new class extends l{constructor(){super()}initialize(){super.initialize(),z.initialize()}freeMemory(e){z.freeMemory(e)}addOrUpdate(e,t,s,a){const n=this.getMediaToAdd(t,s);z.receiveLoadMedia(e,n,a)}delete(e,t){z.delete(t)}},X=s("mKjT");class J{static conform(e,t,s={},a,n){switch(e){case A.e.DATE:{const e=J.makeIdForDate(t.ts)||"local_"+n;return{itemId:A.d.DATE+e,type:A.e.DATE,data:{config:t.config,ts:t.ts}}}case A.e.ITEM:{const e=t&&t.msgId||"local_"+n;return{itemId:J.getItemId(e),type:A.e.ITEM,data:t,dataUI:s}}case A.e.PREV_YEAR:{const e=t.year||(new Date).getFullYear();return{itemId:A.d.PREV_YEAR+e,type:A.e.PREV_YEAR,data:{year:t.year||(new Date).getFullYear()}}}case A.e.FILTER_EMPTY:return{itemId:A.d.FILTER_EMPTY,type:A.e.FILTER_EMPTY};case A.e.EMPTY:return{itemId:A.d.EMPTY,type:A.e.EMPTY};default:return{}}}static makeIdForDate(e){return`${Object(b.b)(e)}`}static getItemId(e){return A.d.ITEM+e}}var Q=J;function $(e,t){return Q.conform(A.e.DATE,{ts:e,config:t})}function Z(e,t={},s){return Q.conform(A.e.ITEM,e,t,s)}var ee=new class extends P{constructor(){super({viewModel:new X.a({keyName:"itemId",name:"MediaLinkViewModel"}),dataSending:new L(A.g.LINK),logPrefix:"[MediaLinkController]",controllerName:"MediaLinkController"},A.g.LINK,10,A.b)}_createThread(e){return function(e){const t=[],s=k.b.groupMessageByDate(e);let a=(new Date).getFullYear().toString(),n={date:{type:"DDDD/MMMM"}};for(let i=0;i<s.length;i++){const e=s[i],o=U.a.getDateYears(e.ts);a!==o&&(n={date:{type:"DDDD/MMMM,YYYY"}});const r=$(e.ts,n);t.push(r);const l=e.items;for(let s=0;s<l.length;s++){const e=l[s];if(!e)continue;const a=Z(e);t.push(a)}a=o}return t}(e)}_getItemId(e){return Q.getItemId(e)}_getFilterEmpty(){return Q.conform(A.e.FILTER_EMPTY)}_getEmpty(){return Q.conform(A.e.EMPTY)}};var te=new class extends l{constructor(){super()}initialize(){super.initialize(),ee.initialize()}freeMemory(e){ee.freeMemory(e)}addOrUpdate(e,t,s,a){const n=this.getMediaToAdd(t,s);ee.receiveLoadMedia(e,n,a)}delete(e,t){ee.delete(t)}},se=s("ZdEB");function ae(e,t,s,a,n){if(Object(se.d)())switch(e){case"images":return void(H&&(H.isInit||H.initialize(),H.addOrUpdate(t,s,a,n)));case"files":return void(q&&(q.isInit||q.initialize(),q.addOrUpdate(t,s,a,n)));case"links":return void(te&&(te.isInit||te.initialize(),te.addOrUpdate(t,s,a,n)));default:return}}function ne(e,t,s){if(Object(se.d)())switch(e){case"images":return void(H&&H.delete(t,s));case"files":return void(q&&q.delete(t,s));case"links":return void(te&&te.delete(t,s));default:return}}function ie(e,t){if(!Object(se.d)())return;const s=new o({channel:n,data:{oldId:e,newId:t}});r.emit(s)}function oe(e,t){if(Object(se.d)())switch(e){case"images":return void(H&&H.freeMemory(t));case"files":return void(q&&q.freeMemory(t));case"links":return void(te&&te.freeMemory(t));default:return}}},"1l4j":function(e,t,s){"use strict";var a=s("NDmK"),n=s("Mlp7");var i=class{constructor(e={gaptime:0}){this._getGap=()=>0,this._taskQueue=[],this._running=!1}pushTask(e){return new Promise(((t,s)=>{this._taskQueue.push({task:e,resolve:t,reject:s}),this._run()}))}addTopTask(e){this._taskQueue.unshift(e),this._run()}_processConfig(e){if(typeof e.gaptime==Number){let t=e.gaptime;this._getGap=()=>t}else typeof e.gaptime==Function&&(this._getGap=e.gaptime)}_onTaskDone(){let e=this._getGap();setTimeout((()=>{this._running=!1,this._run()}),e)}_run(){if(this._running||!this._taskQueue.length)return;let e=this._taskQueue.shift();e.task().then((t=>{this._onTaskDone(),e.resolve(t)})).catch((t=>{this._onTaskDone(),e.reject(t)}))}},o=s("rePB");let r,l,c;let d;!function(e){let t;!function(e){let t,s;var a;!function(e){e[e.ASC=1]="ASC",e[e.DES=-1]="DES"}(t||(t={})),e.Order=t,e.create=function(e){return(s,a)=>{for(let n=0;n<e.length;n++){const i=e[n],o=i.comparer(s[i.key],a[i.key]);if(0!==o)return i.order===t.DES?o*i.order:o}return 0}},(a=s||(s=e.Comparer||(e.Comparer={}))).bool=function(e,t){if(e||t){if(!e)return 1;if(!t)return-1}return 0},a.number=function(e,t){return e>t?1:e<t?-1:0}}(t||(t=e.Sorter||(e.Sorter={}))),e.asyncForEach=async function(e,t){for(let s=0;s<e.length;s++)await t(e[s],s,e)},e.asyncFilter=async function(e,t){let s=[];for(let a=0;a<e.length;a++)await t(e[a],a,e)&&s.push(e[a]);return s},e.asyncMap=async function(e,t){let s=[];for(let a=0;a<e.length;a++)s.push(await t(e[a],a,e));return s}}(r||(r={})),function(e){e.delay=function(e=0){return new Promise((t=>{setTimeout(t,e)}))};e.Container=class{constructor(){Object(o.a)(this,"resolve",(()=>{})),Object(o.a)(this,"reject",(()=>{})),Object(o.a)(this,"promise",void 0),Object(o.a)(this,"value",void 0),this.promise=new Promise(((e,t)=>{this.resolve=t=>{this.value=t,e(t)},this.reject=t}))}}}(l||(l={})),(c||(c={})).getNumberOfDays=function(e,t){const s=new Date(e),a=new Date(t).getTime()-s.getTime();return Math.round(a/864e5)},(d||(d={})).map=function(e,t){return Object.keys(e).reduce((function(s,a){return s[a]=t(a,e[a]),s}),{})};const h=["image","file","link"],u=100;function _(e,t,s={}){return t?{ok:!1,info:e,error:t}:{ok:!0,info:e,value:s}}var m=class{constructor(){let e={gaptime:0};e.gaptime=this._getGaptime.bind(this),this._taskScheduler=new i(e);let t={gaptime:0};t.gaptime=this._getGaptime.bind(this),this._delConvTaskScheduler=new i(t)}_getGaptime(){return a.c.media_settings.delete_gap}_groupMediaByType(e){let t={image:[],file:[],link:[],unknown:[]};return e&&e.length&&e.forEach((e=>{e&&h.indexOf(e.mediaType)>=0?t[e.mediaType].push(e):t.unknown.push(e)})),t}_chunkMedia(e){let t=a.c.media_settings.chunk_size,s=0,n=[];for(;e.length-s>0;){let a=Math.min(t,e.length-s);n.push(e.slice(s,s+a)),s+=a}return n}_deleteMedia(e,t){return this._taskScheduler.pushTask((()=>new Promise(((s,a)=>{n.a.deleteMediaItem(e,t).then(s).catch(a)}))))}_deleteMediaInConv(e,t){return this._delConvTaskScheduler.pushTask((()=>new Promise(((s,a)=>{n.a.deleteMediaItem(e,t).then(s).catch(a)}))))}async _runDeleteMedia(e,t,s){let a=!0,i=!0,o=s;for(;a;)try{const[s,r]=await n.a.getLastMediaFromConversation(e,t,u,o);if(!s||!s.length){i=!r;break}{let e=s.map((e=>e.msgId));if(await this._deleteMediaInConv(e,t),await new Promise((e=>setTimeout(e,100))),o===e[e.length-1]){i=!0;break}o=e[e.length-1],a=s.length===u}}catch(r){i=!1;break}return i&&n.a.setLastDeleteConv(e,t,null,null),i}async _deleteMediaInConversation(e,t,s){const[a,i]=await n.a.getLastMediaFromConversation(e,t,u,s);let o=null;if(a&&a.length){o=a[0];let s=a.map((e=>e.msgId)),i=s[0],r=a[0].sendDttm;if(n.a.setLastDeleteConv(e,t,i,r),await this._deleteMediaInConv(s,t),a.length===u){let a=s[s.length-1];this._runDeleteMedia(e,t,a)}else n.a.setLastDeleteConv(e,t,null,null)}return o}async onDeleteMediaInConversation(e){const{convId:t,lastId:s}=e;return _(e,null,{lastFile:await this._deleteMediaInConversation(t,"file",s),lastImage:await this._deleteMediaInConversation(t,"image",s),lastLink:await this._deleteMediaInConversation(t,"link",s)})}delete(e,t){return new Promise(((s,a)=>e&&e.msgId?-1===h.indexOf(t)?s(_(e,null)):void this._deleteMedia([e.msgId],t).then((()=>s(_(e,null)))).catch((t=>s(_(e,t)))):s(_(e,{error_message:"invalid param"}))))}deleteMulti(e){return new Promise(((t,s)=>{let a=this._groupMediaByType(e),n=a.unknown,i=[],o=0,r=0;n.length&&n.forEach((e=>{i.push(_(e,null))}));const l=(e,s)=>{let a=e.map((e=>_(e,s)));if(i.push(...a),r++,r===o)return t(i)};if(h.forEach((e=>{let t=this._chunkMedia(a[e]);o+=t.length,t.length&&t.forEach((t=>{let s=t.map((e=>e.msgId));this._deleteMedia(s,e).then((()=>{l(t,null)})).catch((e=>{l(t,e)}))}))})),!o)return t(i)}))}async resumeDelete(){let e=n.a.getAllDeleteConv();if(e)for(let t in e)await r.asyncForEach(h,(async s=>{if(e[t]&&e[t][s])try{let{lastId:a}=e[t][s];await this._runDeleteMedia(t,s,a)}catch(a){}}))}};var p=s("1pet");const g=new class{constructor(){this.deleteMediaManager=new m,this._resumeDeleteConversation(),this.deleteConvTimer={}}_resumeDeleteConversation(){setTimeout((()=>{this.deleteMediaManager.resumeDelete()}),3e5)}isSupportCloudConv(e){return a.c.media_settings.media_cloud&&e.startsWith(p.GROUPID_PREFIX)||e===a.c.sendToMeId}handleDeleteMedia(e,t){return this.deleteMediaManager.delete(e,t)}handleDeleteMediaMulti(e){return this.deleteMediaManager.deleteMulti(e)}runCleanUpMedia(e){let t=e.conversationId,s=e.msgId,i=e.sendDttm||Date.now();if(this.deleteConvTimer[t]){const e=this.deleteConvTimer[t].msgId;if(e.length>s.length||e.length==s.length&&e>s)return;clearTimeout(this.deleteConvTimer[t].timer),this.deleteConvTimer[t].timer=null}n.a.setLastDeleteConv(t,"file",s,i),n.a.setLastDeleteConv(t,"image",s,i),n.a.setLastDeleteConv(t,"link",s,i),this.deleteConvTimer[t]={timer:setTimeout((()=>{this.deleteMediaManager.onDeleteMediaInConversation({convId:t,msgId:s})}),a.c.media_settings.clean_up_timeout),msgId:s}}};t.a=g},"1oG5":function(e,t,s){"use strict";var a=s("wx14"),n=s("Ff2n"),i=s("q1tI"),o=s.n(i),r=s("17x9"),l=s.n(r),c=s("iuhU");const d="file-layout";function h(e,t){const{thumb:s,top:i,bot:r,className:l}=e,h=Object(n.a)(e,["thumb","top","bot","className"]);return o.a.createElement("div",Object(a.a)({ref:t,className:Object(c.a)(d,l)},h),o.a.createElement("div",{className:"file-layout__thumb-container"},s),o.a.createElement("div",{className:"file-layout__right-container"},o.a.createElement("div",{className:"file-layout__top-container"},i),o.a.createElement("div",{className:"file-layout__bot-container"},r)))}const u=o.a.memo(o.a.forwardRef(h));u.propTypes={thumb:l.a.node,top:l.a.node,bot:l.a.node},t.a=u},"1pet":function(e,t,s){"use strict";s.r(t),s.d(t,"MSG_SEEN",(function(){return a})),s.d(t,"MSG_DELIVERED",(function(){return n})),s.d(t,"MSG_LOCAL",(function(){return i})),s.d(t,"MSG_SENT",(function(){return o})),s.d(t,"MSG_CHECKING_EXIST",(function(){return r})),s.d(t,"MSG_FORWARDING",(function(){return l})),s.d(t,"MSG_FILE_EXPIRED",(function(){return c})),s.d(t,"MSG_UPLOAD_LOCAL",(function(){return d})),s.d(t,"MSG_FAIL",(function(){return h})),s.d(t,"MSG_CANCEL",(function(){return u})),s.d(t,"MSG_READ",(function(){return _})),s.d(t,"MSG_INFO",(function(){return m})),s.d(t,"MSG_GROUP_NOTI",(function(){return p})),s.d(t,"MSG_ERROR_INFO",(function(){return g})),s.d(t,"MSG_AFTER_READ",(function(){return E})),s.d(t,"MSG_ARTICLE",(function(){return f})),s.d(t,"MSG_TEXT",(function(){return I})),s.d(t,"MSG_STICKER",(function(){return T})),s.d(t,"MSG_STICKER_2",(function(){return v})),s.d(t,"MSG_FILE",(function(){return R})),s.d(t,"MSG_PHOTO",(function(){return S})),s.d(t,"MSG_PHOTO_2",(function(){return O})),s.d(t,"MSG_VOICE",(function(){return N})),s.d(t,"MSG_DOODLE",(function(){return b})),s.d(t,"MSG_GIF",(function(){return C})),s.d(t,"MSG_CONTACT",(function(){return A})),s.d(t,"MSG_VIDEO",(function(){return y})),s.d(t,"MSG_LOCATION",(function(){return D})),s.d(t,"MSG_UNDO",(function(){return M})),s.d(t,"MSG_OA",(function(){return P})),s.d(t,"MSG_ECARD",(function(){return w})),s.d(t,"MSG_POLL",(function(){return L})),s.d(t,"MSG_INFO_CHAT",(function(){return k})),s.d(t,"MSG_DEL_EVERYONE",(function(){return x})),s.d(t,"MSG_VANISH",(function(){return U})),s.d(t,"MSG_UNKNOWN",(function(){return F})),s.d(t,"MSG_PHOTO_GROUP",(function(){return G})),s.d(t,"MSG_STICKER_GROUP",(function(){return B})),s.d(t,"MSG_FRIEND_SENT_REQUEST",(function(){return H})),s.d(t,"MSG_SUGGEST_IN_CHAT",(function(){return j})),s.d(t,"MSG_TODO",(function(){return V})),s.d(t,"MSG_TODO_DONE",(function(){return K})),s.d(t,"MSG_PHOTO_THUMB_DONE",(function(){return W})),s.d(t,"MSG_FOLDER",(function(){return Y})),s.d(t,"MSG_SUBTYPE_FILE_EEXC",(function(){return z})),s.d(t,"MSG_LINK_CLIENT",(function(){return q})),s.d(t,"MSG_SUBTYPE_PHOTO",(function(){return X})),s.d(t,"MSG_SUBTYPE_GIF",(function(){return J})),s.d(t,"MSG_SUBTYPE_LINK",(function(){return Q})),s.d(t,"MSG_SUBTYPE_MEDIA_VIDEO",(function(){return $})),s.d(t,"DEST_TYPING",(function(){return Z})),s.d(t,"FILE_FTYPE",(function(){return ee})),s.d(t,"FILE_FTYPE_TYPE",(function(){return te})),s.d(t,"FILE_UP_SRC",(function(){return se})),s.d(t,"FILE_READER",(function(){return ae})),s.d(t,"NET_ERRORS",(function(){return ne})),s.d(t,"MSG_FOLDER_STATE",(function(){return ie})),s.d(t,"MSG_SRC",(function(){return oe})),s.d(t,"MSG_PREVIEW_SRC",(function(){return re})),s.d(t,"LOGIN_PAGE",(function(){return le})),s.d(t,"APP_PAGE",(function(){return ce})),s.d(t,"AUTH_PAGE",(function(){return de})),s.d(t,"GROUPID_PREFIX",(function(){return he})),s.d(t,"OA_ID_PREFIX",(function(){return ue})),s.d(t,"INITIAL_LOCAL_MSG_ID_PREFIX",(function(){return _e})),s.d(t,"SEARCH_FRIENDS",(function(){return me})),s.d(t,"SEARCH_GROUPS",(function(){return pe})),s.d(t,"SEARCH_CLOSEFRIENDS",(function(){return ge})),s.d(t,"SEARCH_MESSAGES",(function(){return Ee})),s.d(t,"SEARCH_CONTACTS",(function(){return fe})),s.d(t,"SEARCH_ALL",(function(){return Ie})),s.d(t,"K_LEFT",(function(){return Te})),s.d(t,"K_UP",(function(){return ve})),s.d(t,"K_RIGHT",(function(){return Re})),s.d(t,"K_DOWN",(function(){return Se})),s.d(t,"K_ENTER",(function(){return Oe})),s.d(t,"K_ESC",(function(){return Ne})),s.d(t,"K_SPACE",(function(){return be})),s.d(t,"K_F1",(function(){return Ce})),s.d(t,"K_F2",(function(){return Ae})),s.d(t,"K_F3",(function(){return ye})),s.d(t,"K_F4",(function(){return De})),s.d(t,"K_TAB",(function(){return Me})),s.d(t,"K_L",(function(){return Pe})),s.d(t,"K_F",(function(){return we})),s.d(t,"K_N",(function(){return Le})),s.d(t,"K_T",(function(){return ke})),s.d(t,"K_B",(function(){return xe})),s.d(t,"K_I",(function(){return Ue})),s.d(t,"K_1",(function(){return Fe})),s.d(t,"K_2",(function(){return Ge})),s.d(t,"K_3",(function(){return Be})),s.d(t,"K_DEL",(function(){return He})),s.d(t,"K_PAGEUP",(function(){return je})),s.d(t,"K_PAGEDOWN",(function(){return Ve})),s.d(t,"K_HOME",(function(){return Ke})),s.d(t,"K_END",(function(){return We})),s.d(t,"K_SHIFT",(function(){return Ye})),s.d(t,"K_CTRL",(function(){return ze})),s.d(t,"K_ALT",(function(){return qe})),s.d(t,"K_CMD_LEFT",(function(){return Xe})),s.d(t,"K_CMD_RIGHT",(function(){return Je})),s.d(t,"K_CAPLOCK",(function(){return Qe})),s.d(t,"Alt",(function(){return $e})),s.d(t,"CmdOrCtrl",(function(){return Ze})),s.d(t,"Ctrl",(function(){return et})),s.d(t,"HOTKEY_FOCUS",(function(){return tt})),s.d(t,"HOTKEY_FUNC",(function(){return st})),s.d(t,"K_BACK_SPACE",(function(){return at})),s.d(t,"K_COLON",(function(){return nt})),s.d(t,"K_DASH",(function(){return it})),s.d(t,"K_PERIOD",(function(){return ot})),s.d(t,"SET_MUTE",(function(){return rt})),s.d(t,"UNSET_MUTE",(function(){return lt})),s.d(t,"ALREADY_BLOCK_ERROR_CODE",(function(){return ct})),s.d(t,"SET_BLOCK",(function(){return dt})),s.d(t,"UNSET_BLOCK",(function(){return ht})),s.d(t,"FRIEND_TYPE_NORMAL",(function(){return ut})),s.d(t,"FRIEND_TYPE_OA",(function(){return _t})),s.d(t,"STORAGE_VERSION",(function(){return mt})),s.d(t,"STORAGE_VERSION_KEY",(function(){return pt})),s.d(t,"CLI_MSG_TYPE_TEXT",(function(){return gt})),s.d(t,"CLI_MSG_TYPE_VOICE",(function(){return Et})),s.d(t,"CLI_MSG_TYPE_PHOTO",(function(){return ft})),s.d(t,"CLI_MSG_TYPE_STICKER",(function(){return It})),s.d(t,"CLI_MSG_TYPE_DOODLE",(function(){return Tt})),s.d(t,"CLI_MSG_TYPE_CONTACT",(function(){return vt})),s.d(t,"CLI_MSG_TYPE_LINK",(function(){return Rt})),s.d(t,"CLI_MSG_TYPE_VIDEO",(function(){return St})),s.d(t,"CLI_MSG_TYPE_FILE",(function(){return Ot})),s.d(t,"CLI_MSG_TYPE_GIF",(function(){return Nt})),s.d(t,"CLI_MSG_TYPE_LOCATION",(function(){return bt})),s.d(t,"MSGTYPE_FORWARD_FILE",(function(){return Ct})),s.d(t,"MSGTYPE_FORWARD_PHOTO",(function(){return At})),s.d(t,"MSGTYPE_FORWARD_VOICE",(function(){return yt})),s.d(t,"MSGTYPE_FORWARD_GIF",(function(){return Dt})),s.d(t,"MSGTYPE_FORWARD_VIDEO",(function(){return Mt})),s.d(t,"MSGTYPE_FORWARD_CONTACT",(function(){return Pt})),s.d(t,"MSGTYPE_FORWARD_LOCATION",(function(){return wt})),s.d(t,"IMAGE_TYPE_PNG",(function(){return Lt})),s.d(t,"IMAGE_TYPE_JPEG",(function(){return kt})),s.d(t,"IMAGE_TYPE_GIF",(function(){return xt})),s.d(t,"LINK_TYPE_PDF",(function(){return Ut})),s.d(t,"LOGIN_TYPE_PASSWORD",(function(){return Ft})),s.d(t,"LOGIN_TYPE_QR",(function(){return Gt})),s.d(t,"LOGIN_TYPE_FB",(function(){return Bt})),s.d(t,"LANG_INDEX_VI",(function(){return Ht})),s.d(t,"LANG_INDEX_EN",(function(){return jt})),s.d(t,"FRIEND_REQUEST_TYPE_SUGGEST",(function(){return Vt})),s.d(t,"FRIEND_REQUEST_TYPE_REQUEST",(function(){return Kt})),s.d(t,"FRIEND_REQUEST_SRC_GLOBAL_PHONE",(function(){return Wt})),s.d(t,"FRIEND_REQUEST_SRC_GLOBAL_USERNAME",(function(){return Yt})),s.d(t,"FRIEND_REQUEST_SRC_FIND_FRIEND_FORM",(function(){return zt})),s.d(t,"FRIEND_REQUEST_SRC_CONTACT_LIST_SUGGESTION",(function(){return qt})),s.d(t,"FRIEND_REQUEST_SRC_GROUP_CHAT",(function(){return Xt})),s.d(t,"FRIEND_REQUEST_SRC_GROUP_LIST",(function(){return Jt})),s.d(t,"FRIEND_REQUEST_SRC_ECARD",(function(){return Qt})),s.d(t,"FRIEND_REQUEST_SRC_ZALO_ME_PHONE",(function(){return $t})),s.d(t,"FRIEND_REQUEST_SRC_ZALO_ME_USERNAME",(function(){return Zt})),s.d(t,"FRIEND_REQUEST_SRC_NEARBY",(function(){return es})),s.d(t,"FRIEND_REQUEST_SRC_FRIEND_RADAR",(function(){return ts})),s.d(t,"FRIEND_REQUEST_SRC_WIFI_FRIENDS",(function(){return ss})),s.d(t,"FRIEND_REQUEST_SRC_DATA_MINING",(function(){return as})),s.d(t,"FRIEND_REQUEST_SRC_ZING_ME",(function(){return ns})),s.d(t,"FRIEND_REQUEST_SRC_FACEBOOK",(function(){return is})),s.d(t,"FRIEND_REQUEST_SRC_GOOGLE",(function(){return os})),s.d(t,"FRIEND_REQUEST_SRC_PHONE_CONVERSATION",(function(){return rs})),s.d(t,"FRIEND_REQUEST_SRC_PHONE_FEED",(function(){return ls})),s.d(t,"FRIEND_REQUEST_SRC_CHAT",(function(){return cs})),s.d(t,"FRIEND_REQUEST_SRC_LAN",(function(){return ds})),s.d(t,"FRIEND_REQUEST_MINING",(function(){return hs})),s.d(t,"FRIEND_REQUEST_COUPLE",(function(){return us})),s.d(t,"FRIEND_REQUEST_GROUP_PENDING_REVIEW",(function(){return _s})),s.d(t,"CREATE_POLL_SRC_CHAT_BAR",(function(){return ms})),s.d(t,"CREATE_POLL_SRC_GROUP_BOARD",(function(){return ps})),s.d(t,"CREATE_POLL_SRC_GROUP_BOARD_PLUS",(function(){return gs})),s.d(t,"CREATE_POLL_SRC_MENTION",(function(){return Es})),s.d(t,"CREATE_POLL_SRC_MSGFOOTER",(function(){return fs})),s.d(t,"CREATE_POLL_SRC_UNKNOWN",(function(){return Is})),s.d(t,"CREATE_NOTICE_SRC_CHAT_BAR",(function(){return Ts})),s.d(t,"CREATE_NOTICE_SRC_GROUP_BOARD",(function(){return vs})),s.d(t,"CREATE_NOTICE_SRC_GROUP_BOARD_PLUS",(function(){return Rs})),s.d(t,"CREATE_NOTICE_SRC_MENTION",(function(){return Ss})),s.d(t,"CREATE_NOTICE_SRC_MSGINFO",(function(){return Os})),s.d(t,"CREATE_NOTICE_SRC_KEYWORD",(function(){return Ns})),s.d(t,"CREATE_NOTICE_SRC_UNKNOWN",(function(){return bs})),s.d(t,"EXTRA_BUTTON_REPLY",(function(){return Cs})),s.d(t,"EXTRA_BUTTON_REMIND",(function(){return As})),s.d(t,"EXTRA_BUTTON_PIN",(function(){return ys})),s.d(t,"EXTRA_BUTTON_ADD_FRIEND",(function(){return Ds})),s.d(t,"EXTRA_BUTTON_TODO",(function(){return Ms})),s.d(t,"EXTRA_BUTTON_CREATE_GROUP",(function(){return Ps})),s.d(t,"EXTRA_BUTTON_RECEIVE_TODO",(function(){return ws})),s.d(t,"EXTRA_BUTTON_SIMPLE_TEXT",(function(){return Ls})),s.d(t,"EXTRA_BUTTON_CREATE_PRODUCT_CATALOG",(function(){return ks})),s.d(t,"PARSE_FROM_KEYWORD",(function(){return xs})),s.d(t,"TEXT_TOPIC",(function(){return Us})),s.d(t,"LINK_TOPIC",(function(){return Fs})),s.d(t,"MSG_TOPIC",(function(){return Gs})),s.d(t,"POLL_TOPIC",(function(){return Bs})),s.d(t,"REMINDER_TOPIC",(function(){return Hs})),s.d(t,"POLL_INFO_CREATE",(function(){return js})),s.d(t,"POLL_INFO_SHARE",(function(){return Vs})),s.d(t,"POLL_INFO_JOIN",(function(){return Ks})),s.d(t,"POLL_INFO_CHANGE_OPTION",(function(){return Ws})),s.d(t,"FILE_TYPE_RECENT",(function(){return Ys})),s.d(t,"FILE_TYPE_PHOTO",(function(){return zs})),s.d(t,"FILE_TYPE_DOWNLOADED",(function(){return qs})),s.d(t,"FILE_TYPE_GOOGLE_DRIVE",(function(){return Xs})),s.d(t,"FILE_TYPE_DROPBOX",(function(){return Js})),s.d(t,"ACTIVE_TYPE_REGISTER",(function(){return Qs})),s.d(t,"ACTIVE_TYPE_LOGIN_FACEBOOK",(function(){return $s})),s.d(t,"ACTIVE_TYPE_LOGIN",(function(){return Zs})),s.d(t,"MSG_BUBBLE_LAYOUT_TYPE_SMALL",(function(){return ea})),s.d(t,"MSG_BUBBLE_LAYOUT_TYPE_NO_BORDER",(function(){return ta})),s.d(t,"CHAT_WIDTH_LIM",(function(){return sa})),s.d(t,"BANNER_ACTION_OPEN_URL",(function(){return aa})),s.d(t,"BANNER_ACTION_SEND_MSG",(function(){return na})),s.d(t,"BANNER_ACTION_CREATE_EMPTY_GROUP",(function(){return ia})),s.d(t,"BANNER_ACTION_SEND_ECARD_EVENT",(function(){return oa})),s.d(t,"BANNER_POS_TAB_MSG_HEADER",(function(){return ra})),s.d(t,"BANNER_POS_TAB_CONTACT_HEADER",(function(){return la})),s.d(t,"BANNER_POS_TAB_GROUP_HEADER",(function(){return ca})),s.d(t,"BANNER_POS_TAB_FILE_HEADER",(function(){return da})),s.d(t,"BANNER_POS_CSC_HEADER",(function(){return ha})),s.d(t,"BANNER_POS_EMPTY_SCREEN",(function(){return ua})),s.d(t,"SIDEBAR_TOP_AVATAR",(function(){return _a})),s.d(t,"SIDEBAR_LEFT_MENU",(function(){return ma})),s.d(t,"DEFAULT_AVATAR",(function(){return pa})),s.d(t,"OPTIONAL_UPDATE",(function(){return ga})),s.d(t,"REQUIRED_UPDATE",(function(){return Ea})),s.d(t,"CONVERSATION_ITEM_HEIGHT",(function(){return fa})),s.d(t,"CONTACT_ITEM_HEIGHT",(function(){return Ia})),s.d(t,"CONTACT_LABEL_HEIGHT",(function(){return Ta})),s.d(t,"NOTI_ITEM_HEIGHT",(function(){return va})),s.d(t,"SEARCH_ITEM_HEIGHT",(function(){return Ra})),s.d(t,"MSG_TEXT_CONTENT_ID_PREFIX",(function(){return Sa})),s.d(t,"GROUP_BOARD_ITEM_TYPE",(function(){return Oa})),s.d(t,"SYNC_MOBILE_MESSAGE",(function(){return Na})),s.d(t,"SYNC_DB_STATE",(function(){return ba})),s.d(t,"MAX_REF_LOAD_TOPIC",(function(){return Ca})),s.d(t,"GROUP_BOARD_REFRESH_TIMEOUT",(function(){return Aa})),s.d(t,"TIMEOUT_NEED_REQUEST_PROFILE_FR",(function(){return ya})),s.d(t,"TOPIC_ACTION_CREATE",(function(){return Da})),s.d(t,"TOPIC_ACTION_UPDATE",(function(){return Ma})),s.d(t,"TOPIC_ACTION_PIN",(function(){return Pa})),s.d(t,"CONV_OT_STATE",(function(){return wa})),s.d(t,"ON_FEATURE",(function(){return La})),s.d(t,"LAST_TIME_FETCH_ME_PREFIX",(function(){return ka})),s.d(t,"SUBMIT_LAN_DATA",(function(){return xa})),s.d(t,"RETRY_MSG_TIMEOUT_DEFAULT",(function(){return Ua})),s.d(t,"RETRY_MSG_TIMEOUT_LONG",(function(){return Fa})),s.d(t,"UP_TO_DATE",(function(){return Ga})),s.d(t,"OPTIONAL",(function(){return Ba})),s.d(t,"REQUIRED",(function(){return Ha})),s.d(t,"SILENT",(function(){return ja})),s.d(t,"UPDATE_UNKNOW_ERR_CODE",(function(){return Va})),s.d(t,"ERR_STOP_RETRY",(function(){return Ka})),s.d(t,"ERR_KICK_OUT",(function(){return Wa})),s.d(t,"ERR_SESSION_TIMEOUT",(function(){return Ya})),s.d(t,"ERR_SERVER_STOP",(function(){return za})),s.d(t,"USER_MODE",(function(){return qa})),s.d(t,"COMPOSE_SUGGEST",(function(){return Xa})),s.d(t,"FORWARD_ERR_CODE",(function(){return Ja})),s.d(t,"BUSY_IDLE_TIME",(function(){return Qa})),s.d(t,"REPEAT_NONE",(function(){return $a})),s.d(t,"REPEAT_ONCE",(function(){return Za})),s.d(t,"REPEAT_DAILY",(function(){return en})),s.d(t,"REPEAT_WEEKLY",(function(){return tn})),s.d(t,"REPEAT_MONTHLY",(function(){return sn})),s.d(t,"REPEAT_CUSTOM",(function(){return an})),s.d(t,"fileExt",(function(){return nn})),s.d(t,"RESIZE_THRESHOLD",(function(){return on})),s.d(t,"MAX_PDF_PREVIEW_SIZE",(function(){return rn})),s.d(t,"MAX_DOC_PPT_PREVIEW_SIZE",(function(){return ln})),s.d(t,"MAX_EXCEL_PREVIEW_SIZE",(function(){return cn})),s.d(t,"MAX_AUTO_DOWNLOAD_SIZE",(function(){return dn})),s.d(t,"MAX_FILE_PHOTO_GEN_TIME",(function(){return hn})),s.d(t,"LAN_ITEM_TYPE",(function(){return un})),s.d(t,"GREETING_SAMPLE_VI",(function(){return _n})),s.d(t,"GREETING_SAMPLE_EN",(function(){return mn})),s.d(t,"LAN_TYPE",(function(){return pn})),s.d(t,"MY_CONNECTION_TYPE",(function(){return gn})),s.d(t,"LAST_MESSAGE_ACTION",(function(){return En})),s.d(t,"WIN_SIZE_LV",(function(){return fn})),s.d(t,"LOCAL_CONVERSATION_TYPE",(function(){return In})),s.d(t,"COMPOSE_CONSTANT",(function(){return Tn})),s.d(t,"FAKE_CONVERSATION_ID",(function(){return vn})),s.d(t,"MAX_CHAR_SAY_HI",(function(){return Rn})),s.d(t,"INTERVAL_INFO",(function(){return Sn})),s.d(t,"LINK_THUMB_DEFAULT_SERVER",(function(){return On})),s.d(t,"PROMOTE_FRIEND_SUGGESTION_LIFETIME",(function(){return Nn})),s.d(t,"PROMOTE_FRIEND_SUGGESTION_MID_INTERVAL",(function(){return bn})),s.d(t,"PROMOTE_FRIEND_SUGGESTION_TINY_INTERVAL",(function(){return Cn})),s.d(t,"SHARE_FROM_MESSAGE",(function(){return An})),s.d(t,"SHARE_FROM_MESSAGE_QUICK_ACTION",(function(){return yn})),s.d(t,"SHARE_FROM_MESSAGE_GROUP_QUICK_ACTION",(function(){return Dn})),s.d(t,"SHARE_FROM_MESSAGE_RIGHT_ACTION",(function(){return Mn})),s.d(t,"SHARE_FROM_MESSAGE_MULTI_SELECTION",(function(){return Pn})),s.d(t,"SHARE_FROM_MEDIA_STORE",(function(){return wn})),s.d(t,"SHARE_FROM_MEDIA_STORE_SINGLE",(function(){return Ln})),s.d(t,"SHARE_FROM_MEDIA_STORE_MULTIPLE",(function(){return kn})),s.d(t,"SHARE_FROM_MEDIA_STORE_TAB_SINGLE",(function(){return xn})),s.d(t,"SHARE_FROM_MEDIA_STORE_TAB_MULTIPLE",(function(){return Un})),s.d(t,"SHARE_FROM_PHOTO_VIEW",(function(){return Fn})),s.d(t,"NOTIFICATION_TYPE",(function(){return Gn})),s.d(t,"RANDOM_STICKER",(function(){return Bn})),s.d(t,"VIEW_GROUP_PHOTO_SOURCE_CHAT",(function(){return Hn})),s.d(t,"VIEW_GROUP_PHOTO_SOURCE_MEDIA_STORE",(function(){return jn})),s.d(t,"DEFAULT_LOAD_STATE",(function(){return Vn})),s.d(t,"MENTION_ALL_ID",(function(){return Kn})),s.d(t,"MENTION_TYPE_USER",(function(){return Wn})),s.d(t,"MENTION_TYPE_ALL",(function(){return Yn})),s.d(t,"SGG_SRC_UNKNOWN",(function(){return zn})),s.d(t,"SGG_SRC_CHATBAR",(function(){return qn})),s.d(t,"SGG_SRC_SUGGESTION",(function(){return Xn})),s.d(t,"SGG_SRC_RIGHTMENU",(function(){return Jn})),s.d(t,"SGG_SRC_EVENT",(function(){return Qn})),s.d(t,"SGG_SRC_SEARCH_CHATBAR",(function(){return $n})),s.d(t,"SGG_SRC_SEARCH_RIGHTMENU",(function(){return Zn})),s.d(t,"SGG_SRC_SEARCH_INPUTBOX",(function(){return ei})),s.d(t,"SGG_SRC_BROADCAST",(function(){return ti})),s.d(t,"DEFAULT_SUGGEST_SSG_LEN",(function(){return si})),s.d(t,"DEFAULT_SUGGEST_ITEM",(function(){return ai})),s.d(t,"GLOBAL_SEARCH_MODE",(function(){return ni})),s.d(t,"CACHE_MANAGER",(function(){return ii})),s.d(t,"TODO_ROLE",(function(){return oi})),s.d(t,"TODO_TAB_INDEX",(function(){return ri})),s.d(t,"TODO_SECTION_INDEX",(function(){return li})),s.d(t,"TODO_SECTION_INDEX_V2",(function(){return ci})),s.d(t,"TODO_TYPE",(function(){return di})),s.d(t,"TODO_CONVERSATION_TYPE",(function(){return hi})),s.d(t,"USER_ROLE",(function(){return ui})),s.d(t,"CHAT_NOTIFICATION_TYPE",(function(){return _i})),s.d(t,"COLLAPSE_ONE_WEEK",(function(){return mi})),s.d(t,"COLLAPSE_TWO_WEEK",(function(){return pi})),s.d(t,"MAX_TODO_CONTENT",(function(){return gi})),s.d(t,"MAX_TODO_DESCRIPTION",(function(){return Ei})),s.d(t,"SIZE_MINI_CHAT_INFO",(function(){return fi})),s.d(t,"WIDTH_CHAT_INFO",(function(){return Ii})),s.d(t,"MIN_WIDTH_WINDOW_APP",(function(){return Ti})),s.d(t,"MSG_TYPE_MULTI_FW",(function(){return vi})),s.d(t,"REMINDER_SRC_CHATBAR",(function(){return Ri})),s.d(t,"REMINDER_SRC_FLOATMENU",(function(){return Si})),s.d(t,"REMINDER_SRC_CONTEXTMENU",(function(){return Oi})),s.d(t,"REMINDER_SRC_EMPTY_LIST",(function(){return Ni})),s.d(t,"REMINDER_SRC_LIST",(function(){return bi})),s.d(t,"REMINDER_SRC_MSG_SUGGESTION_HIGHLIGHT",(function(){return Ci})),s.d(t,"REMINDER_SRC_MSG_SUGGESTION_BUTTON",(function(){return Ai})),s.d(t,"CLEAR_UNREAD_TYPE",(function(){return yi})),s.d(t,"ECARD_TYPE",(function(){return Di})),s.d(t,"NOTIFICATION_TAB",(function(){return Mi})),s.d(t,"PROFILE_INIT_MODE",(function(){return Pi})),s.d(t,"GROUP_MEMBER_ERROR",(function(){return wi})),s.d(t,"GET_GROUP_INFO_ERROR",(function(){return Li})),s.d(t,"IMPORTANT_TAB_FILTER",(function(){return ki})),s.d(t,"OTHERS_TAB_FILTERS",(function(){return xi})),s.d(t,"SIZE_WINDOW",(function(){return Ui})),s.d(t,"MEMBERS_TRACKING_SOURCE",(function(){return Fi})),s.d(t,"INVITION_USER",(function(){return Gi})),s.d(t,"MULTI_GROUP_INTERACTION_SRC",(function(){return Bi})),s.d(t,"MUTUAL_GROUP_SRC",(function(){return Hi})),s.d(t,"STR_DATE_REPLACE",(function(){return ji})),s.d(t,"SEND_MSG_OBJECT_ERROR",(function(){return Vi})),s.d(t,"SCREEN_POPUP_HIDDEN_CHAT",(function(){return Ki})),s.d(t,"VERSION_ECARD_NEW_FR",(function(){return Wi})),s.d(t,"KEY_REMEMBER",(function(){return Yi})),s.d(t,"KEY_CONFIG_NEW_REMEMBER",(function(){return zi})),s.d(t,"KEY_CONFIG_OPTION_REMEMBER",(function(){return qi})),s.d(t,"KEY_SET_VALUE_ACTION_LOG",(function(){return Xi})),s.d(t,"OPTION_OLD_REMEMBER",(function(){return Ji})),s.d(t,"OPTION_SHOW_CHECKBOX",(function(){return Qi})),s.d(t,"OPTION_AUTO_REMEMBER",(function(){return $i})),s.d(t,"OPTION_DEFAULT_REMEMBER",(function(){return Zi})),s.d(t,"OPEN_BRACKET",(function(){return eo})),s.d(t,"CLOSE_BRACKET",(function(){return to})),s.d(t,"MAX_GROUP_NAME_LEN",(function(){return so})),s.d(t,"MAX_ALIAS_LEN",(function(){return ao})),s.d(t,"EVENT_STATUS",(function(){return no})),s.d(t,"MINI_NOTIFICATION_TYPE",(function(){return io})),s.d(t,"MINI_NOTIFICATION_SUBTYPE",(function(){return oo})),s.d(t,"TYPE_POPUP",(function(){return ro})),s.d(t,"MAX_POPUP_HEIGHT",(function(){return lo})),s.d(t,"MAX_POPOP_HEIGHT_NO_PADDING",(function(){return co})),s.d(t,"MAX_POPOP_HEIGHT_NO_PADDING_V0",(function(){return ho})),s.d(t,"MessageConstants",(function(){return uo})),s.d(t,"MULTI_PHOTO_SELECTED_TYPE",(function(){return _o})),s.d(t,"KEY_IPC_EDITOR_PHOTO",(function(){return mo})),s.d(t,"POLL_STATES",(function(){return po})),s.d(t,"STICKER_EXT",(function(){return go})),s.d(t,"STICKER_SOURCE",(function(){return Eo})),s.d(t,"URGENCY_MODE",(function(){return fo})),s.d(t,"AVATAR",(function(){return Io})),s.d(t,"PENDING_APPROVE_SHOW_TYPE",(function(){return To})),s.d(t,"STATUS_REPORT",(function(){return vo})),s.d(t,"SETTING_KEYS",(function(){return Ro})),s.d(t,"CHARACTER_LENGTH",(function(){return So})),s.d(t,"ONE_DAY_MS",(function(){return Oo})),s.d(t,"ONE_MIN_MS",(function(){return No})),s.d(t,"TokenTypes",(function(){return bo})),s.d(t,"MsgSources",(function(){return Co})),s.d(t,"COMPACT_LEVEL",(function(){return Ao})),s.d(t,"CONV_FILTER",(function(){return yo})),s.d(t,"FILTER_CONV_TEXT",(function(){return Do})),s.d(t,"ONE_HOUR_MS",(function(){return Mo})),s.d(t,"BUBBLE_MSG_ID",(function(){return Po})),s.d(t,"MESSAGE_ICON",(function(){return wo})),s.d(t,"PhotoViewer",(function(){return Lo})),s.d(t,"MODAL_CONFIRM",(function(){return ko})),s.d(t,"ModalIdentitiesDefine",(function(){return xo})),s.d(t,"PopoverIdentitiesDefine",(function(){return Uo})),s.d(t,"SRC_GET_PROFILE",(function(){return Fo})),s.d(t,"MediaType",(function(){return Go})),s.d(t,"MANUAL_UPDATE_STATUS",(function(){return Bo})),s.d(t,"CATALOG",(function(){return Ho})),s.d(t,"NetWorkError",(function(){return jo})),s.d(t,"CallMessageAction",(function(){return Vo}));const a=3,n=2,i=10,o=1,r=-20,l=-21,c=-22,d=-23,h=-2,u=-7,_=4,m=-4,p=-6,g=-5,E=5,f=0,I=1,T=4,v=13,R=19,S=2,O=11,N=3,b=5,C=7,A=6,y=18,D=17,M=20,P=21,w=25,L=26,k=-1909,x=-27,U=-28,F=-3,G=2503,B=2502,H=2504,j=2505,V=2506,K=2507,W=101,Y=23,z=24,q=1805,X=1,J=2,Q=3,$=2,Z={USER:3,PAGE:5},ee={FILE:1,FOLDER:2},te={FILE:{NORMAL:1,EEXC:2},FOLDER:{NORMAL:1,ALBUM:2}},se={NotSet:0,TextEditor:1},ae={NotSet:0,TextEditor:1},ne={NO_NETWORK:"net::ERR_INTERNET_DISCONNECTED"},ie={ZIPPING:120,UNZIPPING:121,DONE_ZIP:123},oe={UNKNOWN:-1,POLL:1,SYNC_MOBILE_MESSAGE:2,CLOUD:3,LOCAL:5,SYNC_MOBILE_DB:7,GET_PREVIEW:8,CLOUD_FIRST:9,SOCKET:10,MISS_MSG:11,CLOUD_LOADER:12,AUTO_LOADER:13},re={UNKNOWN:-1,MSG_CACHE:1,CONV_CACHE:2,CONV_ATTR:3},le="/login",ce="/",de="/",he="g",ue="o",_e=".",me=1,pe=2,ge=4,Ee=8,fe=7,Ie=15,Te=37,ve=38,Re=39,Se=40,Oe=13,Ne=27,be=32,Ce=112,Ae=113,ye=114,De=115,Me=9,Pe=76,we=70,Le=78,ke=84,xe=66,Ue=73,Fe=49,Ge=50,Be=51,He=46,je=33,Ve=34,Ke=36,We=35,Ye=16,ze=17,qe=18,Xe=91,Je=93,Qe=20,$e="Alt+",Ze="CmdOrCtrl+",et="Ctrl+",tt="HOTKEY_FOCUS",st="HOTKEY_FUNC",at=8,nt=186,it=189,ot=190,rt=1,lt=3,ct=215,dt=1,ht=2,ut=0,_t=5,mt="1.0.6",pt="zapp_version",gt=1,Et=31,ft=32,It=36,Tt=37,vt=38,Rt=40,St=44,Ot=46,Nt=49,bt=43,Ct=1,At=2,yt=3,Dt=4,Mt=5,Pt=6,wt=7,Lt=0,kt=1,xt=2,Ut=3,Ft="LOGIN_PASSWORD",Gt="LOGIN_QR",Bt="LOGIN_FB",Ht=0,jt=1,Vt=1,Kt=2,Wt=85,Yt=86,zt=40,qt=41,Xt=31,Jt=21,Qt=32,$t=91,Zt=92,es=80,ts=83,ss=84,as=90,ns=42,is=43,os=44,rs=93,ls=94,cs=30,ds=95,hs=96,us=342,_s=962,ms=1,ps=2,gs=3,Es=4,fs=5,Is=-1,Ts=1,vs=2,Rs=3,Ss=4,Os=5,Ns=6,bs=-1,Cs=1,As=2,ys=3,Ds=4,Ms=5,Ps=6,ws=7,Ls=8,ks=9,xs=1,Us=0,Fs=1,Gs=2,Bs=3,Hs=4,js=0,Vs=1,Ks=2,Ws=3,Ys="recent",zs="photo",qs="downloaded",Xs="googledrive",Js="dropbox",Qs=1,$s=2,Zs=3,ea=2,ta=3,sa=520,aa="open_url",na="forward_message",ia="create_empty_group",oa="send_ecard_event",ra="tabmsg.header",la="tabcontact.header",ca="tabgroup.header",da="tabfile.header",ha="csc.headerbar",ua="csc.emptyscreen",_a="sidebar.topavatar",ma="sidebar.leftmenu",pa="https://s120-ava-talk.zadn.vn/default",ga=1,Ea=2,fa=72,Ia=72,Ta=47,va=68,Ra=72,Sa="mtc-",Oa={ALL:0,GNOTICE_TOPIC:1,GNOTICE_MESSAGE:2,POLL:3,GSUGGESTION:4,DATE_TITLE:5,MORE:-1,LOADMORE:-2,BOTTOM_ALL:-3,BOTTOM_TOPIC:-4,BOTTOM_POLL:-5,BOTTOM_REMINDER:-6},Na={DONT_SYNC:-1,DONE:0,WAIT_CONFIRM:1,WAIT_MOBILE_CONFIRM:2,ERR:3,WAIT_FOR_DATA:4},ba={DONT_SYNC:-1,START:1,USR_CONFIRMED_PC:2,USR_CONFIRMED_MB:3,WAIT_FOR_DB:6,DL:7,PASSWORD:8,MERGE:9,MERGING:10,ABORT:11,ABORTED:12,DONE:14,ERR:15,RESUME_MERGE:16,RESUME:17,ERR_CODE:{ERR_DL:1,ERR_SEND_CONFRIM:2,ERR_TIMEOUT:3,ERR_NO_PERMISSION:4,ERR_TIMEOUT_DB:5,ERR_MERGE:8,ERR_PROCESS_DB_NOT_RESPONSE:9,ERR_CANT_GET_UIDS:10,ERR_ABORT:12,ERR_NO_PROCESS:13,ERR_INVALID_DB_INFO:14,ERR_INVALID_ENCRYPT_TYPE:15,ERR_GET_INFO:16,ERR_NO_CKEY:17,ERR_MB_RESTORE:18,ERR_MB_EXPORT_DB:19,ERR_DL_NO_NETWORK:20,ERR_NO_NETWORK:21,ERR_MERGE_STUCK:22,ERR_CLIENT_NOT_SUPPORT:23,ERR_DL_NOSPC:24,ERR_MERGE_NOSPC:25},ERR_MERGE_CODE:{NO_PATH:2,NO_UID:3,NO_UIN:4,ERR_DECRYPT:50,ERR_ENCRYPT:60,ERR_DE_CP:7,UNKNOWN:10,NO_MID:8,CHANGE_USERID:9},POPUPEnum:{NOTI:1,MOBILEGUIDE:2,CANCELNOTI:3,STOPNOTI:4,SYNC_ERR:5}},Ca=20,Aa=864e5,ya=18e4,Da=1,Ma=2,Pa=3,wa={none:0,needOut:1,newConv:2},La={imAddFr:!1,QUICK_EMOJI:!0,POPUP_QUICK_EMOJI:!1,CONTACT_LIST_SUGGEST:!0,FRIEND_CENTER_SETTING:!1,ENABLE_SUGGEST_FRIEND_SECTION_CONTACT_LIST:!1,ENABLE_FRIEND_REQUEST_SECTION_CONTACT_LIST:!1,DISABLE_ACTIVE_LAN_STATUS:!1,SIDEBAR_SCREENSHOT:!0,FRIEND_WP_VERSION_2:!0,COMMENT_TOOLS:!0,TODO_ACROSS_GROUP:!0,NEW_REMINDER_API:!0,ENABLE_SENDTOME_REMINDER:!0,ENABLE_THREADS_LIST:!1},ka="me_ts_",xa="__lstsbnet_",Ua=1,Fa=2,Ga=0,Ba=1,Ha=2,ja=3,Va=5091,Ka=-69,Wa=600,Ya=102,za=112,qa={AVAILABLE:0,AWAY:1,BUSY:2,INVISIBLE:3},Xa={DEFAULT:"DEFAULT",SEARCH_BY_NAME:"SEARCH_BY_NAME"},Ja={EXPIRED:1,FORWARD_FAIL:2,SEND_FAIL:3,STUCK:4,SERVER_YAWNING:5},Qa=5e3,$a=0,Za=0,en=1,tn=2,sn=3,an=4,nn={doc:[".doc",".docx"],pdf:[".pdf"],pp:[".ppt","pptx"],excel:[".xlsx",".xls"],photo:["jpeg","jpg","png"]},on=2621440,rn=15728640,ln=10485760,cn=5242880,dn=10485760,hn=3e3,un={TITLE:0,DETAIL:1,MORE_WIFI:2,MORE_LOCATION:3,SEPARATOR:4,MULTI_ITEMS:5,SINGLE_ITEM:6,TITLE_HISTORY:7},_n=["Xin chào, tôi là "],mn=["Hi, I'm "],pn={MAYBE:-1,SAME_WIFI:1,SAME_LOCATION:2},gn={WIRE:"Wire",WIRELESS:"Wireless"},En={reminder:"remind_topic"},fn={BOTH:2,LEFT_INCLUDE:1,RIGHT_INCLUDE:-1,MID_ONLY:0},In={SUGGESTION:1,BROADCAST:-2},Tn={DEFAULT:"DEFAULT",SEARCH_BY_NAME:"SEARCH_BY_NAME",RECENT_CONTACT:"RECENT_CONTACT",GROUP:"GROUP",MAX_RECENT:5,SUGGEST_LIST_ID:1,SELECTED_LIST_ID:2,TAB_ALL:"TAB_ALL",TAB_SELECTED:"TAB_SELECTED",TAB_ERROR:"TAB_ERROR",MEMBER_NOTFOUND:1,MEMBER_UNKNOWN_ERROR:2,DANGER_TIP:1,NORMAL_TIP:2},vn={FRIEND_CENTER:"-1000",GROUP_CENTER:"-2000",NEW_GROUP:"g",BROADCAST_CONV:"b",NIGHT_CHAT:"n"},Rn=150,Sn=6048e5,On="https://link.photo.talk.zdn.vn/photolink/720/aHR0cHM6Ly9yZXMtemFsby56YWRuLnZuL3VwbG9hZC9tZWRpYS8yMDE4LzkvMTQvaW1fcGFyc2VsaW5rX2VtcHR5XzE1MzY5MDI2Mjg2MDZfMjM2NjQzLnBuZw==",Nn=6048e5,bn=864e5,Cn=144e5,An="SHARE_FROM_MESSAGE",yn="SHARE_FROM_MESSAGE_QUICK_ACTION",Dn="SHARE_FROM_MESSAGE_GROUP_QUICK_ACTION",Mn="SHARE_FROM_MESSAGE_RIGHT_ACTION",Pn="SHARE_FROM_MESSAGE_MULTI_SELECTION",wn="SHARE_FROM_MEDIA_STORE",Ln="SHARE_FROM_MEDIA_STORE_SINGLE",kn="SHARE_FROM_MEDIA_STORE_MULTIPLE",xn="SHARE_FROM_MEDIA_STORE_TAB_SINGLE",Un="SHARE_FROM_MEDIA_STORE_TAB_MULTIPLE",Fn="SHARE_FROM_PHOTO_VIEW",Gn={MENTION:0,YOU_SENT_REQUEST:1,YOU_RECEIVED_REQUEST:2,FR_REQ_AGREE:3},Bn=[{id:18009,catId:10130},{id:21458,catId:10302},{id:16713,catId:10047},{id:394,catId:14}],Hn=1,jn=2,Vn={LOADING:0,RESULT:1,EMPTY:2,ERROR:3},Kn="-1",Wn=0,Yn=1,zn=-1,qn=1,Xn=2,Jn=3,Qn=4,$n=5,Zn=6,ei=7,ti=8,si=4,ai=85,ni={DEFAULT:-1},ii={FULLDISK_CHECK_RESULT_EMPTY:1,COMMAND_LINE_EXIT_CODE_0:2,COMMAND_LINE_ERROR_UNKNOW:3,COMMAND_LINE_NOT_SPAWN:4,THRES_HOLD_COMMAND_LINE_EXIT_CODE_0:5,THRES_HOLD_COMMAND_LINE_ERROR_UNKNOW:6,THRES_HOLD_COMMAND_LINE_NOT_SPAWN:7,GET_FILES_COMMAND_LINE_EXIT_CODE_0:8,GET_FILES_COMMAND_LINE_ERROR_UNKNOW:9,GET_FILES_COMMAND_LINE_NOT_SPAWN:10,FILES_INFO_EXECUTION_ERROR:11,ROLL_CACHE_EXECUTION_ERROR:12},oi={ASSIGNEE:1,ASSIGNER:2},ri={ALL:-1,I_ASSIGNED:0,ASSIGNED_TO_ME:1,DONE:2,WATCHERS:3},li={ALL:-1,TODAY:0,FUTURE:1,NODATE:2,EXPIRED:3},ci={ALL:-1,DOING:0,DONE:1,OVERDUE:2,NOT_RECEIVED:4,DOING_ONLY:5},di={ALL:0,TODO:1,FINISHED_TODO:2},hi={UNKNOWN:0,NOT_FOR_WORK:-1,FOR_WORK:1},ui={BOSS:1,NONE:0},_i={URGENT:100,IMPORTANT:200,MENTION_ME:300,MENTION_ALL:400,REACTION:500},mi="one_week",pi="two_week",gi=2e3,Ei=100,fi={MIN_HEIGHT:"450px",MAX_HEIGHT:"1080px",WIDTH:"340px",HEIGHT:"70%",PADDING_TOP:"70px",PADDING_RIGHT:"20px",PADDING_TOP_CHATINFO:"3px",PADDING_BOTTOM_CHATINFO:3},Ii=340,Ti=580,vi={TEXT:"1",STICKER:"2",LINK:"3"},Ri=100,Si=101,Oi=102,Ni=103,bi=104,Ci=105,Ai=106,yi={REACTION:1},Di={NONE:"0",BIRTHDAY:"1",FRIEND_ACCEPT:"2",FRIEND_ACCEPT_PASSIVE:"3",A7_RETURN_ACTIVE:"4",A7_RETURN_PASSIVE:"5",GROUP_JOIN:"6"},Mi={IMPORTANT_TAB:1,OTHERS_TAB:2},Pi={PROFILE_PAGE:0,SUGGEST_PAGE:1,GROUP_MEM_PAGE:2,MUTUAL_GROUP:3,PROFILE_GROUP:4,REPORT_USER:5},wi={BLOCKED_STRANGER_USER:122,NOT_A_ZALO_USER:-100,NOT_IN_PHONEBOOK:244,STRANGER:245,GROUP_LINK_NOT_AVAILABLE:246,IGNORED_GROUP:247,WAIT_FOR_ADMIN_APPROVAL:248,OVER_MEM_LIMIT:177,MEMBER_ALREADY:178,NOT_PERMISSION:166,ADD_TO_BIG_GROUP:264,BAN_JOIN_GROUP:257,WAITING_APPROVAL:240,EXISTED_WAITING_APPROVAL:252,OUTDATED_TTL:280,OVER_LIMIT_TTL_THREAD:281,OVER_MEM_LIMIT_TTL:283},Li={GROUP_NO_EXIST:161,NO_MEMBER_IN_GROUP:164,NO_DATA:-2308},ki={ALL:1,URGENT_MSG:2,IMPORTANT_MSG:3,MENTION_ME:4,MENTION_ALL:5,UNREAD:6},xi={ALL:1,UNREAD:2},Ui={MIN_WIDTH_CHAT_AREA:420,MIN_WIDTH_LEFT_SIDEBAR:376,MAX_WIDTH_LEFT_SIDEBAR:408,WIDTH_RIGHT_SIDEBAR:344,MIN_WIDTH_CHAT_AREA_TRIGGER_CHANGE_STYLE:480},Fi={friend:-1,searchPhoneGlobal:85,searchUsernameGlobal:86},Gi={STRANGER:1,BLOCK_USER:2},Bi={UNKNOWN:-1,PROFILE:0,MEDIA_STORE:1,CONTEXT_MENU:2,OPERATE:3,REVIEW_RETRY:4,SUGGESTION:5},Hi={PROFILE:1,RIGHT_MENU:2},ji={weekday:"$weekday$s",day:"$day$s",month:"$month$s",year:"$year$s",hour:"$hour$s",minute:"$minute$s"},Vi={SEND_LINK_TO_STRANGER:243},Ki={NONE:0,INTRODUCE:1,CREATE_PIN:2,CONFIRM_PIN:3,HIDE_CONV:4,HIDE_CONV_SUCCESS:5,OPEN_CONV:6,UNHIDE_CONV:7,SET_PIN_SUCCESS:8,REMOVE_PIN:9,CHANGE_PIN_STEP_1:10,CHANGE_PIN_STEP_2:11,CHANGE_PIN_STEP_3:13,CHANGE_PIN_SUCCESS:14,CREATE_PIN_FROM_SETTING:15,CONFIRM_PIN_FROM_SETTING:16,UNHIDE_CONV_BY_PIN:17},Wi=1,Yi="_need_set_remember",zi="_config_new_remember",qi="_config_opt_remember",Xi="_set_value_action_log",Ji=0,Qi=1,$i=2,Zi=$i,eo=new Set(["{","(","[","<"]),to=new Set(["}",")","]",">"]),so=30,ao=40,no={NONE:0,ACCEPT:1,REJECT:2},io={INFO:0,SUCCESS:1,WARNING:2,ERROR:3},oo={NORMAL:0,COMPACT:1},ro={INFO:0,SUCCESS:1,WARNING:2,ERROR:3},lo="calc(100vh - 84px - 58px - 80px - 24px - 2px)",co="calc(100vh - 84px - 80px - 24px - 2px)",ho="calc(100vh - 30px - 40px)",uo={MAX_MSG_ID:"9999999999999999",MAX_USER_ID:"99999999999999999999",MAX_SENDDTTM:"9999999999999999",MIN_MSG_ID:"",MIN_USER_ID:"",MIN_SENDDTTM:"",MIN_CONVERSATION_ID:"",MAX_CONVERSATION_ID:"g99999999999999999999"},_o={TYPE_SELECTED_FULL:1,TYPE_SELECTED_PARTIAL:2,TYPE_UNSELECTED:3},mo="edit-photo",po={PENDING:1,ONGOING:2,DONE:3},go={PNG:0,JPG:1,WEBP:2},Eo={ZALO:0,TENOR:1},fo={NORMAL:-1,IMPORTANT:1,URGENT:2},Io={STRANGER:"stranger",SYSTEM:"system",SUGGEST:"suggest",GROUP:"group",DEFAULT:"default"},To={SHOW_ALL:1,REDDOT:2,CLOSE:3},vo={SENSITIVE:1,ANOYING:2,FRAUDING:3,MAX_CHAR_REASON:1e3},Ro={show_online_status:"show_online_status",show_seen:"show_seen",quick_message_status:"quick_message_status"},So=7.5,Oo=864e5,No=6e4,bo={TEXT_TOKEN:0,EMOJI_TOKEN:1,LINK_TOKEN:2,EMAIL_TOKEN:4,MENTION_TOKEN:5,NOT_MENTION_TOKEN:6,HIGH_LIGHT:7,TEXT:8,DOTDOTDOT:9,EMOJI_TOKEN_V2:10,NEWS_KEYWORD:11,LANGUAGE_CHANGE:12,ICON_CONTACT:13,PHONE_NUMBER:14},Co={SOCKET:"SOCKET",POLLING:"POLLING",UNSET:"UNSET"},Ao={COMPACT:0,SEMI_COMPACT:1,NORMAL:2},yo={ALL:"all",MEDIA:"media_box",STRANGER:"stranger_box",UNREAD:"unread"},Do=Object.values(yo),Mo=36e5,Po="bb_msg_id",wo={TEXT:null,URGENT:"icon-solid-alert",IMPORTANT:"icon-solid-important",STICKER:"icon-outline-sticker",FILE:"icon-outline-file",FOLDER:"icon-outline-folder",PHOTO:"icon-outline-picture",LINK:"icon-outline-link",CONTACT:"icon-outline-contact",GIF:"combined-shape",LOCATION:"icon-outline-location",POLL:"icon-outline-poll",VIDEO:"icon-outline-video-2",REMIND:"icon-outline-reminder",CALLING:"Call-To",RECEIVECALL:"Call-Receive",MISSCALL:"Miss-Call",VOICE:"icon-outline-voice-msg",ECARD:"icon-outline-ecard-msg",STICKER_SET:"icon-outline-sticker",DOODLE:"icon-outline-doodle"},Lo={MaxScale:7},ko={confirmIdentities:"confirm_modal"},xo={ADD_ADMIN_COMPOSE:"ADD_ADMIN_COMPOSE",ADD_CONV_LABEL:"ADD_CONV_LABEL",ADD_MEMBER_COMPOSE:"ADD_MEMBER_COMPOSE",APP_DOWNLOAD_UPDATE:"APP_DOWNLOAD_UPDATE",APP_FEEDBACK:"APP_FEEDBACK",APP_INFO:"APP_INFO",APP_UPDATE_INFO:"APP_UPDATE_INFO",BLACK_LIST:"BLACK_LIST",BROADCAST_COMPSE:"BROADCAST_COMPSE",BUSY_PREVIEW:"BUSY_PREVIEW",CHANGE_AVT:"CHANGE_AVT",CHANGE_OWNER:"CHANGE_OWNER",CHANGE_PW:"CHANGE_PW",COPY_EXCEL:"COPY_EXCEL",CREATE_GROUP_COMPOSE:"CREATE_GROUP_COMPOSE",EDIT_ALIAS:"EDIT_ALIAS",EMOJI_SETTING:"EMOJI_SETTING",EVENT_ECARD:"EVENT_ECARD",EXPORT:"EXPORT",FILE_INTRO:"FILE_INTRO",FILE_PICKER:"FILE_PICKER",FIND_FRIEND:"FIND_FRIEND",FRIEND_PROFILE:"FRIEND_PROFILE",FRIEND_SUGGESTION:"FRIEND_SUGGESTION",GROUP_CALL:"GROUP_CALL",GROUP_POLL_CREATE:"GROUP_POLL_CREATE",GROUP_POLL_VOTE:"GROUP_POLL_VOTE",GROUP_PREVIEW:"GROUP_PREVIEW",GROUP_PREVIEW_MEM:"GROUP_PREVIEW_MEM",GROUP_PROFILE:"GROUP_PROFILE",HIDDEN_CHAT:"HIDDEN_CHAT",IMAGE_SHOW:"IMAGE_SHOW",IMPORT:"IMPORT",INVITE_MULTI:"INVITE_MULTI",INVITE_STRANGER:"INVITE_STRANGER",LABEL_INTRO:"LABEL_INTRO",MANAGE_LABEL:"MANAGE_LABEL",MSG_DETAIL:"MSG_DETAIL",MSG_INFO:"MSG_INFO",MUTE:"MUTE",NOTICE_COMPOSE:"NOTICE_COMPOSE",NOTI_GUIDE:"NOTI_GUIDE",PIN_CONVERSATION:"PIN_CONVERSATION",PIN_LIMIT_POPUP:"PIN_LIMIT_POPUP",POST_ADD_GROUP:"POST_ADD_GROUP",POST_DOWNLOAD:"POST_DOWNLOAD",PW_BACKUP:"PW_BACKUP",RATING:"RATING",REMINDER_COMPOSE:"REMINDER_COMPOSE",SCREENCAP:"SCREENCAP",SEASONAL_TEMPLATE:"SEASONAL_TEMPLATE",SETTINGS:"SETTINGS",SET_APP_LOCK:"SET_APP_LOCK",SHARE_CONTACT:"SHARE_CONTACT",SHARE_MSG_COMPOSE:"SHARE_MSG_COMPOSE",SHORTCUT:"SHORTCUT",SYNC_DB:"SYNC_DB",SYNC_MSG:"SYNC_MSG",TODO_CONGRAT:"TODO_CONGRAT",TODO_EDITOR:"TODO_EDITOR",TODO_MULTI_VIEW:"TODO_MULTI_VIEW",TODO_PREVIEW:"TODO_PREVIEW",UNPIN_POPUP:"UNPIN_POPUP",UPDATE_PROFILE:"UPDATE_PROFILE",VIDEO_CALL_SUGGEST:"VIDEO_CALL_SUGGEST",WARNING_CAP_MAC:"WARNING_CAP_MAC",WHITE_LIST_MODAL:"WHITE_LIST_MODAL",CONFIRM_DOWNLOAD_ERROR:"CONFIRM_DOWNLOAD_ERROR",CONFIRM_DELETE_MSG:"CONFIRM_DELETE_MSG",CONFIRM_RECOVER:"CONFIRM_RECOVER",CREATE_GROUP_WITH_FRIEND:"CREATE_GROUP_WITH_FRIEND",REMOVE_MEMBER_NOTIFICATION:"REMOVE_MEMBER_NOTIFICATION",TFE_EDITOR:"TFE_EDITOR",TTL_PICKER:"TTL_PICKER",QM_MANAGER:"QM_MANAGER",QM_MODIFIER:"QM_MODIFIER",QM_DELETION:"QM_DELETION",CATALOG_CREATE_POPUP:"CATALOG_CREATE_POPUP",TOGGLE_CONFIRM_DEL:"TOGGLE_CONFIRM_DEL",MUTE_BANNER_CONFIRM:"MUTE_BANNER_CONFIRM",TOGGLE_POPUP_CPU_PERF:"TOGGLE_POPUP_CPU_PERF"},Uo={STICKER_SUGGESTION:"sticker-suggestion",TAG_NAME_INPUT:"tag-name-input",TAG_NAME_TODO:"tag-name-todo",LEFTBAR_MOREMENU:"leftBar-moreMenu",LEFTBAR_TOOLSMENU:"leftBar-toolsMenu",MEDIA_DOCK_TOOLBAR:"media-dock-toolbar",EMOJI_POP:"emoji-pop",DATE_FILTER_SEARCH_TOOL:"date-filter-search-tool",DATE_FILTER_MEDIA:"date-filter-media",DATE_FILTER_GLOBAL_SEARCH:"date-filter-global-search",STICKER_TAG:"sticker-tag",COLOR_MENU:"color-menmu",CALENDAR:"calendar",CALENDAR_REMINDER:"CALENDAR_REMINDER",CALENDAR_TODO_ADVAN:"CALENDAR_TODO_ADVAN",CALENDAR_TODO_EDITOR:"CALENDAR_TODO_EDITOR",CALENDAR_DATE_PICKER:"CALENDAR_DATE_PICKER",CALENDAR_DROPDOWN_TIME:"CALENDAR_DROPDOWN_TIME",IMPORTANT_MSG_ENTRY:"important-msg-entry",EDIT_LABEL:"edit-label",MANAGE_LABEL:"manage-label",MEDIA_DOCK_TODO:"media-dock-todo",TODO_ADVAN_FILTER:"todo-advan-filter",DROPDOWN:"dropdown",DROPDOWN_INFO_FOLDER:"DROPDOWN_INFO_FOLDER",DROPDOWN_SETTING:"DROPDOWN_SETTING",DROPDOWN_LANGUAGE:"DROPDOWN_LANGUAGE",DROPDOWN_PROXY:"DROPDOWN_PROXY",DROPDOWN_LABEL:"DROPDOWN_LABEL",DROPDOWN_WEEKDAY_PICKER:"DROPDOWN_WEEKDAY_PICKER",DROPDOWN_TODO_MEMBER_ASSIGN:"DROPDOWN_TODO_MEMBER_ASSIGN",DROPDOWN_TODO_MEMBER_FOLLOW:"DROPDOWN_TODO_MEMBER_FOLLOW",DROPDOWN_SINGLE_DEVICE_1:"DROPDOWN_SINGLE_DEVICE_1",DROPDOWN_SINGLE_DEVICE_2:"DROPDOWN_SINGLE_DEVICE_2",DROPDOWN_SINGLE_DEVICE_3:"DROPDOWN_SINGLE_DEVICE_3",DROPDOWN_SINGLE_ASSIGN_MEMBER:"DROPDOWN_SINGLE_ASSIGN_MEMBER",DROPDOWN_SINGLE_ACTIVITIES:"DROPDOWN_SINGLE_ACTIVITIES",DROPDOWN_DATA_PICKER_1:"DROPDOWN_DATA_PICKER_1",DROPDOWN_DATA_PICKER_2:"DROPDOWN_DATA_PICKER_2",DROPDOWN_DATA_PICKER_3:"DROPDOWN_DATA_PICKER_3",DROPDOWN_WEEKDAY_REPEAT:"DROPDOWN_WEEKDAY_REPEAT",INTERNAL_DROPDOWN:"internal-dropdown",MY_PROFILE:"my-profile",FILTER_LABEL:"filter_label",USER_STATUS:"user_status",GROUP_BOARD_ACTION:"group-board-action",GROUP_BOARD_ITEM:"group-board-item",CONTEXTMENU_CONV_LIST:"contextmenu-conv-list",CONTEXTMENU_CONTACT_LIST:"contextmenu-contact-list",CONTEXTMENU_CONTACT_ITEM:"contextmenu-contact-item",CONTEXTMENU_GROUP_ITEM:"contextmenu-group-item",CONTEXTMENU_RECENT_ITEM:"contextmenu-recent-item",CHAT_BOX_INFO:"Chat-box-infor",CHAT_BOX_LIST_1:"chat-box-list-1",CHAT_BOX_LIST_2:"chat-box-list-2",CHAT_BOX_MENTION:"fun-more-setting-1",CHAT_BOX_START_MSG:"fun-more-setting-2",CHAT_BOX_TOPIC_BANNER:"group-topic",ECRAD_REMINDER:"ecard-reminder",FILE_MENU_TOOLBAR:"file-menu",SCREEN_SHOT_TOOLBAR:"screenshot-menu",MORE_MENU_TOOLBAR:"toolbar-more-menu",CHAT_BOX_MEDIA:"chat-box-media",CHAT_BOX_MEMBER:"chat-box-member",CHAT_BOX_MUTUAL_GROUP:"chat-box-mutual-group",CHAT_BOX_SET_GROUP:"chat-box-set-group",TOPIC_BANNER:"topic_banner",FONT_SIZE_MENU:"font-size-menu",RICH_TEXT_TOOL:"rich-text-tool",CLOUD_CONTEXT:"cloud-context",FILE_MANAGER:"file-manager",FILE_PCIKER:"file-picker",CHAT_BOX_VIEW_NOTE_CANCEL:"chat-box-view-note-cancel",CHAT_BOX_VIEW_NOTE_CHANGE:"chat-box-view-note-change",GROUP_POLL_INFO:"group-poll-info",GROUP_POLL_VOTE:"group-poll-vote",GROUP_CENTER:"group-center",MENU_GROUP_CENTER:"menu-group-center",ACTION_GROUP_CENTER:"action-group-center",LABEL_BADGE:"label-badge",LABEL_SHORTCUT:"label-shortcut",IMPORTANT_MSG_ITEM:"important-msg-item",MENTION_ITEM:"mention-item",NOTI_FILTER_BTN:"noti-filter-btn",REACTION_MSG_ITEM:"reaction-msg-item",TODO_ACTION:"todo-action",TODO_BANNER:"todo-banner",TODO_LIST:"todo-list",TODO_PREVIEW:"todo-preview",DROPDOWN_V2:"dropdown-v2",FILE_TYPE_DROPDOWN:"FILE_TYPE_DROPDOWN",SENDER_MEDIA_DROPDOWN:"SENDER_MEDIA_DROPDOWN",SENDER_SEARCH_TOOL_DROPDOWN:"SENDER_SEARCH_TOOL_DROPDOWN",MEDIA_ACTION:"media-action",MESSAGE_ACTION:"message-action",MULTI_SELECT:"multi-select",TAB_CONTAINER:"tab-container",LIST_ROOM_ITEM:"list-room-item",SHOW_ALL_MESSAGE:"show-all-message",MAIN_LANGUAGE:"main-language",LOGIN_PASSWORD:"login-password",SWITCH_LANGUAGE:"switch-language",FILE_TYPE_DROPDOWN_GLOBAL_SEARCH:"FILE_TYPE_DROPDOWN_GLOBAL_SEARCH",SENDER_DROPDOWN_GLOBAL_SEARCH:"SENDER_DROPDOWN_GLOBAL_SEARCH",POP_AVATAR:"popup-avatar",QM_SEARCH:"QuickMessage_Search",QM_DASHBOARD:"QuickMessage_Dashboard",QM_WELCOME:"QuickMessage_Welcome",QM_WELCOME_EXT_MENU:"QuickMessage_Welcome_Ext_Menu",CATALOG_PRODUCT_SUGGESTION:"CatalogProductSuggestion",CONV_ACTION_MENU:"CONV_ACTION_MENU",CONV_LABEL_MENU:"CONV_LABEL_MENU"},Fo={OTHER:-1,POP_PROFILE:0,CHAT_VIEW:1,DONT_REQ_SERVER:2,FORCE_GET:3},Go={Image:"image",File:"file",Link:"link"},Bo={INITIALIZE:0,CHECKING:1,CHECKED_NO_UPDATE:2,NEED_UPDATE:3,CHECKED_SILENT_UPDATE:4,CHECKED_NOTIFY_UPDATE:5,START_DOWNLOAD:6,DOWNLOADING:7,DOWNLOAD_ERROR_RETRY:8,DOWNLOAD_ERROR:9,INSTALLING:10,FALLBACK:11},Ho={CATALOG_ID_DEFAULT_NO_EXIST:-1},jo={NO_NETWORK:"ERR_NO_NETWORK",TIMEOUT_SENT:"ERR_CONNECTION_TIMED_OUT_SENT",TIMEOUT:"ERR_CONNECTION_TIMED_OUT"},Vo={MissCall:"recommened.misscall",CallTime:"recommened.calltime",Calling:"recommened.calling",ReceiveCall:"recommened.receivecall"}},"1rZy":function(e,t,s){"use strict";s.r(t),t.default="assets/search-media-avatar-sender.aa06999283a430087bbfa4390862b60d.png"},"1sdK":function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return i}));var a=s("rePB");let n;class i{static get instance(){return n||(n=new i),n}constructor(){Object(a.a)(this,"_pvTopMember",{})}setPVTopMember(e={}){return this._pvTopMember=e,this}getDName(e){var t;return null===(t=this._pvTopMember[e])||void 0===t?void 0:t.dName}}},"1tph":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=s("17x9"),o=s.n(i),r=s("z0WU"),l=s("NDmK"),c=s("dThN"),d=(s("97kL"),s("1pet")),h=s("ro+J"),u=s("vSga"),_=s("egaF"),m=s("TsEa"),p=s("vqHl"),g=s("R5gT"),E=s("XS0u"),f=s("PoHQ"),I=s("Anfm"),T=s("Ullg"),v=s("pmjN"),R=s("lCMA"),S=s("wx14"),O=s("Ff2n"),N=s("iuhU"),b=s("dLnH"),C=s("x8mc");function A(e={}){const{data:t={},id:s="",width:i,height:o,isSelected:r,setWidthOfItem:l,index:c}=e,d=Object(O.a)(e,["data","id","width","height","isSelected","setWidthOfItem","index"]),h=Object(a.useMemo)((()=>{const[e,s]=T.a.Helper.getSizeRender(t.width,t.height,i,o);return{width:e,height:s}}),[t.width,t.height,i,o]);Object(a.useEffect)((()=>{l&&l(c,h.width)}));const u=r,_=Object(N.a)(C.a,u&&"selected");return n.a.createElement(b.a,Object(S.a)({id:s,className:_,data:t,width:h.width,height:h.height,loadingSize:[40,40]},d))}A.propTypes={data:o.a.object.isRequired,id:o.a.string,width:o.a.number,height:o.a.number,isSelected:o.a.bool,index:o.a.number,setWidthOfItem:o.a.func,onClick:o.a.func};var y=A,D=s("OONb"),M=s("Yi2m");const P=100,w=new r.LocalId,L={[m.b.GIF]:"#hello",[m.b.STICKER]:"",[m.b.GUGGY]:""},k={};let x=!1;const U=T.a.Config.isEnablePhotoSticker(),F="PhotoSticker";class G extends n.a.Component{constructor(e){super(e),this._onScroll=this._onScroll.bind(this),this._scrollHoriz=this._scrollHoriz.bind(this),this._selectAction=this._selectAction.bind(this),this._getItemNameFromType=this._getItemNameFromType.bind(this),this._changeMode=this._changeMode.bind(this),this._mapWidthOfItems=this._mapWidthOfItems.bind(this),this._scrollToSelected=this._scrollToSelected.bind(this),this._currentMode=null,this._lastKeyword=null,this._itemsWidthMap={},this.onClickItem=this.onClickItem.bind(this),this._query=null,this.state={itemName:null,isLoading:!1},this._searchFile=this._searchFile.bind(this),this._doSearchFile=this._doSearchFile.bind(this),this._functionSearchFile=r.default.throttle(((e,t)=>{this._doSearchFile(e,t)}),300),this._searchGif=this._searchGif.bind(this),this._doSearchTextGif=this._doSearchTextGif.bind(this),this._functionSearchTextGif=r.default.throttle(((e,t)=>{this._doSearchTextGif(e,t)}),300),this._searchSticker=this._searchSticker.bind(this),this._doSearchSticker=this._doSearchSticker.bind(this),this._functionSearchSticker=r.default.throttle(((e,t)=>{this._doSearchSticker(e,t)}),300),this._searchGuggy=this._searchGuggy.bind(this),this._doSearchGuggy=this._doSearchGuggy.bind(this),this._functionSearchGuggy=r.default.throttle(((e,t)=>{this._doSearchGuggy(e,t)}),100),this._changeMode(null,e.typeItem)}handleKeyDown(e){let t=this.state.selectedIndex,s=this.state.listItems.length,a=null,n=!1,i=!1;switch(e.which){case d.K_UP:null==t?(a=0,n=!0,i=!0,this.state.itemName===F&&M.e.logAction(T.a.ActionLog.InteractWithPStickerOnChatBar.UP_ARROW)):n=!0;break;case d.K_DOWN:null!=t&&(a=null,n=!0,i=!0,this.state.itemName===F&&M.e.logAction(T.a.ActionLog.InteractWithPStickerOnChatBar.DOWN_ARROW));break;case d.K_RIGHT:null!=t&&(a=t+1,a>=s&&(a=s-1),n=!0,i=!0,this.state.itemName===F&&M.e.logAction(T.a.ActionLog.InteractWithPStickerOnChatBar.RIGHT_ARROW));break;case d.K_LEFT:null!=t&&(a=t-1,a<0&&(a=0),n=!0,i=!0,this.state.itemName===F&&M.e.logAction(T.a.ActionLog.InteractWithPStickerOnChatBar.LEFT_ARROW));break;case d.K_ENTER:null!=t&&(this._selectAction(this.state.listItems[t]),n=!0);break;case d.K_ESC:this.state.itemName===F&&M.e.logAction(T.a.ActionLog.TurnOffPStickerOnChatBar.CLOSE_BY_ESC)}return i&&this.setState({selectedIndex:a}),!!n&&(e.preventDefault(),e.stopPropagation(),!0)}handleEnter(e){let t=this.state.selectedIndex;return!(null==t||!this.state.listItems||!this.state.listItems[t])&&(this._selectAction(this.state.listItems[t]),!0)}onClickItem(e){this._selectAction(e)}isActive(){return!!this._currentMode}getActiveMode(){return this._currentMode}handleTextChange(e,t){this._currentMode==t?(e===this._lastKeyword&&null!=this._lastKeyword||(this._lastKeyword=e,this._scrollToLeftmost()),this._query&&this._query(e)):r.default.logCoreError("handleTextChange wrong mode",this.props.typeItem+" "+t)}clearData(){this.setState({listItems:[],selectedIndex:null,itemName:null})}handleChangeMode(e,t,s){this._changeMode(e,t,s)}_getItemNameFromType(e){switch(e){case m.b.GIF:return v.b;case m.b.STICKER:return v.f;case m.b.FILE:return v.a}return null}_changeMode(e,t,s){if(t===this._currentMode)return;let a=null;switch(t){case m.b.GIF:a=v.b,this._doSelect=this.props.sendGif,this._query=this._searchGif;break;case m.b.STICKER:a=U?F:v.f,this._doSelect=this.props.sendSticker,this._query=this._searchSticker,M.e.logAction(T.a.ActionLog.Common.SHOW);break;case m.b.FILE:a=v.a,this._doSelect=this.props.sendFile,this._query=this._searchFile;break;case m.b.GUGGY:a=v.c,this._doSelect=this.props.sendGuggy,this._query=this._searchGuggy}this._currentMode===m.b.STICKER&&(M.e.logAction(T.a.ActionLog.TurnOffPStickerOnChatBar.CLOSE),"@STICKER"!==(null==s?void 0:s.trim())&&M.e.logAction(T.a.ActionLog.TurnOffPStickerOnChatBar.CLOSE_BY_CLEAR_KW)),a?this._currentMode!=t&&(w.next(),this._currentMode=t):this._currentMode=null,a!==this.state.itemName&&this.setState({itemName:a,listItems:[],selectedIndex:null,isLoading:!1})}_initDefault(){return new Promise(((e,t)=>{if(!x){x=!0;for(let e in L)if(e=parseInt(e),!k[e]){let t=L[e];switch(e){case m.b.GIF:p.a.getListTrendingAsync().then((t=>{t&&t.length>0&&!k[e]&&(k[e]=t)}));break;case m.b.STICKER:{const s=T.a.Constant.StickerSourceTypes.TENOR;u.g.searchSuggestSticker(t,40,!1,s).then((t=>{t&&t.length>0&&!k[e]&&(k[e]=t)}));break}case m.b.GUGGY:c.default.getDefaultGuggies(20).then((t=>{t&&t.length>0&&!k[e]&&(k[e]=t)}))}}}}))}_selectAction(e){if(this._doSelect){let a;switch(this.props.typeItem){case m.b.GIF:f.default.setGifSrc(d.SGG_SRC_SEARCH_INPUTBOX);break;case m.b.STICKER:{var t,s;M.e.logAction(T.a.ActionLog.SendPStickerOnChatBar.SENT);const e="@sticker ";(null===(t=this._lastKeyword)||void 0===t||null===(s=t.toLowerCase())||void 0===s?void 0:s.replace(e,""))?M.e.logAction(T.a.ActionLog.SendPStickerOnChatBar.SENT_WITH_KW):M.e.logAction(T.a.ActionLog.SendPStickerOnChatBar.SENT_WITH_DEFAULT_RESULT),f.default.setStickerSrc(d.SGG_SRC_SEARCH_INPUTBOX);break}case m.b.GUGGY:a=I.b.Guggy.SEND_GUGGY_CMD,f.default.setGuggySrc(d.SGG_SRC_SEARCH_INPUTBOX)}this._doSelect(e,a),this.clearData()}else r.default.logCoreError("select function null")}componentWillReceiveProps(e){this.props.typeItem!=e.typeItem&&this._changeMode(this.props.typeItem,e.typeItem)}componentDidUpdate(e,t){this._ref&&!this._currentWidth&&(this._currentWidth=this._ref.offsetWidth),void 0!==this.state.selectedIndex&&this.state.selectedIndex!=t.selectedIndex&&this._scrollToSelected(this.state.selectedIndex)}shouldComponentUpdate(e,t){return this.state.itemName!==t.itemName||this.state.listItems!==t.listItems||this.state.selectedIndex!==t.selectedIndex||this.state.isLoading!==t.isLoading}componentDidMount(){this._initDefault()}_onScroll(){}_scrollHoriz(e){this.scrollbar&&e.deltaY&&(this.scrollbar.scrollRightBy(e.deltaY),e.preventDefault())}_noResult(e){w.valid(e)&&this.setState({listItems:[],selectedIndex:null,isLoading:!1})}_scrollToLeftmost(){this._scrollLeft(0)}_scrollLeft(e){requestAnimationFrame((()=>{this.scrollbar&&this.scrollbar.scrollLeftTo(e)}))}_getRightOffset(e){let t=0;for(let s=0;s<=e;++s)t+=this._itemsWidthMap[s]||0;return t}_scrollToSelected(e){if(!this._currentWidth||!this.scrollbar)return;let t=document.getElementById(v.d+e);if(t&&t.scrollIntoView&&t.scrollIntoView.constructor===Function)return void t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});let s=this._getRightOffset(e),a=s+e*v.e*2;if(a>this._currentWidth)this.scrollbar.scrollRightByV2(a+25-this._currentWidth-this.scrollbar.getScrollLeft());else{let t=this.scrollbar.getScrollLeft(),a=this._itemsWidthMap[e]||0;s-a-50<=t&&(t=Math.max(s-a-50,0),this.scrollbar.scrollLeftTo(t))}}_mapWidthOfItems(e,t){this._itemsWidthMap[e]=t}_close(e){this._currentMode===m.b.STICKER&&M.e.logAction(T.a.ActionLog.TurnOffPStickerOnChatBar.CLOSE_BY_X),this.props.quit(),e.stopPropagation(),e.preventDefault()}render(){if(!this.state.itemName||!this._currentMode)return this._currentWidth=null,null;let e,t=this.state.listItems,s=null,a=!1;if(t&&t.constructor===Array&&t.length>0){s=[];let e=this.state.itemName!==v.f;U&&this.state.itemName===F?t.forEach(((e,t)=>{s.push(n.a.createElement(y,{id:v.d+t,data:e,height:65,isSelected:this.state.selectedIndex===t,index:t,setWidthOfItem:this._mapWidthOfItems,onClick:this.onClickItem}))})):t.forEach(((t,a)=>{s.push(n.a.createElement(this.state.itemName,{selectAction:this._selectAction,selected:this.state.selectedIndex===a,key:"it_"+a,index:a,setWidthOfItem:this._mapWidthOfItems,loadingMode:e,groups:this.props.groups,contacts:this.props.contacts,item:t}))}))}else{a=!0;let e="STR_NO_RESULT";U&&this._currentMode===m.b.STICKER&&(e="STR_SEARCH_STICKER_NO_RESULT"),s=n.a.createElement(R.a,{textKey:e,className:"chatboxCommand__no-result-text"})}return e=this.state.isLoading?n.a.createElement("div",{className:"flx flx-al-c h100"},n.a.createElement(D.a,{size:30})):n.a.createElement(_.b,{ref:e=>{this.scrollbar=e},autoHide:!0,noHScroll:!1,noVScroll:!0,onScroll:this._onScroll},n.a.createElement("div",{onWheel:this._scrollHoriz,className:"flx flx-al-s"+(a?" chatboxCommand__no-result-container":"")},s)),n.a.createElement(h.a,null,n.a.createElement("div",{id:"chat-box-command",className:"cmmmmmd chatboxCommand "+(this.state.itemName===v.b?" gif":""),ref:e=>this._ref=e},e,n.a.createElement("div",{className:"chatboxCommand__close flx flx-center flx-al-c clickable",onClick:e=>this._close(e)},n.a.createElement("i",{className:"fa fa-close"}))))}_viewDefault(e,t){if(k[e]){let s=[...k[e]];return!!(s&&s.length>0)&&(setTimeout((()=>{w.valid(t)&&(e===m.b.GIF?(l.c.gif.shuffle_result&&r.default.shuffleArray(s),this.setState({listItems:s,selectedIndex:null,isLoading:!1})):e===m.b.STICKER&&U?(T.a.Config.shouldShuffleResult()&&r.default.shuffleArray(s),M.e.logAction(T.a.ActionLog.ShowPStickerOnChatBar.HAVE_DATA),this.setState({listItems:s,selectedIndex:null,isLoading:!1})):(r.default.shuffleArray(s),this.setState({listItems:s,selectedIndex:null,isLoading:!1})))}),0),!0)}return!1}_doSearchFile(e,t){return new Promise(((s,a)=>{w.valid(t)&&g.a.search(e,null,{msgType:d.MSG_FILE},!1,{offset:0,limit:8}).then((e=>{if(!w.valid(t))return;let s=e.map((e=>e.msgId)).slice(0,8);E.default.getFilesByMsgIds(s).then((e=>{if(!w.valid(t))return;let s=[];for(let t in e)e.hasOwnProperty(t)&&e[t]&&s.push(e[t]);this.setState({listItems:s,selectedIndex:null})})).catch((e=>{w.valid(t)&&(r.default.logCoreError("_doSearchFile",e),this._noResult(t),a(e))}))})).catch((e=>{w.valid(t)&&(r.default.logCoreError("_doSearchFile",e),this._noResult(t),a(e))}))}))}_getLatestFile(e){E.default.getLatestFiles(0).then((t=>{t&&t.length>0&&(t=t.slice(0,8),k[m.b.FILE]=t,w.valid(e)&&(this.state.listItems&&0!=this.state.listItems.length||(w.next(),this.setState({listItems:[...t],selectedIndex:null}))))}))}_searchFile(e){let t=w.next();if(e&&e.length<=P){let s=e.substring(m.c[m.b.FILE].len).trim();s?this._functionSearchFile(s,t):(setTimeout((()=>{w.valid(t)&&k[m.b.FILE]&&(w.next(),this.setState({listItems:[...k[m.b.FILE]],selectedIndex:null}))}),0),this._getLatestFile(t))}else this._noResult(t)}_doSearchTextGif(e,t){return new Promise(((s,a)=>{w.valid(t)&&p.a.searchGifsByKeyWord(e,l.c.gif.search_by_kw_limit).then((s=>{w.valid(t)&&(s&&s.length>0?(e&&e.toLowerCase()==L[m.b.GIF]&&(k[m.b.GIF]=[...s]),this.setState({listItems:s,selectedIndex:null})):this._noResult(t))})).catch((e=>{r.default.logCoreError(e),w.valid(t)&&this._noResult(t)}))}))}_searchGif(e){let t=w.next();if(e&&e.length<=P){let s=e.substring(m.c[m.b.GIF].len).trim();if(s)s="#"+s;else if(s=L[m.b.GIF],this._viewDefault(m.b.GIF,t))return;this._functionSearchTextGif(s,t)}else this._noResult(t)}_setKeywordCache(e,t){const s=Date.now()+39600;T.a.Cache.KeywordCache.setList(e,t,s)}_getKeywordList(e){return T.a.Cache.KeywordCache.getList(e)}_isExpired(e){return T.a.Cache.KeywordCache.isExpired(e)}_doSearchSticker(e,t){return new Promise(((s,a)=>{if(!w.valid(t))return;const n=()=>!w.valid(t),i=U?T.a.Constant.StickerSourceTypes.TENOR:T.a.Constant.StickerSourceTypes.ZALO,o={query:e,sign:t,startTime:performance.now()};u.g.searchSuggestSticker(e,40,n,i).then((a=>{if(n())return s();if(a&&a.length>0){e&&e.toLowerCase()==L[m.b.STICKER]&&(k[m.b.STICKER]=a),U&&i===T.a.Constant.StickerSourceTypes.TENOR&&this._setKeywordCache(e,a);!U&&r.default.shuffleArray(a),r.default.logCoreInfo("Tracking doSearch PhotoSticker",o.query,o.sign,performance.now()-o.startTime),this.setState({listItems:a,selectedIndex:null,isLoading:!1}),M.e.logAction(T.a.ActionLog.ShowPStickerOnChatBar.HAVE_DATA)}else M.e.logAction(T.a.ActionLog.ShowPStickerOnChatBar.EMPTY_DATA),this._noResult(t);s()})).catch((e=>{M.e.logAction(T.a.ActionLog.ShowPStickerOnChatBar.EMPTY_DATA),this._noResult(t),r.default.logCoreError("searchSuggestSticker",e),a()}))}))}_searchSticker(e){let t=w.next();if(e&&e.length<=P){let s=e.substring(m.c[m.b.STICKER].len).trim();if(!s&&(s=L[m.b.STICKER],this._viewDefault(m.b.STICKER,t)))return;if(U){const e=this._getKeywordList(s),a=this._isExpired(s);(null==e?void 0:e.length)>0&&!a?(M.e.logAction(T.a.ActionLog.ShowPStickerOnChatBar.HAVE_DATA),this.setState({listItems:e,selectedIndex:null,isLoading:!1})):(this.setState({isLoading:!0}),this._functionSearchSticker(s,t))}else this.setState({isLoading:!0}),this._functionSearchSticker(s,t)}else this._noResult(t)}_searchGuggy(e){const t=w.next();if(e&&e.length<=P){let s=e.substring(m.c[m.b.GUGGY].len).trim();if(!s&&this._viewDefault(m.b.GUGGY,t))return;this._functionSearchGuggy(s,t)}else this._noResult(t)}_doSearchGuggy(e,t){return new Promise((()=>{if(!w.valid(t))return;const s=e=>{w.valid(t)&&(e&&e.length>0?(r.default.log("guggies",e),this.setState({listItems:e,selectedIndex:null})):this._noResult(t))},a=e=>{r.default.logCoreError(e),w.valid(t)&&this._noResult(t)};e?c.default.searchGuggyByKeyword(e,20).then(s).catch(a):c.default.getDefaultGuggies(20).then(s).catch(a)}))}}t.a=G},2:function(e,t){},"2+pv":function(e,t,s){"use strict";s.d(t,"f",(function(){return g})),s.d(t,"e",(function(){return E})),s.d(t,"g",(function(){return f})),s.d(t,"k",(function(){return I})),s.d(t,"m",(function(){return T})),s.d(t,"h",(function(){return v})),s.d(t,"d",(function(){return R})),s.d(t,"a",(function(){return S})),s.d(t,"b",(function(){return O})),s.d(t,"i",(function(){return N})),s.d(t,"j",(function(){return b})),s.d(t,"l",(function(){return C})),s.d(t,"c",(function(){return A}));var a=s("VTBJ"),n=s("n39p"),i=s("AM4K"),o=s("P6UB"),r=s("1pet"),l=s("z0WU"),c=s("UiPd"),d=s("c51z"),h=s("yFRN"),u=s("Yi2m"),_=s("zTwE"),m=s("fcv9"),p=s("l6RJ");function g(e,t=!1){let s=3.5;return e>=720&&!t?s=4.5:e<720&&t&&(s=2.5),s*n.b}function E(e,t,s){switch(s){case"object":return i.a.contextDate(e,t,null,!0);case"string":return i.a.contextDate(e,t,!0);default:return i.a.contextDate(e,t)}}function f(e){return null==e?void 0:e[0]}function I(e){if(null==e||0===e.length)return null;const t=Date.now();let s=null;const i=(e,t,s)=>((null==e||s<e.upcomingTime)&&(e=Object(a.a)(Object(a.a)({},t),{},{upcomingTime:s})),e);for(let a=0;a<e.length;a++){var o,r;const d=e[a];if(!d)continue;let h=null;(null===(o=d.repeatInfo)||void 0===o||null===(r=o.list_ts)||void 0===r?void 0:r.length)>0&&(h=d.repeatInfo.list_ts);let u=0;if(u=h?h[0]:d.startTime,"number"!=typeof u)try{u=parseInt(d.startTime)}catch(c){l.default.logCoreInfo("Try to parse number failed.");continue}let _=u-t;if(_<0){let e=!1;if(h)for(let s=1;s<h.length;s++)if(u=h[s],_=u-t,_>=0){e=!0;break}if(!e)continue}if(!(_>n.g.A_WEEK))switch(d.repeat){case n.f.NONE:_<=n.g.A_WEEK&&(s=i(s,d,_));break;case n.f.DAILY:_<=n.g.THIRTY_MINUTE&&(s=i(s,d,_));break;case n.f.WEEKLY:_<=n.g.A_DAY&&(s=i(s,d,_));break;case n.f.MONTHLY:_<=n.g.THREE_DAY&&(s=i(s,d,_));break;case n.f.YEARLY:_<=n.g.A_WEEK&&(s=i(s,d,_))}}return s&&delete s.upcomingTime,s}function T(e){let t={};try{var s,a;t=JSON.parse(e.params),(null===(s=t)||void 0===s||null===(a=s.extra)||void 0===a?void 0:a.constructor)===String&&(t.extra=JSON.parse(t.extra))}catch(n){l.default.logCoreError("Failed to parse topic")}return t}function v(e){const t=e.params||{};let s=!1,u="",g="",E=null,f=t?t.title:"";switch(e.type){case r.TEXT_TOPIC:if(e.startTime>0){let t={time:"HH:mm",date:{type:"WD DD/MM/YYYY"}};f=i.a.contextDate(e.startTime,t)}break;case r.LINK_TOPIC:if(e.startTime>0){let t={time:"HH:mm",date:{type:"WD DD/MM/YYYY"}};f=i.a.contextDate(e.startTime,t)}else f=`[${t.src}] ${t.linkCaption||""}`;break;case r.MSG_TOPIC:{var I,T,v;u="STR_PINNED_MESSAGE_2",t&&(t.senderUid&&(u=c.default.getDName(t.senderUid)),u&&0!==u.length||t.senderName&&(u=t.senderName)),f=t.title;const i=null!=(I=m.a.getMessageFromTopic(e))?I:{};let C=i.cliMsgId?Object(a.a)({},i):{};switch(C.msgType=null!=(T=C.msgType)?T:t.msg_type,C.message=null!=(v=C.message)?v:{title:f},t.msg_type){case r.MSG_TEXT:case r.CLI_MSG_TYPE_TEXT:var R;C.message=null!=(R=C.message)?R:f;break;case r.CLI_MSG_TYPE_FILE:case r.MSG_FILE:var S,O;if(E={data:{params:t},type:n.j.FILE_FOLDER},"object"==typeof C.message)C.message.params=null!=(S=null===(O=C.message)||void 0===O?void 0:O.params)?S:t.extra;break;case r.CLI_MSG_TYPE_STICKER:case r.MSG_STICKER:E={data:{},type:n.j.STICKER};break;case r.MSG_VOICE:case r.CLI_MSG_TYPE_VOICE:E={data:{icon:"fa-icon-voice"},type:n.j.ICON};break;case r.CLI_MSG_TYPE_LOCATION:case r.MSG_LOCATION:E={data:{url:_.a},type:n.j.URL};break;case r.CLI_MSG_TYPE_CONTACT:case r.MSG_CONTACT:var N,b;if("object"==typeof C.message)C.message.action=null!=(N=null===(b=C.message)||void 0===b?void 0:b.action)?N:t.extra.action;s=o.b.isMultiURL(t&&t.title,!0),s||(E={data:{params:t},type:n.j.THUMB_IMAGE});break;case r.CLI_MSG_TYPE_PHOTO:if(t.thumb&&(E={data:{url:t.thumb},type:n.j.URL},i.toUid&&i.sendDttm)){E.type=n.j.PHOTO;const e=Object(p.a)(t.thumb,i.toUid);E.data=Object(a.a)(Object(a.a)({},E.data),{},{localPath:e,localUrl:Object(p.b)(e),convId:i.toUid,sendDttm:i.sendDttm})}t.extra&&1===t.extra.subType&&(E&&(E.type=n.j.STICKER),C.properties||(C.properties={type:r.MSG_BUBBLE_LAYOUT_TYPE_NO_BORDER}));break;default:t.thumb&&(E={data:{url:t.thumb},type:n.j.URL})}if(!s){const e=function(e,t=!0){const s={prefix:"",content:""};let a=t?l.default.ZSafeFunction((()=>e.message.title||""),""):"";if(!e)return s;switch(e.msgType){case r.MSG_ARTICLE:return s.prefix=d.default.str("STR_ARTICLE_MSG_NO_BRACKET","Bài viết"),s;case r.MSG_VOICE:case r.CLI_MSG_TYPE_VOICE:return s.prefix=d.default.str("STR_VOICE_MSG_NO_BRACKET","Tin nhắn thoại"),s;case r.MSG_TEXT:case r.CLI_MSG_TYPE_TEXT:return s.prefix=d.default.str("STR_MSG_NOT_SUPPORTED_NO_BRACKET","Tin nhắn chưa hỗ trợ ở phiên bản hiện tại"),e.message&&("string"==typeof e.message?(s.prefix="",s.content=o.b.replaceMentionedNames(e.message,e.mentions)):a&&(s.prefix="",s.content=o.b.replaceMentionedNames(a,e.mentions))),s;case 10:return e.message.message?s.content=o.b.replaceMentionedNames(e.message.message,e.mentions):s.content=o.b.replaceMentionedNames(e.message,e.mentions),s;case r.MSG_PHOTO:case r.CLI_MSG_TYPE_PHOTO:return l.default.isPhotoStickerMessage(e)?s.prefix="Sticker":(s.prefix=d.default.str("STR_PHOTO_MSG_NO_BRACKET","Hình ảnh"),s.content=o.b.replaceMentionedNames(a,e.mentions)),s;case r.MSG_CONTACT:case r.CLI_MSG_TYPE_CONTACT:var n,i,u,_,m;return"recommened.link"===(null===(n=e.message)||void 0===n?void 0:n.action)?(s.prefix=d.default.str("STR_LINK_MSG_NO_BRACKET","Link"),s.content=o.b.replaceMentionedNames(a,e.mentions)):"recommened.misscall"===(null===(i=e.message)||void 0===i?void 0:i.action)?s.prefix=d.default.str("STR_MISS_CALL_MSG_NO_BRACKET","Cuộc gọi nhỡ"):"recommened.stickerset"===(null===(u=e.message)||void 0===u?void 0:u.action)?(s.prefix=d.default.str("STR_STICKERSET_MSG_NO_BRACKET","Bộ sticker"),s.content=a):"recommened.calling"===(null===(_=e.message)||void 0===_?void 0:_.action)?s.prefix=d.default.str("STR_OUTCALL_MSG_NO_BRACKET","Cuộc gọi đi"):"recommened.receivecall"===(null===(m=e.message)||void 0===m?void 0:m.action)?s.prefix=d.default.str("STR_INCALL_MSG_NO_BRACKET","Cuộc gọi đến"):(e.message&&(a=c.default.getDName(e.message.params)||e.message.title),s.prefix=d.default.str("STR_CONTACT_MSG_NO_BRACKET","Danh thiếp"),s.content=a),s;case r.MSG_GIF:case r.CLI_MSG_TYPE_GIF:return s.prefix="GIF",s;case r.MSG_STICKER:case r.MSG_STICKER_2:case r.CLI_MSG_TYPE_STICKER:return s.prefix="Sticker",s;case r.CLI_MSG_TYPE_LOCATION:case r.MSG_LOCATION:return!a&&t&&(a=l.default.ZSafeFunction((()=>{var t,s;return(null===(t=e.message)||void 0===t?void 0:t.desc)||(null===(s=e.message)||void 0===s?void 0:s.description)||""}),"")),s.prefix=d.default.str("STR_LOC_MSG_NO_BRACKET","Vị trí"),s.content=a,s;case r.MSG_VIDEO:case r.CLI_MSG_TYPE_VIDEO:return s.prefix="Video",s.content=a,s;case r.MSG_FILE:case r.CLI_MSG_TYPE_FILE:var p;if(null!==(p=e.message)&&void 0!==p&&p.params){let t=e.message.params;if(t&&"string"==typeof t)try{t=JSON.parse(t)}catch(v){}if(h.a.isFolderParams(t))return a=h.a.getFolderTitle(a),s.prefix=d.default.str("STR_FOLDER_MSG_NO_BRACKET","Thư mục"),s.content=a,s}return s.prefix=d.default.str("STR_FILE_MSG_NO_BRACKET","File"),s.content=a,s;case r.MSG_UNDO:return s.prefix=d.default.str("STR_UNDO_MSG","Tin nhắn đã thu hồi"),s;case r.MSG_DEL_EVERYONE:return s.prefix=d.default.str("STR_DEL_EVERYONE","Tin nhắn đã bị xóa"),s;case r.MSG_DOODLE:case r.CLI_MSG_TYPE_DOODLE:return s.prefix=d.default.str("STR_DOODLE_MSG_NO_BRACKET","Hình vẽ tay"),s;case r.MSG_OA:if(e.message)for(let t=0;t<e.message.length;t++){let a=e.message[t];if("l.a.header.only"===a.type||"l.a.header.full"===a.type)return s.content=a.title,s}return s.prefix=d.default.str("STR_MSG_NOT_SUPPORTED_NO_BRACKET","Tin nhắn chưa hỗ trợ ở phiên bản hiện tại"),s;case r.MSG_GROUP_NOTI:case r.MSG_FRIEND_SENT_REQUEST:case r.MSG_SUGGEST_IN_CHAT:case r.MSG_INFO:return s.content=e.message,s;case r.MSG_TODO:var g,E;return(null===(g=e.message)||void 0===g?void 0:g.constructor)===String?s.content=e.message:(null===(E=e.message)||void 0===E?void 0:E.constructor)===Object&&(s.content=e.message.message),s;case r.MSG_ECARD:var f,I;return s.prefix=d.default.str("STR_CARD_MSG_NO_BRACKET","Thiệp"),null!==(f=e.message)&&void 0!==f&&null!==(I=f.params)&&void 0!==I&&I.previewTxt&&(s.prefix="",s.content=e.message.params.previewTxt),s;case r.MSG_POLL:var T;if((!a||a.length<=0)&&null!==(T=e.message)&&void 0!==T&&T.params){let t={};try{t=JSON.parse(e.message.params),a=t.question}catch(R){}}return s.prefix=d.default.str("STR_POLL_MSG_NO_BRACKET","Bình chọn"),s.content=a,s;case r.MSG_INFO_CHAT:return s.content=e.message,s;default:return s.prefix=d.default.str("STR_MSG_NOT_SUPPORTED_NO_BRACKET","Tin nhắn chưa hỗ trợ ở phiên bản hiện tại"),s}}(C);g=e.prefix,e.content&&(f=e.content)}break}}return[u,g,E,f]}function R(e){switch(e){case r.TEXT_TOPIC:return"STR_UNPIN_NOTICE";case r.LINK_TOPIC:return"STR_DELETE_UNPINNED_MSG";case r.MSG_TOPIC:return"STR_UNPIN_NOTICE";case r.POLL_TOPIC:return"STR_UNPIN_POLL";case r.REMINDER_TOPIC:return"STR_UNPIN_REMINDER";default:return"STR_UNPIN_MSG"}}function S(e){switch(null==e?void 0:e.type){case r.TEXT_TOPIC:case r.LINK_TOPIC:return!0;case r.MSG_TOPIC:{const t=e.params;if((null==t?void 0:t.msg_type)===r.MSG_TEXT)return!0;if((null==t?void 0:t.msg_type)===r.CLI_MSG_TYPE_CONTACT){let e=t.extra;if(e&&"recommened.link"===e.action)return!0}return!1}case r.POLL_TOPIC:case r.REMINDER_TOPIC:default:return!1}}function O(e,t){return e.type!==r.MSG_TOPIC&&e.type!==r.POLL_TOPIC&&t}function N(e){const t=null!=(null==e?void 0:e.id)?e.id:null==e?void 0:e.poll_id;let s=null!=(null==e?void 0:e.type)?e.type:r.POLL_TOPIC;return s===r.TEXT_TOPIC&&e.startTime>0&&(s=r.REMINDER_TOPIC),{id:t,type:s}}function b(e={}){let t=e.id,s=e.type;return null==t&&(t=e.topicId),null==s&&(s=e.topicType),{topicId:t,topicType:s}}function C(e){if(!e||0===e.length)return!1;for(let s=0;s<e.length;s++){var t;if(null!==(t=e[s])&&void 0!==t&&t.unread)return!0}return!1}function A(e){u.e.logAction(e)}},"2+yl":function(e,t,s){"use strict";var a=s("rePB"),n=s("ZCU6");s.d(t,"a",(function(){return n.a}));s("DNFe");var i=s("NDmK"),o=s("MPLC");const r=new class{constructor(){Object(a.a)(this,"cacheMessageLoader",new Map)}cleanUp(e,t){var s;if(e!==t){if(i.c.message_loader.max_active_conversation&&this.cacheMessageLoader.size>i.c.message_loader.max_active_conversation){const e=this.cacheMessageLoader.size-i.c.message_loader.max_active_conversation;if(e>0){const s=this.cacheMessageLoader.entries();for(let a=0;a<e;a++){const[e,a]=s.next().value;e!=t&&(a&&a.deActive(),this.cacheMessageLoader.delete(e))}}}else{var a;if(e)null===(a=this.cacheMessageLoader.get(e))||void 0===a||a.deActive(),this.cacheMessageLoader.delete(e)}null===(s=this.cacheMessageLoader.get(t))||void 0===s||s.active()}else{var n;null===(n=this.cacheMessageLoader.get(t))||void 0===n||n.active()}}async jumpByMsgId(e,t){const s=null==t?void 0:t.userId;if(!s)throw"Invalid threadId";this.cacheMessageLoader.has(s)||this.cacheMessageLoader.set(s,new n.c(s));const a=this.cacheMessageLoader.get(s);if(!a)throw"error load";return a.jumpByMsgId(e,t)}async jumpToMessage(e,t,s){var a;t||(t=null===(a=o.b.messageCache)||void 0===a?void 0:a.getConversationIdForMsgId(e.msgId));if(!t)throw"Invalid threadId";this.cacheMessageLoader.has(t)||this.cacheMessageLoader.set(t,new n.c(t));const i=this.cacheMessageLoader.get(t);if(!i)throw"error load";return i.jumpToMessage(e,s)}changeConversation(e,t){this.cleanUp(e,t)}changeContextLoader(){}removeRequestCacheByGroupId(e){var t;return null===(t=new n.c(e))||void 0===t?void 0:t.removeRequestCacheByGroupId()}async getLastMessagesForConversation(e,t){if(!e)throw"Invalid threadId";this.cacheMessageLoader.has(e)||this.cacheMessageLoader.set(e,new n.c(e));const s=this.cacheMessageLoader.get(e);if(!s)throw"error load";return s.getLastMessagesForConversation(t)}async loadTopMessagesForConversation(e,t,s){if(!e)throw"Invalid threadId";this.cacheMessageLoader.has(e)||this.cacheMessageLoader.set(e,new n.c(e));const a=this.cacheMessageLoader.get(e);if(!a)throw"error load";return a.loadTopMessagesForConversation(t,s)}async loadBottomMessagesForConversation(e,t,s){if(!e)throw"Invalid threadId";this.cacheMessageLoader.has(e)||this.cacheMessageLoader.set(e,new n.c(e));const a=this.cacheMessageLoader.get(e);if(!a)throw"error load";return a.loadBottomMessagesForConversation(t,s)}};t.b=r},"22X3":function(e,t,s){"use strict";var a=s("z0WU");class n{constructor(e){this.tag=e||"no_tag"}info(e,...t){this.logInfo&&this.logInfo(`- ${e},`,...t)}error(e,t){this.logErr&&this.logErr(`- ${e},`,...t)}}class i extends n{constructor(e){super(e),this.logInfo=a.default.logCoreInfo.bind(a.default,this.tag),this.logErr=a.default.logCoreError.bind(a.default,this.tag)}}t.a=class{constructor(e){this.tag=e||"no_tag",this.logger=new i(this.tag)}info(e,...t){this.logger&&this.logger.info(e,...t)}error(e,t){this.logger&&this.logger.error(e,t)}}},"29Tt":function(e,t,s){"use strict";t.a="assets/tooltip-icon-star.89db14def5d8ee79947180bfd7813bbd.svg"},"2Atq":function(e,t,s){"use strict";s.d(t,"g",(function(){return n})),s.d(t,"f",(function(){return i})),s.d(t,"e",(function(){return o})),s.d(t,"d",(function(){return r})),s.d(t,"a",(function(){return l})),s.d(t,"c",(function(){return c})),s.d(t,"b",(function(){return d}));var a=s("x3ps");const n={IMAGE:"MediaImage",FILE:"MediaFile",LINK:"MediaLink"},i={IMAGE:"images",FILE:"files",LINK:"links"},o={DATE:"Date",ITEM:"Item",PREV_YEAR:"PrevYear",FILTER_EMPTY:"FilterEmpty",EMPTY:"Empty",LOADING_INDICATOR:"LoadingIndicator"},r={DATE:"date_",ITEM:"item_",PREV_YEAR:"year_",FILTER_EMPTY:"filterEmpty",EMPTY:"empty",LOADING_INDICATOR:"loadingIndicator"},l=4,c=a.b,d=50},"2GhE":function(e,t,s){"use strict";var a=s("+y1A"),n=s("fAKS"),i=s("1Abx"),o=s("NzUN"),r=s("PoHQ"),l=s("z0WU");const c="render"===__ZaBUNDLENAME__||"WEB"===__ZaBUNDLENAME__,d=new o.a(1e3);const h=new class{constructor(){this.__pendingAdd=[],this.__running=!1,this._pendingReq={},this.__fireUpdateItem=this.__fireUpdateItem.bind(this)}init(e,t){c&&(l.default.logCoreInfo("[MetaInfoMessageManager] init"),i.b.init())}run(e){if(!e||!c)return;let t=!1;["delivereds","groupSeens"].forEach((s=>{if(!e[s]||!e[s].length)return;e[s].forEach((e=>{if(!e||!e.msgId||isNaN(e.msgId))return;let s=+e.msgId,n=e.seenUids||[],i=e.deliveredUids||[];if(n.length+i.length){let e=new a.a({msgId:s,seenUids:n,deliveredUids:i});t=!0,this.__pendingAdd.push(e)}}))})),t&&this.__wakeQueue()}__merge(e,t){e.msgId==t.msgId&&e.merge(t)}__batchEvents(){if(!this.__pendingAdd.length)return;let e=[...this.__pendingAdd];this.__pendingAdd=[];let t={};for(let s=0;s<e.length;s++){let a=e[s],n=t[a.msgId];if(null!=n){let e=this.__pendingAdd[n];this.__merge(e,a)}else this.__pendingAdd.push(a),t[a.msgId]=this.__pendingAdd.length-1}}__fireUpdateItem(e){e&&e.msgId&&r.default.triggerEvent(r.INTERNAL_CHANNEL_MSG_INFO_CHANGED,[e.msgId,e])}__doAfterAdd(e=!1,t=null){e&&t&&this.__fireUpdateItem(t),this.__running=!1,this.__wakeQueue()}__wakeQueue(){this.__running||this._doAdd()}__doAdd(e){return new Promise(((t,s)=>{if(!e||e.constructor!==a.a)return s("invalid item");let i=d.get(e.msgId);i&&i.merge(e),n.b.updateMsgInfoItem(e.msgId,e).then(t).catch((e=>{s(e)}))}))}_clearTimeoutAdd(){this._timeoutAdd&&clearTimeout(this._timeoutAdd),this._timeoutAdd=null}_setTimeoutAdd(){this._clearTimeoutAdd(),this._timeoutAdd=setTimeout((()=>{this.__doAfterAdd(!1,"timeout")}),3e4)}_doAdd(){if(this.__running||!this.__pendingAdd.length)return;this.__batchEvents();let e=this.__pendingAdd.shift();this.__running=!0,this._setTimeoutAdd(),this.__doAdd(e).then((e=>{this.__doAfterAdd(!0,e)})).catch((e=>{this.__doAfterAdd(!1,e)}))}_get(e){return new Promise(((t,s)=>{n.b.getMsgInfoItem(e).then(t).catch(s)}))}get(e){return new Promise(((t,s)=>{if(!(e=+e)||isNaN(e))return s("invalid_msgId");let n=d.get(e);return n?t(n.toJson()):this._pendingReq[e]?t(this._pendingReq[e]):(this._pendingReq[e]=this._get(e),void this._pendingReq[e].then((s=>{if(delete this._pendingReq[e],s){let t=new a.a(s);d.set(e,t)}t(s)})).catch((t=>{delete this._pendingReq[e],s(t)})))}))}};t.a=h},"2K55":function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return r}));var a=s("4c4j"),n=s("z0WU");const i=Object.freeze({GET_ALL:1,ADD:2,CLEAR:3,FOR_EACH:4,DELETE_BY_IDS:6,FILTER_KEYRANGE:8}),o={QOS_STORE_V2:"qoslogv2",ACTION_LOG_STORE:"actionlog"},r={QOS_STORE_V2:{TS:"ts"}};const l=new class{constructor(){this._process={[i.GET_ALL]:this._getAll.bind(this),[i.ADD]:this._add.bind(this),[i.CLEAR]:this._clear.bind(this),[i.FOR_EACH]:this._foreach.bind(this),[i.DELETE_BY_IDS]:this._deleteByKeys.bind(this),[i.FILTER_KEYRANGE]:this._filterKeyRange.bind(this)}}_getAll(e){return new Promise(((t,s)=>{a.ZDB.Qos.store(e).getAll().then((e=>{if(null!=e&&e.length)return t(e);t([])})).catch((t=>{n.default.logCoreError(`${e}:getall:error`,t),s(t)}))}))}_foreach(e,{action:t,stop:s}){return new Promise(((n,i)=>{let o=0;a.ZDB.Qos.runTransaction([e],(e=>{let[a]=e,n=!1;a.openCursor(null,void 0,{shouldStop:()=>n,onValue:(e,a)=>{t(a,o),n=s(a,o),o++}})}),a.ZDB.TransMode.READWRITE).then(n).catch(i)}))}_filterKeyRange(e,{keyRange:t,index:s=null,count:n=null}){return new Promise(((i,o)=>{if(!s)return o("invalid_index");a.ZDB.Qos.runTransaction([e],(e=>{let[a]=e;a=a.index(s),a.getKeys(t,n).then((e=>{if(null!=e&&e.length)return i(e);i([])})).catch(o)}),a.ZDB.TransMode.READONLY).then((()=>{i([])})).catch(o)}))}_add(e,t){return new Promise(((s,n)=>{let i=0;a.ZDB.Qos.runTransaction([e],(e=>{let[s]=e;for(let a of t)s.put(a);s.count().then((e=>{i=e})).catch(n)}),a.ZDB.TransMode.READWRITE).then((()=>{s(i)})).catch(n)}))}_clear(e){return new Promise(((t,s)=>{t(a.ZDB.Qos.store(e).clearStore())}))}_deleteByKeys(e,t){return new Promise(((s,n)=>{let i=0;a.ZDB.Qos.runTransaction([e],(e=>{let[s]=e;for(const a of t)s.delete(a);s.count().then((e=>{i=e})).catch(n)}),a.ZDB.TransMode.READWRITE).then((()=>{s(i)})).catch(n)}))}_doAction(e){this._process[e.type](e.storeName,e.data).then(e.successCallback).catch(e.errorCallback)}getAll(e,t,s){this._doAction({storeName:e,type:i.GET_ALL,successCallback:t,errorCallback:s})}add(e,t,s,a){this._doAction({storeName:e,type:i.ADD,data:t,successCallback:s,errorCallback:a})}clear(e,t,s){this._doAction({storeName:e,type:i.CLEAR,successCallback:t,errorCallback:s})}deleteByKeys(e,t,s,a){this._doAction({storeName:e,data:t,type:i.DELETE_BY_IDS,successCallback:s,errorCallback:a})}foreach(e,t,s,a){this._doAction({storeName:e,data:t,type:i.FOR_EACH,successCallback:s,errorCallback:a})}checkStoreName(e,t,s){this._doAction({storeName:e,type:i.CHECK_STORE_NAME,successCallback:t,errorCallback:s})}filterKeyRange(e,t,s,a){this._doAction({storeName:e,data:t,type:i.FILTER_KEYRANGE,successCallback:s,errorCallback:a})}};t.c=l},"2dHM":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s("oMA/"),n=s("oTQY"),i=s("al6a");const o={INIT:"init",LOGIN:"login",CORE:"core",WEBSOCKET:"websocket",ZAVI_DEV:"ZAVI_DEV",CUSTOM:"custom"};class r{constructor(e,t,s){this.type=t,this.lastSwitchTime=0,this.mainDomain=s,this.activeDomain=s,this.fallbackDomain=s,this.domains=null,e&&e.constructor==Array&&e.length>0&&(this.domains=e,this.activeDomain=this.domains[0],this.mainDomain=this.domains[0])}_log(e){n.a.logInfo("[Domain Manager] "+e)}isBelongTo(e){return!!e&&(!(!this.fallbackDomain||!e.startsWith(this.fallbackDomain))||this.domains.find((t=>!(!t||!e.startsWith(t)))))}setActiveToMainDomain(){this.domains&&this.domains.constructor==Array&&this.domains.length>0?this.activeDomain=this.mainDomain:this.activeDomain=this.fallbackDomain,this.lastSwitchTime=Date.now()}getMainDomain(){return this.mainDomain}getActiveDomain(){if(!a.b.enableSwapDomain)return this._log("Force use default domain => "+this.fallbackDomain),this.fallbackDomain;if(this.activeDomain!=this.getMainDomain()&&Date.now()-this.lastSwitchTime>3e5){let e=this.activeDomain;return this.setActiveToMainDomain(),this._log("Revert active to main from: "+e+" to: "+this.activeDomain),this.activeDomain}return this.activeDomain}switchNextDomain(){if(this.domains&&this.domains.constructor==Array&&this.domains.length>1){if(Date.now()-this.lastSwitchTime<5e3)return void this._log("Ignore switch due to recent done");let e=this.domains.indexOf(this.activeDomain)+1;e>this.domains.length-1&&(e=0),this._log("Switch domain success from: "+this.activeDomain+" to "+this.domains[e]),this.activeDomain=this.domains[e],this.lastSwitchTime=Date.now()}}}const l=new class{constructor(){this.mappingDomain=new Map,this.supportDomainTypes=Object.values(o)}_log(e){n.a.logInfo((new Date).toLocaleString()+"[Domain Manager] "+e)}_error(){n.a.logError((new Date).toLocaleString()+"[Domain Manager] ")}switchDomain(e){if(e&&a.b.enableSwapDomain){this._log("Try switch another domain: "+e);for(let[t,s]of this.mappingDomain)if(s&&s.constructor==r&&(this._log("Finding belong to which domain, checking: "+s.type),s.isBelongTo(e))){s.switchNextDomain(e),this._log("Found domain belong to: "+s.type+" / origin url: "+e);break}}else this._log("Reject swap domain enable flag: "+a.b.enableSwapDomain)}getDomainByType(e,t=!1){if(e===o.ZAVI_DEV)return"https://api-dev.zavi.me";if(e===o.INIT)return i.a.getLastCompanyDomain()||this.getInitDomain();if(e===o.LOGIN)return this.getInitDomain();let s=this.mappingDomain.get(e);return s&&s.constructor==r?s.getActiveDomain():(t||this._error("Domain type not exist: "+e),this.getInitDomain())}getDomainObjectByType(e){return this.mappingDomain.get(e)}getDevDomain(){return this.getDomainByType(o.ZAVI_DEV)}getInitDomain(){return a.b.initDomain}getLoginDomain(e=!1){return this.getDomainByType(o.LOGIN,e)}getCoreDomain(e=!1){return this.getDomainByType(o.CORE,e)}getWebSocketDomain(e=!1){return this.getDomainByType(o.WEBSOCKET,e)}setServicesMap(e){if(e&&e.constructor==Object){for(const t in e)if(t&&this.supportDomainTypes.indexOf(t)>=0){let s="",a=[];e.hasOwnProperty(t)&&e[t]&&e[t].constructor==Array&&(a=e[t]),!s&&a.length>0&&(s=a[0]),this.mappingDomain.set(t,new r(a,t,s))}this.mappingDomain.set(o.WEBSOCKET,new r(["ws://localhost:4002/","ws://localhost:4001/"],o.WEBSOCKET,"ws://localhost:4002/"))}}cleanServiceMap(){this.mappingDomain.clear()}};t.b=l},"2fo3":function(e,t,s){"use strict";t.a="assets/vanish_onboard.95edcd15d875cae4d6d504d739eaa977.png"},"2gQH":function(e,t,s){"use strict";var a=s("z0WU");const n="z_nom";const i=new class{constructor(){this.setNumberOfMessages=a.default.throttle((e=>{this._setNumberOfMessages(e)}),1e3)}getNumberOfMessages(){return("undefined"!=typeof localStorage&&window.localStorage.getItem(n)||12345)-12345}_setNumberOfMessages(e){"undefined"!=typeof localStorage&&window.localStorage.setItem(n,e+12345)}increaseNumberOfMessages(e){0!=e&&(isNaN(e)?a.default.logCoreError("adding "+e+" to total messages--\x3e smth wrong"):(null==this._totalMsg&&(this._totalMsg=this.getNumberOfMessages()),this._totalMsg+=e,this.setNumberOfMessages(this._totalMsg)))}};t.a=i},"2jOg":function(e,t,s){"use strict";t.a=(e,t)=>{const s=new Set,a=[];let n,i,o=0;for(;o<t.length;)i=t[o],n=e(i),s.has(n)||(s.add(n),a.push(i)),o+=1;return a}},"2pdp":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=s("17x9"),o=s.n(i),r=s("iuhU"),l=s("1pet");const c=function(e){const{topicType:t=l.MSG_TOPIC}=e,s=function(e){switch(e){case l.TEXT_TOPIC:case l.LINK_TOPIC:return"outline-noted";case l.MSG_TOPIC:return"outline-message";case l.POLL_TOPIC:return"outline-poll";case l.REMINDER_TOPIC:return"outline-reminder";default:return"outline-message"}}(t),a=function(e){switch(e){case l.TEXT_TOPIC:case l.LINK_TOPIC:return"orange";case l.MSG_TOPIC:return"blue";case l.POLL_TOPIC:return"green";case l.REMINDER_TOPIC:return"var(--red-300)";default:return"blue"}}(t);return n.a.createElement("div",{className:"icon-container"},n.a.createElement("div",{className:"icon-content"},n.a.createElement("i",{className:`fa fa-${s} icon-img icon-img__${a}`})))};c.propTypes={topicType:o.a.oneOf([l.TEXT_TOPIC,l.LINK_TOPIC,l.MSG_TOPIC,l.POLL_TOPIC,l.REMINDER_TOPIC])};var d=c,h=s("lCMA"),u=s("2+pv"),_=s("n39p"),m=s("Jgga"),p=s("DWOr"),g=s("z0WU"),E=s("oDBB"),f=s("wA+B"),I=s("fjQr"),T=s("h9Os");const v=n.a.createElement(I.a,{className:"thumb-preview",caption:!1}),R=n.a.createElement(T.a,{className:"thumb-preview",caption:!1}),S=e=>e instanceof f.a.ExpireError?R:v,O=n.a.createElement("div",{className:"thumb-preview"});var N=s("vSga"),b=s("fcv9");const C=function(e){const{topic:t={},size:s}=e,[i,o]=Object(a.useState)("");Object(a.useEffect)((()=>{var e,s,a,n;if((null===(e=t.params)||void 0===e?void 0:e.msg_type)===l.MSG_STICKER||(null===(s=t.params)||void 0===s?void 0:s.msg_type)===l.CLI_MSG_TYPE_STICKER)if(null!==(a=t.params)&&void 0!==a&&a.extra){var i,r,c,d;const e={catId:null===(i=t.params.extra)||void 0===i?void 0:i.catId,stickerId:null===(r=t.params.extra)||void 0===r?void 0:r.id};N.g.getStickerIfNotExist(null===(c=t.params.extra)||void 0===c?void 0:c.catId,null===(d=t.params.extra)||void 0===d?void 0:d.id).then((t=>{t&&t.id===e.stickerId&&t.cateId===e.catId&&o((null==t?void 0:t.stickerUrl)||"")}))}else null!==(n=t.params)&&void 0!==n&&n.thumb&&o(t.params.thumb||"")}),[t.id]);const{type:r}=Object(u.i)(t),c=function(e){switch(e){case l.TEXT_TOPIC:case l.LINK_TOPIC:return"STR_NOTE_TITLE";case l.MSG_TOPIC:return"STR_MSG_TITLE";case l.POLL_TOPIC:return"STR_POLL_TITLE";case l.REMINDER_TOPIC:return"STR_REMINDER_TITLE";default:return"STR_MSG_TITLE"}}(r);let d=null,f=null,I=null,T=null,[R,b,C,A]=Object(u.h)(t);R&&(d=R.length>14&&s===_.i.SMALL?n.a.createElement("div",{className:"content-message-name ws-pre"},`${R.substring(0,13)}`,"…"," :"):n.a.createElement("div",{className:"content-message-name ws-pre"},`${R}:`)),(null==C?void 0:C.type)===_.j.STICKER&&(C.data.url||(C.data={url:i}));const y=function(e){if(null==e)return null;const{data:t}=e;if(null!=t)switch(e.type){case _.j.STICKER:case _.j.URL:{const e=g.default.removeProtocol(t.url);return n.a.createElement(E.a,{className:"thumb-preview",url:e,error:v})}case _.j.PHOTO:return n.a.createElement(E.a,{convId:t.convId,sendDttm:t.sendDttm,url:null==t?void 0:t.url,localUrl:null==t?void 0:t.localUrl,localPath:null==t?void 0:t.localPath,className:"thumb-preview",errorRender:S,placeholder:O});case _.j.FILE_FOLDER:{const{params:e}=t;return n.a.createElement(m.a,{className:"thumb-preview__contain",extra:null==e?void 0:e.extra,title:null==e?void 0:e.title})}case _.j.ICON:return n.a.createElement("div",{className:`fa ${t.icon}`});case _.j.THUMB_IMAGE:{const{params:e}=t,s=g.default.removeProtocol(e.thumb);return n.a.createElement(p.a,{textSize:20,className:"thumb-preview-object-fit thumb-default w100 h100",doNotShowRetry:!0,href:null!=e&&e.href?e.href:null!=e&&e.title?e.title:"",src:s,noCache:!0})}default:return null}}(C);y&&(I=n.a.createElement("div",{className:"content-message-thumb-preview"},y)),b&&(f=n.a.createElement("div",{className:"content-message-type"},b)),A&&(T=n.a.createElement("div",{className:"content-message-info"},n.a.createElement("div",null,A)));let D=null;return f&&T&&(D=n.a.createElement("div",{className:"content-message-dot-separator"},"•")),n.a.createElement("div",{className:"content-container"},n.a.createElement("div",{className:"content-title-container"},n.a.createElement(h.a,{className:"content-title",textKey:c})),n.a.createElement("div",{className:"content-message-container"},d,I,f,D,T))};C.propTypes={topic:o.a.object.isRequired,size:o.a.oneOf([_.i.LARGE,_.i.SMALL]).isRequired,langIndex:o.a.number};var A=C,y=s("v/qp"),D=s("yh7P"),M=s("c51z");const P=function(e){const{number:t,hasRedDot:s}=e,a=n.a.createElement(n.a.Fragment,null,n.a.createElement(h.a,{className:"show-details-btn-content",textKey:M.default.trans("STR_PIN_MORE",[t]).toLowerCase()}),n.a.createElement("i",{className:"fa fa-solid-down-1 show-details-btn-icon"}),null);return n.a.createElement("div",{className:"show-details-container"},n.a.createElement("div",{className:"show-details-btn"},n.a.createElement(y.a,{onClick:e=>{e.stopPropagation(),Object(u.c)(_.a.PinBoard.EXPAND_BOARD),D.a.expandBoard()},size:"small",modifier:"outline"},a)))};P.propTypes={number:o.a.number.isRequired,hasRedDot:o.a.bool,langIndex:o.a.number};var w=P;const L=function(e){const{onShowContextMenu:t=(()=>{})}=e;return n.a.createElement("div",{className:"more-action-container",onClick:e=>{Object(u.c)(_.a.PinContent.CLICK_THREE_DOT),t&&t(e)}},n.a.createElement("i",{className:"fa fa-solid-more more-action-icon"}))};L.propTypes={onShowContextMenu:o.a.func};var k=L;const x=function(e){const{time:t=1,isShowFullTime:s=!1}=e,a=function(e){return e?{time:"HH:mm",date:{weekday:!0,type:"DD/MM"},format:""}:{format:"time-range"}}(s);let i;if(s){const e=Object(u.e)(t,a,"object");i=n.a.createElement("div",{className:"timer-reminder"},n.a.createElement(h.a,{textKey:"STR_DATE_AT_TIME",textArguments:[{textKey:""},{textKey:e.date},{textKey:e.date&&e.time?"STR_TIME_AT":""},""]}),n.a.createElement(h.a,{className:"bold white-space-pre-wrap",textKey:` ${e.time}`}))}else i=n.a.createElement(n.a.Fragment,null,Object(u.e)(t,a,"object"));return n.a.createElement("div",{className:"timer-container"},i)};x.propTypes={time:(o.a.number||o.a.string).isRequired,isShowFullTime:o.a.object};var U=x;const F=function(e){const{time:t,isShowTime:s=!0,isOnHover:a,isShowFullTime:i,onShowContextMenu:o}=e;let r=null;return a?r=n.a.createElement(k,{onShowContextMenu:o}):s&&(r=n.a.createElement(U,{time:t,isShowFullTime:i})),n.a.createElement("div",{className:"time-region-container"},r)};F.propTypes={time:(o.a.number||o.a.string).isRequired,isShowTime:o.a.bool,isOnHover:o.a.bool,isShowFullTime:o.a.bool,onShowContextMenu:o.a.func};var G=F,B=s("O8ue"),H=s("OymT");const j=function(e){const{topic:t,numberOfMoreTopics:s,onShowContextMenu:a,isOnHover:i,isShowFullTime:o,hasUnread:r,langIndex:c,size:d,mode:m,isChecked:p,onTick:g}=e;let E=null;m===_.h.PREVIEW&&s&&(E=n.a.createElement(w,{number:s,hasRedDot:r,langIndex:c}));let f=null;if(m===_.h.PREVIEW||m===_.h.EXPAND){const e=function(e){switch(e.type){case l.TEXT_TOPIC:case l.LINK_TOPIC:return e.createTime;case l.MSG_TOPIC:return e.editTime;case l.POLL_TOPIC:return e.createTime;case l.REMINDER_TOPIC:return e.startTime;default:return 0}}(t);f=n.a.createElement(n.a.Fragment,null,n.a.createElement(G,{time:e,isShowTime:t.startTime>0,isOnHover:i,isShowFullTime:o,onShowContextMenu:a}),E)}return m===_.h.LIMIT&&(f=n.a.createElement("div",{className:"change-actions"},n.a.createElement(y.a,{onClick:e=>{e&&e.stopPropagation();const t=H.a.isOverAnotherModal()?_.a.PinLimit.EMPTY_DATA.CLICK_CHANGE_OPTION:_.a.PinLimit.HAVING_DATA.CLICK_CHANGE_OPTION;Object(u.c)(t),H.a.switchToMultiUnpinModal()},size:"small",modifier:"text"},n.a.createElement(h.a,{className:"show-details-btn-content",textKey:"STR_CHANGE"})))),m===_.h.TICK&&(f=n.a.createElement("div",{className:"change-actions"},n.a.createElement(B.a,{key:`check-box-${null==t?void 0:t.id}-${p}`,checked:p,onChange:g,type:"normal"}))),n.a.createElement("div",{className:"info-container"},n.a.createElement(A,{topic:t,size:d,langIndex:c}),n.a.createElement("div",{className:"right-action-container"},f))};j.propTypes={topic:o.a.object.isRequired,numberOfMoreTopics:o.a.number,onShowContextMenu:o.a.func,isOnHover:o.a.bool,isShowFullTime:o.a.bool,hasUnread:o.a.bool,langIndex:o.a.number,size:o.a.oneOf([_.i.LARGE,_.i.SMALL]).isRequired,mode:o.a.oneOf([_.h.PREVIEW,_.h.EXPAND,_.h.LIMIT,_.h.TICK]).isRequired,isChecked:o.a.bool,onTick:o.a.func};var V=j,K=s("VTBJ"),W=s("dThN"),Y=(s("XS0u"),s("97kL")),z=s("Yi2m"),q=s("6uTC"),X=s("1PLK"),J=s("lCn6"),Q=s("jnJr"),$=s("TrRn"),Z=s("aGMH"),ee=s("h0sc"),te=s("4wTQ");const se="1";class ae{static clearUnread(e){null!=e&&e.unread&&Q.a.clearUnread(e)}static reorderPinTopic(e,t,s){s&&s.close(),e.preventDefault(),e.stopPropagation(),Q.a.setInteractiveTopic(t),Q.a.reorderPinTopic()}static removeTopic(e,t,s){ee.a.openModal({windowId:se,name:l.ModalIdentitiesDefine.UNPIN_POPUP,params:{isShow:!0,data:{topic:t}}}),s&&s.close(),e.preventDefault(),e.stopPropagation(),z.e.logAction(1340503)}static viewMoreTopicOnBoard(e,t,s){s&&s.close();const a=Z.a.getDispatch(),n=Z.a.getEmitter();if(a||n)if(t.startTime>0)n.emit(Y.GeneralActions.OPEN_MEDIA_BOARD,{type:Y.GeneralActions.OPEN_GROUP_REMINDER_BOARD});else if(t){let e=Y.GeneralActions.OPEN_GROUP_BOARD_NOTICE;switch(t.type){case l.MSG_TOPIC:e=Y.GeneralActions.OPEN_GROUP_BOARD_PMSG;break;case l.POLL_TOPIC:e=Y.GeneralActions.OPEN_GROUP_BOARD_POLL}n.emit(Y.GeneralActions.OPEN_MEDIA_BOARD,{type:e})}e&&(e.preventDefault(),e.stopPropagation()),z.e.logAction(1340504)}static openExternalUrl(e){e&&X.b.open(e)}static copyTopic(e,t,s){if(s&&s.close(),e&&(e.preventDefault(),e.stopPropagation()),!t)return;let a="",n=t.params;if(n&&n.constructor===String)try{n=JSON.parse(n)}catch(i){}switch(t.type){case l.MSG_TOPIC:n&&(a=n.title);break;case l.LINK_TOPIC:case l.TEXT_TOPIC:n&&(n.linkCaption?a=n.linkCaption:n.title&&(a=n.title))}a.length>0?g.default.copyTextToClipboard(a):q.a.createError(M.default.str("STR_ERROR_UNKNOWN"))}static gotoMessage(e,t,s){let a=0,n=0;s&&s.msgId&&s.msgType!==l.MSG_UNDO?a=s.msgId:e&&e.params&&e.params.global_msg_id&&(a=e.params.global_msg_id,n=e.params.client_msg_id),"0"===a&&(a=0);const i=Z.a.getDispatch();te.a.jumpToMessage({msgId:a,cliMsgId:n},t.userId,i).catch((t=>{(()=>{if(e&&e.params){if(i){const t=$.a.getDefaultAuthSetting();i({type:Y.PopupActions.VIEW_NOTICE,payload:e.params,pinmsg:!0,setting:t})}}else q.a.createWarning(M.default.str("STR_MESSAGE_NOT_FOUND"))})()}))}static openViewTopic(e){const{id:t,type:s}=Object(u.i)(e),a=Q.a.getTopicSettings(t,s),n=Z.a.getDispatch();n&&n({type:Y.PopupActions.VIEW_NOTICE,payload:e,setting:a||{}})}static onOpenPoll(e,t){if(e){Z.a.getDispatch();let s=e.params;if(s){let e=s.pollId,a=t.userId;W.default.fetchPollIfNotExist(a,e).then((e=>{e?ee.a.openModal({windowId:se,name:l.ModalIdentitiesDefine.GROUP_POLL_VOTE,params:{content:Object(K.a)(Object(K.a)({},e),{},{group_id:a}),level:0}}):q.a.createError(M.default.str("STR_TOAST_ERROR_POLL_DETAIL"))})).catch((e=>{q.a.createError(M.default.str("STR_TOAST_ERROR_POLL_DETAIL"))}))}}}static onOpenReminder(e,t,s){const a=Z.a.getDispatch();J.a.openReminder(e,t,s,a)}static onClickTopic(e){const t=Q.a.getConversation()||{},s=Q.a.getUserId()||"",a=Z.a.getDispatch();switch(e.type){case 4:case l.TEXT_TOPIC:ae.openViewTopic(e,a);break;case l.LINK_TOPIC:ae.openExternalUrl(e.params&&e.params.href);break;case l.MSG_TOPIC:{const s=b.a.getMessageFromTopic(e);ae.gotoMessage(e,t,s,a);break}case l.POLL_TOPIC:ae.onOpenPoll(e,t,a);break;case l.REMINDER_TOPIC:ae.onOpenReminder(e,t,s,a)}z.e.logAction(1340301)}static showEditReminder(e,t,s){Q.a.setInteractiveTopic(t);Z.a.getDispatch();let a=t;if(a){const{id:e,type:s}=Object(u.i)(t),n=Q.a.getTopicSettings(e,s);a.startTime>0?ee.a.openModal({windowId:se,name:l.ModalIdentitiesDefine.REMINDER_COMPOSE,params:{isVisiblePopup:!0,isEdit:!0,initData:a,showPin:n&&n.allowPin||!1}}):ee.a.openModal({windowId:se,name:l.ModalIdentitiesDefine.NOTICE_COMPOSE,params:{isVisiblePopup:!0,isEdit:!0,initData:a,showPin:n&&n.allowPin||!1}})}s&&s.close(),e.preventDefault(),e.stopPropagation(),z.e.logAction(1340502)}static showEditTopic(e,t,s){Q.a.setInteractiveTopic(t);if(Z.a.getDispatch()){const{id:e,type:s}=Object(u.i)(t),a=Q.a.getTopicSettings(e,s);ee.a.openModal({windowId:se,name:l.ModalIdentitiesDefine.NOTICE_COMPOSE,params:{isVisiblePopup:!0,isEdit:!0,showPin:a&&a.allowPin||!1}})}s&&s.close(),e.preventDefault(),e.stopPropagation(),z.e.logAction(1340502)}}var ne=ae,ie=s("MEZx");function oe(e,t){const{topic:s={},canPin:a=!1,canCopy:i=!0,canEdit:o=!1,canRaise:r=!1,index:c}=e,d=[],h=s.type===l.REMINDER_TOPIC||s&&s.startTime>0;let m=null,p=null,g=null,E=null;if(a&&r){m={textKey:"STR_PIN_TO_TOP",onclick:e=>{Object(u.c)(_.a.PinContent.CLICK_PUT_TO_TOP),ne.reorderPinTopic(e,s,null==t?void 0:t.current)}}}if(i){p={textKey:"STR_COPY",onclick:e=>{Object(u.c)(_.a.PinContent.CLICK_COPY),ne.copyTopic(e,s,null==t?void 0:t.current)}}}if(o)if(h){g={textKey:"STR_EDIT_REMINDER",onclick:e=>{Object(u.c)(_.a.PinContent.CLICK_EDIT),ne.showEditReminder(e,s,null==t?void 0:t.current)}}}else{g={textKey:"STR_EDIT_NOTE",onclick:e=>{Object(u.c)(_.a.PinContent.CLICK_EDIT),ne.showEditTopic(e,s,null==t?void 0:t.current)}}}const f={textKey:h?"STR_OPEN_REMINDER_BOARD":"STR_OPEN_GROUP_BOARD",onclick:e=>{Object(u.c)(_.a.PinContent.CLICK_OPEN_GROUP_BOARD),ne.viewMoreTopicOnBoard(e,s,null==t?void 0:t.current)}};if(a){const e=Object(u.d)(-1),a=e=>{Object(u.c)(_.a.PinContent.CLICK_UNPIN),ne.removeTopic(e,s,t.current)};E={type:ie.MENU_ITEM_TYPE.DANGER,textKey:e,onclick:a}}return m&&(d.push(m),d.push({type:ie.MENU_ITEM_TYPE.SEPARATE})),p&&d.push(p),g&&d.push(g),f&&d.push(f),E&&(d.push({type:ie.MENU_ITEM_TYPE.SEPARATE}),d.push(E)),n.a.createElement(ie.default,{popoverProps:{identity:{windowId:"1",name:`${l.PopoverIdentitiesDefine.TOPIC_BANNER} ${c}`}},ref:t,items:d})}const re=Object(a.forwardRef)(oe);re.propTypes={topic:o.a.object.isRequired,canPin:o.a.bool.isRequired,canCopy:o.a.bool.isRequired,canEdit:o.a.bool.isRequired,canRaise:o.a.bool.isRequired};var le=re,ce=s("YCoq");function de(e){const{topic:t={},numberOfMoreTopics:s,isShowFullTime:i=!1,isInPreview:o,index:l=0,size:c,mode:h,hasUnread:m=!1,isChecked:p,isHighlighted:g}=e,{id:E,type:f}=Object(u.i)(t),I=Q.a.getTopicSettings(E,f),T=(null==I?void 0:I.allowPin)||!1,v=Object(u.b)(t,(null==I?void 0:I.allowEdit)||!1),R=Object(u.a)(t),[S,O]=Object(a.useState)(M.default.currentLanguage()),[N,b]=Object(a.useState)(!1),C=Object(a.useRef)(null),A=Object(a.useRef)(null),y=h===_.h.LIMIT||h===_.h.TICK,P=Object(a.useCallback)((()=>{y||b(!0)}),[]),w=h===_.h.LIMIT||h===_.h.TICK,L=Object(a.useCallback)((()=>{w||(t.unread&&!o&&ne.clearUnread(t),b(!1))}),[]),k=h===_.h.LIMIT||h===_.h.TICK,x=Object(a.useCallback)((e=>{k||(D.a.setOpenPopover(!0),A&&A.current&&A.current.show(e),e.stopPropagation())}),[]),U=h===_.h.LIMIT||h===_.h.TICK,F=Object(a.useCallback)((e=>{U||(Object(u.c)(_.a.PinContent.RIGHT_CLICK),z.e.logAction(13404),x(e))}),[]),G=h===_.h.LIMIT||h===_.h.TICK,B=Object(a.useCallback)((e=>{G||(x(e),z.e.logAction(1340501))}),[]);let j=null;h===_.h.TICK&&(j=Object(a.useCallback)((e=>{H.a.onTickTopic(t,e)}),[]));const K=h===_.h.LIMIT,W=Object(a.useCallback)((e=>{K||(j?j():(Object(u.c)(_.a.PinContent.LEFT_CLICK),D.a.collapseBoard(),ne.onClickTopic(t)))}),[t]),[,Y]=Object(a.useState)(),q=Object(a.useCallback)((()=>Y({})),[]),X=Object(a.useCallback)((()=>O(M.default.currentLanguage())),[]);Object(a.useEffect)((()=>(M.default.callUpdate(X),D.a.setCompUpdate(q),()=>{M.default.removeUpdate(X),D.a.removeUpdateComp(q)})),[]);let J=!1,$=null;if(c===_.i.LARGE){if(null!=t&&t.unread&&!o){const e=Date.now()-t.createTime;Object(ce.m)(e)||(J=!0)}$=n.a.createElement(le,{ref:A,topic:t,canPin:T,canCopy:R,canEdit:v,canRaise:!o&&0!==l,index:l})}const Z=Object(r.a)("chat-group-topic__item",h===_.h.LIMIT&&"pin-limit-item",h===_.h.TICK&&"check-unpin-item",o&&"border-two-sided",J&&!1,g&&!1);return n.a.createElement("div",{ref:C,className:Z,onMouseOver:P,onMouseLeave:L,onContextMenu:F,onClick:W},n.a.createElement(d,{topicType:f}),n.a.createElement(V,{topic:t,numberOfMoreTopics:s,onShowContextMenu:B,isOnHover:N,isShowFullTime:i,size:c,mode:h,hasUnread:m,langIndex:S,isChecked:p,onTick:j}),$)}const he=Object(a.memo)(de);he.propTypes={topic:o.a.object.isRequired,isInPreview:o.a.bool,numberOfMoreTopics:o.a.number,isShowFullTime:o.a.bool,index:o.a.number,hasUnread:o.a.bool,size:o.a.oneOf([_.i.LARGE,_.i.SMALL]).isRequired,mode:o.a.oneOf([_.h.PREVIEW,_.h.EXPAND,_.h.LIMIT,_.h.TICK]).isRequired,isChecked:o.a.bool,isHighlighted:o.a.bool};t.a=he},"2tMa":function(e,t,s){e.exports=s.p+"fav-busymode.ico"},"2um4":function(e,t,s){"use strict";var a=s("GbHB"),n=s("qYNW");const i=new class{constructor(){this._log=a.a.createEncryptLog(n.Core.debugF.bind(n.Core))}log(){this.logF(...arguments)}logF(){try{const e=[...arguments].map((e=>"object"==typeof e?JSON.stringify(e):e)).join(", ")||"[Download][UI] Empty Log, Something went wrong";this._log(e)}catch(e){n.Core.debugF(`[Download][UI][Logger][Error] ${e}`)}}};t.a=i},"2x/M":function(e,t,s){"use strict";s.d(t,"f",(function(){return i})),s.d(t,"g",(function(){return o})),s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return l})),s.d(t,"e",(function(){return c})),s.d(t,"d",(function(){return d})),s.d(t,"c",(function(){return h}));var a=s("1pet"),n=s("z0WU");const i={GET_FULL_INFO_GROUP:"GET_FULL_INFO_GROUP",GET_INFO_BASE_GROUP:"GET_INFO_BASE_GROUP",GET_INFO_GROUP:"GET_INFO_GROUP",GET_GROUPS_LIST:"GET_GROUPS_LIST",GET_GROUPS_LIST_SYNC:"GET_GROUPS_LIST_SYNC",CREATE_GROUP:"CREATE_GROUP",CHANGE_GROUP_NAME:"CHANGE_GROUP_NAME",REMOVE_MEMBER_GROUP:"REMOVE_MEMBER_GROUP",ADD_MEMBER_GROUP:"ADD_MEMBER_GROUP",CHANGE_SETTING_GROUP:"CHANGE_SETTING_GROUP",ADD_ADMIN:"ADD_ADMIN",REMOVE_ADMIN:"REMOVE_ADMIN",CHANGE_OWNER:"CHANGE_OWNER",JOIN_GROUP_BY_LINK:"JOIN_GROUP_BY_LINK",GET_VISIBILITY:"GET_VISIBILITY",START_IDLE_TASK:"START_IDLE_TASK"},o={API_GET_GROUP_LIST:"API_GET_GROUP_LIST",HANDLE_GROUP_EVENT:"HANDLE_GROUP_EVENT"},r={JOIN:"join",LEAVE:"leave",REMOVE_MEMBER:"remove_member",UPDATE_AVATAR:"update_avatar",UPDATE:"update",UPDATE_SETTING:"update_setting",JOIN_REQUEST:"join_request",JOIN_ACCEPT:"join_accept",JOIN_REJECT:"join_reject",ADD_ADMIN:"add_admin",REMOVE_ADMIN:"remove_admin"},l={UPDATE_MEMBERIDS:"UPDATE_MEMBERIDS"},c=["authorId","avatar","bgavatar","creatorId","defaultAvatar","desc","displayName","isGroup","topMember","totalMember","type","userId","visibility","lastUpdate","memberIds"],d=["lastUpdate","maxMember","memberIds","pendingApprove","pendingApproveHintShow","pendingApproveUsers","setting","subType","topMember","userId"];class h{static logInfo(e){n.default.stagingLog(`[GroupWorker] ${e}`)}static logError(e){n.default.stagingLog(`[GroupWorker] ${e}`)}static doJoinGroup(e,t){try{if(!e.displayName&&t.groupName&&(e.displayName=t.groupName),t.creatorId&&(e.creatorId=t.creatorId),t.updateMembers){const s=t=>!!e.removeMembers&&e.removeMembers.includes(t);for(const a of t.updateMembers)s(a.id)||(e.addMembers||(e.addMembers=[]),e.addMembers.push(a))}}catch(s){}}static doRemoveMemberGroup(e,t){const s=t=>{if(!e.addMembers)return!1;for(const s of e.addMembers)if(s.id==t)return!0;return!1};for(const a of t.updateMembers)s(a.id)||(e.removeMembers||(e.removeMembers=[]),e.removeMembers.push(a.id))}static checkMeLeaveGroup(e){for(const t of e.updateMembers)if(t.id==n.default.userIdMe())return!0;return!1}static doAddAdmin(e,t){if(!t.updateMembers||!t.updateMembers.length)return void(e.changeOwner=t.creatorId);for(const a of t.updateMembers)s=a.id,e.removeAdmin&&e.removeAdmin.includes(s)||(e.addAdmin||(e.addAdmin=[]),e.addAdmin.push(a));var s}static doRemoveAdmin(e,t){const s=t=>{if(!e.addAdmin)return!1;for(const s of e.addAdmin)if(s.id==t)return!0;return!1};for(const a of t.updateMembers)s(a.id)||(e.removeAdmin||(e.removeAdmin=[]),e.removeAdmin.push(a.id))}static getUpdatePendingApproveDetail(e,t){let s={};if(void 0!==e){let n=parseInt(e)||0,i=a.PENDING_APPROVE_SHOW_TYPE.CLOSE;n<=0&&(n=e&&e.uids&&e.uids.length||0),n>0&&(!t.pendingApprove||n>t.pendingApprove?i=a.PENDING_APPROVE_SHOW_TYPE.SHOW_ALL:t.pendingApproveHintShow&&t.pendingApproveHintShow===a.PENDING_APPROVE_SHOW_TYPE.CLOSE||(i=a.PENDING_APPROVE_SHOW_TYPE.REDDOT)),s={pendingApprove:n,pendingApproveHintShow:i,pendingApproveUsers:[]}}return s}}},"2y+T":function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return i}));var a=s("rePB"),n=s("Yvn0");class i{constructor({workers:e,worker:t}){Object(a.a)(this,"taskId",void 0),Object(a.a)(this,"workerId",void 0),Object(a.a)(this,"poolSize",void 0),Object(a.a)(this,"resolver",void 0),Object(a.a)(this,"idle",void 0),Object(a.a)(this,"shutdown",void 0),Object(a.a)(this,"queue",void 0),Object(a.a)(this,"workers",void 0),this.workerId=0,this.poolSize=e,this.workers=new Map(Array.from({length:this.poolSize}).map((()=>{const e=new t({id:this.workerId++});return[e.id,e]}))),this.idle=Array.from(this.workers.keys()),this.shutdown=[],this.queue=[],this.resolver={},this.taskId=0}run(){if(0==this.queue.length||0==this.idle.length)return;const e=this.queue.shift();if(e){const t=this.idle.shift();this._run(e,t)}}_run(e,t){const s=this.workers.get(t),{emitter:a,abortee:n}=this.resolver[e.id];s.process({task:e,signal:n.signal}).then((s=>{try{delete this.resolver[e.id],this.throttle(t),a.emit("end",s)}catch{}})).catch((s=>{if(e.retry>0)e.retry--,this._run(e,t);else try{delete this.resolver[e.id],this.throttle(t),a.emit("error",s)}catch{}}))}throttle(t){e((()=>{this.idle.push(t),this.run()}))}process(t){const s=new n.EventEmitter,a=new AbortController;return t.id=this.taskId++,this.resolver[t.id]={emitter:s,abortee:a},e((()=>{this.queue.push(t),this.run()})),{emitter:s,abortee:a}}}}).call(this,s("NWH6").setImmediate)},3:function(e,t){},"3+UV":function(e,t,s){"use strict";var a=s("YqGK");class n extends a.c{constructor(e){super(e)}}t.a=n},"30XY":function(e,t,s){"use strict";s.d(t,"e",(function(){return r})),s.d(t,"a",(function(){return l})),s.d(t,"c",(function(){return c})),s.d(t,"f",(function(){return d})),s.d(t,"d",(function(){return h})),s.d(t,"b",(function(){return g}));var a=s("NDmK"),n=s("z0WU"),i=(s("k/Tv"),s("6uTC")),o=s("c51z");const r={CREATE_PRODUCT:"CREATE_PRODUCT",GET_LIST_PRODUCT:"GET_LIST_PRODUCT",GET_CATALOG_LIST:"GET_CATALOG_LIST",GET_PRODUCT_INFO:"GET_PRODUCT_INFO",REMOVE_PRODUCT:"REMOVE_PRODUCT",UPDATE_PRODUCT:"UPDATE_PRODUCT",GET_INFO_CATALOG_DEFAULT:"GET_INFO_CATALOG_DEFAULT",GET_INFO_CATALOG:"GET_INFO_CATALOG",IS_FIRST_FEATURE:"IS_FIRST_FEATURE",REGISTER_FEATURE:"REGISTER_FEATURE"},l={ADD_PRODUCT:"ADD_PRODUCT",UPDATE_PRODUCT:"UPDATE_PRODUCT",OPEN_TAB_CATALOG:"OPEN_TAB_CATALOG"},c={ADD_PRODUCT:"add_prod",EDIT_PRODUCT:"edit_prod",DEL_PRODUCT:"del_prod",REGIST_PRODUCT:"enable_feature"},d={HANDLE_EVENT_CATALOG:"HANDLE_EVENT_CATALOG"},h=!1;let u,_;const m="_show_sidebar_cata";let p;class g{static logInfo(e){n.default.logCoreInfo("[CatalogProduct] "+e)}static logError(e){n.default.logCoreError("[CatalogProduct] "+e)}static isProductInfoChange(e,t){if(!e&&!t)return!1;if(!e&&t)return!0;for(const s in t)if(!n.default.valueValid(e[s])||t[s]!==e[s])return!0;return!1}static uploadPhotos(e){}static onOpenDialogWeb(e,t){const s=e.target.files;if(s){for(let e=0;e<s.length;e++){let t=s[e];if(t&&!n.default.isValidImage(t))return void(t.size&&t.size>a.c.product_catalog.limit_size_photo&&i.a.createMessage(o.default.str("STR_TOAST_LIMIT_PHOTO_CATALOG_PRODUCT"),3e3))}if(t){const e=s[0];new Promise(((t,s)=>{let a=new FileReader;a.onload=()=>{t(a.result)},a.onerror=()=>{s()},a.readAsDataURL(e)})).then((e=>{t([{base64:e}])}))}}}static choosePhotos(e,t,a){if(n.default.isWeb()){const e=t=>{this.onOpenDialogWeb(t,a),p.removeEventListener("change",e),p=null};p||(p=document.createElement("input"),p.setAttribute("type","file"),p.setAttribute("accept",".png, .jpg, .jpeg, .gif"),p.addEventListener("change",e)),p.click()}else{const n=s("vbkW"),i=n.remote.dialog,o=n.remote.getCurrentWindow();i.showOpenDialog(o,{title:t,filters:[{name:"Images",extensions:["jpg","jpeg","png","gif"]}],defaultPath:e||"",properties:["openFile"]}).then(a)}}static getBlodPhoto(e){return new Promise((t=>{const a=s("Iwwi"),i=s("Cwh7");a.stat(e,((s,o)=>{if(s)return n.default.logCoreError(s),void t(null);o.size,i.basename(e);a.readFile(e,((s,a)=>{if(s)return n.default.logCoreError(s),void t(null);let o=new Blob([new Uint8Array(a)]);o.name=i.basename(e),o.path=e,t(o)}))}))}))}static getDomainCatalogProduct(){return a.c.product_catalog.domain_link_h5_catalog}static getCurrencyUnitDefault(){return"₫"}static reformatNumberWithDot(e){if(e)return e.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,".")}static reformatPrice(e){return e?this.reformatNumberWithDot(e)+g.getCurrencyUnitDefault():"--"+g.getCurrencyUnitDefault()}static checkShowReddotSuggest(){return u}static setShowReddotSuggest(e){u=e}static checkShowReddotSidebar(){return 0}static setShowReddotSidebar(e){const t=n.default.userIdMe()+m;window.localStorage.setItem(t,JSON.stringify(e)),_=e}static isShowEntryCatalog(){return a.c.product_catalog.enable_feature&&a.c.product_catalog.register_catalog}static isLinkRegister(e){return a.c.product_catalog.enable_feature&&a.c.product_catalog.link_regist_catalog==e}static isCatalogProductLink(e){return!!e&&!!e.startsWith(g.getDomainCatalogProduct())}}},"31cx":function(e,t,s){"use strict";function a(...e){let t=e[0],s=e=>{if(e)for(let s in e)e.hasOwnProperty(s)&&("[object Object]"===Object.prototype.toString.call(e[s])?(null==t[s]&&(t[s]={}),t[s]=a(t[s],e[s])):t[s]=e[s])};for(let a=1;a<e.length;a++)s(e[a]);return t}s.d(t,"a",(function(){return a}))},"337x":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a),i=s("BZLJ"),o=s("qYNW"),r=(s("6uTC"),s("97kL"),s("egaF")),l=s("1pet"),c=(s("z0WU"),s("Q8hM"),s("lCMA"),s("c51z"),s("DPHK"),s("0qCE"),s("l+V6")),d=s("h0sc");class h extends n.a.Component{constructor(e){super(e),this.state={todoData:null}}shouldComponentUpdate(e,t){return this.state.todoData!==t.todoData}componentDidMount(){let e=this.props.data;if(!e)return;let t=[],s=[];for(let a in e)if(e.hasOwnProperty(a)){let n=e[a];n&&n.lastMsg&&(s.push(n.lastMsg),t.push(i.i.getTodoDetail(a)))}t.push(i.i.getTodoMsgs(s)),Promise.all(t).then((e=>{if(e&&e.length>1){let t=e[e.length-1],s=e.slice(0,e.length-1);for(let e=0;e<s.length;e++){let a=s[e];if(a){let n=a.id;for(let i=0;i<t.length;i++){let o=t[i];if(o&&o.message&&o.message.params&&o.message.params.params&&n===o.message.params.params.id){a.updateData=o.message.params.params.updateData,s[e]=a;break}}}}this.setState({todoData:s})}})).catch((e=>{o.Core.error("[todo] todo details failed: "+JSON.stringify(e))}))}onClose(){d.a.closeModal({windowId:"1",name:l.ModalIdentitiesDefine.TODO_MULTI_VIEW})}render(){if(!this.state.todoData||this.state.todoData.length<=0)return null;let e=this.state.todoData.map(((e,t)=>e?n.a.createElement("div",{key:`todo-mul-${t}`,style:{padding:"10px",borderBottom:"1px solid #var(--grey-300)"}},n.a.createElement(c.a,{todo:e,htmlInner:null,confirm:this.props.confirm,dispatch:this.props.dispatch,user:this.props.user,onAction:this.onClose.bind(this)})):null));return n.a.createElement(d.d,{visible:!0,showCloseButton:!0,title:"To-do",noPadding:!0,onCancel:this.onClose.bind(this),noCollapse:!0},n.a.createElement(r.b,{autoHide:!0,noHScroll:!0,noVScroll:!1,style:{height:"300px",width:"100%"}},e))}}t.a=h},"338D":function(e,t,s){"use strict";s.d(t,"b",(function(){return i}));var a=s("75pU"),n=s.n(a);t.a=class{constructor(e=1){this._pre0=0,this._pre1=1,this._factor=e}next(){let e=this._pre0+this._pre1;return this._pre0=this._pre1,this._pre1=e,e*this._factor}value(){return this._pre1*this._factor}};const i=n()((function(e){return e<=1?1:i(e-1)+i(e-2)}))},"3AlX":function(e,t,s){"use strict";var a=s("z0WU"),n=s("NDmK"),i=s("1pet"),o=s("iNuq"),r=s("pUq9"),l=s("gwig");var c=class{constructor(e,t){this._queue=[],this._lowPriorityQueue=[],this._running=[],this._waitingToRun=[],this._pendingNetworkCheck=[],this.maxConcurrent=e,this._networkState=t,this.retried=new Map,this._pendingNetworkCheckTimer=-1}onNetworkStatusChange(e){a.default.log(`send-msg: onNetworkStatusChange ${e}`),this._networkState=e,e!==l.a.DISCONNECT&&(this._queue.length||this._lowPriorityQueue.length)&&this.executeQueue(!0),e!==l.a.DISCONNECT&&e!==l.a.CONNECTED||this._processPendingNetworkCheck()}hasRetried(e){return!!this.retried.has(e)}_removeIfInList(e,t,s){for(let a=0;a<e.length;a++){const n=e[a];if(n.config.id===t)return e===this._running&&(n.retryConfig.timestamp=0),n.reject(s),e.splice(a,1),e===this._running&&this.executeQueue(),!0}return!1}cancel(e,t={cancelled:!0}){return!!this._removeIfInList(this._running,e,t)||(!!this._removeIfInList(this._queue,e,t)||(!!this._removeIfInList(this._lowPriorityQueue,e,t)||(!!this._removeIfInList(this._waitingToRun,e,t)||!!this._removeIfInList(this._pendingNetworkCheck,e,t))))}_isInRunning(e){return-1!==this._running.indexOf(e)}_removeFromRunning(e){const t=this._running.indexOf(e);return-1!==t&&(this._running.splice(t,1),!0)}_getRetryTimeout(e){let t=0;return n.c.retryConfig&&n.c.retryConfig.setting_feature&&e.timestamp&&e.timeout&&(e.timeout===i.RETRY_MSG_TIMEOUT_DEFAULT?t=n.c.retryConfig.time_retry_default:e.timeout===i.RETRY_MSG_TIMEOUT_LONG&&(t=n.c.retryConfig.time_retry_long)),t}_shouldRetry(e,t){if(!e||("ERR_NO_NETWORK"!==e.code||l.b.getStateNetwork()!==l.a.CHECKING&&l.b.getStateNetwork()!==l.a.DISCONNECT)&&"ERR_CONNECTION_TIMED_OUT"!==e.code)return!1;if("ERR_NO_NETWORK"===e.code&&!n.c.retry_err_no_network)return!1;if(0===t.count)return!1;const s=this._getRetryTimeout(t);return!!(s&&Date.now()-t.timestamp<s)&&(t.count&&t.count--,!0)}_processPendingNetworkCheck(e=!1){for(a.default.logCoreInfo(`send-msg: process pending network check ${e} ${this._networkState}`,this._pendingNetworkCheck.length);this._pendingNetworkCheck.length>0;){const t=this._pendingNetworkCheck.pop(),{config:s,retryConfig:a,resolve:n,reject:i}=t;e||this._networkState===l.a.CONNECTED?i(t._error):this._networkState===l.a.DISCONNECT&&this.enqueueLowPriority(s,a).then(n).catch(i)}e||-1===this._pendingNetworkCheckTimer||(clearTimeout(this._pendingNetworkCheckTimer),this._pendingNetworkCheckTimer=-1)}_pushToWaitingForNetworkCheck(e){a.default.logCoreInfo("send-msg: adding to pending network check",e.config),-1===this._pendingNetworkCheckTimer&&(this._pendingNetworkCheckTimer=setTimeout((()=>{this._pendingNetworkCheckTimer=-1,this._processPendingNetworkCheck(!0)}),5e4)),this._pendingNetworkCheck.push(e)}_sendRequest(e){const{config:t,retryConfig:s,resolve:i,reject:c}=e;return a.default.log(`send-msg: now ${Date.now()} - ${t.id}`),t.endpointInfo&&(t.url=r.b.getDomainByType(t.endpointInfo.domainType)+t.endpointInfo.path,t.endpointInfo.query&&(t.url+="?"+t.endpointInfo.query)),o.b.request(t).then((s=>{a.default.log(`send-msg: done ${t.id}`),this._isInRunning(e)&&(s._url=t.url,i(s),this._removeFromRunning(e),this.executeQueue())})).catch((o=>{if(this._isInRunning(e))if(this._removeFromRunning(e),o&&"ERR_NO_NETWORK"===o.code&&a.default.logCoreError(`send-msg: ERR_NO_NETWORK with network state ${l.b.getStateNetwork()}`),this._shouldRetry(o,s))if(a.default.logCoreInfo(`send-msg: retrying ${t.id}`,s,o.code),"ERR_CONNECTION_TIMED_OUT"===o.code){s._retryTimes=s._retryTimes?s._retryTimes+1:1;const n=3e4*s._retryTimes;this._waitingToRun.push(e),a.default.logCoreInfo(`send-msg: setting timeout ${n} for ${t.id}`),setTimeout((()=>{-1!==this._waitingToRun.indexOf(e)&&(a.default.logCoreInfo(`send-msg: actually retrying ${t.id}`),this.enqueueLowPriority(t,s).then(i).catch(c))}),n)}else if(n.c.retry_err_no_network&&"ERR_NO_NETWORK"===o.code){const a=l.b.getStateNetwork();a===l.a.CHECKING?(e._error=o,this._pushToWaitingForNetworkCheck(e)):a===l.a.DISCONNECT?this.enqueueLowPriority(t,s).then(i).catch(c):(c(o),this.executeQueue())}else c(o),this.executeQueue();else c(o),a.default.logCoreError(`send-msg: not retrying ${o} ${l.b.getStateNetwork()}`),this.executeQueue()}))}executeQueue(e=!1){if(this._networkState!==l.a.DISCONNECT)for(;this._running.length<=this.maxConcurrent;){let t=this._queue.shift(),s=!1;if(!t){if(t=this._lowPriorityQueue.shift(),!t)break;s=!0}e&&(this.retried.has(t.config.id)||this.retried.set(t.config.id,!0)),a.default.log(`send-msg: with ${s?"low":"high"} priority: ${t.config.id} - timeout: ${t.retryConfig.timeout} - running length: ${this._running.length}`),this._running.push(t),e||s?setTimeout((()=>{requestIdleCallback((()=>{this._isInRunning(t)&&this._sendRequest(t)}),{timeout:300})}),300*(this._running.length-1)):this._sendRequest(t)}else a.default.log("send-msg: executeQueue - no network, stopping")}_enqueue(e,t,s,a,i){const r=this._getRetryTimeout(s);let l=a,c=i;r&&null==s._timeoutTimer&&(s._timeoutTimer=setTimeout((()=>{this.cancel(t.id,Object(o.a)("retry timeout",t,"ERR_CONNECTION_TIMED_OUT",s.timestamp))}),r),l=e=>{s._timeoutTimer&&clearTimeout(s._timeoutTimer),a(e)},c=e=>{s._timeoutTimer&&clearTimeout(s._timeoutTimer),i(e)}),null==s.count&&(s.count=n.c.retryConfig.max_retry_count),e.push({config:t,retryConfig:s,resolve:l,reject:c}),this.executeQueue()}enqueue(e,t){return new Promise(((s,a)=>{this._enqueue(this._queue,e,t,s,a)}))}enqueueLowPriority(e,t){return this.retried.has(e.id)||this.retried.set(e.id,!0),new Promise(((s,a)=>{this._enqueue(this._lowPriorityQueue,e,t,s,a)}))}},d=s("PoHQ");const h=new class{constructor(){this._domainMap=new Map,this._networkState=l.b.getStateNetwork(),d.default.listenEvent(d.NETWORK_CHANGE,(e=>{this._networkState=e,this._domainMap.forEach((t=>{t.onNetworkStatusChange(e)}))}))}enqueue(e,t){return this._enqueue(e,t,!1)}enqueueLowPriority(e,t){return this._enqueue(e,t,!0)}cancel(e){for(let[t,s]of this._domainMap)if(s.cancel(e))return!0;return!1}hasRetried(e){for(let[t,s]of this._domainMap)if(s.hasRetried(e))return!0;return!1}_enqueue(e,t,s){if(!e.url)return Promise.reject("invalid request");e.id=+e.id||Date.now();const n=a.default.extractDomain(e.url);let i,o;return this._domainMap.has(n)?i=this._domainMap.get(n):(i=new c(12,this._networkState),this._domainMap.set(n,i)),o=i?s?i.enqueueLowPriority(e,t):i.enqueue(e,t):Promise.reject("unknown error"),o}};t.a=h},"3GtA":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var a=s("VTBJ"),n=s("XS0u"),i=s("dThN"),o=s("1pet"),r=s("z0WU"),l=(s("NDmK"),s("qYNW"));const c={TAB_ALL:0,TAB_TOPIC:1,TAB_PINNED_MESSAGE:2,TAB_POLL:3,TAB_ANALYZE:4};const d=new class{constructor(){this.cache={},this.notifyData={}}getGroupBoardList(e,t,s=null,c=!1,d=!1,h){let u=r.default.getRawGroupId(e),_=o.GROUPID_PREFIX+u,m=this.cache[_];this.lastItemId||(this.lastItemId={});let p=this.cache[_];return p||(p={}),p.hasOwnProperty(t)||(m=null),l.Core.error(`[gb] getGB: ${u} ${t}`),(!m||!0===c&&p[t]&&!0!==p[t].noMore)&&(m=new Promise(((e,s)=>{let r=0,c=0,m=0;p[t]&&(r=p[t].lastItemId,c=p[t].lastItemType,m=p[t].page),m++;let g=p.messages,E=p.topics,f=p.reminders,I=p.polls;g||(g={}),E||(E={}),f||(f={}),I||(I={});let T=null;T=!0===d&&!0===o.ON_FEATURE.NEW_REMINDER_API?i.default.getListBoardGroup(u,t,m,h||o.MAX_REF_LOAD_TOPIC,r,0):i.default.getListBoard(u,t,m,h||o.MAX_REF_LOAD_TOPIC,r,c),T.then((i=>{if(i){let h=[];if(i.constructor===String)try{h=JSON.parse(i),h=h.map((e=>({boardType:o.GROUP_BOARD_ITEM_TYPE.GNOTICE_TOPIC,data:e})))}catch(d){return void s(d)}else i.constructor===Object&&(h=i.items);if(h&&h.constructor===Array){if(l.Core.error(`[gb] get: ${u} ${t} ${m} ${r} ${c} ${h.length}`),h.length<=0)return p[t]=Object(a.a)(Object(a.a)({},p[t]),{},{noMore:!0}),this.cache[_]=p,void s({error_msg:"NO_MORE"});for(let e=0;e<h.length;e++){let t=h[e];if(t&&t.data){let e=-1;switch(t.boardType){case o.GROUP_BOARD_ITEM_TYPE.POLL:e=t.data.poll_id,t.data.id=e,I[e]=Object(a.a)(Object(a.a)({},t),{},{isNew:this.isUnreadItem(_,!0,t.boardType,e)});break;case o.GROUP_BOARD_ITEM_TYPE.GNOTICE_TOPIC:e=t.data.id,t.data.startTime>0?f[e]=Object(a.a)(Object(a.a)({},t),{},{isNew:this.isUnreadItem(_,!0,t.boardType,e)}):(E[e]=Object(a.a)(Object(a.a)({},t),{},{isNew:this.isUnreadItem(_,!0,t.boardType,e)}),t.data.groupId=u,n.default.setGroupTopicV2(t.data));break;case o.GROUP_BOARD_ITEM_TYPE.GNOTICE_MESSAGE:e=t.data.id,g[e]=Object(a.a)(Object(a.a)({},t),{},{isNew:this.isUnreadItem(_,!0,t.boardType,e)})}e>0&&(r=e,c=t.boardType)}}p=Object(a.a)(Object(a.a)({},p),{},{messages:g,topics:E,reminders:f,polls:I}),p[t]={lastItemId:r,lastItemType:c,page:m},this.cache[_]=p}e(p)}else l.Core.error("[gb] invalid data"),s({err_msg:"invalid_data"})})).catch((e=>{if(l.Core.error("[gb] err: "+JSON.stringify(e)),e&&"[]"==e.data)return p[t]=Object(a.a)(Object(a.a)({},p[t]),{},{noMore:!0}),this.cache[_]=p,void s({error_msg:"NO_MORE"});s(e)}))}))),m}getGroupBoardOneOneList(e,t,s=null,n=!1){let r=this.cache[e],c=this.cache[e];return c||(c={}),l.Core.error(`[gb] get11: ${e} ${t}`),(!r||!0===n&&!0!==c.noMore)&&(r=new Promise(((s,n)=>{let r=c.lastitemId||0,d=c.page||0;d++,i.default.getListBoardOneOne(e,t,d,o.MAX_REF_LOAD_TOPIC,r,0).then((i=>{if(i){let u=i;if(i.constructor===String)try{u=JSON.parse(i)}catch(h){}u||(u={});let _=u,m=c.reminders;if(m||(m={}),_&&_.constructor===Array){if(l.Core.error(`[gb] 11get: ${e} ${t} ${d} ${r} ${_.length}`),_.length<=0)return c=Object(a.a)(Object(a.a)({},c),{},{noMore:!0}),this.cache[e]=c,void n({error_msg:"NO_MORE"});for(let s=0;s<_.length;s++){let n=_[s];if(n){let s=n.reminderId,i=Object(a.a)(Object(a.a)({},n),{},{id:s});delete i.reminderId,i={boardType:o.GROUP_BOARD_ITEM_TYPE.GNOTICE_TOPIC,data:i,isNew:this.isUnreadItem(e,!1,t,s)},m[s]=i,r=s}}c={reminders:m,lastItemId:r,page:d},this.cache[e]=c}s(c)}else l.Core.error("[gb] 11invalid data"),n({err_msg:"invalid_data"})})).catch((t=>{if(l.Core.error("[gb] 11err: "+JSON.stringify(t)),t&&"[]"==t.data)return c=Object(a.a)(Object(a.a)({},c),{},{noMore:!0}),this.cache[e]=c,void n({error_msg:"NO_MORE"});n(t)}))}))),r}updateGroupBoardItem(e,t,s,a,n=!1){if(!t)return;let i=e;!0===a&&(i=o.GROUPID_PREFIX+r.default.getRawGroupId(i));let l=s;if(s===o.GROUP_BOARD_ITEM_TYPE.GNOTICE_TOPIC&&t){let e=t.params;if(e){if(e.constructor===String)try{e=JSON.parse(e)}catch(h){}e&&e.msg_type&&(l=o.GROUP_BOARD_ITEM_TYPE.GNOTICE_MESSAGE)}}let c={data:t,boardType:l,isNew:!0};this.cache||(this.cache={});let d=this.cache[i];switch(d||(d={lastItemId:0,lastItemType:0,page:0}),s){case o.GROUP_BOARD_ITEM_TYPE.POLL:{let e=t.poll_id,s=d.polls;s||(s={}),!0===n?delete s[e]:(c.data.id=e,s[e]=c),d.polls=s;break}case o.GROUP_BOARD_ITEM_TYPE.GNOTICE_TOPIC:{let e=t.id;if(t.type!==o.MSG_TOPIC){if(t.startTime>0){let t=d.reminders;t||(t={}),!0===n?delete t[e]:t[e]=c,d.reminders=t}else{let t=d.topics;t||(t={}),!0===n?delete t[e]:t[e]=c,d.topics=t}break}}case o.GROUP_BOARD_ITEM_TYPE.GNOTICE_MESSAGE:{let e=t.id,s=d.messages;s||(s={}),!0===n?delete s[e]:s[e]=c,d.messages=s;break}}this.cache[i]=d}setUnreadItem(e,t,s,i,l=!0){let c=e;!0===t&&(c=o.GROUPID_PREFIX+r.default.getRawGroupId(c));let d,h=this.cache[c];h||(h={});let u=null;switch(s){case o.GROUP_BOARD_ITEM_TYPE.POLL:d="polls",u=h.polls;break;case o.GROUP_BOARD_ITEM_TYPE.GNOTICE_MESSAGE:d="messages",u=h.messages;break;case o.GROUP_BOARD_ITEM_TYPE.GNOTICE_TOPIC:{let e=h.topics,t=h.reminders;e&&e[i]?(u=e,d="topics"):t&&t[i]&&(u=t,d="reminders");break}}if(u){let e=u[i];e&&(e=Object(a.a)(Object(a.a)({},e),{},{isNew:l})),u[i]=e}h[d]=u,this.cache[c]=h,n.default.setUnreadGroupBoardItem(e,t,s,i,l)}isUnreadItem(e,t,s,a){let i=e;!0===t&&(i=o.GROUPID_PREFIX+r.default.getRawGroupId(i));let l=n.default.getUnreadGroupBoardItem();l||(l={});let c=l[i];c||(c={});let d=c[s];return d||(d={}),d[a]||!1}removeGroup(e){let t=o.GROUPID_PREFIX+r.default.getRawGroupId(e);delete this.cache[t]}addSuggestion(e){let t=o.GROUPID_PREFIX+r.default.getRawGroupId(e.groupId),s=this.cache[t];s||(s={});let a={boardType:o.GROUP_BOARD_ITEM_TYPE.GSUGGESTION,data:e},n={};n["s_"+e.actionId]=a,s.suggestion=n,this.cache[t]=s}deleteSuggestion(e){if(e){for(let t=0;t<e.length;t++){let s=e[t];if(s&&s.length>=2){let e=o.GROUPID_PREFIX+r.default.getRawGroupId(s[0]),t=this.cache[e];t||(t={}),delete t.suggestion["s_"+s[1]],this.cache[e]=t}}n.default.removeGroupBoardSuggestion(e)}}};t.b=d},"3bSM":function(e,t,s){"use strict";var a=s("VTBJ"),n=s("q1tI"),i=s.n(n),o=(s("17x9"),s("omWL")),r=s("97kL"),l=s("8GAE"),c=s("OONb"),d=s("oru8"),h=s("oCWp"),u=s("CPtl"),_=s("6uTC"),m=s("c51z"),p=s("SVl3"),g=s("z0WU"),E=s("Yi2m");g.default.isWeb();const f=340,I=200;class T extends i.a.Component{constructor(e){super(e),this.minPos=null,this.lastPos=null,this.state={width:e.info.originalMessage.message.params.video_width||f,height:e.info.originalMessage.message.params.video_height||I,isPlaying:!1,percentage:e.info.percentage||0,volume:+!e.info.isMute||0,showVolume:!1,volumeHovering:!1,onFullScreen:!1,duration:e.info.duration||"00:00",currentTime:e.info.currentTime||"00:00",isLoadingVideo:!1,durationVideo:e.info.durationVideo||0,pause:!1,wasDownloaded:e.info.wasDownloaded||!1,isMuted:e.info.isMute,isResizing:!1},this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._isListening=!1,this._onDoubleClickTitle=this._onDoubleClickTitle.bind(this),this._muteVideo=this._muteVideo.bind(this),this._unmuteVideo=this._unmuteVideo.bind(this),this._updateProgressBar=this._updateProgressBar.bind(this),this._playVideo=this._playVideo.bind(this),this._pauseVideo=this._pauseVideo.bind(this),this._renderPlayOrPause=this._renderPlayOrPause.bind(this),this._renderMuteOrUnmute=this._renderMuteOrUnmute.bind(this),this._setTime=this._setTime.bind(this),this._expandVideo=this._expandVideo.bind(this),this._renderVolume=this._renderVolume.bind(this),this._unrenderVolume=this._unrenderVolume.bind(this),this._setVolume=this._setVolume.bind(this),this._handleOnMouseEnter=this._handleOnMouseEnter.bind(this),this._handleOnMouseLeave=this._handleOnMouseLeave.bind(this),this._updateProgressBarForFullScreenMode=this._updateProgressBarForFullScreenMode.bind(this),this._convertTime=this._convertTime.bind(this),this._setVideoCanPlay=this._setVideoCanPlay.bind(this),this._handleOnClickVideo=this._handleOnClickVideo.bind(this),this._handleOnMouseVolumeEnter=this._handleOnMouseVolumeEnter.bind(this),this._handleOnMouseVolumeLeave=this._handleOnMouseVolumeLeave.bind(this),this._scrollVolume=this._scrollVolume.bind(this),this._openFile=this._openFile.bind(this),this.updateAdditionalInfo=this.updateAdditionalInfo.bind(this),this.updateOldVideoInfo=this.updateOldVideoInfo.bind(this),this._setVideoLoadingStart=this._setVideoLoadingStart.bind(this),this.updateVolumeState=this.updateVolumeState.bind(this),this.updateVolumeEscFullScreen=this.updateVolumeEscFullScreen.bind(this),this.updateProgressBarFullScreen=this.updateProgressBarFullScreen.bind(this),this._timeOutHoveringVolume=null,this._timeOutControlVolume=null,this.isMac=!1}componentDidMount(){let e=this.props.info;e.isVideoFile&&(e&&e.src?this.refs.videoInline&&this.updateAdditionalInfo(this.props):this._openFile(this.props),document.addEventListener("webkitfullscreenchange",this._updateProgressBarForFullScreenMode,!1))}componentWillReceiveProps(e){e.info&&this.props.info.id!==e.info.id&&this.processNewVideoProps(e)}shouldComponentUpdate(e,t){return this.props.info.url!=e.info.url||this.state.width!=t.width||this.state.height!=t.height||this.state.isPlaying!=t.isPlaying||this.state.percentage!=t.percentage||this.state.volume!=t.volume||this.state.showVolume!=t.showVolume||this.state.currentTime!=t.currentTime||this.state.duration!=t.duration||this.state.isLoadingVideo!=t.isLoadingVideo||this.state.isMuted!=t.isMuted||this.state.onFullScreen!=t.onFullScreen||this.state.isResizing!=t.isResizing}componentDidCatch(e){g.default.logCoreError("[MP3 Preview][Component]: component Did Catch : ",e)}componentWillUnmount(){this.refs.videoInline&&(this.refs.videoInline.removeEventListener("timeupdate",this._updateProgressBar,!1),document.removeEventListener("webkitfullscreenchange",this._updateProgressBarForFullScreenMode,!1),l.a.updateItemCurrentTime(this.props.info.id,this.refs.videoInline.currentTime))}updateVolumeState(e){e&&(e.stopPropagation(),e.preventDefault()),document.webkitFullscreenElement&&this.setState({volume:this.refs.videoInline.volume,isMuted:this.refs.videoInline.muted})}updateVolumeEscFullScreen(){this.setState({volume:this.refs.videoInline.volume,isMuted:this.refs.videoInline.muted})}updateAdditionalInfo(e){this.refs.videoInline.addEventListener("timeupdate",this._updateProgressBar,!1),document.addEventListener("webkitfullscreenchange",this._updateProgressBarForFullScreenMode,!1);let t=+!e.info.isMute||0;t=0==t?.5:t,this.setState({isPlaying:!0,volume:t,isLoadingVideo:!0,duration:e.info.duration,pause:!1,currentTime:e.info.currentTime,percentage:e.info.percentage,durationVideo:e.info.durationVideo,isMuted:e.info.isMute},(()=>{const t=l.a.getItemCurrentTimeById(e.info.id);this.refs.videoInline.currentTime=t||0,this.refs.videoInline.play()}))}processNewVideoProps(e){this.updateOldVideoInfo(),e.info.src?this.refs.videoInline&&this.updateAdditionalInfo(e):this._openFile(e)}updateOldVideoInfo(){if(this.props.info.isVideoFile&&this.refs.videoInline){-1==l.a.updateItemCurrentTime(this.props.info.id,this.refs.videoInline.currentTime)&&l.a.addNewItemIntoList({id:this.props.info.id,currentTime:this.refs.videoInline.currentTime})}}_updateProgressBarForFullScreenMode(e){document.webkitFullscreenElement?this.refs.videoInline.addEventListener("timeupdate",this.updateProgressBarFullScreen,!1):(document.webkitExitFullscreen&&(this.refs.videoInline.removeEventListener("timeupdate",this.updateProgressBarFullScreen,!1),E.e.logAction(1920210),this.setState({onFullScreen:!1},(()=>{this.updateVolumeEscFullScreen(),document.webkitExitFullscreen()}))),document.webkitDownloadFullscreen&&this._pauseVideo())}updateProgressBarFullScreen(e){e&&(e.stopPropagation(),e.preventDefault()),l.a.updateItemCurrentTime(this.props.info.originalMessage.msgId,this.refs.videoInline.currentTime)}_onDoubleClickTitle(){return(this.state.width!=f||this.state.height!=I)&&(this.setState({width:f,height:I},(()=>{this._updateProgressBar()})),!0)}_cancel(e){E.e.logAction(1920209),this.refs.videoInline?(l.a.updateItemCurrentTime(this.props.info.id,this.refs.videoInline.currentTime),this.props.dispatch({type:r.PopupActions.MP3_PREVIEW,payload:null}),e&&(e.stopPropagation(),e.preventDefault())):this.props.dispatch({type:r.PopupActions.MP3_PREVIEW,payload:null})}_updateProgressBar(){try{let e=isNaN(this.refs.videoInline.duration)?this.state.durationVideo:this.refs.videoInline.duration,t=Math.floor(100/e*this.refs.videoInline.currentTime);this.refs.videoInline.duration==this.refs.videoInline.currentTime&&(t=100),t=Number.isFinite(t)?t:0,this.setState({percentage:t,currentTime:this._convertTime(Math.floor(this.refs.videoInline.currentTime))}),100==t&&this._pauseVideo()}catch(e){return 0}}_startListener(){this._isListening||(this._getContainerSize(),window.addEventListener("mouseup",this._mouseUp,!0),window.addEventListener("mousemove",this._mouseMove,!0),this.setState({isResizing:!0}),this._isListening=!0)}_stopListener(){this._isListening&&(window.removeEventListener("mouseup",this._mouseUp,!0),window.removeEventListener("mousemove",this._mouseMove,!0),this.setState({isResizing:!1}),this._isListening=!1)}_getInRange(e,t,s){return Math.max(Math.min(e,s),t)}_getPos(e,t){return void 0!==this._containerWidth&&(e=this._getInRange(e,this.minPos.x,this._containerWidth-20),t=this._getInRange(t,this.minPos.y,this._containerHeight-20)),{x:e,y:t}}_getContainerSize(){requestAnimationFrame((()=>{this._isListening&&(this._containerWidth=window.innerWidth,this._containerHeight=window.innerHeight)}))}_mouseMove(e){if(e.stopPropagation(),e.preventDefault(),this.lastPos){if(void 0!==e.buttons&&0===e.buttons)return this._stopListener();let{x:t,y:s}=this._getPos(e.pageX,e.pageY),a=this.state.width,n=this.state.height;a+=t-this.lastPos.x,n+=s-this.lastPos.y,this.lastPos={x:t,y:s},a===this.state.width&&n===this.state.height||this.setState({width:a,height:n})}}_mouseDown(e){E.e.logAction(1920207),e.stopPropagation(),this.lastPos={x:e.pageX,y:e.pageY},this.minPos={x:Math.max(e.pageX-(this.state.width-f),20),y:Math.max(e.pageY-(this.state.height-I),20)},this._startListener()}_mouseUp(){this.lastPos=null,this.minPos=null,this._stopListener()}_renderPlayOrPause(){return this.state.isPlaying?i.a.createElement("i",{onClick:this._pauseVideo,style:{marginLeft:5},className:"fa fa-pause"}):i.a.createElement("i",{onClick:this._playVideo,style:{marginLeft:5},className:"fa fa-play"})}_renderMuteOrUnmute(){let e=!0;0!=this.state.volume&&1!=this.state.isMuted||(e=!1);let t={marginLeft:"6px",display:e?"none":"inline-block"},s={marginLeft:"6px",display:e?"inline-block":"none"};return i.a.createElement(i.a.Fragment,null,i.a.createElement("img",{style:t,onMouseEnter:this._renderVolume,onMouseLeave:this._unrenderVolume,onClick:e=>this._unmuteVideo(e),onWheel:e=>this._scrollVolume(e),src:h.a,draggable:!1}),i.a.createElement("img",{style:s,onMouseEnter:this._renderVolume,onMouseLeave:this._unrenderVolume,onClick:e=>this._muteVideo(e),onWheel:e=>this._scrollVolume(e),src:d.a,draggable:!1}))}_renderVolume(){clearTimeout(this._timeOutHoveringVolume),this.setState({showVolume:!0})}_unrenderVolume(){this._timeOutHoveringVolume=setTimeout((()=>{this.state.volumeHovering||this.setState({showVolume:!1})}),2e3)}_playVideo(){if(!1===this.state.isLoadingVideo){E.e.logAction(1920202);let e=l.a.getItemCurrentTimeById(this.props.info.id);-1===e?e=l.a.getCurrentTimeFloatingVideo(this.props.info.id):e==this.refs.videoInline.duration?this.refs.videoInline.currentTime=0:this.refs.videoInline.currentTime=e,this.refs.videoInline.currentTime=e||0,this.setState({isPlaying:!0,pause:!1},(()=>{this.refs.videoInline.play()}))}}_pauseVideo(){!1===this.state.isLoadingVideo&&(E.e.logAction(1920201),l.a.updateItemCurrentTime(this.props.info.id,this.refs.videoInline.currentTime),l.a.setVideoFloating(this.props.info.id,isNaN(this.refs.videoInline.currentTime)?0:this.refs.videoInline.currentTime),this.setState({isPlaying:!1,pause:!0},(()=>{this.refs.videoInline.pause()})))}_handleOnClickVideo(e){this.state.isLoadingVideo||(e&&(e.stopPropagation(),e.preventDefault()),this.state.isPlaying?this._pauseVideo():this.state.wasDownloaded?this._playVideo():this._openFile(this.props))}_muteVideo(e){E.e.logAction(1920204),e&&(e.stopPropagation(),e.preventDefault()),this.refs.videoInline.muted=!0,this.setState({volume:0,showVolume:!0,isMuted:!0})}_unmuteVideo(e){E.e.logAction(1920203),e&&(e.stopPropagation(),e.preventDefault()),0==this.refs.videoInline.volume&&(this.refs.videoInline.volume=1),this.refs.videoInline.muted=!1,this.setState({volume:this.refs.videoInline.volume,showVolume:!0,isMuted:!1},(()=>{}))}_setTime(e){e&&(e.stopPropagation(),e.preventDefault()),E.e.logAction(1920205);const t=e.currentTarget.getBoundingClientRect(),s=(e.clientX-t.left-15)/(t.width-30);this.refs.videoInline.currentTime=this.refs.videoInline.duration*s,l.a.updateItemCurrentTime(this.props.info.originalMessage.msgId,this.refs.videoInline.currentTime)}_expandVideo(){E.e.logAction(1920206),this.setState({onFullScreFullScreen:!0},(()=>{this.refs.videoInline.webkitRequestFullscreen()}))}_handleOnMouseEnter(){clearTimeout(this._timeOutControlVolume),this.setState({volumeHovering:!0})}_handleOnMouseLeave(){this._timeOutControlVolume=setTimeout((()=>{this.setState({volumeHovering:!1,showVolume:!1})}),1e3)}_setVolume(e){e&&(e.stopPropagation(),e.preventDefault());const t=e.currentTarget.getBoundingClientRect(),s=(t.bottom-e.clientY)/t.height;s>0?(this.setState({volume:s,isMuted:!1}),this.refs.videoInline.volume=s,this.refs.videoInline.muted=!1):(this.setState({volume:0,isMuted:!0}),this.refs.videoInline.volume=0,this.refs.videoInline.muted=!0)}_convertTime(e){let t=Math.floor(e/60),s=e-60*t;return t<10&&(t=`0${t}`),s<10&&(s=`0${s}`),`${t}:${s}`}_setVideoCanPlay(){this.refs.videoInline&&this.setState({isLoadingVideo:!1,duration:this._convertTime(Math.floor(this.refs.videoInline.duration))}),this.refs.videoInline.volume=this.state.volume}_setVideoLoadingStart(){this.refs.videoInline&&(this.refs.videoInline.volume=0)}_handleOnMouseVolumeEnter(){!0===this.state.showVolume&&clearTimeout(this._timeOutHoveringVolume)}_handleOnMouseVolumeLeave(){this._timeOutHoveringVolume=setTimeout(this.setState({showVolume:!1}),1e3)}_scrollVolume(e){if(e&&(e.stopPropagation(),e.preventDefault()),this.state.showVolume){e=window.event||e;let t=Math.max(-1,Math.min(1,e.wheelDelta/1e3||-e.detail));this.refs.videoInline.volume+t>1?this.setState({volume:1,isMuted:!1},(()=>{this.refs.videoInline.volume=1,this.refs.videoInline.muted=!1})):this.refs.videoInline.volume+t<0?this.setState({volume:0,isMuted:!0},(()=>{this.refs.videoInline.volume=0,this.refs.videoInline.muted=!1})):this.setState({volume:this.refs.videoInline.volume+t,isMuted:!1},(()=>{this.refs.videoInline.volume+=t,this.refs.videoInline.isMuted=!1})),e.preventDefault()}}_openFile(e){let t=Object(a.a)({},e);const s=t.info.originalMessage;if(!t.info.isOnline)return void _.a.createError(m.default.str("STR_TOAST_CONNECTION_FAILED"));this.setState({isLoadingVideo:!0,pause:!1});const n=`predownload-file-done-${s.msgId}`,i={lowPriority:!0,completeChannel:n,fileName:s.msgId,conversationId:s.toUid,byPassChecksum:!0,cacheDirectoryTag:"video",userId:t.userId,isCaching:!0};let o=null;o=18===s.msgType?s.message.oriUrl:s.message.href,this.refs.videoInline.addEventListener("timeupdate",this._updateProgressBar,!1),this.ipc.once(n,((e,s,a,n,i,o)=>{if(s)g.default.logCoreError("[Mp3 Preview][Component]: download file error: ",s),_.a.createError(m.default.str("STR_VIDEO_INLINE_ERR")),this.setState({pause:!0,isLoadingVideo:!1,wasDownloaded:!1});else{let e=+!t.info.isMute||0;e=0==e?.5:e,this.setState({isLoadingVideo:!1,wasDownloaded:!0,volume:e,isMuted:t.info.isMute},(()=>{this.refs.videoInline.pause(),this.refs.videoInline.setAttribute("src",n),this._playVideo()}))}})),this.ipc.send("download-file-low-priority",s.msgId,o,i)}render(){let e=0;this.refs.videoInline&&(e=this.state.width-30);let t=this.props.info,s=t.title?t.title:null;const a=this.props.info.isVideoFile||!1,n=(JSON.parse(t.originalMessage.message.params),t.style||{});let r=this.state.volume;return 0!=this.state.volume&&1!=this.state.isMuted||(r=0),i.a.createElement(o.a,{cancel:e=>this._cancel(e),title:s,onDoubleClick:this._onDoubleClickTitle,initLeft:70,floatVideo:this.floatVideo,info:t,style:n,isVideo:a,isVideoInline:!0},i.a.createElement("div",{className:"flx flx-col flx-al-c videoFloatingContainer"},this.state.isLoadingVideo?i.a.createElement(c.a,{style:{position:"absolute",top:"40%"},size:26}):null,this.state.pause?i.a.createElement("img",{className:"videoFloatingContainer__pauseVideo",src:p.a,draggable:!1}):null,i.a.createElement("video",{ref:"videoInline",key:1,src:t.src||null,id:"floating-video",width:this.state.width,height:this.state.height,controlsList:"nodownload",onCanPlay:this._setVideoCanPlay,onClick:this._handleOnClickVideo,onLoadStart:this._setVideoLoadingStart,onVolumeChange:this.updateVolumeState,muted:this.state.isMuted,preload:"none",disablePictureInPicture:"true"}),i.a.createElement("div",{className:"videoFloatingContainer__videoBackdrop"},i.a.createElement("div",{className:"videoFloatingContainer__videoBackdrop__controlContainer"},i.a.createElement("div",{className:"videoFloatingContainer__videoBackdrop__videoTimer"},this.state.currentTime,"/",this.state.duration),this._renderMuteOrUnmute(),this.isMac?null:i.a.createElement("img",{title:m.default.str("STR_VIDEO_INLINE_FULLSCREEN"),style:{width:14,marginLeft:15,float:"right"},src:u.a,onClick:this._expandVideo,draggable:!1})),this.state.isResizing?null:i.a.createElement("div",{className:"videoFloatingContainer__videoBackdrop__progressArea",onClick:this._setTime},i.a.createElement("div",{className:"videoFloatingContainer__videoBackdrop__progressContainer"},i.a.createElement("div",{className:"videoFloatingContainer__videoBackdrop__progress",style:{width:e*this.state.percentage/100+"px"}}))))),this.state.showVolume&&a?i.a.createElement("div",{id:"volume-container",className:"videoFloatingContainer__volumeContainer",onClick:this._setVolume,onMouseEnter:this._handleOnMouseEnter,onMouseLeave:this._handleOnMouseLeave,onWheel:e=>this._scrollVolume(e)},i.a.createElement("div",{className:"videoFloatingContainer__volume",style:{height:100*(1-r)+"%"},onClick:this._setVolume})):null,i.a.createElement("div",{style:{position:"absolute",bottom:0,right:"-3px",height:"15px",width:"15px",cursor:"se-resize",borderRight:"3px solid rgba(0, 174, 255, 1)",borderBottom:"3px solid rgba(0, 174, 255, 1)",borderBottomRightRadius:"8px"},title:"resize",onMouseDown:e=>this._mouseDown(e)}))}}t.a=T},"3gaR":function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var a=s("VTBJ"),n=s("q1tI"),i=s.n(n),o=s("ndDP"),r=s.n(o);s("KRIz"),s("9AK/");function l(e){e=Object(a.a)(Object(a.a)({},{cache:new r.a({maxSize:100}),serializer:JSON.stringify}),e);const{cache:t,serializer:s}=e;return function(...e){const a=i.a.useMemo((()=>s(e)),e);return i.a.useMemo((()=>({value:t.get(a),hasCache:t.has(a),setCache:e=>t.set(a,e),deleteCache:()=>t.delete(a)})),[a])}}},"3jCC":function(e,t,s){"use strict";var a=s("q1tI"),n=s.n(a);const i=["rgb(75, 74, 73)","rgb(100, 74, 67)","rgb(184, 187, 174)","rgb(172, 150, 133)","rgb(126, 155, 88)","rgb(148, 105, 65)","rgb(244, 199, 191)","rgb(255, 201, 67)","rgb(36, 36, 40)","rgb(0, 101, 153)","rgb(165, 158, 155)","rgb(216, 186, 42)","rgb(189, 182, 187)","rgb(81, 81, 87)","rgb(217, 187, 191)","rgb(154, 122, 98)","rgb(138, 129, 120)","rgb(86, 53, 45)","rgb(154, 129, 107)","rgb(203, 113, 155)","rgb(120, 93, 71)","rgb(114, 112, 79)","rgb(178, 9, 6)","rgb(154, 127, 138)","rgb(115, 142, 69)","rgb(153, 98, 83)","rgb(196, 197, 191)","rgb(92, 57, 32)","rgb(104, 205, 245)","rgb(232, 109, 121)","rgb(42, 40, 44)","rgb(125, 97, 96)","rgb(154, 126, 105)","rgb(171, 152, 149)","rgb(140, 132, 134)","rgb(153, 139, 133)","rgb(164, 160, 144)","rgb(45, 51, 54)","rgb(110, 116, 168)","rgb(206, 188, 164)","rgb(95, 80, 69)","rgb(190, 167, 122)","rgb(221, 196, 186)","rgb(200, 194, 172)","rgb(86, 94, 77)","rgb(105, 120, 98)","rgb(114, 131, 145)","rgb(236, 115, 88)","rgb(222, 124, 141)","rgb(62, 61, 26)","rgb(208, 198, 195)","rgb(76, 95, 74)","rgb(171, 114, 111)","rgb(108, 148, 142)","rgb(170, 171, 165)","rgb(163, 141, 110)","rgb(67, 49, 41)","rgb(192, 157, 107)","rgb(127, 125, 126)","rgb(153, 92, 57)","rgb(148, 151, 161)","rgb(249, 46, 41)","rgb(124, 101, 81)","rgb(39, 40, 36)","rgb(161, 216, 210)","rgb(131, 112, 107)","rgb(160, 127, 103)","rgb(104, 104, 96)","rgb(122, 93, 94)","rgb(194, 170, 174)","rgb(74, 53, 36)","rgb(184, 183, 186)","rgb(214, 181, 30)","rgb(92, 82, 78)","rgb(134, 109, 115)","rgb(201, 200, 193)","rgb(103, 149, 137)","rgb(163, 164, 170)","rgb(150, 166, 168)","rgb(93, 62, 42)","rgb(123, 174, 224)","rgb(168, 132, 151)","rgb(225, 188, 124)","rgb(170, 157, 148)","rgb(181, 173, 162)","rgb(106, 72, 74)","rgb(109, 100, 91)","rgb(120, 111, 83)","rgb(131, 99, 67)","rgb(207, 117, 74)","rgb(142, 197, 196)","rgb(100, 104, 67)","rgb(255, 77, 108)","rgb(162, 160, 140)","rgb(250, 139, 157)","rgb(203, 189, 180)","rgb(162, 120, 113)","rgb(53, 44, 34)","rgb(164, 165, 175)","rgb(185, 197, 160)","rgb(194, 181, 178)","rgb(255, 139, 157)","rgb(63, 89, 138)","rgb(145, 135, 138)","rgb(178, 214, 230)","rgb(104, 121, 144)","rgb(176, 176, 176)","rgb(169, 168, 168)"];function o(){return i[Math.floor(Math.random()*i.length)]}const r=[1,2,3,4].map((e=>o()));var l=s("x4D7"),c=s("NzUN");const d=new c.a(100);var h=new class{constructor(){this._getPromise={}}getCacheThumbs(e){let t=this._getKey(e),s=t?d.get(t):null;return s||null}_getKey(e){let t="";return e&&e.cliMsgId&&null!=e.fromUid&&(t=e.cliMsgId+"_"+e.fromUid),t}getThumbs(e){return new Promise(((t,s)=>{let a=this._getKey(e);if(!a)return void t(l.d.getFolderPreview(e));let n=d.get(a);return n?t(n):this._getPromise[a]?t(this._getPromise[a]):(this._getPromise[a]=l.d.getFolderPreview(e),void this._getPromise[a].then((e=>{delete this._getPromise[a],e&&e.length&&d.set(a,e),t(e)})).catch((e=>{delete this._getPromise[a],s(e)})))}))}};class u extends n.a.Component{constructor(e){super(e),this._viewFolder=this._viewFolder.bind(this),this._shareFolder=this._shareFolder.bind(this);let t=null;e&&e.message&&(t=h.getCacheThumbs(e.message)),this.state=t?{listUrls:t,loaded:!0}:{listUrls:r,loaded:!1},this._componentActive=!0,this._retry=!1}_viewFolder(e){this.props.viewFolder&&this.props.viewFolder(),e&&(e.stopPropagation(),e.preventDefault())}_shareFolder(e){this.props.shareFolder&&this.props.shareFolder(),e&&(e.stopPropagation(),e.preventDefault())}_loadThumb(){this.state.loaded||h.getThumbs(this.props.message).then((e=>{this._componentActive&&this.setState({listUrls:e,loaded:!0})})).catch((e=>{this._retry||(this._retry=!0,setTimeout((()=>{this._loadThumb()}),1e3))}))}componentDidMount(){this._loadThumb()}componentWillUnmount(){this._componentActive=!1}shouldComponentUpdate(e,t){return this.state.loaded!==t.loaded}_getImage(e){let t=this.state.listUrls[e];return this.state.loaded&&t?n.a.createElement("div",{className:"folder_thumb__img",style:{backgroundImage:`url("${t}")`}}):(t=t||r[e],n.a.createElement("div",{className:"folder_thumb__img",style:{backgroundColor:`${t}`}}))}render(){let e=this.props.fileParams,t=this.state.listUrls.length,s=0;return e&&e.fdata&&e.fdata.cntImg&&(isNaN(e.fdata.cntImg)||(s=+e.fdata.cntImg)),n.a.createElement("div",{className:"card--file__bubble ",style:{background:"initial"}},n.a.createElement("div",{className:"folder_thumb"},n.a.createElement("div",{className:"folder_thumb__container"},n.a.createElement("div",{className:"folder_thumb__firstcol"},this._getImage(0)),t>1?n.a.createElement("div",{className:"folder_thumb__secondcol"},[0,1,2].slice(1,t).map((e=>{let t=this._getImage(e);return n.a.createElement("div",{key:"img"+e,className:"folder_thumb__containerImg"},t)}))):null)),n.a.createElement("div",{className:"folder_thumb__mask"},s?n.a.createElement("div",{className:"folder_thumb__mask__nimg"},n.a.createElement("div",{className:"folder_thumb__mask__nimg__container"},n.a.createElement("div",{style:{display:"flex"}},n.a.createElement("img",{className:"folder_thumb__mask__nimg__icon",src:"assets/image-thumb@3x.3bf3292844d77a1a522ea72dca3350c1.png"})),n.a.createElement("span",{className:"folder_thumb__mask__nimg__number"},s))):null))}}t.a=u},"3kX4":function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s("JprO");function n(e){e&&a.a.abortByMsg(e)}},"3nWQ":function(e,t,s){"use strict";s.d(t,"a",(function(){return u})),s.d(t,"b",(function(){return _}));var a=s("VTBJ"),n=s("Ff2n"),i=s("q1tI"),o=s.n(i),r=s("iuhU");var l=s("75pU"),c=s.n(l),d=s("ndDP"),h=s.n(d);const u=function(e){const{ttl:t,isAdmin:s,variant:i,border:l,className:c,children:d}=e,h=Object(n.a)(e,["ttl","isAdmin","variant","border","className","children"]);const u=o.a.Children.only(d);return o.a.cloneElement(u,Object(a.a)(Object(a.a)({},h),{},{className:Object(r.a)(t&&"ttl-d-border",t&&i&&`-variant-${i}`,s&&"-admin",null!=l&&`-border-${l}`,c,u.props.className)}))},_=function(e){let{ttl:t,isAdmin:s=!1,width:i,height:l,tl:c=0,tr:d=0,br:h=0,bl:u=0,className:_,style:m,children:p}=e,E=Object(n.a)(e,["ttl","isAdmin","width","height","tl","tr","br","bl","className","style","children"]);const f=o.a.Children.only(p),I=g(s,i,l,c,d,h,u);return o.a.cloneElement(f,Object(a.a)(Object(a.a)({},E),{},{style:Object(a.a)(Object(a.a)(Object(a.a)({},m),f.props.style),{},{borderRadius:`${c}px ${d}px ${h}px ${u}px`,"--ttl-border":I}),className:Object(r.a)(t&&"ttl-f-border",_,f.props.className)}))},m="#BCCED8",p="#0068FF";let g=function(e,t,s,a,n,i,o){const r=((e,t,s,a,n,i)=>{const o=e/2;return[`M${o},0`,"h"+(o-a),`a${a},${a} 0 0 1 ${a},${a}`,"v"+(t-a-n),`a${n},${n} 0 0 1 ${-n},${n}`,`h${-e+n+i}`,`a${i},${i} 0 0 1 ${-i},${-i}`,`v${-t+i+s}`,`a${s},${s} 0 0 1 ${s},${-s}`,"z"].join(" ")})(t+=1,s+=1,a,n,i,o);let l=`<svg\n\txmlns="http://www.w3.org/2000/svg"\n\twidth="${t}"\n\theight="${s}">\n\t\t<g\n\t\t\tfill="none"\n\t\t\tstroke-width="1"\n\t\t>\n\t\t\t<path\n\t\t\t\tstroke="white"\n\t\t\t\td="${r}"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tstroke="${e?p:m}"\n\t\t\t\tstroke-dasharray="4,4"\n\t\t\t\tstroke-linecap="butt"\n\t\t\t\td="${r}"\n\t\t\t/>\n\t\t</g>\n</svg>\n`;return l=l.replace(/(\t|\r?\n)+/gi," "),`url(data:image/svg+xml;base64,${btoa(l)})`};g=c()(g,{cache:{create:()=>new h.a({maxSize:100})}})},"3xbP":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s("96Sw");const n=Object.prototype.toString;function i(e){if(!Object(a.a)(e))return!1;const t=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":n.call(e)}(e);return"[object Function]"===t||"[object AsyncFunction]"===t||"[object GeneratorFunction]"===t||"[object Proxy]"===t}},4:function(e,t){},"41Rw":function(e,t,s){"use strict";var a=s("wx14"),n=s("VTBJ"),i=s("rePB"),o=s("q1tI"),r=s.n(o),l=s("17x9"),c=s.n(l),d=s("NDmK"),h=s("z0WU"),u=s("f1wB"),_=s("wqXv"),m=s("jLAa"),p=s("Ydol"),g=s("97kL"),E=s("LV1a"),f=s("PoHQ"),I=s("Yi2m"),T=s("qYNW"),v=s("4prX"),R=s("JprO"),S=s("sAzz"),O=s("nxrR"),N=s("ZiFd"),b=s("G4W6"),C=s("6gCs");s.d(t,"a",(function(){return C.a})),s.d(t,"b",(function(){return C.b})),s.d(t,"c",(function(){return C.c})),s.d(t,"e",(function(){return C.d})),s.d(t,"f",(function(){return C.e}));const A=h.default.isWeb();let y,D;function M({onChange:e}){const t=r.a.useContext(O.b);return r.a.useEffect((()=>{e&&e(t)}),[t,e]),null}A||(D=s("Cwh7"),y=s("Dprd").default);class P extends r.a.Component{constructor(e){super(e),Object(i.a)(this,"clearReloadTimer",(()=>{this._reloadImageTimer&&(clearTimeout(this._reloadImageTimer),this._reloadImageTimer=null)})),Object(i.a)(this,"reloadImageOnIntersect",(()=>{this.clearReloadTimer(),Date.now()-this._reloadImageTs<5e3||(this._reloadImageTimer=setTimeout((()=>{this._reloadImageTimer=null,this.reloadImage()}),500),this._reloadImageTs=Date.now())})),this.state={source:null,hasError:!1,redirected:!1,loaded:!1,checking:!1},e.src&&e.src.startsWith("blob:")&&(this._toRevokeURL=e.src,_.a.take(this._toRevokeURL)),this._loaderCtx={},this._onImageError=this._onImageError.bind(this),this._onImageLoad=this._onImageLoad.bind(this),this._handleError=this._handleError.bind(this),this._handleLoad=this._handleLoad.bind(this),this._updateLoaderCtx=this._updateLoaderCtx.bind(this),this.reloadImage=this.reloadImage.bind(this),this._reloadImageTimer=null,this._reloadImageTs=0,this._setNewStateForChangeSource=this._setNewStateForChangeSource.bind(this),this._notifyError=this._notifyError.bind(this),this._checkSrcs=this._checkSrcs.bind(this),this._updateCheckOpts=this._updateCheckOpts.bind(this),this._tryCount=0,this.beingObserved=!1,this.checkingImageForRedirect=!1,this._checkError=null}componentWillMount(){this.startTime=Date.now()}componentDidMount(){try{this._handleNewProps(this.props,!0)}catch(e){h.default.logCoreError("image: _handleNewProps is failed")}}componentWillReceiveProps(e){if(e.src!==this.props.src&&this._handleNewProps(e),e.timestamp!==this.props.timestamp&&this.filePath&&m.a.pathExists(this.filePath)&&!this.usingLocalPath){const e=this._getEncodedPathUrl(this.filePath);this.setState({source:e,hasError:!1}),this.usingLocalPath=!0}}shouldComponentUpdate(e,t){return t.source!==this.state.source||t.hasError!==this.state.hasError||this.props.src!==e.src||this.props.className!==e.className||this.props.width!==e.width||this.props.height!==e.height||!h.default.objectEqual(this.props.style,e.style)||!h.default.objectEqual(this.props.successStyle,e.successStyle)||this.props.msgId!==e.msgId||this.props.timestamp!==e.timestamp||t.redirected!==this.state.redirected||!!this.props.hideBroken&&this.state.loaded!==t.loaded||this.state.checking!==t.checking}componentDidUpdate(){d.c.enableImageRetry&&(this.state.hasError?(this._lastErrorElement!==this._errorElement&&(this.beingObserved&&this._unobserveErrorImage(),this._observeErrorImage()),this.state.redirected?f.default.redirectedImages.hasOwnProperty(this.props.src)||(f.default.redirectedImages[this.props.src]=!0,I.e.logAction(1570101)):f.default.failedImages.hasOwnProperty(this.props.src)||(f.default.failedImages[this.props.src]=!0,I.e.logAction(1570102))):this.checkingImageForRedirect||(this.beingObserved&&this._unobserveErrorImage(),!f.default.reloadedRedirectedImages.hasOwnProperty(this.props.src)&&f.default.redirectedImages.hasOwnProperty(this.props.src)?(f.default.reloadedRedirectedImages[this.props.src]=!0,I.e.logAction(1570103)):!f.default.reloadedFailedImages.hasOwnProperty(this.props.src)&&f.default.failedImages.hasOwnProperty(this.props.src)&&(f.default.reloadedFailedImages[this.props.src]=!0,I.e.logAction(1570104))))}_revokeUrl(){this._toRevokeURL&&(_.a.push(this._toRevokeURL),this._toRevokeURL=null)}componentWillUnmount(){this.unmounted=!0,this._revokeUrl(),this._networkHandler&&(p.default.unsubscribe(this._networkHandler),this._networkHandler=null),this.beingObserved&&this._unobserveErrorImage(),this._checkTask&&this._checkTask.cancel()}_updateLoaderCtx(e){Object.assign(this._loaderCtx,e)}getImgDom(){if(this._dom)return this._dom.getDom()}_setNewStateForChangeSource(e){this.unmounted||this._imageLoaded||this._loadingBlob||this.setState(e)}_handleNewProps(e,t=!1){if(!this._imageLoaded&&!this._loadingBlob)if(this.usingLocalPath=!1,this.needsToDownload=!1,this.alternates=d.c.image.use_check_url_v1&&e.checkUrls?[]:e.alternates.filter((e=>!!e.src)),e.src||d.c.image.use_check_url_v1&&e.checkUrls)if(e.noCache)e.src&&this._setNewStateForChangeSource({source:e.src,hasError:!1});else if(d.c.image.use_check_url_v1&&!String(e.src).startsWith("blob")&&!e.isLocalMsg&&e.checkUrls)this._updateCheckOpts(e),this._checkSrcs();else if(A||e.src.startsWith("blob")||e.isLocalMsg||!e.conversationId)A||!this.props.checkRedirect||e.src.startsWith("blob")||e.isLocalMsg?(this._setNewStateForChangeSource({source:e.src,hasError:!1}),t&&e.src&&e.src.startsWith&&e.src.startsWith("blob")&&(this._loadingBlob=!0)):this._checkImageForRedirect(e.src,!1);else{this.needsToDownload=!1,this.filePath=this._getImageFilePath(e);const t=this._getEncodedPathUrl(this.filePath);if(m.a.pathExists(this.filePath))return T.Huynh.debug("image: path check cache exists",this.filePath),this.usingLocalPath=!0,e.onFilePathUpdated&&e.onFilePathUpdated(this.filePath),void this._setNewStateForChangeSource({source:t,hasError:!1});this.usingLocalPath=!1,y.fileExists(this.filePath).then((s=>{this._imageLoaded||this._loadingBlob||(s?(e.onFilePathUpdated&&e.onFilePathUpdated(this.filePath),m.a.flagPath(this.filePath,!0),this.usingLocalPath=!0,this._setNewStateForChangeSource({source:t,hasError:!1})):(this.needsToDownload=!0,this.unmounted||(this.props.checkRedirect?this._checkImageForRedirect(e.src,!1):this._setNewStateForChangeSource({source:e.src,hasError:!1}))))})),!this.usingLocalPath&&this.state.hasError&&this._checkReplaceBlobBySrc(this.props.src,e.src)}else T.Core.error("image: missing src prop")}_observeErrorImage(){b.a.observe(this._errorElement,{onIntersect:this.reloadImageOnIntersect,onUnintersect:this.clearReloadTimer}),this.beingObserved=!0,this._lastErrorElement=this._errorElement}_unobserveErrorImage(){this._lastErrorElement&&b.a.unobserve(this._lastErrorElement),this.beingObserved=!1}_updateCheckOpts(e={}){if(JSON.stringify(e.alternates)===JSON.stringify(this._latestAlternates))return;this._latestAlternates=e.alternates,this._latestCheckOpts=(this._latestAlternates||[]).filter((e=>e)).map((e=>({srcObj:Object(n.a)({},e),context:this._loaderCtx})));const t=this._latestCheckOpts[0];t&&(t.needsToDownload=!0)}_checkSrcs(){if(!(this._currentCheckOpts!==this._latestCheckOpts))return;this._checkTask&&this._checkTask.cancel(),this._currentCheckOpts=this._latestCheckOpts;const e=this._checkTask=S.d(this._currentCheckOpts);return e.then((({localUrl:t,localPath:s,url:a,isLocal:n})=>{this._checkTask===e&&(this._checkTask=null,this._unobserveErrorImage(),this.unmounted||(this.needsToDownload=!n,this.usingLocalPath=!!n,this.filePath=s,this._setNewStateForChangeSource({source:n?t:a,hasError:!1,redirected:!1,checking:!1}),v.a.increaseSuccess(91026,0,Date.now()-this.startTime)))})).catch((t=>{this._checkTask===e&&(this._checkError=t,this._checkTask=null,t instanceof N.a||this.unmounted||(h.default.logCoreError("image: _checkSrcs has failed"),this._setNewStateForChangeSource({source:this.props.src,hasError:!0,redirected:!1,checking:!1}),this._notifyError(t),v.a.increaseFailed(91026,0,Date.now()-this.startTime,1,this.startTime)))}))}_checkImageForRedirect(e,t){if(this.checkingImageForRedirect||this._imageLoaded||this._loadingBlob||this.unmounted)return;this.checkingImageForRedirect=!0,t&&this.setState({checking:!0});const s=t=>{this._imageLoaded||this._loadingBlob||(this.checkingImageForRedirect=!1,this.checkImageFailed=!!t,0!==t&&d.c.enableImageRetry?(this.retriedRedirect||(setTimeout((()=>{this._checkImageForRedirect(e,!0)}),5e3),this.retriedRedirect=!0),1===t?(h.default.logEncrypt(`image: image not alive ${e}`),this.unmounted||this._setNewStateForChangeSource({source:e,hasError:!0,redirected:!1,checking:!1})):2===t?(h.default.logEncrypt(`image: image redirected ${e}`),this.unmounted||this._setNewStateForChangeSource({source:e,hasError:!0,redirected:!0,checking:!1})):3===t&&(this.timedOutTimes=(this.timedOutTimes||0)+1,h.default.logEncrypt(`image: image timed out ${this.timedOutTimes} ${e}`),this.unmounted||(this.timedOutTimes<3?this._setNewStateForChangeSource({source:e,hasError:!0,redirected:!1,checking:!1}):this._setNewStateForChangeSource({source:e,hasError:!1,redirected:!1,checking:!1})))):(this._unobserveErrorImage(),this.unmounted||this._setNewStateForChangeSource({source:e,hasError:!1,redirected:!1,checking:!1})))};E.b.isImageLinkAlive(e).then((e=>{s(e?0:2)})).catch((e=>{s(e&&"ERR_CONNECTION_TIMED_OUT"===e.code?3:1)}))}_checkReplaceBlobBySrc(e,t){return!(!(e&&e.constructor===String&&e.startsWith("blob")&&t)||t.startsWith("blob"))&&(this._revokeUrl(),this.setState({source:t,hasError:!1}),!0)}_getImageFilePath(e){let t;if(e.cacheFolderName){let s=y.getCachedFileName(e.src);t=y.getZaloImagesCachePath(e.conversationId,f.default.getSessionUserId(),e.cacheFolderName)+s}else{let s=y.getCachedMainImageName(e.src,e.msgId,e.isGif);t=y.getZaloImagesPath(e.conversationId,f.default.getSessionUserId())+s}return t}_getEncodedPathUrl(e){return y?y.getEncodedPathUrl(e):e}_onImageLoad(){if(this._imageLoaded,this._loadingBlob&&(this._imageLoaded=!0,this._loadingBlob=!1),this.beingObserved&&this._unobserveErrorImage(),this.props.checkExifHandler&&E.b.checkExifUrl(this.state.source).then((e=>{this.props.checkExifHandler(e)})),this.props.hideBroken&&this.setState({loaded:!0}),this._networkHandler&&(p.default.unsubscribe(this._networkHandler),this._networkHandler=null),this.usingLocalPath&&this.filePath&&"function"==typeof this.props.onFilePathUpdated&&this.props.onFilePathUpdated(this.filePath),this.needsToDownload&&(this.needsToDownload=!1,!A)){if(this.props&&this.props.message){let e=this.props.message;if(e&&e.msgId&&e.cliMsgId&&h.default.getMsgIdSendingFromCliMsgId(e.cliMsgId)==e.msgId)return}if(d.c.downloadConfig&&d.c.downloadConfig.new_save_image){let t,s;const a=this.props.simpleConvInfo||{},n=this.filePath;if(!n)return;try{t=D.dirname(n),s=D.basename(n)}catch(e){}const{msgId:i,userId:o}=a;i&&o&&this.props&&i==this.props.msgId&&o==this.props.conversationId&&R.a.run({type:R.a.constants.DownloadType.Photo,data:{msgId:this.props&&this.props.msgId,url:this.state.source,conversationId:this.props&&this.props.conversationId,fileName:s},options:{srcAction:R.a.constants.srcAction.Dev,saveDir:t,caching:!1}}).then((()=>{m.a.flagPath(n,!0),this.props.onFilePathUpdated&&this.props.onFilePathUpdated(n)})).catch((e=>{}))}else y.saveImageData(this.state.source,this.filePath,null,!1).then((()=>{m.a.flagPath(this.filePath,!0),this.props.onFilePathUpdated&&this.props.onFilePathUpdated(this.filePath)}));v.a.increaseSuccess(91026,0,Date.now()-this.startTime)}}_onImageError(){if(this._loadingBlob&&(this._loadingBlob=!1,this._loadingBlobFail=!0),this.usingLocalPath)return T.Huynh.debug("image: path check cache exists",this.filePath),m.a.flagPath(this.filePath,!1),this.usingLocalPath=!1,this.needsToDownload=!0,void this.setState({source:this.props.src});if(this.needsToDownload=!1,this.alternates.length){const e=this.alternates.shift();e.isLocal?this.setState({source:this._getEncodedPathUrl(e.src),hasError:!1}):this.setState({source:e.src,hasError:!1})}else this._checkReplaceBlobBySrc(this._toRevokeURL,this.props.src)||(this.props.autoRetryWhenNetworkIsBack&&!this._networkHandler&&(this._networkHandler=(e,t)=>{e===g.GeneralActions.NETWORK_STATUS_CHANGED&&!0===t&&(!0===this.props.doNotShowRetry&&this._tryCount++,T.Huynh.debug(`reload img ${this.state.hasError}`),this.setState({hasError:!1}),setTimeout((()=>{this._networkHandler&&(p.default.unsubscribe(this._networkHandler),this._networkHandler=null)}),1))},p.default.subscribe(this._networkHandler)),this.setState({hasError:!0}),v.a.increaseFailed(91026,0,Date.now()-this.startTime,1,this.startTime))}reloadImage(e){e&&(e.stopPropagation(),e.preventDefault()),h.default.logCoreInfo("reloadImage",this.props.src),this.startTime=Date.now(),d.c.image.use_check_url_v1&&this.props.checkUrls?(this._currentCheckOpts=null,this._checkSrcs()):this.checkImageFailed?this._checkImageForRedirect(this.props.src,!0):(this._lastErrorElement=null,this.setState({hasError:!1}));try{this.props.onReload&&this.props.onReload()}catch(t){T.Core.error("call onReloadProp failed"),T.Core.error(t)}}_notifyError(e){this.props.onError&&this.props.onError(e)}_handleError(e){const t=this.state.source;setTimeout((()=>{h.default.logEncrypt(`image: error, source: ${t}`)}),0);try{this._onImageError()}catch(e){h.default.logCoreError("An exception occurred while executing _onImageError",e)}this.props.onError&&this.props.onError(e)}_handleLoad(e){try{this._onImageLoad()}catch(t){h.default.logCoreError("An exception occurred while executing _onImageLoad",t)}try{this.props.onLoad&&this.props.onLoad(e)}catch(t){h.default.logCoreError("An exception occurred while executing onLoad",t)}}render(){let e,{className:t,width:s,height:n,style:i,draggable:o,onClick:l,onWheel:c,onLoad:d,onError:h,isDoomCached:_,simpleConvInfo:m,dragSrc:p,refProp:g,timestamp:E,checkRedirect:f,hideBroken:I,successStyle:T,placeholder:v,placeholderUrl:R,showLoadingIconOnChecking:S,placeholderContainerStyle:O}=this.props;if(v?e=v:R&&(e=r.a.createElement("img",{width:s,height:n,className:t,style:i,src:R})),!this.state.source)return r.a.createElement("div",{ref:e=>this._errorElement=e,width:s,height:n,className:t+" flx flx-center flx-al-c",style:i,onClick:l},r.a.createElement(M,{onChange:this._updateLoaderCtx}),e);if(this.state.checking)return r.a.createElement("div",{ref:e=>this._errorElement=e,width:s,height:n,className:t+" flx flx-center flx-al-c",style:i},S&&r.a.createElement("i",{className:"fa fa-img-retry fa-spin spinner",style:{fontSize:"30px",color:"var(--blue-300)"}}));if(this.state.hasError)return this.props.doNotShowRetry?r.a.createElement("div",{ref:e=>this._errorElement=e,width:s,height:n,className:t+" flx flx-center flx-al-c",style:i,onClick:l},e):r.a.createElement("div",{ref:e=>this._errorElement=e,className:"chat-message-picture__error "+(this.props.className||""),style:i,onClick:this.reloadImage},r.a.createElement("div",{className:"chat-message-picture__error__text"},r.a.createElement("i",{className:"fa fa-img-retry chat-message-picture__error__retry"})));let N=this.state.source;E&&this.usingLocalPath?(N+=`#${E}`,_=!1):_=_&&!N.startsWith("blob:"),T&&(i=Object.assign({},i,T));const b={className:t,width:s,height:n,style:i,draggable:o,onClick:l,onWheel:c,onLoad:d,onError:h,isDoomCached:_,simpleConvInfo:m,dragSrc:p};if(b.className=(b.className||"")+(this.state.hasError?" error":""),I&&!this.state.loaded)return N&&N.startsWith("blob")?this._loadingBlob=!0:this._loadingBlob=!1,r.a.createElement("div",{width:s,height:n,className:t+" flx flx-center flx-al-c",style:i},r.a.createElement("div",{style:O},e),r.a.createElement(u.a,Object(a.a)({},b,{key:"img"+this._tryCount,className:"not-loaded",style:{},needDom:!0,ref:e=>g?g(e?e.getDom():e):this._dom=e,src:N,oriSrc:this.props.src,onError:this._handleError,onLoad:this._handleLoad})));return N&&N.startsWith("blob")?this._loadingBlob=!0:this._loadingBlob=!1,r.a.createElement(u.a,Object(a.a)({},b,{key:"img"+this._tryCount,needDom:!0,ref:e=>g?g(e?e.getDom():e):this._dom=e,src:N,oriSrc:this.props.src,onError:this._handleError,onLoad:this._handleLoad}))}}P.propTypes={src:c.a.string.isRequired,className:c.a.string,width:c.a.oneOfType([c.a.string,c.a.number]),height:c.a.oneOfType([c.a.string,c.a.number]),style:c.a.object,successStyle:c.a.object,refProp:c.a.func,onLoad:c.a.func,onError:c.a.func,onClick:c.a.func,onWheel:c.a.func,draggable:c.a.bool,isDoomCached:c.a.bool,simpleConvInfo:c.a.object,dragSrc:c.a.string,timestamp:c.a.number,checkRedirect:c.a.bool,checkUrls:c.a.bool,hideBroken:c.a.bool,showLoadingIconOnChecking:c.a.bool,placeholderContainerStyle:c.a.object},P.defaultProps={alternates:[],placeholderContainerStyle:{position:"absolute"}},t.d=P},"45ei":function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return i}));var a=s("AH6j");let n;!function(e){e.Start="Start",e.Exit="Exit",e.Idle="Idle",e.Active="Active",e.FirstIdle="FirstIdle",e.Authenticated="Authenticated"}(n||(n={}));class i extends a.a{constructor(e){super(n.Authenticated),this.session=e}}},"4Dc2":function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var a=s("mmfo"),n=s("ndDP"),i=s.n(n),o=s("Sfwx"),r=s("NDmK");function l(e,t){const s=new i.a({maxSize:1e3});return function(...a){return Object(o.f)(function(...e){var a;const n=Date.now(),i=t(...e),o=null!=(a=s.get(i))?a:0;return s.set(i,Math.max(o,n)+r.c.image.limiter_delay),Math.max(o-n,0)}(...a),e,...a)}}const c=e=>null==e?void 0:e.url,d=l(a.c,c);Object(o.c)(d,c)},"4Gbf":function(e,t,s){"use strict";s.d(t,"a",(function(){return Vr}));var a=s("VTBJ"),n=s("rePB"),i=s("q1tI"),o=s.n(i),r=s("17x9"),l=s.n(r),c=s("NDmK"),d=s("wx14"),h=s("1pet"),u=s("NGyP"),_=s("DPHK"),m=s("P6UB"),p=s("97kL"),g=s("z0WU"),E=s("lCMA"),f=s("Q8hM"),I=s("Yi2m"),T=s("c51z"),v=s("Ydol"),R=s("6uTC"),S=s("lCn6"),O=s("XS0u"),N=s("EImH"),b=s("l+Gc"),C=s("zM64");const A=(e,t)=>{const{innerRefs:s={},itemProps:n,conv:r,title:l,titleStyle:c={},bodyStyle:_={},isUnread:m}=e,p=((e,t)=>{let s=[];return e?(s=Array.isArray(e)?e.filter((e=>null!=e)):[e],Object(i.useMemo)((()=>[].concat(s).reduce(((e,s)=>(t&&t.includes(s.type)&&(e[s.type]=s.props),e)),[s])))):{}})(e.children,["status","titleMore","label","message","reaction","moreAction","convAction","setting"]),{status:g,titleMore:E,label:f,message:I,reaction:T,moreAction:v,setting:R,convAction:S}=p;return o.a.createElement("div",Object(d.a)({key:r.userId},n,{ref:t}),o.a.createElement("div",{className:"flx flx-center conv-item__avatar"},(O=r.userId,o.a.createElement(u.b,{key:"cavt",size:"l",target:r,className:"conversationList__avatar",type:O===h.CONV_FILTER.STRANGER&&h.AVATAR.STRANGER}))),o.a.createElement("div",{className:`conv-status ${(null==g?void 0:g.className)||""}`,style:(null==g?void 0:g.style)||{}},null==g?void 0:g.children),o.a.createElement("div",{className:"conv-item-content  flx-center flx flx-col conv-rel",ref:s.contentRef},o.a.createElement("div",{className:"conv-item-title flx flx-al-c rel w100",style:Object(a.a)({},c)},o.a.createElement("div",{className:m?"conv-item-title__name conv-item-title__name--bold truncate":"conv-item-title__name truncate"},o.a.createElement("span",{className:"truncate ws-pre"},l)),E&&o.a.createElement("div",{className:"conv-item-title__more",style:Object(a.a)({},null==E?void 0:E.customStyle)},null==E?void 0:E.children)),(f||I||v)&&o.a.createElement("div",{className:"conv-item-body flx flx-al-c",style:Object(a.a)({},_)},o.a.createElement("div",{className:"conv-item-body__main truncate flx flx-al-c",style:Object(a.a)(Object(a.a)({},null==f?void 0:f.customStyle),null==I?void 0:I.customStyle)},null==f?void 0:f.children,null==I?void 0:I.children),v&&o.a.createElement("div",{className:`conv-item-body__action ${v.className||""}`,style:v.style||{}},v.children)),T&&T.children),R&&o.a.createElement("div",{className:"conv-item-setting",style:Object(a.a)({},null==R?void 0:R.customStyle)},R.children),null==S?void 0:S.children);var O};A.propTypes={itemProps:l.a.object,conv:l.a.object.isRequired,title:l.a.string.isRequired,isUnread:l.a.bool};var y=Object(i.forwardRef)(A),D=s("zRkS"),M=s("MPLC"),P=s("Ja3U"),w=s("dpMp"),L=s("CzFt"),k=s("UiPd");class x extends o.a.Component{constructor(e){super(e),this.state={notiNewFriends:!0,needRefresh:!1,item:this.props.item,smsUnreadCount:this.props.item.inSectionHiddenChat?this.props.item.smsUnreadCount:0},this._onSelectConversation=this._onSelectConversation.bind(this),this._acceptFriendRequest=this._acceptFriendRequest.bind(this),this._rejectFriendRequest=this._rejectFriendRequest.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this.showAction=this.showAction.bind(this),this._eventHandler=this._eventHandler.bind(this),this._isActive=!0,this.closeAction=this._closeAction.bind(this)}componentWillMount(){v.default.subscribe(this._eventHandler)}componentWillReceiveProps(e){g.default.objectEqual(this.props.item,e.item)||this.setState({item:Object(a.a)({},e.item)})}_eventHandler(e,t){switch(e){case p.FetchActions.UPDATE_NAME:t&&this.props.item&&!this.props.item.order&&(t.constructor===Object&&this.props.item.userId===t.userId||t.constructor===Array&&t.includes(this.props.item.userId))&&this.setState({needRefresh:!this.state.needRefresh});break;case p.FetchActions.STATUS_BLOCKED_CHANGED:t&&t.includes(this.props.item.userId)&&this.setState({needRefresh:!this.state.needRefresh});break;case p.ConversationListActions.TAG_CONV:if(t&&t.data){let e=t.data.reduce(((e,t)=>(t&&(e[t.userId]=t.label),e)),{});e&&!0===e.hasOwnProperty(this.props.item.userId)&&this.setState((t=>{let s=Object.assign({},t.item);return s.label=e[this.props.item.userId],{item:s}}))}break;case p.ConversationListActions.SCROLL_CONTACT_LIST:this._closeAction();break;case p.FetchActions.CLEAR_UNREAD:case p.ChatBoxActions.READ_CONVERSATION:this.state.item&&this.state.item.inSectionHiddenChat&&this.state.item.userId==t.conversationId&&0!==this.state.smsUnreadCount&&this.setState({smsUnreadCount:0});break;case p.ChatBoxActions.UNDO_DELETE_MESSAGES:case p.FetchActions.ADD_MESSAGES:this.state.item&&this.state.item.inSectionHiddenChat&&this.state.item.userId==t.conversationId&&this.setState({smsUnreadCount:t.conversation?t.conversation.smsUnreadCount:0})}}_preloadMsgs(e=350){this._preloadTimer||this.props.isHighlighted||(this._preloadTimer=setTimeout((()=>{var e;if(this._preloadTimer=null,!this._isActive)return;if(this.props.isHighlighted)return;let t=this.props.getConversationFromId(this.props.item.userId);t&&(null===(e=M.b.messageCache)||void 0===e||e.loadCacheMessages(t))}),e))}_onMouseEnter(){let e=350;this.props.fromSearch&&(e=this.props.fromSearch>1?100:200),this._preloadMsgs(e)}_onMouseLeave(){this._preloadTimer&&(clearTimeout(this._preloadTimer),this._preloadTimer=null)}componentDidUpdate(e,t){!e.isSelected&&this.props.isSelected?this._preloadMsgs(180):e.isSelected&&!this.props.isSelected&&this._onMouseLeave()}componentWillUnmount(){this._isActive=!1,this._onMouseLeave(),v.default.unsubscribe(this._eventHandler)}_onSelectConversation(e){if(e&&!isNaN(e.detail)&&e.detail>1)return;this.props.setFocusIndex&&this.props.setFocusIndex(),this.props.selectConversation(Object(a.a)({},this.props.item),!1,this.props.indexItem),g.default.preventClickThenFakeNewEvent(e);let t={name:this.props.currentTab,userId:this.props.item.userId,close:!1};return N.a.setOldTab(t),!1}_onDblClickConversation(e){return this.props.selectConversation(Object(a.a)({},this.props.item),!0,this.props.indexItem),g.default.preventClickThenFakeNewEvent(e),!1}_getItemHightLight(e,t){let s=e.rvalue;return o.a.createElement("span",{key:t,className:"txt-highlight"},s)}shouldComponentUpdate(e,t){return this.props.isSelected!==e.isSelected||this.props.isHighlighted!==e.isHighlighted||this.props.selectedNewFriend!==e.selectedNewFriend||this.state.needRefresh!==e.needRefresh||!g.default.objectEqual(this.state.item,t.item)||this.state.smsUnreadCount!==t.smsUnreadCount||this.props.privacySettings!==e.privacySettings||this.state.item.byPassPIN!==t.item.byPassPIN}getOffsetTop(){return this.friendItem?this.friendItem.offsetTop:null}getOffsetHeight(){return this.friendItem?this.friendItem.offsetHeight:null}_formatDNameHighlight(e,t=null,s=null,a=null){if(!t)return e;if("STR_DES_NUM_PHONE"===s){var n;let t=e;if(null!=a&&null!==(n=a.frSuggest)&&void 0!==n&&n.phoneObj){const e=a.frSuggest.phoneObj;t=(84===e.phoneNumber.countryCallingCode?"0":"+"+e.phoneNumber.countryCallingCode)+e.phoneNumber.phone}return[o.a.createElement(E.a,{key:"descKey",textKey:s}),this._getItemHightLight({type:m.a.HIGH_LIGHT,rvalue:t},"searchContact"+this.props.item.userId)]}let i=m.b.parseSearchContact(e,t);s&&i.unshift({type:m.a.LANGUAGE_CHANGE,rvalue:s});let r=[],l=-1,c="",d=0,h="searchContact"+this.props.item.userId;for(let u=0;u<i.length;u++){let e=i[u];switch(e.type){case m.a.LANGUAGE_CHANGE:r.push(o.a.createElement(E.a,{textKey:e.rvalue}));break;case m.a.DOTDOTDOT:l!=m.a.DOTDOTDOT&&(c+="...");break;case m.a.TEXT:c+=e.rvalue;break;case m.a.HIGH_LIGHT:{if(c){let e=h+"_"+d++;r.push(o.a.createElement("span",{key:e},c)),c=""}let t=h+"_"+d++;r.push(this._getItemHightLight(e,t));break}}if(l=e.type,u==i.length-1&&c){let e=h+"_"+d++;r.push(o.a.createElement("span",{key:e},c))}}return r}_getdisplayName(){let e="",t=k.default.getMiniInfo(this.props.item.userId);return t&&(e=t.dName),0===e.length&&(e=this.props.item.displayName),e}_acceptFriendRequest(e){e.stopPropagation(),e.preventDefault(),this.props.acceptFriendRequest(this.props.item.userId)}_rejectFriendRequest(e){this.props.item.delete?P.a.openConfirm({windowId:"1",name:h.MODAL_CONFIRM.confirmIdentities,params:{message:T.default.str("STR_CONFIRM_YES")+" "+this.props.item.displayName+" "+T.default.str("STR_FRIEND_DEL_REQUEST_CONFIRM"),okText:T.default.str("STR_CONFIRM_YES"),cancelText:T.default.str("STR_CONFIRM_NO"),onOk:()=>{this.props.rejectFriendRequest(this.props.item.userId)},oncancel:()=>{}}}):(this.props.rejectFriendRequest(this.props.item.userId),R.a.createSuccess(T.default.str("STR_CONTACT_DELETE_SUGGEST_FRIEND"))),e.stopPropagation(),e.preventDefault()}_fakeEvent(e){return{clientX:e.clientX,clientY:e.clientY,stopPropagation:()=>{},preventDefault:()=>{}}}showAction(e){this.props.searchText&&this.props.searchText.length>0&&I.e.logAction(12309),this.props.showContextMenu?this.props.showContextMenu(this.props.item,e):this.friendAction&&this.friendAction.showAction(e),e.preventDefault(),e.stopPropagation()}_showUserInfo(e,t){this.props.showUserInfo&&(I.e.logAction(1460104),this.props.showUserInfo(t)),e&&(e.stopPropagation(),e.preventDefault())}_callbackPinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.pinned=Date.now(),{item:t}}))}_callbackUnpinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.pinned=null,{item:t}}))}_callbackMute(e){this.setState((t=>{let s=Object.assign({},t.item);return s.muted=e,{item:s}}))}_callbackUnMute(){this.setState((e=>{let t=Object.assign({},e.item);return t.muted=null,{item:t}}))}_closeAction(){this.friendAction&&this.friendAction.close()}_getLabel(){let e=null;const t=b.b.getLabelObjByConversaionId(this.props.item.userId);return t&&(e={color:g.default._verifyColor(t.color)},e=Object(a.a)(Object(a.a)({},e),{},{text:t.text})),e}render(){const e=this.state.item,t=k.default.isBlocked(e.userId);let s=this.props.searchText&&this.props.searchText.length>0&&e.infoSearch,n=e.displayName?e.displayName:this._getdisplayName();e.userId==c.c.sendToMeId&&(n=k.default.getDName(e.userId));let i=this._formatDNameHighlight(n,e.infoSearch?e.infoSearch.orderKeyword:null),r="conv-item conv-rel ",l="";const m=this.props.privacySettings;this.props.selectedNewFriend&&this.props.selectedNewFriend.forEach((t=>{t.userId===e.userId&&(l=" selectedNewFriend ")}));let p=null;this.props.compactLv&&(r+=this.props.isHighlighted?" selected":(this.props.isSelected&&s?"active":"")+l+(e.notiNewFriends?" highlightContact ":" "));let I=null;if(g.default.enableLogSearch())e.pointSearch>=0&&(I=(e.detail?e.detail.key:"no track")+": "+e.pointSearch+" = "+(e.detail?e.detail.descCalc:0));else if(s)if(e.infoSearch.frSuggest){let t=null;e.infoSearch.frSuggest.isLegacyName&&(t="STR_LEGACY_SEND2ME_DES"),e.infoSearch.frSuggest.isPbook?t="STR_CONTACT_DES":e.infoSearch.frSuggest.isZname?t="STR_ZALONAME_DES":e.infoSearch.frSuggest.isNumphone&&(t="STR_DES_NUM_PHONE"),I=this._formatDNameHighlight(e.infoSearch.frSuggest.name,e.infoSearch.frSuggest.orderKeyword,t,e.infoSearch)}else e.infoSearch.frMutualGr&&e.infoSearch.frMutualGr.grName?I=o.a.createElement("div",{className:"truncate"},o.a.createElement(E.a,{textKey:"STR_DES_MUTUAL_GR"})," "+e.infoSearch.frMutualGr.grName):0!==e.isFr||g.default.isOAType(e)||(I=o.a.createElement(E.a,{textKey:"STR_DES_STRANGER"}));p=I?o.a.createElement("span",{className:"friend_online_status truncate",style:{top:"0px",left:"3px"}},I):null;let T=null,v=null,[R,N]=_.a.getLastActiveText(c.c.online_configs.is_enable_new?e.lastOnlineTime:e.lastActionTime,null),A=e.friendOnl;if(void 0===A&&(A=N),e&&!0==!!A&&!1!==e.showMode){let t=h.USER_MODE.AVAILABLE;switch(1===c.c.enable_busy_mode&&(t=e.user_mode),c.c.enable_privacy_settings&&m&&!1===m.show_online_status&&(t=h.USER_MODE.INVISIBLE),t){case h.USER_MODE.AWAY:case h.USER_MODE.AVAILABLE:v=o.a.createElement("div",{style:{width:"12px",height:"12px",background:"var(--green-300)",borderRadius:"50%",display:"inline-block",border:"2px solid var(--white-300)",marginBottom:"-4px"}});break;case h.USER_MODE.BUSY:v=o.a.createElement("div",{style:{width:"16px",height:"16px",borderRadius:"50%",background:"var(--white-300)",position:"relative",top:"4px"}},o.a.createElement("i",{className:"fa fa-busy",style:{fontSize:"12px",position:"absolute",top:"2px",left:"2px",color:"var(--red-300)"}}));break;case h.USER_MODE.INVISIBLE:}v&&(T=o.a.createElement("div",{style:{position:"absolute",top:"44px",left:"50px",zIndex:1}},v))}let M=O.default.getFriendCache();if(M[e.userId]&&1===M[e.userId].isFr&&(M=!0),!s&&e.friendRequestType&&!M){let t,s,i,l,c=o.a.createElement(E.a,{textKey:"STR_DESC_SUGGEST"});i=o.a.createElement(f.a,{tagName:"a",textKey:"STR_DELETE",className:"btn-action recommended-friend-item__btn friend-request-item__close ",onClick:this._rejectFriendRequest,style:{width:"52px",padding:0}},o.a.createElement(E.a,{textKey:"STR_DELETE_MSG"}));let d={width:"52px"};return e.friendRequestType===h.FRIEND_REQUEST_TYPE_REQUEST?(s="friend-request-item__btn",l=e.friendRequestMsg?`"${e.friendRequestMsg}"`:null,t=o.a.createElement(E.a,{textKey:"STR_ACCEPT"}),d={width:"52px",right:"65px"}):(s="recommended-friend-item__btn",e.requested?(t=o.a.createElement(E.a,{textKey:"STR_CHAT"}),s+=" requested",i="",d={width:"77px"}):t=o.a.createElement(E.a,{textKey:"STR_CONTACT_SUGGEST_BUTTON_ADD"})),c=o.a.createElement(E.a,{textKey:S.a.getSourceKey(e.friendRequestSource)}),o.a.createElement("div",{key:e.userId,onClick:t=>this._showUserInfo(t,e.userId),ref:e=>this.friendItem=e,className:r+" friend-request-item "+(e.friendRequestType===h.FRIEND_REQUEST_TYPE_REQUEST&&l?"requesting":"")+(e.justRead?" highlightContact ":""),onContextMenu:e=>this.showAction(e)},o.a.createElement(u.b,{size:"l",className:"list-friend-conctact__avatar",target:e,showUnread:!1}),o.a.createElement("div",{className:"friend-request-item__content"+(e.friendRequestType!==h.FRIEND_REQUEST_TYPE_REQUEST||l?"":" no-message")},o.a.createElement("div",{className:"friend-request-item__suggest_title truncate"},n),o.a.createElement("div",{className:"friend-request-item__message truncate"},c),o.a.createElement("div",{className:"friend-request-item__message friend-request-item__message--top truncate"},l)),o.a.createElement("div",{style:{position:"absolute",right:"10px",top:0}},o.a.createElement("a",{onClick:this._acceptFriendRequest,className:s+" btn-action ",style:Object(a.a)({textAlign:"center",position:"absolute",color:"var(--white-300)",lineHeight:"21px",padding:0},d)},t),i))}s||e.userId!=c.c.sendToMeId||(i=o.a.createElement(E.a,{textKey:"KEY_NAME_SEND2ME"}));let P=null;if(this.props.item)if(P=b.b.getLabelObjByConversaionId(this.props.item.userId),P){let e=g.default._verifyColor(P.color);P=o.a.createElement("div",{style:{fontSize:"12px",marginLeft:"14px",marginTop:"3px",color:"var(--neutral-500)"},className:"truncate flx flx-al-c"},o.a.createElement("i",{className:"fa fa-solid-tag",style:{marginRight:"5px",color:e}}),o.a.createElement("div",{className:"truncate"},P.text))}else P=null;let w=!1,L=e.muted,x="",U=null;if(s&&e.inSectionHiddenChat&&g.default.valueValid(this.state.smsUnreadCount)&&parseInt(this.state.smsUnreadCount)>0){w=!0;const e=parseInt(this.state.smsUnreadCount),t=!1;x=t?"N":e<=5?`${e}`:"5plus",U=t?{width:"16px",height:"16px",marginTop:"2px",marginRight:"4px",color:"var(--red-300)",paddingRight:"5px"}:e<=5?{width:"16px",height:"16px",color:"var(--red-300)",paddingRight:"5px"}:{width:"22px",height:"16px",color:"var(--red-300)",paddingRight:"5px"},L&&(U.color="var(--neutral-600)")}const F=w?"conv-action__menu":"conv-action__menu conv__force___adding--normal";return o.a.createElement(y,{itemProps:{id:`friend-item-${e.userId}`,key:e.userId,className:r+(e.newsFriend&&e.selectedNewFriend||e.justRead?" new-just-read":""),onClick:this._onSelectConversation,onDoubleClick:this._onDblClickConversation.bind(this),ref:e=>this.friendItem=e,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onContextMenu:this.showAction},conv:e,title:i},o.a.createElement("status",null,t?o.a.createElement("div",{className:"conv-block"},o.a.createElement(D.a,{className:"profile-icon-block"})):v),this._getLabel()&&!I?o.a.createElement("label",{customStyle:{fontSize:"12px"}},o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{color:this._getLabel().color},className:"conv__label"},o.a.createElement(D.a,{className:"icon-solid-label-filled"})),o.a.createElement("span",{style:{color:this._getLabel().color},className:"truncate"},this._getLabel().text))):null,o.a.createElement("titleMore",null,o.a.createElement("div",{className:F,style:{width:"42px",height:"19px"}})),p?o.a.createElement("message",null,o.a.createElement("div",{className:"item-message truncate"},p)):null,o.a.createElement("setting",{customStyle:{alignItems:"center",justifyContent:"center"}},o.a.createElement("div",{className:"conv-action__menu ",onClick:this.showAction},o.a.createElement(D.a,{className:"icon-solid-more"})),w?o.a.createElement("div",{className:"conv-action__unread",style:{position:"absolute"}},o.a.createElement("i",{className:"fa fa-"+x+" func-unread"+(L?" func-unread__muted":""),style:U})):null),o.a.createElement("convAction",null,o.a.createElement(C.a,Object(d.a)({popoverProps:{identity:{windowId:"1",name:`${h.PopoverIdentitiesDefine.CONTEXTMENU_CONTACT_ITEM} ${e.userId}`}}},this.props.conversationActionProps,{key:"friendpAct",ref:e=>this.friendAction=e,confirm:this.props.confirm,deleteConversation:this.deleteConversation,state:e,dispatch:this.props.dispatch,user:this.props.user,callbackPinMe:this._callbackPinMe.bind(this),callbackUnpinMe:this._callbackUnpinMe.bind(this),callbackMute:this._callbackMute.bind(this),callbackUnMute:this._callbackUnMute.bind(this),showUserInfo:this.props.showUserInfo,showEditAlias:this.props.showEditAlias}))))}}x.propTypes={conversationActionProps:l.a.any};var U=Object(L.sidebarConnect)(((e,t)=>{const s=[-1e3,g.default.userIdMe()];try{if(!t.item||!t.item.userId||s.includes(t.item.userId))return{item:t.item};let n=t.item.userId&&Object(w.contactByIdSelector)(t.item.userId)(e);return n?t.item.infoSearch?{item:Object(a.a)(Object(a.a)({},t.item),{},{displayName:n.displayName})}:{item:n}:(n=t.item,{item:n})}catch(n){}}),void 0,void 0)(x),F=s("6dTG"),G=s("nmyE"),B=s("dThN"),H=s("h0sc");class j extends o.a.Component{constructor(e){super(e),this.state={item:this.props.item,smsUnreadCount:this.props.item.inSectionHiddenChat?this.props.item.smsUnreadCount:0},this.fetcher=B.default,this._eventHandler=this._eventHandler.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this),this._isActive=!0}componentWillReceiveProps(e){g.default.objectEqual(this.props.item,e.item)||this.setState({item:Object(a.a)({},e.item)})}shouldComponentUpdate(e,t){return this.props.isSelected!==e.isSelected||this.props.isHighlighted!==e.isHighlighted||this.props.item.displayName!==e.item.displayName||this.props.item.infoSearch!=e.item.infoSearch||this.props.item.topMember!==e.item.topMember||!g.default.objectEqual(this.state.item,t.item)||this.state.smsUnreadCount!==t.smsUnreadCount||this.state.item.byPassPIN!==t.item.byPassPIN}_preloadMsgs(e=350){this._preloadTimer||this.props.isHighlighted||(this._preloadTimer=setTimeout((()=>{var e;if(this._preloadTimer=null,!this._isActive)return;if(this.props.isHighlighted)return;let t=this.props.getConversationFromId(this.props.item.userId);t&&(null===(e=M.b.messageCache)||void 0===e||e.loadCacheMessages(t))}),e))}_onMouseEnter(){let e=350;this.props.fromSearch&&(e=this.props.fromSearch>1?100:200),this._preloadMsgs(e)}_onMouseLeave(){this._preloadTimer&&(clearTimeout(this._preloadTimer),this._preloadTimer=null)}componentDidUpdate(e,t){!e.isSelected&&this.props.isSelected?this._preloadMsgs(180):e.isSelected&&!this.props.isSelected&&this._onMouseLeave()}getOffsetTop(){return this.groupItem?this.groupItem.offsetTop:null}getOffsetHeight(){return this.groupItem?this.groupItem.offsetHeight:null}_onSelectConversation(e){if(!(e&&!isNaN(e.detail)&&e.detail>1))return this.props.selectConversation(Object(a.a)({},this.props.item),!1,this.props.indexItem),g.default.preventClickThenFakeNewEvent(e),!1}_onDblClickConversation(e){return this.props.selectConversation(Object(a.a)({},this.props.item),!0,this.props.indexItem),g.default.preventClickThenFakeNewEvent(e),!1}_showChangeGrName(){this._inputGrName&&this._inputGrName._GroupChangeNameEvent()}componentDidMount(){v.default.subscribe(this._eventHandler)}componentWillUnmount(){v.default.unsubscribe(this._eventHandler),this._onMouseLeave()}_eventHandler(e,t){switch(e){case p.GeneralActions.SHOW_CHANGE_GROUP_NAME:t&&t.focusedGroup.userId===this.props.item.userId&&this._showChangeGrName();break;case p.ConversationListActions.TAG_CONV:if(t&&t.data){let e=t.data.reduce(((e,t)=>(t&&(e[t.userId]=t.label),e)),{});e&&!0===e.hasOwnProperty(this.props.item.userId)&&this.setState((t=>{let s=Object.assign({},t.item);return s.label=e[this.props.item.userId],{item:s}}))}break;case p.FetchActions.CLEAR_UNREAD:case p.ChatBoxActions.READ_CONVERSATION:this.state.item&&this.state.item.inSectionHiddenChat&&this.state.item.userId==t.conversationId&&0!==this.state.smsUnreadCount&&this.setState({smsUnreadCount:0});break;case p.ChatBoxActions.UNDO_DELETE_MESSAGES:case p.FetchActions.ADD_MESSAGES:this.state.item&&this.state.item.inSectionHiddenChat&&this.state.item.userId==t.conversationId&&this.setState({smsUnreadCount:t.conversation?t.conversation.smsUnreadCount:0})}}_updateGroupName(e){if(e&&this.props.item.displayName!=e){const t=this.props.item.userId;this.fetcher.changeGroupName(t,e).catch((e=>{e&&161===e.error_code&&S.a.handleInvalidGroup(t,this.props.dispatch)}))}}_getItemHightLight(e,t){let s=e.rvalue;return o.a.createElement("span",{key:t,className:"txt-highlight"},s)}_displayText(e,t=null,s=!1){let a="searchContact"+this.props.item.userId;if(!t)return e;let n=m.b.parseSearchContact(e,t);s&&n.unshift({type:m.a.LANGUAGE_CHANGE,rvalue:"STR_MEMBER_SEARCH"});let i=[],r=-1,l="",c=0;for(let d=0;d<n.length;d++){let e=n[d];switch(e.type){case m.a.DOTDOTDOT:r!=m.a.DOTDOTDOT&&(l+="...");break;case m.a.ICON_CONTACT:i.push(o.a.createElement("i",{className:"fa fa-tab-contact",style:{paddingRight:"6px"}}));break;case m.a.TEXT:l+=e.rvalue;break;case m.a.HIGH_LIGHT:{if(l){let e=a+"_"+c++;i.push(o.a.createElement("span",{key:e},l)),l=""}let t=a+"_"+c++;i.push(this._getItemHightLight(e,t));break}case m.a.LANGUAGE_CHANGE:i.push(o.a.createElement(E.a,{textKey:e.rvalue}))}if(r=e.type,d==n.length-1&&l){let e=a+"_"+c++;i.push(o.a.createElement("span",{key:e},l))}}return i}_displayChangeName(e=!1){let t=this.props.item.displayName;return o.a.createElement(G.a,{ref:e=>this._inputGrName=e,currentValue:t,onSubmitFunc:this._updateGroupName.bind(this),shouldChange:!1,allowEmpty:!1,inputClassName:"group-name-input tabgroup",labelClassName:"group-item-name"+(e?" noMargin":""),allowChangeGrName:!0,preventClick:!0})}_displayMemberNameInGroup(e){if(g.default.enableLogSearch()){if(e.pointSearch>=0)return o.a.createElement("div",{className:"item-message truncate result-list__message"},(e.detail?e.detail.key:"no track")+": "+e.pointSearch+" = "+(e.detail?e.detail.descCalc:0))}else if(e.infoSearch&&e.infoSearch.grSuggest)return o.a.createElement("div",{className:"item-message truncate result-list__message"},this._displayText(e.infoSearch.grSuggest.name,e.infoSearch.grSuggest.orderKeyword,!!e.infoSearch.grSuggest));return""}_onContextMenu(e){e.preventDefault(),this.props.searchText&&this.props.searchText.length>0&&I.e.logAction(12310),this.groupItemAction&&this.groupItemAction.showAction(e)}_callbackPinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.pinned=Date.now(),{item:t}}))}_callbackUnpinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.pinned=null,{item:t}}))}_callbackMute(e){this.setState((t=>{let s=Object.assign({},t.item);return s.muted=e,{item:s}}))}_callbackUnMute(){this.setState((e=>{let t=Object.assign({},e.item);return t.muted=null,{item:t}}))}render(){const e=this.state.item;let t,s=this.props.searchText&&this.props.searchText.length>0,n=!!(s&&e.infoSearch&&e.infoSearch.grSuggest),i="conv-item conv-rel ",r=null;s&&!n?t=this._displayText(e.displayName,e.infoSearch?e.infoSearch.orderKeyword:null):(t=this._displayChangeName(n),r=this._showChangeGrName.bind(this)),i+=this.props.isHighlighted?" selected ":this.props.isSelected?" active":"";let l=s?this._displayMemberNameInGroup(e):"",c=null,d={};var u,_;if(this.props.item)if(c=b.b.getLabelObjByConversaionId(this.props.item.userId),d={text:null===(u=c)||void 0===u?void 0:u.text,color:null===(_=c)||void 0===_?void 0:_.color},c){let e=g.default._verifyColor(c.color);d=Object(a.a)(Object(a.a)({},d),{},{color:e}),c=o.a.createElement("div",{style:{fontSize:"12px",color:"var(--neutral-500)"},className:"truncate flx flx-al-c"},o.a.createElement("i",{className:"fa fa-solid-tag",style:{marginRight:"5px",color:e}}),o.a.createElement("div",{className:"flx-1 truncate"},c.text))}else c=null,d=null;let m={transform:"translate(0,0)",maxHeight:"34px"};c&&(m=Object(a.a)(Object(a.a)({},m),{},{display:"flex",flexDirection:"column",height:"100%",lineHeight:"initial",justifyContent:"center",maxHeight:"initial",alignItems:"flex-start"}));let p=!1,E=e.muted,f="",I=null;if(s&&e.inSectionHiddenChat&&g.default.valueValid(this.state.smsUnreadCount)&&parseInt(this.state.smsUnreadCount)>0){p=!0;const e=parseInt(this.state.smsUnreadCount),t=!1;f=t?"N":e<=5?`${e}`:"5plus",I=t?{width:"16px",height:"16px",marginTop:"2px",marginRight:"4px",color:"var(--red-300)",paddingRight:"5px"}:e<=5?{width:"16px",height:"16px",color:"var(--red-300)",paddingRight:"5px"}:{width:"22px",height:"16px",color:"var(--red-300)",paddingRight:"5px"},E&&(I.color="var(--neutral-600)")}const T=p?"conv-action__menu":"conv-action__menu conv__force___adding--normal";return o.a.createElement(y,{itemProps:{id:`group-item-${e.userId}`,key:e.userId,className:i,onClick:this._onSelectConversation.bind(this),onDoubleClick:this._onDblClickConversation.bind(this),onContextMenu:this._onContextMenu,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,ref:e=>this.groupItem=e},conv:e,title:this._displayText(e.displayName,e.infoSearch?e.infoSearch.orderKeyword:null)},d&&!l&&o.a.createElement("label",{customStyle:{fontSize:"12px"}},o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{color:d.color},className:"conv__label"},o.a.createElement(D.a,{className:"icon-solid-label-filled"})),o.a.createElement("span",{style:{color:d.color},className:"truncate"},d.text))),o.a.createElement("titleMore",null,o.a.createElement("div",{className:T,style:{width:"42px",height:"19px"}})),o.a.createElement("setting",{customStyle:{alignItems:"center",justifyContent:"center"}},o.a.createElement("div",{className:"conv-action__menu ",onClick:this._onContextMenu},o.a.createElement(D.a,{className:"icon-solid-more"})),p?o.a.createElement("div",{className:"conv-action__unread",style:{position:"absolute"}},o.a.createElement("i",{className:"fa fa-"+f+" func-unread"+(E?" func-unread__muted":""),style:I})):null),l?o.a.createElement("message",null,l):null,o.a.createElement("convAction",null,o.a.createElement(C.a,{popoverProps:{identity:{windowId:"1",name:`${h.PopoverIdentitiesDefine.CONTEXTMENU_GROUP_ITEM}-${e.userId}`}},key:"groupAct",ref:e=>this.groupItemAction=e,confirm:this.props.confirm,deleteConversation:this.deleteConversation,state:e,dispatch:this.props.dispatch,user:this.props.user,callbackPinMe:this._callbackPinMe.bind(this),callbackUnpinMe:this._callbackUnpinMe.bind(this),callbackMute:this._callbackMute.bind(this),callbackUnMute:this._callbackUnMute.bind(this),showUserInfo:this.props.showUserInfo,showEditAlias:this.props.showEditAlias,presets:"Thread"})))}}var V=Object(L.sidebarConnect)(((e,t)=>{const s=[-1e3,g.default.userIdMe()];try{if(!t.item||!t.item.userId||s.includes(t.item.userId))return{item:t.item};let n=t.item.userId&&Object(w.groupByIdSelector)(t.item.userId)(e);return n?t.item.infoSearch?{item:Object(a.a)(Object(a.a)({},t.item),{},{displayName:n.displayName})}:{item:n}:(n=t.item,{item:n})}catch(n){}}),void 0,void 0)(j),K=s("d+hT"),W=(s("qhFK"),s("rpfO")),Y=s("ES/k");class z extends o.a.Component{constructor(e){super(e),this.state={item:this.props.item},this._eventHandler=this._eventHandler.bind(this)}componentWillMount(){v.default.subscribe(this._eventHandler)}componentWillUnmount(){v.default.unsubscribe(this._eventHandler)}_eventHandler(e,t){switch(e){case p.ConversationListActions.TAG_CONV:if(t&&t.data){let e=t.data.reduce(((e,t)=>(t&&(e[t.userId]=t.label),e)),{});e&&!0===e.hasOwnProperty(this.props.item.conversation.userId)&&this.setState((t=>{let s=Object.assign({},t.item);return s.conversation.label=e[this.props.item.conversation.userId],{item:s}}))}}}shouldComponentUpdate(e,t){return this.props.item!==e.item||this.props.isHighlight!=e.isHighlight||this.props.isSelected!==e.isSelected||!g.default.objectEqual(this.state.item.conversation,t.item.conversation)}_getItemHightLight(e,t){let s=e.rvalue.substring(1,e.len+1),a=e.rvalue.substring(1+e.len),n=e.rvalue.substring(0,1);return o.a.createElement("span",{key:t},n,o.a.createElement("span",{className:"txt-highlight"},s),a)}getOffsetTop(){return this._ele?this._ele.offsetTop:0}getOffsetHeight(){return this._ele?this._ele.offsetHeight:0}getSender(e){if(!e)return null;let t,s=e.fromUid;return t="0"==s||s==k.default.getUidMe()?T.default.str("STR_YOU_2"):s?k.default.getDName(s):null,t||e.dName}getDisplayName(e){let t=e||this.props.item.conversation,s=t.displayName;if(t.isGroup)return s;let a=k.default.getMiniInfo(t.userId||t.id);return a&&(s=a.dName.length>0?a.dName:s),s}selectResult(e,t){this.props.setFocusIndex&&this.props.setFocusIndex(),this.props.selectResult(e,t,this.props.index)}_onContextMenu(e,t=null){this.itemAction&&!this.props.isMultiSel&&this.itemAction.showAction(e)}_callbackPinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.conversation.pinned=Date.now(),{item:t}}))}_callbackUnpinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.conversation.pinned=null,{item:t}}))}_callbackMute(e){this.setState((t=>{let s=Object.assign({},t.item);return s.conversation.muted=e,{item:s}}))}_callbackUnMute(){this.setState((e=>{let t=Object.assign({},e.item);return t.conversation.muted=null,{item:t}}))}render(){let e,t=this.state.item,s=t.conversation,a=t.message,n=this.props.keyword,i="sr_"+a.msgId,r=Y.a.simpleGetTextFromMessage(a.message).replace(/[\n\r\t]/g," "),l=this.props.inConverastion?null:this.getSender(a),c=this.props.numCharInView||40,d=Math.round(c/3);if(l){let t=0;l.length>d&&(l=l.slice(0,d-3)+"..."),l+=": ",r.length+l.length>c&&(t=r.length+l.length-c,t=Math.min(t,r.length-d-3)),e=m.b.parseSearchContent(r,n,t),e.unshift({type:m.a.TEXT,rvalue:l})}else{let t=0;r.length>c&&(t=r.length-c),e=m.b.parseSearchContent(r,n,t)}let h=[],u=-1,p="",g=0;for(let _=0;_<e.length;_++){let t=e[_];switch(t.type){case m.a.DOTDOTDOT:u!=m.a.DOTDOTDOT&&(p+="...");break;case m.a.TEXT:p+=t.rvalue;break;case m.a.HIGH_LIGHT:{if(p){let e=i+"_"+g++;h.push(o.a.createElement("span",{key:e},p)),p=""}let e=i+"_"+g++;h.push(this._getItemHightLight(t,e));break}}if(u=t.type,_===e.length-1&&p){let e=i+"_"+g++;h.push(o.a.createElement("span",{key:e},p))}}let f=_.a.getTimeFromNow(a.sendDttm),I=null;if(this.props.inConverastion){let e=null;e="0"==a.fromUid||a.fromUid==k.default.getUidMe()?k.default.getMiniProfileMe():k.default.getMiniInfo(a.fromUid),I=e?{avatar:e.avatar,displayName:e.dName||a.dName,id:a.fromUid}:s}else I=s;return o.a.createElement(y,{itemProps:{id:`search-item-${a.msgId}`,key:a.msgId,className:"conv-item conv-rel "+(this.props.isSelected?" active":"")+(this.props.isHighlight?" selected":""),onContextMenu:this._onContextMenu.bind(this),ref:e=>this._ele=e,onClick:()=>{this.selectResult(t,!1)},onDoubleClick:()=>{this.selectResult(t,!0)}},conv:I,title:this.getDisplayName(I)},o.a.createElement("titleMore",null,Object(E.b)(f)),o.a.createElement("message",{customStyle:{width:"100%"}},o.a.createElement("div",{className:"item-message truncate",title:t.logInfo?t.logInfo.ranking+"/"+t.logInfo.lev+"-"+t.logInfo.msg:""},h)))}}var q=z,X=s("fBUP"),J=s("LJTV"),Q=s("PoHQ"),$=s("EpHD"),Z=(s("VTPT"),s("Xzw3")),ee=s("Ys8R"),te=s("AM4K"),se=s("EFQ6"),ae=s("ro+J"),ne=s("Ff2n"),ie=s("t77n"),oe=s("sANj"),re=s("d4o4"),le=s("/Z5y"),ce=s("EIuX"),de=s("lJzA"),he=s("nXsO"),ue=s("K1g4"),_e=s("I6Kh"),me=s("8euG"),pe=s("ggG7"),ge=s("0bqf");function Ee(e){return o.a.useMemo((()=>function(e){const t=Object(de.a)(e);if(!t)return;let s=`${t.msgId}`.includes("_")?null:""+t.msgId;const a=ie.a.utils.getPrimaryId(t),{FileSearchItemModel:n}=ie.a.models,i=new n({params:ie.a.utils.getMessageFileParams(t),conversationId:ie.a.utils.getMessageConversationId(t),fileUrl:ie.a.utils.getFileMessageUrl(t),status:oe.MessageStatus.Delivered,extraInfo:{fromUid:Object(he.a)(t),localPath:t.localPath,folderPath:t.folderPath,sendTime:t.sendDttm,cancelUpload:t.cancelled}});return ie.a.dispatch(oe.FileActionType.Init,{data:i,id:{p:a,s:s}}),s||a}(e)),[])}function fe(e){const{pIdOrMsgId:t,file:s,onFilePathUpdated:a,removeItemByMsgId:n,selectMedia:i,conversationForJumping:r,showMediaAction:l,doAction:c}=e,d=Object(re.d)(e),h=Object(re.a)(e),u=Object(ue.a)(e),_=Object(le.a)(t,ce.y),m=Object(pe.a)(e);return o.a.useCallback((function(e){e&&(e.stopPropagation(),e.preventDefault()),I.e.logAction(1231914),c&&c(),l(e,m,"file",_?u:d,a,n,!1,(()=>i(m,e)),!0,{sendSrc:h},r)}),[m,a,n,i,h,r,l,d,_,u])}function Ie(e){e&&(e.stopPropagation(),e.preventDefault())}var Te=s("iuhU"),ve=s("1oG5"),Re=s("bhNC"),Se=s("gFKI"),Oe=s("iZt5"),Ne=s("ltO/"),be=s("H7mg"),Ce=s("1hAc");s("IQef");function Ae(e,t){const{pIdOrMsgId:s}=e,n=Object(re.h)(e),i=function(e){const t=Object(me.a)(e);return o.a.useMemo((()=>t?function(e){return e&&(e.stopPropagation(),e.preventDefault()),I.e.logAction(123191201),t()}:null),[t])}(e),r=Object(re.d)(e),l=function(e){const{pIdOrMsgId:t,file:s,conversation:a}=e,n=Object(re.a)(e),i=Object(_e.a)(e),r=Object(le.a)(t,ce.z),l=o.a.useCallback((function(e){e&&(e.stopPropagation(),e.preventDefault()),ge.b.forwardMessage(s,{targetId:(a||{}).userId,src:n}),I.e.logAction(1231913),i(e)}),[i,s,a,n]);return r?null:l}(e),c=fe(e),h=Object(a.a)(Object(a.a)({},e),{},{onPreview:n,onShowInFolder:i,onDownload:r,onForward:l,onMore:c});return o.a.createElement(Ce.a,Object(d.a)({},h,{ref:t}))}var ye=o.a.memo(o.a.forwardRef(Ae)),De=s("+ZSp");const Me="search-result-file";function Pe(e){const{pIdOrMsgId:t,filterText:s}=e,a=Object(le.a)(t,ce.F);let n=Y.a.simpleGetTextFromMessage(a).replace(/[\n\r\t]/g," "),i=0;n.length>20&&(i=n.length-20);let r=m.b.parseSearchContent(n,s,i),l=[],c=-1,d="",h=0,u="search_title";for(let _=0;_<r.length;_++){let e=r[_];switch(e.type){case m.a.DOTDOTDOT:c!=m.a.DOTDOTDOT&&(d+="...");break;case m.a.TEXT:d+=e.rvalue;break;case m.a.HIGH_LIGHT:{if(d){let e=u+"_"+h++;l.push(o.a.createElement("span",{className:`${Me}__file-name-seg`,key:e},d)),d=""}let t=u+"_"+h++;l.push(o.a.createElement("span",{className:`${Me}__file-name-seg txt-highlight`,key:t},e.rvalue));break}}if(c=e.type,_==r.length-1&&d){let e=u+"_"+h++;l.push(o.a.createElement("span",{className:`${Me}__file-name-seg`,key:e},d))}}return o.a.createElement(o.a.Fragment,null,l)}const we=o.a.memo(Pe);function Le(e){const{pIdOrMsgId:t}=e,s=Object(le.a)(t,ce.p);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:`${Me}__file-name`,title:s},o.a.createElement(we,e)),o.a.createElement("div",{className:`${Me}__spacer`}),o.a.createElement(ye,Object(d.a)({},e,{className:`${Me}__actions-container`})))}const ke=o.a.memo(Le);function xe(e){const{pIdOrMsgId:t}=e,s=Object(le.a)(t,ce.q),a=Object(le.a)(t,ce.f),n=Object(le.a)(t,ce.C),i=Object(le.a)(t,ce.d),r=o.a.useMemo((()=>a?`${s} - ${a}`:s),[s,a]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(be.a,{isOnCloud:n,size:i,className:`${Me}__cloud-indicator`,detailTipProps:{placement:"right",popperProps:{padding:0}}}),o.a.createElement("div",{className:`${Me}__file-size`,title:r},r),o.a.createElement("div",{className:`${Me}__suggest-preview-file`},o.a.createElement(E.a,{textKey:"STR_CLICK_TO_VIEW"})),o.a.createElement(De.a,Object(d.a)({},e,{className:`${Me}__progress`})),o.a.createElement("div",{className:`${Me}__spacer`}),o.a.createElement("div",{className:`${Me}__send-date`},o.a.createElement(Ne.a,{pIdOrMsgId:t})))}const Ue=o.a.memo(xe);function Fe(e,t){const s=Ee(e);e=Object(a.a)(Object(a.a)({},e),{},{pIdOrMsgId:s});const{isHighlight:n,className:i}=e,r=Object(ne.a)(e,["isHighlight","className"]),[l]=Object(Re.a)(e),c=Object(Se.a)(t,l),h=Object(le.a)(s,ce.A),u=Object(le.a)(s,ce.c),_=Object(le.a)(s,ce.b)===oe.FileActionState.Download,m=Object(Te.a)(Me,h&&`${Me}--folder`,u&&`${Me}--can-preview`,_&&`${Me}--downloading`,n&&"highlight",i),p=function(e){const{pIdOrMsgId:t,conversation:s,file:a,isSearchItem:n,doAction:i,index:r}=e,l=Object(re.h)(e),c=Object(re.d)(e),d=Object(ue.a)(e),h=Object(re.f)(e),u=Object(le.a)(t,ce.c),_=Object(le.a)(t,ce.y),m=Object(le.a)(t,ce.z),p=Object(re.a)(e),g=Object(le.a)(t,ce.A),E=o.a.useCallback((function(e){I.e.logAction(1231911);const t={key:a&&a.msgId,targetId:(s||{}).userId,src:p};return ge.b.showMessageInFolder(a,t),g?ge.d.log(ge.d.ACT.VIEW_FOLDER,t):ge.c.log(ge.c.ACT.VIEW,t),e&&(e.stopPropagation(),e.preventDefault()),i&&i(a,!0,r),n?h(e):u?l(e):_&&d?d(e):c&&c(e,!1)}),[u,_,l,d,c,p,a,s,g]);return m?Ie:E}(e),g=function(e){const t=fe(e);return o.a.useCallback((function(e){return e&&(e.stopPropagation(),e.preventDefault()),t(e,!0)}),[t])}(e);return o.a.createElement(ve.a,Object(d.a)({},r,{ref:c,className:m,onClick:p,onContextMenu:g,thumb:o.a.createElement(Oe.a,{pIdOrMsgId:s,className:`${Me}__thumb`,tickProps:{detailTipProps:{placement:"right"}}}),top:o.a.createElement(ke,e),bot:o.a.createElement(Ue,e)}))}var Ge=o.a.memo(o.a.forwardRef(Fe));var Be=function(e){return o.a.createElement(ae.a,null,o.a.createElement(Ge,e))},He=s("uEOi"),je=s("Py3H"),Ve=s("iFWb");const Ke=47,We=68,Ye=295,ze="all",qe="contacts",Xe="directories",Je="messages",Qe="files",$e="contact",Ze="message";class et extends o.a.Component{constructor(e){super(e),this.storage=O.default,this._selectConversation=this._selectConversation.bind(this),this.state={viewFriend:0,viewGroup:0,viewMessage:0,files:e.result&&e.result.files?e.result.files:[],isRefresh:!1},this._eventHandler=this._eventHandler.bind(this),v.default.subscribe(this._eventHandler),this._showUserInfo=this._showUserInfo.bind(this),this._onTabChange=this._onTabChange.bind(this),this._onScroll=this._onScroll.bind(this),this.getItemKey=this.getItemKey.bind(this),this.renderItem=this.renderItem.bind(this),this._onFilePathUpdated=this._onFilePathUpdated.bind(this),this.getConversationFromUserId=this.getConversationFromUserId.bind(this),this._cacheGroupLeave={}}componentWillReceiveProps(e){if(e.searchText&&this.props.searchText&&e.searchText.trim()!=this.props.searchText.trim()&&this.scrollToTop(),this.props.result&&e.result&&this.props.result.files!==e.result.files){const t=e.result.files||[];for(let e=0;e<this.state.files.length&&(this.state.files[e]&&t[e]&&this.state.files[e].msgId===t[e].msgId);e++)t[e]=this.state.files[e];this.setState({files:t})}}shouldComponentUpdate(e,t){return this.props.result!==e.result||this.props.highlightId!==e.highlightId||this.props.conversation!==e.conversation||this.state.viewGroup!==t.viewGroup||this.state.viewFriend!==t.viewFriend||this.state.files!==t.files||this.state.isRefresh!==t.isRefresh||this.props.recentContact!==e.recentContact}componentDidMount(){Q.default.setCurrentGlobalSearchTab(ze)}componentWillUnmount(){Q.default.setCurrentGlobalSearchTab(null),Q.default.resetGlobalSearchMode(),v.default.unsubscribe(this._eventHandler)}_eventHandler(e,t){switch(e){case p.ChatBoxActions.DOWNLOAD_PROGRESS:this._onProgressUpdate(t.msgId,t.progress,t.progressInBytes);break;case p.ChatBoxActions.FILEPATH_UPDATED:{const e=this.state.files.slice();for(let s=0;s<e.length;s++){const n=e[s];if(n.msgId===t.msgId){const i=Object(a.a)({},n);i.isDownloading&&(i.isDownloading=!1,i.downloadProgress=0),t.ignoreDownloadPath||(t.error?i.downloadError=!0:(t.cancelled||(i.localPath=t.localPath),i.downloadError=!1)),e[s]=i,this.setState({files:e});break}}break}case p.ChatBoxActions.UPDATE_MSG_SUBSTATE:if(t.entries[h.SHARE_FROM_MEDIA_STORE]&&t.originalMsgIds&&t.subState===h.MSG_FILE_EXPIRED){let e=Object.assign({},this.state.shareErrorItem);for(let s in t.originalMsgIds)s&&t.originalMsgIds[s]&&(e[s]=!0);this.setState({shareErrorItem:e}),setTimeout((()=>{this.setState({shareErrorItem:{}})}),5e3)}break;case p.FetchActions.GROUP_LEAVE:g.default.valueValid(t)&&t.constructor==String&&!this._cacheGroupLeave[t]&&(this._cacheGroupLeave[t]=1,this.setState({isRefresh:!this.state.isRefresh}));break;case p.GeneralActions.UPDATE_HIDDEN_CHAT:this.setState({isRefresh:!this.state.isRefresh})}}_onProgressUpdate(e,t,s){let n=this.state.files.slice();for(let i=0;i<n.length;i++){const o=n[i];if(o.msgId===e){n[i]=Object(a.a)(Object(a.a)({},o),{},{isDownloading:!0,downloadProgress:t,progressInBytes:s}),this.setState({files:n});break}}}_onFilePathUpdated(e,t){let s=this.state.files.slice();for(let n=0;n<s.length;n++){const i=s[n];if(i.msgId===e.msgId){s[n]=Object(a.a)(Object(a.a)({},i),{},{localPath:t}),this.setState({files:s}),O.default.updateFile(e.msgId,{msgId:e.msgId,localPath:t},["localPath"]),O.default.updateMessage(e.msgId,{msgId:e.msgId,localPath:t},["localPath"]);break}}t||v.default.send(p.ChatBoxActions.FILEPATH_UPDATED,{msgId:e.msgId,localPath:""})}_getLengthResult(){let e=0;if(this.props.state.filtered){let t=this.props.state.filtered;t.closeFriends&&(e+=t.closeFriends.length),t.friends&&(e+=t.friends.length),t.groups&&(e+=t.groups.length)}return e}_searchResultKeyDown(e){switch(e.which){case h.K_ENTER:this.selectFocusedConversation(!0);break;case h.K_UP:I.e.logAction(12317),this.moveUp();break;case h.K_DOWN:I.e.logAction(12317),this.moveDown();break;case h.K_SPACE:this.selectFocusedConversation(!1);break;case h.K_ESC:this.props.focusInputSearch&&this.props.focusInputSearch()}}moveDown(){this._dataList&&this._dataList.moveFocusDown(((e,t,s)=>{try{e>=0&&s.length>e&&s[e].constructor!=W.c&&this._searchResultList.focus()}catch(a){g.default.logCoreError(a)}}))}moveUp(){this._dataList&&this._dataList.moveFocusUp(((e,t,s)=>{try{(e<0||s[e].constructor==W.c)&&this.props.focusInputSearch&&this.props.focusInputSearch()}catch(a){g.default.logCoreError(a)}}))}getFocusedIndex(){this._dataList&&this._dataList.getFocusedIndex()}scrollToTop(e=!0){this._dataList&&this._dataList.scrollToTop()}selectFocusedConversation(e=!1){if(this._dataList){const t=(t,s,a)=>{if(t&&t.data){let n=this.props.recentContact,i=!1;if(t.data.userId||t.data.conversation&&t.data.conversation.userId){let e=t.data.userId||t.data.conversation.userId;if(!se.a.isThreadHidden(e)){for(let s=0;s<n.length;s++)if(n[s].userId==e){i=!0;break}let t={name:i||e.startsWith(h.GROUPID_PREFIX)?Ze:$e,userId:e};N.a.setOldTab(t)}}let o=null;if(t.data.dataListItemType&&"search_phone_number"===t.data.dataListItemType)this._searchPhoneNumber(t.data.phoneNumber);else if("file"===t.data.dataListItemType){const e=this._dataList.getFocusedItemRef();e&&e._onClickFile()}else t.data.message?(I.e.logAction(12311),!s||this._dataList.state&&2==this._dataList.state.focusedIndex?I.e.logAction(12312):I.e.logAction(12313),this.props.selectResult(t.data)):(this._selectConversation(t.data,e,s?this._dataList.getFocusedIndex():a),o=t.data.userId);if(!this.props.conversation)switch(this.selectedTab){case qe:I.e.logAction(1231905);break;case Je:I.e.logAction(1231908);break;case Qe:I.e.logAction(1231911)}return o}};let s=this._dataList.getFocusedItem();if(s&&s.constructor===W.b)return I.e.logAction(1232016),t(s,!0);let a=this._dataList.getItems();for(let e=this._dataList.getFocusedIndex();e<a.length;e++){let s=a[e];if(s&&s.constructor===W.b)return t(s,!1,e)}}}_focusInputBox(){v.default.send(p.ChatBoxActions.FOCUS_INPUT)}_selectConversation(e,t=!1,s=-1){let a=!1,n=this.props.recentContact;if(e){if(J.b.startPerf(J.a),e.userId&&!se.a.isThreadHidden(e.userId)){for(let s=0;s<n.length;s++)if(n[s].userId==e.userId){a=!0;break}let t={name:a||e.userId.startsWith(h.GROUPID_PREFIX)?Ze:$e,userId:e.userId};N.a.setOldTab(t)}if(K.a.pushTrackingFrecencyV2(this.props.searchText,e.userId,e.infoSearch?e.infoSearch.constBonus:0),e.phone&&e.phone.length>0&&je.a.setFriendRequestSource(e.userId,h.FRIEND_REQUEST_SRC_GLOBAL_PHONE),!se.a.isThreadHidden(e.userId)){let t=g.default.isOAType(e);He.a.addCacheSearch({userId:e.userId,displayName:e.displayName,avatar:e.avatar,type:t?2:e.isGroup?1:0})}if(e.inSectionHiddenChat&&e.smsUnreadCount&&this._dataList.props&&this._dataList.props.items)for(let t of this._dataList.props.items)if(t&&t.data&&t.data.userId&&t.data.userId==e.userId){t.data.smsUnreadCount=0;break}e.phone&&I.e.logAction(1231601),this.props.selectConversation(e,t),I.e.logAction(1231905),I.e.logAction(178007)}}_onScroll(){this._dataList&&this._dataList.isAtBottom()&&(this.props.loadMoreMessages(),this.props.loadMoreFiles())}_onBlur(){this._dataList&&this._dataList.setFocusedIndex(-1)}getItemKey(e){return e.constructor===W.c?e.data.key:"file"===e.data.dataListItemType?e.data.msgId:e.data.message?e.data.message.msgId:"sr_"+e.data.userId}_searchPhoneNumber(e){e.startsWith("0")&&(e="84"+e.substring(1)),X.a.getUserByPhone(e).then((e=>{if(e.data&&e.data.error_code>=0){let t=JSON.parse(g.default.decodeAES(e.data.data));if(0==t.error_code){if(t.data){let e=g.default.reformatConversationFromFriend(t.data);je.a.setFriendRequestSource(e.userId,h.FRIEND_REQUEST_SRC_GLOBAL_PHONE),Q.default.setSelectConversationSource(178007),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:e.userId})}}else g.default.logCoreError(t.error_message),216===t.error_code?R.a.createError(T.default.str("STR_TOAST_PHONE_INVALID")):R.a.createError(t.error_message)}else g.default.logCoreError(e.data.error_message),R.a.createError(e.data.error_message)})).catch((e=>{R.a.createError(T.default.str("STR_TOAST_PHONE_INVALID_2")),g.default.logCoreError(e)})),I.e.logAction(1231905)}_selectSearchMessageItem(e,t){e&&(this.props.conversation?this.props.selectResult(e,t,!1,!0):(this.props.selectResult(e,t),I.e.logAction(1231908),I.e.logAction(178007)))}_showUserInfo(e){je.a.setFriendRequestSource(e,h.FRIEND_REQUEST_SRC_CHAT,{uidTo:e}),Q.default.setSelectConversationSource(178007),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:e})}getRefOfDataListComponent(){return this._dataList?this._dataList:null}focusList(){this._searchResultList&&this._searchResultList.focus()}_getdisplayName(e){if(!e)return"";let t="",s=k.default.getMiniInfo(e.userId);return s&&s.dName&&(t=s.dName),0===t.length&&(t=e.displayName),t}closeSearch(){I.e.logAction(12315),this.props.clearConvFilter&&this.props.clearConvFilter()}getConversationFromUserId(e){if(this.props.recentContact&&Array.isArray(this.props.recentContact)){for(let t=0;t<this.props.recentContact.length;t++)if(e==this.props.recentContact[t].userId)return this.props.recentContact[t];return null}return null}renderItem(e,t,s,a){if(t.constructor===W.c){if(t.data.conversation)return o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__conv_filter"},o.a.createElement("div",{className:"flx flx-sp-btw"},o.a.createElement(E.a,{textKey:"STR_FIND_MESSAGE",style:{margin:"10px 5px 10px 0",fontWeight:"500"}}),o.a.createElement("span",{style:{margin:"11px 0 0 0",fontSize:"12px"}},o.a.createElement("i",{className:"fa fa-close clickable",onClick:this.closeSearch.bind(this)}))),o.a.createElement("div",{className:"flx flx-al-c"},o.a.createElement(u.b,{size:"m",target:t.data.conversation,showUnread:!1}),o.a.createElement("div",{className:"truncate",style:{marginLeft:"20px",fontSize:"15px"}},this._getdisplayName(t.data.conversation))));if(null!=t.data.resultNumber){let e=null;if(t.data.progress)return o.a.createElement("div",{key:this.getItemKey(t),className:"flx flx-sp-btw"},o.a.createElement("span",{style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:"0px 17px 0px 9px"}},o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT"})," (...)"),o.a.createElement("span",{style:{margin:"11px 11px 0px 0px"}},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner spinner-search"})));{let s="0px";if(T.default.currentLanguage()==h.LANG_INDEX_VI&&te.a.getLeftPannelWidth()<=336&&(s="10px"),t.data.resultNumber>0)e=o.a.createElement("span",{style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:s+" 17px 0px 9px"}},o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT"}),` (${t.data.resultNumber})`);else if(t.data.keyword){const a=t.data.keyword.length>30?t.data.keyword.slice(0,30)+"...":t.data.keyword;e=o.a.createElement("span",{style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:s+" 17px 0px 9px"}},o.a.createElement(E.a,{textKey:"STR_SEARCH_NO_RESULT_1"}),` "${a}". `,o.a.createElement(E.a,{textKey:"STR_SEARCH_NO_RESULT_2"}))}else e=o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT",style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:s+" 17px 0px 9px"}})}return o.a.createElement("div",{key:this.getItemKey(t),className:"flx flx-sp-btw"},e)}return t.data.isMoreButton?o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__more clickable flx flx-al-c flx-center",onClick:t.data.onExpand},t.data.text," ",o.a.createElement("i",{style:{marginLeft:"5px"},className:"fa fa-caret-down"})):t.data.isMoreButtonMsg?o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__moremsg",onClick:t.data.onExpand},t.data.text):t.data.isSeparator?o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__separator"}):t.data.isSeparatorV2?o.a.createElement("div",{key:this.getItemKey(t),style:{borderBottom:"6px solid var(--grey-600)",paddingTop:"10px"}}):t.data.globalNoResult?o.a.createElement("div",{key:this.getItemKey(t),className:"global-search-no-result"},o.a.createElement("div",null,o.a.createElement("img",{src:Ve.a,style:{width:160}})),o.a.createElement("div",{className:"global-search-no-result__text"},t.data.text)):o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__label",style:{margin:"11px 0"}},t.data.text)}if(t.data.dataListItemType&&"search_phone_number"===t.data.dataListItemType)return o.a.createElement("div",{key:this.getItemKey(t),className:"list-setting__item",style:s?{outline:"1.4px dotted var(--neutral-600)",outlineOffset:"-1px",display:"flex"}:{display:"flex"},onClick:this._searchPhoneNumber.bind(this,t.data.phoneNumber)},o.a.createElement("i",{className:"fa fa-search list-setting__item__search-phone-number list-setting__item__common"}),o.a.createElement("div",{style:{display:"inline-flex",flexWrap:"wrap",alignItems:"center"}},o.a.createElement(E.a,{textKey:"STR_LOOK_UP_PHONE",style:{marginRight:".5em"}}),o.a.createElement("span",{className:"txt-highlight"},t.data.phoneNumber)));if(t.data.conversation)return o.a.createElement(q,{isSelected:s,isHighlight:this.props.highlightId&&t.data.message.msgId==this.props.highlightId,setFocusIndex:a||null,key:this.getItemKey(t),keyword:this.props.searchText,selectResult:this._selectSearchMessageItem.bind(this),dispatch:this.props.dispatch,confirm:this.props.confirm,item:t.data,inConverastion:!!this.props.conversation});if(t.data.dataListItemType&&"file"===t.data.dataListItemType){let e=this.getConversationFromUserId(t.data.userId);const s=t.data;return o.a.createElement(Be,{key:this.getItemKey(t),file:s,conversation:this.props.conversation,showMediaAction:this.props.showMediaAction,showShareAction:this.props.showShareAction,onFilePathUpdated:this._onFilePathUpdated,filterText:this.props.searchText,user:this.props.user,conversationForJumping:e})}{if(!t.data.userId)return;let n=t.data,i=n.userId.startsWith(h.GROUPID_PREFIX);if(i)return o.a.createElement(V,{searchText:this.props.searchText,isSelected:s,getConversationFromId:this.props.getConversationFromId,isHighlighted:this.props.highlightId&&this.props.highlightId==n.userId,setFocusIndex:a||null,item:n,dispatch:this.props.dispatch,confirm:this.props.confirm,user:this.props.user,key:this.getItemKey(t),isGroup:i,fromSearch:e<=2?10:1,indexItem:e,selectConversation:this._selectConversation});{let r=!1;return this.props.highlightId&&this.props.highlightId==n.userId&&(r=!0),o.a.createElement(U,{searchText:this.props.searchText,isSelected:s,isHighlighted:r,setFocusIndex:a||null,item:n,getConversationFromId:this.props.getConversationFromId,showUserInfo:this._showUserInfo,showEditAlias:this.props.showEditAlias,user:this.props.user,confirm:this.props.confirm,dispatch:this.props.dispatch,key:this.getItemKey(t),fromSearch:e<=2?10:1,isGroup:i,indexItem:e,selectConversation:this._selectConversation,conversationActionProps:{presets:"Thread"},compactLv:this.props.compactLv})}}}_addListPhoneSearch(e,t){let s=!1;if(e.phone&&e.phone.length>0){t.push(new W.c({key:"_find_fr_via_phone_num",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_TITLE_NUM_PHONE"})})),s=!0,e.phone.reduce(((e,t)=>(t.height=We,t=Object.assign(t,{showMode:!1}),e.push(new W.b(t)),e)),t)}return s}_addListHiddenChat(e,t){let s=!1;if(e.hiddenChat&&e.hiddenChat.length>0){let a=e.hiddenChat,n=!1;a=a.sort(((e,t)=>t.lastMessageTime-e.lastMessageTime)),a.reduce(((e,t)=>(t&&se.a.isThreadHidden(t.userId)&&(n||(e.push(new W.c({key:"_hidden_chat_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_CHAT_HIDDEN"})})),s=!0,n=!0),t.height=We,t=Object.assign(t,{showMode:!1,byPassPIN:1,inSectionHiddenChat:1}),e.push(new W.b(t))),e)),t),t.push(new W.c({key:"_sep_hidden_chat",height:20,isSeparatorV2:!0}))}return s}_addListChatRecent(e,t){let s=!1;if(e.recentChat&&e.recentChat.length>0){let a=e.recentChat,n=!1;a.reduce(((e,t)=>(t&&t.userId&&!this._cacheGroupLeave[t.userId]&&(n||(e.push(new W.c({key:"_chat_recent_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_CHAT_RECENT"})})),s=!0,n=!0),t.height=We,t=Object.assign(t,{showMode:!1,byPassPIN:0}),e.push(new W.b(t))),e)),t)}return s}_addListOA(e,t){let s=!1;if(e.oa&&e.oa.length>0&&(t.push(new W.c({key:"_oa_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_OA"})})),s=!0,1!==this.state.viewOA)){let s=e.oa,a=e.totalOAFullMatched&&e.totalOAFullMatched>6?e.totalOAFullMatched:6;0===this.state.viewOA&&(s=e.oa.slice(0,a)),s.reduce(((e,t)=>(t.height=We,t=Object.assign(t,{byPassPIN:0}),e.push(new W.b(t)),e)),t),0===this.state.viewOA&&e.oa.length>a&&t.push(new W.c({key:"_fm",height:21,isMoreButton:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})," ",e.friends.length-a," ",o.a.createElement(E.a,{textKey:"STR_RESULT"})),onExpand:()=>{this.setState({viewOA:2})}}))}return s}_addListFriend(e,t){let s=!1;if(e.friends&&e.friends.length>0&&(t.push(new W.c({key:"_contact_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_CONTACT_SEARCH"})})),s=!0,1!==this.state.viewFriend)){let s=e.friends,a=e.totalFriendFullMatched&&e.totalFriendFullMatched>6?e.totalFriendFullMatched:6;0===this.state.viewFriend&&(s=e.friends.slice(0,a)),s.reduce(((e,t)=>(t.height=We,t=Object.assign(t,{byPassPIN:0}),e.push(new W.b(t)),e)),t),0===this.state.viewFriend&&e.friends.length>a&&t.push(new W.c({key:"_fm",height:21,isMoreButton:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})," ",e.friends.length-a," ",o.a.createElement(E.a,{textKey:"STR_RESULT"})),onExpand:()=>{this.setState({viewFriend:2})}}))}return s}_addListGroup(e,t){let s=!1;if(e.groups&&e.groups.length>0&&(t.push(new W.c({key:"_group_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_GROUPS"})})),s=!0,1!==this.state.viewGroup)){let s=e.groups,a=e.totalGroupFullMatched&&e.totalGroupFullMatched>6?e.totalGroupFullMatched:6;0===this.state.viewGroup&&(s=e.groups.slice(0,a)),s.reduce(((e,t)=>(t.height=We,t=Object.assign(t,{byPassPIN:0}),e.push(new W.b(t)),e)),t),0===this.state.viewGroup&&e.groups.length>a&&t.push(new W.c({key:"_gm",height:21,isMoreButton:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})," ",e.groups.length-a," ",o.a.createElement(E.a,{textKey:"STR_RESULT"})),onExpand:()=>{this.setState({viewGroup:2})}}))}return s}_onTabChange(e,t){switch(this.selectedTab=e.key,this.selectedTab){case ze:t?I.e.logAction(1231902):I.e.logAction(1231901);break;case qe:t?I.e.logAction(1231904):I.e.logAction(1231903);break;case Je:t?I.e.logAction(1231907):I.e.logAction(1231906);break;case Qe:t?I.e.logAction(1231910):I.e.logAction(1231909);break;case Xe:I.e.logAction(16505)}Q.default.setCurrentGlobalSearchTab(this.selectedTab)}_renderDataList(e,t){return o.a.createElement("div",{style:{height:"100%"}},o.a.createElement(W.d,{ref:e=>this._dataList=e,dltype:this.props.conversation?W.a.SEARCH_FILTER:W.a.SEARCH,onScroll:this._onScroll,key:e,focusedIndex:-1,items:t,renderItem:this.renderItem,getItemKey:this.getItemKey,"data-id-info":this.props["data-id-info"],scrollToCenter:!0}))}render(){let e=[],t=[];const s=[],n=[];let i,r=!1,l=0;if(this.props.result){let t=this.props.result,i=t.realLen?t.realLen:t.messageList?t.messageList.length:0;if(this.props.conversation&&(e.push(new W.c({key:"_cfilter_"+this.props.conversation.userId,height:93,conversation:this.props.conversation})),e.push(new W.c({key:"_title_result_",height:0==i?100:37,resultNumber:i,keyword:this.props.searchText,progress:t.progress}))),r=this._addListPhoneSearch(t,e)||r,r=this._addListHiddenChat(t,e)||r,r=this._addListChatRecent(t,e)||r,r=this._addListFriend(t,e)||r,r=this._addListGroup(t,e)||r,r=this._addListOA(t,e)||r,t.messages){let e=!0;for(let s in t.messages)if(t.messages.hasOwnProperty(s)){e=!1;break}if(!e){s.push(new W.c({key:"_msg_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_MESSAGE"})}));{let e=0;for(let a=0;a<t.messages.length;++a)(0==a||e<c.c.limit_result_msg_search)&&s.push(new W.b(t.messages[a])),++e,e==c.c.limit_result_msg_search+1?s.push(new W.c({key:"_vm"+t.messages[a].conversation.userId,height:55,isMoreButtonMsg:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEWMORE_MESSAGE"})),onExpand:()=>{this._selectSearchMessageItem(t.messages[a],!0)}})):e<=c.c.limit_result_msg_search&&t.messages.length-1>a&&t.messages[a].conversation.userId!=t.messages[a+1].conversation.userId&&(e=0,s.push(new W.c({key:"_sep"+t.messages[a].conversation.userId,height:20,isSeparator:!0}))),t.messages.length-1>a&&t.messages[a].conversation.userId!=t.messages[a+1].conversation.userId&&(e=0)}r=!0}}if(t.messageList&&t.messageList.reduce(((e,t)=>(e.push(new W.b(t)),e)),s),this.state.files&&this.state.files.length>0){n.push(new W.c({key:"_file_result",height:Ke,text:o.a.createElement(E.a,{textKey:"STR_FILE_UPPER"})}));for(let e of this.state.files)n.push(new W.b(Object(a.a)(Object(a.a)({},e),{},{dataListItemType:"file"})));l=t.realFileLen?t.realFileLen:this.state.files.length}}if(t=[...e,...s],n.length>0&&(Array.prototype.push.apply(t,n),c.c.enableFileGlobalSearch)){let e=170,t=-30,s=118,a=36;this.state.files.length>99&&(e+=6),i=o.a.createElement(ee.c,{position:ee.b.BOTTOM,tipKey:"client.search-results.files",aTop:-7,aFontSize:8,aDelta:138,vDelta:s,hDelta:a,reddotPos:{top:t,left:e},style:{width:250}})}if(!this.props.conversation){let a;c.c.tabbedGlobalSearchResult&&(a=o.a.createElement(E.a,{tagName:"div",textKey:"STR_TAB_NAVIGATE",style:{width:"80%"}}));const i=o.a.createElement("div",{className:"flx flx-col flx-al-c"},o.a.createElement(E.a,{tagName:"div",textKey:"STR_NOT_FOUND"}),a);Q.default.getGlobalSearchMode();!r&&this.props.result.messages&&this.props.result.files&&t.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:Ye,text:i})),e.length||e.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:Ye,text:i})),s.length||s.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:Ye,text:i})),n.length||n.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:Ye,text:i}))}if(0==t.length&&0==e.length&&0===s.length)return o.a.createElement("div",{className:"flx flx-al-c flx-col flx-center  nav-loading"},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner spinner-friend"}));let d,h="chat-info-media__tabcontainer__body__media "+"WEB".toLowerCase()+" tab-s-content";if(this.props.conversation)d=this._renderDataList("messageResultListDl",e.concat(s));else if(c.c.tabbedGlobalSearchResult){const a=[o.a.createElement($.a,{key:ze,title:o.a.createElement(E.a,{textKey:"STR_ALL"}),className:h},o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()},this._renderDataList("allResultListDl",t)))];a.push(o.a.createElement($.a,{key:Je,title:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULTS_TAB_MESSAGES",textArguments:[s.filter((e=>e.constructor===W.b)).length]}),className:h},o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()},this._renderDataList("messageResultListDl",s)))),c.c.enableFileGlobalSearch&&a.push(o.a.createElement($.a,{key:Qe,title:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULTS_TAB_FILE",textArguments:[l]}),className:h,tooltip:i},o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()},this._renderDataList("fileResultListDl",n))));const r=o.a.createElement($.a,{key:qe,title:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULTS_TAB_CONTACTS",textArguments:[e.filter((e=>e.constructor===W.b)).length]}),className:h,overflow:!!c.c.enableFileGlobalSearch},o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()},this._renderDataList("contactResultListDl",e)));c.c.enableFileGlobalSearch?a.push(r):a.splice(1,0,r),d=o.a.createElement($.b,{selectedKey:this.selectedTab,highlight:!0,onChange:this._onTabChange.bind(this),itemClassName:"search-result",rightButton:!0,style:{borderBottom:"1px solid var(--grey-300)",paddingLeft:"6px"},tabBarItemStyle:{width:"initial",padding:"14px 5px",textAlign:"center",margin:"0 3px"},tabNavigation:Z.a.SEARCHING},a)}else d=this._renderDataList("allResultListDl",t);return o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase(),ref:e=>this._searchResultList=e,onBlur:this._onBlur.bind(this),onKeyDown:this._searchResultKeyDown.bind(this),tabIndex:999},d)}}et.propTypes={user:l.a.object.isRequired,result:l.a.object.isRequired};var tt=et,st=s("v/qp"),at=s("p31x"),nt=s("YLjV"),it=s("nNCO"),ot=s("R5gT"),rt=s("Gm1y"),lt=s("Jmku"),ct=s("7TZW");const dt=38,ht=68,ut=295,_t=6048e5,mt="all",pt="contacts",gt="directories",Et="messages",ft="files",It="contact",Tt="message",vt="personal",Rt="group",St="oa",Ot="1";class Nt extends o.a.Component{constructor(e){super(e),this.storage=O.default,this._selectConversation=this._selectConversation.bind(this),this.state={viewFriend:0,viewGroup:0,viewMessage:0,files:e.result&&e.result.files?e.result.files:null,isRefresh:!1,subTab:null,filterExtFile:null,timeFrom:null,timeTo:null,filterSender:-1,friendList:null,messageList:null,loadingMoreMsg:!1},this._eventHandler=this._eventHandler.bind(this),v.default.subscribe(this._eventHandler),this._showUserInfo=this._showUserInfo.bind(this),this._onTabChange=this._onTabChange.bind(this),this._onScroll=this._onScroll.bind(this),this.getItemKey=this.getItemKey.bind(this),this.renderItem=this.renderItem.bind(this),this._onFilePathUpdated=this._onFilePathUpdated.bind(this),this.getConversationFromUserId=this.getConversationFromUserId.bind(this),this._changeContactTab=this._changeContactTab.bind(this),this._renderContact=this._renderContact.bind(this),this._renderFileFilter=this._renderFileFilter.bind(this),this._checkValidFileWithFilter=this._checkValidFileWithFilter.bind(this),this._checkValidMsgWithFilter=this._checkValidMsgWithFilter.bind(this),this._renderDateFilter=this._renderDateFilter.bind(this),this.getFriendList=this.getFriendList.bind(this),this.setTimeLoadingSkeleton=this.setTimeLoadingSkeleton.bind(this),this.forceStopSearch=this.forceStopSearch.bind(this),this._cacheGroupLeave={},this.isLoadingSkeleton=!0,this.isDelayLoad=!0,this.selectedIndex=0,this.lastPosLoadMsg=Date.now(),this.trackActionOnItem=!1,this.hasActionOnFile=!1,this.tabRef=o.a.createRef()}componentWillReceiveProps(e){var t;if(e.searchText&&this.props.searchText&&e.searchText.trim()!=this.props.searchText.trim()&&this.scrollToTop(),this.props.result&&e.result&&this.props.result.files!==e.result.files){var s,a;const t=e.result.files||null;if(this.state.files&&t)for(let e=0;e<this.state.files.length&&(this.state.files[e]&&t[e]&&this.state.files[e].msgId===t[e].msgId);e++)t[e]=this.state.files[e];null===(s=this.state.files)||void 0===s||!s.length||null!==(a=e.result)&&void 0!==a&&a.files?(this.timeoutUpdateFileState&&clearTimeout(this.timeoutUpdateFileState),this.isLoadingSkeletonFile=!1,this.setState({files:t})):this.timeoutUpdateFileState=setTimeout((()=>{this.setState({files:t})}),300)}null===(t=e.result)||void 0===t||!t.messages||this.props.pageLoad&&this.props.pageLoad===e.pageLoad||this._handleLoadMessage(e.result.messages)}shouldComponentUpdate(e,t){return this.props.result!==e.result||this.props.highlightId!==e.highlightId||this.props.conversation!==e.conversation||this.state.viewGroup!==t.viewGroup||this.state.viewFriend!==t.viewFriend||this.state.files!==t.files||this.state.isRefresh!==t.isRefresh||this.props.recentContact!==e.recentContact||this.state.subTab!==t.subTab||this.state.filterExtFile!==t.filterExtFile||this.state.timeFrom!==t.timeFrom||this.state.timeTo!==t.timeTo||this.state.filterSender!==t.filterSender||this.state.friendList!==t.friendList||this.state.loadingMoreMsg!==t.loadingMoreMsg}componentWillMount(){Date.now();ot.a.getOldestTime().then((e=>{null!=e&&e.length&&e[0].ts&&(this.oldestTime=parseFloat(e[0].ts))})).catch((e=>{this.forceStopSearch()})),this.getFriendList(),this.showSkeletonLoading()}componentDidMount(){Q.default.setCurrentGlobalSearchTab(mt)}componentWillUnmount(){Q.default.setCurrentGlobalSearchTab(null),Q.default.resetGlobalSearchMode(),v.default.unsubscribe(this._eventHandler),this.trackActionOnItem?I.e.logAction(1232204):I.e.logAction(1232203),this.hasActionOnFile&&I.e.logAction(1232009)}componentDidUpdate(e,t){if(this.hasTopRes&&0==this.props.pageLoad&&!this.logTopRes&&(this.logTopRes=!0,c.c.enable_global_search_phase_2&&I.e.logAction(1232302)),this.state.timeFrom!==t.timeFrom||this.state.timeTo!==t.timeTo||(this.state.filterSender,t.filterSender),!this.numCharInView){let e=document.getElementById("searchResultList");null!=e&&e.clientWidth&&(this.numCharInView=Math.round((e.clientWidth-52-28-16)/7))}let s=document.getElementById("global_search_list");!s||this.startListenClick||this.trackActionOnItem||(this.startListenClick=!0,s.addEventListener("click",(()=>{this.trackActionOnItem=!0})),s.addEventListener("contextmenu",(()=>{this.trackActionOnItem=!0})))}_eventHandler(e,t){switch(e){case p.ChatBoxActions.DOWNLOAD_PROGRESS:this._onProgressUpdate(t.msgId,t.progress,t.progressInBytes);break;case p.ChatBoxActions.FILEPATH_UPDATED:var s;if(null!==(s=this.state.files)&&void 0!==s&&s.length){const e=this.state.files.slice();for(let s=0;s<e.length;s++){const n=e[s];if(n.msgId===t.msgId){const i=Object(a.a)({},n);i.isDownloading&&(i.isDownloading=!1,i.downloadProgress=0),t.ignoreDownloadPath||(t.error?i.downloadError=!0:(t.cancelled||(i.localPath=t.localPath),i.downloadError=!1)),e[s]=i,this.setState({files:e});break}}}break;case p.ChatBoxActions.UPDATE_MSG_SUBSTATE:if(t.entries[h.SHARE_FROM_MEDIA_STORE]&&t.originalMsgIds&&t.subState===h.MSG_FILE_EXPIRED){let e=Object.assign({},this.state.shareErrorItem);for(let s in t.originalMsgIds)s&&t.originalMsgIds[s]&&(e[s]=!0);this.setState({shareErrorItem:e}),setTimeout((()=>{this.setState({shareErrorItem:{}})}),5e3)}break;case p.FetchActions.GROUP_LEAVE:g.default.valueValid(t)&&t.constructor==String&&!this._cacheGroupLeave[t]&&(this._cacheGroupLeave[t]=1,this.setState({isRefresh:!this.state.isRefresh}));break;case p.GeneralActions.UPDATE_HIDDEN_CHAT:this.setState({isRefresh:!this.state.isRefresh})}}_handleLoadMessage(e){var t;let s=!!((this.selectedTab==Et||this.onlyMessage)&&e&&e.length*ht<(null===(t=this._dataList)||void 0===t?void 0:t.getClientHeight())),a=!!(!e||e.length<=c.c.num_quick_view_global_search.message||this.onlyMessage&&s);this.endSearch=!0,this.waitingLoadMore||!a&&!s||this.endSearch?this.state.loadingMoreMsg&&this.endSearch&&(this.isLoadingSkeleton=!1,this.setState({loadingMoreMsg:!0})):this._loadMoreMsg()}_loadMoreMsg(){if(this.state.timeFrom>0&&this.state.timeTo>0)!this.isLoadingSkeleton&&this.endSearch||(this.endSearch=!0,this.isLoadingSkeleton=!1);else{let e=this._getRangeLoadData(2592e6);this.oldestTime&&e.timeTo<this.oldestTime&&e.timeFrom<this.oldestTime?(this.endSearch=!0,this.waitingLoadMore=!1,this.state.loadingMoreMsg&&this.setState({loadingMoreMsg:!1})):(this.setState({loadingMoreMsg:!0}),this.waitingLoadMore=!0,this.props.loadMoreMessages(e,!0,((e,t)=>{null!=e&&e.length?(this.setState({loadingMoreMsg:!1}),this.waitingLoadMore=!1,this._handleLoadMessage(this.props.result.messages)):this._loadMoreMsg()})))}}resetDataSearch(){this.lastPosLoadMsg=Date.now(),this.endSearch=!1,this.waitingLoadMore=!1,this.showSkeletonLoading(),this.logTopRes=!1}forceStopSearch(){this.endSearch=!0,this.waitingLoadMore=!1,this.isLoadingSkeleton=!1,this.isLoadingSkeletonFile=!1}getFilter(){return this.state.timeFrom>0||this.state.timeTo>0||"string"==typeof this.state.filterSender?{timeFrom:this.state.timeFrom,timeTo:this.state.timeTo,sender:this.state.filterSender}:null}_getRangeLoadData(e=6048e5){let t=this.getFilter();return this.endSearch=!1,this.state.timeFrom>0&&this.state.timeTo>0||(t||(t={}),t.timeTo=this.lastPosLoadMsg,t.timeFrom=t.timeTo-e,this.lastPosLoadMsg=t.timeFrom),t}quickLoadData(){let e=this._getRangeLoadData(_t);return this.oldestTime&&e.timeFrom<this.oldestTime&&(this.endSearch=!0),e}_onProgressUpdate(e,t,s){var n;if(null===(n=this.state.files)||void 0===n||!n.length)return;let i=this.state.files.slice();for(let o=0;o<i.length;o++){const n=i[o];if(n.msgId===e){i[o]=Object(a.a)(Object(a.a)({},n),{},{isDownloading:!0,downloadProgress:t,progressInBytes:s}),this.setState({files:i});break}}}_onFilePathUpdated(e,t){var s;if(null===(s=this.state.files)||void 0===s||!s.length)return;let n=this.state.files.slice();for(let i=0;i<n.length;i++){const s=n[i];if(s.msgId===e.msgId){n[i]=Object(a.a)(Object(a.a)({},s),{},{localPath:t}),this.setState({files:n}),O.default.updateFile(e.msgId,{msgId:e.msgId,localPath:t},["localPath"]),O.default.updateMessage(e.msgId,{msgId:e.msgId,localPath:t},["localPath"]);break}}t||v.default.send(p.ChatBoxActions.FILEPATH_UPDATED,{msgId:e.msgId,localPath:""})}_getLengthResult(){let e=0;if(this.props.state.filtered){let t=this.props.state.filtered;t.closeFriends&&(e+=t.closeFriends.length),t.friends&&(e+=t.friends.length),t.groups&&(e+=t.groups.length)}return e}_searchResultKeyDown(e){switch(e.which){case h.K_ENTER:this.trackActionOnItem=!0,this.selectFocusedConversation(!0);break;case h.K_UP:I.e.logAction(12317),this.moveUp();break;case h.K_DOWN:I.e.logAction(12317),this.moveDown();break;case h.K_ESC:this.props.focusInputSearch&&this.props.focusInputSearch()}}moveDown(){if(!this._dataList)return;this._dataList.moveFocusDown()&&this._focus()}moveUp(){if(this._dataList){if(!this._dataList.moveFocusUp())return void this.props.focusInputSearch();this._focus()}}_focus(){const e=this._searchResultList;e&&e.focus()}getFocusedIndex(){this._dataList&&this._dataList.getFocusedIndex()}scrollToTop(){this._dataList&&this._dataList.scrollToTop()}scrollToBottom(){this._dataList&&this._dataList.scrollToBottom()}selectFocusedConversation(e=!1){if(this._dataList){const t=(t,s,a)=>{if(t&&t.data){let n=this.props.recentContact,i=!1;if(t.data.userId||t.data.conversation&&t.data.conversation.userId){let e=t.data.userId||t.data.conversation.userId;if(!se.a.isThreadHidden(e)){for(let s=0;s<n.length;s++)if(n[s].userId==e){i=!0;break}let t={name:i||e.startsWith(h.GROUPID_PREFIX)?Tt:It,userId:e};N.a.setOldTab(t)}}let o=null;if(t.data.dataListItemType&&"search_phone_number"===t.data.dataListItemType)this._searchPhoneNumber(t.data.phoneNumber);else if("file"===t.data.dataListItemType){const e=this._dataList.getFocusedItemRef();e&&e._onClickFile()}else t.data.message?(I.e.logAction(12311),!s||this._dataList.state&&2==this._dataList.state.focusedIndex?I.e.logAction(12312):I.e.logAction(12313),this.props.selectResult(t.data)):(this._selectConversation(t.data,e,s?this._dataList.getFocusedIndex():a),o=t.data.userId);if(!this.props.conversation)switch(this.selectedTab){case pt:I.e.logAction(1231905);break;case Et:I.e.logAction(1231908);break;case ft:I.e.logAction(1231911)}return o}};let s=this._dataList.getFocusedItem();if(s&&s.constructor===W.b)return I.e.logAction(1232016),t(s,!0);let a=this._dataList.getItems();for(let e=this._dataList.getFocusedIndex();e<a.length;e++){let s=a[e];if(s&&s.constructor===W.b)return t(s,!1,e)}}}_focusInputBox(){v.default.send(p.ChatBoxActions.FOCUS_INPUT)}_selectConversation(e,t=!1,s=-1){if(null!=e&&e.isGroup&&!rt.a.getGroupByIdSync(e.userId))return void R.a.createError(T.default.str("STR_GROUP_NO_EXIST"));let a=!1,n=this.props.recentContact;if(e){if(J.b.startPerf(J.a),e.userId&&(!se.a.isThreadHidden(e.userId)||e.byPassPIN)){for(let s=0;s<n.length;s++)if(n[s].userId==e.userId){a=!0;break}e.byPassPIN&&this.props.dispatch({type:p.ConversationListActions.SELECT_CONVERSATION_HIDDEN,payload:e});let t={name:a||e.userId.startsWith(h.GROUPID_PREFIX)?Tt:It,userId:e.userId};N.a.setOldTab(t)}if(K.a.pushTrackingFrecencyV2(this.props.searchText,e.userId,e.infoSearch?e.infoSearch.constBonus:0),e.phone&&e.phone.length>0&&je.a.setFriendRequestSource(e.userId,h.FRIEND_REQUEST_SRC_GLOBAL_PHONE),!se.a.isThreadHidden(e.userId)){let t=g.default.isOAType(e);He.a.addCacheSearch({userId:e.userId,displayName:e.displayName,avatar:e.avatar,type:t?2:e.isGroup?1:0})}if(s<4&&this.props.selectTopRes&&this.props.selectTopRes(),this.props.selectConversation(e,t),e.phone?I.e.logAction(1231601):I.e.logAction(1231905),I.e.logAction(178007),this.props.searchText){g.default.simpleStripVietnamese(this.props.searchText,!1)!==this.props.searchText&&I.e.logAction(1232011)}}}_onScroll(){this._dataList&&this._dataList.isAtBottom()&&(this.props.loadMoreFiles(),this.selectedTab==Et&&this.endSearch)}_onBlur(){this._dataList&&this._dataList.setFocusedIndex(-1)}getItemKey(e){return e.constructor===W.c?e.data.key:"file"===e.data.dataListItemType?e.data.msgId:e.data.message?e.data.message.msgId:"sr_"+e.data.userId}_searchPhoneNumber(e){e.startsWith("0")&&(e="84"+e.substring(1)),X.a.getUserByPhone(e).then((e=>{if(e.data&&e.data.error_code>=0){let t=JSON.parse(g.default.decodeAES(e.data.data));if(0==t.error_code){if(t.data){let e=g.default.reformatConversationFromFriend(t.data);je.a.setFriendRequestSource(e.userId,h.FRIEND_REQUEST_SRC_GLOBAL_PHONE),Q.default.setSelectConversationSource(178007),this.props.dispatch({type:p.ChatBoxActions.SHOW_FRIEND_PROFILE,payload:e.userId})}}else g.default.logCoreError(t.error_message),216===t.error_code?R.a.createError(T.default.str("STR_TOAST_PHONE_INVALID")):R.a.createError(t.error_message)}else g.default.logCoreError(e.data.error_message),R.a.createError(e.data.error_message)})).catch((e=>{R.a.createError(T.default.str("STR_TOAST_PHONE_INVALID_2")),g.default.logCoreError(e)}))}_selectSearchMessageItem(e,t,s){var a;if(null==e||null===(a=e.conversation)||void 0===a||!a.isGroup||rt.a.getGroupByIdSync(e.conversation.userId)){if(e){if(this.props.conversation?this.props.selectResult(e,t,!1,!0):(this.props.selectResult(e,t),I.e.logAction(1231908),I.e.logAction(178007)),this.props.searchText){g.default.simpleStripVietnamese(this.props.searchText,!1)!==this.props.searchText&&I.e.logAction(1232012),this.trackFullMatch(e.message.message)}((this.selectedTab==mt||!this.selectedTab)&&!this.onlyMessage||s&&s<=3)&&this.props.selectTopRes&&(this.props.selectTopRes(),c.c.enable_global_search_phase_2&&(I.e.logAction(1232301),this.hasTopRes&&I.e.logAction(1232303))),c.c.enable_global_search_phase_2&&-1!=this.state.filterSender&&I.e.logAction(1232127)}}else R.a.createError(T.default.str("STR_GROUP_NO_EXIST"))}_showUserInfo(e){je.a.setFriendRequestSource(e,h.FRIEND_REQUEST_SRC_CHAT,{uidTo:e}),Q.default.setSelectConversationSource(178007),this.props.dispatch({type:p.ChatBoxActions.SHOW_FRIEND_PROFILE,payload:e})}getRefOfDataListComponent(){return this._dataList?this._dataList:null}focusList(){this._searchResultList&&this._searchResultList.focus()}_getdisplayName(e){if(!e)return"";let t="",s=k.default.getMiniInfo(e.userId);return s&&s.dName&&(t=s.dName),0===t.length&&(t=e.displayName),t}closeSearch(){I.e.logAction(12315),this.props.clearConvFilter&&this.props.clearConvFilter()}getConversationFromUserId(e){if(this.props.recentContact&&Array.isArray(this.props.recentContact)){for(let t=0;t<this.props.recentContact.length;t++)if(e==this.props.recentContact[t].userId)return this.props.recentContact[t];return null}return null}renderItem(e,t,s,a){if(t.type&&"LOADING_SKELETON_ITEM"==t.type)return o.a.createElement("div",{key:"loading"+t.key,className:"flx",style:{padding:"10px 12px"}},o.a.createElement("div",{className:"loadingDefault",style:{width:"46px",height:"46px",borderRadius:t.isFile?"0":"50px"}}),o.a.createElement("div",{className:"z-ml chat-info-link__right"},o.a.createElement("div",{className:"loadingDefault loadingMediaText",style:{width:"180px",height:"20px"}}),o.a.createElement("div",{className:"loadingDefault loadingMediaText",style:{width:"100px",height:"20px",marginTop:"6px"}})));if(t.type&&"LOADING_SKELETON_MORE"==t.type)return o.a.createElement("div",{className:"loadingDefault loadingMediaText",style:{height:53,margin:"0 12px"}});if(t.type&&"LOADING_SKELETON_TITLE"==t.type)return o.a.createElement("div",{className:"loadingDefault loadingMediaText",style:{height:"22px",width:"80px",margin:"12px 12px 0"}});if(t.constructor===W.c){if(t.data.conversation)return o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__conv_filter"},o.a.createElement("div",{className:"flx flx-sp-btw"},o.a.createElement(E.a,{textKey:"STR_FIND_MESSAGE",style:{margin:"10px 5px 10px 0",fontWeight:"500"}}),o.a.createElement("span",{style:{margin:"11px 0 0 0",fontSize:"12px"}},o.a.createElement("i",{className:"fa fa-close clickable",onClick:this.closeSearch.bind(this)}))),o.a.createElement("div",{className:"flx flx-al-c"},o.a.createElement(u.b,{size:"m",target:t.data.conversation,showUnread:!1}),o.a.createElement("div",{className:"truncate",style:{marginLeft:"20px",fontSize:"15px"}},this._getdisplayName(t.data.conversation))));if(null!=t.data.resultNumber){let e=null;if(t.data.progress)return o.a.createElement("div",{key:this.getItemKey(t),className:"flx flx-sp-btw"},o.a.createElement("span",{style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:"0px 17px 0px 9px"}},o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT"})," (...)"),o.a.createElement("span",{style:{margin:"11px 11px 0px 0px"}},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner spinner-search"})));{let s="0px";if(T.default.currentLanguage()==h.LANG_INDEX_VI&&te.a.getLeftPannelWidth()<=336&&(s="10px"),t.data.resultNumber>0)e=o.a.createElement("span",{style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:s+" 17px 0px 9px"}},o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT"}),` (${t.data.resultNumber})`);else if(t.data.keyword){const a=t.data.keyword.length>30?t.data.keyword.slice(0,30)+"...":t.data.keyword;e=o.a.createElement("span",{style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:s+" 17px 0px 9px"}},o.a.createElement(E.a,{textKey:"STR_SEARCH_NO_RESULT_1"}),` "${a}". `,o.a.createElement(E.a,{textKey:"STR_SEARCH_NO_RESULT_2"}))}else e=o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT",style:{margin:"10px 5px",fontSize:"13px",fontWeight:"500",padding:s+" 17px 0px 9px"}})}return o.a.createElement("div",{key:this.getItemKey(t),className:"flx flx-sp-btw"},e)}return t.data.isMoreButton?o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__more clickable flx flx-al-c flx-center",onClick:t.data.onExpand},t.data.text," ",o.a.createElement("i",{style:{marginLeft:"5px"},className:"fa fa-caret-down"})):t.data.isMoreButtonMsg?o.a.createElement("div",null,o.a.createElement("div",{style:{padding:"12px 12px 0"}},o.a.createElement(st.a,{className:"wi list__moremsg",type:"tertiary",onClick:t.data.onExpand,format:"squared",size:"medium"},t.data.text)),o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__separator"})):t.data.isSeparator?o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__separator"}):t.data.isSeparatorV2?o.a.createElement("div",{key:this.getItemKey(t),style:{borderBottom:"6px solid var(--grey-600)",paddingTop:"10px"}}):t.data.globalNoResult?o.a.createElement("div",{key:this.getItemKey(t),className:"global-search-no-result"},o.a.createElement("div",null,o.a.createElement("img",{src:Ve.a,style:{width:160}})),o.a.createElement("div",{className:"global-search-no-result__text"},t.data.text)):o.a.createElement("div",{key:this.getItemKey(t),className:"item-search__title"},t.data.text)}if(t.data.dataListItemType&&"search_phone_number"===t.data.dataListItemType)return o.a.createElement("div",{key:this.getItemKey(t),className:"list-setting__item",style:s?{outline:"1.4px dotted var(--neutral-600)",outlineOffset:"-1px",display:"flex"}:{display:"flex"},onClick:this._searchPhoneNumber.bind(this,t.data.phoneNumber)},o.a.createElement("i",{className:"fa fa-search list-setting__item__search-phone-number list-setting__item__common"}),o.a.createElement("div",{style:{display:"inline-flex",flexWrap:"wrap",alignItems:"center"}},o.a.createElement(E.a,{textKey:"STR_LOOK_UP_PHONE",style:{marginRight:".5em"}}),o.a.createElement("span",{className:"txt-highlight"},t.data.phoneNumber)));if(t.data.conversation)return o.a.createElement(q,{isSelected:s,isHighlight:this.props.highlightId&&t.data.message.msgId==this.props.highlightId,setFocusIndex:a||null,key:this.getItemKey(t),keyword:this.props.searchText,index:e,selectResult:this._selectSearchMessageItem.bind(this),dispatch:this.props.dispatch,confirm:this.props.confirm,item:t.data,numCharInView:this.numCharInView,inConverastion:!!this.props.conversation});if(t.data.dataListItemType&&"file"===t.data.dataListItemType){let s=this.getConversationFromUserId(t.data.userId);const a=t.data;return o.a.createElement(Be,{key:this.getItemKey(t),file:a,conversation:this.props.conversation,showMediaAction:this.props.showMediaAction,showShareAction:this.props.showShareAction,onFilePathUpdated:this._onFilePathUpdated,filterText:this.props.searchText,user:this.props.user,isHighlight:this.props.highlightId&&t.data.msgId==this.props.highlightId,conversationForJumping:s,avatarSize:"xs",clsName:"item-search",dispatch:this.props.dispatch,isSearchItem:!0,doAction:this._doActionOnFile.bind(this),index:e})}{let n=t.data,i=!!n.userId&&n.userId.startsWith(h.GROUPID_PREFIX);if(!n.userId)return;if(i)return o.a.createElement(V,{searchText:this.props.searchText,isSelected:s,getConversationFromId:this.props.getConversationFromId,isHighlighted:this.props.highlightId&&this.props.highlightId==n.userId,setFocusIndex:a||null,item:n,dispatch:this.props.dispatch,confirm:this.props.confirm,user:this.props.user,key:this.getItemKey(t),isGroup:i,fromSearch:e<=2?10:1,indexItem:e,selectConversation:this._selectConversation});{let r=!1;return this.props.highlightId&&this.props.highlightId==n.userId&&(r=!0),o.a.createElement(U,{searchText:this.props.searchText,isSelected:s,isHighlighted:r,setFocusIndex:a||null,item:n,getConversationFromId:this.props.getConversationFromId,showUserInfo:this._showUserInfo,showEditAlias:this.props.showEditAlias,user:this.props.user,confirm:this.props.confirm,dispatch:this.props.dispatch,key:this.getItemKey(t),fromSearch:e<=2?10:1,isGroup:i,indexItem:e,selectConversation:this._selectConversation,conversationActionProps:{presets:"Thread"},compactLv:this.props.compactLv})}}}_addListPhoneSearch(e,t){let s=!1;if(e.phone&&e.phone.length>0){t.push(new W.c({key:"_find_fr_via_phone_num",height:dt,text:o.a.createElement(E.a,{textKey:"STR_TITLE_NUM_PHONE"})})),s=!0,e.phone.reduce(((e,t)=>(t.height=ht,t=Object.assign(t,{showMode:!1,dataListItemType:"search_phone"}),e.push(new W.b(t)),e)),t)}return s}_addListHiddenChat(e,t){let s=!1;if(e.hiddenChat&&e.hiddenChat.length>0){let a=e.hiddenChat,n=!1;a=a.sort(((e,t)=>t.lastMessageTime-e.lastMessageTime)),a.reduce(((e,t)=>(t&&se.a.isThreadHidden(t.userId)&&(n||(e.push(new W.c({key:"_hidden_chat_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_CHAT_HIDDEN"})})),s=!0,n=!0),t.height=ht,t=Object.assign(t,{showMode:!1,byPassPIN:1,inSectionHiddenChat:1}),e.push(new W.b(t))),e)),t),t.push(new W.c({key:"_sep_hidden_chat",height:20,isSeparatorV2:!0}))}return s}_addListChatRecent(e,t){var s,a,n,i,r;let l=!1,d=0,h=[],u=!1,_=!1,m=0;if(null!==(s=e.all)&&void 0!==s&&s.length&&null!==(a=e.orderAll)&&void 0!==a&&a.length){h=c.c.enable_global_search_phase_2?e.orderAll:e.all,c.c.enable_new_rule_sort_recent_search&&h.sort(((e,t)=>t.infoSearch.isSuggest&&!e.infoSearch.isSuggest?-1:!t.infoSearch.isSuggest&&e.infoSearch.isSuggest?1:void 0));for(let e of h)if(e&&e.userId&&!this._cacheGroupLeave[e.userId]){if(u||(m=t.length,t.push(new W.c({key:"_chat_recent_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_CHAT_SEARCH"})})),l=!0,u=!0),d==c.c.num_quick_view_global_search.chat){_=!0;break}d<c.c.num_quick_view_global_search.chat&&(e.height=ht,e=Object.assign(e,{showMode:!1,byPassPIN:0}),t.push(new W.b(e))),e.height=ht,e=Object.assign(e,{showMode:!1,byPassPIN:0}),d++}u&&(t[m]=new W.c({key:"_chat_recent_result",height:dt,text:o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_CHAT_SEARCH"})," (",e.all.length,") ")}))}return _?t.push(new W.c({key:"view_full_search_contact",height:53,isMoreButtonMsg:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEW_MORE_CHAT"})),onExpand:()=>{this._onTabChange({key:pt},!1,!0),this.setState({isRefresh:!this.state.isRefresh})}})):null!==(n=e.all)&&void 0!==n&&n.length&&(null!==(i=e.messages)&&void 0!==i&&i.length||null!==(r=this.state.files)&&void 0!==r&&r.length)&&t.push(new W.c({key:"recent_chat_separator",height:20,isSeparator:!0})),l}_addListOA(e,t){let s=!1,a=[];if(e.orderAll&&e.orderAll.length>0&&(a=e.orderAll.filter((e=>g.default.isOAType(e)))),a&&a.length>0&&(t.push(new W.c({key:"_oa_result",height:dt,text:o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_OA"})," (",a.length,") ")})),s=!0,1!==this.state.viewOA)){a.reduce(((e,t)=>(t.height=ht,t=Object.assign(t,{byPassPIN:0}),e.push(new W.b(t)),e)),t)}return s}_addListFriend(e,t){let s=!1,a=[];if(e.orderAll&&e.orderAll.length>0&&(a=e.orderAll.filter((e=>!e.isGroup&&!g.default.isOAType(e)))),a&&a.length>0){var n,i;if(t.push(new W.c({key:"_contact_result",height:dt,text:o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_PERSONAL"})," (",a.length,") ")})),s=!0,1!==this.state.viewFriend){a.reduce(((e,t)=>(t.height=ht,t=Object.assign(t,{byPassPIN:t.userId==this.props.currentId?1:0}),e.push(new W.b(t)),e)),t)}(null!==(n=e.groups)&&void 0!==n&&n.length||null!==(i=e.oa)&&void 0!==i&&i.length)&&t.push(new W.c({key:"separator_fr_list",height:20,isSeparator:!0}))}return s}_addListGroup(e,t){let s=!1,a=[];if(e.orderAll&&e.orderAll.length>0&&(a=e.orderAll.filter((e=>e.isGroup))),a&&a.length>0){var n;if(t.push(new W.c({key:"_group_result",height:dt,text:o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_GROUPS"})," (",a.length,") ")})),s=!0,1!==this.state.viewGroup){a.reduce(((e,t)=>(t.height=ht,t=Object.assign(t,{byPassPIN:t.userId==this.props.currentId?1:0}),e.push(new W.b(t)),e)),t)}null!==(n=e.oa)&&void 0!==n&&n.length&&t.push(new W.c({key:"separator_gr_list",height:20,isSeparator:!0}))}return s}_onTabChange(e,t,s=!1){var a;switch(null!==(a=this.tabRef)&&void 0!==a&&a.current&&e.key&&this.tabRef.current.focusByValue(e.key),this.selectedTab!==e.key&&this.scrollToTop(),this.selectedTab=e.key,this.setState({subTab:null,filterSender:-1,timeTo:null,timeFrom:null,filterExtFile:null}),this.selectedTab){case mt:this.selectedIndex=0,t?I.e.logAction(1231902):I.e.logAction(1231901);break;case pt:this.selectedIndex=1,s?I.e.logAction(1231920):t?I.e.logAction(1231904):I.e.logAction(1231903);break;case Et:this.selectedIndex=2,this.changeToMsgTab=!0,s?I.e.logAction(1231921):t?I.e.logAction(1231907):I.e.logAction(1231906);break;case ft:this.selectedIndex=3,s?I.e.logAction(1231922):t?I.e.logAction(1231910):I.e.logAction(1231909);break;case gt:I.e.logAction(16505)}Q.default.setCurrentGlobalSearchTab(this.selectedTab)}_renderDataList(e,t){return o.a.createElement("div",{style:{height:"100%"}},o.a.createElement(W.d,{ref:e=>this._dataList=e,dltype:this.props.conversation?W.a.SEARCH_FILTER:W.a.SEARCH,onScroll:this._onScroll,key:e,focusedIndex:-1,items:t,renderItem:this.renderItem,getItemKey:this.getItemKey,domId:"global_search_list",scrollToCenter:!0}))}_renderContactTag(e,t,s){return o.a.createElement("div",{style:{display:"flex",padding:"12px 14px"}},o.a.createElement(at.a,{type:"choice",textKey:"STR_PERSONAL",disabled:!e.length,className:e.length?"":"filter-contact-disable",isActive:this.state.subTab===vt||this.onlyTabFriend,onClick:()=>this._changeContactTab(vt)}),o.a.createElement("div",{style:{width:"8px"}}),o.a.createElement(at.a,{type:"choice",textKey:"STR_GROUP",disabled:!t.length,className:t.length?"":"filter-contact-disable",isActive:this.state.subTab===Rt||this.onlyTabGroup,onClick:()=>this._changeContactTab(Rt)}),o.a.createElement("div",{style:{width:"8px"}}),o.a.createElement(at.a,{type:"choice",textKey:"STR_OA",disabled:!s.length,className:s.length?"":"filter-contact-disable",isActive:this.state.subTab===St||this.onlyTabOA,onClick:()=>this._changeContactTab(St)}))}_renderContact(e,t,s,a){let n=e;switch(this.state.subTab){case vt:n=t;break;case Rt:n=s;break;case St:n=a}return this._renderDataList("contactResultListDl",n)}_changeContactTab(e){if(!(this.onlyTabFriend||this.onlyTabGroup||this.onlyTabOA))switch(e===this.state.subTab?this.setState({subTab:null}):(this.setState({subTab:e}),I.e.logAction(1232101)),e){case vt:I.e.logAction(1232102);break;case Rt:I.e.logAction(1232103);break;case St:I.e.logAction(1232104)}}_addListContact(e,t,s,a){if(t.length)for(let n of t)e.push(n);if(s.length)for(let n of s)e.push(n);if(a.length)for(let n of a)e.push(n);return!!e.length}_showDateFilter(e){lt.a.openPopover({windowId:Ot,name:h.PopoverIdentitiesDefine.DATE_FILTER_GLOBAL_SEARCH,anchorEvent:e}),this.selectedTab==Et?I.e.logAction(1232110):this.selectedTab==ft&&I.e.logAction(1232120)}onFilterDate(e,t,s){switch(e.getTime&&(e=e.getTime()),t.getTime&&(t=t.getTime()),this.setState({timeFrom:e,timeTo:t},(()=>{})),s){case 1:this.selectedTab==Et?I.e.logAction(1232111):I.e.logAction(1232121);break;case 2:this.selectedTab==Et?I.e.logAction(1232112):I.e.logAction(1232122);break;case 3:this.selectedTab==Et?I.e.logAction(1232113):I.e.logAction(1232123);break;case 4:this.selectedTab==Et?I.e.logAction(1232114):I.e.logAction(1232124)}}_renderDateFilter(e){let{timeFrom:t,timeTo:s}=this.state;return o.a.createElement("div",{style:{flex:"1",maxWidth:"50%"}},t||s?o.a.createElement(at.a,{className:"search-tool-dt-container title-global-search-filter",isActive:!0,onClick:e=>this._showDateFilter(e),domRef:e=>this.datePickerPreviewContainer=e,type:"filter-select",icon:{post:{svg:"close_24",onClick:t=>{t.stopPropagation(),t.preventDefault(),this.onFilterDate(0,0),this.datePickerRef&&this.datePickerRef.reset(),"msg"==e?I.e.logAction(1232115):"file"==e&&I.e.logAction(1232125)}}}},o.a.createElement("div",{className:"flx flx-al-c truncate",title:g.default.shortenTitleDateFilter(this.state.timeFrom,this.state.timeTo)},g.default.shortenTitleDateFilter(this.state.timeFrom,this.state.timeTo))):o.a.createElement(at.a,{className:"search-tool-dt-container title-global-search-filter truncate",isActive:!1,onClick:e=>this._showDateFilter(e),domRef:e=>this.datePickerPreviewContainer=e,type:"filter-select",icon:{post:"solid-down"}},o.a.createElement(E.a,{textKey:"STR_FILTER_SEND_DATE"})),o.a.createElement(it.b,{ref:e=>this.datePickerRef=e,onChange:this.onFilterDate.bind(this),popoverProps:{identity:{windowId:Ot,name:h.PopoverIdentitiesDefine.DATE_FILTER_GLOBAL_SEARCH},placement:"bottom-right"}}))}_changeFilterExtFile(e){-1==e&&null===this.state.filterExtFile||(this.setState({filterExtFile:e}),-1!==e?I.e.logAction(1232117):I.e.logAction(1232119))}_renderFileFilter(){return o.a.createElement("div",null,o.a.createElement("div",{style:{display:"flex",padding:"12px",justifyContent:"space-evenly"}},o.a.createElement("div",{style:{flex:"1",maxWidth:"50%"}},o.a.createElement(nt.a,{popoverProps:{identity:{windowId:Ot,name:h.PopoverIdentitiesDefine.FILE_TYPE_DROPDOWN_GLOBAL_SEARCH}},onChange:this._changeFilterExtFile.bind(this),value:this.state.filterExtFile?this.state.filterExtFile:-1,options:[{value:"pdf",text:"PDF",icon:"search-media-icon-pdf"},{value:"doc",text:"Word",icon:"search-media-icon-word"},{value:"pp",text:"PowerPoint",icon:"search-media-icon-powerpoint"},{value:"excel",text:"Excel",icon:"search-media-icon-excel"}],defaultValue:{textKey:"STR_FILE_TYPE",value:-1},className:"title-global-search-filter truncate",disableSearch:!0,callbackShowMenu:()=>{I.e.logAction("1232116")},expandPreview:!0})),this._renderDateFilter("file")))}_checkValidFileWithFilter(e){var t;if(!(this.state.filterExtFile&&-1!=this.state.filterExtFile||this.state.timeFrom||this.state.timeTo))return!0;if(this.state.filterExtFile&&-1!==this.state.filterExtFile&&null!=e&&null!==(t=e.message)&&void 0!==t&&t.title&&this.state.filterExtFile){if(!h.fileExt[this.state.filterExtFile].some((t=>e.message.title.endsWith(t))))return!1}return!(this.state.timeFrom&&e.sendDttm<this.state.timeFrom)&&!(this.state.timeTo&&e.sendDttm>this.state.timeTo)}_changeFilterFriend(e){this.setState({filterSender:e},(()=>{})),-1!=e?I.e.logAction(1232129):I.e.logAction(1232130)}_checkValidMsgWithFilter(e){var t,s,a,n;if(!(this.state.filterSender&&-1!=this.state.filterSender||this.state.timeFrom||this.state.timeTo))return!0;if(c.c.enable_global_search_phase_2){if(this.state.filterSender&&-1!==this.state.filterSender&&(null==e||null===(a=e.conversation)||void 0===a?void 0:a.userId)!==this.state.filterSender)return!1}else if(this.state.filterSender&&-1!==this.state.filterSender&&(null==e||null===(n=e.message)||void 0===n?void 0:n.fromUid)!==this.state.filterSender)return!1;return!(this.state.timeFrom&&(null==e||null===(t=e.message)||void 0===t?void 0:t.sendDttm)<this.state.timeFrom)&&!(this.state.timeTo&&(null==e||null===(s=e.message)||void 0===s?void 0:s.sendDttm)>this.state.timeTo)}getFriendList(){c.c.enable_global_search_phase_2&&this.props.recentContact?this.setState({friendList:this.props.recentContact}):O.default.getFriends(null,!0).then((e=>{e&&Array.isArray(e)?this.setState({friendList:e}):g.default.logCoreError("[Global search]: get friend error",e)}))}_renderMsgFilter(){if(!this.props.contacts||!this.state.friendList)return;let e=[];return this.state.friendList.map(((t,s)=>{if(t&&t.userId){let s=t,a=s.displayName;if(!s.isGroup){let e=k.default.getMiniInfo(t.userId);null!=e&&e.dName&&(a=e.dName)}s&&s.userId!==this.props.user.userId&&e.push({value:t.userId!==this.props.user.userId?t.userId:"0",text:a,keySearch:a,avatar:s.bgavatar,icon:{html:o.a.createElement(u.b,{target:s,size:"xs",outline:!1,showUnread:!1})}})}})),!c.c.enable_global_search_phase_2&&this.props.user&&e.push({value:"0",text:this.props.user.displayName,keySearch:this.props.user.displayName,avatar:this.props.user.avatar,icon:{html:o.a.createElement(u.b,{target:this.props.user,size:"xs",outline:!1,showUnread:!1})}}),o.a.createElement("div",{style:{display:"flex",padding:"12px",justifyContent:"space-evenly"}},o.a.createElement("div",{style:{flex:"1",maxWidth:"50%"}},o.a.createElement(nt.a,{popoverProps:{identity:{windowId:Ot,name:h.PopoverIdentitiesDefine.SENDER_DROPDOWN_GLOBAL_SEARCH},style:{width:"250px"}},onChange:this._changeFilterFriend.bind(this),value:this.state.filterSender?this.state.filterSender:-1,options:e,defaultValue:{textKey:c.c.enable_global_search_phase_2?"STR_FILTER_CONV":"STR_SENDER",value:-1},className:"title-global-search-filter truncate",hideDefaultPreview:!0,placeholder:c.c.enable_global_search_phase_2?"STR_FILTER_CONV_PLACEHOLDER":"STR_SEARCH_SENDER",callbackShowMenu:()=>{I.e.logAction("1232126")},expandPreview:!0})),this._renderDateFilter("msg"))}_addLoadingSkeleton(e,t=!1){let s=t?c.c.num_quick_view_global_search.file:c.c.num_quick_view_global_search.message;e.push({type:"LOADING_SKELETON_TITLE",data:{height:dt},key:"load_more_skeleton"});for(let a=0;a<s;a++)e.push({type:"LOADING_SKELETON_ITEM",data:{height:ht},key:a,isFile:t});e.push({type:"LOADING_SKELETON_MORE",data:{height:53},key:"load_more_skeleton"})}setTimeLoadingSkeleton(){this.setTimeoutLoading||(this.isLoadingSkeleton=!0,this.isLoadingSkeletonFile=!0,this.setTimeoutLoading=setTimeout((()=>{this.setTimeoutLoading=null,this.isLoadingSkeleton=!1,this.isLoadingSkeletonFile=!1,this.setState({isRefresh:!this.state.isRefresh})}),5e3))}openTabAll(){this.showSkeletonLoading(),this._onTabChange({key:mt})}showSkeletonLoading(){setTimeout((()=>{this.isDelayLoad=!1,this.setTimeLoadingSkeleton(),this.setState({isRefresh:!this.state.isRefresh})}),0)}trackFullMatch(e){if(!e)return;let t=e;if(e.title)t=e.title;else if("string"!=typeof t)return;t=g.default.simpleStripVietnamese(t);let s=g.default.simpleStripVietnamese(this.props.searchText).split(" ");t=t.split(" ");let a=0,n=0;for(let i of s)for(let e of t){if(e==i){a++;break}if(0==e.indexOf(i)){n++;break}}a==s.length?I.e.logAction(1232013):n>=2?I.e.logAction(1232014):I.e.logAction(1232015)}_doActionOnFile(e=null,t=!1,s){null!=e&&e.msgId&&t&&this.props.onFileSelect&&this.props.onFileSelect(e),this.hasActionOnFile=!0,(this.selectedTab==mt||!this.selectedTab||s&&s<=3)&&this.props.selectTopRes&&this.props.selectTopRes()}levenshtein(e,t){if(!e||!t)return 0;if(e=g.default.simpleStripVietnamese(e,!0),t=g.default.simpleStripVietnamese(t,!0),e=g.default.lowerCaseAndSpace(e).split(" "),t=g.default.lowerCaseAndSpace(t).split(" "),e=e.filter((e=>!!e)),t=t.filter((e=>!!e)),0==e.length||0==t.length)return 0;let s=[],a=0;for(a=0;a<=t.length;a++)s[a]=[a];let n=0;for(let i=0;i<=e.length;i++)s[0][i]=i;for(a=1;a<=t.length;a++)for(n=1;n<=e.length;n++)t[a-1]==e[n-1]?s[a][n]=s[a-1][n-1]:s[a][n]=Math.min(s[a-1][n-1]+1,Math.min(s[a][n-1]+1,s[a-1][n]+1));return s[t.length][e.length]}matchKeyword(e,t,s=!1){return!(!s||0!=e.indexOf(t))||t==e}buildRegexMatch(e){return new RegExp("[!@%^\\-*(){}+`=<>?\\\\/,.:;'\"&#\\[\\]~$_|\\n ]"+e,"g")}_rankingRes(e,t){if(!e||!t)return 0;let s=g.default.lowerCaseAndSpace(e).split(" "),a=0,n=-1,i=-1,o=t.toLowerCase(),r=g.default.lowerCaseAndSpace(t).split(" "),l=0;s=s.filter((e=>!!e)),r=r.filter((e=>!!e));for(let d of s){if(l++,!d)continue;let e=0,t=l==s.length;const c=g.default.simpleStripVietnamese(d);for(let s of r){if(!s)continue;const a=g.default.simpleStripVietnamese(s);let r=!1;if(d!=c&&(r=!0),!r&&this.matchKeyword(s,d,t)||r&&this.matchKeyword(s,d,t)){let t=this.buildRegexMatch(d).exec(" "+o).index,s=t+d.length;(n<0||t<n)&&(n=t),(i<0||s>i)&&(i=s),e=1;break}if(this.matchKeyword(s,c,t)||this.matchKeyword(a,d,t)){let r=this.buildRegexMatch(this.matchKeyword(a,d,t)?s:c).exec(" "+o).index,l=r+d.length;(n<0||r<n)&&(n=r),(i<0||l>i)&&(i=l),e=.5}}a+=e}let c=this.levenshtein(e,t.slice(n,i));return a+=1/Math.log(c+Math.E),{ranking:a,lev:c,msg:t.slice(n,i)}}_rankingDataList(e){let t=[...e.slice(0,100)];return t.forEach((e=>{var t,s;let a=null;if(null!==(t=e.message)&&void 0!==t&&t.message&&"string"==typeof e.message.message?a=e.message.message:null!==(s=e.message)&&void 0!==s&&s.message&&"object"==typeof e.message.message&&e.message.message.title&&(a=e.message.message.title),a){let t=this._rankingRes(this.props.searchText,a);e.logInfo=t,e.ranking=t.ranking}else e.ranking=0})),t.sort(((e,t)=>t.ranking==e.ranking?t.message.sendDttm>e.message.sendDttm:t.ranking-e.ranking)),t}onChangeTabs(e,t){this._onTabChange({index:e,key:t})}render(){var e;let t=[],s=[],n=[],i=[],r=[],l=[],d=[];const h=[];let u=0,_=0,m=0,p=!1;if(this.hasTopRes=!1,this.isDelayLoad)return o.a.createElement("div",null);if(this.props.result){let e=this.props.result,_=e.messages;if(p=this._addListPhoneSearch(e,t)||p,p=this._addListHiddenChat(e,t)||p,p=this._addListChatRecent(e,t)||p,p=this._addListFriend(e,n)||p,p=this._addListGroup(e,i)||p,p=this._addListOA(e,r)||p,p=this._addListContact(s,n,i,r)||p,!n.length||i.length||r.length?n.length||!i.length||r.length?n.length||i.length||!r.length?(this.onlyTabFriend=!1,this.onlyTabGroup=!1,this.onlyTabOA=!1):this.onlyTabOA=!0:this.onlyTabGroup=!0:this.onlyTabFriend=!0,null!=_&&_.length){let s=!0,a=0;for(let e in _)if(_.hasOwnProperty(e)){s=!1;break}if(!s){let s=_.length,n=[];if(this.endSearch,c.c.enable_search_top_result&&_.length>=6){let e=this._rankingDataList(_);if(e){d.push(new W.c({key:"_msg_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT_RANKING"})}));for(let t of e)n.length<c.c.num_quick_view_global_search.topRes&&n.push(t.message.msgId),this._checkValidMsgWithFilter(t)&&d.push(new W.b(t));this.hasTopRes=!0}}c.c.enable_global_search_phase_2?h.push(new W.c({key:"_msg_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULTS_TAB_MESSAGES",textArguments:[s]})})):h.push(new W.c({key:"_msg_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_TAB_MESSAGE_NUM",textArguments:[s]})}));for(let e of _){if(n.length){if(n.find((t=>t==e.message.msgId)))continue}this._checkValidMsgWithFilter(e)&&(h.push(new W.b(e)),a++)}if(h.length>0){var g,f,I;if(0==(null===(g=e.all)||void 0===g?void 0:g.length)&&0==(null===(f=this.state.files)||void 0===f?void 0:f.length)){var T;this.onlyMessage=!0;let a=d.length?d:h;t=[...t,...a],!c.c.enable_global_search_phase_2||null!==(T=e.hiddenChat)&&void 0!==T&&T.length||(t[0]=new W.c({key:"_msg_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_TAB_MESSAGE_NUM",textArguments:[s]})}))}else{this.onlyMessage=!1;let e=d.length?d.slice(0,c.c.num_quick_view_global_search.topRes+1):h.slice(0,c.c.num_quick_view_global_search.message+1);d.length&&(e[0]=new W.c({key:"_msg_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_TAB_MESSAGE_NUM",textArguments:[s]})})),t=[...t,...e]}a>c.c.num_quick_view_global_search.message?t.push(new W.c({key:"_vm_msg",height:53,isMoreButtonMsg:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEW_MORE_MSG"})),onExpand:()=>{this._onTabChange({key:Et},!1,!0),this.setState({isRefresh:!this.state.isRefresh}),this.onlyMessage&&setTimeout((()=>{this.scrollToBottom()}),0)}})):h.length&&null!==(I=this.state.files)&&void 0!==I&&I.length&&t.push(new W.c({key:"_vm_msg",height:20,isSeparator:!0})),this.state.loadingMoreMsg&&h.push({type:"LOADING_SKELETON_ITEM",data:{height:ht},key:"load_more_msg"})}p=!0,this.isLoadingSkeleton=!1}}else!this.isLoadingSkeleton&&this.endSearch||(this._addLoadingSkeleton(t),this._addLoadingSkeleton(h));if(e.messageList&&e.messageList.reduce(((e,t)=>(e.push(new W.b(t)),e)),h),this.state.files&&this.state.files.length>0){l.push(new W.c({key:"_file_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULTS_TAB_FILE"})}));for(let e of this.state.files)this._checkValidFileWithFilter(e)&&l.push(new W.b(Object(a.a)(Object(a.a)({},e),{},{dataListItemType:"file"})));u=l.filter((e=>e.constructor===W.b)).length,u?(l[0]=new W.c({key:"_file_result",height:dt,text:o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULTS_TAB_FILE",textArguments:[u]})}),p=!0):l=[]}}if((null===(e=this.state.files)||void 0===e?void 0:e.length)>=0&&(this.isLoadingSkeletonFile=!1),l.length>0){let e=l.slice(0,c.c.num_quick_view_global_search.file+1);t=[...t,...e],u>c.c.num_quick_view_global_search.file&&t.push(new W.c({key:"_vm_file",height:53,isMoreButtonMsg:!0,text:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_VIEW_MORE_FILE"})),onExpand:()=>{this._onTabChange({key:ft},!1,!0),this.setState({isRefresh:!this.state.isRefresh})}}))}else!this.state.files&&this.isLoadingSkeletonFile&&(this._addLoadingSkeleton(t,!0),this._addLoadingSkeleton(l,!0));if(!this.props.conversation){const e=o.a.createElement("div",{className:"flx flx-col flx-al-c"},o.a.createElement(E.a,{tagName:"div",textKey:"STR_NOT_FOUND"}),o.a.createElement(E.a,{tagName:"div",textKey:"STR_SEARCH_NO_RESULT_2",style:{width:"80%"}}));Q.default.getGlobalSearchMode();h.length||h.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:ut,text:e})),l.length||l.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:ut,text:e})),s.length||s.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:ut,text:e})),t.length||t.push(new W.c({globalNoResult:!0,key:"_msg_no_result",height:ut,text:e}))}if(0==t.length&&0===h.length)return o.a.createElement("div",{className:"flx flx-al-c flx-col flx-center  nav-loading"},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner spinner-friend"}));let v;if(_=r.filter((e=>e.constructor===W.b)).length+n.filter((e=>e.constructor===W.b)).length+i.filter((e=>e.constructor===W.b)).length,m=_+h.filter((e=>e.constructor===W.b)).length+u,this.props.conversation)v=this._renderDataList("messageResultListDl",h);else if(c.c.tabbedGlobalSearchResult){let e=[{textKey:"STR_ALL",value:mt,content:o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()},this._renderDataList("allResultListDl",t))},{textKey:"STR_CHAT_SEARCH",value:pt,content:o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()+" title-bar"},this._renderContactTag(n,i,r),this._renderContact(s,n,i,r))},{textKey:"STR_TAB_MESSAGE",value:Et,content:o.a.createElement(o.a.Fragment,null,this._renderMsgFilter(),o.a.createElement("div",{className:"data-list__separator",style:{margin:"0"}}),o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()+" title-bar"},this._renderDataList("messageResultListDl",[...d.slice(0,c.c.num_quick_view_global_search.topRes+1),...h])))}];c.c.enableFileGlobalSearch&&e.push({textKey:"STR_FILES_CONFIGURATION",value:ft,content:o.a.createElement(o.a.Fragment,null,this._renderFileFilter(),o.a.createElement("div",{className:"data-list__separator",style:{margin:"0"}}),o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase()+" title-bar"},this._renderDataList("fileResultListDl",l)))}),v=o.a.createElement(ct.a,{ref:this.tabRef,tabs:e,size:"small",padding:16,onChange:this.onChangeTabs.bind(this)})}else v=this._renderDataList("allResultListDl",t);return o.a.createElement("div",{id:"searchResultList",className:"WEB".toLowerCase(),ref:e=>this._searchResultList=e,onBlur:this._onBlur.bind(this),onKeyDown:this._searchResultKeyDown.bind(this),tabIndex:999},v)}}Nt.propTypes={user:l.a.object.isRequired,result:l.a.object.isRequired};var bt=Nt,Ct=s("1PLK"),At=s("Anfm"),yt=s("Zai0");const Dt="1";class Mt extends o.a.Component{constructor(e){super(e)}shouldComponentUpdate(e,t){return this.props.data!=e.data}getOffsetHeight(){return 72}getOffsetTop(){return 0}onClickBanner(){if(this.props.actionLogCode&&I.e.logAction(this.props.actionLogCode),this.props.data)switch(this.props.data.actionType){case h.BANNER_ACTION_OPEN_URL:if(this.props.data.actionContent&&this.props.data.actionContent.url){let e="",t=this.props.data.actionContent.url;this.props.data.actionContent.submit_vkey&&c.c.viewerKey&&(e="z_u="+c.c.viewerKey),e&&(t.indexOf("?")>=0?t+="&"+e:t+="?"+e),Ct.b.open(t)}break;case h.BANNER_ACTION_SEND_MSG:if(this.props.data.actionContent)switch(this.props.data.actionContent.type){case h.MSG_STICKER:if(Q.default.setStickerSrc(h.SGG_SRC_BROADCAST),this.props.data.actionContent.stickers){Math.floor(Math.random()*this.props.data.actionContent.stickers.length);H.a.openModal({windowId:Dt,name:h.ModalIdentitiesDefine.SHARE_MSG_COMPOSE,params:{callback:this.props.broadCastMessage,messages:{msgType:h.MSG_STICKER,isMsgBroadcast:!0,sendSrc:At.b.Sticker.PROMO_BANNER,text:this.props.data.actionContent.message,message:this.props.data.actionContent.stickers,bannerUrl:this.props.data.actionContent.headerImg,filterGender:this.props.data.actionContent.filterGender,placeholder:this.props.data.actionContent.placeholder,stickerTitle:this.props.data.actionContent.stickerTitle,searchBoxTitle:this.props.data.actionContent.searchBoxTitle}}})}break;case h.MSG_TEXT:this.props.data.actionContent.message&&H.a.openModal({windowId:Dt,name:h.ModalIdentitiesDefine.SHARE_MSG_COMPOSE,params:{callback:this.props.broadCastMessage,messages:{msgType:h.MSG_TEXT,isMsgBroadcast:!0,message:this.props.data.actionContent.message}}});break;case h.MSG_GIF:this.props.data.actionContent.url&&this.props.sendDirectMsgToSendToMe&&this.props.sendDirectMsgToSendToMe(h.MSG_GIF,{url:this.props.data.actionContent.url,width:this.props.data.actionContent.width,height:this.props.data.actionContent.height})}break;case h.BANNER_ACTION_CREATE_EMPTY_GROUP:var e;H.a.openModal({windowId:Dt,name:h.ModalIdentitiesDefine.CREATE_GROUP_COMPOSE,params:null===(e=this.props.data)||void 0===e?void 0:e.actionContent});break;case h.BANNER_ACTION_SEND_ECARD_EVENT:c.c.new_ui_ecard&&(yt.a.isValidData()?H.a.openModal({windowId:Dt,name:h.ModalIdentitiesDefine.EVENT_ECARD,params:!0}):R.a.createMessage(T.default.str("STR_DATA_SERVER_ECARD_INVALID"),3e3))}}removeBanner(e){this.props.removeBanner&&(this.props.removeBanner(),e.stopPropagation(),e.preventDefault(),I.e.logAction(1410501))}render(){var e,t;if(!this.props.data)return null;let s=null,a=!1,n=null;if(null!==(e=this.props.data.actionContent)&&void 0!==e&&e.showDeleteBtn&&(a=this.props.data.actionContent.showDeleteBtn),null!==(t=this.props.data.actionContent)&&void 0!==t&&t.colorDeleteBtn&&(n=this.props.data.actionContent.colorDeleteBtn),this.props.data.title||this.props.data.buttonText){let e=null,t=null,i=null;this.props.data.actionContent&&(this.props.data.actionContent.containerStyle&&(e=this.props.data.actionContent.containerStyle),this.props.data.actionContent.titleStyle&&(t=this.props.data.actionContent.titleStyle),this.props.data.actionContent.descStyle&&(i=this.props.data.actionContent.descStyle)),s=o.a.createElement("div",{className:"conversation-list__banner__detail-mode",style:e,onClick:this.onClickBanner.bind(this)},o.a.createElement("div",{className:"conversation-list__banner__image",style:{backgroundImage:'url("'+this.props.data.photoUrl+'")'}}),o.a.createElement("div",{className:"conversation-list__banner__titleContainer"},o.a.createElement("span",{className:"conversation-list__banner__title",style:t},this.props.data.title),o.a.createElement("span",{className:"conversation-list__banner__desc truncate",style:i},this.props.data.message)),this.props.data.buttonText?o.a.createElement("a",{className:"conversation-list__banner__button",style:{textAlign:"center",position:"absolute",right:"10px"}},this.props.data.buttonText):null,o.a.createElement(f.a,{tagName:"span",textKey:"STR_DELETE",className:"conversation-list__banner__close",onClick:this.removeBanner.bind(this),style:{position:"absolute",right:"0px",paddingBottom:"50px",display:a?"block":"",color:n||""}},o.a.createElement("i",{className:"fa fa-close"})))}else this.props.data.photoUrl&&(s=o.a.createElement("div",{className:"conversation-list__banner__full-mode",onClick:this.onClickBanner.bind(this),style:{backgroundImage:'url("'+this.props.data.photoUrl+'")'}},o.a.createElement(f.a,{tagName:"span",textKey:"STR_DELETE",className:"conversation-list__banner__close",onClick:this.removeBanner.bind(this),style:{position:"absolute",right:"0px",paddingBottom:"50px",display:a?"block":"",color:n||""}},o.a.createElement("i",{className:"fa fa-close"}))));return s}}var Pt=Mt,wt=s("Enw1"),Lt=s("qYNW"),kt=s("UrzB"),xt=s("kCOK");class Ut extends kt.b{constructor(){super(),this._friendsOnline={},this._lastFetch=null}fetchFriendsOnline(){return new Promise(((e,t)=>{this._request().then((s=>s&&s.onlines?e(s.onlines.reduce(((e,t)=>(t.userId&&(e[t.userId]=t),e)),{})):t()))}))}remove(e){this._friendsOnline[e]&&delete this._friendsOnline[e]}getFriendsOnline(){if(this._lastFetch){return Date.now()-this._lastFetch>c.c.list_friend_online_time?this.fetchFriendsOnline():Promise.resolve(this._friendsOnline)}return this.fetchFriendsOnline()}_callApi(){return new Promise(((e,t)=>{X.a.requestGetFriendOnlines().then(xt.a).then((t=>{e(t)})).catch((e=>{this._logError("Call api error: "+e),t(e)}))}))}_handleError(e){this._logError("[FriendsOnline] error ",e)}_handleSucess(e){if(e&&e.onlines){this._friendsOnline={};for(let t of e.onlines)t&&t.userId&&(this._friendsOnline[t.userId]=t)}this._lastFetch=Date.now()}}var Ft=new Ut,Gt=s("QhJx"),Bt=s("XHvt");const Ht="contactList";let jt=0;class Vt extends o.a.Component{constructor(e){super(e),this.state={dataList:[],loaded:!1,startIndex:-1,highlightedItemId:e.selectedId||h.FAKE_CONVERSATION_ID.FRIEND_CENTER,checkSelectNewFriend:[],friendCenterConversation:null,refresh:!1},this.realFriends=[],this.newFriends=[],this.friendOnlines=[],this.defaultRequestListCount=3,this.expandedRequestList=!1,this.expandedSuggestList=!1,this.expandedNewFriendList=!1,this.tech=!1,this._selectConversation=this._selectConversation.bind(this),this._eventHandler=this._eventHandler.bind(this),this._showFindFriend=this._showFindFriend.bind(this),this.onJumpFriendCenter=this.onJumpFriendCenter.bind(this),this.onJumpGroupCenter=this.onJumpGroupCenter.bind(this),this._autoFocus=!0,this._isShowListFriend=O.default.getStatusToggle("BUTTON_FRIEND_LIST"),this._isShowRequestFriend=O.default.getStatusToggle("BUTTON_REQUEST_FRIEND"),this._isShowFriendRequest=O.default.getStatusToggle("BUTTON_SEND_REQUEST_FRIEND"),this._isShowNewFriend=O.default.getStatusToggle("BUTTON_NEW_FRIEND"),this._handleUpdateDisplayName(e),this.justReadMap={},this.justReadMapNewFriend={}}componentWillReceiveProps(e){this.props.needRefresh!==e.needRefresh&&this._handleUpdateDisplayName(e),this.props.friendRequests===e.friendRequests&&this.props.needRefresh===e.needRefresh||this._updateDataList(!1,!1,e.friendRequests)}shouldComponentUpdate(e,t){return this.state.dataList!==t.dataList||this.state.highlightedItemId!==t.highlightedItemId||this.props.updateDisplayName!==e.updateDisplayName||this.state.updateRemove!==t.updateRemove||this.props.friendRequests!==e.friendRequests||this.state.friendCenterConversation!==t.friendCenterConversation||this.state.refresh!==t.refresh||this.props.needRefresh!==e.needRefresh||this.props.privacySettings!==e.privacySettings}componentWillMount(){this._getContactList()}componentDidMount(){if(v.default.subscribe(this._eventHandler),g.default.log("contact-list: componentDidMount"),v.default.send(p.FriendListActions.NOTIFICATIONS_CHANGED,{action:"clear"}),this.componentDidUpdate(),O.default.getConversation(h.FAKE_CONVERSATION_ID.FRIEND_CENTER).then((e=>{e&&this.setState({friendCenterConversation:e})})),this.props.compactLv!==h.COMPACT_LEVEL.COMPACT){let e=N.a.getOldTab();e&&void 0!==e[this.props.currentTab]?(this.props.contacts[e[this.props.currentTab].userId]&&(se.a.setIdChatBoxViewCurrent(e[this.props.currentTab].userId),this._selectConversation(this.props.contacts[e[this.props.currentTab].userId])),e[this.props.currentTab].userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER?this.onJumpFriendCenter():e[this.props.currentTab].userId===h.FAKE_CONVERSATION_ID.GROUP_CENTER&&this.onJumpGroupCenter()):this.onJumpFriendCenter()}this._isShowListFriend&&Ft.getFriendsOnline().then((e=>{this._updateDataList(!1,!1,null,e)})).catch((e=>{g.default.logCoreError(e)}))}componentDidUpdate(){if(g.default.log("contact-list: componentDidUpdate"),O.default.setLastContactListOpenTime(Date.now()),this._autoFocus&&document.activeElement&&document.activeElement.constructor===HTMLBodyElement){let e=document.getElementById(Ht);e&&(e.focus(),this._autoFocus=!1)}}componentWillUnmount(){v.default.unsubscribe(this._eventHandler),this.realFriends&&(jt=this.realFriends.length)}_getContactList(){if(this.props.contacts){if(this.props.contacts){this.realFriends=[];const e=!!wt.f.getConfigShowAllUser(this.props.user.userId);for(let t in this.props.contacts)if(this.props.contacts.hasOwnProperty(t)){let s=this.props.contacts[t];if(!s)continue;1!==s.isFr&&!0!==s.isFr&&s.userId!==c.c.supportPage||s.userId==this.props.user.userId||!s.isValid||(this.props.updateDisplayName&&this.props.updateDisplayName.hasOwnProperty(s.userId)&&(s.displayName=this.props.updateDisplayName[s.userId]),s.userId==c.c.sendToMeId?this.sendToMeData=s:(e||s.isActive||s.isActiveWeb||s.isActivePC)&&this.realFriends.push(s))}jt=this.realFriends.length}this.friendOnlines=null,this._updateDataList(!0,!0)}this.realFriends.length<=2&&this._getContactListFromDb()}_getContactListFromDb(){k.default.getFriends().then((e=>{if(e){e=e.filter((e=>!!e)),this.realFriends=[];const t=!!wt.f.getConfigShowAllUser(this.props.user.userId);for(let s=0;s<e.length;s++)1!==e[s].isFr&&!0!==e[s].isFr&&e[s].userId!==c.c.supportPage||e[s].userId==this.props.user.userId||!e[s].isValid||(this.props.updateDisplayName&&this.props.updateDisplayName.hasOwnProperty(e[s].userId)&&(e[s].displayName=this.props.updateDisplayName[e[s].userId]),e[s].userId==c.c.sendToMeId?this.sendToMeData=e[s]:(t||e[s].isActive||e[s].isActivePC||e[s].isActiveWeb)&&this.realFriends.push(e[s]));jt=this.realFriends.length,this._updateDataList(!1,!0)}else this.setState({dataList:[],loaded:!0,startIndex:-1})}))}_handleUpdateDisplayName(e){if(!e.updateDisplayName)return;let t=!1;if(this.realFriends.length>0)for(let s=0;s<this.realFriends.length;++s)e.updateDisplayName.hasOwnProperty(this.realFriends[s].userId)&&this.realFriends[s].displayName!==e.updateDisplayName[this.realFriends[s].userId]&&(this.realFriends[s].displayName=e.updateDisplayName[this.realFriends[s].userId],t=!0);t&&this._updateDataList()}_focusContactList(){this._contactListRef&&this._contactListRef.focus()}moveDown(e=!0){this._dataList&&(this._dataList.moveFocusDown(),e&&this._focusContactList())}moveUp(e=!0){this._dataList&&this._dataList.moveFocusUp()&&e&&this._focusContactList()}getFocusedIndex(){if(this._dataList)return this._dataList.getFocusedIndex()}scrollToTop(e=!0){this._dataList&&(this._dataList.scrollToTop(),e&&this._focusContactList())}_eventHandler(e,t){switch(e){case p.FriendListActions.CHANGE_MODE_SHOW_CONTACT:this._getContactList();break;case p.FriendListActions.NOTIFICATIONS_NEWFRIENDS:t.payload&&t.payload.length>0&&this._updateDataList();break;case p.FetchActions.FRIENDS_FETCHED:if(t){const e=this.realFriends.reduce(((e,t)=>(t&&t.userId&&(e[t.userId]=!0),e)),{}),s=t=>{t&&t.userId&&(t.userId!==this.props.user.userId&&c.c.sendToMeId!==t.userId?e.hasOwnProperty(t.userId)||this.realFriends.push(t):t.userId==c.c.sendToMeId&&(this.sendToMeData=t))};if(t.constructor===Array)for(let a of t)s(a);else{g.default.log("contact-list: FRIENDS_FETCHED with payload as object",t);for(let e in t)t.hasOwnProperty(e)&&s(t[e])}this._updateDataList()}break;case p.FetchActions.FRIENDS_REMOVED:for(let e=0;e<this.realFriends.length;e++)if(this.realFriends[e].userId===t){this.realFriends.splice(e,1);break}Ft.remove(t),Ft.getFriendsOnline().then((e=>{this._updateDataList(!1,!1,null,e)})).catch((e=>{}));break;case p.ChatBoxActions.UPDATE_FRIEND_PROFILE:case p.FetchActions.UPDATE_PROFILE_MODE:if(t)for(let e=0;e<this.realFriends.length;e++){let s=this.realFriends[e];if(s&&s.userId===t.userId){s.user_mode=g.default.verifyUserMode(t.user_mode),s.lastActionTime=t.lastActionTime,s.lastOnlineTime=t.lastOnlineTime,s.avatar=t.avatar,this.realFriends[e]=s,this._updateDataList();break}}break;case p.ChatBoxActions.UPDATE_USER_ACTION_TIME:if(t){for(let e=0;e<this.realFriends.length;e++){let s=this.realFriends[e];s&&t[s.userId]&&(s.lastActionTime=t[s.userId].lastActionTime,s.lastOnlineTime=t[s.userId].lastOnlineTime,this.realFriends[e]=s)}this._updateDataList();break}break;case p.ConversationListActions.FRIEND_CENTER_CHANGE:if(t&&"new_request"===t.act&&t.conversations){let e=t.conversations;for(let t=0;t<e.length;t++){let s=e[t];if(s&&s.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER){this.setState({friendCenterConversation:s}),this._updateDataList();break}}}break;case p.ConversationListActions.ONOFF_FRIEND_CENTER:this._updateDataList();break;case p.ConversationListActions.SELECT_CONVERSATION:t&&this.setState({highlightedItemId:t.userId});break;case p.ConversationListActions.TAG_CONV:this._updateDataList()}}_focusInputBox(){v.default.send(p.ChatBoxActions.FOCUS_INPUT)}_handleKeyPressEvent(e){switch(e.keyCode){case h.K_PAGEUP:if(e.ctrlKey||e.metaKey||e.altKey)break;case h.K_UP:this.getFocusedIndex()?this.moveUp(!1):v.default.send(p.SideBarActions.FOCUS_SEARCH_INPUT);break;case h.K_PAGEDOWN:if(e.ctrlKey||e.metaKey||e.altKey)break;case h.K_DOWN:this.moveDown(!1);break;case h.K_SPACE:case h.K_ENTER:break;case h.K_HOME:this.scrollToTop(!1);break;case h.K_END:this._dataList&&this._dataList.scrollToBottom()}}_toggleBlock(e,t){k.default.blockFriend(t.userId,t.isBlocked?h.UNSET_BLOCK:h.SET_BLOCK).then((e=>{1===t.isBlocked?R.a.createSuccess(T.default.str("STR_BLOCK_USER_TOAST_SUCCESS")):R.a.createSuccess(T.default.str("STR_UNBLOCK_USER_TOAST_SUCCESS")),this.props.dispatch({type:p.ConversationListActions.BLOCK_CONVERSATION,payload:{blocked:t.isBlocked,userId:t.userId}})})).catch((e=>{g.default.logCoreError("error: "+e)})),e&&(e.stopPropagation(),e.preventDefault())}_getblock(e){let t=!1;for(let s=0;s<this.realFriends.length;++s)e.userId==this.realFriends[s].userId&&(this.realFriends[s].isBlocked=0===e.isBlocked?1:0,O.default._updateFriendStatusBlock(e,this.realFriends[s].isBlocked),t=!0);t&&this._updateDataList()}_updateDataList(e=!1,t=!1,s=null,n=null){g.default.log("contact-list: _updateDataList");const i=[];i.push(new W.b({key:"_add_fr",addFriendButton:!0,height:44})),!0===O.default.getEnableFriendSuggestion()&&i.push(new W.b({key:"_fr_center",friendCenter:!0,height:h.CONTACT_ITEM_HEIGHT})),i.push(new W.b({key:"_gr_center",groupCenter:!0,height:h.CONTACT_ITEM_HEIGHT})),i.push(new W.c({key:"_fr_stm",height:h.CONTACT_LABEL_HEIGHT-11,titleSendToMe:!0,html:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_SEND2ME_FROM"}))})),this.sendToMeData&&!c.c.isOffSendToMe&&i.push(new W.b(Object(a.a)({key:"_send_to_me",height:h.CONTACT_ITEM_HEIGHT,sendToMe:!0},this.sendToMeData)));const r=s||this.props.friendRequests,l=this.realFriends;this.friendOnlines;let d=null;try{d=JSON.parse(localStorage.getItem("f_nf_"+this.props.user.userId))}catch(m){Lt.Kha.error(m)}let u=[];if(d&&l.length>0)for(let a=0;a<d.length;a++)if(d[a]&&d[a].ts<Date.now()-864e5)O.default.removeNewFriend(d[a].userId);else if(!se.a.isThreadHidden(d[a].userId))for(let e=0;e<l.length;e++)d[a].userId===l[e].userId&&(void 0===d[a].checkNotiNewFriends&&(l[e].checkNotiNewFriends=!0),l[e].newsFriend=!0,l[e].selectedNewFriend=!0,u.push(l[e]));if(c.c.enableFriendSuggestion&&r.length){r.sort(((e,t)=>{if(e.friendRequestType!==t.friendRequestType)return t.friendRequestType-e.friendRequestType;if(void 0===e.friendRequestSortOrder||void 0===t.friendRequestSortOrder)return t.friendRequestFetchTime-e.friendRequestFetchTime;let s=t.friendRequestFetchTime-e.friendRequestFetchTime;return s||(s=e.friendRequestSortOrder-t.friendRequestSortOrder),s}));let e=[],t=[],s=[],n=[];r.forEach((a=>{a.friendRequestType===h.FRIEND_REQUEST_TYPE_REQUEST&&!0===h.ON_FEATURE.CONTACT_LIST_SUGGEST&&(e.push(a),t.push(a)),a.friendRequestType!==h.FRIEND_REQUEST_TYPE_REQUEST&&(s.push(a),n.push(a))})),this.expandedRequestList||(s=s.slice(0,this.defaultRequestListCount)),this.expandedSuggestList||(e=e.slice(0,this.defaultRequestListCount));const l=t.filter((e=>e.friendRequestType&&!e.friendRequestRead)).map((e=>e.userId)),c=Date.now();if(l.length){const e=[];let t=l.length;for(let s of r)if(-1!==l.indexOf(s.userId)&&(this.justReadMap[s.userId]=c,s.friendRequestRead=!0,e.push(s),--t<=0))break;O.default.addFriends(e),v.default.send(p.FriendListActions.NOTIFICATIONS_CHANGED,{action:"remove",ids:l})}if(!0===h.ON_FEATURE.ENABLE_FRIEND_REQUEST_SECTION_CONTACT_LIST&&e.length>0&&(i.push(new W.c({key:"_fr_rqq",height:h.CONTACT_LABEL_HEIGHT+(this._isShowFriendRequest?-parseInt(5):8),titleFriendsRequest:!0,onClick:()=>{this._isShowFriendRequest=!this._isShowFriendRequest,O.default.setStatusToggle("BUTTON_SEND_REQUEST_FRIEND",this._isShowFriendRequest),this._updateDataList()},html:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_FRIEND_REQUEST_DEFAULT"})," ("+t.length+")")})),this._isShowFriendRequest)){e.forEach((e=>{e.height=h.CONTACT_ITEM_HEIGHT,e.delete=!0,e.friendRequestMsg&&(e.height+=14),i.push(c-this.justReadMap[e.userId]<5e3?new W.b(Object(a.a)(Object(a.a)({},e),{},{justRead:!0})):new W.b(Object(a.a)({},e)))}));let s=t.length-e.length;e.length!==t.length||e.length<t.length?i.push(new W.c({key:"_view_more_requests",viewMoreButton:!0,height:39,html:o.a.createElement("div",{className:"flx flx-al-c",style:{color:"var(--blue-300)",position:"relative",left:"-5px",lineHeight:"35px"}},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"}),o.a.createElement("span",{className:"number-viewmore"},"  ("+s+")")),onClick:()=>{this.expandedSuggestList=!0,this._updateDataList()}})):this.expandedSuggestList&&t.length>3&&i.push(new W.c({key:"_view_less_requests",viewLessButton:!0,height:39,titleRequestFriends:!0,html:o.a.createElement("div",{className:"flx flx-al-c",style:{color:"var(--blue-300)",position:"relative",left:"-5px",lineHeight:"35px"}},o.a.createElement(E.a,{textKey:"STR_VIEWLESS"})),onClick:()=>{this.expandedSuggestList=!1,this._updateDataList()}}))}if(!0===h.ON_FEATURE.ENABLE_SUGGEST_FRIEND_SECTION_CONTACT_LIST&&s.length>0&&(i.push(new W.c({key:"_fr_rq",height:h.CONTACT_LABEL_HEIGHT+(this._isShowRequestFriend?-parseInt(5):8),titleRequestFriends:!0,onClick:()=>{this._isShowRequestFriend=!this._isShowRequestFriend,O.default.setStatusToggle("BUTTON_REQUEST_FRIEND",this._isShowRequestFriend),this._updateDataList()},html:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_CONTACT_SUGGEST_FRIEND"})," "," ("+n.length+")")})),this._isShowRequestFriend))if(s.forEach((e=>{e.height=h.CONTACT_ITEM_HEIGHT,e.delete=!1,e.friendRequestMsg&&(e.height+=14),i.push(new W.b(e))})),s.length!==n.length||s.length<n.length){let e=n.length-s.length;i.push(new W.c({key:"_view_more_requests",viewMoreButton:!0,height:39,html:o.a.createElement("div",{className:"flx flx-al-c",style:{color:"var(--blue-300)",position:"relative",left:"-5px",lineHeight:"35px"}},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"}),o.a.createElement("span",{className:"number-viewmore"}," "," ("+e+")")),onClick:()=>{this.expandedRequestList=!0,this._updateDataList()}}))}else this.expandedRequestList&&n.length>3&&i.push(new W.c({key:"_view_less_requests",viewLessButton:!0,height:39,titleRequestFriends:!0,html:o.a.createElement("div",{className:"flx flx-al-c",style:{color:"var(--blue-300)",position:"relative",left:"-5px",lineHeight:"35px"}},o.a.createElement(E.a,{textKey:"STR_VIEWLESS"})),onClick:()=>{this.expandedRequestList=!1,this._updateDataList()}}))}if(u.length>0){let e=u;this.expandedNewFriendList||(e=u.slice(0,this.defaultRequestListCount));let t=u.length-e.length;const s=u.filter((e=>e.checkNotiNewFriends)).map((e=>e.userId)),n=Date.now();if(s.length){let e=s.length;for(let a of u)if(-1!==s.indexOf(a.userId)&&(this.justReadMapNewFriend[a.userId]=n,--e<=0))break;let t=u.map((function(e){return e.checkNotiNewFriends=!1,e.ts=Date.now(),e}));localStorage.setItem("f_nf_"+this.props.user.userId,JSON.stringify(t))}i.push(new W.c({key:"_fr_nf",height:h.CONTACT_LABEL_HEIGHT+(this._isShowNewFriend?-parseInt(5):8),titleNewFriends:!0,onClick:()=>{this._isShowNewFriend=!this._isShowNewFriend,O.default.setStatusToggle(this._isShowNewFriend,"BUTTON_NEW_FRIEND"),this._updateDataList()},html:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_NEW_FRIENDS"})," ("+u.length+")")})),this._isShowNewFriend&&(e.forEach((e=>{e.height=h.CONTACT_ITEM_HEIGHT,i.push(n-this.justReadMapNewFriend[e.userId]<5e3?new W.b(Object(a.a)(Object(a.a)({},e),{},{notiNewFriends:!0})):new W.b(Object(a.a)({},e)))})),e.length!==u.length||e.length<u.length?i.push(new W.c({key:"_view_more_requests",viewMoreButton:!0,height:39,html:o.a.createElement("div",{className:"flx flx-al-c",style:{color:"var(--blue-300)",position:"relative",left:"-5px",lineHeight:"35px"}},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"}),o.a.createElement("span",{className:"number-viewmore"},"  ("+t+")")),onClick:()=>{this.expandedNewFriendList=!0,this._updateDataList()}})):this.expandedNewFriendList&&u.length>3&&i.push(new W.c({key:"_view_less_requests",viewLessButton:!0,height:39,titleRequestFriends:!0,html:o.a.createElement("div",{className:"flx flx-al-c",style:{color:"var(--blue-300)",position:"relative",left:"-5px",lineHeight:"35px"}},o.a.createElement(E.a,{textKey:"STR_VIEWLESS"})),onClick:()=>{this.expandedNewFriendList=!1,this._updateDataList()}})))}l.length>0&&(l.sort(((e,t)=>{let s=this._getdisplayName(e),a=this._getdisplayName(t);return s.localeCompare(a,"vi",{sensitivity:"accent"})})),i.push(new W.c({key:"_fr_lb",height:h.CONTACT_LABEL_HEIGHT+(this._isShowListFriend?-parseInt(8):8),titleRealFriends:!0,onClick:()=>{this._isShowListFriend=!this._isShowListFriend,O.default.setStatusToggle("BUTTON_FRIEND_LIST",this._isShowListFriend),this._updateDataList()},html:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_CONTACT_FRIENDS"}),e?` (${jt})`:" ("+l.length+")"," ")})),this._isShowListFriend&&l.forEach((e=>{e&&!se.a.isThreadHidden(e.userId)&&(e.height=h.CONTACT_ITEM_HEIGHT,n&&(n[e.userId]?e.friendOnl=!0:e.friendOnl=!1),e.selectedNewFriend=!1,i.push(new W.b(Object(a.a)({},e))))})));let _=this.state.startIndex;if(t&&i)for(let a=0;a<i.length;a++){let e=i[a];if(e.constructor===W.b&&e.data&&!e.data.friendOnl&&e.data.userId&&e.data.userId==this.state.highlightedItemId){_=a;break}}return this.setState({dataList:i,startIndex:_,loaded:!0}),i}_getdisplayName(e){if(!e)return"";let t="",s=k.default.getMiniInfo(e.userId);return s&&s.dName&&(t=s.dName),0===t.length&&(t=e.displayName),t}_selectConversation(e,t=!1){if(I.e.logAction(178004),e&&e.userId){if(this.setState({highlightedItemId:e.userId}),this.props.selectConversation(e,t),this.realFriends){let t=this.realFriends.filter((function(t){return t.userId===e.userId&&e.newsFriend}));t&&t.length,this.setState({checkSelectNewFriend:t})}if(t&&e&&e.userId&&this.props.dispatch({type:p.ChatBoxActions.FOCUS_INPUT,payload:{userId:e.userId}}),this._dataList&&this.state.dataList&&e.userId)for(let t=0;t<this.state.dataList.length;t++){let s=this.state.dataList[t];if(s.constructor===W.b&&s.data&&s.data.userId===e.userId){this._dataList.setFocusedIndex(t),this.setState({startIndex:t});break}}}else t&&e&&e.addFriendButton&&this._showFindFriend()}selectFocusedConversation(e=!1){if(this._dataList){let t=this._dataList.getFocusedItem();if(t)return this._selectConversation(t.data,e),t.data.userId}return null}_showFindFriend(){I.e.logAction(1580101),this.props.dispatch({type:p.PopupActions.TOGGLE_FIND_FRIEND}),this.props.cancel&&this.props.cancel()}_onBlur(){this._dataList&&this._dataList.setFocusedIndex(-1)}renderItem(e,t,s){if(t.constructor===W.c)return t.data.viewMoreButton||t.data.viewLessButton?o.a.createElement("div",{key:t.data.key,className:"data-list__more clickable flx flx-al-c flx-center",style:{float:"left"},onClick:t.data.onClick},t.data.text||t.data.html):t.data.titleRealFriends?o.a.createElement("div",{className:"data-list__label",style:{fontSize:"15px",lineHeight:"32px"},key:t.data.key},t.data.html,o.a.createElement("span",{style:{cursor:"pointer",float:"right",fontSize:"16px",left:"-2px",color:"var(--neutral-600)",position:"relative",top:"3px"},onClick:t.data.onClick},o.a.createElement("i",{className:"fa fa-chevron-"+(this._isShowListFriend?"up":"down")}))):t.data.titleRequestFriends?o.a.createElement("div",{className:"data-list__label",style:{fontSize:"15px",lineHeight:"38px"},key:t.data.key},t.data.html,o.a.createElement("span",{style:{cursor:"pointer",float:"right",fontSize:"16px",left:"-2px",color:"var(--neutral-600)",position:"relative",top:"3px"},onClick:t.data.onClick},o.a.createElement("i",{className:"fa fa-chevron-"+(this._isShowRequestFriend?"up":"down")}))):t.data.titleFriendsRequest?o.a.createElement("div",{className:"data-list__label",style:{fontSize:"15px",lineHeight:"43px"},key:t.data.key},t.data.html,o.a.createElement("span",{style:{cursor:"pointer",float:"right",fontSize:"16px",left:"-2px",color:"var(--neutral-600)",position:"relative",top:"3px"},onClick:t.data.onClick},o.a.createElement("i",{className:"fa fa-chevron-"+(this._isShowFriendRequest?"up":"down")}))):t.data.titleSendToMe?o.a.createElement("div",{className:"data-list__label",style:{fontSize:"15px",lineHeight:"36px"},key:t.data.key},t.data.html,o.a.createElement("span",{style:{cursor:"pointer",float:"right",fontSize:"15px",left:"-2px",color:"var(--neutral-600)",position:"relative",top:"3px"},onClick:t.data.onClick})):t.data.titleNewFriends?o.a.createElement("div",{className:"data-list__label",style:{fontSize:"15px",lineHeight:"43px"},key:t.data.key},t.data.html,o.a.createElement("span",{style:{cursor:"pointer",float:"right",fontSize:"16px",color:"var(--neutral-600)",position:"relative",top:"3px"},onClick:t.data.onClick},o.a.createElement("i",{className:"fa fa-chevron-"+(this._isShowNewFriend?"up":"down")}))):o.a.createElement("div",{className:"data-list__label",key:t.data.key},t.data.text||t.data.html);N.a.getOldTab();if(t.data.addFriendButton)return o.a.createElement("div",{key:t.data.key,onClick:this._showFindFriend,className:"contact-list__add flx flx-al-c nav-button_add_friend clickable h100 flx flx-al-c  "+(s?" find-friend-active":"")},o.a.createElement("i",{className:"fa fa-icon-add-friend contact-list__add__icon "}),o.a.createElement(E.a,{className:"contact_add_friend_item",textKey:"STR_ADD_FRIEND_BY_PHONENUMBER"}));if(!0===t.data.friendCenter){let e=0,t=this.state.friendCenterConversation;return t&&t.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER&&(e=t.smsUnreadCount),o.a.createElement("div",{className:"contact-list-item"+(this.props.compactLv&&this.state.highlightedItemId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER?" selected":""),"data-id":"div_TabCT_FrdReq",onClick:e=>{this.onJumpFriendCenter(),I.e.logAction(1280201)}},o.a.createElement("img",{src:Gt.a,className:"fr-conv-item-avatar"}),o.a.createElement("div",{className:"avatar__oa-verified",style:{position:"absolute",left:"50px",top:"50px"}}),o.a.createElement(E.a,{textKey:"STR_CONTACT_SUGGEST_FRIEND_2",className:"fr-conv-item-title truncate",style:{width:"calc(100% - 60px)"}}),o.a.createElement("div",{style:{flex:1}}),e>0?o.a.createElement("div",{style:{background:"var(--red-300)",color:"var(--white-300)",position:"relative",borderRadius:"50%",width:"16px",height:"16px",margin:"auto 0",fontWeight:600,fontSize:"11px"}},o.a.createElement("div",{style:{position:"relative",top:"0px",left:"3px"}},"N")):null)}return!0===t.data.groupCenter?o.a.createElement("div",{className:"contact-list-item"+(this.props.compactLv&&this.state.highlightedItemId===h.FAKE_CONVERSATION_ID.GROUP_CENTER?" selected":""),"data-id":"div_TabCT_JoinedGrp",onClick:this.onJumpGroupCenter.bind(this)},o.a.createElement("img",{src:Bt.a,className:"fr-conv-item-avatar"}),o.a.createElement("div",{className:"avatar__oa-verified",style:{position:"absolute",left:"50px",top:"50px"}}),o.a.createElement(E.a,{textKey:"STR_GROUPS_LIST",className:"fr-conv-item-title truncate",style:{width:"calc(100% - 60px)"}})):o.a.createElement(U,{isSelected:s,isHighlighted:this.state.checkSelectNewFriend.length||t.data.userId!==this.state.highlightedItemId?"":this.state.highlightedItemId,item:t.data,getConversationFromId:this.props.getConversationFromId,isGroup:!1,currentTab:this.props.currentTab,dispatch:this.props.dispatch,key:t.data.friendOnl?"zonl_"+t.data.userId:t.data.userId,selectConversation:this._selectConversation,showUserInfo:this.props.showUserInfo,showEditAlias:this.props.showEditAlias,acceptFriendRequest:this.props.acceptFriendRequest,rejectFriendRequest:this.props.rejectFriendRequest,confirm:this.props.confirm,selectedNewFriend:this.state.checkSelectNewFriend,user:this.props.user,conversationActionProps:{presets:"Contact"},privacySettings:this.props.privacySettings,compactLv:this.props.compactLv})}getItemKey(e){return e.constructor===W.c||e.data.addFriendButton||e.data.topBanner?e.data.key:e.data.friendOnl?"zonl_"+e.data.userId:e.data.userId}getRefOfDataListComponent(){return this._dataList?this._dataList:null}focusList(){this._contactListRef&&this._contactListRef.focus()}onQuickAddFriend(e,t){const s=e=>{t(e)};S.a.doAddFriend(e,h.FRIEND_REQUEST_SRC_LAN,this.props.dispatch).then((e=>{s()})).catch((e=>{s(e)}))}onJumpFriendCenter(e=!1){if(!0!==O.default.getEnableFriendSuggestion())return;let t=t=>{if((!0!==e||"contact"===Q.default.getZaloTab())&&t){const e=()=>{let e=Object(a.a)(Object(a.a)({},t),{},{smsUnreadCount:0});this.props.dispatch({type:p.SideBarActions.SELECT_FRIEND_CENTER,payload:e}),this.setState({friendCenterConversation:e,highlightedItemId:h.FAKE_CONVERSATION_ID.FRIEND_CENTER}),this._updateDataList()};O.default.updateConversation({userId:t.userId,smsUnreadCount:0},["smsUnreadCount"]).then((t=>{e()})).catch((t=>{e()}));let s={name:this.props.currentTab,userId:t.userId};N.a.setOldTab(s)}};this.state.friendCenterConversation?t(this.state.friendCenterConversation):O.default.getConversation(h.FAKE_CONVERSATION_ID.FRIEND_CENTER).then((e=>{e?t(e):S.a.createFriendCenter(this.props.dispatch,this.props.user.userId).then((e=>{t(e)}))})).catch((e=>{g.default.logCoreError("[fr-center] cannot load---- "+JSON.stringify(e))}))}onJumpGroupCenter(){this.setState({highlightedItemId:h.FAKE_CONVERSATION_ID.GROUP_CENTER}),this.props.dispatch&&this.props.dispatch({type:p.SideBarActions.SELECT_GROUP_CENTER});let e={name:this.props.currentTab,userId:h.FAKE_CONVERSATION_ID.GROUP_CENTER};N.a.setOldTab(e),I.e.logAction(1280202)}onListScroll(){this.friendAction&&this.friendAction.close(),this.props.dispatch&&this.props.dispatch({type:p.ConversationListActions.SCROLL_CONTACT_LIST})}render(){let e=this.props.className?this.props.className:"";return e+=" z-data-list contact-list",e+=" web ",this.state.loaded?o.a.createElement("div",{id:Ht,key:"contactList",className:e,onBlur:this._onBlur.bind(this),onKeyDown:this._handleKeyPressEvent.bind(this),ref:e=>this._contactListRef=e,tabIndex:"30"},o.a.createElement(W.d,{items:this.state.dataList,key:"contactListDl",dltype:W.a.CONTACT,ref:e=>this._dataList=e,getItemKey:this.getItemKey.bind(this),focusedIndex:this.state.startIndex,compositeScroll:!1,highlightIndex:this.state.highlightedItemId,renderItem:this.renderItem.bind(this),onScroll:this.onListScroll.bind(this),additionalProps:this.props.privacySettings,"data-id-info":{list:"div_TabCT_FrdList",item:"div_TabCT_FrdItem"}})):o.a.createElement("div",{className:"flx flx-al-c flx-col flx-center  nav-loading "+e},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner spinner-friend"}))}}var Kt=Vt;class Wt extends o.a.Component{constructor(e){super(e),this.state={filter:h.FILE_TYPE_RECENT,triggerUpdate:!1}}shouldComponentUpdate(e,t){return this.state.filter!=t.filter||this.state.triggerUpdate!==t.triggerUpdate}filterFile(e){switch(this.setState({filter:e}),v.default.send(p.SideBarActions.CHANGE_FILE_FILTER,e),e){case h.FILE_TYPE_RECENT:I.e.logAction(13301);break;case h.FILE_TYPE_DOWNLOADED:I.e.logAction(13302);break;case h.FILE_TYPE_GOOGLE_DRIVE:I.e.logAction(13303);break;case h.FILE_TYPE_DROPBOX:I.e.logAction(13304)}}render(){return o.a.createElement("div",{className:"file-sidebar absolute h100 w100"},o.a.createElement("div",{className:"file-sidebar__optiongroup"},"Zalo File"),o.a.createElement("div",{onClick:this.filterFile.bind(this,h.FILE_TYPE_RECENT),className:"clickable file-sidebar__option "+(this.state.filter==h.FILE_TYPE_RECENT?" selected":""),"data-id":"div_MNGEFile_RecentFile"},o.a.createElement("i",{className:"fa fa-file-icon-recent file-sidebar__option__icon"}),o.a.createElement("span",{className:"file-sidebar__option__title"},o.a.createElement(E.a,{textKey:"STR_FILE_RECENT"}))),null,!1,o.a.createElement("div",{className:"file-sidebar__optiongroup"},"Cloud Storages"),o.a.createElement("div",{onClick:this.filterFile.bind(this,h.FILE_TYPE_GOOGLE_DRIVE),className:"clickable file-sidebar__option "+(this.state.filter==h.FILE_TYPE_GOOGLE_DRIVE?" selected":""),"data-id":"div_MNGEFile_GGFile"},o.a.createElement("i",{className:"fa fa-file-icon-drive file-sidebar__option__icon file-sidebar__option__icon--google-drive"}),o.a.createElement("span",{className:"file-sidebar__option__title"},"Google Drive")),o.a.createElement("div",{onClick:this.filterFile.bind(this,h.FILE_TYPE_DROPBOX),className:"clickable file-sidebar__option "+(this.state.filter==h.FILE_TYPE_DROPBOX?" selected":""),"data-id":"div_MNGEFile_DropFile"},o.a.createElement("i",{className:"fa fa-file-icon-dropbox file-sidebar__option__icon"}),o.a.createElement("span",{className:"file-sidebar__option__title"},"Dropbox")))}}var Yt=Wt,zt=s("egaF"),qt=s("8Nyn"),Xt=s("eonx"),Jt=s("k/Tv"),Qt=s("30XY");class $t extends o.a.Component{constructor(e){super(e),this._selectItem=this._selectItem.bind(this),this.state={listCatalog:[],catalogIdSelected:-1}}componentDidMount(){2==Qt.b.checkShowReddotSidebar()&&Qt.b.setShowReddotSidebar(0),Jt.a.getCatalogList().then((e=>{if(e&&e.constructor==Array){let t=-1;for(const s of e)if(s&&s.isDefault){t=s.catalog_id;break}this.setState(Object(a.a)(Object(a.a)({},this.state),{},{listCatalog:e,catalogIdSelected:t})),this._selectItem(t,!1)}})).catch((e=>{}))}shouldComponentUpdate(e,t){return t.listCatalog!==this.state.listCatalog||t.catalogIdSelected!==this.state.catalogIdSelected}_selectItem(e,t=!0){Xt.b.send(Xt.a.SELECT_CATALOG,{catalogId:e}),this.props.dispatch({type:p.SideBarActions.SHOW_CATALOG_VIEW}),t&&this.setState({catalogIdSelected:e})}_renderHeader(){return o.a.createElement("div",{className:"catalog-title-sidebar flx"},o.a.createElement(E.a,{textKey:"STR_TITLE_CATALOG_LIST"}),c.c.product_catalog.show_beta_mark?o.a.createElement("div",{className:"beta-mark"},"BETA"):null)}_openLinkTutorial(){c.c.product_catalog.link_tutorial_catalog&&(window.open(c.c.product_catalog.link_tutorial_catalog),I.e.logAction(2220201))}_renderItemsCatalog(){return this.state.listCatalog.length?this.state.listCatalog.map((e=>o.a.createElement(qt.a,{icon:"outline-product",title:e.isDefault?"STR_TITLE_CATALOG_DEFAULT":e.catalog_name,selected:this.state.catalogIdSelected==e.catalog_id,selectItem:this._selectItem,catalogItem:e}))):null}_renderListCatalog(){return o.a.createElement(zt.b,null,this._renderItemsCatalog())}_renderTutorialEntry(){return c.c.product_catalog.link_tutorial_catalog?o.a.createElement("div",{className:"catalog-sidebar-bt-tutorial"},o.a.createElement(st.a,{type:"secondary",onClick:this._openLinkTutorial.bind(this),icon:"catalog_tutorial",format:"rounded",size:"medium",textKey:"STR_POPUP_TUTORIAL_CATALOG",className:"wi"})):null}render(){return o.a.createElement("div",{className:"catalog-sidebar absolute h100 w100"},o.a.createElement("div",{className:"catalog-sidebar-content"},this._renderHeader(),this._renderListCatalog(),this._renderTutorialEntry()))}}var Zt=$t,es=s("6Be5"),ts=s("/GXy"),ss=s("I40c");const as=navigator.userAgent.search("Firefox")>-1;var ns=Object(L.sidebarConnect)(((e,t)=>{const s=[-1e3];try{if(!t.previewFromUid||s.includes(t.previewFromUid))return;const a=t.previewFromUid&&Object(w.miniInfoSelector)(t.previewFromUid)(e);return{previewDName:(null==a?void 0:a.dName)||t.previewDName}}catch(a){}}))((({className:e="",isMessageInfo:t,isGroup:s,isDraft:a,previewFromUid:n,previewDName:i})=>{let r="";return a||(r="0"===n?`${T.default.str("STR_YOU")}:`:s&&i?`${i}:`:""),t&&(r=""),r&&o.a.createElement("span",{className:`conv-dbname ws-pre ${as?"conv-dbname--firefox":""} truncate ${e}`,style:{marginRight:r&&"4px",color:a&&"#db342e"}},r)}));const is=[h.MSG_INFO,h.MSG_GROUP_NOTI,h.MSG_FRIEND_SENT_REQUEST,h.MSG_SUGGEST_IN_CHAT,h.MSG_TODO,h.MSG_TODO_DONE,h.MSG_ECARD,h.MSG_INFO_CHAT,h.MSG_INFO,h.MSG_FRIEND_SENT_REQUEST,h.MSG_SUGGEST_IN_CHAT,h.MSG_TODO,h.MSG_TODO_DONE,h.MSG_GROUP_NOTI];var os=s("wJTH"),rs=s("ofhN"),ls=s("LCVH"),cs=s("V079"),ds=(s("1FaF"),s("yFRN")),hs=s("4eSn");const us=({displayName:e,isGroup:t,userId:s})=>{let a=e;if(t)return a||s;let n=k.default.getMiniInfo(s);return n&&(a=n.dName&&n.dName.length>0?n.dName:a),a||s},_s=e=>{const t=b.b.getLabelObjByConversaionId(e);if(!t)return null;const s=g.default._verifyColor(t.color);return{text:t.text,color:s}},ms=(e,t)=>{const s=k.default.isBlocked(e),a=e!==h.CONV_FILTER.STRANGER;return(s||t)&&a},ps=e=>{if(!e)return!1;return typeof e==typeof Object.create(HTMLElement.prototype,{})},gs=(e,t={})=>{var s;if(null==e||!e.previewMessage)return{};const{previewMsgType:a,previewMessage:n,previewDName:i,previewMentions:o,previewUrgency:r,previewFromUid:l,previewProperties:c}=e;let d={};const u=k.default.getDName(l);switch(d.previewDName=u||i||"",a){case h.MSG_TEXT:if(d.previewMessage="string"==typeof n?m.b.replaceMentionedNames(n,o):m.b.replaceMentionedNames(null==n?void 0:n.title,o),r)switch(r){case h.URGENCY_MODE.URGENT:d.previewIcon=h.MESSAGE_ICON.URGENT;break;case h.URGENCY_MODE.IMPORTANT:d.previewIcon=h.MESSAGE_ICON.IMPORTANT}break;case h.MSG_STICKER:d.previewMessage=T.default.str("STR_STICKER_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.STICKER;break;case h.MSG_FILE:if(n&&n.params){let e=n.params;if(e&&"string"==typeof e)try{e=JSON.parse(e)}catch(p){}if(ds.a.isFolderParams(e)){const e=ds.a.getFolderTitle(null==n?void 0:n.title);d.previewMessage=e,d.previewMsgType=h.MSG_FOLDER,d.previewIcon=h.MESSAGE_ICON.FOLDER;break}}d.previewMessage=null==n?void 0:n.title,d.previewIcon=h.MESSAGE_ICON.FILE;break;case h.MSG_PHOTO:g.default.isPhotoStickerMessage({msgType:a,message:n,properties:c})?(d.previewMessage=T.default.str("STR_STICKER_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.STICKER):r?(r===h.URGENCY_MODE.URGENT&&(d.previewIcon=h.MESSAGE_ICON.URGENT),r===h.URGENCY_MODE.IMPORTANT&&(d.previewIcon=h.MESSAGE_ICON.IMPORTANT),d.previewMessage=n.title?m.b.replaceMentionedNames(n.title,o):T.default.str("STR_FILE_PHOTO")):(d.previewMessage=T.default.str("STR_FILE_PHOTO"),d.previewIcon=h.MESSAGE_ICON.PHOTO);break;case h.MSG_CONTACT:if("recommened.link"===n.action)d.previewMessage=m.b.replaceMentionedNames(n.title,o)||n.href,d.previewIcon=h.MESSAGE_ICON.LINK;else if("recommened.user"===n.action)d.previewMessage=T.default.str("STR_CONTACT_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.CONTACT;else if("recommened.calling"===n.action||"recommened.calltime"===n.action||"recommened.receivecall"===n.action||"recommened.misscall"===n.action){const e=((e,t={})=>{const{hasUnread:s,isMuted:a}=t,n=Object(hs.f)(e);let i=!0;return s&&!a&&(i=!1),{previewMessage:Object(hs.i)(n),previewIcon:{svgIcon:Object(hs.g)(n,i)}}})(n,t);d.previewMessage=e.previewMessage,d.previewIcon=e.previewIcon}else"recommened.stickerset"==n.action?(d.previewMessage=T.default.str("STR_STICKERSET_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.STICKER_SET):"recommened.vip"==n.action&&(d.previewMessage=T.default.str("STR_CONTACT_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.CONTACT);break;case h.MSG_GIF:d.previewMessage=T.default.str("STR_GIF_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.GIF;break;case h.MSG_LOCATION:d.previewMessage=n.desc,d.previewIcon=h.MESSAGE_ICON.LOCATION;break;case h.MSG_POLL:d.previewMessage=T.default.str("STR_POLL_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.POLL;break;case h.MSG_VIDEO:d.previewMessage=T.default.str("STR_VIDEO_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.VIDEO;break;case h.MSG_TODO:n&&n.constructor===String&&(d.previewMessage=n),n&&n.constructor===Object&&(d.previewMessage=n.message);break;case h.MSG_ECARD:const e=null==n||null===(s=n.params)||void 0===s?void 0:s.actions;if(Array.isArray(e)){const[t]=e;if(t&&"action.open.reminder"===t.actionId){var _;d.previewMessage=(null===(_=n.params)||void 0===_?void 0:_.previewTxt.substring(2))||T.default.str("STR_REMINDER_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.REMIND;break}}if(n&&n.params&&n.params.previewTxt){d.previewMessage=n.params.previewTxt||T.default.str("STR_CARD_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.ECARD;break}break;case h.MSG_INFO_CHAT:d.previewMessage=m.b.getPreviewMsgInfoChat({message:n});break;case h.MSG_INFO:case h.MSG_GROUP_NOTI:d.previewMessage=n;break;case h.MSG_UNDO:d.previewMessage=T.default.str("STR_UNDO_MSG","Tin nhắn đã thu hồi");break;case h.MSG_DEL_EVERYONE:d.previewMessage=T.default.str("STR_DEL_EVERYONE","Tin nhắn đã bị xóa");break;case h.CLI_MSG_TYPE_DOODLE:case h.MSG_DOODLE:d.previewIcon=h.MESSAGE_ICON.DOODLE,d.previewMessage=T.default.str("STR_DOODLE_MSG_NO_BRACKET");break;case h.MSG_ARTICLE:d.previewMessage=T.default.str("STR_ARTICLE_MSG","[Bài viết]");break;case h.CLI_MSG_TYPE_VOICE:d.previewMessage=T.default.str("STR_VOICE_MSG","[Tin nhắn thoại]");break;case h.MSG_OA:if(n)for(let t=0;t<n.length;t++){let e=n[t];"l.a.header.only"!==e.type&&"l.a.header.full"!==e.type||(d.previewMessage=e.title)}else d.previewMessage=T.default.str("STR_MSG_NOT_SUPPORTED","[Tin nhắn chưa hỗ trợ ở phiên bản hiện tại]");break;case h.MSG_VANISH:d.previewMessage=T.default.str("STR_VANISH_MSG","[Tin nhắn đã biến mất]");break;case h.MSG_VOICE:d.previewMessage=T.default.str("STR_VOICE_MSG_NO_BRACKET"),d.previewIcon=h.MESSAGE_ICON.VOICE;break;default:d.previewMessage=T.default.str("STR_MSG_NOT_SUPPORTED","[Tin nhắn chưa hỗ trợ ở phiên bản hiện tại]")}return d},Es=s("R+Bz").default;var fs=e=>t=>{var s;const{isFocused:n,focusInputBox:r,showContextMenu:l,dragOnIdHandler:d,dispatch:u,drillIntoGroup:_,selectConversation:m,state:E,isSelected:f,needRefresh:R,compactLv:S,innerRef:N}=t;let b=Object(a.a)({},E);const C=g.default.isInMediaBox(b)||b.userId===h.CONV_FILTER.MEDIA||g.default.forcePopupOA(b),A=(()=>{let e=c.c.mark_unread.enable&&b.unreadMark;const t=!!(C||b.smsUnreadCount&&b.smsUnreadNotCount&&b.smsUnreadCount-b.smsUnreadNotCount<=0),s=b.smsUnreadCount&&b.smsUnreadNotCount?b.smsUnreadCount-b.smsUnreadNotCount:b.smsUnreadCount;return b.smsUnreadCount||e?{isUnread:!0,isExceed:t,sum:s,recover:Boolean(e)}:{isUnread:!1,sum:0}})(),y=Boolean(null!=(s=b.muted)?s:O.default.isMuted(b.userId)),D=gs(Object(a.a)({},E),{hasUnread:A.isUnread,isMuted:y});b=Object(a.a)(Object(a.a)({},b),D);const[,P]=Object(i.useState)(0),[w,L]=Object(i.useState)((()=>{let e=[];return Es&&null!=E&&E.userId&&(e=Es.getDownloadUploadOfConversation(E.userId,!1)),e})()),[x,U]=Object(i.useState)(null),[F,G]=Object(i.useState)(null),[B,j]=Object(i.useState)((()=>{let e=null;return c.c.noti_center_config.unread_react_in_conv&&(e=rs.a.getUnread(t.state.userId),e&&(f||e.conversationId!==b.userId||b.state&&!g.default.isBiggerReactionId(e.reactionId,E.lastSeenReactId))&&(e=null),e&&(e.senderName=k.default.getDName(e.userId)||"",e.isInit=!0)),e})()),[V,K]=Object(i.useState)(null),W=Object(i.useRef)(null),Y=Object(i.useRef)(null),z=Object(i.useRef)(!0),q=Object(i.useRef)(!1),X=Object(i.useRef)(null),J=Object(i.useRef)(f),$=Object(i.useRef)([]),Z=e=>{$.current=e,L(e)},ee=(e=200)=>{W.current||b.userId==h.CONV_FILTER.MEDIA||b.userId==h.CONV_FILTER.STRANGER||!b.previewMsgId&&!b.lastSmsLocalId||f||(W.current=setTimeout((()=>{var e;W.current=null,z.current&&(f||null===(e=M.b.messageCache)||void 0===e||e.loadCacheMessages(b))}),e))},te=Object(i.useCallback)(((e,t)=>{switch(e){case p.ChatBoxActions.DOWNLOAD_PROGRESS:{const{msgId:e,progress:s,conversationId:n}=t;let i=[];if(b.userId===n){i=$.current.filter((t=>t.msgId===e)).length>0?$.current.map((t=>t.msgId===e?Object(a.a)(Object(a.a)({},t),{},{progress:s}):t)):[...$.current,{msgId:e,progress:s}],Z(i)}break}case p.ChatBoxActions.NUMBER_DOWNLOAD_DONE:b.userId===t.conversationId&&U(Object(a.a)({},t));break;case p.FetchActions.DOWNLOAD_DONE:b.userId===t.conversationId&&U(null);break;case p.FetchActions.NEW_DOWNLOAD_DONE:if(b.userId===t.conversationId){const e=$.current.filter(((e,s)=>e.msgId!==t.msgId));Z(e)}break;case p.ChatBoxActions.UPLOAD_TOTAL_PROGRESS:b.userId===t.conversationId&&(!0===t.inProgress?G(t.progress):G(null))}}),[]),se=(e,t,s=!1)=>{if((a=navigator.userAgent.toLowerCase()).indexOf("safari")>=0&&a.indexOf("chrome")<0||s||1&t.buttons&&0==t.button){e.userId===h.CONV_FILTER.MEDIA||e.userId===h.CONV_FILTER.STRANGER?(e.userId===h.CONV_FILTER.STRANGER&&I.e.logAction(1453216),_(e.userId),t.preventDefault(),t.stopPropagation()):f?f&&!0===Q.default.isFriendCenterExist()?u&&u({type:p.SideBarActions.RESET_FRIEND_CENTER}):S||u({type:p.ConversationListActions.SELECT_CONV_MINOR,payload:e}):(m(e),t.preventDefault(),t.stopPropagation(),I.e.logAction(178001),e.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER&&I.e.logAction(16601));let s=O.default.getRatingData();s&&s.hasOwnProperty("content")&&setTimeout((()=>{H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.RATING,params:s}),O.default.setRatingData({})}),2e3)}var a},ae={userId:b.userId,avatar:b.avatar,isGroup:b.isGroup,topMember:b.topMember,totalMember:b.totalMember,defaultAvatar:b.defaultAvatar,displayName:b.displayName||b.zaloName},ne=e=>{l&&l(b,e),e.preventDefault(),e.stopPropagation()},ie=Object(i.useMemo)((()=>`conv-item conv-rel ${f?"selected":""} ${b.pinned?"pinned":""} `),[f,b.pinned,S,n]),oe=Object(a.a)({className:ie,onDoubleClick:r,onContextMenu:ne,onMouseEnter:()=>{ee()},onMouseLeave:()=>{W.current&&(clearTimeout(W.current),W.current=null)},onDragLeave:()=>{Y.current&&(g.default.log("dragOnIdHandler: clear timeout"),clearTimeout(Y.current),Y.current=null)}},(()=>{let e={},t=!1,s=0,a=0,n=!1;const i=e=>{e.preventDefault();let t=e.dataTransfer.getData("sourceconv");if(t&&b.pinned&&t!=b.userId){let s=parseInt(e.dataTransfer.getData("sourceconvts")),a=!1,n=null,i=null,o=(e,t)=>{e==h.CONV_FILTER.MEDIA?(a=!0,os.a.pinMediaBox(t)):(cs.a.pinConversation(e,t),n=e,i=t)};o(b.userId,s),o(t,b.pinned),cs.a.swapPin({id:b.userId,ts:s},{id:t,ts:b.pinned}),g.default.log("conversation-item: "+t);const r=document.getElementById(e.dataTransfer.getData("startNode")),l=(e=>{let t=e;for(;!t.draggable;)t=t.parentElement;return t})(e.target);((e,t)=>{if(!ps(e)||!ps(t))return void console.warn("conversation-item: startNode or endNode is not dom node type.");const s={ref:e,y:e.getClientRects()[0].y},a={ref:t,y:t.getClientRects()[0].y};s.ref.style.transition="all 0.2s ease-out",a.ref.style.transition="all 0.2s ease-out",s.ref.style.transform=`translateY(${a.y-s.y}px)`,a.ref.style.transform=`translateY(${s.y-a.y}px)`})(r,l),setTimeout((()=>{u(a?{type:p.ConversationListActions.UPDATE_CONVERSATION_PINNED,payload:{userId:n,pinned:i}}:{type:p.ConversationListActions.SWAP_PIN_CONVERSATION,payload:{source:t,target:b.userId}})}),200),((e,t,s)=>{ps(e)&&ps(t)?setTimeout((()=>{e.style.transition="all 0s ease-out",t.style.transition="all 0s ease-out",e.style.transform="translateY(0px)",t.style.transform="translateY(0px)",e.setAttribute("id","")}),s):console.warn("conversation-item: startNode or endNode is not dom node type.")})(r,l,200)}},o=e=>{e.dataTransfer.setData("startNode","start-node"),e.target.setAttribute("id","start-node"),e.dataTransfer.setData("sourceconv",b.userId),e.dataTransfer.setData("sourceconvts",b.pinned),e.dataTransfer.dropEffect="move"},r=e=>{q.current=(1==e.buttons||0==e.buttons)&&0==e.button,s=e.clientX,a=e.clientY,t=!1,n=!0},l=e=>{n&&(n=!1,t=!(Math.abs(e.clientX-s)<=1&&Math.abs(e.clientY-a)<=1))},c=e=>{t||se(b,e,q.current)};return b.pinned?(e.onDrop=i,e.onDragStart=o,e.onMouseDown=r,e.onMouseMove=l,e.onMouseUp=c,e.onDragEnter=e=>{e.preventDefault&&e.preventDefault()}):e.onMouseDown=e=>{se(b,e,!1)},e})()),re=Object(i.useCallback)((()=>{let e=null;if(b.previewStatus&&b.previewStatus===h.MSG_FAIL){e={sendFile:"STR_ERROR_SEND"}}return e}),[b.previewStatus]),le=Object(i.useCallback)((()=>{const e=b.previewMsgType;return Boolean(is.find((t=>t===e)))}),[b.previewMsgType]),ce=Object(i.useCallback)((e=>{e&&!J.current&&e.conversationId===b.userId&&(e.senderName=k.default.getDName(e.userId)||"",j(Object(a.a)({},e)))}),[]),de=Object(i.useCallback)((e=>{let t=B||{};e&&b.userId===e.convId&&!g.default.isBiggerReactionId(t.reactionId,e.lastSeenReactId)&&setTimeout((()=>{j(null)}),B?300:0)}),[]),he=Object(i.useCallback)((e=>{if(!e||!e.length)return void K(0);let t=e[e.length-1];K(t.urgency)}),[]);return Object(i.useEffect)((()=>{f&&b.draft&&b.draft.draftText&&u({type:p.ChatBoxActions.CONVERSATION_CHANGED,payload:{oldId:b.userId,draft:b.draft,draftMems:b.draftMems,offSelect:b.offSelect,attachedConv:null}})}),[f,b.draft]),Object(i.useEffect)((()=>{if(v.default.subscribe(te),c.c.noti_center_config.unread_react_in_conv&&(rs.a.addReactUnreadListener(ce),rs.a.addClearReactUnreadListener(de)),!c.c.noti_center_config.disable&&b){ls.a.subcribeUnread(b.userId,he);let e=ls.a.getUnread(b.userId);e&&he(e)}return()=>{z.current=!1,v.default.unsubscribe(te),rs.a.removeReactUnreadListener(ce),rs.a.removeClearReactUnreadListener(de),ls.a.unsubcribeUnread(b.userId,he)}}),[]),Object(i.useEffect)((()=>{n?ee(400):W.current=null}),[n]),Object(i.useEffect)((()=>{J.current=f}),[f]),Object(i.useEffect)((()=>{const e=()=>{P(Math.random()),g.default.log("[Conversation-Item]: Force re-render on change language.")};return T.default.callUpdate(e),()=>T.default.removeUpdate(e)}),[]),o.a.createElement(e,{ref:N,conv:b,container:oe,avatar:ae,title:us({displayName:b.displayName,isGroup:b.isGroup,userId:b.userId}),unread:A,isMute:y,tag:_s(b.userId),draft:Object(a.a)({isDraft:!f&&!A.sum&&b.draft},b.draft),isGroup:b.isGroup,isPin:Boolean(b.pinned),fileStatus:(()=>{let e=null,t=0,s="",a="";const n={margin:"3px 0 0 10px",backgroundColor:f&&"#ffff"};if(x)return t=x.fileDownloaded/x.total*100,s=`${x.fileDownloaded} / ${x.total} file`,a="STR_DOWNLOADING_GROUP_FILES",e={completed:t,text:s,textKey:a,addStyle:n},e;if(w.length>0){return t=w[w.length-1].progress,a="STR_DOWNLOADING",e={completed:t,text:s,textKey:a,addStyle:n},e}return F?(t=Math.ceil(Number(F))||0,a="STR_UPLOADING_FILE",e={completed:t,text:s,textKey:a,addStyle:n},e):null})(),isBlockedUser:ms(b.userId,b.blocked),errorStatus:re(),isMessageInfo:le(),reactionMsg:B,contentRef:X,needRefresh:R,handleContextMenu:ne})},Is=s("z5gp");const Ts=(e,t)=>{const{conv:s,container:n,avatar:r,title:l,unread:d,isMute:u,tag:_,draft:p,isGroup:g,isPin:f,fileStatus:I,isBlockedUser:v,errorStatus:R,isMessageInfo:S,reactionMsg:O,contentRef:N,needRefresh:b,handleContextMenu:C}=e,A=Object(i.useRef)({isFirstRender:!0,numReact:Number(Boolean(O)),numRemove:Number(!O)}),M=Object(i.useMemo)((()=>!(d.sum>0)&&d.recover),[d]),P=Object(i.useCallback)((({previewUrgency:e,previewUndo:t,previewMissCall:s,isUnread:a})=>p.isDraft?"":e&&a?"urgency":s&&a&&"miss-call"),[p]),w=Object(i.useMemo)((()=>{let e="conv-item-fadein",t="conv-item-fadeout",{isFirstRender:s,numReact:n,numRemove:i}=A.current;return n>0&&(e=""),i>0&&(t=""),s&&(e="",t=""),s||(O?(n+=1,i=0):(i+=1,n=0)),A.current=Object(a.a)(Object(a.a)({},A.current),{},{numReact:n,numRemove:i}),O?o.a.createElement("div",{className:`conv-unread-react truncate conv-item-transition--visible ${e}`,style:{alignItems:"center",maxHeight:"16px"}},te.a.getHtmlFromText(O.reactIcon,!1,null,{minWidth:"11px",maxWidth:"11px",height:"11px",marginRight:_?"9px":"4px",top:"0px"}),o.a.createElement("span",{className:"truncate",style:{marginRight:"2px"}},O.senderName)):o.a.createElement("div",{className:`conv-unread-react truncate conv-item-transition--visible ${t}`,style:{alignItems:"center",maxHeight:"0px"}})}),[O,A.current]),L=Object(i.useCallback)((()=>f?o.a.createElement("div",{className:"conv-action__pin conv__pinned"},o.a.createElement(D.a,{className:"icon-solid-pin"})):null),[f]),k=Object(i.useCallback)((()=>p.isDraft?o.a.createElement("span",{className:"warning"},T.default.str("STR_DRAFT")):null),[p]),x=Object(i.useCallback)((()=>R?o.a.createElement("span",{className:"warning"},T.default.str(R.sendFile)):null),[R]),U=(()=>{if(!d.isUnread)return null;const e=d.isExceed?"N":d.sum<=5?`${d.sum}`:"5plus",t=d.sum<=5;let n=d.isExceed?{width:"16px",height:"16px",marginTop:"2px"}:t?{width:"16px",height:"16px"}:{width:"22px",height:"16px"};return n=Object(a.a)(Object(a.a)({},n),{},{fontSize:d.isExceed?"8px":"9px",backgroundColor:u?"var(--neutral-600)":"var(--red-300)",color:"var(--white-300)",borderRadius:"8px",display:"flex",justifyContent:"center",alignItems:"center"}),c.c.draw_unread_icon||M?M?o.a.createElement("div",{className:"conv-action__unread flx"},o.a.createElement(D.a,{className:"red-dot-unread-mark conv--unreadMark ",style:{color:u&&"#abb4bc"}})):d.isExceed?o.a.createElement("div",{className:"conv-action__unread"},o.a.createElement("img",{src:ss.a.getUnreadBadge("N",16),style:{borderRadius:"10px"}})):o.a.createElement("div",{className:"conv-action__unread"},o.a.createElement("img",{src:ss.a.getUnreadBadge(d.sum,16,u?"var(--neutral-600)":null),style:{borderRadius:"10px"}})):o.a.createElement("div",{className:"conv-action__unread"},o.a.createElement("i",{className:"fa fa-num"+e+" conv-unread"+(s.userId===h.CONV_FILTER.STRANGER?" func-unread__stranger ":u?" func-unread__muted":""),style:n}))})()||L(),F=s.previewSendDttm||s.lastMessageTime;return Object(i.useEffect)((()=>{A.current=Object(a.a)(Object(a.a)({},A.current),{},{isFirstRender:!1})}),[]),o.a.createElement(y,{ref:t,innerRefs:{contentRef:N},itemProps:n,conv:r,title:l,bodyStyle:O?{marginBottom:"2px",marginTop:"2px"}:{marginTop:"4px"},isUnread:d.isUnread},o.a.createElement("status",null,v&&o.a.createElement("div",{className:"conv-block"},o.a.createElement(D.a,{className:"profile-icon-block"}))),o.a.createElement("titleMore",{customStyle:{lineHeight:"21px"}},o.a.createElement("div",{className:"flx flx-center"},u&&o.a.createElement(D.a,{className:"icon-solid-muted conv__mute"}),k()||x()||te.a.contextDate(F,{format:"time-range-year"}))),o.a.createElement("label",null,_&&o.a.createElement(es.a,{title:_.text,placement:"bottom-center"},o.a.createElement("div",{style:{color:_.color},className:"conv__label"},o.a.createElement(D.a,{className:"icon-solid-label-filled"})))),o.a.createElement("message",null,(I?o.a.createElement("div",{className:"progress-bar conv-message"},o.a.createElement("div",{className:"progress-tab-msg"},o.a.createElement(E.a,{textKey:I.textKey}),` ${I.text}`),o.a.createElement("div",{className:"progress-track",style:Object(a.a)({},I.addStyle)},o.a.createElement("span",{style:{width:`${I.completed}%`},className:"progress-fill"}))):null)||(({isGroup:e,draft:t,previewIcon:s,previewMessage:a,previewFromUid:n,previewDName:i,previewUrgency:r,previewUndo:l,previewMissCall:c})=>{let h=a||T.default.str("STR_NO_MESSAGES");t.isDraft&&(h=t.draftText);const u=P({previewUrgency:r,previewMissCall:c,isUnread:d.isUnread}),_=P({previewUndo:l,isUnread:d.isUnread});return o.a.createElement("div",{className:"conv-message truncate "+(d.isUnread||t.isDraft?"unread":"")},o.a.createElement("div",{className:"truncate flx",style:{alignItems:"center"}},((s="")=>o.a.createElement(ns,{className:s,isMessageInfo:S,isGroup:e,isDraft:null==t?void 0:t.isDraft,previewFromUid:n,previewDName:i}))(),((e="")=>{const a=t.isDraft?t.draftIcon:s;let n;return n=null!=a&&a.svgIcon?o.a.createElement(Is.a,{icon:a.svgIcon,size:"xs"}):o.a.createElement(D.a,{className:a}),a&&o.a.createElement("span",{className:`${e} message__icon`},n)})(u),((e="")=>{const t="string"==typeof h?m.b.parseTextEmoticonv2(h):"";if(t){const e=t.map((e=>{var t;const s=(null===(t=e.data)||void 0===t?void 0:t.toLowerCase())||"";if(e.type===m.a.EMOJI_TOKEN_V2){const t=ts.a.renderUnicodeEmoji(s,e.key,{margin:"0px",marginBottom:"-3px",position:"relative",width:"16px",height:"16px"});return o.a.createElement("div",{style:{display:"inline"},key:e.key},t)}return e.data}));h=e}else h=t;return o.a.createElement("span",{className:"truncate"},o.a.createElement("span",{className:`${e}`},h))})(_)))})({isGroup:g,previewIcon:s.previewIcon,previewMessage:s.previewMessage||s.lastMessage,previewFromUid:s.previewFromUid||s.lastMessageUidFrom,previewDName:s.previewDName||s.lastMessageDname,previewUrgency:s.previewUrgency||s.urgency,draft:p,previewUndo:s.previewUndo,previewMissCall:s.previewMissCall})),o.a.createElement("reaction",null,w),o.a.createElement("moreAction",{className:M?"markUnread":"hasOption"},U),o.a.createElement("setting",{customStyle:O&&{alignItems:"center"}},s.userId===h.CONV_FILTER.STRANGER?null:o.a.createElement("div",{className:" conv-action__menu",onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},style:O?{marginTop:"10px"}:{marginBottom:"10px"},onClick:C},o.a.createElement(D.a,{className:"icon-solid-more conv-setting__icon"}))))},vs=o.a.memo(Object(i.forwardRef)(Ts));vs.propTypes={conv:l.a.object.isRequired,container:l.a.object,avatar:l.a.object.isRequired,title:l.a.string.isRequired,unread:l.a.object,isMute:l.a.bool,tag:l.a.object,draft:l.a.object,isGroup:l.a.bool,isPin:l.a.bool,fileStatus:l.a.object,handleContextMenu:l.a.func};var Rs=Object(L.sidebarConnect)(((e,t)=>{if(h.FILTER_CONV_TEXT.includes(t.convId))return{state:t.state};return{state:t.convId&&Object(w.getConversationByIdSelector)(t.convId)(e)||t.state}}),void 0,void 0,{forwardRef:!0})(fs(vs)),Ss=s("L+5E"),Os=s("1Abx"),Ns=s("c7k8"),bs=s("k82f");const Cs=Object.freeze({CONTACT:"DATA_LIST_TYPE_CONTACT",CONVERSATION:"DATA_LIST_TYPE_CONVERSATION",GROUP:"DATA_LIST_TYPE_GROUP",SEARCH:"DATA_LIST_TYPE_SEARCH",SEARCH_FILTER:"DATA_LIST_TYPE_SEARCH_FILTER"});class As{constructor(e){this.data=e,this.type=1}}class ys{constructor(e){this.type=0,this.data=e}}const Ds={overflowX:!1,overflowY:!1,position:"absolute",willChange:"transform"};class Ms extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"getScrollTop",(()=>this._scrollOffset)),Object(n.a)(this,"getClientHeight",(()=>this._clientHeight)),Object(n.a)(this,"getItems",(()=>this.props.items)),Object(n.a)(this,"getFocusedItem",(()=>this.props.items[this._focusedIndex])),Object(n.a)(this,"getFocusedIndex",(()=>this._focusedIndex)),Object(n.a)(this,"isAtBottom",(()=>this._scrollOffset+this._clientHeight>=this._scrollHeight)),Object(n.a)(this,"isAtTop",(()=>this._scrollOffset<=0)),Object(n.a)(this,"setFocusedIndex",(e=>{this._focusedIndex=e,this.forceUpdate()})),Object(n.a)(this,"moveFocusUp",(()=>{let e=this._getPrevDataItemFromIndex(this._focusedIndex-1);return-1===e&&(e=this._getPrevDataItemFromIndex(this.props.items.length-1)),-1!==e&&(this.scrollToItem(e),!0)})),Object(n.a)(this,"moveFocusDown",(()=>{let e=this._getNextDataItemFromIndex(this._focusedIndex+1);return-1===e&&(e=this._getNextDataItemFromIndex(0)),-1!==e&&(this.scrollToItem(e),!0)})),Object(n.a)(this,"scrollTop",(e=>{this._useScrollbar((t=>{t.scrollTop(e)}))})),Object(n.a)(this,"scrollToTop",((e=!0)=>{e&&this.setFocusedIndex(0),this._useScrollbar((e=>{e.scrollToTop()}))})),Object(n.a)(this,"scrollToBottom",(()=>{this._useScrollbar((e=>{e.scrollToBottom()}))})),Object(n.a)(this,"scrollToConversationById",(e=>{const t=this.props.items.findIndex((t=>t.userId===e));this.scrollToItem(t)})),Object(n.a)(this,"scrollToItem",(e=>{if(e<0||e>this.props.items.length)return;let t=this._getItemOffset(e);this._scrollOffset=t,this._scrollNeeded=!0,this.setFocusedIndex(e),this._currentScrollReq=this._requestAnimationOrSetTimeout((()=>this._smartScroll(this._scrollOffset)),100)})),Object(n.a)(this,"_smartScroll",(e=>{if(this._isListAtOffset(e))return this._cancelTimeoutRequest(this._currentScrollReq),void(this._scrollNeeded=!1);this.scrollTop(this._scrollOffset)})),Object(n.a)(this,"_isListAtOffset",(e=>{let t=this._listRef.current;return!!t&&t.Grid.state.scrollTop===e})),Object(n.a)(this,"_cancelTimeoutRequest",(e=>{clearTimeout(e)})),Object(n.a)(this,"_requestAnimationOrSetTimeout",((e,t)=>e?setTimeout((()=>e()),t):null)),Object(n.a)(this,"_handleScroll",(e=>{const t=e.target;t&&(this._scrollOffset=t.scrollTop,this._scrollHeight=t.scrollHeight);const s=this._listRef.current;if(!s)return;if(0!==this._scrollHeight)s.Grid.handleScrollEvent({scrollTop:e.target.scrollTop});else{let e=this._getItemOffset(this._focusedIndex);s.Grid.handleScrollEvent({scrollTop:e})}const a=this.props.onScroll;"function"==typeof a&&a()})),Object(n.a)(this,"_handleResize",(e=>{this._clientHeight=e.height})),Object(n.a)(this,"_getItemHeight",(({index:e})=>this._recomputeRowHeight(this.props.items[e]))),Object(n.a)(this,"_getItemOffset",(e=>{let t=0;for(let s=0;s<e;s++)t+=this._getItemHeight({index:s});return t})),Object(n.a)(this,"_renderRow",(({index:e,style:t})=>{const s=this.props.items[e].pinned>0,a=this._getDataId(e,s);let n="msg-item ";s&&(n+=" pinned");const i=this._renderItem(e,t);return o.a.createElement("div",{key:e,className:n,style:t,"data-id":a},i)})),Object(n.a)(this,"_renderScrollbar",(({style:e})=>o.a.createElement("div",{style:Object(a.a)(Object(a.a)({},e),{},{width:"8px",borderRadius:"3px",margin:"0 2px",backgroundColor:"var(--neutral-500)",opacity:.5,right:"3px"})}))),this._focusedIndex=-1,this._scrollOffset=0,this._scrollHeight=0,this._clientHeight=0,this._totalRowsHeight=0,this._scrollNeeded=!1,this._isFireFoxBrowser=g.default.isFireFox(),this._listRef=o.a.createRef(),this._scrollbarRef=o.a.createRef(),this._currentScrollReq=null,this._recomputeTotalRowsHeight(e)}componentDidMount(){this._scrollFocusedIndex()}componentWillReceiveProps(e){this._scrollNeeded&&(this._cancelTimeoutRequest(this._currentScrollReq),this._currentScrollReq=this._requestAnimationOrSetTimeout((()=>this._smartScroll(this._scrollOffset)),200)),this._scrollFocusedIndex(e)}shouldComponentUpdate(e){const t=this.props.currentConv!==e.currentConv;let s=!g.default.shallowEqual(this.props.items,e.items);return s=s||t,s&&(this._recomputeTotalRowsHeight(e),this._recomputeRowHeights()),s}_scrollFocusedIndex(e=null){let t=e||this.props;t&&t.scrollToSelected&&"number"==typeof t.focusedIndex&&this._focusedIndex!==t.focusedIndex&&(this._focusedIndex=t.focusedIndex,this.scrollToItem(this._focusedIndex))}_getNextDataItemFromIndex(e){for(let t=e;t<this.props.items.length;t++){if(this.props.items[t]instanceof ys)return t}return-1}_getPrevDataItemFromIndex(e){for(let t=e;t>-1;t--){if(this.props.items[t]instanceof ys)return t}return-1}_useScrollbar(e){const t=this._scrollbarRef.current;t&&e(t)}_recomputeRowHeight(e){if(e){if(e.isBanner)return 53;if(!e.data)return h.CONVERSATION_ITEM_HEIGHT;if(e.data.height)return e.data.height;switch(e.data.key){case"top_label":return 37;case"top_banner":return 72;case"empty_conv":return 200}}return 0}_recomputeRowHeights(){const e=this._listRef.current;e&&e.recomputeRowHeights()}_recomputeTotalRowsHeight(e){let t=0,s=e.items.length;for(let a=0;a<s;a++)t+=this._recomputeRowHeight(e.items[a]);this._totalRowsHeight=t}_recomputeScrollbarWidth(){this._isFireFoxBrowser&&this._totalRowsHeight>this._clientHeight?this._scrollbarWidth=16:this._scrollbarWidth=0}_renderItem(e){let t=this.props.renderItem(e,this.props.items[e],e===this._focusedIndex,this.setFocusedIndex.bind(this,e));if(e===this._focusedIndex&&t){let s=this.props.getItemKey(this.props.items[e]);null==s&&g.default.logCoreError("data-list: unable to get key for selected item. Please pass in props getItemKey "),t.props&&(t=o.a.createElement(t.type,Object(d.a)({},t.props,{key:s})))}return t}_getDataId(e,t){return"-1000"===this.props.items[e].userId?"div_TabMsg_ThrdChFrdReq":0===this.props.items[e].isFr&&this.props.items[e].isStranger?"div_TabMsg_ThrdChStranger":t?"div_TabMsg_ThrdChFileXFER":"div_TabMsg_ThrdChItem"}render(){const e=this.props.items.length;return o.a.createElement(ae.a,null,o.a.createElement(Ns.a,{onResize:this._handleResize},(t=>{const s=this.props,{onScroll:n}=s,i=Object(ne.a)(s,["onScroll"]);return o.a.createElement(bs.Scrollbars,{ref:this._scrollbarRef,autoHide:!1,className:"virtualized-scroll",style:{height:t.height,width:t.width},renderThumbVertical:this._renderScrollbar,onScroll:this._handleScroll},o.a.createElement(Ns.d,Object(d.a)({},i,{id:this.props.domId,ref:this._listRef,estimatedRowSize:h.CONVERSATION_ITEM_HEIGHT,overscanRowCount:5,tabIndex:-2,style:Object(a.a)(Object(a.a)({},Ds),{},{height:this._totalRowsHeight,width:t.width}),rowCount:e,height:t.height,width:t.width,rowHeight:this._getItemHeight,rowRenderer:this._renderRow})))})))}}Ms.propTypes={items:l.a.array.isRequired,renderItem:l.a.func.isRequired,initialLength:l.a.number.isRequired,getItemKey:l.a.func.isRequired};var Ps=Ms,ws=s("V035");class Ls extends o.a.Component{constructor(e){super(e)}shouldComponentUpdate(e,t){return!1}sendInvite(e,t=""){v.default.send(p.SideBarActions.SEND_INVITATION,{target:e,message:t,link:`https://${c.c.CONFIG_DOMAIN}/may-tinh`})}doAction(){H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.SHARE_MSG_COMPOSE,params:{disablePcUser:!0,disableGroup:!0,title:"Mời thêm bạn dùng Zalo Máy Tính",callback:this.sendInvite.bind(this)}})}getOffsetTop(){return this.mainView?this.mainView.offsetTop:null}getOffsetHeight(){return this.mainView?this.mainView.offsetTop:null}_onContextMenu(e){this.props.showContextMenu&&this.props.showContextMenu({isBanner:!0},{clientX:e.clientX,clientY:e.clientY,stopPropagation:()=>{},preventDefault:()=>{}}),e.preventDefault(),e.stopPropagation()}render(){return o.a.createElement("div",{className:"invite-banner",onClick:this.doAction.bind(this),ref:e=>this.mainView=e},o.a.createElement("img",{src:"assets/icon-invite.81f31568d368e0c209ffe2860966cad3.png",className:"invite-banner-thumb"}),o.a.createElement("div",{className:"invite-banner-content"},"Mời đồng nghiệp"),o.a.createElement("i",{className:"fa fa-chat-menu-more-hover invite-action-btn",onClick:e=>this._onContextMenu(e)}))}}var ks=Ls,xs=s("kPvD"),Us=s("NMlV"),Fs=s("ZRfj"),Gs=s("M7kw"),Bs=s("kg13"),Hs=s("smi1"),js=s("CCx4"),Vs=s("VTLO"),Ks=s("jnrz"),Ws=s("7n8r"),Ys="assets/icon-other-empty-chat.7ba46325d52744016c8300696654d70d.png",zs=s("EqtE"),qs=s("cLOQ");var Xs=function(e){Object(d.a)({},e);const[t,s]=o.a.useState(1);o.a.useEffect((()=>(window.addEventListener("resize",a),a(),()=>{window.removeEventListener("resize",a)})));const a=o.a.useCallback((()=>{let e=document.getElementById("conv-skeleton");if(e){let t=e.clientHeight;s(Math.floor(t/72))}})),n=o.a.useMemo((()=>{let e=[];for(let s=0;s<t;s++)e.push(o.a.createElement("div",{className:"sk-item flx flx-al-c",key:`ske-${s}`},o.a.createElement("div",{className:"sk-avatar loadingDefault"}),o.a.createElement("div",{className:"flx-1"},o.a.createElement("div",{className:"sk-name loadingDefault loadingMediaText"}),o.a.createElement("div",{className:"sk-msg loadingDefault loadingMediaText"}))));return e}),[t]);return o.a.createElement("div",{className:"w100 flx-1",id:"conv-skeleton"},n)};const Js="1",Qs="last_sc",$s="conversationList";let Zs=null,ea=!0;const ta=-3e3,sa=-100,aa=-400,na="z_sendtome_bubbledot_";let ia=null;g.default.isWeb()||(ia=s("vbkW"));let oa=0,ra=0,la={};const ca={};let da=null;class ha extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"_handleScroll",(()=>{this._dataListRef.current&&this._dataListRef.current.isAtTop()?this._inTopScroll=!0:this._inTopScroll=!1,this.conversationAction&&this.conversationAction.close()})),Object(n.a)(this,"_onBlur",(()=>{this.setFocusedIndex(-1)})),Object(n.a)(this,"_onFocus",(()=>{if(this._dataListRef.current){const e=this.getConversations();for(let t=0;t<e.length;t++){if(e[t].userId===this.props.state.currentId){this.setFocusedIndex(t);break}}}})),this._isFirstTime=!0,this._inTopScroll=!0,this._autoFocus=!0,this._startIndex=null,this.fetcher=B.default,this.dragCount=0,this.oldCurrentConv=null,this._lastSelectedConv=null,this._mapFlagNotify={},this._selectConversation=this._selectConversation.bind(this),this.deleteConversation=this.deleteConversation.bind(this),this._getCurrentMediaBoxList=this._getCurrentMediaBoxList.bind(this),this._focusInputBox=this._focusInputBox.bind(this),this.dragOnIdHandler=this.dragOnIdHandler.bind(this),this._onDeleteDragOnId=this._onDeleteDragOnId.bind(this),this._renderItem=this._renderItem.bind(this),this.viewGroup=this.viewGroup.bind(this),this.onLoadFriendSuggestion=this.onLoadFriendSuggestion.bind(this),this._newMessageConvs=[],g.default.log("conversation-list: constructor"),this.haveFiendConversations=!1;let t=0;const s=this.getConversations();if(s&&s.length>0&&this.props.state.currentId)for(let n=0;n<s.length;n++){let e=s[n];if(e.userId==this.props.state.currentId){g.default.isInMediaBox(e)?t=-2e3:this._isInStrangerBox(e)&&(t=ta),g.default.log("conversation-list: set _startIndex = "+n+" current id = "+this.props.state.currentId);break}}let a={};0!==t&&(a[t]=t),this.state={showAction:!1,group:a,triggerUpdate:!1,shouldShowShortConversationList:c.c.enableFriendSuggestion&&Date.now()-ra>c.c.suggestionShowInterval,suggestFriendItem:[],friendCenterOnTop:!1,filter:h.CONV_FILTER.ALL},this.eventHandler=(e,t)=>{switch(e){case p.SideBarActions.UPDATE_FRIEND_SUGGESTION_LIST:t&&"remove"===t.type&&this.onRemoveSuggestFriend(t.userId,t.onSuccess);break;case p.ChatBoxActions.SEND_FRIEND_REQUEST:t&&this.onRemoveSuggestFriend(t);break;case p.FetchActions.FRIENDS_FETCHED:if(t&&this.state.suggestFriendItem){let e=this.state.suggestFriendItem.filter((e=>!t.hasOwnProperty(e.userId)));this.setState({suggestFriendItem:e})}break;case p.ConversationListActions.SYNC_PIN_CONVERSATION:t&&this.props.dispatch({type:p.ConversationListActions.PIN_CONVERSATION,payload:t});break;case p.ConversationListActions.CREATE_PIN_CONVERSATION_EMPTY:t&&this.props.dispatch({type:p.FetchActions.ADD_MESSAGES,payload:t});break;case p.ConversationListActions.ONOFF_FRIEND_CENTER:this.setState({triggerUpdate:!this.state.triggerUpdate});break;case p.ConversationListActions.FRIEND_CENTER_CHANGE:t&&("new_friend"===t.act||"remove_friend"===t.act?this.checkFriendLimit():"update_suggestion"===t.act&&this.onLoadFriendSuggestion());break;case p.ConversationListActions.RELOAD_CONVERSATION_LIST:this._getListConversation();break;case p.ConversationListActions.DEL_ALL_CONVERSATION_HIDDEN:if(t&&t.constructor==Array){const e=this.getConversations();if(this.props.state&&e){let s=e.filter((e=>t.includes(e.userId)));for(let e of s)this.deleteConversation(e.userId,!1)}}break;case p.FetchActions.FETCH_CONVERSATION_SETTINGS:t&&t.userId&&t.setting&&this.props.dispatch({type:p.ConversationListActions.UPDATE_CONVERSATION_SETTINGS,payload:t});break;case p.ConversationListActions.SELECT_CONVERSATION:t&&t.needScroll&&requestAnimationFrame((()=>{this._dataListRef.current&&this._dataListRef.current.scrollToConversationById(t.userId)}))}},this._showItemContextMenu=this._showItemContextMenu.bind(this),this._handleResize=this._handleResize.bind(this),this._dataListRef=o.a.createRef()}isValidFriend(e){return!(!this.props.user||this.props.user.userId!=e)}_showItemContextMenu(e,t){if(e&&e.friendItem)this.friendAction&&this.friendAction.showActionForFriend(t,e);else if(e&&!g.default.isFakeId(e.userId)){let s=Object(a.a)({},t);this.setState({selectedConversation:e,showContextEvent:s},(()=>{this.conversationAction&&this.conversationAction.showAction(s)}))}}deleteMediaBox(){P.a.openConfirm({windowId:Js,name:h.MODAL_CONFIRM.confirmIdentities,params:{message:T.default.str("STR_CONV_DEV_CONFIRM2")+" ",okText:T.default.str("STR_YES"),cancelText:T.default.str("STR_NO"),onOk:()=>{let e=this._getCurrentMediaBoxList();os.a.setMediaBoxInfo({}),this.props.dispatch({type:p.ConversationListActions.DELETE_MEDIA_BOX,payload:e}),e&&e.constructor==Array&&e.forEach((e=>{e&&Hs.a.deleteConversation(e.userId)})),O.default.deleteAllMediaBox(e).then((e=>{})).catch((e=>{g.default.logCoreError(e),R.a.createError(T.default.str("STR_TOAST_ERROR"))}))}}})}deleteConversation(e,t=!0){e!=h.CONV_FILTER.STRANGER&&(g.default.logCoreError(`[user call del conv] ${e}`),Hs.a.deleteConversation(e,t?this.props.confirm:null).then((e=>{e&&e.delConversationId&&(this.props.dispatch({type:p.ConversationListActions.TAG_CONV,payload:{data:[{userId:e.delConversationId,label:null}]}}),this.props.dispatch({type:p.FetchActions.DELETE_CONVERSATION,payload:e.delConversationId}))})).catch((e=>{g.default.logCoreError("Delete conversation fail - "+JSON.stringify(e))})))}pressEsc(){!this.state.filter===h.CONV_FILTER.ALL&&this.viewGroup("")}_focusConversationList(){this._conversationListRef&&this._conversationListRef.focus()}_handleKeyEvent(e){switch(e.keyCode){case h.K_PAGEUP:if(e.ctrlKey||e.metaKey||e.altKey)break;case h.K_UP:let t=this.getFocusedIndex()||0;c.c.messageBanner&&t--,t<=0?v.default.send(p.SideBarActions.FOCUS_SEARCH_INPUT):this.moveUp(!1);break;case h.K_PAGEDOWN:if(e.ctrlKey||e.metaKey||e.altKey)break;case h.K_DOWN:this.moveDown(!1);break;case h.K_SPACE:break;case h.K_ENTER:case h.K_HOME:this.scrollToTop(!1);break;case h.K_END:this._dataListRef.current&&this._dataListRef.current.scrollToBottom()}}getFocusedItem(){return this._dataListRef.current?this._dataListRef.current.getFocusedItem():null}_onDeleteDragOnId(){null!=this.dragOnId&&(g.default.log("_onDeleteDragOnId",this.dragOnId),delete this.dragOnId)}componentWillMount(){if(this.contactArr=[],g.default.log("[MsgTab] mount msg item"),document.addEventListener("dragend",this._onDeleteDragOnId,!1),document.addEventListener("drop",this._onDeleteDragOnId,!1),ea){let e=this._getQueryParams();if(e.c){const t=e=>{const t={[e]:!0};this._querySelect=()=>{let s;s=e.startsWith(h.GROUPID_PREFIX)?this.fetcher.fetchGroupsIfNotExpire(t):this.fetcher.fetchFriendsIfNotExist(t),s.then((t=>{t&&t[e]?this.props.selectConversationForFriend(t[e]):g.default.logCoreError("conversation-list: friend with id "+e+" does not exist")})).catch((e=>{g.default.logCoreError(e)}))}},s=e.c;e.convert?this.fetcher.convertOAIds([s]).then((e=>{e&&e[s]&&t(e[s])})):t(s),ea=!1}else if(e.g)Ss.a.autoSelectGroupByLink(`https://${c.c.CONFIG_DOMAIN}/g/`+encodeURIComponent(e.g));else if(e.zs);else if(e.phone){let t=e.phone,s=e.openConv;!t||isNaN(t)||this._querySelect||(this._querySelect=()=>{s?Ss.a.autoOpenConversationByPhone(t,this.props.dispatch):Ss.a.autoSelectConversationByPhone(t,this.props.dispatch)})}else if(e.alias){let t=e.alias;this._querySelect||(this._querySelect=()=>{Ss.a.autoSelectConversationByAlias(t,this.props.dispatch,this.props.state?this.props.state.contacts:{})})}}}_getLastSelectedConversationId(){return window.localStorage.getItem(Qs+this.props.user.userId)}selectFocusedConversation(){let e=this.getFocusedItem();return e?e.isBanner?(H.a.openModal({windowId:Js,name:h.ModalIdentitiesDefine.SHARE_MSG_COMPOSE,params:{disablePcUser:!0,disableGroup:!0,title:"Mời thêm bạn dùng Zalo Máy Tính",callback:(e,t="")=>{v.default.send(p.SideBarActions.SEND_INVITATION,{target:e,message:t,link:`https://${c.c.CONFIG_DOMAIN}/may-tinh`})}}}),null):(this._selectConversation(e),e.userId):null}selectNextConversation(e){const t=this.getConversations();if(t)for(let s=0;s<t.length;s++){let a=t[s];if(!this._isInStrangerBox(a)&&!g.default.isInMediaBox(a)&&(a.userId===this.props.state.currentId||null==this.props.state.currentId)){let a=s+(null==this.props.state.currentId?0:e);for(;a>=0&&a<t.length;){let s=t[a];if(!(s&&this._isInStrangerBox(s)||g.default.isInMediaBox(s))){this._selectConversation(s,!1,!0);break}a+=e}break}}}moveUp(e=!0){this._dataListRef.current&&this._dataListRef.current.moveFocusUp()&&e&&this._focusConversationList()}scrollToTop(e=!0){this._dataListRef.current&&(this._dataListRef.current.scrollToTop(),this._newMessageConvs=[],e&&this._focusConversationList())}moveDown(e=!0){this._dataListRef.current&&(this._dataListRef.current.moveFocusDown(),e&&this._focusConversationList())}_setLastSelectedconversationId(e){window.localStorage.setItem(Qs+this.props.user.userId,e)}shouldComponentUpdate(e,t){let s=this.state.filter!==t.filter;s&&delete this.filterConversationList;let a=!g.default.arraysEqual(e.state.conversations,this.props.state.conversations)||e.state.toggleUpdateFriendCenter!==this.props.state.toggleUpdateFriendCenter||e.state.currentId!==this.props.state.currentId||e.state.firstFetchDone!==this.props.state.firstFetchDone||e.isEnable!==this.props.isEnable||e.selectedId!==this.props.selectedId||t.showAction!==this.state.showAction||this.state.group!==t.group||this.state.selectedConversation!=t.selectedConversation||this.state.showContextEvent!=t.showContextEvent||this.state.triggerUpdate!==t.triggerUpdate||this.props.friendRequests!==e.friendRequests||this.state.shouldShowShortConversationList!==t.shouldShowShortConversationList||this.state.suggestFriendItem!==t.suggestFriendItem||this.props.needRefresh!==e.needRefresh||this.state.friendCenterOnTop!==t.friendCenterOnTop||this.props.currentTab!==e.currentTab||s;return a&&(this.state.filter!==h.CONV_FILTER.ALL&&t.filter===h.CONV_FILTER.ALL?this._preventHightLight=!0:this.props.state.currentId!=e.state.currentId&&(this._preventHightLight=!1)),this._lastSelectedConv!==this.props.state.currentId&&1==this.props.isEnable&&e.isEnable&&(this._lastSelectedConv=this.props.state.currentId),this._needScrollToSelected=!1,0==this.props.isEnable&&1==e.isEnable&&e&&e.selectedId&&this._lastSelectedConv!==this.props.state.currentId&&this._lastSelectedConv!==e.selectedId&&(this._lastSelectedConv=e.selectedId,this._needScrollToSelected=!0),g.default.log("conversation-list: should update "+a),this.props.state.contacts!==e.state.contacts&&(this.needUpdateFriendCenterItem=!0),a}componentWillUnmount(){document.removeEventListener("dragend",this._onDeleteDragOnId,!1),document.removeEventListener("drop",this._onDeleteDragOnId,!1),window.removeEventListener("resize",this._handleResize),v.default.unsubscribe(this.eventHandler),Bs.a.removeUpdateSuggestionCallback(this.onLoadFriendSuggestion)}componentDidMount(){v.default.subscribe(this.eventHandler),this.componentDidUpdate({},{}),window.addEventListener("resize",this._handleResize),this.checkFriendLimit(),this.onLoadFriendSuggestion(),Bs.a.setUpdateSuggestionCallback(this.onLoadFriendSuggestion)}onLoadFriendSuggestion(){const e=e=>{this.setState({suggestFriendItem:e.map((e=>e.dataInfo))})};let t=Bs.a.getListRecommendedFriend(!0,!1,!1);t&&(t.constructor===Promise?t.then((t=>{e(t)})):t.constructor===Array&&e(t))}checkFriendLimit(){let e=Object.keys(this.props.state.contacts);e=e.filter((e=>e!==c.c.sendToMeId));let t=c.c.limit_friend>=e.length;Q.default.setUnderFriendLimit(t),this.setState({friendCenterOnTop:t})}_handleResize(e){this.setState({triggerUpdate:!this.state.triggerUpdate})}getRefOfDataListComponent(){return this._dataListRef.current?this._dataListRef.current:null}focusList(){this._conversationListRef&&this._conversationListRef.focus()}_clearStrangerUnreadCount(){const e=this.getConversations();if(!e)return;let t={},s=0;for(let a=0;a<e.length;a++){let n=e[a];this._isInStrangerBox(n)&&n.strangerUnreadCount&&(t[n.userId]=!0,s++,O.default.updateConversation({userId:n.userId,strangerUnreadCount:0},["strangerUnreadCount"]))}s>0&&this.props.dispatch({type:p.ConversationListActions.CLEAR_STRANGER_UNREAD,payload:t})}componentDidUpdate(e,t){var s,a;if(this._draftSortConversations=!1,this._autoFocus&&document.activeElement&&document.activeElement.constructor===HTMLBodyElement&&this._dataListRef.current){let e=document.getElementById($s);e&&requestAnimationFrame((()=>{e.focus(),this._autoFocus=!1}))}requestAnimationFrame((()=>{this._conversationListRef&&(this._conversationListRefHeight=this._conversationListRef.clientHeight)})),null!==(s=t.group)&&void 0!==s&&s.hasOwnProperty(ta)||null===(a=this.state.group)||void 0===a||!a.hasOwnProperty(ta)||this._clearStrangerUnreadCount(),e.state&&(!e.state.conversations||0==e.state.conversations.length)&&this.props.state.conversations&&this.props.state.conversations.length>0&&Object(ws.b)(this.props.state.conversations),!0===this.needUpdateFriendCenterItem&&(this.needUpdateFriendCenterItem=!1,this.checkFriendLimit())}_getQueryParams(){let e={},t=window.location.search;if(t=t?t.substr(1).split("&"):null,t)for(let s=0;s<t.length;s++){let a=t[s].indexOf("=");if(a>=0){let n=t[s].slice(0,a),i=t[s].slice(a+1,t[s].length);n&&n.length>0&&i&&i.length>0&&(e[n]=decodeURIComponent(i))}}return e}_handleOffShowNewMessage(e,t){switch(e){case"ADD":this._newMessageConvs=[...this._newMessageConvs,...t];break;case"REMOVE":let e=[];for(let s=0;s<t.length;s++)e=this._newMessageConvs.filter((e=>e!==t[s]));this._newMessageConvs=e}}componentWillReceiveProps(e){if(0!=e.state.conversations.length&&null!=e.state.currentId||g.default.throttle((()=>{H.a.openModal({windowId:Js,name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:null})}),500),this.props.state.conversations&&e.state.conversations&&this.props.state.conversations!==e.state.conversations&&this.props.state.conversations.length>0&&e.state.conversations.length>0){let t=e.state.conversations[0],s=this.props.state.conversations[0];e.state.currentId===t.userId||!(t.userId!==s.userId&&t.smsUnreadCount>0||t.userId==s.userId&&t.lastSmsLocalId!==s.lastSmsLocalId)||"0"==t.lastMessageUidFrom||t.muted||se.a.isThreadHidden(t.userId)||this._dataListRef.current&&this._dataListRef.current.getScrollTop()>=65&&this._handleOffShowNewMessage("ADD",[t.userId]);const a=e.state.conversations;let n=[];for(let e=0;e<a.length;e++)0===a[e].smsUnreadCount&&this._newMessageConvs.includes(a[e].userId)&&n.push(a[e].userId);n.length>0&&this._handleOffShowNewMessage("REMOVE",n)}this.props.state.toggleDraftSorted!=e.state.toggleDraftSorted&&(this._draftSortConversations=!0),c.c.enableFriendSuggestion&&!this.state.shouldShowShortConversationList&&Date.now()-ra>c.c.suggestionShowInterval&&(la={},this.setState({shouldShowShortConversationList:!0}));let t=!0;Object.values(h.FAKE_CONVERSATION_ID).forEach((s=>{e.state.currentId===s&&(t=!1)})),this.oldCurrentConv=t?e.state.currentId:this.oldCurrentConv}_focusInputBox(e){v.default.send(p.ChatBoxActions.FOCUS_INPUT,{userId:e})}_selectConversation(e,t,s=!1){let n={name:this.props.currentTab,userId:e.userId};if(N.a.setOldTab(n),J.b.startPerf(J.a),this._preventHightLight=!1,e.userId===h.CONV_FILTER.STRANGER){let e={};return e[-400]=aa,void this.viewGroup(this.state.filter,e)}if(e.data&&e.data.friendItem)return;let i=this.props.state.conversations;i&&(i=i.filter((e=>!!e&&this.isValidConversation(e.userId))));for(let a=0;a<i.length;a++){let t=i[a];if(t&&!0===t.isGroup){let e=t.userId;e.startsWith(h.GROUPID_PREFIX)&&(e=e.slice(1))}if(t.userId===e.userId){let e=a+(this.hasBanner?1:0);if(this.displayConversations)for(let s=0;s<this.displayConversations.length;s++){let a=this.displayConversations[s];if(a&&a.userId===t.userId){e=s;break}}this.setFocusedIndex(e,s);break}}if(e&&e.userId===this.props.state.currentId&&e.userId!==h.FAKE_CONVERSATION_ID.FRIEND_CENTER)this._focusInputBox(e.userId),this.props.dispatch({type:p.ConversationListActions.SELECT_CONV_MINOR,payload:e});else if(this._focusConversationList(),e&&e.userId===c.c.sendToMeId&&(wt.f.getFlag(this.props.user.userId,na)||(Q.default.getHasShownSendToMeTip()?wt.f.setFlag(this.props.user.userId,na,1):setTimeout((()=>{v.default.send(p.ConversationListActions.SHOW_BUBBLE_DOT),Q.default.setHasShownSendToMeTip(!0)}),144e5)),Gs.c.getCurrentStepKey()!==Gs.a.UPLOAD_IMAGES||e.lastType!==h.MSG_ECARD||this._showedOnboarding||(Gs.c.show(),this._showedOnboarding=!0),I.e.logAction(13901)),e&&e.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER){const t=()=>{this.props.dispatch({type:p.SideBarActions.SELECT_FRIEND_CENTER,payload:Object(a.a)(Object(a.a)({},e),{},{smsUnreadCount:0})})};O.default.updateConversation({userId:e.userId,smsUnreadCount:0,smsUnreadNotCount:0},["smsUnreadCount"]).then((e=>{t()})).catch((e=>{t()}))}else this.props.dispatch({type:p.ConversationListActions.SELECT_CONVERSATION,payload:e});t||this._setLastSelectedconversationId(e.userId);let{filter:o,group:r}=this.state;o===h.CONV_FILTER.UNREAD?(I.e.logAction(1453103),g.default.isEmptyObject(r)||I.e.logAction(1453107)):o===h.CONV_FILTER.ALL&&(I.e.logAction(1453104),g.default.isEmptyObject(r)&&I.e.logAction(1453108)),g.default.isEmptyObject(r)?I.e.logAction(1453106):I.e.logAction(1453105)}_scrollToItem(e){}_getListConversation(){g.default.logCoreInfo("conversation-list: _getListConversation");let e=O.default,t=!c.c.isOffSendToMe,s=()=>{this._querySelect&&(this._querySelect(),this._querySelect=null)};e.getConversations(!0,t?c.c.sendToMeId:null).then((e=>{g.default.logCoreInfo("conversation-list: _getListConversation DONE");const t=wt.f.getFlag(this.props.user.userId,"z_sendtome_");let a=!(c.c.isOffSendToMe||t&&1!==t);const n=[];let i=[],o=[],r=!1;for(let s=0;s<e.length;++s)!r&&se.a.isThreadHidden(e[s].userId)&&parseInt(e[s].smsUnreadCount)>0&&!e[s].muted&&(r=!0),parseInt(e[s].smsUnreadCount)>0&&Ks.b.markGotUnread(e[s].userId),a&&e[s].userId===c.c.sendToMeId&&(e[s].pinned?I.e.logAction(1390703):(e[s].pinned=1,wt.f.setFlag(this.props.user.userId,"z_sendtome_",Date.now()),I.e.logAction(1390702)),a=!1),(e[s].infoCheckSearch||e[s].lastMessageTime&&e[s].numMsg)&&(e[s].infoCheckSearch&&g.default.msgTypeValid(e[s].infoCheckSearch.lastType)?K.a.pushCacheLastChat(e[s].userId,e[s].infoCheckSearch.lastMessageTime):e[s].lastType&&g.default.msgTypeValid(e[s].lastType)?K.a.pushCacheLastChat(e[s].userId,e[s].lastMessageTime):e[s].numMsg&&e[s].numMsg>1&&o.push(e[s].userId)),e[s].pinned>0&&i.push(e[s].userId),ca[e[s].userId]?delete ca[e[s].userId]:n.push(e[s]);Ks.b.onDoneEntry(Ks.a.LOCAL),se.a.initUnread(r),o.length>0&&K.a.cacheCheckLastChatInDb(o),cs.a.pushCachePinFromClient(i).then((e=>{if(a){const t=c.c.auto_pin_send2me&&!wt.f.getFlag(this.props.user.userId,"z_sendtome_pinned_")&&e&&e.conversations&&e.conversations.length<c.c.limit_pin_messages;O.default.createEmptyConversationForUser(c.c.sendToMeId,t?1:0).then((e=>{e.conversation&&k.default.getProfileFriendById(c.c.sendToMeId).then((s=>{const a=s;a&&(this.props.dispatch({type:p.FetchActions.ADD_MESSAGES,payload:{conversationId:e.conversation.userId,messages:[],conversation:Object.assign(e.conversation,a)}}),t&&cs.a.pinnedConversationLength()<c.c.limit_pin_messages&&(cs.a.pin([e.conversation.userId]),wt.f.setFlag(this.props.user.userId,"z_sendtome_pinned_",1)),wt.f.setFlag(this.props.user.userId,"z_sendtome_",Date.now()))}))})),I.e.logAction(1390701)}}));let l=window.localStorage.getItem(this.props.user.userId+"_zinit_sgg");l=!!l&&JSON.parse(l),!0!==l&&S.a.createFriendCenter(this.props.dispatch,this.props.user.userId).catch((e=>{Lt.Kha.error("[suggest] create empty conversation:error: "+JSON.stringify(e))})),this.props.dispatch({type:p.ConversationListActions.CONVERSATIONLIST_CHANGED,payload:n}),s(),zs.a.onLoadConversation(e)})).catch((e=>{s(),Ks.b.onDoneEntry(Ks.a.LOCAL),g.default.logCoreError("[ConversationList] error on get from db ",e)}))}dragOnIdHandler(e){const t=this.getConversations();this.dragOnId!=e&&(this.dragOnId=e,g.default.log("dragOnIdHandler:new id",e),null!=this.dragOnId&&t[this.dragOnId]&&(t[this.dragOnId].userId==this.props.state.currentId?g.default.log("dragOnIdHandler:already selected"):(g.default.log("dragOnIdHandler: execute selected"),this._selectConversation(t[this.dragOnId]))))}_addConversationIntoLabel(e,t){let s=b.b.getItem(t);H.a.openModal({windowId:Js,name:h.ModalIdentitiesDefine.MANAGE_LABEL,params:{view:Vs.b.ADD_CONVERSATION,info:s}}),e&&(e.preventDefault(),e.stopPropagation()),I.e.logAction(14521)}_getItemKey(e){return e.constructor===As?e.data.key:e.isBanner?"banner":e.userId}_getCurrentMediaBoxList(){const e=this.getConversations();let t=[];return this.props.state&&e&&(t=e.filter((e=>g.default.isInMediaBox(e)))),t}onActionCloseSth(){O.default.setInviteBannerOnOff(!0),this.setState({triggerUpdate:!this.state.triggerUpdate})}onAddSuggestFriend(e){let t=-1;e&&e.recommInfo&&e.recommInfo.source&&(e.recommInfo&&e.recommInfo.source&&(t=e.recommInfo.source),-1===t&&e.recommSrc&&(t=e.recommSrc)),je.a.setFriendRequestSource(e.userId,t),this.props.dispatch({type:p.ChatBoxActions.SHOW_ADD_FRIEND,payload:e.userId})}onViewProfile(e){if(!e)return;let t=-1;e&&e.recommInfo&&e.recommInfo.source&&(e.recommInfo&&e.recommInfo.source&&(t=e.recommInfo.source),-1===t&&e.recommSrc&&(t=e.recommSrc)),e.userId&&(je.a.setFriendRequestSource(e.userId,t),Q.default.setSelectConversationSource(178011),H.a.openModal({windowId:Js,name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:e.userId}))}onRemoveSuggestFriend(e,t=null,s=null){const a=this.state.suggestFriendItem.filter((t=>t.userId===e))[0];a&&Bs.a.removeSuggestFriend(a.userId,a.recommSrc,a.recommType).then((e=>{t&&t(),this.props.dispatch({type:p.ConversationListActions.FRIEND_CENTER_CHANGE,payload:{act:"update_suggestion"}})})).catch((e=>{s&&s()}))}_renderItem(e,t,s){let a=O.default.getConvUXVersion();if(1==t.isBanner)return o.a.createElement(ks,{bannerData:t.bannerData,dispatch:this.props.dispatch,showContextMenu:this._showItemContextMenu});if(t.constructor===As)return t.data.html?t.data.html:o.a.createElement("div",{key:t.data.key,onClick:()=>this.viewGroup(""),className:"conversation-list__label semibold",title:t.data.text?t.data.text:T.default.str(t.data.textKey)},o.a.createElement("div",{className:"lbl-title",style:{width:"93%"}},o.a.createElement("i",{className:"fa fa-chevron-left"}),t.data.textKey?o.a.createElement(E.a,{tagName:"div",textKey:t.data.textKey,className:"conv-title"}):o.a.createElement("div",{className:"conv-title"},t.data.text)),o.a.createElement(f.a,{tagName:"i",className:"fa fa-markall lbl-title",onClick:this.props.onMarkRead,style:{fontSize:"10px",cursor:"pointer",padding:"5px 10px"},textKey:"STR_LABEL_MARK_READ"}));if(t.constructor===ys&&t.data.label){let e=t.data.label,s=this.state.filter===h.CONV_FILTER.UNREAD,n=this.state.group.hasOwnProperty(aa),i=!1;if(3!==a)s=n=!1;else{i=Object.values(this.state.group).length>1}return o.a.createElement("div",{className:"flx flx-col flx-al-c flx-center h100"},o.a.createElement("img",{src:s||n&&!i?Ys:Ws.a,className:"label-guide__img",style:{width:s||n&&!i?"138px":""}}),o.a.createElement(E.a,{tagName:"div",textKey:s?"STR_NO_MSG_TXT_3":i?"STR_NO_CONV":n?"STR_NO_MSG_TXT_1":"STR_EMPTY_LABEL_GUIDE",className:"label-guide__txt"}),s||i||n?null:o.a.createElement(st.a,{textKey:"STR_ADD_CONVERSATION",onClick:t=>this._addConversationIntoLabel(t,e.id),type:"secondary",className:"margin-top-8",size:"large"}))}if(t.constructor===ys&&t.data.empty)return o.a.createElement("div",{className:"flx flx-col flx-al-c flx-center h100"},o.a.createElement("img",{src:Ys,className:"label-guide__img",style:{width:"138px"}}),o.a.createElement(E.a,{tagName:"div",textKey:t.data.textKey,className:"label-guide__txt"}));if(t.constructor===ys&&t.data.friendItem)return o.a.createElement(F.a,{item:t.data,isSelected:s,getConversationFromId:this.props.getConversationFromId,isGroup:!1,dispatch:this.props.dispatch,key:t.data.friendOnl?"zonl_"+t.data.userId:t.data.userId,selectConversation:this._selectConversation,showUserInfo:this.props.showUserInfo,acceptFriendRequest:this.props.acceptFriendRequest,rejectFriendRequest:this.props.rejectFriendRequest,confirm:this.props.confirm,showContextMenu:this._showItemContextMenu,conversationActionProps:{presets:"Contact"},compactLv:this.props.compactLv});if(t.constructor===ys&&t.data.suggestFriendItem)return o.a.createElement(xs.a,{content:t.data,dispatch:this.props.dispatch,onRemoveSuggestFriend:this.onRemoveSuggestFriend.bind(this),onAddSuggestFriend:this.onAddSuggestFriend.bind(this),onViewProfile:this.onViewProfile.bind(this),confirm:this.props.confirm});{let a=!1;t.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER&&(a=this.props.state.toggleUpdateFriendCenter);let n=null;const i=(this.oldCurrentConv&&this.oldCurrentConv===t.userId||!this._preventHightLight&&this.props.state.currentId===t.userId||n==t.userId)&&this.props.compactLv>h.COMPACT_LEVEL.COMPACT;return o.a.createElement(Rs,{key:t.userId,convId:t.userId,user:this.props.user,showContextMenu:this._showItemContextMenu,isSelected:i,isFocused:s,selectConversation:this._selectConversation,focusInputBox:()=>this._focusInputBox(t.userId),confirm:this.props.confirm,deleteConversation:this.deleteConversation,dragOnIdHandler:this.dragOnIdHandler.bind(this,e),dispatch:this.props.dispatch,drillIntoGroup:this.onDrillIntoGroup.bind(this),state:t,needRefresh:this.props.needRefresh,toggleUpdate:a,compactLv:this.props.compactLv})}}onDrillIntoGroup(e){let t;switch(e){case h.CONV_FILTER.STRANGER:t=aa}this.props.onDrillIntoGroup&&this.props.onDrillIntoGroup(t)}viewGroup(e,t=null){let s={},n=!1;this.resetUnread=!0;let i=h.CONV_FILTER.ALL;switch(e){case"label":n=!0,this._startIndex=null;break;case h.CONV_FILTER.UNREAD:i=h.CONV_FILTER.UNREAD,n=!0,this._startIndex=null,this.resetUnread=!1}if(t)t.hasOwnProperty("id")?s[t.id]=t:s=Object(a.a)(Object(a.a)({},s),t);else for(let a in s)if(s.hasOwnProperty(a)){parseInt(a)>0&&delete s[a]}this.state.filter===h.CONV_FILTER.ALL&&n&&(this.lastScrollDefault=this.refs.scrollbars&&this.refs.scrollbars.getScrollTop()),this.setState({group:s,filter:i},(()=>{n?this.scrollToTop(!1):this.lastScrollDefault&&(this._dataListRef.current&&this._dataListRef.current.scrollTop(this.lastScrollDefault),delete this.lastScrollDefault)})),e.length<=0&&this.props.onBackMessageFullList&&this.props.onBackMessageFullList()}setFocusedIndex(e,t=!1){this._dataListRef.current&&(this._dataListRef.current.setFocusedIndex(e,t),this._dataListRef.current.setFocusedIndex(e,t))}getFocusedIndex(){if(this._dataListRef.current)return this._dataListRef.current.getFocusedIndex()}_isInStrangerBox(e){return g.default.isInStrangerBox(e)}removeBanner(){if(c.c.messageBanner){let e=g.default.getMostRecentLoggedInUserId()+"_"+h.BANNER_POS_TAB_MSG_HEADER+"_"+c.c.messageBanner.id;c.c.messageBanner.actionContent&&c.c.messageBanner.actionContent.version&&(e=e+"_"+c.c.messageBanner.actionContent.version),e&&localStorage.setItem(e,1),c.c.messageBanner=null,this.setState({triggerUpdate:!this.state.triggerUpdate})}}_pushFriendSuggestionItemsToDataList(e){const t=this.props.friendRequests.slice(),s=Date.now();s-oa>c.c.suggestionShowInterval&&(g.default.shuffleArray(t),oa=s),e.push(new As({key:"_fr_rq",height:h.CONTACT_LABEL_HEIGHT,html:o.a.createElement("div",{className:"data-list__label",style:{lineHeight:h.CONTACT_LABEL_HEIGHT+"px"}},o.a.createElement(E.a,{textKey:"STR_CONTACT_SUGGEST_FRIEND"})," ("+t.length+")")}));const n=t.slice(0,1),i={},r=n.filter((e=>e.friendRequestType&&!e.friendRequestRead)).map((e=>e.userId));if(r.length){let e=r.length;for(let s of t)if(-1!==r.indexOf(s.userId)&&(i[s.userId]=!0,--e<=0))break}if(n.forEach((t=>{t.height=h.CONTACT_ITEM_HEIGHT,t.friendRequestMsg&&(t.height+=14),t.friendItem=!0,e.push(i[t.userId]?new ys(Object(a.a)(Object(a.a)({},t),{},{justRead:!0})):new ys(t))})),n.length!==t.length){const t=()=>{H.a.openModal({windowId:Js,name:h.ModalIdentitiesDefine.FRIEND_SUGGESTION,params:{friendRequests:this.props.friendRequests,showUserInfo:this.props.showUserInfo,acceptFriendRequest:this.props.acceptFriendRequest,rejectFriendRequest:this.props.rejectFriendRequest,getConversationFromId:this.props.getConversationFromId,handleFriendListNotificationsChange:this.props.handleFriendListNotificationsChange,selectConversation:this._selectConversation,confirm:this.props.confirm,dispatch:this.props.dispatch}}),I.e.logAction(103092)};e.push(new As({key:"_view_more_requests",height:h.CONTACT_LABEL_HEIGHT+20,html:o.a.createElement("div",{key:"_view_more_requests",className:"data-list__more clickable flx flx-al-c flx-center",onClick:t,style:{padding:"10px 0"}},o.a.createElement("div",{className:"flx flx-al-c flx-center"},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})),o.a.createElement("i",{style:{marginLeft:"5px"},className:"fa fa-caret-down"}))}))}}_pushSuggestFriendItems(e){let t=this.state.suggestFriendItem.slice();if(t.length<=0)return;e.push(new As({key:"_sg_fr",height:30,html:o.a.createElement("div",{className:"data-list__label",style:{borderTop:"1px solid var(--grey-300)",paddingTop:"12px"}},o.a.createElement(E.a,{textKey:"STR_DESC_SUGGEST"})," ("+t.length+")")}));let s=t.slice(0,c.c.suggestionNumberInMsgTab);if(s.forEach((t=>{t.height=h.CONTACT_ITEM_HEIGHT,t.suggestFriendItem=!0,e.push(new ys(t))})),s.length!==t.length){const a=()=>{H.a.openModal({windowId:Js,name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:{friendSuggestionMiningContent:t,mSuggestion:!0}}),I.e.logAction(1590104)};e.push(new As({key:"_view_more_suggest",height:47,html:o.a.createElement("div",{key:"_view_more_requests",className:"show-more-txt-new-style",onClick:a},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})," (",t.length-s.length,")")}))}}_shouldShowInlineFriendSuggestions(){return c.c.enableFriendSuggestion&&this.state.suggestFriendItem&&this.state.suggestFriendItem.length>0}_getDisplayedConversations(e){this.hasBanner=!1;let t=[],s=null,a=O.default.getConvUXVersion();if(this.state.group)for(let o in this.state.group)if(this.state.group.hasOwnProperty(o)){let e=this.state.group[o];if(e&&e.constructor===Object&&e.hasOwnProperty("id")){s=e;break}}const n=e=>new ys({key:"empty_conv",empty:!0,textKey:e,height:300}),i=e=>{if(this.state.group.hasOwnProperty(aa)){if(a>2)return void e.push(new ys({key:"label_guide",label:!0,height:300}));e.push(n("STR_NO_MSG_TXT_1"))}else if(s){let t=s;e.push(new ys({key:"label_guide",label:t,height:300}))}else this.state.filter===h.CONV_FILTER.UNREAD&&e.push(n("STR_NO_MSG_TXT_3"))};if(s){let s=!1,n={},o=!!this.state.group.hasOwnProperty(aa),r=a>2&&this.state.filter===h.CONV_FILTER.UNREAD;for(let i=0;i<e.length;i++){let l=e[i];if(!(l&&g.default.valueValid(l.userId)&&se.a.isThreadHidden(l.userId))&&l){if(r&&!this._applyFilter(l))continue;let e=!1;o&&3===a&&this._isInStrangerBox(l)&&(t.push(l),s=!0,e=!0);let i=b.b.getLabelObjByConversaionId(l.userId);if(i&&this.state.group.hasOwnProperty(i.id)){if(o&&!this._isInStrangerBox(l)&&2===a)continue;n[l.userId]=l,this._applyFilter(l)&&!e&&(t.push(l),s=!0)}}}if(!o||2!==a){let e=[],a=[];if(this.state.filter===h.CONV_FILTER.ALL){for(let t in this.props.state.contacts){let a=this.props.state.contacts[t];if(a&&!n.hasOwnProperty(t)&&!se.a.isThreadHidden(a.userId)){let i=b.b.getLabelObjByConversaionId(t);i&&this.state.group.hasOwnProperty(i.id)&&(n[t]=a,e.push(a),s=!0)}}for(let e in this.props.state.groups){let t=this.props.state.groups[e];if(t&&!n.hasOwnProperty(e)&&!se.a.isThreadHidden(t.userId)){let i=b.b.getLabelObjByConversaionId(e);i&&this.state.group.hasOwnProperty(i.id)&&(a.push(t),n[e]=t,s=!0)}}}e.length>0&&t.push(...e),a.length>0&&t.push(...a)}s||i(t)}else{let s=null;if(c.c.messageBanner){let e=this.state.filter===h.CONV_FILTER.UNREAD,s=this.state.group.hasOwnProperty(aa);e||s||(this.hasBanner=!0,t.push(new As({key:"top_banner",html:o.a.createElement(Pt,{dispatch:this.props.dispatch,data:c.c.messageBanner,removeBanner:this.removeBanner.bind(this),broadCastMessage:this.props.broadCastMessage,sendDirectMsgToSendToMe:this.props.sendDirectMsgToSendToMe,actionLogCode:1410101})})))}let a=0;const n=this._shouldShowInlineFriendSuggestions();let r=!1,l=[];const d=document.getElementById("conversationListId");let u=d?this._conversationListRefHeight?this._conversationListRefHeight:d.clientHeight:0;const _=u?u-c.c.suggestionNumberInMsgTab*h.CONVERSATION_ITEM_HEIGHT-3*h.CONTACT_LABEL_HEIGHT-20-20-15:0;for(let i=0;i<e.length;i++){let o=e[i];if(!this._applyFilter(o))continue;if(o&&o.userId&&!this.isValidConversation(o.userId))continue;let d=null;if(o&&o.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER){if(!0!==O.default.getEnableFriendSuggestion())continue;if(!0===this.state.friendCenterOnTop){t.splice(c.c.messageBanner?1:0,0,o);continue}}if(g.default.isInMediaBox(o))g.default.log("conversation-list: not displaying in-media-box-conv "+o.displayName);else if(this.state.group.hasOwnProperty(aa))this._isInStrangerBox(o)&&(d=o);else if(this._isInStrangerBox(o))s?(o.draft&&!s.draft&&(s.draft=o.draft),o.strangerUnreadCount&&!isNaN(o.strangerUnreadCount)&&(s.smsUnreadCount+=parseInt(o.strangerUnreadCount))):(s={displayName:T.default.str("STR_CONV_STRANGER"),lastMessageTime:o.lastMessageTime,lastMessageDname:"",lastMessage:T.default.str("STR_CONV_NINLIST"),lastMessageStatus:o.lastMessageStatus,userId:h.CONV_FILTER.STRANGER,draft:o.draft,smsUnreadCount:o.strangerUnreadCount?o.strangerUnreadCount:0},d=s);else{if(o.isGroup&&0===o.cloudMore&&!o.lastSmsLocalId&&!o.draft)continue;d=o}d&&(this.state.shouldShowShortConversationList&&n?a<c.c.suggestionPosition||_&&a*h.CONVERSATION_ITEM_HEIGHT<_?(t.push(d),a++):(d.smsUnreadCount||la[d.userId]||this.props.state.currentId===d.userId?(this.props.state.currentId===d.userId&&(la[d.userId]=!0),l.length?(Array.prototype.push.apply(t,l),t.push(d),a+=l.length+1,l=[]):(t.push(d),a++)):l.push(d),r=!0):t.push(d))}if(r){const e=()=>{this.setState({shouldShowShortConversationList:!1}),ra=Date.now(),I.e.logAction(103091)};t.push(new As({key:"_view_all_conversations",height:47,html:o.a.createElement("div",{key:"_view_all_conversations",className:"show-more-txt-new-style",onClick:e,style:{paddingTop:"13px"}},o.a.createElement(E.a,{textKey:"STR_VIEW_ALL_CONVERSATIONS"}))}))}n&&this._pushSuggestFriendItems(t),t.length<=0&&i(t)}return 0==O.default.getInviteBannerOnOff().isOff&&t.unshift({isBanner:!0}),a>2&&this.state.filter===h.CONV_FILTER.UNREAD&&t.sort(((e,t)=>{if(!e)return 1;if(!t)return-1;let{muted:s,lastMessageTime:a,pinned:n}=e,{muted:i,lastMessageTime:o,pinned:r}=t;return n&&r?r-n:n&&!r?-1:!n&&r?1:s&&i?o-a:s&&!i?1:!s&&i?-1:o-a})),this.state.filter!==h.CONV_FILTER.ALL&&(this.displayConversations=[...t],this.filterConversationList=t.reduce(((e,t)=>(t&&t.userId&&(e[t.userId]=t),e)),{})),t}_applyFilter(e){if(!e)return!1;let{filter:t}=this.state;const s=()=>!(!this.filterConversationList||!this.filterConversationList.hasOwnProperty(e.userId));switch(t){case h.CONV_FILTER.ALL:return!0;case h.CONV_FILTER.UNREAD:return!!s()||(e.smsUnreadCount>0||e.unreadMark)}return!1}isValidConversation(e){return!se.a.isThreadHidden(e)&&(!(e==h.FAKE_CONVERSATION_ID.FRIEND_CENTER&&!c.c.showThreadSuggestFriendInMsgTab)&&g.default.valueValid(e))}getConversations(){return this.props.state.conversations}render(){const e=this.getConversations();this.selectedItem=null;let t=this.props.className?this.props.className:"",s=this.props.isEnable?"block":"none",a=[],n=!1;if(e&&0!=e.length){if(a=this._getDisplayedConversations(e),a.length>10&&!this._wroteLog&&(qs.a.loadDoneUI(),this._wroteLog=!0),this.haveFiendConversations=a.some((e=>!(!e||!e.userId||e.userId.startsWith(h.GROUPID_PREFIX)))),this._needScrollToSelected||null===this._startIndex&&this.props.state.currentId){let e=this._needScrollToSelected?this._lastSelectedConv:this.props.state.currentId,t=!1;for(let s=0;s<a.length;s++)if(a[s].userId===e){this._startIndex=s,t=!0;break}t?n=this._needScrollToSelected:null===this._startIndex&&(this._startIndex=0),g.default.log("conversation-list: set _startIndex = "+this._startIndex+" current id = "+this.props.state.currentId)}}else{if(this.haveFiendConversations=!1,"none"==s)return null;if(!this.props.state.loaded||!this.props.state.firstFetchDone)return g.default.log("conversation-list: no thing, empty"),o.a.createElement(Xs,null);if(!this._shouldShowInlineFriendSuggestions())return o.a.createElement("div",null,o.a.createElement("div",{className:"tab-title"},o.a.createElement(E.a,{textKey:"STR_MSGS_TITLE"})),o.a.createElement("div",{className:"media-empty-text"},o.a.createElement("div",null,o.a.createElement("i",{className:"fa fa-emptylist",style:{fontSize:"96px",color:"var(--neutral-600)",marginTop:"9px",marginBottom:"9px"}})),o.a.createElement("p",{style:{color:"var(--neutral-500)",fontSize:"14px",paddingLeft:"26px",paddingRight:"26px"},className:"media-empty-text__not-pictured"},o.a.createElement(E.a,{textKey:"STR_MSG_LIST_EMPTY_NOTICE"}))));this._pushSuggestFriendItems(a)}let i=this._startIndex&&this._startIndex>30?this._startIndex+10:30;g.default.log("conversation-list: print out data list "+i+" start inidex = "+this._startIndex);let r=N.a.getOldTab();if(r&&void 0!==r[this.props.currentTab]){let e=a.map((function(e){return e.userId})).indexOf(r[this.props.currentTab].userId);this._startIndex=e}return o.a.createElement("div",{id:"conversationListId",style:{position:"relative",display:s,flex:2},className:t,"data-id":"div_TabMsg_ThrdChList",onBlur:this._onBlur.bind(this),onKeyDown:this._handleKeyEvent.bind(this),ref:e=>this._conversationListRef=e,tabIndex:999},o.a.createElement(C.a,{popoverProps:{identity:{windowId:Js,name:h.PopoverIdentitiesDefine.CONTEXTMENU_CONV_LIST}},key:"convAct",ref:e=>this.conversationAction=e,confirm:this.props.confirm,onClose:()=>this.setState({selectedConversation:null,showContextEvent:null}),deleteConversation:this.deleteConversation,state:this.state.selectedConversation,dispatch:this.props.dispatch,user:this.props.user,containerId:"conversationListScrollbar",onTerminateSth:this.onActionCloseSth.bind(this),showUserInfo:this.props.showUserInfo,showEditAlias:this.props.showEditAlias,hideConversation:this.props.hideConversation,presets:"Thread"}),o.a.createElement(Ps,{ref:this._dataListRef,key:"conversationListDl",dltype:Cs.CONVERSATION,viewGroup:this.state.group,onScroll:this._handleScroll.bind(this),domId:$s,tabIndex:null,draftSortConversations:this._draftSortConversations,onFocus:this._onFocus,onBlur:this._onBlur,items:a,renderItem:this._renderItem,getItemKey:this._getItemKey,selectedId:this._startIndex,focusedIndex:this._startIndex,scrollToSelected:n,initialLength:i,currentConv:this.props.state.currentId}))}}ha.propTypes={user:l.a.object.isRequired,state:l.a.object.isRequired,dispatch:l.a.func.isRequired};const ua={conversations:[],contacts:{},groups:{},currentId:null,loaded:!1,firstFetchDone:!1,toggleDraftSorted:!1,toggleUpdateFriendCenter:!1};let _a=(e,t)=>{for(let s=0;s<e.length;s++)if(e[s].userId===t)return{index:s,conv:e[s]};return null},ma=e=>Math.max(e.lastMessageTime?parseInt(e.lastMessageTime):0,e.draft&&e.draft.draftTime?e.draft.draftTime:0),pa=e=>{let t=os.a.getMediaBoxInfo(),s=null,a=null;if(t.pinned)for(let n=0;n<e.length;n++){let t=e[n],i=ma(t);g.default.isInMediaBox(t)&&(!a||i>a)&&(a=i,s=t.userId)}return{id:s,pinned:t.pinned}},ga=e=>{g.default.log("data-list: do sortConversations");let t=pa(e),s=[],a=e=>t.id&&e.userId===t.id?t.pinned:e.pinned,n=e.reduce(((e,t)=>(a(t)?e.push(t):s.push(t),e)),[]);return n.sort(((e,t)=>a(t)-a(e))),s.sort(((e,t)=>ma(t)-ma(e))),e=n.concat(s)},Ea=e=>{delete e.smsUnreadCount,delete e.mentionUnreadCount,delete e.strangerUnreadCount,delete e.lastSmsLocalId,delete e.lastMessageStatus,delete e.lastMessage,delete e.lastMessageDname,delete e.lastMessageUidFrom,delete e.lastMessageTime,delete e.firstSmsLocalId,delete e.numMsg,delete e.lastMessageAction,delete e.lastType},fa=[],Ia=!1;var Ta=s("BKm0"),va=s("ANjH"),Ra=s("Lqdh"),Sa=(s("pYbT"),s("BR/n")),Oa=s("09cJ"),Na=s("i143"),ba=s("kZNI"),Ca=s("vSga"),Aa=(s("IvK1"),s("41Rw")),ya=s("Y/Cm"),Da=(s("x4D7"),s("R3c/"));function Ma(e,t){const{pIdOrMsgId:s,className:a}=e,n=Object(ne.a)(e,["pIdOrMsgId","className"]),i=Object(le.a)(s,ce.q),r=Object(le.a)(s,ce.p),l=Object(le.a)(s,ce.n);return o.a.createElement("div",Object(d.a)({ref:t,className:Object(Te.a)("file-star-msg-content flx flx-al-c",a)},n),o.a.createElement(Da.b,{extension:l,className:"file-star-msg-content__thumb",size:"large"}),o.a.createElement("div",{className:"file-star-msg-content__right-block"},o.a.createElement("div",{className:"file-star-msg-content__title",title:r},r),o.a.createElement("div",{className:"file-star-msg-content__size",title:i},i)))}const Pa=o.a.memo(o.a.forwardRef(Ma));Pa.propTypes={pIdOrMsgId:l.a.string.isRequired};var wa=Pa,La=s("/5+7"),ka=s("4wTQ"),xa=(s("PcUO"),s("oNsl")),Ua=s("8G4C"),Fa=s("xrk1"),Ga=s("fjQr"),Ba=s("h9Os"),Ha=s("n4Tl"),ja=s("mmLN");const Va="star-img-t";function Ka(e,t){return o.a.createElement(Ga.a,{className:"star-img-t__err",errorName:e,errorArgs:t,caption:!1})}const Wa=o.a.createElement(Ba.a,{className:"star-img-t__expr",caption:!1});let Ya=o.a.forwardRef((function(e,t){const{message:s}=e,a=Object(ne.a)(e,["message"]),[n,i]=o.a.useMemo((()=>{const e=Fa.f.extractLocalCiIdFromMsg(s);return[e,Ha.c(e)]}),[]);return Fa.j(i)?o.a.createElement(Xa,Object(d.a)({ref:t,ciId:n},a)):o.a.createElement("div",{ref:t,className:Object(Te.a)(Va)})}));Ya=Object(ae.b)(Ya);var za=Ya;const qa=Object(ja.a)(2),Xa=o.a.forwardRef((function(e,t){const{ciId:s}=e,a=Object(ne.a)(e,["ciId"]);return qa(c.c.image.enable_con_rt,c.c.image.con_rt_star_wave,c.c.image.con_rt_star_len,s),Fa.i(s,{comp:"star"}),o.a.createElement(Ua.a,Object(d.a)({ref:t},a,{className:Va,ciId:s,thumbWidth:75,thumbHeight:75,errorRenderer:Ka,expired:Wa,maxLoss:c.c.image.star_max_loss}))}));var Ja=s("Ytmi"),Qa=s("i4CS"),$a=s("VdOQ");var Za=s("MEZx"),en=s("zTwE");var tn=(e=[])=>e.map((e=>{var t;return e.msgType===h.MSG_PHOTO_GROUP?null!=(t=e.message)?t:[]:e})).flat(),sn=s("KSx/");const an=zt.a,nn=g.default.isWeb();class on extends o.a.Component{constructor(e){super(e),this._showUserInfo=this._showUserInfo.bind(this),this._fileMessageInit(),this.eventHandler=(e,t)=>{switch(e){case p.ConversationListActions.SCROLL_MENTION_LIST:this.menu&&this.menu.close()}},v.default.subscribe(this.eventHandler)}shouldComponentUpdate(e,t){return this.props.message!=e.message||this.props.stickerThumb!=e.stickerThumb||this.props.displayName!=e.displayName||this.props.selected!=e.selected}componentWillUnmount(){v.default.unsubscribe(this.eventHandler)}_fileMessageInit(){if(this.props.message){const e=this.props.message;if(e.msgType==h.MSG_FILE){const t="0"==e.fromUid?Q.default.getSessionUserId():e.fromUid,s="0"==e.toUid?Q.default.getSessionUserId():e.toUid,a=`${e.msgId}`.includes("_")?null:""+e.msgId,{FileStarModel:n}=La.a.models,i=new n({params:La.a.utils.getMessageFileParams(e),conversationId:s,fileUrl:La.a.utils.getFileMessageUrl(e),indicatorState:La.a.utils.getFileMessageIndicatorState(e),status:La.a.utils.getFileMessageStatus(e),extraInfo:{fromUid:t,sendTime:e.sendDttm}});La.a.dispatch(oe.FileActionType.Init,{data:i,id:{p:La.a.utils.getPrimaryId(e),s:a}})}}}_getMentionedName(e){let t=k.default.getDName(e);return t?"@"+t:null}_onMenu(e){this.menu&&this.menu.show(e)}_deleteMessage(e){this.props.deleteMessage(),this.menu&&this.menu.close(),e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation())}_gotoMsg(e,t){this.props.selectItem(),this.menu&&this.menu.close(),e&&e.preventDefault&&(e.stopPropagation(),e.preventDefault()),t&&(I.e.logAction(1280601),I.e.logAction(178005))}_onJump(e){this.props.selectItem(),I.e.logAction(13101),e&&e.preventDefault&&(e.stopPropagation(),e.preventDefault()),I.e.logAction(178006)}_onUnstar(e){this.props.unstared(),e.stopPropagation(),I.e.logAction(13103)}_showUserInfo(e,t,s){const a=this.props.message;this.props.onShowUserInfo(t,s,a?a.toUid:void 0),e.preventDefault(),e.stopPropagation()}render(){let e=this.props.message,t=(this.props.index,e.message&&e.message.message?e.message.message:e.message);t&&(t=t.desc&&e.msgType===h.MSG_LOCATION?t.desc:t,t=t.title?t.title:t);let s,a=!0;if(e.sendDttm){let t={time:"HH:mm",date:{type:"DD/MM/YYYY"},format:"time-first"};s=te.a.contextDate(e.sendDttm,t)}let n=null;t&&e.msgType!==h.MSG_PHOTO_GROUP&&e.msgType!==h.MSG_FILE&&e.msgType!==h.MSG_OA&&e.msgType!==h.MSG_CONTACT?n=ts.a.renderHtmlMessage(t,e.mentions,this.props.onShowUserInfo,this._getMentionedName.bind(this),null,this.props.dispatch,!1,null,!0,e):t&&e.msgType===h.MSG_OA?e.message.length>0&&e.message[0]&&e.message[0].description&&(n=e.message[0].description):e.msgType===h.MSG_CONTACT&&"recommened.misscall"===e.message.action&&(n=o.a.createElement("div",{className:"videocall-message-content"},o.a.createElement("i",{style:{color:"var(--red-300)",fontSize:"23px"},className:"btn fa fa-chat_bubble_icon_misscall"}),o.a.createElement("span",{className:"videocall-message-content__subtitle"},"Cuộc gọi nhỡ Zalo")));let i=null,r=null,l=null,c=null,d=o.a.createElement("div",{className:"star-msgs__thumb"}),_="0"==e.fromUid?this.props.user.userId:e.fromUid,p=k.default.getMiniInfo(_);p&&(i=p.avatar,r=p.dName);let I=o.a.createElement("div",{className:"flx"},o.a.createElement(E.a,{textKey:e.toUid.startsWith(h.GROUPID_PREFIX)?"STR_STAR_MSG_GROUP_CONV_NAME":"STR_STAR_CHAT"}),o.a.createElement("span",{className:"truncate pl-1",title:this.props.displayName},this.props.displayName?this.props.displayName:null)),T=!1,v=!1;switch(e.msgType){case h.MSG_CONTACT:switch(e.message.action){case"recommened.link":case"recommened.vip":{v=!0,T=m.b.isMultiURL(t,!0),T&&(a=!1);let s={};try{s=JSON.parse(e.message.params)}catch(S){g.default.logCoreError(S)}s&&s.mediaTitle&&(l=s.mediaTitle),s&&s.src&&(c=s.src),d=e&&e.message.thumb?o.a.createElement("img",{key:"star-msg-photo",className:"star-msgs__thumb clickable",src:g.default.toHttps(e.message.thumb)}):o.a.createElement("div",{className:"star-msgs__thumb link-placeholder"}),n=ts.a.renderHtmlMessage(t,e.mentions,this.props.onShowUserInfo,this._getMentionedName.bind(this),null,this.props.dispatch,!1,null,!0,e);break}case"recommened.user":{let t=null,s=null,a=e.message.params,n=k.default.getMiniInfo(a);n?(t=n.avatar,s=n.dName):(s=e.message.title,t=e.message.thumb),d=o.a.createElement(u.b,{target:{avatar:t,displayName:s},size:"l",onClick:e=>this._showUserInfo(e,a,h.FRIEND_REQUEST_SRC_ECARD)});break}case"recommened.stickerset":d=o.a.createElement("div",{title:"Bộ sticker",className:"avatar avatar--l"},o.a.createElement("div",{style:{backgroundImage:"url("+g.default.toHttps(e.message.thumb)+")"},className:"avatar-img"}));break;default:a=!1}break;case h.MSG_PHOTO:if(xa.a.isActivated("enable_file_store_comp")){d=o.a.createElement(za,{key:e.msgId,message:e});break}case h.MSG_VIDEO:case h.MSG_DOODLE:d=e.message&&e.message.thumbUrl?o.a.createElement("div",{className:"thumb-border"},o.a.createElement(Aa.d,{key:"star-msg-photo",className:"star-msgs__thumbImageMsg clickable image-placeholder",onClick:t=>this.props.onImageClick(t,e),src:e.message.thumbUrl?g.default.toHttps(e.message.thumbUrl):g.default.toHttps(e.message.oriUrl),cacheFolderName:e.message.thumbUrl?"Cache":null,conversationId:e.toUid,doNotShowRetry:!0,userId:this.props.user.userId})):o.a.createElement("div",{className:"star-msgs__thumb flx flx-center flx-al-c clickable",onClick:t=>this.props.onImageClick(t,e)},o.a.createElement("i",{className:e.msgType==h.MSG_VIDEO?"fa fa-video-undo ":"fa fa-photo-undo"}));break;case h.MSG_STICKER:if(e.message){e.message.catId,e.message.id;this.props.stickerThumb&&(d=o.a.createElement("img",{key:"star-msg-photo",className:"star-msgs__thumb",src:this.props.stickerThumb}))}break;case h.MSG_FILE:break;case h.MSG_LOCATION:v=!0,d=o.a.createElement("img",{src:en.a,key:"star-msg-photo",className:"star-msgs__thumb small clickable"});break;case h.MSG_GIF:d=o.a.createElement("img",{key:"star-msg-photo",className:"star-msgs__thumb",src:e.message.thumbUrl});break;case h.MSG_PHOTO_GROUP:d=o.a.createElement("div",{className:"group-photo-container"},e.message.map((e=>{if(e.msgType!=h.MSG_DEL_EVERYONE)return xa.a.isActivated("enable_file_store_comp")?o.a.createElement(za,{key:"gPhoto-thumb-"+e.msgId,message:e}):e.msgType==h.MSG_DEL_EVERYONE?null:o.a.createElement("div",{key:"gPhoto-thumb-"+e.msgId,className:"thumb-border"},o.a.createElement(Aa.d,{className:"star-msgs__thumbImageMsg clickable image-placeholder",key:"thumgroup_"+e.msgId,onClick:t=>this.props.onImageClick(t,e),src:e.message.thumbUrl?g.default.toHttps(e.message.thumbUrl):g.default.toHttps(e.message.oriUrl),cacheFolderName:e.message.thumbUrl?"Cache":null,conversationId:e.toUid,doNotShowRetry:!0,userId:this.props.user.userId}))})));break;case h.MSG_VOICE:d=o.a.createElement(ba.a,{key:e.cliMsgId,message:e,msgId:e.msgId,content:e.message,isStar:!0});break;case h.MSG_OA:if(e.message&&e.message.length>0){let t=e.message[0];t&&t.title&&(l=t.title),t&&t.src&&(c=t.src),d=t&&t.thumb?o.a.createElement("img",{key:"star-msg-photo",className:"star-msgs__thumb clickable",src:g.default.toHttps(t.thumb)}):o.a.createElement("div",{className:"star-msgs__thumb link-placeholder"}),v=!0}else a=!1;break;default:a=!1}const R=e.msgType===h.MSG_FILE?o.a.createElement(wa,{pIdOrMsgId:e.msgId}):a||l&&!T?o.a.createElement("div",{className:"flx flx-al-s star-msgs__group__item__content"+(v?" clickable":"")},a?d:null,o.a.createElement("div",{className:"star-msgs__right"},l?o.a.createElement("div",{className:"star-msgs__group__item__header truncate keepWord"+(e.msgType===h.MSG_FILE?" oneline":"")},l):null,c?o.a.createElement("div",{className:"star-msgs__group__item__desc truncate oneline"},c):null)):null;return o.a.createElement("div",{key:"msg_"+e.staredDttm,onContextMenu:this._onMenu.bind(this),onClick:this._onJump.bind(this),className:"flx z-padding star-msgs__group__item canClick"+(this.props.selected?" active-bg":""),"data-id":"div_TabStar_StarItem"},o.a.createElement("div",{className:"star-msgs__group__item__action"},o.a.createElement(f.a,{tagName:"span",textKey:"STR_TOOLTIP_UNSTAR_MSG","data-id":"btn_TabStar_StarItemUnStar",onClick:e=>{this._onUnstar(e)},className:"star-msgs__group__item__action__btn clickable"},o.a.createElement("i",{className:"fa fa-sidebar-icon-star-hover"}))),o.a.createElement(u.b,{key:"avatar",target:{avatar:i,displayName:r},size:"s",className:"clickable",onClick:t=>this._showUserInfo(t,e.fromUid,e.toUid.startsWith(h.GROUPID_PREFIX)?h.FRIEND_REQUEST_SRC_GROUP_CHAT:h.FRIEND_REQUEST_SRC_CHAT)}),o.a.createElement("div",{className:"z-ml truncate",key:"main",style:{wordWrap:"normal"}},o.a.createElement("div",{key:"title",className:"star-msgs__group__item__title"},o.a.createElement("span",{className:"text-name user-name"},r),o.a.createElement("span",{className:"star-msgs__group__item__time"}," - ",s)),R,o.a.createElement("div",{key:"content",className:"star-msgs__group__item__html"},n),o.a.createElement("div",{key:"footer",className:"star-msgs__group__item__footer"},I)),o.a.createElement("div",{className:"func-setting-container"},o.a.createElement(Za.default,{popoverProps:{identity:{windowId:"1",name:h.PopoverIdentitiesDefine.CHAT_BOX_START_MSG+"-"+this.props.index}},ref:e=>this.menu=e,items:[{textKey:"STR_JUMP_TO_MESSAGE",onclick:this._gotoMsg.bind(this)},{textKey:"STR_TOOLTIP_UNSTAR_MSG",onclick:this._onUnstar.bind(this)}]})))}}const rn=(e,t)=>e.staredDttm-t.staredDttm;class ln extends o.a.Component{constructor(e){super(e),this.storage=O.default,this._lastLoaded=0,this._isLoading=!1,this._waitingGroupPhoto=null;let t={};this.conversations={};let a=Ca.g.getRecentMediaItems();if(!nn){const{ipcRenderer:e}=s("vbkW");this.ipc=e}for(let s=0;s<a.length;s++){t[a[s].cateId+"_"+a[s].id]=a[s].stickerUrl}this.state={starMsgs:[],selectedIndex:-1,convName:{},thumb:t,firstLoad:!1},this._eventHandler=this._eventHandler.bind(this)}componentWillMount(){this._getStarMsgs(30,!1),v.default.subscribe(this._eventHandler)}componentWillUnmount(){v.default.unsubscribe(this._eventHandler)}shouldComponentUpdate(e,t){return this.state.starMsgs!==t.starMsgs||this.state.selectedIndex!==t.selectedIndex||this.state.convName!==t.convName||this.state.thumb!==t.thumb||this.state.firstLoad!=t.firstLoad}componentDidUpdate(){this._waitingGroupPhoto&&this._loadMore(this._waitingGroupPhoto.total_item,!0),function(e){if(Array.isArray(e))for(const s of e)try{if(Ja.e(s)){Fa.e.dispatch(Qa.g(s));continue}if(Ja.b(s)){s.message.forEach((e=>Fa.e.dispatch(Qa.g(e))));continue}}catch(t){g.default.logCoreError("FileStore:handleStar",Object($a.a)(t,s))}}(this.state.starMsgs)}ensureMinLength(){let e=0;for(let t=0;t<this.state.starMsgs.length;t++)this.state.starMsgs[t].msgType!==h.MSG_PHOTO_GROUP?e++:e+=this.state.starMsgs[t].message.length;e<30&&e>0&&this._previousLastMessage!==this.state.starMsgs[this.state.starMsgs.length-1].staredDttm&&(this._previousLastMessage=this.state.starMsgs[this.state.starMsgs.length-1].staredDttm,this._loadMore(30-this.state.starMsgs.length,!1))}_eventHandler(e,t){let s=[];switch(e){case p.MessageActions.ADD_STAR:if(t.updateMsgs&&t.updateMsgs.length>0&&t.staredDttm){let e=[];t.updateMsgs.forEach((s=>{let a=Object.assign({},s);a.staredDttm=t.staredDttm,e.push(a)}));let a=this._preProcessStarMsgs(e,!1);s=a.concat(this.state.starMsgs),this._getMoreInfo(a),this.setState({starMsgs:s})}break;case p.MessageActions.UNDO_DEL_STAR:{let e=t.updateMsgs.map((e=>Object.assign({staredDttm:t.staredDttm},e)));const s=tn(this.state.starMsgs);e=e.concat(s).sort(rn).reverse();const a=this._preProcessStarMsgs(e,!1);this._getMoreInfo(a),this.setState({starMsgs:a});break}case p.MessageActions.DELETE_STAR:{let e=t.updateMsgs;if(e&&e.length){let t=[],s={};e.forEach((e=>{s[e.staredDttm]=e}));for(let e=0;e<this.state.starMsgs.length;e++)s[this.state.starMsgs[e].staredDttm]||t.push(this.state.starMsgs[e]);this.setState({starMsgs:t},(()=>this.ensureMinLength()))}break}case p.FetchActions.UNDO_MULTI:{const e=t.map((e=>e.msgId));this._delStarEventHandler({msgId:e});break}case p.FetchActions.DELETE_EVERYONE:case p.FetchActions.UNDO:case p.FetchActions.DELETE_MESSAGE:case p.ChatBoxActions.DELETE_MESSAGE:this._delStarEventHandler(t);break;case p.FetchActions.GROUP_LEAVE:case p.FetchActions.DELETE_CONVERSATION:this._delConversationHandler(t)}}_delStarEventHandler(e){let t=[];if(e){let s={};e.msgId.constructor===Array?e.msgId.forEach((e=>{s[e]=!0})):s[e.msgId]=!0;let a=!1;t=[];for(let e=0;e<this.state.starMsgs.length;e++)if(this.state.starMsgs[e].msgType!==h.MSG_PHOTO_GROUP)s[this.state.starMsgs[e].msgId]?a=!0:t.push(this.state.starMsgs[e]);else{let n=this.state.starMsgs[e].message,i=[];for(let e=0;e<n.length;e++)s[n[e].msgId]?a=!0:i.push(n[e]);if(i.length>0){let s=Object.assign({},this.state.starMsgs[e]);s.message=i,s.total_item=i.length,t.push(s)}}a&&this.setState({starMsgs:t},(()=>this.ensureMinLength()))}}_delConversationHandler(e){if(!e)return;let t=[],s=!1;for(let a=0;a<this.state.starMsgs.length;a++)this.state.starMsgs[a].toUid===e?s=!0:t.push(this.state.starMsgs[a]);s&&this.setState({starMsgs:t},(()=>this.ensureMinLength()))}_unstared(e){if(e){let t;t=e.msgType===h.MSG_PHOTO_GROUP&&e.message?e.message:[e],O.default.unstaredMessages(t),this.props.dispatch({type:p.MessageActions.DELETE_STAR,payload:{updateMsgs:t}}),R.a.createSuccess(T.default.str("STR_MSG_UNSTARRED")),I.e.logAction(106362)}}_getStarMsgs(e,t,s=null){this.storage.getStarMsg(e,s).then((e=>{if(e&&e.length>0){const s=()=>{let s=this._preProcessStarMsgs(e,t),a=[];t?(a=this.state.starMsgs.slice(0),a[a.length-1]=s[0]):a=this.state.starMsgs.concat(s),this._isLoading=!1,this.setState({starMsgs:a,firstLoad:!0}),t||this._getMoreInfo(s)};ya.a.preparse(e,null,s,s)}else this.setState({firstLoad:!0})}))}_getMoreInfo(e){let t=[],s={},a={},n=[],i=!1;for(let o=0;o<e.length;o++){let r=e[o];if(!this.state.convName[r.toUid])if(r.toUid.startsWith(h.GROUPID_PREFIX))t.push(r.toUid);else{let e=k.default.getDName(r.toUid);s[r.toUid]=e}switch(r.msgType){case h.MSG_STICKER:if(r.message){let e=r.message.catId+"_"+r.message.id;if(!this.state.thumb[e]){let e=this._getStickerIfNotExist(r.message.catId,r.message.id);n.push(e)}}break;case h.MSG_PHOTO:case h.MSG_PHOTO_GROUP:a[r.toUid]||r.toUid.startsWith(h.GROUPID_PREFIX)||(a[r.toUid]=!0,i=!0)}}n.length>0&&Promise.all(n).then((e=>{let t={};if(e&&e.length){for(let s=0;s<e.length;s++)if(e[s]){t[e[s].cateId+"_"+e[s].id]=e[s].stickerUrl}Object.assign(t,this.state.thumb),this.setState({thumb:t})}})),t.length>0&&rt.a.getGroupsByIds(t).then((e=>{for(let t in e)s[t]=e[t].displayName,this.conversations[t]=e[t];Object.assign(s,this.state.convName),this.setState({convName:s})})),i&&k.default.getProfileFriendByIds(a).then((e=>{for(let t in e)this.conversations[t]=e[t]}))}_preProcessStarMsgs(e,t){if(e.length<=0)return[];let s=[],a=null,n=!1,i={};const o=(e,t)=>i[e.msgId]-i[t.msgId];t&&this._waitingGroupPhoto&&(a=this._waitingGroupPhoto,n=!0,a.message=[]);for(let l=0;l<e.length;l++){let t=e[l];if(t)if(t.message&&t.message.params){let e={};try{e=JSON.parse(t.message.params)}catch(r){g.default.logCoreError(r)}if(e&&e.is_group_layout){const r=e.id_in_group;i[t.msgId]=r,n?(a.group_layout_id===e.group_layout_id?(a.message.push(t),a.message.sort(o)):(s.push(a),a={msgType:h.MSG_PHOTO_GROUP,staredDttm:t.staredDttm,sendDttm:t.sendDttm,total_item:e.total_item_in_group,message:[t],fromUid:t.fromUid,toUid:t.toUid,group_layout_id:e.group_layout_id},n=!0),a.message.length===a.total_item&&(s.push(a),a=null,n=!1)):(a={msgType:h.MSG_PHOTO_GROUP,staredDttm:t.staredDttm,sendDttm:t.sendDttm,total_item:e.total_item_in_group,message:[t],fromUid:t.fromUid,toUid:t.toUid,group_layout_id:e.group_layout_id},n=!0)}else a&&s.push(a),s.push(t),a=null,n=!1}else a&&s.push(a),s.push(t),a=null,n=!1}return a?e.length<30||t?(this._waitingGroupPhoto=null,s.push(a)):t||(this._waitingGroupPhoto=Object.assign({},a),s.push(a)):this._waitingGroupPhoto=null,s}_onClickImage(e,t){const s={user:this.props.user,selectedId:t.msgId,userId:t.toUid,conversation:this._getConversation(t.toUid,this.conversations[t.toUid]),isVideo:t.msgType===h.MSG_VIDEO,message:t,images:[t],iconMap:rs.a.getIconMap(),appConfig:Object(c.d)()};t.msgType===h.MSG_PHOTO&&ge.e.log(ge.e.ACT.VIEW,{src:ge.e.SRC.STAR_LIST,targetId:s.userId,key:t.msgId}),nn||(s.message=Object(a.a)(Object(a.a)({},s.message),{},{mediaAction:null}),s.images=[s.message]),sn.a.openPhotoViewer(s),e.stopPropagation()}_getStickerIfNotExist(e,t){return Ca.g.getStickerIfNotExist(e,t).then((e=>e))}_getConversation(e,t=null){if(this.props.conversations)for(let s=0;s<this.props.conversations.length;s++){let t=this.props.conversations[s];if(t.userId==e)return t}return t}_goToMsg(e,t){this._goToMsgV2(e,t)}_goToMsgV2(e,t){this.setState(Object(a.a)(Object(a.a)({},this.state),{},{selectedIndex:t}));let s=e,n=[];s.msgType===h.MSG_PHOTO_GROUP?(s=e.message[0],n=e.message.map((e=>e.msgId))):n=[""+s.msgId],ka.a.jumpToMessage(s,s.toUid,this.props.dispatch).then((e=>{const{conversationId:t}=e;let s={name:"message",userId:t};N.a.setOldTab(s)})).catch((e=>{g.default.logCoreError(e)}))}_deleteMessage(e){if(!e)return;let t=e.toUid;t&&(e.msgType===h.MSG_PHOTO_GROUP?this.storage.deletePhotoMessageInRange(e.message).then((e=>{null!=e.delConversationId?this.props.dispatch({type:p.FetchActions.DELETE_CONVERSATION,payload:e.delConversationId}):e.msgIds&&this.props.dispatch({type:p.ChatBoxActions.DELETE_MESSAGE,payload:{msgId:e.msgIds,conversation:e.conversation,updateConversation:e.updateConversation}})})):this.storage.deleteMessageAndReconnectChatThread(e.msgId,e.sendDttm,e.cliMsgId,t,!1,!1).then((e=>{null!=e.delConversationId?this.props.dispatch({type:p.FetchActions.DELETE_CONVERSATION,payload:e.delConversationId}):this.props.dispatch({type:p.ChatBoxActions.DELETE_MESSAGE,payload:e})})))}_getFriendlyNames(e){let t=k.default.getDName(e);return t||(this.state.convName[e]?this.state.convName[e]:null)}_showUserInfo(e,t=h.FRIEND_REQUEST_SRC_GROUP_CHAT,s=null){let a;s&&(s=g.default.getGroupIdFromConversationId(s),t===h.FRIEND_REQUEST_SRC_GROUP_CHAT?a={groupId:s}:t!==h.FRIEND_REQUEST_SRC_CHAT&&t!==h.FRIEND_REQUEST_SRC_ECARD||(a={toUid:s})),je.a.setFriendRequestSource(e,t,a),Q.default.setSelectConversationSource(178006),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:e})}_loadMore(e=30,t=!1){let s=0;if(t&&this._waitingGroupPhoto){let e=this._waitingGroupPhoto.message;s=e[e.length-1].staredDttm}else s=this.state.starMsgs[this.state.starMsgs.length-1].staredDttm;s===this._lastLoaded||this._isLoading||(this._isLoading=!0,t||(this._lastLoaded=s),t?this._getStarMsgs(e,t,s+1):this._getStarMsgs(e,t,s-1))}_onScroll(){this._scrollBox&&this._scrollBox.getScrollTop()>=this._scrollBox.getScrollHeight()-this._scrollBox.getClientHeight()-10&&this._loadMore(),v.default.send(p.ConversationListActions.SCROLL_MENTION_LIST)}_renderItem(e,t){let s=null;if(e.message&&e.msgType==h.MSG_STICKER){let t=e.message.catId+"_"+e.message.id;s=this.state.thumb[t]}return o.a.createElement(on,{key:"msg_"+e.staredDttm,index:t,message:e,user:this.props.user,displayName:this._getFriendlyNames(e.toUid),dispatch:this.props.dispatch,onShowUserInfo:this._showUserInfo.bind(this),selectItem:this._goToMsg.bind(this,e,t),deleteMessage:this._deleteMessage.bind(this,e),stickerThumb:s,onImageClick:this._onClickImage.bind(this),unstared:this._unstared.bind(this,e),selected:t==this.state.selectedIndex})}_renderGroupItem(e,t){let s=-1;return o.a.createElement("div",{className:"star-msgs__group"},e.map((e=>(s++,this._renderItem(e,s+t)))))}render(){let e=this.state.starMsgs;if(e&&e.length>0){let t=m.b.groupMessageByDate(e,!0),s=[],a=0,n={date:{type:"DD/MM/YYYY"}};for(let e=0;e<t.length;e++){let i=t[e],r=te.a.contextDate(i.ts,n),l=new Date(i.ts);s.push(o.a.createElement("div",{key:"ld_"+l.getDate()+"_"+l.getMonth()+"_"+l.getYear(),className:i.items.length>1?" ":""},o.a.createElement("div",{className:"star-msgs__group__item__date"},r),this._renderGroupItem(i.items,a))),i.items.length&&(a+=i.items.length)}return o.a.createElement("div",{id:"chatStar",className:"star-msgs","data-id":"div_TabStar_StarList"},o.a.createElement(an,{autoHide:!0,noHScroll:!0,ref:e=>this._scrollBox=e,onScroll:this._onScroll.bind(this)},o.a.createElement("div",{className:"tab-title"},o.a.createElement(E.a,{textKey:"STR_STARRED_MESSAGES_TT"})),s))}return this.state.firstLoad?o.a.createElement("div",{className:"star-msgs"},o.a.createElement("div",{className:"tab-title"},o.a.createElement(E.a,{textKey:"STR_STARRED_MESSAGES_TT"})),o.a.createElement("div",{className:"media-empty-text"},o.a.createElement("div",null,o.a.createElement("img",{src:"assets/star-img-empty-v3.4ac8501c409c060b23aadf4764369f08.png",className:"empty-image"})),o.a.createElement("p",{style:{color:"var(--neutral-600)",fontSize:"14px",paddingLeft:"26px",paddingRight:"26px"},className:"media-empty-text__not-pictured"},o.a.createElement(E.a,{textKey:"STR_STAR_EMPTY_LIST"})))):null}}var cn=ln,dn=s("DWOr");const hn=zt.a;class un extends on{constructor(e){super(e),this.eventHandler=(e,t)=>{switch(e){case p.ConversationListActions.SCROLL_MENTION_LIST:this.menu&&this.menu.close()}},v.default.subscribe(this.eventHandler)}shouldComponentUpdate(e,t){return this.props.displayName!==e.displayName||this.props.highlight!==e.highlight}componentWillUnmount(){v.default.unsubscribe(this.eventHandler)}render(){let e=this.props.message,t=!1,s=e.message&&e.message.message?e.message.message:e.message;s=s.title?s.title:s;let a=null,n=null,i=ts.a.renderHtmlMessage(s,e.mentions,this.props.onShowUserInfo,this._getMentionedName.bind(this),null,this.props.dispatch,!1,null,!0,void 0,void 0,void 0,c.c.mentionItemContentLimit,c.c.mentionItemContentExtraLimit),r=null,l=null,d=null,p=k.default.getMiniInfo(e.fromUid);p&&(r=p.avatar,l=p.dName);let f=_.a.getHourTimeFromMilisecond(e.sendDttm),I=!1;switch(e.msgType){case h.MSG_CONTACT:if("recommened.link"===e.message.action){let s={};t=!0;try{s=JSON.parse(e.message.params)}catch(v){g.default.logCoreError(v)}if(s&&s.mediaTitle&&(d=s.mediaTitle),s&&s.src&&(a=s.src),I=m.b.isMultiURL(e&&e.message&&e.message.title,!0),I){n=null;break}n=e&&e.message.thumb?o.a.createElement(dn.a,{key:"star-msg-photo",className:"star-msgs__thumb clickable",noCache:!0,href:e.message.href,src:g.default.removeProtocol(e.message.thumb)}):o.a.createElement("div",{className:"star-msgs__thumb link-placeholder"})}break;case h.MSG_PHOTO:if(e.message&&e.message.thumbUrl){let{rotation:t,flip:s}=g.default.getImageMessageOrientation(e);n=o.a.createElement("div",{className:"thumb-border"},o.a.createElement(Aa.d,{key:"star-msg-photo",className:"star-msgs__thumbImageMsg clickable",src:e.message.thumbUrl?g.default.removeProtocol(e.message.thumbUrl):g.default.removeProtocol(e.message.oriUrl),cacheFolderName:e.message.thumbUrl?"Cache":null,conversationId:e.toUid,doNotShowRetry:!0,onClick:t=>{this.props.onImageClick(t,e)},userId:this.props.user.userId,style:{transform:`rotate(${t}deg) scaleX(${s})`}}))}}let T=[{textKey:"STR_JUMP_TO_MESSAGE",onclick:e=>this._gotoMsg(e,!0)},{textKey:"STR_DELETE_MSG",onclick:this._deleteMessage.bind(this)}];return o.a.createElement("div",{key:"msg_"+e.msgId,onContextMenu:this._onMenu.bind(this),className:"flx z-padding star-msgs__group__item canClick"+(this.props.highlight?" active-bg":""),onClick:e=>this._gotoMsg(e,!0)},o.a.createElement(u.b,{target:{avatar:r,displayName:l},size:"m",onClick:t=>{this._showUserInfo(t,e.fromUid)}}),o.a.createElement("div",{className:"z-ml"},o.a.createElement("div",{key:"title"},o.a.createElement("span",{className:"text-name user-name"},l," "),o.a.createElement(E.a,{className:"mention-text",textKey:"STR_MENTIONED_YOU"})),o.a.createElement("div",{className:"chat-info-mention__group__item__convName"},o.a.createElement("span",null,this.props.convName?this.props.convName:" "),o.a.createElement("span",null," - ",f||"")),!n&&!d||I?null:o.a.createElement("div",{className:"flx flx-al-s chat-info-mention__group__item__content "+(t?" clickable":"")},n||null,o.a.createElement("div",null,d?o.a.createElement("div",{className:"star-msgs__group__item__header truncate-item keepWord"+(e.msgType===h.MSG_FILE?" oneline":"")},d):null,a?o.a.createElement("div",{className:"star-msgs__group__item__desc truncate-item oneline"},a):null)),o.a.createElement("div",{className:"star-msgs__group__item__html"},i)),o.a.createElement("div",{className:"func-setting-container"},o.a.createElement(Za.default,{popoverProps:{identity:{windowId:"1",name:h.PopoverIdentitiesDefine.CHAT_BOX_MENTION}},ref:e=>this.menu=e,items:T})))}}var _n=class extends ln{constructor(e){super(e);let t={};this.mapUnreadMentions={},e&&e.conversations&&e.conversations.forEach((e=>{t[e.userId]=e.displayName,this.mapUnreadMentions[e.userId]=e.mentionUnreadCount||0})),this.state={messages:[],loaded:!1,convName:t,selectedIndex:null},this.storage=O.default,this._eventHandler=this._eventHandler.bind(this)}componentWillMount(){this._getMentions(30)}_eventHandler(e,t){if(!t)return;let s={};switch(e){case p.ChatBoxActions.UNDO_DELETE_MESSAGES:case p.FetchActions.ADD_MESSAGES:{let e=t.messages,s=this.state.messages.slice(0);for(let t=0;t<e.length;t++){if(e[t].mentions&&e[t].mentions.length>0)for(let a=0;a<e[t].mentions.length;a++)e[t].mentions[a].uid!==this.props.user.userId&&e[t].mentions[a].uid!==h.MENTION_ALL_ID||(e[t]&&e[t].toUid&&(this.mapUnreadMentions[e[t].toUid]=(this.mapUnreadMentions[e[t].toUid]||0)+1),s.unshift(e[t]));e[t]&&"0"==e[t].fromUid&&e[t].toUid&&(this.mapUnreadMentions[e[t].toUid]=0)}this.setState({messages:s});break}case p.FetchActions.GROUP_LEAVE:case p.FetchActions.DELETE_CONVERSATION:{let e=t;if(!e)break;let s=[];for(let t=0;t<this.state.messages.length;t++){let a=this.state.messages[t],n=a.toUid;n==e?this.mapUnreadMentions[n]=0:s.push(a)}this.setState({messages:s});break}case p.FetchActions.DELETE_MESSAGE:case p.ChatBoxActions.DELETE_MESSAGE:case p.FetchActions.DELETE_EVERYONE:case p.FetchActions.UNDO_MULTI:case p.FetchActions.UNDO:{if(!t.msgId&&e!==p.FetchActions.UNDO_MULTI)break;let a=[];a=e===p.FetchActions.UNDO_MULTI?t.map((e=>e.msgId)):t.msgId.contructor==Array?t.msgId:[t.msgId],a.forEach((e=>{s[e]=!0}));let n=[],i=(a.length,{});for(let e=0;e<this.state.messages.length;e++){let t=this.state.messages[e],a=t.toUid,o=t.msgId;i[a]||(i[a]=0),i[a]++,o&&s.hasOwnProperty(o)?this.mapUnreadMentions[a]&&i[a]<=this.mapUnreadMentions[a]&&(this.mapUnreadMentions[a]-=1):n.push(t)}this.setState({messages:n});break}case p.ChatBoxActions.DEL_CONVERSATION_PARTIAL:{if(!(e.payload&&e.payload.conversationId&&e.payload.msgId&&e.payload.sendDttm))break;if(!this.state.messages.length)break;this.state.messages.forEach((e=>{e&&e.toUid===t.conversationId&&(e.sendDttm>t.sendDttm||e.msgId>t.msgId||(s[e]=!0))}));let a=[],n={};for(let e=0;e<this.state.messages.length;e++){let t=this.state.messages[e],i=t.toUid,o=t.msgId;n[i]||(n[i]=0),n[i]++,o&&s.hasOwnProperty(o)?this.mapUnreadMentions[i]&&n[i]<=this.mapUnreadMentions[i]&&(this.mapUnreadMentions[i]-=1):a.push(t)}break}case p.FetchActions.UPDATE_MSG_ID:{const{mapDupMsgWithMsgIdMin:e}=t;let s=!1;const a=this.state.messages;if(!a||!a.length)break;for(let t=0;t<a.length;t++){const n=a[t],i=`${n.fromUid}_${n.cliMsgId}`;if(e[i]){const{newMsg:t,oldMsgId:a}=e[i],o=""+t.msgId;s=!0,g.default.stagingLog(`found msgId min update UI mention ${a} --\x3e ${o}`),n.msgId=o,n.zglobalMsgId=o,n.src=t.src,n.oldMsgId=a}}s&&this.setState({messages:a.slice()});break}}}componentDidMount(){if(v.default.subscribe(this._eventHandler),this.props.totalUnread&&(this.props.dispatch({type:p.ConversationListActions.CLEAR_MENTION_UNREAD}),this.props.conversations))for(let e=0;e<this.props.conversations.length;e++){let t=this.props.conversations[e];t.mentionUnreadCount&&O.default.updateConversation({userId:t.userId,mentionUnreadCount:0},["mentionUnreadCount"])}}componentWillUnmount(){v.default.unsubscribe(this._eventHandler)}_getMentions(e,t=null){this.storage.getMentions(e,t).then((e=>{this.setState({messages:e,loaded:!0,selectedIndex:null});let t={},s=!1;e.forEach((e=>{this.state.convName[e.toUid]||t[e.toUid]||(t[e.toUid]=!0,s=!0)})),t&&s&&this._getConvName(t)})).catch((e=>{this.setState({loaded:!0})}))}_getConvName(e){let t={},s=[];for(let a in e)a.startsWith(h.GROUPID_PREFIX)?s.push(a):t[a]=k.default.getDName(a);s.length>0&&rt.a.getGroupsByIds(s).then((e=>{for(let s in e)t[s]=e[s].displayName;Object.assign(t,this.state.convName),this.setState({convName:t})}))}shouldComponentUpdate(e,t){return this.state.messages!==t.messages||this.state.selectedIndex!=t.selectedIndex}_getFriendlyNames(e){let t=k.default.getDName(e);return t?"@"+t:null}_renderGroupItem(e,t,s){let a=-1;return o.a.createElement("div",{className:"chat-info-mention__group"},e.map((e=>{a++;let n=!1;return this.mapUnreadMentions.hasOwnProperty(e.toUid)&&(s[e.toUid]=s[e.toUid]||0,s[e.toUid]<this.mapUnreadMentions[e.toUid]&&(n=!0,s[e.toUid]++)),a+t===this.state.selectedIndex&&(n=!0),o.a.createElement(un,{key:"msg_"+e.msgId,message:e,user:this.props.user,highlight:n,convName:this.state.convName[e.toUid],onShowUserInfo:this._showUserInfo.bind(this),dispatch:this.props.dispatch,selectItem:this._goToMsg.bind(this,e,a+t),deleteMessage:this._deleteMessage.bind(this,e),onImageClick:this._onClickImage.bind(this)})})))}_loadMore(){let e=parseInt(this.state.messages[this.state.messages.length-1].msgId);this._loading||this._lastLoadId==e||(this._loading=!0,this.storage.getMentions(30,e-1).then((t=>{this.setState({messages:this.state.messages.concat(t)}),this._loading=!1,this._lastLoadId=e})))}render(){let e=this.state.messages;if(e&&e.length>0){let t=m.b.groupMessageByDate(e),s=[],a=null,n={},i=0,r={date:{type:"DD/MM/YYYY"}};for(let e=0;e<t.length;e++){let l={ts:t[e].ts,items:[]};if(t[e]&&t[e].items&&t[e].items.length>0)for(let s of t[e].items)se.a.isThreadHidden(s.toUid)||l.items.push(s);if(!l.items.length)continue;let c=te.a.contextDate(l.ts,r),d=new Date(l.ts),h=_.a.getDateYears(l.ts);null!==a&&a!==h&&(s.push(o.a.createElement("div",{className:"media-time-years",key:"y_"+h},o.a.createElement("span",null,"Năm ",h))),i+=1),s.push(o.a.createElement("div",{key:"ld_"+d.getDate()+"_"+d.getMonth()+"_"+d.getYear(),className:l.items.length>1?"items-mention--border":""},o.a.createElement("div",{className:"star-msgs__group__item__date"},c),this._renderGroupItem(l.items,i,n))),a=h,l.items.length&&(i+=l.items.length)}return o.a.createElement("div",{id:"chatMentions",className:"chat-info-mention"},o.a.createElement(hn,{autoHide:!0,noHScroll:!0,ref:e=>this._scrollBox=e,onScroll:this._onScroll.bind(this)},o.a.createElement("div",{className:"tab-title"},o.a.createElement(E.a,{textKey:"STR_CONFIG_NOTI"})),s))}return this.state.loaded?o.a.createElement("div",null,o.a.createElement("div",{className:"tab-title"},o.a.createElement(E.a,{textKey:"STR_CONFIG_NOTI"})),o.a.createElement("div",{className:"media-empty-text"},o.a.createElement("div",null,o.a.createElement("img",{src:"assets/mention-img-empty.b0ba64f8cf80d998a5331394e15d034e.png",className:"empty-image"})),o.a.createElement("p",{style:{color:"var(--neutral-600)",fontSize:"14px",paddingLeft:"26px",paddingRight:"26px"},className:"media-empty-text__not-pictured"},o.a.createElement(E.a,{textKey:"STR_MENTION_LIST_EMPTY_NOTICE"})))):null}},mn=s("79BI"),pn=s("+JmS");let gn=null;var En=function(e){const t=e.data.message,a=Object(pn.a)(),n=Object(i.useMemo)((()=>"0"===t.fromUid?k.default.getUidMe():t.fromUid),[t.fromUid]),r=Object(i.useCallback)((()=>k.default.getMiniInfo(n)||{}),[t]),[l,d]=Object(i.useState)(r()),[m,p]=Object(i.useState)(null);Object(i.useEffect)((()=>{O.default.getConversation(t.toUid).then((e=>{e&&p(e)})),g.default.isWeb()||(gn=s("vbkW").ipcRenderer)}),[]);const f=Object(i.useCallback)((()=>{H.a.closeModal({windowId:"1",name:h.ModalIdentitiesDefine.MSG_DETAIL})}),[]),I=Object(i.useCallback)((e=>{H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:n})}),[l]),v=Object(i.useMemo)((()=>o.a.createElement(u.b,{target:l,size:"m",onClick:I})),[l]),R=Object(i.useMemo)((()=>{let e=t.urgency;return e===h.URGENCY_MODE.IMPORTANT?"STR_IMPORTANT_MSG":e===h.URGENCY_MODE.URGENT?"STR_URGENT_MSG":""}),[t.notiType]),S=Object(i.useMemo)((()=>{let e=parseInt(t.sendDttm),s=new Date(e),a=_.a.textDate(s,new Date),n="";n=a?o.a.createElement(E.a,{textKey:a}):o.a.createElement("span",null,s.toLocaleDateString("en-GB"));let i=o.a.createElement("span",null,_.a.getHourTimeFromMilisecond(e));return o.a.createElement("div",{className:"msg-detail-send-date"},n," - ",i)}),[t.sendDttm]),N=Object(i.useMemo)((()=>{let e=t.message&&t.message.message?t.message.message:t.message;if(e=e.title?e.title:e,!e)return null;return ts.a.renderHtmlMessage(e,t.mentions,(e=>{}),(e=>{}),null,a,!1,null,!1,t)}),[t]),b=Object(i.useCallback)((()=>{switch(t.msgType){case h.MSG_PHOTO:{const s={user:e.user,userId:t.toUid,conversation:m,isVideo:!1,selectedId:null,isProfileImg:!0,href:g.default.removeProtocol(t.message.oriUrl),appConfig:Object(c.d)()};g.default.isWeb()||(s.appConfig={enable_feature_alias:c.c.enable_feature_alias,enable_stranger_alias:c.c.enable_stranger_alias}),sn.a.openPhotoViewer(s);break}case h.MSG_CONTACT:t.message&&"recommened.link"===t.message.action&&Ct.b.open(t.message.href)}}),[t,m]),C=Object(i.useMemo)((()=>{let e=null,s=null;switch(t.msgType){case h.MSG_PHOTO:t.message&&t.message.thumbUrl&&(e=o.a.createElement("img",{className:"msg-detail-thumb",src:t.message.thumbUrl,onClick:b}));break;case h.MSG_CONTACT:t.message&&"recommened.link"===t.message.action&&(t.message.thumb&&(e=o.a.createElement("img",{className:"flx-fix link-thumb msg-detail-thumb",src:t.message.thumb,onClick:b})),s=o.a.createElement("div",{className:"msg-detail-desc"},o.a.createElement("div",null,"[link]"),o.a.createElement("div",null,t.message.title)))}return e||s?o.a.createElement("div",{className:"flx",style:{paddingTop:"20px"}},e,s):null}),[t]);return o.a.createElement(H.d,{visible:!0,showCloseButton:!0,title:T.default.str("STR_MSG_DETAIL"),width:400,noPadding:!0,zIndex:99,onCancel:f,footer:{cancel:{textKey:"STR_CLOSE",click:f}}},o.a.createElement("div",{className:"msg-detail-popup"},o.a.createElement("div",{className:"flx msg-detail-info"},v,o.a.createElement("div",{className:""},o.a.createElement("div",{className:"msg-detail-urgency"},o.a.createElement(E.a,{className:"important-noti-item",textKey:R}),o.a.createElement("span",null,m?` - ${m.displayName}`:"")),S)),o.a.createElement("div",{className:"msg-detail-content"},N,C)))},fn=s("sqm0"),In=s("QQLV"),Tn=s("aQZC");new class{constructor(){this.showWarningPopup=null,this.checkStorageTimeoutId=null,this.checkStorageOnFocusTimeoutId=null}setShowWarningPopup(e){this.showWarningPopup=e}checkStorageOnFocus(){null===this.checkStorageOnFocusTimeoutId&&(this.checkStorageOnFocusTimeoutId=setTimeout((()=>{g.default.logCoreInfo("debugstorage: checkStorageOnFocus start"),this.checkStorageLimitExceeded(),setTimeout((()=>{this.checkStorageOnFocusTimeoutId&&(clearTimeout(this.checkStorageOnFocusTimeoutId),this.checkStorageOnFocusTimeoutId=null)}),3e5)}),3e3))}checkStorageLimitExceeded(){if(c.c.enable_check_storage)try{navigator.storage.estimate().then((e=>{e.quota<1073741824||e.usage+104857600>e.quota?(this.showWarningPopup&&this.showWarningPopup(!0),this.checkStorageCycle=9e5,null===this.checkStorageOnFocusTimeoutId&&Tn.a.wakeup(this.checkStorageOnFocus.bind(this))):(this.showWarningPopup&&this.showWarningPopup(!1),this.checkStorageCycle=36e5),this.startCheckingStorage()}))}catch(e){g.default.logCoreError("checkStorageLimitExceeded: "+e),this.stopCheckingStorage()}}startCheckingStorage(){c.c.enable_check_storage&&null===this.checkStorageTimeoutId&&(this.checkStorageTimeoutId=setTimeout((()=>{this.checkStorageLimitExceeded(),this.checkStorageTimeoutId=null}),this.checkStorageCycle||1e3))}stopCheckingStorage(){this.checkStorageTimeoutId&&(clearTimeout(this.checkStorageTimeoutId),this.checkStorageTimeoutId=null,this.checkStorageCycle=1e3)}requestQuota(e,t,s){try{navigator.webkitPersistentStorage.requestQuota(e,(e=>{window.webkitRequestFileSystem(window.PERSISTENT,e,t,s)}),s)}catch(a){g.default.logCoreError(a),s&&s()}}};o.a.Component;class vn extends o.a.Component{constructor(e){super(e),this.state={user_mode:h.USER_MODE.AVAILABLE,user:this.props.user,showClearStatus:!1},this.eventHandler=(e,t)=>{switch(e){case p.FetchActions.UPDATE_PROFILE_MODE:if(t){let e=g.default.verifyUserMode(t.user_mode);null!=e&&this.state.user.userId===t.userId&&this.setState({user_mode:e})}}},this._showExportPopup=this._showExportPopup.bind(this),this._showImportPopup=this._showImportPopup.bind(this),this.show=this.show.bind(this),this.close=this.close.bind(this),v.default.subscribe(this.eventHandler)}componentWillMount(){this.version=null,this.showWhatNew=!1;O.default.getCacheRecentUpdate();B.default.validateProfileMe();const e=e=>{Lt.Kha.error("[busy] updateMe= "+e.user_mode);let t=h.USER_MODE.AVAILABLE;1===c.c.enable_busy_mode&&e.user_mode&&(t=e.user_mode),this.setState({user:e,user_mode:g.default.verifyUserMode(t)}),this.props.onUpdateUserModeIfNeed&&this.props.onUpdateUserModeIfNeed(t)};O.default.getMe().then((t=>{t&&(Lt.Kha.error("[busy] storageMode= "+t.user_mode),e(t))})).catch((t=>{Lt.Kha.error("[busy] user not found"),B.default.updateProfileMe().then((t=>{e(t)})).catch((e=>{Lt.Kha.error("[busy] no profile me:"+JSON.stringify(e))}))}))}componentDidUpdate(){!0===this.isEditting&&(this.isEditting=!1)}componentWillReceiveProps(e){e.user&&!this.state.user&&this.setState({user:e.user})}componentWillUnmount(){v.default.unsubscribe(this.eventHandler)}onChangeMode(e){let t=g.default.verifyUserMode(e);if(this.state.user_mode===t)return;let s=g.default.verifyUserMode(this.state.user_mode),n=this.inputRef&&this.inputRef.value&&this.inputRef.value.length>0;this.setState({user_mode:t,showClearStatus:n});let i=()=>{this.setState({user_mode:t,showClearStatus:n})},o=()=>{R.a.createError(T.default.str("STR_ERROR_UPDATE_USER_MODE")),O.default.updateFriend(Object(a.a)(Object(a.a)({},this.state.user),{},{user_mode:s}),["user_mode"]),this.setState({user_mode:s})};switch(this.props.onChangeMode&&this.props.onChangeMode(t,i,o),t){case h.USER_MODE.AVAILABLE:I.e.logAction(1610102);break;case h.USER_MODE.AWAY:I.e.logAction(1610103);break;case h.USER_MODE.BUSY:I.e.logAction(1610104)}this.props.onCloseUserStatus&&this.props.onCloseUserStatus()}onUpdateProfile(){this.props.onUpdateProfile&&this.props.onUpdateProfile(),I.e.logAction(1610101)}onLogOut(){this.props.onLogOut&&this.props.onLogOut(),I.e.logAction(102015)}onWhatNew(){this.props.onWhatNew&&this.props.onWhatNew()}onInviteFriend(){this.props.onInviteFriend&&this.props.onInviteFriend(),I.e.logAction(1610201)}_showExportPopup(){H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.EXPORT,params:!0}),I.e.logAction(14410),this.props.cancel&&this.props.cancel()}_showImportPopup(){H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.IMPORT,params:!0}),I.e.logAction(14411),this.props.cancel&&this.props.cancel()}_toogleSetting(){H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.SETTINGS,params:!0}),this.props.cancel&&this.props.cancel()}show(e,t){this.menu&&this.menu.show(e,t)}close(){this.menu&&this.menu.close()}render(){if(!this.state.user)return null;let e=1===c.c.enable_busy_mode,t={type:Za.MENU_ITEM_TYPE.SEPARATE},s=[];if(e){const e=e=>{let t,s;switch(e){case h.USER_MODE.BUSY:t="STR_BUSY_MODE",s="busy busy-icon";break;case h.USER_MODE.AWAY:t="STR_AWAY_MODE",s="away away-icon";break;case h.USER_MODE.AVAILABLE:default:t="STR_AVAILABLE_MODE",s="round available-icon"}return{textKey:t,icon:s}};s.push(Object(a.a)(Object(a.a)({},e(this.state.user_mode)),{},{items:[Object(a.a)(Object(a.a)({},e(h.USER_MODE.AVAILABLE)),{},{checked:this.state.user_mode===h.USER_MODE.AVAILABLE,onclick:this.onChangeMode.bind(this,h.USER_MODE.AVAILABLE)}),Object(a.a)(Object(a.a)({},e(h.USER_MODE.BUSY)),{},{checked:this.state.user_mode===h.USER_MODE.BUSY,onclick:this.onChangeMode.bind(this,h.USER_MODE.BUSY)})]})),s.push(t)}return s.push({textKey:"STR_ACCCOUNT",icon:"outline-contact",onclick:this.onUpdateProfile.bind(this)}),s.push({textKey:"STR_MENU_SETTING",icon:"outline-settings",onclick:this._toogleSetting.bind(this)}),s.push(t),s.push({textKey:"STR_MENU_LOGOUT",onclick:this.onLogOut.bind(this),type:Za.MENU_ITEM_TYPE.DANGER}),this.showWhatNew,s.push(t),this.version?s.push({textKey:"STR_WHAT_S_NEW_1",textArguments:[this.version],onclick:this.onWhatNew.bind(this)}):s.push({textKey:"STR_WHAT_S_NEW",onclick:this.onWhatNew.bind(this)}),s.push({html:o.a.createElement("div",{className:"user-status-footer rel flx flx-al-c",onClick:this.onInviteFriend.bind(this)},o.a.createElement("div",{className:"footer-text"},o.a.createElement(E.a,{textKey:"STR_INVITE_FRIEND_5",tagName:"div"})),o.a.createElement("img",{className:"img-bg",src:"assets/z4w-banner.520ddc1d45dfb85a2c6a5f364fb9bad4.png"}))}),o.a.createElement(Za.default,{ref:e=>this.menu=e,popoverProps:this.props.popoverProps,items:s,style:{width:"204px"},expand:!0})}}var Rn=vn,Sn=s("OU7N"),On=s("UYGI"),Nn=s("X4fA"),bn=s("w1f3"),Cn=s("kcd5"),An=s("mM+3"),yn=s("h6DJ");let Dn;class Mn extends o.a.Component{constructor(e){super(e),Dn||(Dn=s("WyAD")),this._getData=this._getDataWeb.bind(this),this._update=this._update.bind(this)}shouldComponentUpdate(){return!1}componentWillUnmount(){this._intervalUpdate&&(clearInterval(this._intervalUpdate),delete this._intervalUpdate)}componentDidUpdate(){}componentDidMount(){this._init()}_getDataPC(){return new Promise(((e,t)=>t("not support")))}_getDataWeb(){let e=yn.a.getAnalys(),t=0;e.forEach((e=>{t=Math.max(e.data.cost,t)}));let s=t;return Promise.resolve({extData:{totalMem:"db_time"},labels:"",datasets:[{label:"",data:[s],backgroundColor:s<1e3?"#03A9F4":"#E91E63"}]})}_drawToolTipsPlugin(){return{beforeRender:function(e){e.config.options.showAllTooltips&&(e.pluginTooltips=[],e.config.data.datasets.forEach((function(t,s){t&&t.data&&t.data.length&&t.data[0]<0||e.getDatasetMeta(s).data.forEach((function(t,s){e.pluginTooltips.push(new Dn.Tooltip({_chart:e.chart,_chartInstance:e,_data:e.data,_options:e.options.tooltips,_active:[t]},e))}))})),e.options.tooltips.enabled=!1)},afterDraw:function(e,t){if(e.config.options.showAllTooltips){if(!e.allTooltipsOnce){if(1!==t)return;e.allTooltipsOnce=!0}e.options.tooltips.enabled=!0,Dn.helpers.each(e.pluginTooltips,(function(e){e.initialize(),e._options.yPadding=2,e.update(),e.pivot(),e.transition(t).draw()})),e.options.tooltips.enabled=!1}}}}_getOptionsDB(){return{responsive:!0,title:{display:!0,text:"db_time",fontColor:"var(--blue-300)",position:"bottom"},legend:{display:!1},scales:{xAxes:[{stacked:!0,display:!1}],yAxes:[{stacked:!0,display:!1,ticks:{beginAtZero:!0,steps:1e3,stepValue:10,suggestedMax:2e4}}]},showAllTooltips:!0}}_getOptions(){return{responsive:!0,title:{display:!0,text:"Mem",fontColor:"var(--blue-300)",position:"bottom"},legend:{display:!1},scales:{xAxes:[{stacked:!0,display:!1}],yAxes:[{stacked:!0,display:!1,ticks:{beginAtZero:!0,steps:200,stepValue:1,max:200}}]},showAllTooltips:!0}}_update(){if(Tn.a.isActive())this._lastActive=Date.now();else if(!this._lastActive||Date.now()-this._lastActive>=6e4)return;this._lastUpdate&&Date.now()-this._lastUpdate<this.__lastTimeInterval||(this._lastUpdate=Date.now(),An.a.intervalUpdate!==this.__lastTimeInterval&&this._reapplyInterval(An.a.intervalUpdate),this._updating||(this._updating=!0,this._getData().then((e=>{this.__update(e),this._updating=!1})).catch((e=>{this._updating=!1}))))}__update(e){if(!this._alreadyMount)return;if(!e)return!1;let t=e.datasets[0];this._myChart.data.datasets[0].data[0]=t.data[0],this._myChart.data.datasets[0].backgroundColor=t.backgroundColor,this._myChart.options.title.text=`${e.extData.totalMem} ms`,this._myChart.update()}_init(){!this._alreadyMount&&this._myRef&&Dn&&(this._lowValue=30,this._alreadyMount=!0,this._getData().then((e=>{this._alreadyMount&&this._myRef&&(this._myChart=new Dn(this._myRef.getContext("2d"),{type:"bar",data:e,options:this._getOptionsDB(),plugins:[this._drawToolTipsPlugin()]}),this._reapplyInterval(An.a.intervalUpdate))})).catch((e=>{g.default.logCoreError("[cpu-perf] err ",e)})))}_reapplyInterval(e){this._alreadyMount&&e!==this.__lastTimeInterval&&(this.__lastTimeInterval=e,this._intervalUpdate&&clearInterval(this._intervalUpdate),this._intervalUpdate=setInterval(this._update,e))}render(){return o.a.createElement("div",{className:"zcpu_widget"},o.a.createElement("canvas",{className:"zcpu_widget__canvas",width:66,height:140,ref:e=>{this._myRef=e}}))}}var Pn=Mn,wn=s("BZLJ");var Ln=new class{constructor(){this.subtab=null}updateSubTab(e){this.subtab=e}getHtmlForSearch(e){if(!e.content||!e.matchIndex)return null;let t=e.content,s=e.matchIndex,a=0,n=[];if(s.forEach(((e,s)=>{let i="";a<e.index&&(i=t.substring(a,e.index),i.length>50&&(i=i.substring(0,50)+"..."),n.push(o.a.createElement("span",{key:"search-todo-"+s},i))),i=t.substring(e.index,e.index+e.length),n.push(o.a.createElement("span",{key:"search-todo-match-"+s,className:"txt-highlight"},i)),a=e.index+e.length})),a<t.length){let e=t.substring(a);n.push(o.a.createElement("span",{key:"search-todo-match-"+s.length},e))}return n}sortResult(e){e.forEach((e=>{e.matchIndex&&1===e.matchIndex.length?e.score=2:e.scrore=1}));let t=Date.now();null!==this.subtab&&e.forEach((e=>{switch(this.subtab){case h.TODO_SECTION_INDEX_V2.OVERDUE:e.dueDate>0&&e.dueDate<t&&(e.score=10*e.score+2);break;case h.TODO_SECTION_INDEX_V2.DOING:e.status!==wn.g.IN_PROCESS&&e.status!==wn.g.WAITING_FOR_RESPONSE||(e.score=10*e.score+2);break;case h.TODO_SECTION_INDEX_V2.DONE:e.status===wn.g.DONE&&(e.score=10*e.score+2);break;default:e.score=10*e.score+1}})),e.forEach((e=>{e.status<1?e.score=10*e.score+2:e.score=10*e.score+1})),e.sort(((e,t)=>e.score===t.score?t.updateTime-e.updateTime:t.score-e.score)),e.forEach((e=>{delete e.score}))}findText(e,t,s){let a=-1;if(!e||!t||!s)return a;let n=[];if(s.length<=0)n=[{content:e,isValid:!0}];else{let t=0;if(s.forEach((s=>{if(t<s.index){let a=e.substring(t,s.index);n.push({content:a,isValid:!0})}let a=e.substring(s.index,s.index+s.length);n.push({content:a,isValid:!1}),t=s.index+s.length})),t<e.length){let s=e.substring(t);n.push({content:s,isValid:!0})}}let i=0;for(let o=0;o<n.length;o++){let e=n[o];if(e.isValid){let s=e.content.indexOf(t);if(s>=0){a=s+i;break}}i+=e.content.length}return a}insertMatches(e,t){if(e.length){for(let s=0;s<e.length;s++){if(e[s].index>t.index)return void e.splice(s,0,t)}e.push(t)}else e.push(t)}searchInList(e,t,s){if(!e)return[];let n=[],i=e=>{if(!e||!e.contentForSearch)return;let i=e.contentForSearch;if(!i)return;let o=i.indexOf(t),r=[];if(o>=0){let s=Object(a.a)({},e);s.matchIndex=[{index:o,length:t.length}],n.push(s)}else{let t=!0;for(let e=0;e<s.length;e++){let a=s[e],n=this.findText(i,a,r);if(n<0){t=!1;break}this.insertMatches(r,{index:n,length:a.length})}if(t){let t=Object(a.a)({},e);t.matchIndex=r,n.push(t)}}};if(e.constructor===Object)for(let a in e)i(e[a]);else e.constructor===Array&&e.forEach((e=>{i(e)}));return this.sortResult(n),n}check(e,t){if(!e)return!1;if(t.assignee){if(!e.assignees)return!1;{let s=!1;for(let a=0;a<e.assignees.length;a++)if(e.assignees[a]&&e.assignees[a].userId===t.assignee){s=!0;break}if(!s)return!1}}if(t.assigner&&e.creator!==t.assigner)return!1;if(null!=t.status&&!isNaN(t.status)&&e.status!==t.status)return!1;if(null!=t.status_lt&&!isNaN(t.status_lt)&&e.status>=t.status_lt)return!1;if(t.convId){let s="";if(e.extra&&e.extra.toUid&&(s=e.extra.toUid),e.extra&&e.extra.isGroup&&(s=h.GROUPID_PREFIX+s),s!==t.convId)return!1}let s=(e,t)=>{if(!t||!t[0]&&!t[1])return!0;if((t[0]||t[1])&&(!e||e<0))return!1;let s=new Date(e);s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0);let a=s.getTime();return!(t[0]&&a<t[0])&&!(t[1]&&a>t[1])};return!!(s(e.createTime,t.createDate)&&s(e.dueDate,t.dueDate)&&s(e.updateTime,t.updatedDate))}advancedFilter(e,t){let s=[];if(e){if(e.constructor===Object)for(let a in e)this.check(e[a],t)&&s.push(e[a]);else e.constructor===Array&&e.forEach((e=>{this.check(e,t)&&s.push(e)}));this.sortResult(s)}return s}},kn=s("0qCE"),xn=s("1ZEA");class Un extends o.a.Component{constructor(e){super(e),this.isFireFoxBrowser=this.isFireFox();let t=this.props.data,s=wn.g.IN_PROCESS;t&&(s=t.status);let a=wn.i.classifyTodoItem(t,this.props.user.userId);this.state={status:s,lang:T.default.currentLanguage(),isUnreadTodo:!1,refresh:!1,dingTimes:0,enableDing:!0,isExpired:!0===a.isExpired,inEditTitleMode:!1},this.updateLanguage=()=>{this.setState({lang:T.default.currentLanguage()})},T.default.callUpdate(this.updateLanguage),this.eventHandler=(e,t)=>{switch(e){case p.TodoActions.CREATE_TODO:case p.TodoActions.UPDATE_TODO:case p.TodoActions.REMOVE_TODO:case p.TodoActions.UPDATE_DING:{let e=this.__getData();t&&e&&(t.id===e.id||t===e.id)&&this.checkModifiedTodo();break}case p.TodoActions.MSG_CLEAR_UNREAD:if(t){let e=this.__getData();if(e){e.id===t&&this.onClearUnread()}}}},v.default.subscribe(this.eventHandler),this.onClearUnread=this.onClearUnread.bind(this),this.playHighlighAnimation=this.playHighlighAnimation.bind(this)}shouldComponentUpdate(e,t){return this.state.status!==t.status||this.state.lang!==t.lang||this.props.data!==e.data||this.state.isUnreadTodo!==t.isUnreadTodo||this.state.dingTimes!==t.dingTimes||this.props.data.isExpand!==e.data.isExpand||this.state.refresh!==t.refresh||this.state.enableDing!==t.enableDing||this.state.inEditTitleMode!==t.inEditTitleMode}componentWillReceiveProps(e){if(e&&e.data!==this.props.data){let t=!0===wn.i.classifyTodoItem(e.data,this.props.user.userId).isExpired;this.setState({isExpired:t})}}componentDidMount(){let e=this.__getData();if(e){let t=e.status;this.setState({status:t})}this.checkModifiedTodo(),this.playHighlighAnimation()}componentDidUpdate(){if(this.props.onDidUpdateSize){let e=this.__getData();if(this.mainDOM&&e){let t=this.mainDOM.offsetHeight;this.props.onDidUpdateSize(e.id,t)}}}componentWillUnmount(){T.default.removeUpdate(this.updateLanguage),v.default.unsubscribe(this.eventHandler)}__getData(){if(!this.props.data)return null;return Object(a.a)(Object(a.a)({},this.props.data),{},{dingTimes:this.state.dingTimes})}playHighlighAnimation(){let e=this.__getData();e&&setTimeout((()=>{if(wn.i.getTodoNeedAnimation()===e.id){let e=0;const t=()=>{e>=2||(this.mainDOM?(this.mainDOM.className+=" need-animation",wn.i.setTodoNeedAnimation(null),setTimeout((()=>{this.mainDOM&&(this.mainDOM.className=this.mainDOM.className.replace("need-animation",""))}),1e3),this.onClearUnread()):(e++,t()))};t()}}),500)}onShowMenu(e){this.onShowContextMenu(e),e&&(e.preventDefault(),e.stopPropagation())}onEdit(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.props.onShowDetail){let e=this.__getData();this.props.onShowDetail(e)}}onViewDetailIconClick(e){e&&(e.preventDefault(),e.stopPropagation()),this.onEdit(e),this.props.tabIndex===h.TODO_TAB_INDEX.I_ASSIGNED?I.e.logAction(1710105):this.props.tabIndex===h.TODO_TAB_INDEX.ASSIGNED_TO_ME&&I.e.logAction(1710205)}onAddDueDateClick(e){e&&(e.preventDefault(),e.stopPropagation()),this.onEdit(e),I.e.logAction(1710108)}onItemClick(){let e=this.__getData();e&&this.props.onItemClick&&this.props.onItemClick(e,this.props.index,!1,!1),this.onEdit(),this.onClearUnread();let t=wn.i.getViewPopupTodoSrc();I.e.logAction(171160+t)}onJumpMsg(e){e&&(e.stopPropagation(),e.preventDefault()),this.props.onJumpMsg&&this.props.onJumpMsg(this.__getData(),this.props.index),this.onClearUnread(),this.props.tabIndex===h.TODO_TAB_INDEX.I_ASSIGNED?I.e.logAction(1710107):this.props.tabIndex===h.TODO_TAB_INDEX.ASSIGNED_TO_ME?I.e.logAction(1710207):this.props.tabIndex===h.TODO_TAB_INDEX.WATCHERS&&I.e.logAction(1710307)}onShowContextMenu(e){this.props.onShowAction&&this.props.onShowAction(e,this.__getData())}checkModifiedTodo(){let e=this.__getData();if(!e)return null;let t=e.id,s=wn.i.isUnreadTodo(t),a=wn.i.getDingCount(t);this.setState({isUnreadTodo:s,dingTimes:a})}onClearUnread(){if(!0===this.state.isUnreadTodo){let e=this.__getData();if(e){let t=e.id;wn.i.clearUnreadTodo(t)}this.setState({isUnreadTodo:!1}),this.props.onClearUnread&&this.props.onClearUnread()}}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}onReceivedJob(e){e&&(e.preventDefault(),e.stopPropagation()),this.state.dingTimes>0&&this.onUpdate(),this.onClearUnread(),this.onChangeStatus(wn.g.IN_PROCESS),I.e.logAction(1710214)}onDoneJob(e){e&&(e.preventDefault(),e.stopPropagation()),this.onClearUnread();let t=this.__getData();t&&wn.i.clearDingTodo(t.id),this.onChangeStatus(wn.g.DONE);let s=t.creator,a=t.extra;if(a){if(a.constructor===String)try{a=JSON.parse(a)}catch(o){}}else a={};let n=!!a.isGroup,i=a.toUid;!0===n?i=h.GROUPID_PREFIX+i:s!==this.props.user.userId&&(i=s),i!==this.props.user.userId&&S.a.gotoConversation(i,this.props.dispatch),this.props.tabIndex===h.TODO_TAB_INDEX.I_ASSIGNED?I.e.logAction(1710110):this.props.tabIndex===h.TODO_TAB_INDEX.ASSIGNED_TO_ME&&I.e.logAction(1710210)}onReopenJob(e){e&&(e.preventDefault(),e.stopPropagation()),this.onClearUnread(),this.onChangeStatus(wn.g.IN_PROCESS),I.e.logAction(1710301)}onChangeStatus(e){kn.a.changeTaskStatus(this.state.status,e,this.__getData(),this.props.user.userId,this.props.confirm)}onViewProfile(e,t){e&&(e.stopPropagation(),e.preventDefault()),Q.default.setSelectConversationSource(178019),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:t})}onClickShowUserStats(e,t,s){s&&(s.preventDefault(),s.stopPropagation()),this.props.openStatsByUser(e,t),this.props.tabIndex===h.TODO_TAB_INDEX.I_ASSIGNED?I.e.logAction(1710106):this.props.tabIndex===h.TODO_TAB_INDEX.ASSIGNED_TO_ME?I.e.logAction(1710206):this.props.tabIndex===h.TODO_TAB_INDEX.WATCHERS&&I.e.logAction(1710306)}onShowComment(e){this.props.onShowComment&&this.props.onShowComment(e,this.__getData())}onRemind(e){e&&(e.stopPropagation(),e.preventDefault()),this.onClearUnread();let t=this.__getData();!0!==kn.a.remindMyself(t,this.props.user.userId)&&!0===this.state.enableDing&&(this.setState({enableDing:!1}),setTimeout((()=>{this.setState({enableDing:!0}),kn.a.remindTask(t,this.props.user.userId,this.props.dispatch).then((e=>{this.checkModifiedTodo()}))}),500),this.props.tabIndex===h.TODO_TAB_INDEX.I_ASSIGNED&&I.e.logAction(1710109))}onUpdate(e){e&&(e.stopPropagation(),e.preventDefault()),kn.a.todoDingACK(this.__getData(),this.props.dispatch).then((e=>{this.setState({dingTimes:0})})),this.onClearUnread(),I.e.logAction(1710209)}onOpenPopupViewStatus(e,t=!1){e&&(e.stopPropagation(),e.preventDefault()),this.onCloseUserList(e),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_EDITOR,params:Object(a.a)(Object(a.a)({},this.__getData()),{},{focusStatus:!0,isEdit:!0})}),!0===t&&(this.props.tabIndex===h.TODO_TAB_INDEX.I_ASSIGNED?I.e.logAction(1710108):this.props.tabIndex===h.TODO_TAB_INDEX.ASSIGNED_TO_ME?I.e.logAction(1710208):this.props.tabIndex===h.TODO_TAB_INDEX.WATCHERS&&I.e.logAction(1710308))}onShowUserList(e){}onCloseUserList(e){}onEditTitle(e){e&&(e.stopPropagation(),e.preventDefault()),this.setState({inEditTitleMode:!0}),requestAnimationFrame((()=>{if(this.inputTitleDOM){let e=this.__getData();if(e){let t=e.description;t&&(this.inputTitleDOM.value=t)}this.inputTitleDOM.focus()}}))}onBlurTitle(e){e&&(e.stopPropagation(),e.preventDefault()),this.setState({inEditTitleMode:!1});let t=this.__getData();if(t&&this.inputTitleDOM){let e=this.inputTitleDOM.value;e=e.trim(),e!==t.description&&(t.description=e,wn.i.updateTodo(t,!0).then((e=>{})).catch((e=>{R.a.createError(T.default.str("STR_UPDATE_TITLE_TODO_FAILED")),this.onEditTitle()})))}}onKeyDown(e){e&&e.which===h.K_ENTER&&this.onBlurTitle(e)}render(){let e=this.__getData();if(!e)return null;let t=e.isExpand,s=e.creator,n=g.default.getStringByLength(k.default.getDName(s)),i=!1,r=null,l=null,c=wn.i.getDebugMode();this.props.user&&s===this.props.user.userId?i=!0:(r=k.default.getMiniInfo(s),r=r?Object(a.a)(Object(a.a)({},r),{},{uid:s}):{avatar:"",dName:"",uid:s});this.state.isExpired;let d=e.assignees||[],m=e.watchers||[],p=[],I="",v=[],R=!1,S=!1,O=0,N=0,b=0,C=this.state.isUnreadTodo;if(this.completedList=null,this.receivedList=null,this.pendingList=null,d){if(d.constructor===Object){let e=[];for(let t in d)d.hasOwnProperty(t)&&e.push({id:t});d=e}for(let e=0;e<d.length;e++){let t=d[e];if(t){let e=wn.i.getUserId(t),s=k.default.getMiniInfo(e);g.default.getStringByLength(s?s.dName:t.dpn);switch(t.status){case wn.g.WAITING_FOR_RESPONSE:b++,this.pendingList||(this.pendingList={}),this.pendingList[e]=!0;break;case wn.g.IN_PROCESS:N++,this.receivedList||(this.receivedList={}),this.receivedList[e]=!0;break;case wn.g.DONE:O++,this.completedList||(this.completedList={}),this.completedList[e]=!0}r||!0!==i||(r=s?Object(a.a)(Object(a.a)({},s),{},{uid:e}):{dName:t.dpn,avatar:"",uid:e}),l||e!==this.props.user.userId&&(l=s?Object(a.a)(Object(a.a)({},s),{},{uid:e}):{dName:t.dpn,avatar:"",uid:e}),e===this.props.user.userId&&(R=!0)}}if(d.length>=1){let e=d[0];if(e){let t=wn.i.getUserId(e),s=k.default.getMiniInfo(t);s||(s=Object(a.a)(Object(a.a)({},e),{},{uid:t}));let n=g.default.getStringByLength(s.dName||s.dpn);p.push(o.a.createElement(f.a,{tagName:"span",key:"assignees-item-0",className:"highlight-cta",onClick:e=>this.onClickShowUserStats(t,h.TODO_ROLE.ASSIGNEE,e),textKey:!0===i?"STR_TODO_TIP_AVATAR_1":"",textArguments:[n]},n)),I+=n,d.length>1&&(p.push(o.a.createElement(E.a,{textKey:"STR_AND",key:"assignees-and"})),I+=T.default.str("STR_AND")),2===d.length?(p.push(o.a.createElement(E.a,{textKey:"STR_A_OTHER_PERSON",key:"assignees-onemore",className:"highlight-cta nor-txt",onClick:e=>this.onOpenPopupViewStatus(e)})),I+=T.default.str("STR_A_OTHER_PERSON")):d.length>2&&(p.push(o.a.createElement(E.a,{textKey:"STR_X_OTHER_PEOPLE",textArguments:[d.length-1],key:"assignees-nmore",className:"highlight-cta nor-txt",onClick:e=>this.onOpenPopupViewStatus(e)})),I+=T.default.trans("STR_X_OTHER_PEOPLE",[d.length-1]))}}}if(m){for(let e=0;e<m.length;e++){let t=m[e];if(t){if(wn.i.getUserId(t)===this.props.user.userId){S=!0;break}}}if(m.length>=1){let e=m[0];if(e){let t=wn.i.getUserId(e),s=k.default.getMiniInfo(t);s||(s=Object(a.a)(Object(a.a)({},e),{},{uid:t}));let n=g.default.getStringByLength(s.dName||s.dpn);v.push(o.a.createElement("span",{key:"watchers-item-0",className:"highlight-cta",onClick:e=>this.onViewProfile(e,t)},n)),m.length>1&&v.push(o.a.createElement(E.a,{textKey:"STR_AND",key:"watchers-and"})),2===m.length?v.push(o.a.createElement(E.a,{textKey:"STR_A_OTHER_PERSON",key:"watchers-onemore",className:"highlight-cta nor-txt",onClick:e=>this.onOpenPopupViewStatus(e)})):m.length>2&&v.push(o.a.createElement(E.a,{textKey:"STR_X_OTHER_PEOPLE",textArguments:[m.length-1],key:"watchers-nmore",className:"highlight-cta nor-txt",onClick:e=>this.onOpenPopupViewStatus(e)}))}}}let A=wn.i.getMyStatus(e,this.props.user.userId),y=kn.a.getStatusView(i,S,R,O,N,b,d.length,A,n,I,null,{noIcon:!0,textStyle:{},textClassName:A===wn.g.DONE?null:"td-status-v3"},this.onShowUserList.bind(this),this.onCloseUserList.bind(this));!0===c.status&&(y=null);let D=e.due_date||e.dueDate;if(D>0&&this.state.status!==wn.g.DONE){D=new Date(D);let e=_.a.getDeltaTime(Date.now(),D);e=e.day,D=o.a.createElement("div",{className:"todo-due-date td-list-item td-item-in-list f12 truncate "+(this.state.isExpired?"time-expired":""),style:{margin:0}},o.a.createElement("div",{className:"truncate",style:{margin:0,color:this.state.isExpired?"":"var(--neutral-600)",flex:1}},o.a.createElement("div",{className:"todo-item-status-remind v3 truncate no-margin",style:{width:"100%"}},o.a.createElement(E.a,{textKey:"STR_TO_DATE"})," ",o.a.createElement("span",{style:{textTransform:e<1?"lowercase":""}},te.a.contextDate(D,{time:e<1?"HH:mm":null,date:{type:"DD/MM"},format:"time-first"}))," ",this.state.isExpired?o.a.createElement(E.a,{textKey:e>1?"STR_EXPIRED_N_DAYS":1===e?"STR_EXPIRED_A_DAY":"STR_EXPIRED_0_DAY",textArguments:[e]}):null)))}else D=null;!0===c.due_date&&(D=null);let M=e.extra;if(M){if(M.constructor===String)try{M=JSON.parse(M)}catch(K){}}else M={};r||(r={}),l||(l=r);let P=null;this.props.subTabIndex,h.TODO_SECTION_INDEX_V2.DONE,P=o.a.createElement("span",{style:{color:"var(--neutral-600)"}},te.a.contextDate(e.updateTime,{time:"HH:mm",date:{type:"DD/MM"},format:"time-range"})),!0===c.update_time&&(P=null);let w=null;w=!0===R?o.a.createElement(u.b,{textKey:!0===i?"STR_TODO_TIP_AVATAR_3":"STR_TODO_TIP_AVATAR_2",textArguments:[r?r.dName:""],target:r,size:"s",showUnread:!1,outline:!0,className:"td-info-avatar",onClick:e=>this.onClickShowUserStats(r.uid,i?h.TODO_ROLE.ASSIGNEE:h.TODO_ROLE.ASSIGNER,e)}):o.a.createElement(u.b,{textKey:"STR_TODO_TIP_AVATAR_1",textArguments:[l?l.dName:""],target:l,size:"s",showUnread:!1,outline:!0,className:"td-info-avatar",onClick:e=>this.onClickShowUserStats(l.uid,h.TODO_ROLE.ASSIGNEE,e)}),!0===c.avatar&&(w=null);!0===c.username||(!0===R&&!0===i?(E.a,d&&d.length>1&&E.a,d&&d.length>1&&(d.length>2?(E.a,d.length):(f.a,l&&l.dName,l.dName))):!0===R?(f.a,r&&r.dName,g.default.getStringByLength(r.dName),E.a):E.a),this.onShowMenu.bind(this);let L=null;L=e&&e.matchIndex?Ln.getHtmlForSearch(e):te.a.getHtmlFromText(e.content),!0===c.content&&(L=null);let x=null,U=null,F=null;if(A!==wn.g.DONE)if((!0!==R||!0===R&&d.length>1)&&!0===i||!0===i){let e=this.state.dingTimes,t="STR_REMIND_N";e<1||!e?t="STR_REMIND_1":1===e?t="STR_REMIND_2":2===e&&(t="STR_REMIND_3"),x=o.a.createElement(f.a,{tagName:"i",textKey:"STR_TODO_TOOLTIP_4",textArguments:[I],className:"fa fa-icn_todo_list_menu_ping",onClick:this.onRemind.bind(this),"data-id":this.props.getDataId?this.props.getDataId(this.props.tabIndex).remindBtn:""})}else!0===R&&!0!==i?(U=this.state.dingTimes,U=U>0?o.a.createElement("span",{className:"ding"+(U>=3?" bg-v2-high":U>=2?" bg-v2-medium":"")},o.a.createElement(u.b,{target:r,size:"xs",showUnread:!1,outline:!0,className:"avatar"}),o.a.createElement(E.a,{textKey:A===wn.g.WAITING_FOR_RESPONSE?"STR_TIP_A_REMINDED_ACK_2":"STR_TIP_A_REMINDED_ACK",textArguments:[n],style:{fontSize:"12px"}}),o.a.createElement("div",{className:"arrow"+(U>=3?" arrow-bg-high":U>=2?" arrow-bg-medium":"")})):null,x=o.a.createElement(f.a,{tagName:"i",className:"fa fa-icn_todo_list_menu_reply",onClick:this.onUpdate.bind(this),textKey:"STR_TODO_HINT_7",textArguments:[n]}),A===wn.g.WAITING_FOR_RESPONSE?F=o.a.createElement("div",{className:"todo-status-button-v3 btn-item-v3",onClick:this.onReceivedJob.bind(this)},o.a.createElement(E.a,{tagName:"div",textKey:"STR_TODO_RECEIVE_TASK",className:"button-inside"+(U?" active-nd-state":""),"data-id":this.props.getDataId?this.props.getDataId(this.props.tabIndex).acceptBtn:""})):this.state.dingTimes>0&&(F=o.a.createElement(f.a,{tagName:"div",textKey:"STR_TODO_HINT_7",textArguments:[n],className:"todo-status-button-v3 btn-item-v3",onClick:this.onUpdate.bind(this)},o.a.createElement(E.a,{textKey:"STR_REPORT",tagName:"div",className:"button-inside"+(U?" active-nd-state":"")})))):x=null;let G=null;if(R||i)switch(A){case wn.g.WAITING_FOR_RESPONSE:if(s!==this.props.user.userId){G=o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("div",{className:"todo-status-button-v3",onClick:this.onReceivedJob.bind(this)},o.a.createElement(E.a,{tagName:"div",textKey:"STR_TODO_RECEIVE_TASK",className:"button-inside"+(U?" active-nd-state":"")})),o.a.createElement(f.a,{tagName:"div",textKey:"",className:"todo-status-button-v3"+(x?" has-ding":""),onClick:this.onDoneJob.bind(this),style:{marginLeft:0}},o.a.createElement(E.a,{tagName:"div",textKey:"STR_COMPLETE",className:"button-inside"})));break}case wn.g.IN_PROCESS:{let e=!(!0!==i||this.props.tabIndex===h.TODO_TAB_INDEX.ASSIGNED_TO_ME);G=o.a.createElement(f.a,{tagName:"div",textKey:!0===e?"STR_TODO_HINT_4":"",textArguments:[I],className:"todo-status-button-v3"+(x?" has-ding":""),onClick:this.onDoneJob.bind(this)},o.a.createElement(E.a,{tagName:"div",textKey:"STR_COMPLETE",className:"button-inside"}));break}case wn.g.DONE:G=o.a.createElement(f.a,{tagName:"div",textKey:s===this.props.user.userId?"STR_TODO_HINT_6":"",textArguments:[I],className:"todo-status-button-v3"+(x?" has-ding":""),onClick:this.onReopenJob.bind(this)},o.a.createElement(E.a,{tagName:"div",textKey:"STR_REOPEN_TASK_ASSIGNEE",className:"button-inside"}))}G=U||x||G?o.a.createElement("div",{style:{display:"flex",marginTop:"-10px"}},U,x,G,o.a.createElement("div",{style:{flex:1}}),null):null,!0===c.buttons&&(G=null);let B=null,H=A===wn.g.DONE?this.props.tabIndex!==h.TODO_TAB_INDEX.DONE&&this.props.subTabIndex===h.TODO_SECTION_INDEX_V2.DOING?" mark-done":" mark-done-const":"";if(!0===this.state.inEditTitleMode)B=o.a.createElement(xn.a,{tagName:"input",textKey:"STR_INPUT_TASK_TITLE",inputRef:e=>this.inputTitleDOM=e,onBlur:this.onBlurTitle.bind(this),onKeyDown:this.onKeyDown.bind(this),maxLength:100,className:"td-input-title"});else if(e.description){let s=t?e.description:g.default.getFirstParagraph(e.description,!0);B=o.a.createElement("div",{className:"todo-item-description "+H,style:{margin:0,fontSize:"16px"}},o.a.createElement("div",{className:"truncate"},te.a.getHtmlFromText(s)))}else B=!0===i?o.a.createElement(f.a,{tagName:"div",textKey:"STR_CLICK_TO_ENTER_TITLE",className:"todo-add-title v3"+H},o.a.createElement(E.a,{textKey:"STR_NO_TITLE",tagName:"div",className:"td-gray-txt-v3"}),o.a.createElement("i",{className:"fa fa-edit-name title-edit-v3",onClick:this.onEditTitle.bind(this)})):o.a.createElement("div",{className:"todo-add-title v3"+H},o.a.createElement(E.a,{textKey:"STR_NO_TITLE",tagName:"div",className:"td-gray-txt-v3"}));!0===c.description&&(B=null);let j=null;m&&m.length>0&&(j=o.a.createElement("div",{className:"todo-due-date td-list-item td-item-in-list f12",style:{marginTop:"10px",color:"var(--neutral-300)",marginRight:"14px"}},o.a.createElement("i",{className:"fa fa-cc-user",style:{marginRight:"7px",position:"relative",top:"1px",color:"var(--dark-blue-200)"}}),o.a.createElement(E.a,{textKey:"STR_WATCHERS"})," ",v)),!0===c.cc&&(j=null);let V="transparent";if(!0===this.state.isExpired)V="var(--red-300)";else switch(A){case wn.g.WAITING_FOR_RESPONSE:V="var(--blue-400)";break;case wn.g.IN_PROCESS:V="var(--purple-300)";break;case wn.g.DONE:V="var(--green-300)"}{let t=o.a.createElement("div",{className:"td-more-actions"},o.a.createElement(f.a,{tagName:"i",textKey:"STR_JUMP_TO_MESSAGE",className:"fa fa-icn_todo_list_menu_jump",onClick:this.onJumpMsg.bind(this),style:{fontSize:"14px"},"data-id":this.props.getDataId?this.props.getDataId(this.props.tabIndex).jumpBtn:""}),x,o.a.createElement("i",{className:"fa fa-icn_todo_list_menu","data-id":this.props.getDataId?this.props.getDataId(this.props.tabIndex).cxBtn:"",onClick:this.onShowMenu.bind(this)})),s=d.length-1;return o.a.createElement("div",{className:"td-item-v3",onClick:this.onItemClick.bind(this),onContextMenu:this.onShowContextMenu.bind(this),ref:e=>this.mainDOM=e},o.a.createElement("div",{className:"td-avatar-v3"},o.a.createElement("div",{style:{zIndex:1}},w),s>0&&this.props.tabIndex!==h.TODO_TAB_INDEX.ASSIGNED_TO_ME?o.a.createElement("div",{className:"td-ava-count"},o.a.createElement("div",null,s>99?"99+":`+${s}`)):null),o.a.createElement("i",{className:"td-check-ico fa"+(A===wn.g.DONE?" td-done":""),onClick:A===wn.g.DONE?this.onReopenJob.bind(this):this.onDoneJob.bind(this),"data-id":this.props.getDataId?A===wn.g.DONE?this.props.getDataId(this.state.tab).reassignBtn:this.props.getDataId(this.state.tab).cmpltBtn:""}),o.a.createElement("div",{className:"td-item-content-v3"},o.a.createElement("div",{className:"td-title-container"},o.a.createElement("div",{style:{flex:1,minHeight:"25px"},className:"truncate",title:e.description},B),o.a.createElement("span",{className:"td-time"},P),t),o.a.createElement("div",{className:"td-content-container"},o.a.createElement("div",{className:"td-content truncate"+(e.description?"":" td-content-no-title"),title:e.content},L),!0===C?o.a.createElement("div",{style:{width:"10px",height:"10px",borderRadius:"5px",position:"relative",top:"2px",background:"var(--red-300)",margin:"6px"}}):null),o.a.createElement("div",{className:"td-status",style:{marginTop:F?"2px":""}},F?o.a.createElement("div",{style:{display:"flex",marginBottom:"6px"}},U,F):o.a.createElement("div",{style:{position:"relative"}},y),o.a.createElement("div",{style:{flex:1}}),o.a.createElement("div",{style:{marginTop:F?"8px":"0",maxWidth:"70%"}},D))),o.a.createElement("div",{style:{background:"var(--grey-600)",height:"1px",width:"calc(100% - 50px)",position:"absolute",bottom:"1px",right:0}}))}}}var Fn=Un,Gn=s("Ir/V"),Bn=s.n(Gn);class Hn extends o.a.Component{constructor(e){super(e),this.state={isContextMenuShown:!1,data:null},this.setData=this.setData.bind(this),this.onClose=this.onClose.bind(this)}shouldComponentUpdate(e,t){return this.state.isContextMenuShown!==t.isContextMenuShown||this.state.data!==t.data||this.props.tabIndex!==e.tabIndex}_onContextMenuStateUpdate(e){this.setState({isContextMenuShown:e})}showAction(e,t=null){this.menu&&this.menu.show(e)}onShowDetail(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.onShowTodoDetail&&this.props.onShowTodoDetail(),this.logAction(19)}onJumpMsg(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.onJumpMsg&&this.props.onJumpMsg(),this.logAction(16)}onDelete(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.onDeleteTodo&&this.props.onDeleteTodo(),this.logAction(22)}onClose(){this.menu&&this.menu.close()}onPageClick(e){e&&(e.preventDefault(),e.stopPropagation())}setData(e){this.setState({data:e})}onReceiveJob(e){e&&(e.preventDefault(),e.stopPropagation()),this.onChangeStatus(wn.g.IN_PROCESS),this.logAction(22)}onDone(e){e&&(e.preventDefault(),e.stopPropagation()),this.onChangeStatus(wn.g.DONE),this.logAction(20)}onReopen(e){e&&(e.preventDefault(),e.stopPropagation()),this.onChangeStatus(wn.g.IN_PROCESS),this.logAction(21)}onChangeStatus(e){let t=this.state.data||this.props.data;t&&kn.a.changeTaskStatus(t.status,e,t,this.props.user.userId,this.props.confirm)}onRemind(e){e&&(e.stopPropagation(),e.preventDefault());let t=this.props.user,s=this.state.data||this.props.data;s&&!0!==kn.a.remindMyself(s,this.props.user.userId)&&(kn.a.remindTask(s,t.userId,this.props.dispatch),this.logAction(17))}onReport(e,t=!0){e&&(e.stopPropagation(),e.preventDefault());let s=this.state.data||this.props.data;s&&(kn.a.todoDingACK(s,this.props.dispatch,this.props.user.userId),!0===t?this.logAction(17):this.logAction(18))}logAction(e){let t=171e4;switch(this.props.tabIndex){case h.TODO_TAB_INDEX.I_ASSIGNED:t+=100;break;case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:t+=200;break;case h.TODO_TAB_INDEX.WATCHERS:t+=300}t+=e,I.e.logAction(t)}render(){let e=this.props.user,t=this.state.data||this.props.data,s=!1;e&&t&&e.userId===t.creator&&(s=!0);let a=wn.i.classifyTodoItem(t,e.userId),n=!!a&&a.isAssignee,i=!!a&&a.isCreator,r=!!a&&a.isWatcher,l=[];if(l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_VIEW_TODO_HEADER_2"),onclick:e=>this.onShowDetail(e),icon:"icn_todo_list_menu_detail"}),t&&this.props.tabIndex!==h.TODO_TAB_INDEX.WATCHERS){t.status===wn.g.WAITING_FOR_RESPONSE&&!0!==s&&l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_TODO_RECEIVE_TASK"),onclick:e=>this.onReceiveJob(e),icon:"icn_todo_list_menu_confirm"})}if(t&&t.status!==wn.g.DONE&&!0===n&&!0!==i&&l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_REPORT"),onclick:e=>this.onReport(e),icon:"icn_todo_list_menu_reply"}),(!0===i||!0===r&&!0!==n)&&(t&&t.status!==wn.g.DONE&&!0===i&&l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_REMIND_1"),onclick:e=>this.onRemind(e),icon:"icn_todo_list_menu_ping"}),l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_COMMENT_MSG"),onclick:e=>this.onReport(e),icon:"icn_todo_list_menu_reply"})),t&&this.props.tabIndex!==h.TODO_TAB_INDEX.WATCHERS){let e=t.status;e<wn.g.DONE?l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_COMPLETE_TASK"),onclick:e=>this.onDone(e),icon:"icn_todo_list_menu_complete"}):e===wn.g.DONE&&l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_REOPEN_TASK_ASSIGNEE"),onclick:e=>this.onReopen(e),icon:"icn_todo_list_menu_reopen"})}return l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_JUMP_TO_MESSAGE"),onclick:e=>this.onJumpMsg(e),icon:"icn_todo_list_menu_jump"}),s&&l.push({type:Za.MENU_ITEM_TYPE.NORMAL,text:T.default.str("STR_REMOVE_TODO"),onclick:e=>this.onDelete(e),icon:"icn_todo_list_menu_delete"}),o.a.createElement(Za.default,{popoverProps:{identity:{windowId:"1",name:h.PopoverIdentitiesDefine.TODO_ACTION}},ref:e=>this.menu=e,items:l})}}var jn=Hn;const Vn=1,Kn=2;class Wn extends o.a.Component{constructor(e){super(e),this.state={selected:null,currentOptions:this.props.options||[],showDropdown:!!e.showDropdown,dropdownValue:e.dropdownValue||-1},this.onBlurDropdown=this.onBlurDropdown.bind(this),this.id="search-dropdown-"+Us.a.next()}shouldComponentUpdate(e,t){return this.state.showDropdown!==t.showDropdown||this.state.currentOptions!==t.currentOptions||this.state.selected!==t.selected}onBlurDropdown(e){if(e.target&&e.target.closest){e.target.closest("#"+this.id)||this._showDropdown(!1)}}componentDidMount(){document.addEventListener("click",this.onBlurDropdown),this._input&&this.props.autofocus&&this._input.focus()}componentWillUnmount(){document.removeEventListener("click",this.onBlurDropdown)}_showDropdown(e){this.setState({showDropdown:e}),this.props.onDropdownVisibleChange&&this.props.onDropdownVisibleChange(e)}_handleSelect(e,t){e&&(t&&(t.preventDefault(),t.stopPropagation(),t.nativeEvent.stopImmediatePropagation()),this.props.onChange&&this.props.onChange(e,t),this.setState({showDropdown:!1,selected:e}))}_renderItem(e,t,s){if(this.props.renderItem)return this.props.renderItem(e,t,s);let a=t.text||T.default.str(t.textKey);return o.a.createElement("div",{className:"dropdown__list__item clickable "+(s?" focused ":" ")+(this.props.itemClassName||""),key:t.key||t.value,onClick:this._handleSelect.bind(this,t),style:{paddingLeft:"14px",borderBottom:null===t.value?"1px solid rgba(0, 0, 0, 0.08)":"none"}},t.avatar?o.a.createElement(u.b,{key:"avatar",outline:!0,showBadge:!1,target:{avatar:t.avatar},size:"m"}):null,o.a.createElement("span",{className:"dropdown__list__item__name"+(t.avatar?" has-avat":"")},a))}_searchOptions(e){let t=[],s="";s=e.target.innerText,s?this.props.searchFunction?this.props.searchFunction(s):(this.props.options.map((e=>{let a=e.searchValue||e.text;e.textKey&&(a=T.default.str(e.textKey));let n=g.default.simpleStripVietnamese(a),i=g.default.simpleStripVietnamese(s);n.indexOf(i)>=0&&t.push(e)})),this.setState({currentOptions:t,showDropdown:!0})):this.setState({currentOptions:this.props.options})}clearSelected(e){this.setState({selected:null,showDropdown:!0}),e.preventDefault(),e.stopPropagation()}renderSelectedItem(){let e=this.state.selected;if(!e)return this.props.placeholder?o.a.createElement("div",{className:"search-dropdown-selected",onClick:this._showDropdown.bind(this,!0)},o.a.createElement("span",{className:"truncate"},this.props.placeholder)):null;let t=e.text||T.default.str(e.textKey);return o.a.createElement("div",{className:"search-dropdown-selected",onClick:this._showDropdown.bind(this,!0)},o.a.createElement("i",{className:"fa fa-filter-icon-clear search-dropdown-icon-clear",onClick:this.clearSelected.bind(this)}),o.a.createElement("span",{className:"truncate"},t))}getSelected(){return this.state.selected}render(){let e="search-dropdown-input";this.props.searchInputClass&&(e+=this.props.searchInputClass);let t=this.state.currentOptions,s=this.props.focusIndex>=0?this.props.focusIndex:0,a=this.props.itemHeight||26,n=this.props.dropDownHeight||350;return n=t&&t.length?Math.min(t.length*a+1,n):100,o.a.createElement("div",{className:"search-dropdown-container "+this.props.containerClass,id:this.id},this.props.searchPosition===Kn?o.a.createElement("div",{className:"search-dropdown-input-ctn"},this.state.selected||!this.props.enableSearch?this.renderSelectedItem():o.a.createElement("div",{contentEditable:!0,ref:e=>this._input=e,placeholder:this.props.placeholder?this.props.placeholder:"",onInput:this._searchOptions.bind(this),onClick:this._showDropdown.bind(this,!0),className:e}),this.props.extraInputIcon?o.a.createElement("i",{className:this.props.extraInputIcon,onClick:this._showDropdown.bind(this,!0)}):null):null,this.state.showDropdown?o.a.createElement("div",{className:"search-dropdown-list"},this.props.searchPosition===Vn&&this.props.enableSearch?o.a.createElement("div",{contentEditable:!0,ref:e=>this._input=e,placeholder:this.props.placeholder?this.props.placeholder:"",onInput:this._searchOptions.bind(this),onClick:this._showDropdown.bind(this,!0),className:e}):null,t.length>0?o.a.createElement("div",{style:{height:n+"px"}},o.a.createElement(W.d,{items:t,dltype:W.a.DROP_DOWN_MENU,initialLength:t.length,renderItem:this._renderItem.bind(this),getItemKey:e=>e.key||e.value,ref:"valueDataList",focusedIndex:s,scrollToCenter:!0,itemHeight:a})):this.props.options.length>0?o.a.createElement(E.a,{textKey:"STR_NOT_FOUND",className:"global-search-no-result__text search-dropdown-notfound"}):null):null)}}var Yn=Wn,zn=s("/DvM");s("ZMd6");const qn=0,Xn=1,Jn=2,Qn=3,$n="1";class Zn extends o.a.Component{constructor(e){super(e),this.state={dropDownIndex:qn,selectedAsgnee:null,selectedAsgner:null,showMore:!1,selectedStatus:null,isShowDatePicker:null,createDate:[null,null],updatedDate:[null,null],dueDate:[null,null]},this.startFilter=this.startFilter.bind(this),this.asgnerDataList=null,this.asgneeDataList=null,this.statusOptions=[{textKey:"STR_NOT_RECEIVED",value:wn.g.WAITING_FOR_RESPONSE},{textKey:"STR_TODO_RECEIVED_2",value:wn.g.IN_PROCESS},{textKey:"STR_TODO_COMPLETED",value:wn.g.DONE}]}shouldComponentUpdate(e,t){return this.state.selectedStatus!==t.selectedStatus||this.state.createDate!==t.createDate||this.state.updatedDate!==t.updatedDate||this.state.dueDate!==t.dueDate||this.state.showMore!==t.showMore||this.state.selectedAsgnee!==t.selectedAsgnee||this.state.selectedAsgner!==t.selectedAsgner||this.state.isShowDatePicker!==t.isShowDatePicker||this.state.dropDownIndex!==t.dropDownIndex||this.props.assignerList!==e.assignerList||this.props.assigneeList!==e.assigneeList}componentDidMount(){lt.a.on("beforeClose",{windowId:$n,name:h.PopoverIdentitiesDefine.TODO_ADVAN_FILTER},(()=>{this.props.onClose()}))}componentWillUnmount(){lt.a.removeListener("beforeClose",{windowId:$n,name:h.PopoverIdentitiesDefine.TODO_ADVAN_FILTER},(()=>{this.props.onClose()}))}getRelatedUserData(e){let t=[];if(e)for(let s in e){let a=e[s];t.push({value:a.userId,text:a.name,avatar:a.avatar})}return t}onChangedDate(e,t){let s=[...this.state[t.stateAtt]];s[t.stateAttIndex]=e,this.setState({[t.stateAtt]:s},this.startFilter)}_showDatePicker(e){this.setState({isShowDatePicker:e})}closeDatePicker(){this.setState({isShowDatePicker:null})}startFilter(){let e=[null,null],t=[null,null],s=[null,null],a=null,n=null,i=null;for(let r=0;r<2;r++)this.state.createDate[r]&&(e[r]=this.state.createDate[r].getTime()),this.state.updatedDate[r]&&(t[r]=this.state.updatedDate[r].getTime()),this.state.dueDate[r]&&(s[r]=this.state.dueDate[r].getTime());this.state.selectedAsgnee&&(a=this.state.selectedAsgnee.value),this.state.selectedAsgner&&(n=this.state.selectedAsgner.value),this.state.selectedStatus&&(i=this.state.selectedStatus.value);let o={createDate:e,updatedDate:t,dueDate:s,status:i,assignee:a,assigner:n};this.props.startAdvancedFilter(o)}clickShowMore(){this.setState({showMore:!this.state.showMore})}toggleDropdown(e){this.setState({dropDownIndex:e})}onSelectStatus(e){this.setState({selectedStatus:e,dropDownIndex:qn},this.startFilter)}onSelectAsgnee(e){this.setState({selectedAsgnee:e,dropDownIndex:qn},this.startFilter)}onSelectAsgner(e){this.setState({selectedAsgner:e,dropDownIndex:qn},this.startFilter)}onHideDropdown(e){e||this.toggleDropdown(qn)}resetAllOptions(){this.setState({dropDownIndex:qn,selectedAsgnee:null,selectedAsgner:null,selectedStatus:null,createDate:[null,null],updatedDate:[null,null],dueDate:[null,null]},this.startFilter)}show(e,t=null){this.popover&&this.popover.show(e,t)}close(){this.popover&&this.popover.close()}render(){let e=this.state.selectedAsgnee,t=this.state.selectedStatus,s=this.state.selectedAsgner;this.asgneeDataList&&this.asgneeDataList.length||(this.asgneeDataList=this.getRelatedUserData(this.props.assigneeList)),this.asgnerDataList&&this.asgnerDataList.length||(this.asgnerDataList=this.getRelatedUserData(this.props.assignerList));let a={};this.state.isShowDatePicker&&(a.top=this.state.isShowDatePicker.top+"px",a.left=this.state.isShowDatePicker.left+"px");let n=this.state.dueDate[0]&&this.state.dueDate[1]&&this.state.dueDate[1]<this.state.dueDate[0],i=this.state.createDate[0]&&this.state.createDate[1]&&this.state.createDate[1]<this.state.createDate[0],r=this.state.updatedDate[0]&&this.state.updatedDate[1]&&this.state.updatedDate[1]<this.state.updatedDate[0],l=o.a.createElement("div",{className:"todo-advan-filter",id:"todo-advan-filter",style:this.state.showMore?{top:"-58px"}:null},o.a.createElement("div",{className:"todo-search-title"},o.a.createElement(E.a,{textKey:"STR_TODO_SEARCH_BY_PEOPLE"})),o.a.createElement("div",{className:"filter-att-row side-margin"},o.a.createElement("div",{className:"filter-att-item prevent-hover"},o.a.createElement("div",{className:"filter-dropdown-result",onClick:this.toggleDropdown.bind(this,Xn)},e?o.a.createElement("span",{className:"truncate"},e.text):o.a.createElement(E.a,{textKey:"STR_ASSIGNEE"}),o.a.createElement("i",{className:"fa fa-dropdown"})),this.state.dropDownIndex===Xn?o.a.createElement(Yn,{containerClass:" todo-filter-dropdown ",itemHeight:44,searchInputClass:" todo-filter-dropdown-input ",placeholder:T.default.str("STR_ASSIGNEE_2"),onChange:this.onSelectAsgnee.bind(this),onDropdownVisibleChange:this.onHideDropdown.bind(this),showDropdown:!0,options:this.asgneeDataList,enableSearch:!0,searchPosition:Vn,ref:e=>this.assigneeDropdrown=e}):null),o.a.createElement("div",{className:"filter-att-item prevent-hover margin-both-side has-dropdown"},o.a.createElement("div",{className:"filter-dropdown-result",onClick:this.toggleDropdown.bind(this,Jn)},s?o.a.createElement("span",{className:"truncate"},s.text):o.a.createElement(E.a,{textKey:"STR_ASSIGNER"}),o.a.createElement("i",{className:"fa fa-dropdown"})),this.state.dropDownIndex===Jn?o.a.createElement(Yn,{itemHeight:44,placeholder:T.default.str("STR_ASSIGNER"),containerClass:" todo-filter-dropdown ",searchInputClass:" todo-filter-dropdown-input ",showDropdown:!0,onChange:this.onSelectAsgner.bind(this),onDropdownVisibleChange:this.onHideDropdown.bind(this),options:this.asgnerDataList,enableSearch:!0,ref:e=>this.assignerDropdrown=e,searchPosition:Vn}):null),o.a.createElement("div",{className:"filter-att-item prevent-hover"},o.a.createElement("div",{className:"filter-dropdown-result",onClick:this.toggleDropdown.bind(this,Qn)},o.a.createElement(E.a,{className:"truncate",textKey:t?t.textKey:"STR_STATUS_RAW"}),o.a.createElement("i",{className:"fa fa-dropdown"})),this.state.dropDownIndex===Qn?o.a.createElement(Yn,{containerClass:" ",itemHeight:44,extraInputIcon:"fa fa-caret-down todo-filter-dropdown-icon",onDropdownVisibleChange:this.onHideDropdown.bind(this),placeholder:T.default.str("STR_STATUS_RAW"),options:this.statusOptions,enableSearch:!1,showDropdown:!0,onChange:this.onSelectStatus.bind(this),ref:e=>this.assigneeDropdrown=e}):null)),o.a.createElement("div",{className:"more-options "+(this.state.showMore?" toggled":""),onClick:this.clickShowMore.bind(this)},o.a.createElement(E.a,{textKey:"STR_ADVANCED"}),o.a.createElement("i",{className:"fa fa-"+(this.state.showMore?"minus":"plus_circle")})),this.state.showMore?o.a.createElement("div",null,o.a.createElement("div",{className:"todo-search-title"},o.a.createElement(E.a,{textKey:"STR_TO_DATE"})),o.a.createElement("div",{className:"filter-att-row side-margin"},o.a.createElement(zn.a,{popoverProps:{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.CALENDAR_TODO_ADVAN+"1"}},onChange:e=>this.onChangedDate(e,{stateAtt:"dueDate",stateAttIndex:0}),defaultTime:{hour:17,min:0},placeholderTextKey:"STR_FROM_DATE",closeWhenSelectDate:!0,initDateTime:this.state.dueDate[0]}),o.a.createElement("span",{className:"filter-separate margin-14",style:{marginTop:"5px"}}," - "),o.a.createElement(zn.a,{popoverProps:{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.CALENDAR_TODO_ADVAN+"2"}},onChange:e=>this.onChangedDate(e,{stateAtt:"dueDate",stateAttIndex:1}),defaultTime:{hour:17,min:0},placeholderTextKey:"STR_TO_DATE_2",closeWhenSelectDate:!0,initDateTime:this.state.dueDate[1]})),n?o.a.createElement("div",{className:"todo-filter-warning"},o.a.createElement(E.a,{textKey:"STR_TODO_FILTER_WARNING"})):null,o.a.createElement("div",{className:"todo-search-title"},o.a.createElement(E.a,{textKey:"STR_CREATE_TIME"})),o.a.createElement("div",{className:"filter-att-row side-margin"},o.a.createElement(zn.a,{popoverProps:{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.CALENDAR_TODO_ADVAN+"3"}},onChange:e=>this.onChangedDate(e,{stateAtt:"createDate",stateAttIndex:0}),defaultTime:{hour:17,min:0},placeholderTextKey:"STR_FROM_DATE",closeWhenSelectDate:!0,initDateTime:this.state.createDate[0]}),o.a.createElement("span",{className:"filter-separate margin-14",style:{marginTop:"5px"}}," - "),o.a.createElement(zn.a,{popoverProps:{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.CALENDAR_TODO_ADVAN+"4"}},onChange:e=>this.onChangedDate(e,{stateAtt:"createDate",stateAttIndex:1}),defaultTime:{hour:17,min:0},placeholderTextKey:"STR_TO_DATE_2",closeWhenSelectDate:!0,initDateTime:this.state.createDate[1]})),i?o.a.createElement("div",{className:"todo-filter-warning"},o.a.createElement(E.a,{textKey:"STR_TODO_FILTER_WARNING"})):null,o.a.createElement("div",{className:"todo-search-title"},o.a.createElement(E.a,{textKey:"STR_UPDATE_TIME"})),o.a.createElement("div",{className:"filter-att-row side-margin"},o.a.createElement(zn.a,{popoverProps:{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.CALENDAR_TODO_ADVAN+"5"}},onChange:e=>this.onChangedDate(e,{stateAtt:"updatedDate",stateAttIndex:0}),defaultTime:{hour:17,min:0},placeholderTextKey:"STR_FROM_DATE",closeWhenSelectDate:!0,initDateTime:this.state.updatedDate[0]}),o.a.createElement("span",{className:"filter-separate margin-14",style:{marginTop:"5px"}}," - "),o.a.createElement(zn.a,{popoverProps:{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.CALENDAR_TODO_ADVAN+"6"}},onChange:e=>this.onChangedDate(e,{stateAtt:"updatedDate",stateAttIndex:1}),defaultTime:{hour:17,min:0},placeholderTextKey:"STR_TO_DATE_2",closeWhenSelectDate:!0,initDateTime:this.state.updatedDate[1]})),r?o.a.createElement("div",{className:"todo-filter-warning"},o.a.createElement(E.a,{textKey:"STR_TODO_FILTER_WARNING"})):null,o.a.createElement("div",{className:"reset-filter",onClick:this.resetAllOptions.bind(this)},o.a.createElement("i",{className:"fa fa-img-retry"}),o.a.createElement(E.a,{textKey:"STR_TODO_RESET"}))):null);return o.a.createElement(lt.b,{identity:{windowId:$n,name:h.PopoverIdentitiesDefine.TODO_ADVAN_FILTER},content:l,placement:"bottom-left",style:{padding:0},anchorEl:this.props.advFilterDOMRef,subPopClassName:"search-dropdown-list"})}}var ei=Zn;const ti=-1;class si extends o.a.Component{constructor(e){super(e),this.todoList=null,this.searchCache=null,this.searchText="",this._onInput=this._onInput.bind(this),this.assignerList={},this.assigneeList={},this.searchTextFunction=g.default.throttleReal((e=>{let t=this.searchByText(e);this.props.onFilter(t),this.setState({showClearSearchText:!!e})}),100),this.timer=null,this.onBlurComponent=this.onBlurComponent.bind(this),this.setToolHeight=this.setToolHeight.bind(this),this.startedAdvanFilter=!1,this.state={showAdvanFilter:!1,showClearSearchText:!1,assigneeList:null,assignerList:null}}shouldComponentUpdate(e,t){return this.state.showAdvanFilter!==t.showAdvanFilter||this.state.assigneeList!==t.assigneeList||this.state.assignerList!==t.assignerList||this.state.showClearSearchText!==t.showClearSearchText}componentWillMount(){}componentDidMount(){this.onLoadData(),this.inputSearch&&this.inputSearch.focus(),document.addEventListener("click",this.onBlurComponent),this._input&&this.props.autofocus&&this._input.focus()}componentWillUnmount(){this.timer&&(clearTimeout(this.timer),this.timer=null),document.removeEventListener("click",this.onBlurComponent)}setToolHeight(e){this.containerDOM&&(this.containerDOM.style.height=e+"px")}onBlurComponent(e){if(!this.startedAdvanFilter&&e.target&&e.target.closest){if(!e.target.closest("#todo-filter")){let e="";if(this.inputSearch&&(e=this.inputSearch.value),this.state.showAdvanFilter||e)return;this.props.onToggleFilter(!1)}}}searchByText(e){let t=[];if(!e)return this.searchCache=null,this.searchText="",null;this.searchText&&e.indexOf(this.searchText)<0&&(this.searchCache=null);let s=e.split(" ");return this.searchCache?t=this.searchCache.length?Ln.searchInList(this.searchCache,e,s):[]:this.todoList&&(t=Ln.searchInList(this.todoList,e,s)),this.searchText=e,this.searchCache=t,t}_onInput(e){let t=e.target.value;(t||""===t)&&(t=g.default.fixContentBeforeSearch(t,!0,!1,!0),this.searchTextFunction(t))}_preprocessData(e){let t={},s={},n={};for(let i in e){let o=Object(a.a)({},e[i]);if(o&&o.content&&(o.contentForSearch=g.default.simpleStripVietnamese(o.content),t[i]=o),o.creator&&!s[o.creator]){let e=k.default.getMiniInfo(o.creator);e&&(s[o.creator]={userId:o.creator,avatar:e.avatar,name:e.dName})}o.assignees&&o.assignees.length&&o.assignees.forEach((e=>{if(e&&e.userId&&!n[e.userId]){let t=k.default.getMiniInfo(e.userId);t&&(n[e.userId]={userId:e.userId,avatar:t.avatar,name:t.dName})}}))}return this.setState({assignerList:s,assigneeList:n}),t}onLoadData(){wn.i.getAllTodoAsync(null,this.props.user.userId).then((e=>{this.todoList=this._preprocessData(e)}))}onShowAdvanFilter(e){this.setState({showAdvanFilter:!0},(()=>{lt.a.openPopover({windowId:"1",name:h.PopoverIdentitiesDefine.TODO_ADVAN_FILTER})}))}startAdvancedFilter(e){let t=this.searchCache||this.todoList;if(t){let s=Ln.advancedFilter(t,e);this.props.onFilter(s),this.startedAdvanFilter=!0}}clearSearchText(){this.inputSearch&&(this.inputSearch.value="",this.searchTextFunction(""))}render(){return o.a.createElement("div",null,o.a.createElement("div",{className:"todo-stats-header",style:{justifyContent:"center"}},o.a.createElement(E.a,{className:"truncate",textKey:"STR_SEARCH_TODO",style:{width:"100%",textAlign:"center"}}),o.a.createElement("i",{className:"fa fa-close todo-close-button",onClick:()=>{this.props.onToggleFilter(!1)}})),o.a.createElement("div",{className:"todo-filter-container",id:"todo-filter",ref:e=>this.containerDOM=e},o.a.createElement("div",{style:{position:"relative"}},o.a.createElement("input",{placeholder:T.default.str("STR_SEARCH_TODO"),onInput:this._onInput,ref:e=>this.inputSearch=e,className:"todo-filter-input"}),this.state.showClearSearchText?o.a.createElement("i",{className:"fa fa-textbox-icon-clear btn btn-clear-search-todo",onClick:this.clearSearchText.bind(this)}):null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("div",{style:{flex:1}}),o.a.createElement("div",{className:"advan-filter "+(this.state.showAdvanFilter?" show-advan":""),onClick:this.onShowAdvanFilter.bind(this),ref:e=>this.advFilterDOMRef=e},o.a.createElement("i",{className:"fa fa-filter"}),o.a.createElement(E.a,{textKey:"STR_TODO_ADVAN_SEARCH",className:"td-txt-hover"}))),o.a.createElement(ei,{ref:e=>this.advFilter=e,user:this.props.user,assignerList:this.state.assignerList,assigneeList:this.state.assigneeList,advFilterDOMRef:this.advFilterDOMRef,startAdvancedFilter:this.startAdvancedFilter.bind(this),onClose:()=>{this.setState({showAdvanFilter:!1})}}))))}}var ai=si,ni=s("TMsY");class ii extends o.a.Component{constructor(e){super(e),this.itemHeight={},this.isFireFoxBrowser=this.isFireFox(),this.sortSetting={attr:ti,isAscending:!0},this.startedSearching=!1;let t=wn.i.getLastSelectedTab(),s=wn.i.getLastSelectedSubTab(t);Ln.updateSubTab(s),this.state={items:[],searchItems:[],scrollToOffset:0,loadState:h.DEFAULT_LOAD_STATE.LOADING,tab:t,subTab:s,tabCreatorCount:0,tabCreatorUnread:0,tabAssigneesCount:0,tabAssigneesUnread:0,tabCompletedUnread:0,tabWatcherCount:0,tabWatcherUnread:0,sectionTodayUnread:0,sectionTodayCount:0,sectionFutureUnread:0,sectionFutureCount:0,sectionExpiredUnread:0,sectionExpiredCount:0,sectionDoingCount:0,sectionDoingUnread:0,sectionDoneCount:0,sectionDoneUnread:0,sectionReceivedCount:0,sectionNotReceivedCount:0,mainFilterShow:!1,refresh:!1},this.forceUpdateList=(e=0)=>{requestAnimationFrame((()=>{this.mainList&&this.mainList.recomputeRowHeights(e)}))},this.refresh=()=>{this.onUpdateList(this.state.tab,this.state.subTab)},this.eventHandler=(e,t)=>{switch(e){case p.TodoActions.CREATE_TODO:case p.TodoActions.UPDATE_TODO:if(t){if(this.startedSearching)return void this.updateSearch(t);let e=t.id;this.updatedTodo||(this.updatedTodo={});let s=Object(a.a)({},t),n=null;if(n=this.todoObj&&this.todoObj[e]?this.todoObj[e]:t,n){let t=n.updateTime,i=!1;this.updatedTodo[e]&&this.updatedTodo[e].last_update_time&&(t=this.updatedTodo[e].last_update_time,i=!0),s=Object(a.a)(Object(a.a)({},s),{},{last_update_time:t,didUpdated:i})}this.updatedTodo[e]=s;for(let t in this.updatedTodo)if(this.updatedTodo.hasOwnProperty(t)){let e=this.updatedTodo[t];if(e){wn.i.checkInTask(e)||(delete this.updatedTodo[t],delete this.todoObj[t])}}}case p.TodoActions.REMOVE_TODO:this.onUpdateList(this.state.tab,this.state.subTab),this.forceUpdateList();break;case p.GeneralActions.LEFTPANEL_RESIZE:this.updateFilterHeight=!0,this.updateSize();break;case p.TodoActions.CLEAR_TAB_TODO_UNREAD:this.setState({refresh:!this.state.refresh}),this.clearUnreadForTab(this.state.tab);break;case p.GeneralActions.UPDATE_HIDDEN_CHAT:this.onUpdateList(this.state.tab,this.state.subTab)}},v.default.subscribe(this.eventHandler),this.onChangeTab=this.onChangeTab.bind(this),this.onCheckOpenTab=this.onCheckOpenTab.bind(this),this.openStatsByUser=this.openStatsByUser.bind(this),this.scr=(e,t=!0)=>{e&&(this.scrollTimeOut&&(clearTimeout(this.scrollTimeOut),this.scrollTimeOut=null),this.scrollTimeOut=setTimeout((()=>{this.state.loadState===h.DEFAULT_LOAD_STATE.RESULT?(this.onScrollToTodo(e,t),this.forceScrollToId=void 0):this.state.loadState===h.DEFAULT_LOAD_STATE.LOADING&&this.scr(e,t)}),100))},wn.i.regGCCallback(this.refresh)}componentWillUpdate(){this.props.eventRemind&&(this.timerClearBanner=setTimeout((()=>{this.props.clearBannerEvent()}),3e5))}shouldComponentUpdate(e,t){return this.state.items!==t.items||this.state.searchItems!==t.searchItems||this.state.scrollToOffset!==t.scrollToOffset||this.state.loadState!==t.loadState||this.state.tab!==t.tab||this.state.subTab!==t.subTab||this.state.tabCreatorCount!==t.tabCreatorCount||this.state.tabCreatorUnread!==t.tabCreatorUnread||this.state.tabAssigneesCount!==t.tabAssigneesCount||this.state.tabAssigneesUnread!==t.tabAssigneesUnread||this.state.tabCompletedUnread!==t.tabCompletedUnread||this.state.tabWatcherCount!==t.tabWatcherCount||this.state.tabWatcherUnread!==t.tabWatcherUnread||this.state.sectionTodayUnread!==t.sectionTodayUnread||this.state.sectionTodayCount!==t.sectionTodayCount||this.state.sectionFutureUnread!==t.sectionFutureUnread||this.state.sectionFutureCount!==t.sectionFutureCount||this.state.sectionExpiredUnread!==t.sectionExpiredUnread||this.state.sectionExpiredCount!==t.sectionExpiredCount||this.props.showFilter!==e.showFilter||this.state.sectionDoingCount!==t.sectionDoingCount||this.state.sectionDoingUnread!==t.sectionDoingUnread||this.state.sectionDoneCount!==t.sectionDoneCount||this.state.sectionDoneUnread!==t.sectionDoneUnread||this.state.sectionReceivedCount!==t.sectionReceivedCount||this.state.sectionNotReceivedCount!==t.sectionNotReceivedCount||!g.default.objectEqual(this.props.eventRemind,e.eventRemind)||this.props.showSummary!==e.showSummary||this.state.mainFilterShow!==t.mainFilterShow||this.state.refresh!==t.refresh}componentDidMount(){this.onUpdateList(this.state.tab,this.state.subTab),this.clearUnreadForTab(this.state.tab),this.props.dispatch&&this.props.dispatch({type:p.TodoActions.DID_OPEN_TODO_TAB}),this.startTs=Date.now()}componentDidUpdate(){this.onCheckOpenTab(),void 0!==this.forceScrollToId&&this.scr(this.forceScrollToId),this.updateSize()}componentWillUnmount(){v.default.unsubscribe(this.eventHandler),wn.i.removeGCCallback(),null!==this.timerClearBanner&&clearTimeout(this.timerClearBanner),wn.i.setScrollListPosition(null);let e=Date.now()-this.startTs;e<1e4?I.e.logAction(2173001):e<3e4?I.e.logAction(2173002):I.e.logAction(2173003)}componentWillReceiveProps(e){this.props.showFilter&&!e.showFilter?this.onUpdateList(this.state.tab,this.state.subTab):!0===e.showFilter&&(this.updateFilterHeight=!0)}updateSize(){if(!0===this.props.showFilter&&!0===this.updateFilterHeight&&(this.updateFilterHeight=!1,this.tabsDOM&&this.filterCOM)){let e=this.tabsDOM.offsetHeight-26;this.filterCOM.setToolHeight(e)}}updateSearch(e){if(console.log(e),!e||!this.state.items)return;let t=[...this.state.items];for(let s=0;s<t.length;s++)if(t[s].data){let n=Object(a.a)({},t[s]);if(n.data.id===e.id){n.data=e,t[s]=n;break}}this.setState({items:t})}onCheckOpenTab(){let e=wn.i.getViewTodoIdCache();if(e){if(this.todoObj){wn.i.setViewTodoIdCache(null);const t=t=>{let s=h.TODO_TAB_INDEX.I_ASSIGNED,a=h.TODO_SECTION_INDEX_V2.DOING;if(t){let e=wn.i.classifyTodoItem(t,this.props.user.userId);e&&(!0===e.isCreator?s=h.TODO_TAB_INDEX.I_ASSIGNED:!0===e.isAssignee?s=h.TODO_TAB_INDEX.ASSIGNED_TO_ME:!0===e.isWatcher&&(s=h.TODO_TAB_INDEX.WATCHERS),!0===e.isExpired?a=h.TODO_SECTION_INDEX_V2.DOING:!0===e.isCompleted&&(a=h.TODO_SECTION_INDEX_V2.DONE))}if(this.onChangeTab(s,a),wn.i.setTodoNeedAnimation(e),this.itemRef){let t=this.itemRef[e];t&&t.playHighlighAnimation()}this.state.tab!==s||this.state.subTab!==a?this.forceScrollToId=e:this.scr(e)};let s=this.todoObj[e];if(s)t(s);else{let s=wn.i.getTodo(e);s.constructor===Promise?s.then((e=>{e&&t(e)})):s.constructor===Object&&t(s)}}}else{let e=wn.i.getViewTodoTabCache();if(e)return e.constructor===String&&(e=parseInt(e)),wn.i.setViewTodoTabCache(null),void this.onChangeTab(e,h.TODO_SECTION_INDEX.ALL)}}onUpdateList(e=h.TODO_TAB_INDEX.ASSIGNED_TO_ME,t=h.TODO_SECTION_INDEX_V2.DOING,s=!1){this.updateUnread(e);let n=e===h.TODO_TAB_INDEX.DONE?h.TODO_SECTION_INDEX.ALL:t;n===h.TODO_SECTION_INDEX_V2.NOT_RECEIVED||n===h.TODO_SECTION_INDEX_V2.DOING_ONLY||n===h.TODO_SECTION_INDEX_V2.OVERDUE||wn.i.setLastSelectedSection(e,t);const i=(t,s=!1)=>{this.todoObj=Object(a.a)({},t);const i=t=>{t.sort(((t,s)=>{let a=e===h.TODO_TAB_INDEX.ASSIGNED_TO_ME&&t.data.creator!==this.props.user.userId?wn.i.isDingTodo(t.data.id):null,n=e===h.TODO_TAB_INDEX.ASSIGNED_TO_ME&&s.data.creator!==this.props.user.userId?wn.i.isDingTodo(s.data.id):null;if(!0===a&&!0!==n)return-1;if(!0!==a&&!0===n)return 1;let i=t.data.updateTime;this.updatedTodo&&this.updatedTodo.hasOwnProperty(t.data.id)&&(i=this.updatedTodo[t.data.id].last_update_time);let o=s.data.updateTime;return this.updatedTodo&&this.updatedTodo.hasOwnProperty(s.data.id)&&(o=this.updatedTodo[s.data.id].last_update_time),o-i}))};let o=[],r=[],l=[],c=[],d=[],u=[],_=0,m=0,p=0,g=0,E=0,f=0,I=0,T=0,v=Object(a.a)({},wn.i.getUnreadTodo());if(v){let e=wn.i.getDangerTodos();if(e)for(let t in e)e.hasOwnProperty(t)&&v.hasOwnProperty(t)&&delete v[t]}else v={};for(let a in t)if(t.hasOwnProperty(a)){let s=t[a];if(s){let t=!1,a=wn.i.classifyTodoItem(s,this.props.user.userId);a&&!a.isCompleted&&(!0===a.isWatcher&&T++,!0===a.isAssignee&&I++,!0===a.isCreator&&f++);let n=this.updatedTodo&&this.updatedTodo.hasOwnProperty(s.id)&&!0===this.updatedTodo[s.id].didUpdated;switch(e){case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:t=!(!a.isAssignee&&!0!==n);break;case h.TODO_TAB_INDEX.I_ASSIGNED:t=!(!a.isCreator&&!0!==n);break;case h.TODO_TAB_INDEX.DONE:t=!(!a.isCompleted&&!0!==n);break;case h.TODO_TAB_INDEX.WATCHERS:t=!(!a.isWatcher&&!0!==n)}if(!0!==t)continue;s={data:s,type:wn.c.ITEM},!0===n&&u.push(s),!0===a.isCompleted&&(!0!==n&&l.push(s),p++),!0===a.isExpired&&!0!==a.isCompleted&&(!0!==n&&o.push(s),_++),!0===a.isNotReceived&&(!0!==n&&d.push(s),E++,!0!==a.isExpired&&(!0!==n&&r.push(s),m++)),!0===a.isReceived&&(!0!==n&&c.push(s),g++,!0!==a.isExpired&&(!0!==n&&r.push(s),m++))}}let R=[],S=null;switch(n){case h.TODO_SECTION_INDEX_V2.DOING:S=[...r,...o];break;case h.TODO_SECTION_INDEX_V2.DONE:S=[...l];break;case h.TODO_SECTION_INDEX_V2.NOT_RECEIVED:S=[...d];break;case h.TODO_SECTION_INDEX_V2.DOING_ONLY:S=[...c];break;case h.TODO_SECTION_INDEX_V2.OVERDUE:S=[...o]}S&&(S=[...S,...u],i(S),R.push(...S));let O={sectionExpiredCount:_,sectionDoingCount:m,sectionNotReceivedCount:E,sectionReceivedCount:g,sectionDoneCount:p,tabCreatorCount:f,tabAssigneesCount:I,tabWatcherCount:T};if(R&&(R=R.filter((e=>{if(!e)return!1;let t=e.data;if(!t)return!1;let s=wn.i.getToUid(t,this.props.user.userId);return!se.a.isThreadHidden(s)}))),!R||R.length<=0){let t=this.state.loadState;return!0!==s&&(t=h.DEFAULT_LOAD_STATE.EMPTY),void this.setState(Object(a.a)({items:[],loadState:t,tab:e,subTab:n},O))}let N={},b=wn.i.getScrollListPosition();if(b&&b>-1?(wn.i.setScrollListPosition(null),N={scrollToOffset:b}):this.needScrollToOffset>=0&&(N={scrollToOffset:this.needScrollToOffset},this.needScrollToOffset=-1),!this.updatedTodo){this.updatedTodo={};for(let e=0;e<R.length;e++){let t=R[e];if(t&&t.data){let e=t.data.id;this.updatedTodo[e]=Object(a.a)(Object(a.a)({},t.data),{},{last_update_time:t.data.updateTime,didUpdated:!1})}}}this.setState(Object(a.a)(Object(a.a)({items:[...R],loadState:h.DEFAULT_LOAD_STATE.RESULT,tab:e,subTab:n},O),N))};!0===s&&(this.loadingMore=!0);let o=wn.i.getAllTodos();if(o){if(o.constructor===Promise)return this.setState({loadState:h.DEFAULT_LOAD_STATE.LOADING,items:[],tab:e,subTab:n}),void o.then((t=>{this.lastSuccessFetching||(this.lastSuccessFetching={}),this.lastSuccessFetching[e]=Date.now(),!0===s&&(this.loadingMore=!1),wn.i.gcUnread(this.props.user.userId).then((t=>{this.updateUnread(e),this.props.dispatch&&this.props.dispatch({type:p.TodoActions.CLEAR_TODO_UNREAD})})),this.state.tab===e&&i(t)})).catch((t=>{t&&"no_more"===t.err_msg?this.state.loadState===h.DEFAULT_LOAD_STATE.LOADING&&this.setState({loadState:h.DEFAULT_LOAD_STATE.EMPTY,tab:e,subTab:n}):(t&&"ERR_NO_NETWORK"===t.code&&this.lastSuccessFetching&&delete this.lastSuccessFetching[e],this.state.loadState===h.DEFAULT_LOAD_STATE.LOADING&&this.setState({loadState:h.DEFAULT_LOAD_STATE.ERROR,items:[],tab:e,subTab:n}))}));if(o.constructor===Object)return void i(o)}let r={tab:e,subTab:n};this.state.loadState===h.DEFAULT_LOAD_STATE.LOADING?this.setState(Object(a.a)({loadState:h.DEFAULT_LOAD_STATE.ERROR,items:[]},r)):this.setState(r)}onResizer({width:e,height:t}){this.clientHeight=t}handleVirtualizedScroll(e){e&&null!=e.scrollTop&&this.customScrollBar&&this.customScrollBar.scrollTop(e.scrollTop),this.action&&this.action.onClose()}getView(e,t){if(!this.state.items||this.state.items.length<=0||e<-1||e>this.state.items.length)return null;let s=this.state.items[e];if(!s)return null;let a=s.data;switch(s.type){case wn.c.TITLE:{let e=0,t=0;switch(a.id){case h.TODO_SECTION_INDEX.EXPIRED:e=this.state.sectionExpiredCount,t=this.state.sectionExpiredUnread;break;case h.TODO_SECTION_INDEX_V2.DOING:e=this.state.sectionDoingCount,t=this.state.sectionDoingUnread;break;case h.TODO_SECTION_INDEX_V2.DONE:e=this.state.sectionDoneCount,t=this.state.sectionDoneUnread}let s="";return t>0&&e>0?s=`(${t}/${e})`:t<=0&&e>0&&(s=`(${e})`),this.itemHeight[a.id]=41,o.a.createElement("div",{className:"todo-section"+(a.id===h.TODO_SECTION_INDEX.EXPIRED?" section-expired":""),key:`todo-title-${this.state.tab}_${this.state.subTab}_${a.id}`},o.a.createElement(E.a,{textKey:a.textKey})," ",s)}case wn.c.ITEM:return o.a.createElement(Bn.a,{bounds:!0,onResize:e=>{if(a){if(this.itemHeight[a.id]===e.bounds.height)return;this.itemHeight[a.id]=e.bounds.height}this.forceUpdateList()}},(({measureRef:t})=>o.a.createElement("div",{ref:t,className:"rel",key:`todo-item-${a.id}-${a.updateTime}-${a.status}`},o.a.createElement(Fn,{data:a,onDidUpdateSize:this._onDidUpdateItemHeight.bind(this),dispatch:this.props.dispatch,user:this.props.user,confirm:this.props.confirm,onItemClick:this.onItemClick.bind(this),onJumpMsg:this.onItemJump.bind(this),index:e,onClearUnread:this.onClearUnreadItem.bind(this),tabIndex:this.state.tab,subTabIndex:this.state.subTab,onShowAction:this.showTodoAction.bind(this),onShowDetail:this.onShowTodoDetail.bind(this),groupList:this.props.groupList,openStatsByUser:this.openStatsByUser,ref:e=>{this.itemRef||(this.itemRef={}),this.itemRef[a.id]=e},onShowComment:(e,t)=>this.onShowComment(e,t),getDataId:this.getDataId}))))}return null}handleCustomScroll(e){if(e){const{target:t}=e;if(!(t instanceof HTMLDivElement))return;this.setState({scrollToOffset:t.scrollTop})}}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}_getItemHeight(e,t,s){if(s===wn.c.TITLE)return 41;let a=this.itemHeight[t];return a||(!this.state.items||e>=this.state.items.length||e<0||void 0===e?0:155)}_onDidUpdateItemHeight(e,t){!t||this.itemHeight[e]&&this.itemHeight[e]===t||(this.itemHeight[e]=t,this.forceUpdateList())}getLoadingUI(){return o.a.createElement("div",{className:"flx w100 h100",onWheel:this.onListWheel.bind(this)},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner",style:{fontSize:"26px",color:"var(--blue-300)",margin:"auto"}}))}getEmptySearchUI(){return o.a.createElement("div",{className:"todo-search-empty"},o.a.createElement("img",{src:Ve.a,style:{width:"160px"}}),o.a.createElement(E.a,{textKey:"STR_NOT_FOUND"}))}getEmptyUI(){let e="STR_TODO_EMPTY_SCREEN_";switch(this.state.tab){case h.TODO_TAB_INDEX.I_ASSIGNED:e+="I_ASSIGNED_";break;case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:e+="ASSIGN_TO_ME_";break;case h.TODO_TAB_INDEX.WATCHERS:e+="CC_";break;default:e=""}if(e.length>0)switch(this.state.subTab){case h.TODO_SECTION_INDEX_V2.DOING:e+="1";break;case h.TODO_SECTION_INDEX_V2.DONE:e+="2";break;case h.TODO_SECTION_INDEX_V2.OVERDUE:e+="3";break;default:e=""}return o.a.createElement("div",{className:"td-empty-container",onWheel:this.onListWheel.bind(this)},e.length>0?o.a.createElement(E.a,{textKey:e,className:"emp-txt"}):o.a.createElement("div",{style:{height:"40px"}}),o.a.createElement("i",{className:"fa fa-icn-todo-selected",style:{color:"var(--grey-600)",fontSize:"72px",marginBottom:"12px"}}),o.a.createElement(E.a,{textKey:"STR_TODO_LIST_EMPTY",tagName:"div",style:{fontSize:"12px",color:"var(--neutral-500)"}}),this.state.tab===h.TODO_TAB_INDEX.I_ASSIGNED&&wn.i.isEnableEntryPoint(wn.h.CREATE_TASK)?o.a.createElement("div",{onClick:this.onCreateTodoFromEmptyScreen.bind(this),className:"todo-empty-create-new-task-btn"},o.a.createElement("i",{className:"fa fa-create-todo"}),o.a.createElement(E.a,{textKey:"STR_CREATE_TODO"})):null)}getDataId(e){switch(e){case h.TODO_TAB_INDEX.I_ASSIGNED:return{tabUI:{doing:"div_TabASGD_Doing",complete:"div_TabASGD_Completed",filter:"div_TabASGD_Filter"},list:"div_TabASGD_TskList",item:"div_TabASGD_TskItem",jumpBtn:"btn_TabASGD_TskItemJump",remindBtn:"btn_TabASGD_TskItemRemind",cxBtn:"btn_TabASGD_TskItemCX",cmpltBtn:"btn_TabASGD_TskItemCMPLT",reassignBtn:"btn_TabASGD_TskItemREeSGD"};case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:return{tabUI:{doing:"div_TabRECD_Doing",complete:"div_TabRECD_Completed",filter:"div_TabRECD_Filter"},list:"div_TabRECD_TskList",item:"div_TabRECD_TskItem",jumpBtn:"btn_TabRECD_TskItemJump",remindBtn:"btn_TabRECD_TskItemRemind",cxBtn:"btn_TabRECD_TskItemCX",cmpltBtn:"btn_TabRECD_TskItemCMPLT",reassignBtn:"btn_TabRECD_TskItemReASGD",acceptBtn:"btn_TabRECD_TskItemAccept"};case h.TODO_TAB_INDEX.WATCHERS:return{tabUI:{doing:"div_TabFOL_Doing",complete:"div_TabFOL_Completed",filter:"div_TabFOL_Filter"},list:"div_TabFOL_TskList",item:"div_TabFOL_TskItem",jumpBtn:"div_TabFOL_TskItemJump",cxBtn:"div_TabFOL_TskItemCX",cmpltBtn:"div_TabFOL_TskItemCMPLT",reassignBtn:"div_TabFOL_TskItemReASGD"};default:return{}}}onCreateTodoFromEmptyScreen(){this.props.onCreateRawTodo&&this.props.onCreateRawTodo(),I.e.logAction(1710115)}getErrorUI(){return o.a.createElement("div",{className:"td-empty-container",onWheel:this.onListWheel.bind(this)},o.a.createElement("img",{src:ni.a,style:{width:"159px",height:"120px",margin:"20px auto"}}),o.a.createElement("div",{onClick:this.onRetry.bind(this),className:"todo-retry-button"},o.a.createElement("i",{className:"fa fa-icn-todo-csc-reopen"}),o.a.createElement(E.a,{textKey:"STR_RETRY"})))}onItemClick(e,t,s=!0,n=!0){let i=this.state.items;if(this.clearUnreadForTab(this.state.tab),!i||i.length<=t||t<0)return;if(void 0!==this.lastIndex&&null!==this.lastIndex){let e=i[this.lastIndex];e&&(e.data=Object(a.a)(Object(a.a)({},e.data),{},{isExpand:!1}),i[this.lastIndex]=e)}this.lastIndex=t;let o=i[t];if(o&&o.type===wn.c.ITEM){let r=o.data;r.id===e.id&&(this.currentData=e,!0===n&&(o.data=Object(a.a)(Object(a.a)({},r),{},{isExpand:!0}),i[t]=o),!0===s&&this.onJumpMsg(),this.setState({items:[...i]}))}this.startedSearching&&I.e.logAction(2174004)}onItemJump(e,t){this.onItemClick(e,t)}onChangeTab(e,t=h.TODO_SECTION_INDEX_V2.DOING,s=!1){if(this.clearUnreadForTab(e),this.state.tab!==e||this.state.subTab!==t){if(!0===s){let s=null;switch(e){case h.TODO_TAB_INDEX.I_ASSIGNED:s=17101;break;case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:s=17102;break;case h.TODO_TAB_INDEX.DONE:s=17103}s&&I.e.logAction(s),t=wn.i.getLastSelectedSubTab(e)}this.currentData=null,this.updatedTodo=null,this.itemHeight={},this.onUpdateList(e,t),setTimeout((()=>{this.mainList&&this.mainList.scrollToPosition(0)}),0)}}onChangeSubtab(e,t=!1){if(this.clearUnreadForTab(this.state.tab),Ln.updateSubTab(e),this.state.subTab!==e){if(!0===t){let t=171e4;switch(this.state.tab){case h.TODO_TAB_INDEX.I_ASSIGNED:t+=100;break;case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:t+=200;break;case h.TODO_TAB_INDEX.WATCHERS:t+=300}switch(e){case h.TODO_SECTION_INDEX_V2.DOING:t+=1;break;case h.TODO_SECTION_INDEX_V2.DONE:t+=2;break;case h.TODO_SECTION_INDEX_V2.NOT_RECEIVED:t+=3;break;case h.TODO_SECTION_INDEX_V2.DOING_ONLY:t+=4;break;case h.TODO_SECTION_INDEX_V2.OVERDUE:t+=5}t>1710100&&I.e.logAction(t)}this.currentData=null,this.updatedTodo=null,this.itemHeight={},this.onUpdateList(this.state.tab,e),setTimeout((()=>{this.mainList&&this.mainList.scrollToPosition(0)}),0)}}clearUnreadForTab(e){wn.i.clearNewItemByCate(e,(()=>{this.props.dispatch&&this.props.dispatch({type:p.TodoActions.CLEAR_TODO_UNREAD})}))}onScrollToTodo(e,t=!0){if(this.mainList&&this.state.items)for(let s=0;s<this.state.items.length;s++){let a=this.state.items[s];if(a){let n=a.data;if(n.id===e){let a=this.mainList.getOffsetForRow({index:s,alignment:"start"});if(this.mainList.scrollToPosition(a),!0===t){if(this.itemRef){let t=this.itemRef[e];t&&setTimeout((()=>{t.onClearUnread()}),100)}this.onItemClick(n,s,!1,!0)}requestAnimationFrame((()=>{let e=this.mainList.getOffsetForRow({index:s,alignment:"start"});e!==a&&this.mainList.scrollToPosition(e)}));break}}}}onClearUnreadItem(){this.updateUnread(this.state.tab)}updateUnread(e){let t=0,s=0,n=0,i=0,o=0,r=0,l=0,c=Object(a.a)({},wn.i.getUnreadTodo());if(c){let e=wn.i.getDangerTodos();if(e)for(let t in e)e.hasOwnProperty(t)&&c.hasOwnProperty(t)&&delete c[t]}else c={};for(let a in c)if(c.hasOwnProperty(a)){let d=c[a],u=h.TODO_TAB_INDEX.I_ASSIGNED,_=!1;d&&(d.isCompleted?(n++,u=h.TODO_TAB_INDEX.DONE):d.isAssignee&&d.isCreator?(t++,s++,_=e!==h.TODO_TAB_INDEX.DONE):d.isCreator?(t++,u=h.TODO_TAB_INDEX.I_ASSIGNED):d.isAssignee?(s++,u=h.TODO_TAB_INDEX.ASSIGNED_TO_ME):d.isWatcher&&(i++,u=h.TODO_TAB_INDEX.WATCHERS),!0!==d.isExpired||e!==u&&!0!==_?!0!==d.isCompleted||e!==u&&!0!==_?r++:l++:o++)}this.setState({tabCreatorUnread:t,tabAssigneesUnread:s,tabCompletedUnread:n,tabWatcherUnread:i,sectionTodayUnread:0,sectionFutureUnread:0,sectionExpiredUnread:o,sectionDoingUnread:r,sectionDoneUnread:l})}showTodoAction(e,t){this.currentData=t,this.action&&(this.action.setData(t),this.action.showAction(e))}onShowTodoDetail(e=null){let t=e||this.currentData;t&&H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_PREVIEW,params:Object(a.a)({},t)})}onJumpMsg(e=null){let t=e||this.currentData,s=wn.i.getToUid(t,this.props.user.userId);kn.a.todoJumpMsg(t,this.props.user.userId,this.props.dispatch).then((e=>{let t={name:"message",userId:s};N.a.setOldTab(t)}))}onDeleteTodo(e=null){let t=e||this.currentData;t&&kn.a.deleteTodo(t,this.props.confirm,this.props.dispatch)}onRetry(){wn.i.resetConfigTodoList(),this.onUpdateList(this.state.tab,this.state.subTab)}onFilter(e,t=!1){if(e){let t=e.map((e=>({type:wn.c.ITEM,data:e})));t.sort(((e,t)=>{let s=e.data.updateTime||e.data.createTime;return(t.data.updateTime||t.data.createTime)-s})),this.startedSearching=!0,this.setState({items:t});try{t&&t.length>0&&I.e.logAction(2174003)}catch(s){}}else t&&this.props.onToggleFilter(!1),this.startedSearching=!1,this.onUpdateList(this.state.tab,this.state.subTab)}onListWheel(e){}onShowComment(e,t){this.commentsDOM&&this.commentsDOM.showAction(e)}tabHasUnread(e){if(e===h.TODO_TAB_INDEX.DONE)return!1;let t=wn.i.getUnreadTodo();if(t)for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];if(a){if(a.hasOwnProperty("isCreator")&&e===h.TODO_TAB_INDEX.I_ASSIGNED)return!0;if(a.hasOwnProperty("isAssignee")&&e===h.TODO_TAB_INDEX.ASSIGNED_TO_ME)return!0}}return!1}onShowFilterMainList(e){this.moreMenu&&this.moreMenu.show(e,e.target)}onMainListFilter(e){this.moreMenu&&this.moreMenu.close(),this.onUpdateList(this.state.tab,e)}onFilterBack(){this.onUpdateList(this.state.tab,h.TODO_SECTION_INDEX_V2.DOING),this.currentData=null,this.updatedTodo=null,this.itemHeight={}}openStatsByUser(e,t){this.props.openStatsByUser&&this.props.openStatsByUser(e,t),wn.i.setScrollListPosition(this.state.scrollToOffset)}onMainFilterShow(e){this.setState({mainFilterShow:e})}render(){let e=this.state.items?this.state.items.length:0;this.fullHeight=0;for(let o=0;o<e;o++){let e=this.state.items[o];e&&e.data&&(this.fullHeight+=this._getItemHeight(o,e.data.id,e.type))}let t="STR_FILTER_2",s=!1;switch(this.state.subTab){case h.TODO_SECTION_INDEX_V2.NOT_RECEIVED:t="STR_NOT_RECEIVED",s=!0;break;case h.TODO_SECTION_INDEX_V2.DOING_ONLY:t=(this.state.tab,h.TODO_TAB_INDEX.ASSIGNED_TO_ME,"STR_TODO_RECEIVED_2"),s=!0;break;case h.TODO_SECTION_INDEX_V2.OVERDUE:t="STR_EXPIRED_2",s=!0}const a=(e,t,s="")=>{let a=0,n=0;switch(e){case h.TODO_TAB_INDEX.I_ASSIGNED:a=this.state.tabCreatorUnread,n=this.state.tabCreatorCount;break;case h.TODO_TAB_INDEX.ASSIGNED_TO_ME:a=this.state.tabAssigneesUnread,n=this.state.tabAssigneesCount;break;case h.TODO_TAB_INDEX.WATCHERS:a=this.state.tabWatcherUnread,n=this.state.tabWatcherCount}let i=wn.i.getNewItem();return a=n<=0?null:a>0&&i&&i[e]&&i[e].constructor===Object&&!g.default.isEmptyObject(i[e])?o.a.createElement("div",{className:"td-unread-badge"},o.a.createElement("div",{className:"tdur-content"},"N")):o.a.createElement("div",{className:"td-unread-badge bagde-count"+(this.state.tab!==e?" inactive":"")},o.a.createElement("div",{className:"tdur-content"},n>99?"99+":n)),o.a.createElement(f.a,{textKey:t,tagName:"div",className:"td-tab"+(this.state.tab===e?" selected":""),"data-id":s,onClick:t=>this.onChangeTab(e,h.TODO_SECTION_INDEX_V2.DOING,!0)},o.a.createElement(E.a,{textKey:t,className:"truncate"}),a)},n=(e,t,a="")=>{if(this.state.tab===h.TODO_TAB_INDEX.DONE&&e!==h.TODO_SECTION_INDEX.ALL)return null;let n=0;switch(e){case h.TODO_SECTION_INDEX_V2.OVERDUE:n=this.state.sectionExpiredCount;break;case h.TODO_SECTION_INDEX_V2.DOING:n=this.state.sectionDoingCount+this.state.sectionExpiredCount;break;case h.TODO_SECTION_INDEX_V2.DONE:n=this.state.sectionDoneCount}let i=this.state.subTab===e;return!0===i||this.state.subTab!==h.TODO_SECTION_INDEX_V2.NOT_RECEIVED&&this.state.subTab!==h.TODO_SECTION_INDEX_V2.DOING_ONLY&&this.state.subTab!==h.TODO_SECTION_INDEX_V2.OVERDUE||e!==h.TODO_SECTION_INDEX_V2.DOING||!0!==s&&(i=!0),o.a.createElement("div",{className:"td-sub-tab"+(i?" selected":""),"data-id":a,onClick:t=>this.onChangeSubtab(e,!0),ref:t=>{this.state.subTab===e&&(this.selectedSubtabDOM=t)}},o.a.createElement("span",null,o.a.createElement(E.a,{textKey:t}),": ",n>99?"99+":n))};let i=null;if(e<=0)switch(this.state.loadState){case h.DEFAULT_LOAD_STATE.LOADING:i=this.getLoadingUI();break;case h.DEFAULT_LOAD_STATE.ERROR:i=this.getErrorUI();break;case h.DEFAULT_LOAD_STATE.EMPTY:default:i=this.props.showFilter&&this.startedSearching?this.getEmptySearchUI():this.getEmptyUI()}else i=o.a.createElement(Ns.a,{onResize:this.onResizer.bind(this)},(({width:t,height:s})=>o.a.createElement("div",{style:{height:`${s}px`,width:`${t}px`,position:"relative",overflowX:"hidden",outline:"none"},onWheel:this.onListWheel.bind(this)},o.a.createElement(Ns.d,{id:"react-v-list",ref:e=>this.mainList=e,style:{zIndex:"1",position:"absolute",willChange:"auto"},width:t,height:s,columnWidth:0,rowCount:e,rowHeight:e=>{if(!e)return 0;let t=this.state.items[e.index];if(!t)return 0;let s=t.data,a=t.type,n=s.id;return this._getItemHeight(e.index,n,a)},overscanRowCount:5,onScroll:this.handleVirtualizedScroll.bind(this),scrollTop:this.state.scrollToOffset,rowRenderer:({index:e,style:t})=>{if(!this.state.items)return null;let s=this.state.items[e];if(!s||!s.data)return null;let a=s.data.id;return o.a.createElement("div",{key:`${e}_${a}_${this.state.tab}_${this.state.subTab}`,style:t,"data-id":this.getDataId(this.state.tab).item},this.getView(e,t))}}),te.a.getScrollBar({height:s},(e=>this.customScrollBar=e),this.handleCustomScroll.bind(this),this.fullHeight))));return o.a.createElement("div",{style:{height:"calc(100% - 60px)",display:"flex",flexDirection:"column"}},!0===this.props.showFilter?o.a.createElement(ai,{user:this.props.user,onFilter:this.onFilter.bind(this),onToggleFilter:this.props.onToggleFilter,ref:e=>this.filterCOM=e}):null,o.a.createElement("div",{style:{width:"100%"},ref:e=>this.tabsDOM=e},o.a.createElement("div",{className:"todo-tab",style:{justifyContent:"center",overflow:"hidden"}},a(h.TODO_TAB_INDEX.I_ASSIGNED,"STR_I_ASSIGNED","div_TabToDo_ASGD"),a(h.TODO_TAB_INDEX.ASSIGNED_TO_ME,"STR_TO_DO","div_TabToDo_RECD"),a(h.TODO_TAB_INDEX.WATCHERS,"STR_GROUP_TASK","div_TabToDo_Follow")),o.a.createElement("div",{className:"todo-tab",style:{zIndex:2}},this.state.tab===h.TODO_TAB_INDEX.DONE?null:o.a.createElement("div",{style:{display:"flex",flex:1,justifyContent:"center"}},n(h.TODO_SECTION_INDEX_V2.DOING,"STR_NOT_COMPLETED",this.getDataId(this.state.tab).tabUI.doing),null,n(h.TODO_SECTION_INDEX_V2.DONE,"STR_COMPLETED_2"),o.a.createElement("div",{className:"td-sub-tab",style:{display:"flex",justifyContent:"center",color:!0===this.state.mainFilterShow||!0===s?"var(--blue-300)":"",background:!0===s?"var(--blue-700)":"",borderRadius:"18px",whiteSpace:"nowrap"},onClick:this.onShowFilterMainList.bind(this),id:"todo-list-more","data-id":this.getDataId(this.state.tab).tabUI.filter},o.a.createElement(E.a,{textKey:t,style:{textAlign:"right"}}),!0===s?`: ${e}`:"",o.a.createElement(D.a,{className:"caret-down todo-more"}),o.a.createElement(Za.default,{popoverProps:{identity:{windowId:"1",name:h.PopoverIdentitiesDefine.TODO_LIST}},ref:e=>this.moreMenu=e,items:[{textKey:"STR_OVERDUE_N",textArguments:[this.state.sectionExpiredCount],onclick:this.onMainListFilter.bind(this,h.TODO_SECTION_INDEX_V2.OVERDUE)},{textKey:"STR_NOT_RECEIVE_N",textArguments:[this.state.sectionNotReceivedCount],onclick:this.onMainListFilter.bind(this,h.TODO_SECTION_INDEX_V2.NOT_RECEIVED)},{textKey:"STR_RECEIVED_N",textArguments:[this.state.sectionReceivedCount],onclick:this.onMainListFilter.bind(this,h.TODO_SECTION_INDEX_V2.DOING_ONLY)}]}))),this.state.tab===h.TODO_TAB_INDEX.DONE?o.a.createElement("div",{style:{display:"flex",flex:1,justifyContent:"center"}},n(h.TODO_SECTION_INDEX.ALL,"STR_ALL"),o.a.createElement("div",{style:{width:"234px"}})):null),this.props.eventRemind&&this.props.eventRemind.eType&&(this.state.subTab==h.TODO_SECTION_INDEX_V2.DOING||this.state.subTab==h.TODO_SECTION_INDEX_V2.DONE)?(e=>{this.text=wn.i.getTextEventRemind(e);let t=null;return this.props.eventRemind.num&&(t=this.props.eventRemind.num),this.text?o.a.createElement("div",{className:"todo-remind-subtab"},o.a.createElement("div",{style:{marginLeft:"10px",width:"calc(100% - 40px)"},onClick:()=>this.props.onCheckOpenRemindTab(this.props.eventRemind)},o.a.createElement(E.a,{className:"text",textKey:this.text,textArguments:[t]}),". ",o.a.createElement(E.a,{className:"text",textKey:"STR_WATCHNOW",style:{textDecoration:"underline"}})),o.a.createElement("i",{className:"fa fa-close",style:{right:"10px",position:"absolute",marginLeft:"10px",fontSize:"14px"},onClick:this.props.closeTodoRemindTab})):null})(this.props.eventRemind.eType):null,o.a.createElement("div",{style:{width:"100%",height:"1px",background:"rgba(0, 0, 0, 0.1)"}})),this.props.showFilter&&this.startedSearching?o.a.createElement("div",{className:"search-todo-result-title",onClick:()=>{this.onFilter(null,!0),I.e.logAction(2174001)}},o.a.createElement(E.a,{textKey:"STR_SEARCH_RESULT"}),this.state.items?o.a.createElement("span",null,": ",this.state.items.length):null):null,!0===s?o.a.createElement("div",{className:"todo-filter-title-back"},o.a.createElement("div",{style:{flex:1,textAlign:"center"}},o.a.createElement(E.a,{textKey:t})," (",e,")"),o.a.createElement("i",{className:"fa fa-close",style:{fontSize:"12px"},onClick:this.onFilterBack.bind(this)})):null,o.a.createElement("div",{className:"todo-content-list "+(this.props.showFilter&&!this.startedSearching?"search":this.props.showFilter&&this.startedSearching?"searching":!0===s?" main-filter":""),ref:e=>this.listContainer=e,"data-id":this.getDataId(this.state.tab).list},i),o.a.createElement(jn,{ref:e=>this.action=e,data:null,user:this.props.user,onShowTodoDetail:this.onShowTodoDetail.bind(this),onDeleteTodo:this.onDeleteTodo.bind(this),onJumpMsg:this.onJumpMsg.bind(this),dispatch:this.props.dispatch,tabIndex:this.state.tab,confirm:this.props.confirm}))}}var oi=ii;wn.b.WAITING_FOR_RESPONSE,wn.b.EXPIRED_DUE,wn.b.STALE;o.a.Component;class ri extends o.a.Component{constructor(e){super(e),this.todoObj={},this.currentData=null,this.state={scrollToOffset:0,items:[]},this.itemHeight={}}componentWillReceiveProps(e){this.props.data!==e.data&&this._processData(e.data)}shouldComponentUpdate(e,t){return this.state.items!==t.items||this.state.scrollToOffset!==t.scrollToOffset}componentDidMount(){this._processData(this.props.data)}onListWheel(e){}_processData(e){if(!e)return;let t=[];e.forEach((e=>{let s=Object(a.a)({},e);!s.data||s.type!==wn.c.ITEM&&s.type!==wn.c.TITLE?(this.currentData&&this.currentData.id===s.id&&s&&(s=Object(a.a)(Object(a.a)({},s),{},{isExpand:!0})),t.push({data:s,type:wn.c.ITEM})):t.push(s)})),this.setState({items:t})}onResizer({width:e,height:t}){this.clientHeight=t}_getItemHeight(e,t,s){let a=this.itemHeight[t];return a||(!this.state.items||e>=this.state.items.length||e<0||void 0===e?0:155)}handleVirtualizedScroll(e){e&&null!=e.scrollTop&&this.customScrollBar&&this.customScrollBar.scrollTop(e.scrollTop)}handleCustomScroll(e){if(e){const{target:t}=e;if(!(t instanceof HTMLDivElement))return;this.setState({scrollToOffset:t.scrollTop})}}forceUpdateList(e=0){requestAnimationFrame((()=>{this.mainList&&this.mainList.recomputeRowHeights(e)}))}_onDidUpdateItemHeight(e,t){!t||this.itemHeight[e]&&this.itemHeight[e]===t||(this.itemHeight[e]=t,this.forceUpdateList())}onJumpMsg(e=null){let t=e||this.currentData;if(!t)return;let s=t.extra;if(!s)return;if(s.constructor===String)try{s=JSON.parse(s)}catch(i){}if(!s)return;let a=s.msgId,n=wn.i.getToUid(t,this.props.user.userId);S.a.gotoMessage(a,n,this.props.dispatch).then((e=>{let t={name:"message",userId:n};N.a.setOldTab(t)}))}onItemClick(e,t,s=!0){let n=this.state.items;if(!n||n.length<=t||t<0)return;if(void 0!==this.lastIndex&&null!==this.lastIndex){let e=n[this.lastIndex];e&&(e.data=Object(a.a)(Object(a.a)({},e.data),{},{isExpand:!1}),n[this.lastIndex]=e)}this.lastIndex=t;let i=n[t];if(i&&i.type===wn.c.ITEM){let o=i.data;o.id===e.id&&(i.data=Object(a.a)(Object(a.a)({},o),{},{isExpand:!0}),n[t]=i,this.currentData=e,!0===s&&this.onJumpMsg(),this.setState({items:[...n]}))}}onClearUnreadItem(){}showTodoAction(e,t){this.currentData=t,this.action&&(this.action.setData(t),this.action.showAction(e))}onShowTodoDetail(e=null){let t=e||this.currentData;t&&H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_PREVIEW,params:Object(a.a)({},t)})}onShowComment(e,t){this.commentsDOM&&this.commentsDOM.showAction(e)}onDeleteTodo(e=null){let t=e||this.currentData;t&&kn.a.deleteTodo(t,this.props.confirm,this.props.dispatch)}getView(e,t){if(!this.state.items||this.state.items.length<=0||e<-1||e>this.state.items.length)return null;let s=this.state.items[e];if(!s)return null;let a=s.data;switch(s.type){case wn.c.ITEM:return o.a.createElement(Bn.a,{bounds:!0,onResize:e=>{if(a){if(this.itemHeight[a.id]===e.bounds.height)return;this.itemHeight[a.id]=e.bounds.height}this.forceUpdateList()}},(({measureRef:t})=>o.a.createElement("div",{ref:t,style:{position:"relative"},key:`todo-item-${a.id}-${a.updateTime}-${a.status}`},o.a.createElement(Fn,{data:a,onDidUpdateSize:this._onDidUpdateItemHeight.bind(this),dispatch:this.props.dispatch,user:this.props.user,confirm:this.props.confirm,isExpired:s.expired,onItemClick:this.onItemClick.bind(this),index:e,onClearUnread:this.onClearUnreadItem.bind(this),tabIndex:this.state.tab,subTabIndex:this.state.subTab,onShowAction:this.showTodoAction.bind(this),onShowDetail:this.onShowTodoDetail.bind(this),groupList:this.props.groupList,openStatsByUser:this.props.openStatsByUser,onJumpMsg:this.onItemClick.bind(this),ref:e=>{this.itemRef||(this.itemRef={}),this.itemRef[a.id]=e},onShowComment:(e,t)=>this.onShowComment(e,t)}))));case wn.c.TITLE:{let e=`(${a.count})`;return this.itemHeight[a.id]=41,o.a.createElement("div",{className:"todo-section"},o.a.createElement(E.a,{textKey:a.textKey})," ",e)}}return null}render(){let e=this.state.items,t=this.state.items?e.length:0;this.fullHeight=0;const s=e=>{e.sort(((e,t)=>{let s=this.state.tab===h.TODO_TAB_INDEX.ASSIGNED_TO_ME&&e.data.creator!==this.props.user.userId?wn.i.isDingTodo(e.data.id):null,a=this.state.tab===h.TODO_TAB_INDEX.ASSIGNED_TO_ME&&t.data.creator!==this.props.user.userId?wn.i.isDingTodo(t.data.id):null;if(!0===s&&!0!==a)return-1;if(!0!==s&&!0===a)return 1;let n=e.data.updateTime;this.updatedTodo&&this.updatedTodo.hasOwnProperty(e.data.id)&&(n=this.updatedTodo[e.data.id].last_update_time);let i=t.data.updateTime;return this.updatedTodo&&this.updatedTodo.hasOwnProperty(t.data.id)&&(i=this.updatedTodo[t.data.id].last_update_time),i-n}))};this.props.isSort&&s(e);for(let a=0;a<t;a++){let e=this.state.items[a];e&&e.data&&(this.fullHeight+=this._getItemHeight(a,e.data.id,e.type))}return o.a.createElement("div",{style:{flex:1}},o.a.createElement(Ns.a,{onResize:this.onResizer.bind(this)},(({width:s,height:a})=>o.a.createElement("div",{style:{height:`${a}px`,width:`${s}px`,position:"relative",overflowX:"hidden",outline:"none"},onWheel:this.onListWheel.bind(this)},o.a.createElement(Ns.d,{id:"react-v-list",ref:e=>this.mainList=e,style:{zIndex:"1",position:"absolute",willChange:"auto"},width:s,height:a,columnWidth:0,rowCount:t,rowHeight:t=>{if(!t)return 0;let s=e[t.index];if(!s)return 0;let a=s.data,n=s.type,i=a.id;return this._getItemHeight(t.index,i,n)},overscanRowCount:5,onScroll:this.handleVirtualizedScroll.bind(this),scrollTop:this.state.scrollToOffset,rowRenderer:({index:t,style:s})=>{if(!e)return null;let a=e[t];if(!a||!a.data)return null;let n=a.data.id;return o.a.createElement("div",{key:`${t}_${n}`,style:s},this.getView(t,s))}}),te.a.getScrollBar({height:a},(e=>this.customScrollBar=e),this.handleCustomScroll.bind(this),this.fullHeight)))),o.a.createElement(jn,{ref:e=>this.action=e,data:null,user:this.props.user,onShowTodoDetail:this.onShowTodoDetail.bind(this),onDeleteTodo:this.onDeleteTodo.bind(this),onJumpMsg:this.onJumpMsg.bind(this),dispatch:this.props.dispatch,tabIndex:this.state.tab,confirm:this.props.confirm}))}}var li=ri,ci=s("x/Vt");o.a.Component;var di=s("WyAD"),hi=s.n(di),ui=s("ixXx"),_i=s.n(ui);const mi=1,pi=2,gi=0,Ei=1,fi=2,Ii=4,Ti={top:"260px",left:"80px"};class vi extends o.a.Component{constructor(e){super(e),this.state={showDetail:null,items:null,isLoading:!0,filterType:mi,filterTime:{start:null,end:null,type:gi},showFilterType:!1,isShowDateFilter:!1,isShowDateChoose:!1,isShowDatePicker:!1,posChooseDate:null,refresh:!1,popPos:Ti},this._rangeTimeChosen={left:null,right:null},this.fullData=null,this.textFilterTime=T.default.str("STR_ALL"),this.focusTypeItem=mi-1,this.queryFromBannerParams={numtask:"",headerTextKey:"",headerName:"",queryData:null},this._init(),this.eventHandler=(e,t)=>{switch(e){case p.GeneralActions.LEFTPANEL_RESIZE:if(t){let e=t.payload-68;this.checkSize(e)}break;case p.TodoActions.UPDATE_TODO:if(t){let e=this.state.showDetail?[...this.state.showDetail]:null;if(e&&e.length>0)for(let s=0;s<e.length;s++){let a=e[s];if(a&&a.id===t.id){e[s]=t,this.setState({showDetail:e});break}}}break;case p.TodoActions.REMOVE_TODO:if(t){let e=this.state.showDetail?[...this.state.showDetail]:null;if(e&&e.length>0)for(let s=0;s<e.length;s++){let a=e[s];if(a&&a.id===t){e.splice(s,1),this.queryFromBannerParams&&this.queryFromBannerParams.numtask>0&&this.queryFromBannerParams.numtask--,this.setState({showDetail:e});break}}}}},v.default.subscribe(this.eventHandler),this.updateLanguage=()=>{let e=te.a.getLeftPannelWidth()-68;this.checkSize(e)},T.default.callUpdate(this.updateLanguage),this.loadChart=this.loadChart.bind(this),this.renderItem=this.renderItem.bind(this),this.showDetailItem=this.showDetailItem.bind(this),this._curentDatePicker=this._curentDatePicker.bind(this),this._clickOutDateFilter=this._clickOutDateFilter.bind(this),this._getList=this._getList.bind(this),this._getTitleDateFilter=this._getTitleDateFilter.bind(this),this.checkOpenDetailForBannerTodov2=this.checkOpenDetailForBannerTodov2.bind(this)}_init(){this.iAssign=[],this.iAssign_inProcess=[],this.iAssign_unResponse=[],this.iAssign_expired=[],this.iAssign_done=[],this.iAssign_due_expired=[],this.iAssign_noUpdate=[],this.assignMe=[],this.assignMe_inProcess=[],this.assignMe_unResponse=[],this.assignMe_expired=[],this.assignMe_done=[],this.assignMe_due_expired=[],this.assignMe_noUpdate=[],this.IAssignDoneTask={},this.IAssignTask={},this.AssignMeDoneTask={},this.AssignMeTask={},this.mostIAssignDoneTask=null,this.mostIAssignTask=null,this.mostAssignMeDoneTask=null,this.mostAssignMeTask=null}_getList(){let e=wn.i.getAllTodos();e&&(e.constructor===Promise?e.then((e=>{this.fullData=e,this._check(e),this.iAssign_unResponse.length||this.iAssign_inProcess.length||this.iAssign_expired.length||this.iAssign_done.length?this.setState({isLoading:!1}):(this.focusTypeItem=pi-1,this.setState({isLoading:!1,filterType:pi}))})).catch((e=>{})):e.constructor===Object&&(this._check(e),this.fullData=e,this.iAssign_unResponse.length||this.iAssign_inProcess.length||this.iAssign_expired.length||this.iAssign_done.length?this.setState({isLoading:!1}):(this.focusTypeItem=pi-1,this.setState({isLoading:!1,filterType:pi}))))}componentWillMount(){this.checkOpenDetailForBannerTodov2(),this._getList()}_setDefaultRangeTime(){this._rangeTimeChosen.right=null,this._rangeTimeChosen.left=null}checkOpenDetailForBannerTodov2(){let e=wn.i.getSummaryTodoInitInfo();if(!e)return;wn.i.setSummaryTodoInitInfo(null);let t=e.isGroup;this.queryFromBannerParams.headerName=e.convName,this.queryFromBannerParams.queryData=e,t?this.queryFromBannerParams.headerTextKey="STR_TODO_DETAIL_BANNER_HEADER_GROUP":e.assigner===this.props.user.userId?this.queryFromBannerParams.headerTextKey="TODO_UNDONE_HEADER_ASSIGNER_1_1":e.assignee===this.props.user.userId&&(this.queryFromBannerParams.headerTextKey="TODO_UNDONE_HEADER_ASSIGNEE_1_1"),this.textShowDetail=e.textKeyHeader,e.arr?(this.queryFromBannerParams.numtask=e.arr.length,this.setState({showDetail:e.arr})):this.setState({showDetail:[]})}_isValidDate(e){return"right"===this.state.posChooseDate&&this._rangeTimeChosen.left&&e&&e._d&&e._d.getTime?this._rangeTimeChosen.left<e._d.getTime()&&e._d.getTime()<Date.now():"left"===this.state.posChooseDate&&this._rangeTimeChosen.right&&e&&e._d&&e._d.getTime?e._d.getTime()<this._rangeTimeChosen.right:!!(e&&e._d&&e._d.getTime)&&e._d.getTime()<Date.now()}_submitDate(e){e._d.setHours(0,0,0,0);let t=Date.parse(e._d);"left"==this.state.posChooseDate?(this._rangeTimeChosen.left=t,I.e.logAction(1710606)):(this._rangeTimeChosen.right=t,I.e.logAction(1710607)),this._rangeTimeChosen.left&&this._rangeTimeChosen.right?this._rangeTimeChosen.left>this._rangeTimeChosen.right?this._changeDateFilter(4,this._rangeTimeChosen.left,this._rangeTimeChosen.right):this._changeDateFilter(4,this._rangeTimeChosen.right,this._rangeTimeChosen.left):this.setState({isShowDatePicker:!1})}_changeDateFilter(e,t=null,s=null){let a=new Date;if(this.state.filterTime.type===Ii&&e===Ii&&!t&&!s)return void this.setState({isShowDateChoose:!this.state.isShowDateChoose});let n=this.state.posChooseDate,i=this.state.isShowDateFilter,o=this.state.isShowDateChoose,r=this.state.isShowDatePicker;switch(e){case gi:t=null,s=null,i=!1,o=!1,this.textFilterTime=T.default.str("STR_ALL"),this._setDefaultRangeTime(),I.e.logAction(1710604);break;case Ei:s=(t=a.setHours(0,0,0,0))-6048e5,i=!1,o=!1,this.textFilterTime=T.default.str("STR_FILTER_DATE_WEEK"),this._setDefaultRangeTime(),I.e.logAction(1710605);break;case fi:s=(t=a.setHours(0,0,0,0))-2592e6,i=!1,o=!1,this.textFilterTime=T.default.str("STR_FILTER_DATE_MONTH"),this._setDefaultRangeTime(),I.e.logAction(1710606);break;case Ii:t||s||(t=this._rangeTimeChosen.right,s=this._rangeTimeChosen.left),n=null,r=!1,i=!1,this.textFilterTime=this._getTitleDateFilter(),I.e.logAction(1710607)}this.setState({filterTime:{start:t,end:s,type:e},isShowDatePicker:r,posChooseDate:n,isShowDateFilter:i,isShowDateChoose:o})}_curentDatePicker(e){return"left"==e?this._rangeTimeChosen.left?_.a.getDateFromMilisecond(this._rangeTimeChosen.left):T.default.str("STR_FROM_DATE"):this._rangeTimeChosen.right?_.a.getDateFromMilisecond(this._rangeTimeChosen.right):T.default.str("STR_TO_DATE_2")}_clickOutDateFilter(e){!this._refDateFilter||e.target.compareDocumentPosition(this._refDateFilter)&Node.DOCUMENT_POSITION_CONTAINS||(this.setState({isShowDateFilter:!this.state.isShowDateFilter,isShowDatePicker:!1,posChooseDate:null}),document.removeEventListener("mousedown",this._clickOutDateFilter,!0))}_showTypeFilter(e){e&&(e.stopPropagation(),e.preventDefault()),this.setState({showFilterType:!this.state.showFilterType})}onHideDropdown(e){e||this.setState({showFilterType:!1})}_showDateFilter(e){e&&(e.stopPropagation(),e.preventDefault()),this.setState({isShowDateFilter:!this.state.isShowDateFilter}),document.addEventListener("mousedown",this._clickOutDateFilter,!0)}_check(e){if(!e)return;this._init();let t=864e5,s=new Date;s.setHours(0,0,0,0);let a=new Date(s.getTime()-s.getDay()*t),n=new Date(a.getTime()-5184e5);this.startDay=_.a.getDateMonthString(n.getTime()),this.endDay=_.a.getDateMonthString(a.getTime()),a.setHours(23,59,0,0);for(let i in e){let t=e[i],s=t.status===wn.g.DONE?t.updateTime:t.createTime,a=new Date(s);a.setHours(0,0,0,0);let n=!0;if(this.state.filterTime.start&&this.state.filterTime.end&&(n=this.state.filterTime.end<=a.getTime()&&a.getTime()<=this.state.filterTime.start),n){let e=wn.i.classifyTodoItem(t,this.props.user.userId);if(e.isCreator){this.iAssign.push(t);for(let e of t.assignees)this.IAssignTask[e.userId]?this.IAssignTask[e.userId].push(t):this.IAssignTask[e.userId]=[t];if(!e.isCompleted&&wn.i.checkRemindTask(t,this.props.user,wn.f.NONE_UPDATE_TASKS)&&this.iAssign_noUpdate.push(t),!e.isExpired&&wn.i.checkRemindTask(t,this.props.user,wn.f.INCOMING_DUE_DATE)&&this.iAssign_due_expired.push(t),e.isExpired&&!e.isCompleted)this.iAssign_expired.push(t),this.iAssign_due_expired.push(t);else if(e.isCompleted){this.iAssign_done.push(t);for(let e of t.assignees)this.IAssignDoneTask[e.userId]?this.IAssignDoneTask[e.userId].push(t):this.IAssignDoneTask[e.userId]=[t]}t.status===wn.g.WAITING_FOR_RESPONSE?this.iAssign_unResponse.push(t):t.status===wn.g.IN_PROCESS&&this.iAssign_inProcess.push(t)}if(e.isAssignee){let s=t.status;if(t.assignees.length>1)for(let e of t.assignees)if(e.userId===this.props.user.userId){s=e.status;break}!e.isCompleted&&wn.i.checkRemindTask(t,this.props.user,wn.f.NONE_UPDATE_TASKS)&&this.assignMe_noUpdate.push(t),!e.isExpired&&wn.i.checkRemindTask(t,this.props.user,wn.f.INCOMING_DUE_DATE)&&this.assignMe_due_expired.push(t),this.AssignMeTask[t.creator]?this.AssignMeTask[t.creator].push(t):this.AssignMeTask[t.creator]=[t],this.assignMe.push(t),e.isExpired&&!e.isCompleted?(this.assignMe_expired.push(t),this.assignMe_due_expired.push(t)):e.isCompleted&&(this.assignMe_done.push(t),this.AssignMeDoneTask[t.creator]?this.AssignMeDoneTask[t.creator].push(t):this.AssignMeDoneTask[t.creator]=[t]),s===wn.g.WAITING_FOR_RESPONSE?this.assignMe_unResponse.push(t):s===wn.g.IN_PROCESS&&this.assignMe_inProcess.push(t)}}}this.setState({refresh:!this.state.refresh})}_getTitleDateFilter(){let e=_.a.getDateYears(this._rangeTimeChosen.left),t=_.a.getDateYears(this._rangeTimeChosen.right),s=_.a.getDateFromMilisecond(this._rangeTimeChosen.left).split("/"),a=_.a.getDateFromMilisecond(this._rangeTimeChosen.right).split("/");const n=s=>{let a=null;return a=e==t?s[0]+"/"+s[1]:s[0]+"/"+s[1]+"/"+s[2][2]+s[2][3],a};return n(s)+"-"+n(a)}_findMostAssign(e){let t=null,s=0;for(let a in e)a!==this.props.user.userId&&e[a].length>s?(t={},t[a]=e[a],s=e[a].length):a!==this.props.user.userId&&e[a].length==s&&(t[a]=e[a]);return t}componentDidMount(){this.loadChart(),this.updateLanguage()}componentDidUpdate(e,t){(this.myChart&&this.state.filterType!==t.filterType||this.state.filterTime.start!==t.filterTime.start||this.state.filterTime.end!==t.filterTime.end)&&this._check(this.fullData),this.loadChart()}componentWillUnmount(){v.default.unsubscribe(this.eventHandler),T.default.removeUpdate(this.updateLanguage)}onChartClick(e,t){let s=null,a=null,n=null;this.state.filterType===mi?(s=T.default.str("STR_I_ASSIGNED").toLowerCase(),0==t?(a=T.default.str("STR_NOT_RECEIVED").toLowerCase(),n=this.iAssign_unResponse,I.e.logAction(1710610)):1==t?(a=T.default.str("STR_TODO_RECEIVED").toLowerCase(),n=this.iAssign_inProcess,I.e.logAction(1710611)):2==t?(a=T.default.str("STR_EXPIRED_2").toLowerCase(),n=this.iAssign_expired,I.e.logAction(1710612)):3==t&&(a=T.default.str("STR_TODO_COMPLETED").toLowerCase(),n=this.iAssign_done,I.e.logAction(1710613))):(s=T.default.str("STR_TO_DO").toLowerCase(),0==t?(a=T.default.str("STR_NOT_RECEIVED").toLowerCase(),n=this.assignMe_unResponse,I.e.logAction(1710610)):1==t?(a=T.default.str("STR_TODO_RECEIVED").toLowerCase(),n=this.assignMe_inProcess,I.e.logAction(1710611)):2==t?(a=T.default.str("STR_EXPIRED_2").toLowerCase(),n=this.assignMe_expired,I.e.logAction(1710612)):3==t&&(a=T.default.str("STR_TODO_COMPLETED").toLowerCase(),n=this.assignMe_done,I.e.logAction(1710613))),this.textShowDetail=this.textTitleShowDetail(n.length,s,a),this.setState({showDetail:n})}onShowExpired(){let e=null,t=null;this.state.filterType===mi?(e=T.default.str("STR_I_ASSIGNED").toLowerCase(),t=this.iAssign_due_expired):(e=T.default.str("STR_TO_DO").toLowerCase(),t=this.assignMe_due_expired),t.length&&(this.textShowDetail=T.default.trans("STR_TODO_EXPIRED_TASK_2S",[e])+": "+t.length,this.setState({showDetail:t}),I.e.logAction(1710614))}onShowNoUpdate(){let e=null,t=null;this.state.filterType===mi?(e=T.default.str("STR_I_ASSIGNED").toLowerCase(),t=this.iAssign_noUpdate):(e=T.default.str("STR_TO_DO").toLowerCase(),t=this.assignMe_noUpdate),t.length&&(this.textShowDetail=T.default.trans("STR_TODO_NOT_UPDATED_TASK_3",[e])+": "+t.length,this.setState({showDetail:t}),I.e.logAction(1710615))}loadChart(){if(this.myChart&&this.myChart.canvas&&this.myChart.destroy(),this._myChartRef){let e=[T.default.str("STR_NOT_RECEIVED"),T.default.str("STR_TODO_RECEIVED"),T.default.str("STR_EXPIRED_2"),T.default.str("STR_COMPLETED_2")],t=[this.iAssign_unResponse.length,this.iAssign_inProcess.length,this.iAssign_expired.length,this.iAssign_done.length],s=[this.assignMe_unResponse.length,this.assignMe_inProcess.length,this.assignMe_expired.length,this.assignMe_done.length];this.myChart=new hi.a(this._myChartRef,{type:"bar",data:{labels:e,datasets:[{data:this.state.filterType===mi?t:s,backgroundColor:["#0068ff","#7562d8","#db342e","#15a85f"]}]},intersect:!1,options:{maintainAspectRatio:!1,layout:{padding:{left:0,right:0,top:20,bottom:0}},legend:{display:!1},scales:{yAxes:[{stacked:!0,ticks:{display:!1,beginAtZero:!0,padding:20}}],xAxes:[{stacked:!0,barPercentage:.6,fontSize:12,ticks:{beginAtZero:!0,fontSize:12}}]},onClick:(e,t)=>{let s=this.myChart.getElementAtEvent(e)[0];if(s){s._chart.data;let e=s._datasetIndex;this.onChartClick(e,s._index)}},animation:{duration:0,onProgress:function(){var e=this.chart,t=e.ctx;t.font=hi.a.helpers.fontString(12,hi.a.defaults.global.defaultFontStyle,hi.a.defaults.global.defaultFontFamily),t.textAlign="center",t.textBaseline="bottom",t.fillStyle="white";this.data.datasets.forEach((function(s,a){e.controller.getDatasetMeta(a).data.forEach((function(e,a){var n=s.data[a];Object.keys(s._meta)[0]&&t.fillText(n,e._model.x,e._model.y-7)}))}))},onComplete:function(){var e=this.chart,t=e.ctx;t.font=hi.a.helpers.fontString(12,hi.a.defaults.global.defaultFontStyle,hi.a.defaults.global.defaultFontFamily),t.textAlign="center",t.textBaseline="bottom",t.fillStyle="white";this.data.datasets.forEach((function(s,a){e.controller.getDatasetMeta(a).data.forEach((function(e,a){var n=s.data[a];Object.keys(s._meta)[0]&&t.fillText(n,e._model.x,e._model.y-7)}))}))}}}})}}cancelShowDetail(){this.queryFromBannerParams&&this.queryFromBannerParams.queryData?this.props.closeWeekSummaryTab():(this.queryFromBannerParams={numtask:"",headerTextKey:"",headerName:"",queryData:null},wn.i.setUpdateTodoCallback_inSummary(null),this.setState({showDetail:null}))}textTitleShowDetail(e,t,s){return e&&t&&s?T.default.str("STR_TODO_SHORT")+" "+t.toLowerCase()+" "+s.toLowerCase()+": "+e:null}showDetailItem(e,t,s,a){t&&e&&s&&a&&(this.textShowDetail=T.default.trans(e,[s.length,g.default.getStringByLength(t),a]),this.setState({showDetail:s}))}renderItem(e,t){if(!e||!t)return;let s=null,a=null,n=null,i="STR_RECEIVED",r=[];for(let l in t){let c=t[l],d=k.default.getMiniInfo(l),h=null,_=null,m=!0;"STR_BEST_DONE_TASK_I_ASSIGN"==e?(this.IAssignTask.hasOwnProperty(l)&&(h=this.IAssignTask[l]),_=c,i="STR_ASSIGNED",a="STR_TITLE_BEST_TASK_I_ASSIGN",n="STR_TITLE_BEST_DONE_TASK_I_ASSIGN",h&&(h.length<s||!s)?(r=[],s=h.length):s&&h&&h.length>s&&(m=!1)):(h=this.AssignMeTask[l],this.IAssignTask.hasOwnProperty(l)&&(_=this.AssignMeDoneTask[l]),a="STR_TITLE_BEST_TASK_ASSIGN_TO_ME",n="STR_TITLE_BEST_DONE_TASK_ASSIGN_TO_ME",_&&(_.length>s||!s)?(r=[],s=_.length):s&&_&&_.length<s&&(m=!1)),m&&r.push(o.a.createElement("div",{style:{display:"flex",paddingTop:"23px"}},o.a.createElement(u.b,{size:"xl",target:{avatar:d.avatar,displayName:d.dName,id:d.userId}}),o.a.createElement("div",{style:{paddingLeft:"15px"},className:"truncate"},o.a.createElement("div",{className:"tag-name truncate"},d.dName),o.a.createElement("div",{className:"truncate tag-description"+(h?"":"-disable"),onClick:()=>{this.showDetailItem(a,d.dName,h,this.startDay+" - "+this.endDay)}},o.a.createElement(E.a,{textKey:i}),":  ",h?h.length:0," "),o.a.createElement("div",{className:"truncate tag-description"+(_?"":"-disable"),onClick:()=>{this.showDetailItem(n,d.dName,_,this.startDay+" - "+this.endDay)}},o.a.createElement(E.a,{textKey:"STR_TODO_COMPLETED"}),":   ",_?_.length:0," "))))}return o.a.createElement("div",{className:"todo-week-summary-tag"},o.a.createElement("div",{className:"header"},o.a.createElement("div",{className:"todo-crown-icon",style:"STR_BEST_DONE_TASK_I_ASSIGN"==e?{background:"var(--green-300)"}:null},o.a.createElement("i",{className:"fa fa-crown",style:{height:"11px"}})),o.a.createElement(E.a,{textKey:e,className:"tag-title"})),r)}onSelectType(e,t){e.value==mi?(this.focusTypeItem=mi-1,I.e.logAction(1710602)):(this.focusTypeItem=pi-1,I.e.logAction(1710603)),this.setState({filterType:e.value,showFilterType:!1})}componentWillUpdate(e,t){}checkSize(e){let t=T.default.currentLanguage(),s=Ti;(t===h.LANG_INDEX_EN&&e<=280||t===h.LANG_INDEX_VI&&e<=303)&&(s={top:"290px",left:"80px"}),this.setState({popPos:s})}onUpdateDatePos(){if(this._refDateFilter){let e=this._refDateFilter.offsetTop,t=this._refDateFilter.offsetHeight,s=window.innerHeight;e+t>s&&(this._refDateFilter.style.top=s-t-10+"px")}}render(){let e=this.state.filterType==mi?T.default.str("STR_I_ASSIGNED"):T.default.str("STR_TO_DO"),t=(this.iAssign_unResponse.length||this.iAssign_inProcess.length||this.iAssign_expired.length||this.iAssign_done.length,this.assignMe_unResponse.length||this.assignMe_inProcess.length||this.assignMe_expired.length||this.assignMe_done.length,!(this.state.filterType===mi&&!this.iAssign_due_expired.length&&!this.iAssign_noUpdate.length||this.state.filterType===pi&&!this.assignMe_due_expired.length&&!this.assignMe_noUpdate.length)),s=this.queryFromBannerParams.headerTextKey||"STR_TODO_DETAIL_BANNER_HEADER_11";return o.a.createElement("div",{className:"",style:{flex:1}},this.state.showDetail?o.a.createElement("div",{className:"",style:{height:"100%",backgroundColor:"var(--white-300)",display:"flex",flexDirection:"column"}},o.a.createElement("div",{className:"todo-stats-header",style:{justifyContent:"center"}},o.a.createElement("div",{className:"todo-stats-header-text"},o.a.createElement(E.a,{className:"header-first-text ",textKey:s}),this.queryFromBannerParams.headerName?o.a.createElement("span",{className:"header-conv-name truncate"},this.queryFromBannerParams.headerName):null),o.a.createElement("i",{className:"fa fa-close todo-close-button",onClick:this.cancelShowDetail.bind(this)})),o.a.createElement("div",{className:"todo-week-summary-title",style:{border:"none"}},o.a.createElement(E.a,{textKey:this.textShowDetail}),o.a.createElement("span",{style:{marginLeft:"3px"}},this.queryFromBannerParams.numtask)),o.a.createElement(li,{data:[...this.state.showDetail],dispatch:this.props.dispatch,user:this.props.user,groupList:this.props.groupList,confirm:this.props.confirm,isSort:!0})):o.a.createElement("div",{style:{height:"100%",backgroundColor:"rgba(9, 30, 66, 0.04)"}},o.a.createElement("div",{className:"todo-week-summary-title"},o.a.createElement("div",{style:{width:"100%",justifyContent:"center"}},o.a.createElement(E.a,{textKey:"STR_TODO_DETAIL_BANNER_HEADER_11"})),o.a.createElement("i",{className:"fa fa-close todo-close-button",onClick:this.props.closeWeekSummaryTab})),this.state.isLoading||this.fullData&&Object.keys(this.fullData).length?o.a.createElement(zt.b,{autoHide:!0,noHScroll:!0,noVScroll:!1,style:{height:"calc(100% - 40px)",width:"100%",background:"var(--grey-600)"}},o.a.createElement("div",{style:{height:"100%"}},o.a.createElement(E.a,{textKey:"STR_STATISTICAL_CHARTS",className:"todo-week-summary-session"}),o.a.createElement("div",{className:"todo-week-summary-chart",style:{padding:"0px"}},o.a.createElement("div",{style:{position:"relative",paddingBottom:"33px"}},o.a.createElement("div",{style:{padding:"15px",display:"flex",flexWrap:"wrap",justifyContent:"space-between"}},o.a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"3px",zIndex:2}},o.a.createElement(E.a,{textKey:"STR_FILE_TYPE",style:{fontSize:"14px"}})," : ",o.a.createElement("div",{className:"filter-att-item  prevent-hover",onClick:this._showTypeFilter.bind(this),style:{cursor:"pointer",borderBottom:"none",width:"68px",padding:"4px",background:"var(--grey-500)",borderRadius:"5px",flex:"none"}},o.a.createElement("div",{className:"filter-dropdown-result truncate"},o.a.createElement(E.a,{textKey:e,style:{fontSize:"14px"}}),o.a.createElement("i",{className:"fa fa-dropdown",style:{marginTop:"9px"}})),this.state.showFilterType?o.a.createElement(Yn,{itemHeight:30,placeholder:T.default.str("STR_ASSIGNER"),containerClass:" todo-filter-dropdown ",showDropdown:!0,onChange:this.onSelectType.bind(this),onDropdownVisibleChange:this.onHideDropdown.bind(this),options:[{value:mi,text:T.default.str("STR_I_ASSIGNED")},{value:pi,text:T.default.str("STR_TO_DO")}],enableSearch:!1,focusIndex:this.focusTypeItem,ref:e=>this.assignerDropdrown=e}):null)),o.a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"3px",position:"relative"}},o.a.createElement(E.a,{textKey:"STR_TIME_STAT",style:{fontSize:"14px"}}),"  ",o.a.createElement("div",{className:"filter-att-item  prevent-hover",onClick:this._showDateFilter.bind(this),title:this.textFilterTime,style:this.state.isShowDateFilter?{cursor:"pointer",pointerEvents:"none",borderBottom:"none",width:"92px",padding:"4px",background:"var(--grey-500)",borderRadius:"5px",flex:"none"}:{cursor:"pointer",borderBottom:"none",width:"92px",padding:"4px",background:"var(--grey-500)",borderRadius:"5px",flex:"none"}},o.a.createElement("div",{className:"filter-dropdown-result truncate"},o.a.createElement(E.a,{textKey:this.textFilterTime,className:"truncate",style:{fontSize:"14px",width:"92px"}}),o.a.createElement("i",{className:"fa fa-dropdown",style:{marginTop:"9px"}}))),this.state.isShowDateFilter?o.a.createElement("div",{style:this.state.popPos,ref:e=>this._refDateFilter=e,className:"date-picker-filter"},o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_ALL",style:{fontSize:"14px"},className:"date-picker-filter__options "+(this.state.filterTime.type==gi?"active":""),onClick:this._changeDateFilter.bind(this,gi)}),o.a.createElement("hr",{style:{height:"1px",border:"0px",marginTop:"0px",marginBottom:"0px",backgroundColor:"var(--white-300)",opacity:"0.08"}}),o.a.createElement(E.a,{textKey:"STR_FILTER_DATE_WEEK",style:{fontSize:"14px"},className:"date-picker-filter__options "+(this.state.filterTime.type==Ei?"active":""),onClick:this._changeDateFilter.bind(this,Ei)}),o.a.createElement("hr",{style:{height:"1px",border:"0px",marginTop:"0px",marginBottom:"0px",backgroundColor:"var(--white-300)",opacity:"0.08"}}),o.a.createElement(E.a,{textKey:"STR_FILTER_DATE_MONTH",style:{fontSize:"14px"},className:"date-picker-filter__options "+(this.state.filterTime.type==fi?"active":""),onClick:this._changeDateFilter.bind(this,fi)}),o.a.createElement("hr",{style:{height:"1px",border:"0px",marginTop:"0px",marginBottom:"0px",backgroundColor:"var(--white-300)",opacity:"0.08"}}),o.a.createElement("div",{className:"date-picker-filter__options "+(this.state.filterTime.type===Ii?"active":""),onClick:()=>{this.setState({isShowDateChoose:!this.state.isShowDateChoose})}},o.a.createElement(E.a,{textKey:"STR_FILTER_CHOOSE_DATE",style:{width:"250px",fontSize:"14px"}}),o.a.createElement("i",{className:this.state.isShowDateChoose?"fa fa-caret-up date-picker-filter__options__icon":"fa fa-caret-down date-picker-filter__options__icon"}))),this.state.isShowDateChoose?o.a.createElement("div",null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement("div",{className:"flx flx-al-c date-filter-button-date",style:{marginLeft:"14px"},onClick:()=>{"left"==this.state.posChooseDate?this.setState({posChooseDate:null,isShowDatePicker:!this.state.isShowDatePicker}):this.setState({posChooseDate:"left",isShowDatePicker:!0},(()=>{this.onUpdateDatePos()}))}},o.a.createElement(xn.a,{disabled:!0,textKey:this._curentDatePicker("left"),className:"flx-cell",type:"text"}),o.a.createElement("i",{style:{color:"left"==this.state.posChooseDate?"var(--blue-300)":null},className:"fa fa-search-media-icon-date btn group-search__icon"})),o.a.createElement("hr",{style:{flex:1,height:"1px",border:"0px",marginTop:"23px",backgroundColor:"var(--white-300)"}}),o.a.createElement("div",{className:"flx flx-al-c date-filter-button-date",style:{marginRight:"12px"},onClick:()=>{"right"==this.state.posChooseDate?this.setState({posChooseDate:null,isShowDatePicker:!this.state.isShowDatePicker}):this.setState({posChooseDate:"right",isShowDatePicker:!0},(()=>{this.onUpdateDatePos()}))}},o.a.createElement(xn.a,{disabled:!0,textKey:this._curentDatePicker("right"),className:"flx-cell",type:"text"}),o.a.createElement("i",{style:{color:"right"==this.state.posChooseDate?"var(--blue-300)":null},className:"fa fa-search-media-icon-date btn group-search__icon"}))),this.state.isShowDatePicker?o.a.createElement("div",{style:{margin:"14px",marginTop:"5px"}},o.a.createElement(_i.a,{className:"rdt calendar-only",input:!1,locale:0===T.default.currentLanguage()?"vi":"en",timeFormat:!1,value:"left"==this.state.posChooseDate&&this._rangeTimeChosen.left?new Date(this._rangeTimeChosen.left):"right"==this.state.posChooseDate&&this._rangeTimeChosen.right?new Date(this._rangeTimeChosen.right):new Date,isValidDate:this._isValidDate.bind(this),onChange:this._submitDate.bind(this),showCalendarOnly:!0})):null):null):null)),o.a.createElement("div",{style:{height:"250px"}},o.a.createElement("canvas",{style:{paddingTop:"10px",height:"250px"},ref:e=>this._myChartRef=e})))),t?o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_REMARKABLE_TASKS",className:"todo-week-summary-session"}),o.a.createElement("div",{style:{background:"var(--white-300)"}},o.a.createElement("div",{style:{fontSize:"13px",cursor:"pointer",margin:"0px 17px",padding:"10px 0px",borderBottom:"1px solid var(--grey-300)",display:"flex",justifyContent:"space-between"},onClick:this.onShowExpired.bind(this)},o.a.createElement(E.a,{textKey:"STR_TODO_EXPIRED_TASKS"}),o.a.createElement("div",{style:{float:"right",color:"var(--red-300)",fontWeight:"600"}},this.state.filterType===mi?this.iAssign_due_expired.length:this.assignMe_due_expired.length)),o.a.createElement("div",{style:{fontSize:"13px",cursor:"pointer",margin:"0px 17px",padding:"10px 0px",display:"flex",justifyContent:"space-between"},onClick:this.onShowNoUpdate.bind(this)},o.a.createElement(E.a,{textKey:"STR_TODO_NOT_UPDATED_TASKS"}),o.a.createElement("div",{style:{float:"right",color:"var(--red-300)",fontWeight:"600"}},this.state.filterType===mi?this.iAssign_noUpdate.length:this.assignMe_noUpdate.length)))):null)):o.a.createElement("div",{style:{background:"var(--white-300)",height:"313px",display:"flex",alignItems:"center",justifyContent:"center"}},o.a.createElement("div",{className:"fa fa-chartempty",style:{fontSize:"150px",color:"var(--grey-500)"}}),o.a.createElement(E.a,{textKey:"STR_EMPTY_CHART",style:{color:"var(--neutral-500)",position:"absolute",alignSelf:"flex-end",paddingBottom:"45px"}}))))}}var Ri=vi;class Si extends o.a.Component{constructor(e){super(e),this.state={items:null,length:0,doneFilter:!1}}componentWillMount(){wn.i.viewRemindTask(this.props.eventRemind.eType,this.props.user).then((e=>{e?this.setState({items:e.data,length:e.length,doneFilter:!0}):this.setState({doneFilter:!0})})).catch((e=>{console.error(e)}))}componentWillUnmount(){wt.f.setTodoEventRemind(this.props.user.userId,null)}componentDidMount(){(!this.props.eventRemind||this.props.eventRemind&&!this.props.eventRemind.num)&&this.props.closeTodoRemindTab()}render(){return o.a.createElement("div",{className:"",style:{height:"calc(100% - 47px)",background:"var(--white-300)"}},this.state.doneFilter&&0==this.state.length?o.a.createElement("div",null,o.a.createElement("div",{className:"back-to-stats"},o.a.createElement(E.a,{style:{width:"100%"},textKey:"STR_TODO_LIST_EMPTY"}),o.a.createElement("i",{className:"fa fa-close todo-close-button",onClick:this.props.closeTodoRemindTab})),o.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",textAlign:"center",background:"var(--white-300)"}},o.a.createElement("div",{style:{height:"40px"}}),o.a.createElement("i",{className:"fa fa-icn-todo-selected",style:{color:"var(--grey-400)",fontSize:"72px",marginBottom:"12px"}}),o.a.createElement(E.a,{textKey:"STR_TODO_LIST_EMPTY",tagName:"div",style:{fontSize:"12px",color:"var(--neutral-600)"}}))):this.state.items&&this.props.eventRemind?o.a.createElement("div",{className:"",style:{height:"100%"}},o.a.createElement("div",{className:"back-to-stats"},o.a.createElement(E.a,{style:{width:"100%"},textKey:wn.i.getTextEventRemind(this.props.eventRemind.eType),textArguments:[this.state.length]}),o.a.createElement("i",{className:"fa fa-close todo-close-button",onClick:this.props.closeTodoRemindTab})),o.a.createElement(li,{data:this.state.items,dispatch:this.props.dispatch,user:this.props.user,groupList:this.props.groupList,confirm:this.props.confirm,isRemindView:!0})):o.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex"}},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner",style:{fontSize:"26px",color:"var(--blue-300)",margin:"auto"}})))}}var Oi=Si;class Ni extends o.a.Component{constructor(e){super(e),this.itemHeight={},this.isFireFoxBrowser=this.isFireFox(),this.state={items:[],scrollToOffset:0,loadState:h.DEFAULT_LOAD_STATE.LOADING},this.forceUpdateList=(e=0)=>{requestAnimationFrame((()=>{this.mainList&&this.mainList.recomputeRowHeights(e)}))},this.refresh=()=>{this.onLoadData(this.props.data)},this.openStatsByUser=this.openStatsByUser.bind(this),this.scr=(e,t=!0)=>{e&&(this.scrollTimeOut&&(clearTimeout(this.scrollTimeOut),this.scrollTimeOut=null),this.scrollTimeOut=setTimeout((()=>{this.state.loadState===h.DEFAULT_LOAD_STATE.RESULT?(this.onScrollToTodo(e,t),this.forceScrollToId=void 0):this.state.loadState===h.DEFAULT_LOAD_STATE.LOADING&&this.scr(e,t)}),100))},wn.i.regGCCallback(this.refresh)}componentWillUpdate(){this.props.eventRemind&&(this.timerClearBanner=setTimeout((()=>{this.props.clearBannerEvent()}),3e5))}shouldComponentUpdate(e,t){return this.state.items!==t.items||this.state.scrollToOffset!==t.scrollToOffset||this.state.loadState!==t.loadState}componentDidMount(){this.props.dispatch&&this.props.dispatch({type:p.TodoActions.DID_OPEN_TODO_TAB})}componentDidUpdate(){}componentWillUnmount(){wn.i.removeGCCallback(),wn.i.setScrollListPosition(null)}componentWillReceiveProps(e){this.onLoadData(e.data)}onLoadData(e){e?e.length<=0?this.setState({loadState:h.DEFAULT_LOAD_STATE.EMPTY,items:[]}):this.setState({loadState:h.DEFAULT_LOAD_STATE.RESULT,items:e}):this.setState({loadState:h.DEFAULT_LOAD_STATE.ERROR,items:[]})}onResizer({width:e,height:t}){this.clientHeight=t}handleVirtualizedScroll(e){e&&null!=e.scrollTop&&this.customScrollBar&&this.customScrollBar.scrollTop(e.scrollTop),this.action&&this.action.onClose()}getView(e,t){if(!this.state.items||this.state.items.length<=0||e<-1||e>this.state.items.length)return null;let s=this.state.items[e];if(!s)return null;let a=s.data;switch(s.type){case wn.c.TITLE:return this.itemHeight[a.id]=41,o.a.createElement("div",{className:"todo-section",key:`todo-title_${a.id}`,style:{border:"none"}},o.a.createElement(E.a,{textKey:a.textKey}));case wn.c.ITEM:return o.a.createElement(Bn.a,{bounds:!0,onResize:e=>{if(a){if(this.itemHeight[a.id]===e.bounds.height)return;this.itemHeight[a.id]=e.bounds.height}this.forceUpdateList()}},(({measureRef:t})=>o.a.createElement("div",{ref:t,className:"rel",key:`todo-item-${a.id}-${a.updateTime}-${a.status}`},o.a.createElement(Fn,{data:a,onDidUpdateSize:this._onDidUpdateItemHeight.bind(this),dispatch:this.props.dispatch,user:this.props.user,confirm:this.props.confirm,onItemClick:this.onItemClick.bind(this),onJumpMsg:this.onItemJump.bind(this),index:e,onShowAction:this.showTodoAction.bind(this),onShowDetail:this.onShowTodoDetail.bind(this),groupList:this.props.groupList,openStatsByUser:this.openStatsByUser,ref:e=>{this.itemRef||(this.itemRef={}),this.itemRef[a.id]=e},onShowComment:(e,t)=>this.onShowComment(e,t)}))))}return null}handleCustomScroll(e){if(e){const{target:t}=e;if(!(t instanceof HTMLDivElement))return;this.setState({scrollToOffset:t.scrollTop})}}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}_getItemHeight(e,t,s){if(s===wn.c.TITLE)return 41;let a=this.itemHeight[t];return a||(!this.state.items||e>=this.state.items.length||e<0||void 0===e?0:155)}_onDidUpdateItemHeight(e,t){!t||this.itemHeight[e]&&this.itemHeight[e]===t||(this.itemHeight[e]=t,this.forceUpdateList())}getLoadingUI(){return o.a.createElement("div",{className:"flx w100 h100"},o.a.createElement("i",{className:"fa fa-circle-o-notch fa-spin spinner",style:{fontSize:"26px",color:"var(--blue-300)",margin:"auto"}}))}getEmptySearchUI(){return o.a.createElement("div",{className:"todo-search-empty"},o.a.createElement("img",{src:Ve.a,style:{width:"160px"}}),o.a.createElement(E.a,{textKey:"STR_NOT_FOUND"}))}getEmptyUI(){return o.a.createElement("div",{className:"td-empty-container"},o.a.createElement("i",{className:"fa fa-icn-todo-selected",style:{color:"var(--grey-600)",fontSize:"72px",marginBottom:"12px",marginTop:"20px"}}),o.a.createElement(E.a,{textKey:"STR_TODO_LIST_EMPTY",tagName:"div",style:{fontSize:"12px",color:"var(--neutral-600)"}}))}onCreateTodoFromEmptyScreen(){this.props.onCreateRawTodo&&this.props.onCreateRawTodo(),I.e.logAction(1710115)}getErrorUI(){return o.a.createElement("div",{className:"td-empty-container"},o.a.createElement("img",{src:ni.a,style:{width:"159px",height:"120px",margin:"20px auto"}}),o.a.createElement("div",{onClick:this.onRetry.bind(this),className:"todo-retry-button"},o.a.createElement("i",{className:"fa fa-icn-todo-csc-reopen"}),o.a.createElement(E.a,{textKey:"STR_RETRY"})))}onItemClick(e,t,s=!0,n=!0){let i=this.state.items;if(!i||i.length<=t||t<0)return;if(void 0!==this.lastIndex&&null!==this.lastIndex){let e=i[this.lastIndex];e&&(e.data=Object(a.a)(Object(a.a)({},e.data),{},{isExpand:!1}),i[this.lastIndex]=e)}this.lastIndex=t;let o=i[t];if(o&&o.type===wn.c.ITEM){let r=o.data;r.id===e.id&&(this.currentData=e,!0===n&&(o.data=Object(a.a)(Object(a.a)({},r),{},{isExpand:!0}),i[t]=o),!0===s&&this.onJumpMsg(),this.setState({items:[...i]}))}}onItemJump(e,t){this.onItemClick(e,t)}clearUnreadForTab(e){wn.i.clearNewItemByCate(e,(()=>{this.props.dispatch&&this.props.dispatch({type:p.TodoActions.CLEAR_TODO_UNREAD})}))}onScrollToTodo(e,t=!0){if(this.mainList&&this.state.items)for(let s=0;s<this.state.items.length;s++){let a=this.state.items[s];if(a){let n=a.data;if(n.id===e){let a=this.mainList.getOffsetForRow({index:s,alignment:"start"});if(this.mainList.scrollToPosition(a),!0===t){if(this.itemRef){let t=this.itemRef[e];t&&setTimeout((()=>{t.onClearUnread()}),100)}this.onItemClick(n,s,!1,!0)}requestAnimationFrame((()=>{let e=this.mainList.getOffsetForRow({index:s,alignment:"start"});e!==a&&this.mainList.scrollToPosition(e)}));break}}}}showTodoAction(e,t){this.currentData=t,this.action&&(this.action.setData(t),this.action.showAction(e))}onShowTodoDetail(e=null){let t=e||this.currentData;t&&H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_EDITOR,params:Object(a.a)(Object(a.a)({},t),{},{isEdit:!0})})}onJumpMsg(e=null){let t=e||this.currentData,s=wn.i.getToUid(t,this.props.user.userId);kn.a.todoJumpMsg(t,this.props.user.userId,this.props.dispatch).then((e=>{let t={name:"message",userId:s};N.a.setOldTab(t)}))}onDeleteTodo(e=null){let t=e||this.currentData;t&&kn.a.deleteTodo(t,this.props.confirm,this.props.dispatch)}onRetry(){wn.i.resetConfigTodoList(),this.onLoadData(this.props.data)}onShowComment(e,t){this.commentsDOM&&this.commentsDOM.showAction(e)}openStatsByUser(e,t){this.props.openStatsByUser&&this.props.openStatsByUser(e,t),wn.i.setScrollListPosition(this.state.scrollToOffset)}render(){let e=this.state.items?this.state.items.length:0;this.fullHeight=0;for(let s=0;s<e;s++){let e=this.state.items[s];e&&e.data&&(this.fullHeight+=this._getItemHeight(s,e.data.id,e.type))}let t=null;if(e<=0)switch(this.state.loadState){case h.DEFAULT_LOAD_STATE.LOADING:t=this.getLoadingUI();break;case h.DEFAULT_LOAD_STATE.ERROR:t=this.getErrorUI();break;case h.DEFAULT_LOAD_STATE.EMPTY:default:t=this.getEmptyUI()}else t=o.a.createElement(Ns.a,{onResize:this.onResizer.bind(this)},(({width:t,height:s})=>o.a.createElement("div",{style:{height:`${s}px`,width:`${t}px`,position:"relative",overflowX:"hidden",outline:"none"}},o.a.createElement(Ns.d,{id:"react-v-list",ref:e=>this.mainList=e,style:{zIndex:"1",position:"absolute",willChange:"auto"},width:t,height:s,columnWidth:0,rowCount:e,rowHeight:e=>{if(!e)return 0;let t=this.state.items[e.index];if(!t)return 0;let s=t.data,a=t.type,n=s.id;return this._getItemHeight(e.index,n,a)},overscanRowCount:5,onScroll:this.handleVirtualizedScroll.bind(this),scrollTop:this.state.scrollToOffset,rowRenderer:({index:e,style:t})=>{if(!this.state.items)return null;let s=this.state.items[e];if(!s||!s.data)return null;let a=s.data.id;return o.a.createElement("div",{key:`${e}_${a}`,style:t},this.getView(e,t))}}),te.a.getScrollBar({height:s},(e=>this.customScrollBar=e),this.handleCustomScroll.bind(this),this.fullHeight))));return o.a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},o.a.createElement("div",{className:"todo-content-list ",ref:e=>this.listContainer=e},t),o.a.createElement(jn,{ref:e=>this.action=e,data:null,user:this.props.user,onShowTodoDetail:this.onShowTodoDetail.bind(this),onDeleteTodo:this.onDeleteTodo.bind(this),onJumpMsg:this.onJumpMsg.bind(this),dispatch:this.props.dispatch}))}}var bi=Ni;class Ci extends o.a.Component{constructor(e){super(e),this.state={items:[]},this.cacheList=null,this.eventHandler=(e,t)=>{switch(e){case p.TodoActions.UPDATE_TODO:if(t&&this.cacheList&&this.cacheList.length>0){let e=t.id;for(let s=0;s<this.cacheList.length;s++){let a=this.cacheList[s];a&&a.id===e&&(a=t,this.cacheList[s]=a)}this.setState({items:this.__processList(this.cacheList)})}break;case p.TodoActions.REMOVE_TODO:if(this.cacheList){for(let e=0;e<this.cacheList.length;e++){let s=this.cacheList[e];s&&s.id===t&&(this.cacheList.splice(e,1),e--)}this.setState({items:this.__processList(this.cacheList)})}}},v.default.subscribe(this.eventHandler)}shouldComponentUpdate(e,t){return this.state.items!==t.items||this.props.group!==e.group}componentDidMount(){this.onLoadData(this.props.group)}componentWillUnmount(){v.default.unsubscribe(this.eventHandler)}onLoadData(e){e&&wn.i.getConversationTodos(g.default.getRawGroupId(e.userId),!0).then((e=>{e&&e.todos?(this.cacheList=[...e.todos].filter((e=>e.status<wn.g.DONE)),e.todos.length>0?this.setState({items:this.__processList(this.cacheList)}):this.setState({items:[]})):this.setState({items:void 0})})).catch((e=>{this.setState({items:void 0})}))}__processList(e){if(!e)return[];let t=[],s=[],a=[],n=[];for(let i=0;i<e.length;i++){let t=e[i];if(t){let e=t.dueDate,i=Date.now();if(e<i&&e>0){n.push(t);continue}if(e-i<1728e5&&e>0){a.push(t);continue}let o=t.creator,r=wn.i.getMinStatus(t);if(o===this.props.user.userId&&r===wn.g.WAITING_FOR_RESPONSE){s.push(t);continue}}}return n.length>0&&(t.push({data:{textKey:"STR_TODO_NOT_DONE_TASKS",id:3},type:wn.c.TITLE}),t.push(...n.map((e=>({data:e,type:wn.c.ITEM}))))),a.length>0&&(t.push({data:{textKey:"STR_TODO_READY_TO_FINISH_TASKS",id:2},type:wn.c.TITLE}),t.push(...a.map((e=>({data:e,type:wn.c.ITEM}))))),s.length>0&&(t.push({data:{textKey:"STR_TODO_UNCONFIRMED_TASKS",id:1},type:wn.c.TITLE}),t.push(...s.map((e=>({data:e,type:wn.c.ITEM}))))),t}render(){return o.a.createElement("div",{style:{flex:1,display:"flex",flexDirection:"column"}},o.a.createElement("div",{className:"todo-week-summary-title",style:{borderTop:"1px solid var(--grey-300)",display:"block",position:"relative"}},o.a.createElement(E.a,{textKey:"STR_TODO_STATUS"}),o.a.createElement("i",{className:"fa fa-close close-icon",onClick:this.props.onClose})),o.a.createElement(bi,{data:this.state.items,user:this.props.user,confirm:this.props.confirm,dispatch:this.props.dispatch}))}}var Ai=Ci;class yi extends o.a.Component{constructor(e){super(e),this.state={showFilter:!1,showStatistic:!1,showSummary:!!wn.i.getSummaryTodoInitInfo(),eventRemind:wt.f.getTodoEventRemind(this.props.user.userId),showRemindFilter:!1,showIconSearch:!1,remindSummary:wn.i.getRemindSummary()},this.todoStatsParam=null,this.preStateStats=!0,this.openStatsByUser=this.openStatsByUser.bind(this),this.showList=this.showList.bind(this),this.eventHandler=(e,t)=>{switch(e){case p.TodoActions.TODO_REMIND:t&&this.setState({eventRemind:t,remindSummary:null});break;case p.GeneralActions.LEFTPANEL_RESIZE:if(t&&t.payload){let e=t.payload;this.checkSize(e)}}}}componentWillMount(){v.default.subscribe(this.eventHandler)}componentWillUnmount(){v.default.unsubscribe(this.eventHandler)}componentDidMount(){let e=te.a.getLeftPannelWidth();this.checkSize(e)}shouldComponentUpdate(e,t){return this.state.showFilter!==t.showFilter||this.state.showStatistic!==t.showStatistic||this.state.showSummary!==t.showSummary||this.state.eventRemind!==t.eventRemind||this.state.showRemindFilter!==t.showRemindFilter||this.state.showIconSearch!==t.showIconSearch||this.state.remindSummary!==t.remindSummary}checkSize(e){this.betaDOM&&(this.betaDOM.style.display=e<350?"none":"block")}onToggleFilter(e){(this.state.showSummary||this.state.showRemindFilter)&&wt.f.setTodoEventRemind(this.props.user.userId,null),this.setState({showFilter:!!e,showIconSearch:!!e,showSummary:!1,showStatistic:!1,eventRemind:null,showRemindFilter:!1,remindSummary:null})}showStat(){(this.state.showSummary||this.state.showRemindFilter)&&wt.f.setTodoEventRemind(this.props.user.userId,null),this.state.showIconSearch&&this.todoStats&&this.todoStats.cancelShowDetail(),this.state.showSummary?this.setState({showSummary:!1,showFilter:!1,showIconSearch:!1,eventRemind:null,showRemindFilter:!1,remindSummary:null}):(this.state.showSummary||I.e.logAction(17106),this.setState({showStatistic:!!this.preStateStats||!this.state.showStatistic,showSummary:!1,showFilter:!1,showIconSearch:!1,eventRemind:null,showRemindFilter:!1,remindSummary:null}))}showTodoSumaryV2(e){this._refTodoSummary?this._refTodoSummary.checkOpenDetailForBannerTodov2():this.setState({showStatistic:!0,showFilter:!1,showIconSearch:!1,remindSummary:null})}showRemindSummary(e){this.setState({remindSummary:e})}onCheckOpenTab(){return this.todoList?this.todoList.onCheckOpenTab():null}onCheckOpenRemindTab(e){return e&&"weekSummary"==e.eType?(this.isOpenFromEvent=!0,this.setState({showSummary:!0,remindSummary:null})):e&&e.eType&&e.num&&this.setState({showRemindFilter:!0,eventRemind:e,remindSummary:null}),null}onCreateTodoWithoutMsg(e,t=!1){if(this.props.dispatch){const e=e=>{if(e){let t=e.assignees;if(t&&t.length>0){let s="";if(t.length>=1){let e=t[0];if(e){let t=e.id||e.uid||e.userId;s+=k.default.getDName(t)}}if(t.length>1){let e=t.length-1;s+=" "+T.default.str("STR_AND")+" ",s+=1===e?T.default.str("STR_A_OTHER_PERSON"):T.default.trans("STR_X_OTHER_PEOPLE",e)}R.a.createInfo(T.default.trans("STR_TODO_HINT_2",s));let a=e.id;wn.i.setViewTodoIdCache(a),this.onCheckOpenTab()}}};let s,n={creator:this.props.user.userId,content:"",dueDate:-1,assignees:[],dateDefaultType:wn.e.NO_DATE,description:"",watchers:"[]",status:wn.g.WAITING_FOR_RESPONSE,onSuccess:e};s=!0===t?wn.a.EMPTY_SCR:wn.a.GLB_LIST_ICON,wn.i.setCreateTodoSrc(s),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.TODO_EDITOR,params:Object(a.a)({},n)}),!0===t?I.e.logAction(1710113):I.e.logAction(17104)}}closeTodoRemindTab(){wt.f.setTodoEventRemind(this.props.user.userId,null),this.setState({eventRemind:null,showRemindFilter:!1})}closeWeekSummaryTab(){wt.f.setTodoEventRemind(this.props.user.userId,null),this.setState({eventRemind:null,showSummary:!1,showStatistic:!1,remindSummary:null}),I.e.logAction(1710601)}onOpenWeekSummaryTab(){this.setState({showSummary:!0,showFilter:!1,showIconSearch:!1,showStatistic:!1,eventRemind:!1,showRemindFilter:!1,remindSummary:null})}openStatsByUser(e,t){let s={showAll:!0,role:t};if(t===h.TODO_ROLE.ASSIGNEE)s.assignee=e,s.assigner=this.props.user.userId;else{if(t!==h.TODO_ROLE.ASSIGNER)return;s.assigner=e,s.assignee=this.props.user.userId}this.todoStats?this.todoStats.onClickShowDetail(s):(this.todoStatsParam=s,this.preStateStats=!1,this.setState({showStatistic:!0,showIconSearch:!0,remindSummary:null}))}clearTodoStatsParam(){this.todoStatsParam=null}backTodoStatistic(){(this.state.showSummary||this.state.showRemindFilter)&&wt.f.setTodoEventRemind(this.props.user.userId,null),this.setState({eventRemind:null,showSummary:!1,showFilter:!1,showIconSearch:!1,showStatistic:!0,remindSummary:null})}onShowIconSearch(e){e||(this.preStateStats=!1),e!==this.state.showIconSearch&&this.setState({showIconSearch:e,remindSummary:null})}onOpenSupportPage(){let e=O.default.getTaskSetting();if(e&&e.support_page>0&&e.support_page.length>0){let t=e.support_page;if(t){const e=e=>{this.props.dispatch({type:p.ConversationListActions.SELECT_CONVERSATION,payload:e})};O.default.getConversation(t).then((s=>{if(s)return e(s);k.default.getProfileFriendById(t).then((t=>{t&&e(t)}))})).catch((e=>{g.default.logCoreError(e)}))}}}showList(){this.setState({showSummary:!1,showFilter:!1,showIconSearch:!1,showStatistic:!1,eventRemind:!1,showRemindFilter:!1,remindSummary:null})}onClickBeta(){Ct.b.open(`https://media.${c.c.CONFIG_DOMAIN}/detail/4290414774003551493?id=b69623562a13c34d9a02&pageId=4290414774003551493`)}onCloseRemindSummary(){this.showList()}render(){let e=null;e=this.state.remindSummary?o.a.createElement(Ai,{group:this.state.remindSummary,user:this.props.user,confirm:this.props.confirm,dispatch:this.props.dispatch,onClose:this.onCloseRemindSummary.bind(this)}):this.state.showSummary||this.state.showStatistic?o.a.createElement(Ri,{user:this.props.user,dispatch:this.props.dispatch,groupList:this.props.groupList,tabIndex:1,closeWeekSummaryTab:this.closeWeekSummaryTab.bind(this),ref:e=>this._refTodoSummary=e,confirm:this.props.confirm,onShowIconSearch:this.onShowIconSearch.bind(this)}):this.state.showRemindFilter&&this.state.eventRemind?o.a.createElement(Oi,{user:this.props.user,dispatch:this.props.dispatch,groupList:this.props.groupList,showRemindFilter:this.state.showRemindFilter,eventRemind:this.state.eventRemind,closeTodoRemindTab:this.closeTodoRemindTab.bind(this),confirm:this.props.confirm}):o.a.createElement(oi,{user:this.props.user,dispatch:this.props.dispatch,confirm:this.props.confirm,ref:e=>this.todoList=e,groupList:this.props.groupList,showFilter:this.state.showFilter,showRemindFilter:this.state.showRemindFilter,closeTodoRemindTab:this.closeTodoRemindTab.bind(this),eventRemind:this.state.eventRemind,onCheckOpenRemindTab:this.onCheckOpenRemindTab.bind(this),onToggleFilter:this.onToggleFilter.bind(this),onCreateRawTodo:this.onCreateTodoWithoutMsg.bind(this),openStatsByUser:this.openStatsByUser,clearBannerEvent:()=>{this.setState({eventRemind:null,remindSummary:null})}});let t=this.state.showStatistic||this.state.showSummary||this.state.showFilter,s=O.default.getTaskSetting(),a=!1;return s&&s.support_page>0&&s.support_page.length>0&&(a=!0),o.a.createElement("div",{className:"todo-view"},o.a.createElement("div",{className:"todo-header-container "+(t?" extra-border":"")},o.a.createElement("div",{className:"flx td-gl-title"},o.a.createElement(E.a,{textKey:"STR_TODO",tagName:"div",style:{padding:"0px 3px 0 14px",fontSize:"20px",color:"var(--neutral-300)",cursor:"pointer"},onClick:this.showList.bind(this)}),s&&1===s.beta?o.a.createElement("div",{style:{position:"relative",top:"2px",color:"var(--blue-300)",fontWeight:600,marginRight:"3px",fontSize:"10px",cursor:"pointer"},onClick:this.onClickBeta.bind(this),ref:e=>this.betaDOM=e},"BETA"):null,wn.i.isEnableEntryPoint(wn.h.CREATE_TASK)?o.a.createElement(f.a,{className:"fa fa-create-todo create-todo-icon",onClick:this.onCreateTodoWithoutMsg.bind(this),tagName:"i",textKey:"STR_CREATE_TODO","data-id":"div_TabToDo_NewTask"}):null),o.a.createElement("div",{className:"flex-box-space"}),!0===a?o.a.createElement(f.a,{tagName:"i",textKey:"STR_TODO_SUPPORT_TOOLTIP",className:"fa fa-icon-feedback td-g-ico",onClick:this.onOpenSupportPage.bind(this),style:{fontSize:"17px",padding:"10px 14px",zIndex:1}}):null,o.a.createElement(f.a,{tagName:"i",textKey:"STR_SEARCH",className:"fa fa-todo-search todo-filter-icon-main "+(this.state.showFilter||this.state.showIconSearch?" selected-icon ":""),onClick:this.onToggleFilter.bind(this,!this.state.showFilter),style:{fontSize:"17px"}}),o.a.createElement(f.a,{tagName:"i",textKey:"STR_STATS",className:"fa fa-tongket-icon"+(!this.state.showStatistic&&!this.state.showSummary||this.state.showIconSearch?"":" selected-icon "),onClick:()=>{this.state.showIconSearch&&(this.preStateStats=!0),this.showStat()},style:{fontSize:"17px"}})),e)}}var Di=yi,Mi=s("ettF"),Pi=(s("JprO"),s("J0iE"));const wi=e=>e.key?o.a.createElement(E.a,{textKey:e.key,style:e.style}):o.a.createElement("span",{style:e.style},e.text);class Li extends i.Component{render(){return o.a.createElement("div",{className:"progress-bar",style:this.props.style},this.props.text&&this.props.text.left?o.a.createElement(wi,this.props.text):null,o.a.createElement("div",{className:"progress-track progress-track-white",style:{margin:"3px 0 0 0"}},o.a.createElement("span",{style:{width:this.props.progress+"%"},className:"progress-fill"})),this.props.text&&!this.props.text.left?o.a.createElement(wi,this.props.text):null)}}class ki extends i.Component{constructor(e){super(e),this._startSync=this._startSync.bind(this),this._retrySyncMobileNotForce=this._retrySyncMobile.bind(this,!1),this._retrySyncMobileForce=this._retrySyncMobile.bind(this,!0),this._showConfirmModal=this._showConfirmModal.bind(this),this._cancelSyncDB=this._cancelSyncDB.bind(this),this._hideNotify=this._hideNotify.bind(this),this._togglePopupPassword=this._togglePopupPassword.bind(this),this.state=this._getStateFromSyncState(e.syncState.state||h.SYNC_DB_STATE.DONTSYNC,e.syncState.info),this.syncSetting=Mi.default.getSyncDBSetting(),Q.default.listenEvent(Q.SYNC_DB_STATE_CHANGE,this._onSyncDBStateChange.bind(this)),Q.default.listenEvent(Q.SYNC_DB_SETTING_CHANGE,this._onSyncDBSettingChange.bind(this))}componentWillUnmount(){this.ipc&&this.ipc.removeListener(Mi.DOWNLOAD.UPDATE_CHANNEL,this._onProgressDownloadChange),Q.default.removeListenEvent(Q.SYNC_DB_STATE_CHANGE,this._onSyncDBStateChange),Q.default.removeListenEvent(Q.SYNC_DB_SETTING_CHANGE,this._onSyncDBSettingChange)}_onProgressDownloadChange(e){if(!e)return void 0;const{progress:t,progressChannelId:s}=e;this._currentDbChecksum?this._currentDbChecksum==s&&this.setState({progress:t}):this.setState({progress:void 0})}_onSyncDBSettingChange(e){console.log("cross::setting",e),e&&e.constructor===Object&&(this.syncSetting=Object(a.a)(Object(a.a)({},this.syncSetting),e),this.state&&this.state.canHideNotify&&this.setState((e=>(e.hideNotify=e.canHideNotify&&this.syncSetting&&this.syncSetting.hideProgress||!1,e))))}_getStateFromSyncState(e,t){let s,a,n="",i="",r=!1,l=null,d=null,u=null,_=!1,m=this.syncSetting&&this.syncSetting.hideProgress||!1,p=!0,g=null,f="",T=!1;switch(e){case h.SYNC_DB_STATE.ERR:{g=t.err;const e=Mi.default.getErrorMessage(g);if(l="fa-sync-failed",f="error",g===h.SYNC_DB_STATE.ERR_CODE.ERR_CLIENT_NOT_SUPPORT){m=!1,n=[o.a.createElement(E.a,{key:"title",tagName:"div",textKey:e.title,className:"sync-title dismiss-title"}),o.a.createElement("div",{className:"other-line",key:"otherline"},o.a.createElement(E.a,{textKey:e.content})," ",o.a.createElement(E.a,{textKey:"STR_SYNC_DB_MSG_USR_DETAIL_MB_BUTTON",className:"sync-db-btn-link",onClick:this._seeInstructions.bind(this,{showPopup:h.SYNC_DB_STATE.POPUPEnum.SYNC_ERR,step:h.SYNC_DB_STATE.POPUPEnum.SYNC_ERR,errorCode:g})}))],r=!1,_=!0,p=!1;break}Pi.default.removePasswordRemember(),this._currentDbChecksum=null,n=[o.a.createElement(E.a,{key:"title",tagName:"div",textKey:e.title,className:"sync-title dismiss-title"}),o.a.createElement(E.a,{key:"content",tagName:"div",textKey:e.content,className:"other-line"})],t.infoRetry&&t.infoRetry.hasOwnProperty("can_retry")&&0===t.infoRetry.can_retry||(i="STR_SYNC_DB_RETRY",u=g==h.SYNC_DB_STATE.ERR_CODE.ERR_TIMEOUT||g==h.SYNC_DB_STATE.ERR_CODE.ERR_NO_PERMISSION?this._retrySyncMobileForce:this._retrySyncMobileNotForce),r=!1,_=!0,m=!1;break}case h.SYNC_DB_STATE.START:t&&!t.showPopup&&Mi.default.isEnableBySrc()&&(I.e.logAction(2090201),c.c.cross_setting.useTheme?I.e.logAction(2091301):I.e.logAction(2091201),c.c.cross_setting.useTheme?I.e.logAction(2091308):I.e.logAction(2091208),I.e.logAction(2090208)),this._currentDbChecksum=null,l="fa-sync-phonedb",r=!1,i="STR_SYNC_DB_CONFIRM",m=!1,u=this._startSync,n=[o.a.createElement(E.a,{key:"STR_SYNC_DB_MSG_START_LINE_1",tagName:"div",textKey:"STR_SYNC_DB_MSG_START_LINE_1",className:"sync-title dismiss-title"}),o.a.createElement(E.a,{key:"STR_SYNC_DB_MSG_START_LINE_2",tagName:"div",textKey:"STR_SYNC_DB_MSG_START_LINE_2",className:"other-line"})],_=!0;break;case h.SYNC_DB_STATE.USR_CONFIRMED_PC:this._currentDbChecksum=null,_=!1,this.state?(l=this.state.icon,r=this.state.showSpinner,i=this.state.textButton,m=!1,u=function(){},n=this.state.textNotify,T=!0,f=this.state.customClassname):m=!0;break;case h.SYNC_DB_STATE.WAIT_FOR_DB:this._currentDbChecksum=null,l="fa-sync-phonedb",n=o.a.createElement(E.a,{tagName:"div",textKey:"STR_SYNC_DB_MSG_WAIT_FOR_DB"}),r=!1,i="",_=!0,m=!1,u=this._hideNotify;break;case h.SYNC_DB_STATE.USR_CONFIRMED_MB:this._currentDbChecksum=null,m=!1,l="fa-sync-phonedb",n=o.a.createElement("div",{className:"other-line"},o.a.createElement(E.a,{textKey:"STR_SYNC_DB_MSG_USR_CONFIRM_MB_LINE_1"}),o.a.createElement(E.a,{textKey:"STR_SYNC_DB_MSG_USR_CONFIRM_MB_LINE_2",className:"bold-text"})," ",o.a.createElement(E.a,{textKey:"STR_SYNC_DB_MSG_USR_CONFIRM_MB_BUTTON",className:"sync-db-btn-link",onClick:this._seeInstructions.bind(this,void 0)})),r=!1,_=!0,p=!1,m=!1;break;case h.SYNC_DB_STATE.DL:l="fa-sync-download-1",d="fa-sync-download-2",n=o.a.createElement(E.a,{tagName:"div",textKey:"STR_SYNC_DB_MSG_USR_DL"}),r=!1,i="",_=!0,t&&t.checksum&&(this._currentDbChecksum=t.checksum),f="downloading";break;case h.SYNC_DB_STATE.PASSWORD:this._currentDbChecksum=null,s=void 0,l="fa-sync-download-success",n=o.a.createElement(E.a,{tagName:"div",textKey:"STR_CONFIRM_SYNC_MSG_STEP_PW"}),r=!1,i="STR_SYNC_DB_MSG_PW_BTN",u=()=>this._togglePopupPassword(t),_=!0;break;case h.SYNC_DB_STATE.MERGE:this._currentDbChecksum=null,s=.5,l="fa-sync-icon",n=o.a.createElement(E.a,{tagName:"div",textKey:"STR_SYNC_DB_MSG_USR_MERGE",className:"other-line one-line"}),r=!0,i="STR_SYNC_DB_MSG_HIDE_NOTIFY",u=this._hideNotify,_=!0;break;case h.SYNC_DB_STATE.MERGING:this._currentDbChecksum=null,s=t.progress<1?.5:t.progress,l="fa-sync-icon",n=o.a.createElement(E.a,{tagName:"div",textKey:"STR_SYNC_DB_MSG_USR_MERGE",className:"other-line one-line"}),r=!0,i="STR_SYNC_DB_MSG_HIDE_NOTIFY",u=this._hideNotify,_=!0;break;case h.SYNC_DB_STATE.DONE:this._currentDbChecksum=null,m=!1,l="fa-sync-done",n=t&&t.numConv?[o.a.createElement(E.a,{key:"STR_SYNC_DB_MSG_USR_DONE",tagName:"div",textKey:"STR_SYNC_DB_MSG_USR_DONE",className:"sync-title dismiss-title"}),o.a.createElement(E.a,{key:"STR_UPDATE_CONVERSATION",tagName:"div",textKey:"STR_UPDATE_CONVERSATION",className:"other-line",textArguments:[t.numConv]})]:o.a.createElement(E.a,{tagName:"div",textKey:"STR_SYNC_DB_MSG_USR_DONE"}),r=!1,i="",_=!0,s=null,f="success";break;case h.SYNC_DB_STATE.RESUME:n=o.a.createElement(E.a,{tagName:"div",textKey:"STR_BANNER_INTERRUPT"}),_=!0,s=null,f="resume",i="STR_SYNC_DB_RETRY",u=this._resumeMerge,l="fa-sync-interrupt",a=this._abortResume;break;default:m=!0}return{syncState:e,err_code:g,textNotify:n,showSpinner:r,textButton:i,btnCb:u,btnStyle:null,icon:l,icon2:d,progress:s,canCancel:_,hideNotify:m,canHideNotify:p,info:t,countDown:null,customClassname:f,closeBtnCb:a,disabled:T}}_onSyncDBStateChange(e,t){const s=this._getStateFromSyncState(e,t);this.setState(s)}_startSync(){I.e.logAction(2090202),c.c.cross_setting.useTheme?I.e.logAction(2091302):I.e.logAction(2091202),Mi.default.triggerConfirmedPC({forceGetDB:!1},!0)}_seeInstructions(e){e||(I.e.logAction(2090702),e={showPopup:h.SYNC_DB_STATE.POPUPEnum.MOBILEGUIDE}),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.SYNC_DB,params:e})}_retryForMobile(){Mi.default.triggerConfirmedPC({forceGetDB:!0,is_retry:!0},!0)}_retrySyncMobile(e=!1){this.state.syncState===h.SYNC_DB_STATE.ERR&&(I.e.logAction(2090401),this.state.err_code===h.SYNC_DB_STATE.ERR_CODE.ERR_TIMEOUT&&I.e.logAction(2090902)),Mi.default.setSrcSync(Mi.START_DB_SRC.RETRY);const t=this.state.info||{};t.retryState===h.SYNC_DB_STATE.USR_CONFIRMED_MB&&(t.infoRetry?t.infoRetry.forceGetDb=e:t.infoRetry={forceGetDb:e}),g.default.logCoreError(`sync db retry ${t.retryState}`,t.infoRetry),Q.default.setSyncState(t.retryState||h.SYNC_DB_STATE.USR_CONFIRMED_MB,t.infoRetry,!0)}_togglePopupPassword(e){H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.PW_BACKUP,params:{syncInfo:e,isShow:!0}})}_cancelSyncDB(e,t,s){this.state.syncState===h.SYNC_DB_STATE.START||this.state.syncState===h.SYNC_DB_STATE.USR_CONFIRMED_MB?t?I.e.logAction(2090303):I.e.logAction(2090302):this.state.syncState===h.SYNC_DB_STATE.WAIT_FOR_DB?t?I.e.logAction(2090307):I.e.logAction(2090306):this.state.syncState!==h.SYNC_DB_STATE.MERGE&&this.state.syncState!==h.SYNC_DB_STATE.MERGING||(t?I.e.logAction(2090310):I.e.logAction(2090309)),t?(s&&s.hasOwnProperty("dontShowBanner")&&(s.dontShowBanner?(I.e.logAction(2090205),c.c.cross_setting.useTheme?I.e.logAction(2091305):I.e.logAction(2091205)):(I.e.logAction(2090204),c.c.cross_setting.useTheme?I.e.logAction(2091304):I.e.logAction(2091204)),Mi.default.setSyncDBSetting({dontShowBanner:s.dontShowBanner})),e&&this._showManualGuide("STR_SETTING_MSG_SYNC_NOTICE_BODY"),Q.default.setSyncState(h.SYNC_DB_STATE.ABORT,null,!0)):s&&s.hasOwnProperty("dontShowBanner")&&(I.e.logAction(2090206),c.c.cross_setting.useTheme?I.e.logAction(2091306):I.e.logAction(2091206))}_showConfirmModal(){if(I.e.logAction(2090301),this.state.syncState===h.SYNC_DB_STATE.START?(c.c.cross_setting.useTheme?I.e.logAction(2091303):I.e.logAction(2091203),I.e.logAction(2090203)):this.state.syncState===h.SYNC_DB_STATE.USR_CONFIRMED_MB?(I.e.logAction(2090701),I.e.logAction(2090304)):this.state.syncState===h.SYNC_DB_STATE.WAIT_FOR_DB?I.e.logAction(2090305):this.state.syncState===h.SYNC_DB_STATE.MERGE||this.state.syncState===h.SYNC_DB_STATE.MERGING?I.e.logAction(2090308):this.state.syncState===h.SYNC_DB_STATE.ERR&&(I.e.logAction(2090402),this.state.err_code===h.SYNC_DB_STATE.ERR_CODE.ERR_TIMEOUT&&I.e.logAction(2090901)),this.state.syncState===h.SYNC_DB_STATE.DONE||this.state.syncState===h.SYNC_DB_STATE.ERR||this.state.syncState===h.SYNC_DB_STATE.RESUME)return void Q.default.setSyncState(h.SYNC_DB_STATE.DONT_SYNC);const e=this.state.syncState===h.SYNC_DB_STATE.START?"_START":"";let t=!1;if(e){t=Mi.default.getSyncDBSetting().dontShowBanner}const s=e?{key:"dontShowBanner",title:"STR_SETTING_MSG_SYNC_POPUP_DONTSHOW",default_val:t}:{key:"dontask",title:"STR_SETTING_MSG_SYNC_POPUP_DONTASK"};this.props.dispatch({type:p.PopupActions.TOGGLE_CONFIRM,payload:{headerText:T.default.trans("STR_SETTING_MSG_SYNC_POPUP_HEADER"+e),callback:this._cancelSyncDB.bind(this,e),buttons:{confirm:T.default.trans("STR_SETTING_MSG_SYNC_POPUP_OK"+e),cancel:T.default.trans("STR_SETTING_MSG_SYNC_POPUP_CANCEL"+e),type:e?"primary":"secondary-red"},message:T.default.trans("STR_SETTING_MSG_SYNC_POPUP_BODY"+e),usePrimaryForConfirm:!1,customButton:()=>{},customButtonClass:"flx-sp-around",width:450,options:e?[s]:void 0}})}_hideNotify(){this.syncSetting=Object(a.a)(Object(a.a)({},this.syncSetting),{},{hideProgress:!0}),Mi.default.setSyncDBSetting({hideProgress:!0}),this.setState({hideNotify:!0}),this._showManualGuide("STR_HIDE_DB_TOAST")}_resumeMerge(){Mi.default.resumeMerge()}_abortResume(){Mi.default.triggerDontSync()}_showManualGuide(e){this.props.dispatch({type:p.PopupActions.TOGGLE_CONFIRM,payload:{headerText:T.default.trans("STR_SETTING_MSG_SYNC_NOTICE_HEADER"),width:353,buttons:{confirm:T.default.trans("STR_SETTING_MSG_SYNC_NOTICE_OK"),type:"tertiary"},message:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:e,tagName:"div"}),o.a.createElement("i",{className:"fa fa-tab-setting internal-icon"}),o.a.createElement(E.a,{textKey:"STR_SETTING_MSG_SYNC_NOTICE_BODY_BOLD",style:{fontWeight:600}}))}})}render(){if(!Mi.default.isEnableBySrc())return null;if(this.props.syncState.showPopup||!this.state.syncState||this.state.hideNotify&&(this.state.syncState===h.SYNC_DB_STATE.MERGING||this.state.syncState===h.SYNC_DB_STATE.MERGE||this.state.syncState===h.SYNC_DB_STATE.USR_CONFIRMED_PC)||this.state.syncState===h.SYNC_DB_STATE.DONT_SYNC)return null;const e="sync-db"+(c.c.cross_setting.useTheme?`__${c.c.cross_setting.useTheme}`:""),t=this.state.customClassname?" "+this.state.customClassname:"",s=`${e}-banner${t}`;return o.a.createElement("div",{className:s,style:this.props.inConversationTab?null:{display:"none"}},o.a.createElement("div",{className:`${e}-icon`},this.state.icon&&o.a.createElement("div",{className:this.state.showSpinner?"spin":""},o.a.createElement("i",{className:`fa ${this.state.icon}`})),this.state.icon2&&o.a.createElement("div",{className:"sync-slide-down "},o.a.createElement("i",{className:`fa ${this.state.icon2}`})),null!=this.state.progress?o.a.createElement("div",{className:`${e}-text-mobile`},this.state.progress,"%"):null),o.a.createElement("div",{className:`${e}-text`},this.state.textNotify,null!=this.state.progress&&o.a.createElement(Li,{progress:this.state.progress,text:this.state.progress>=3?{text:`${this.state.progress}%`,style:{color:"var(--black-300)",margin:"0 1em 0 .5em"}}:void 0})),!!this.state.textButton&&o.a.createElement(st.a,{textKey:this.state.textButton,onClick:this.state.btnCb,className:` ${e}-ok${t} ${this.state.btnStyle||""}`,size:"small",disabled:this.state.disabled,style:this.state.syncState===h.SYNC_DB_STATE.USR_CONFIRMED_PC?{cursor:"progress"}:null}),!!this.state.canCancel&&o.a.createElement("div",{className:`${e}-cancel`,onClick:this.state.closeBtnCb||this._showConfirmModal},o.a.createElement("i",{className:"fa fa-close"})))}}var xi=s("dJFb");class Ui extends o.a.Component{constructor(e){super(e),this._eventHandler=this._eventHandler.bind(this),this.state={needRefresh:!1,item:this.props.item}}componentWillMount(){v.default.subscribe(this._eventHandler)}componentWillUnmount(){v.default.unsubscribe(this._eventHandler)}_eventHandler(e,t){switch(e){case p.FetchActions.UPDATE_NAME:t&&this.props.item&&!this.props.item.order&&(t.constructor===Object&&this.props.item.userId===t.userId||t.constructor===Array&&t.includes(this.props.item.userId))&&this.setState({needRefresh:!this.state.needRefresh});break;case p.FetchActions.STATUS_BLOCKED_CHANGED:t&&this.props.item&&t.includes(this.props.item.userId)&&this.setState({needRefresh:!this.state.needRefresh});break;case p.ConversationListActions.TAG_CONV:if(t&&t.data){let e=t.data.reduce(((e,t)=>(t&&(e[t.userId]=t.label),e)),{});e&&!0===e.hasOwnProperty(this.props.item.userId)&&this.setState((t=>{let s=Object.assign({},t.item);return s.label=e[this.props.item.userId],{item:s}}))}}}getdisplayName(e){if(!e)return"";let t="",s=k.default.getMiniInfo(e.userId);return s&&(t=s.dName),0===t.length&&(t=e.displayName),t}onClickOpenConversation(e,t){t&&!isNaN(t.detail)&&t.detail>1||(g.default.preventClickThenFakeNewEvent(t),this.props.onClickOpenConversation(e,this.props.index||-1),I.e.logAction(178009))}onDoubleClickOpenConversation(e,t){g.default.preventClickThenFakeNewEvent(t),this.props.onDoubleClickOpenConversation(e),I.e.logAction(178009)}onAddFriend(e){e&&(e.stopPropagation(),e.preventDefault());let t=this.props.item;if(!t)return;let s=t.userId,a=-1;t.friendSrc?a=t.friendSrc:t.recommInfo&&t.recommInfo.source&&(a=t.recommInfo.source),S.a.doAddFriend(s,a,this.props.dispatch).then((e=>{this.onRemoveFromRequest(s)})),I.e.logAction(179104)}onAccept(e){e&&(e.stopPropagation(),e.preventDefault());let t=this.props.item;if(t){if(this.props.dispatch){let e=t.userId;this.props.dispatch({type:p.ChatBoxActions.ACCEPT_FRIEND_REQUEST,payload:e}),this.onRemoveFromRequest(e),this.onChat(e)}I.e.logAction(179101)}}onReject(e){e&&(e.stopPropagation(),e.preventDefault());let t=this.props.item;if(!t)return;let s=t.userId,a=k.default.getDName(s)||"";xi.d.setUnreadRequest(0),P.a.openConfirm({windowId:"1",name:h.MODAL_CONFIRM.confirmIdentities,params:{message:T.default.str("STR_CONFIRM_YES")+" "+a+" "+T.default.str("STR_FRIEND_DEL_REQUEST_CONFIRM"),okText:T.default.str("STR_CONFIRM_YES"),cancelText:T.default.str("STR_CONFIRM_NO"),preventPageClickForceClose:!1,onOk:()=>{this.props.dispatch({type:p.SideBarActions.REJECT_FRIENDS,payload:s}),this.onRemoveFromRequest(s)}}}),I.e.logAction(179102)}onRemoveSuggest(e){e&&(e.stopPropagation(),e.preventDefault());let t=this.props.item;t&&(P.a.openConfirm({windowId:"1",name:h.MODAL_CONFIRM.confirmIdentities,params:{message:T.default.str("STR_REMOVE_FRIEND_SUGGEST_CONTENT"),okText:T.default.str("STR_CONFIRM_YES"),cancelText:T.default.str("STR_CONFIRM_NO"),preventPageClickForceClose:!1,onOk:()=>{let e=t.userId,s=t.recommSrc||-1,a=t.recommType||-1;Bs.a.removeSuggestFriend(e,s,a).then((t=>{this.props.dispatch({type:p.ConversationListActions.FRIEND_CENTER_CHANGE,payload:{act:"update_suggestion"}}),this.onRemoveFromRequest(e)}))}}}),I.e.logAction(179105))}onRemoveFromRequest(e){Bs.a.removeSuggest(e),this.props.onUpdateListRequest&&this.props.onUpdateListRequest()}onChat(e){S.a.doSendMessage(e,this.props.dispatch)}showAction(e){this.recentSearchAction&&this.recentSearchAction.showAction(e),e.preventDefault(),e.stopPropagation()}_callbackPinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.pinned=Date.now(),{item:t}}))}_callbackUnpinMe(){this.setState((e=>{let t=Object.assign({},e.item);return t.pinned=null,{item:t}}))}_callbackMute(e){this.setState((t=>{let s=Object.assign({},t.item);return s.muted=e,{item:s}}))}_callbackUnMute(){this.setState((e=>{let t=Object.assign({},e.item);return t.muted=null,{item:t}}))}removeItem(e){e.preventDefault(),e.stopPropagation(),this.props.removeItemInList&&(this.props.removeItemInList(this.state.item),He.a.removeItemSearch(this.state.item),I.e.logAction(179007))}render(){let e=this.state.item;if(!e)return null;const t=k.default.isBlocked(e.userId);let s="conv-item conv-rel minimized rel list-friend-conctact ",a=this.getdisplayName(e);s+=this.props.highlightId===e.userId&&!0!==e.key.startsWith("fr-")?" selected":this.props.isFocused?" active":"";let n=null,i=null;return!0===e.key.startsWith("fr-")&&(2===e.recommType?(n=o.a.createElement("div",{onClick:this.onReject.bind(this),className:"zbutton zbtn-text"},o.a.createElement(E.a,{textKey:"STR_REJECT_ADD_FRIEND",className:"zbtn-content no-upper"})),i=o.a.createElement("div",{onClick:this.onAccept.bind(this),className:"zbutton"},o.a.createElement(E.a,{textKey:"STR_ACCEPT",className:"zbtn-content no-upper"}))):(n=o.a.createElement("div",{onClick:this.onRemoveSuggest.bind(this),className:"zbutton zbtn-text"},o.a.createElement(E.a,{textKey:"STR_REMOVE",className:"zbtn-content no-upper"})),i=o.a.createElement("div",{onClick:this.onAddFriend.bind(this),className:"zbutton"},o.a.createElement(E.a,{textKey:"STR_ADD_FRIEND",className:"zbtn-content no-upper"})))),o.a.createElement(y,{itemProps:{id:`recent-item-${e.userId}`,key:e.userId,onContextMenu:this.showAction.bind(this),className:s,onClick:this.onClickOpenConversation.bind(this,e),onDoubleClick:this.onDoubleClickOpenConversation.bind(this,e)},conv:e,title:a},o.a.createElement("status",null,t?o.a.createElement("div",{className:"conv-block"},o.a.createElement(D.a,{className:"profile-icon-block"})):null),o.a.createElement("convAction",null,o.a.createElement(C.a,{key:"recentSearchAct",ref:e=>this.recentSearchAction=e,state:e,dispatch:this.props.dispatch,user:this.props.user,confirm:this.props.confirm,callbackPinMe:this._callbackPinMe.bind(this,e),callbackUnpinMe:this._callbackUnpinMe.bind(this),callbackMute:this._callbackMute.bind(this),callbackUnMute:this._callbackUnMute.bind(this),showUserInfo:this.props.showUserInfo,showEditAlias:this.props.showEditAlias,presets:"Thread"})),o.a.createElement("titleMore",null,o.a.createElement("div",{className:"conv-action__menu"},o.a.createElement(D.a,{className:"icon-solid-close icon-remove-item",title:T.default.str("STR_REMOVE"),onClick:this.removeItem.bind(this)}))))}}class Fi extends o.a.Component{constructor(e){super(e),this.state={needRefresh:!1}}shouldComponentUpdate(e,t){return this.state.needRefresh!==t.needRefresh||this.props.isFocused!==e.isFocused||this.props.item!==e.item}_onClickKeyword(){if(this.props.item&&this.props.onSearchKeyword)switch(this.props.onSearchKeyword(this.props.item.data.keyword),this.props.index){case 1:I.e.logAction(179201);break;case 2:I.e.logAction(179202);break;case 3:I.e.logAction(179203);break;case 4:I.e.logAction(179204);break;case 5:I.e.logAction(179205)}}render(){let e=this.props.item;return o.a.createElement("div",{key:e.key,className:"recent-keyword-item"+(this.props.isFocused?" active":""),onClick:this._onClickKeyword.bind(this)},o.a.createElement("div",{style:{display:"flex",width:"calc(100% - 25px)"}},o.a.createElement(D.a,{className:"time-reminder-icon",style:{fontSize:"22px",color:"var(--neutral-500)"}}),o.a.createElement("div",{className:"truncate",style:{fontSize:"14px",marginLeft:"10px"}},e.data.keyword)),o.a.createElement(D.a,{className:"icon-solid-close icon",title:T.default.str("STR_REMOVE"),onClick:t=>this.props.onRemoveKeyword(t,e.data.keyword)}))}}class Gi extends o.a.Component{constructor(e){super(e),this.state={highlightId:void 0,needRefresh:!1,items:[],keyword:this.props.listKeyword||[]},this.dataList=[],this.renderItem=this.renderItem.bind(this),this.getItemKey=this.getItemKey.bind(this),this.frSectionIndex=0,this.eventHandler=(e,t)=>{switch(e){case p.ConversationListActions.FRIEND_CENTER_CHANGE:if(t)switch(t.act){case"new_request":this.onLoadFriendRequest()}break;case p.GeneralActions.UPDATE_HIDDEN_CHAT:case p.FetchActions.FRIEND_REQUEST_UPDATE:this.reloadOnce=!1,this._updateData(this.state.items,this.state.keyword),this.setState({needRefresh:!this.state.needRefresh});break;case p.FetchActions.GROUP_LEAVE:t&&this._removeItemInList({userId:t})}},v.default.subscribe(this.eventHandler)}_updateData(e,t){this.dataList=[];let s=new W.c({key:"recent_search",height:25,text:this.getHeaderSection()}),n=1,i=[];i=t.map(((e,t)=>{if(e)return{type:"KEYWORD",data:{keyword:e.key,height:40},key:"rct_kw_"+t}}));let o=e;if(o=o.map((e=>{if(e&&e.userId&&!se.a.isThreadHidden(e.userId)){let t=k.default.getMiniInfo(e.userId);return new W.b(Object(a.a)(Object(a.a)(Object(a.a)({},e),t),{},{key:"rct_s_"+e.userId,index:n++}))}})),i&&i.length&&(i=i.slice(0,c.c.sync_recent_search.num_item_kw),this.dataList=[...i]),o&&o.length)this.dataList.length&&this.dataList.push(new W.c({key:"kw_separator",height:20,isSeparator:!0})),o=o.slice(0,c.c.sync_recent_search.num_item_db),this.dataList=[...this.dataList,...o];else{let e=new W.c({key:"empty_recent_search",height:50,text:this.getEmptySection()});this.dataList.push(e)}this.dataList.unshift(s),this.frSectionIndex=this.dataList.length,this.reloadOnce||(this.onLoadFriendRequest(),this.reloadOnce=!0)}shouldComponentUpdate(e,t){return 0==this.state.items.length&&t.items.length===this.props.recentsSearchItems.length&&this._updateData(t.items,t.keyword),this.state.needRefresh!==t.needRefresh||this.state.items!==t.items||this.state.keyword!==t.keyword}componentDidMount(){}componentWillMount(){this.props.recentsSearchItems&&this.props.recentsSearchItems.length||this.props.setRecentSearchFocusState(!1);let e=[];this.props.recentsSearchItems.map((t=>{t.userId&&e.push(O.default.getConversation(t.userId).then((e=>e||t)))})),Promise.all(e).then((e=>{e&&this.setState({items:e})}))}componentWillUnmount(){this.props.setRecentSearchFocusState(!1),v.default.unsubscribe(this.eventHandler)}logSelection(e){if(e)switch(e){case 1:I.e.logAction(179001);break;case 2:I.e.logAction(179002);break;case 3:I.e.logAction(179003);break;case 4:I.e.logAction(179004);break;case 5:I.e.logAction(179005);break;case 6:I.e.logAction(179008);break;case 7:I.e.logAction(179009);break;case 8:I.e.logAction(179010);break;case 9:I.e.logAction(179011);break;case 10:I.e.logAction(179012);break;default:I.e.logAction(179006)}}selectConversation(e,t=!1){if(this.props.setRecentSearchFocusState(!0),e){this.logSelection(e.index);let s={name:this.props.currentTab,userId:e.userId};if(N.a.setOldTab(s),t?this.props.setRecentSearchFocusState(!1):this.setState({highlightId:e.userId}),e.key&&!0===e.key.startsWith("rct_s_")&&!se.a.isThreadHidden(e.userId)){let t=g.default.isOAType(e);He.a.addCacheSearch({userId:e.userId,displayName:e.displayName,avatar:e.avatar,type:t?2:e.isGroup||e.type?1:0})}this.props.selectConversation(e,t)}}backToTabMessage(){c.c.global_search_v3||this.props.setRecentSearchFocusState(!1)}getHeaderSection(){return o.a.createElement("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px",width:"60%"},onClick:this.backToTabMessage.bind(this,null)},c.c.global_search_v3?null:o.a.createElement("i",{className:"btn fa fa-back",style:{marginLeft:"14px",marginTop:"3px",fontSize:"12px",color:"#4a"}}),o.a.createElement(E.a,{textKey:"STR_RECENT_SEARCH_CONTACT",className:"recent-header"}))}getEmptySection(){return o.a.createElement("div",null,o.a.createElement(E.a,{textKey:"STR_RECENT_SEARCH_EMPTY",className:"recent-empty"}))}onClickOpenConversation(e,t){this.selectConversation(e,!1),this._dataList&&this._dataList.setFocusedIndex(t)}onDoubleClickOpenConversation(e){this.selectConversation(e,!0)}getRecentContact(e,t,s){return o.a.createElement(Ui,{key:e.key,item:e,isFocused:t,highlightId:this.state.highlightId,onClickOpenConversation:this.onClickOpenConversation.bind(this),onDoubleClickOpenConversation:this.onDoubleClickOpenConversation.bind(this),dispatch:this.props.dispatch,confirm:this.props.confirm,onUpdateListRequest:this.onLoadFriendRequest.bind(this),index:s,showUserInfo:this.props.showUserInfo,showEditAlias:this.props.showEditAlias,user:this.props.user,removeItemInList:this._removeItemInList.bind(this)})}getRecentKeyword(e,t,s){return o.a.createElement(Fi,{index:s,key:e.key,item:e,isFocused:t,onSearchKeyword:this.props.onSearchKeyword,onRemoveKeyword:this._onRemoveKeyword.bind(this)})}renderItem(e,t,s,a){if(t)return t.constructor===W.c?t.data.isSeparator?o.a.createElement("div",{key:this.getItemKey(t),className:"data-list__separator"}):t.data.text:t.type&&"KEYWORD"==t.type?this.getRecentKeyword(t,s,e):this.getRecentContact(t.data,s,e)}getItemKey(e){return e.constructor,W.c,e.data.key}handleKeyDown(e){switch(e.which){case h.K_ENTER:case h.K_SPACE:if(this._dataList){let t=this._dataList.getFocusedItem();t&&t.data&&(t.constructor===W.b?this.selectConversation(t.data,e.which===h.K_ENTER):t.type&&"KEYWORD"==t.type&&t.data.keyword&&this.props.onSearchKeyword&&this.props.onSearchKeyword(t.data.keyword))}break;case h.K_UP:this.moveUp();break;case h.K_DOWN:this.moveDown();break;case h.K_ESC:this.props.setRecentSearchFocusState&&this.props.setRecentSearchFocusState(!1)}}selectFocusedConversation(e=!1){if(this.dataList&&this.dataList.length>0){let e=this.dataList[1];e&&e.data&&e.constructor===W.b&&this.selectConversation(e.data,!0)}}moveDown(){if(!this._dataList)return;this._dataList.moveFocusDown()&&this._focus()}moveUp(){if(!this._dataList)return;this._dataList.moveFocusUp()?this._focus():this.props.focusInputSearch()}getFocusedIndex(){this._dataList&&this._dataList.getFocusedIndex()}_focus(){this.props.setRecentSearchFocusState(!0);const e=this.recentSearchtList;e&&e.focus()}scrollToTop(e=!0){this._dataList&&this._dataList.scrollToTop()}focusSearch(){this.props.setRecentSearchFocusState(!0),this.isFocused=!0}_onBlur(){this._dataList&&this._dataList.setFocusedIndex(-1),this.isFocused=!1,this.isMouseEntered||setTimeout((()=>{this.props.setRecentSearchFocusState(!1)}),100)}onMouseEnterRecentList(){this.isMouseEntered=!0,this.props.setRecentSearchFocusState(!0)}onMouseLeaveRecentList(){this.isMouseEntered=!1,this.props.setRecentSearchFocusState(!1,!0)}onLoadFriendRequest(){const e=e=>{if(!e||e.length<=0)return;let t=[...this.dataList].slice(0,this.frSectionIndex),s={},n={},i=c.c.recent_search.fr_mode;0!==i&&2!==i||(s[xi.c.request]=!0,n[xi.c.request]=c.c.recent_search.max_fr_request),1!==i&&2!==i||(s[xi.c.suggest]=!0,n[xi.c.suggest]=c.c.recent_search.max_fr_suggest);let r=xi.d.getModelV2(e,s,1,!0,n),l=-1,d=-1;r=r.map(((e,t)=>{if(e&&e.data)switch(e.type){case xi.a.TITLE:return e.data.listName===xi.c.request&&!0===e.data.hasMore?l=e.data.length:e.data.listName===xi.c.suggest&&!0===e.data.hasMore&&(d=e.data.length),new W.c({key:e.data.listName,height:25,text:o.a.createElement("div",{style:{height:"30px",display:"flex",alignItems:"flex-end"},className:"recent-header"},o.a.createElement(E.a,{textKey:e.data.textKey})," (",e.data.length,")")});case xi.a.MULTI_ITEM:{let t=null;if(e.data.items&&e.data.items.length>0&&(t=e.data.items[0]),t){let e=t.dataInfo,s=e.userId,n=k.default.getMiniInfo(s)||{};return new W.b(Object(a.a)(Object(a.a)(Object(a.a)({},e),n),{},{key:`fr-sg${s}`,isGroup:!1}))}return null}case xi.a.ITEM_REQUEST:if(e.data.dataInfo){let t=e.data.dataInfo,s=t.userId,n=k.default.getMiniInfo(s)||{};return new W.b(Object(a.a)(Object(a.a)(Object(a.a)({},t),n),{},{key:`fr-rq${s}`,isGroup:!1}))}return null}})),l>0&&l>c.c.recent_search.max_fr_request&&r.splice(c.c.recent_search.max_fr_request+1,0,new W.c({key:"fr-more",height:25,text:o.a.createElement("div",{style:{height:"30px",display:"flex",alignItems:"flex-end"},className:"recent-header vmore"},o.a.createElement("span",{onClick:this.onViewMoreRequest.bind(this),style:{cursor:"pointer"}},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})," (",l-c.c.recent_search.max_fr_request,")"))})),d>0&&d>c.c.recent_search.max_fr_suggest&&r.push(new W.c({key:"fr-more",height:25,text:o.a.createElement("div",{style:{height:"30px",display:"flex",alignItems:"flex-end"},className:"recent-header vmore"},o.a.createElement("span",{onClick:this.onViewMoreSuggest.bind(this),style:{cursor:"pointer"}},o.a.createElement(E.a,{textKey:"STR_VIEWMORE"})," (",d-c.c.recent_search.max_fr_suggest,")"))})),r=r.filter((e=>!!e)),this.dataList=[...t,...r],this.setState({needRefresh:!this.state.needRefresh})};let t=null,s=!1;0===c.c.recent_search.fr_mode?(t=Bs.a.getListFriendRequest(),s=!0):1===c.c.recent_search.fr_mode?t=Bs.a.getListRecommendedFriend(!0):2===c.c.recent_search.fr_mode&&(t=Bs.a.getListRecommendedFriend());const n=()=>{let t=Bs.a.getListRecommendedFriend(!0);t&&(t.constructor===Array?e(t):t.constructor===Promise&&t.then((t=>{e(t)})))};t&&(t.constructor===Array?t.length<=0&&!0===s?n():e(t):t.constructor===Promise&&t.then((t=>{e(t)})).catch((e=>{!0===s&&n()})))}onJumpFriendCenter(e,t){O.default.getConversation(h.FAKE_CONVERSATION_ID.FRIEND_CENTER).then((s=>{if(s){const n=()=>{let n=Object(a.a)(Object(a.a)({},s),{},{smsUnreadCount:0});Bs.a.setFriendCenterConfig({deeper:{listName:e,titleKey:t},noTitle:!0}),this.props.dispatch({type:p.SideBarActions.SELECT_FRIEND_CENTER,payload:n})};O.default.updateConversation({userId:s.userId,smsUnreadCount:0},["smsUnreadCount"]).then((e=>{n()})).catch((e=>{n()}))}})).catch((e=>{}))}openListFriendSuggest(e=!1){let t=null;t=!0===e?Bs.a.getListFriendRequest():Bs.a.getListRecommendedFriend(!0);const s=e=>{e&&e.length>0&&this.props.dispatch({type:p.ChatBoxActions.SHOW_FRIEND_SUGGESTIONS_MINING,payload:{friendSuggestionMiningContent:e.map((e=>e.dataInfo))}})};t&&(t.constructor===Promise?t.then((e=>{s(e)})):t.constructor===Array&&s(t))}onViewMoreRequest(e){e&&(e.preventDefault(),e.stopPropagation()),this.openListFriendSuggest(!0),I.e.logAction(179103)}onViewMoreSuggest(e){e&&(e.preventDefault(),e.stopPropagation()),this.openListFriendSuggest(!1),I.e.logAction(179106)}_removeItemInList(e){if(!e||!e.userId)return;let t=[];for(let s of this.state.items)s.userId!==e.userId&&t.push(s);this._updateData(t,this.state.keyword),this.setState({items:t})}_onRemoveKeyword(e,t){if(this.props.onRemoveKeyword&&"string"==typeof t){e.preventDefault(),e.stopPropagation(),this.props.onRemoveKeyword(t);let s=this.state.keyword.filter((e=>t!=e.key));this._updateData(this.state.items,s),this.setState({keyword:s}),I.e.logAction(179206)}}render(){let e=null;return this.dataList.length<=0||(e=o.a.createElement(W.d,{ref:e=>this._dataList=e,dltype:W.a.RECENT_SEARCH,onScroll:this._onScroll,key:"recent-search",highlightIndex:this.state.highlightId,items:this.dataList,renderItem:this.renderItem,getItemKey:this.getItemKey,scrollToCenter:!0})),o.a.createElement("div",{id:"recent-search-list",ref:e=>this.recentSearchtList=e,onMouseEnter:this.onMouseEnterRecentList.bind(this),onMouseLeave:this.onMouseLeaveRecentList.bind(this),onBlur:this._onBlur.bind(this),onFocus:this.focusSearch.bind(this),onKeyDown:this.handleKeyDown.bind(this),tabIndex:999},e)}}var Bi=Gi;class Hi extends o.a.Component{constructor(e){super(e),this.state={exportImportType:0,dbExportProgress:0,zippingProcess:0,dbImportProgress:0,importProgress:0,dbExporting:Ta.e.NOT_START,zipping:Ta.e.NOT_START,dbImporting:Ta.e.NOT_START,importing:Ta.e.NOT_START,exportImportProgressError:!1,exportImportErrorText:"",exportImportFinished:!0},this.eventHandler=(e,t)=>{switch(e){case Ta.b.EXPORT_IMPORT_START:this.setState({exportImportType:t.type,dbExportProgress:0,zippingProcess:0,dbImportProgress:0,importProgress:0,dbExporting:Ta.e.NOT_START,zipping:Ta.e.NOT_START,dbImporting:Ta.e.NOT_START,importing:Ta.e.NOT_START,exportImportProgressError:!1,exportImportErrorText:"",exportImportFinished:!1});break;case Ta.b.EXPORT_IMPORT_FINISHED:if(t&&t.type&&this.props.isShowExportImportProgress){let e="";t.error?(t.type,Ta.d.IMPORT_TYPE):(e=t.type===Ta.d.IMPORT_TYPE?T.default.str("IMPORT_SUCCESSFUL"):T.default.str("EXPORT_SUCCESSFUL"),R.a.createSuccess(e),this._toggleCloseExportImport(),this.setState({exportImportFinished:!0}))}else this.setState({exportImportFinished:!0});break;case Ta.b.EXPORT_DB_PROGRESS:if(t){let e=Math.round(t.percentage);t.error?t.error&&this.setState({dbExporting:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,exportImportProgressError:!0,exportImportErrorText:t.errorObj&&t.errorObj.error_code?t.errorObj.error_code:""}):this.setState({dbExporting:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,dbExportProgress:e})}break;case Ta.b.EXPORT_PROGRESS:if(t){let e=Math.round(t.percentage);t.error?t.error&&this.setState({zipping:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,exportImportProgressError:!0,exportImportErrorText:t.errorObj&&t.errorObj.error_code?t.errorObj.error_code:""}):this.setState({dbExporting:Ta.e.COMPLETED,zippingProcess:e,zipping:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING})}break;case Ta.b.IMPORT_DB_PROGRESS:if(t){let e=Math.round(t.percentage);t.error?t.error&&this.setState({dbImporting:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,exportImportProgressError:!0,exportImportErrorText:t.errorObj&&t.errorObj.error_code?t.errorObj.error_code:""}):this.setState({dbImporting:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,dbImportProgress:e})}break;case Ta.b.IMPORT_PROGRESS:if(t){let e=Math.round(t.percentage);t.error?t.error&&this.setState({importing:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,exportImportProgressError:!0,exportImportErrorText:t.errorObj&&t.errorObj.error_code?t.errorObj.error_code:""}):this.setState({importing:t.finished?Ta.e.COMPLETED:Ta.e.RUNNING,importProgress:e})}}}}componentDidMount(){v.default.subscribe(this.eventHandler)}componentWillUnmount(){v.default.unsubscribe(this.eventHandler)}shouldComponentUpdate(e,t){return this.state.exportImportFinished!==t.exportImportFinished||(this.state.dbExporting!==t.dbExporting||this.state.dbExportProgress!==t.dbExportProgress||this.state.zipping!==t.zipping||this.state.zippingProcess!==t.zippingProcess||this.state.dbImportProgress!==t.dbImportProgress||this.state.importProgress!==t.importProgress||this.state.dbImporting!==t.dbImporting||this.state.exportImportProgressError!==t.exportImportProgressError||this.state.importing!==t.importing||this.state.exportImportErrorText!==t.exportImportErrorText)&&this.props.isShowExportImportProgress||this.props.isShowExportImportProgress!==e.isShowExportImportProgress}_toggleShowExportImport(){this.props.dispatch({type:p.PopupActions.HIDE_EXPORT_IMPORT})}_toggleCloseExportImport(){this.props.dispatch({type:p.PopupActions.HIDE_EXPORT_IMPORT,payload:!1}),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.EXPORT,params:!1}),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.IMPORT,params:!1})}render(){let e=0;const{dbExporting:t,zipping:s,dbImportProgress:a,importProgress:n,dbImporting:i,importing:r,dbExportProgress:l,zippingProcess:c,exportImportProgressError:d,exportImportType:h,exportImportFinished:u}=this.state;let _=h==Ta.d.EXPORT_TYPE?"STR_EXPORT":"STR_IMPORT",m="";const p=(t!==Ta.e.NOT_START||s!==Ta.e.NOT_START||i!==Ta.e.NOT_START||r!==Ta.e.NOT_START)&&this.props.isShowExportImportProgress&&!u;h==Ta.d.EXPORT_TYPE?t===Ta.e.RUNNING||s===Ta.e.NOT_START?(e=l,m="STR_EXPORT_DB_EXPORTING"):s===Ta.e.RUNNING?(e=c,m="STR_EXPORT_ZIPPING"):s===Ta.e.COMPLETED&&(e=c,m="STR_EXPORT"):r===Ta.e.RUNNING||i===Ta.e.NOT_START?(e=n,m="STR_IMPORT_UNZIPPING"):i===Ta.e.RUNNING?(e=a,m="STR_IMPORT_DB_IMPORTING"):i===Ta.e.COMPLETED&&(e=a,m="STR_IMPORT_DB_IMPORTED");const g={width:e+"%"};let f=this.state.exportImportErrorText;return p?o.a.createElement("div",{className:"clickable sidebar-export-import filter-tags-container",onClick:this._toggleShowExportImport.bind(this)},o.a.createElement("div",{style:{marginTop:"5px",paddingTop:"7px",marginBottom:"2px",display:"flex",justifyContent:"space-between",borderTop:"1px solid rgb(229, 229, 233)"}},o.a.createElement(E.a,{textKey:_,className:"progress-title"}),o.a.createElement(E.a,{textKey:e+"%",className:"progress-title"})),o.a.createElement("div",{className:"progress-bar item-export-import"},o.a.createElement("div",{className:"progress-track export-import-progress-track",style:{margin:"10px 0 0"}},o.a.createElement("span",{style:g,className:d?"export-import-progress-error":"progress-fill "}))),d&&f?o.a.createElement(E.a,{className:"export-import-progress-error-text",textKey:f}):o.a.createElement(E.a,{className:"export-import-progress-info",textKey:m})):null}}var ji=Hi,Vi=(s("vKkC"),s("s2ie")),Ki=s("1ORX"),Wi=s("GNR+"),Yi=s("diyV"),zi=s("tGM2");class qi extends o.a.Component{constructor(e){super(e),this.state={refresh:!1},this.updateLang=()=>{this.setState({refresh:!this.state.refresh})},T.default.callUpdate(this.updateLang)}shouldComponentUpdate(e,t){return this.state.refresh!==t.refresh}static getRawDateComponent(e,t=!1){if(!e)return null;let s=new Date(e),a=s.getDay(),n=s.getFullYear(),i=s.getMonth(),r=s.getDate(),l=s.getHours(),c=s.getMinutes(),d=Yi.d.getStrNumber(r),h=Yi.d.getStrNumber(i+1);return t?{time:`${Yi.d.getTimeString(l)}:${Yi.d.getTimeString(c)}`,date:`${T.default.str("STR_WEEKDAY_"+a)}, ${T.default.str("STR_DAY_X")} ${d} ${T.default.str("STR_MONTH_X")} ${h} ${T.default.str("STR_YEAR_X")} ${n}`,en_date:`${T.default.str("STR_WEEKDAY_"+a)}, ${T.default.str("STR_MONTH_"+i)} ${d}, ${n}`}:{time:`${Yi.d.getTimeString(l)}:${Yi.d.getTimeString(c)}`,date:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_WEEKDAY_"+a}),", ",o.a.createElement(E.a,{textKey:"STR_DAY_X"})," ",d," ",o.a.createElement(E.a,{textKey:"STR_MONTH_X"})," ",h," ",o.a.createElement(E.a,{textKey:"STR_YEAR_X"})," ",n),en_date:o.a.createElement("span",null,o.a.createElement(E.a,{textKey:"STR_WEEKDAY_"+a}),", ",o.a.createElement(E.a,{textKey:"STR_MONTH_"+i})," ",d,", ",n)}}componentDidMount(){this.__intervalUpdateTime()}componentWillUnmount(){T.default.removeUpdate(this.updateLang)}__intervalUpdateTime(){let e=new Date;e.setMinutes(e.getMinutes()+1),e.setSeconds(0),e.setMilliseconds(0),this.timer&&(clearTimeout(this.timer),this.timer=null);let t=e-new Date;this.timer=setTimeout((()=>{this.setState({refresh:!this.state.refresh},(()=>{this.__intervalUpdateTime()}))}),t)}render(){let e=new Date,t=qi.getRawDateComponent(e)||{},s=t.time,a=T.default.currentLanguage()===zi.h?t.en_date:t.date;return o.a.createElement("div",{className:"zavi-clock__container ",style:{backgroundImage:"url(assets/bg-time.921642c9f5fedd8ab7eb0864ba9eca34.png)"}},o.a.createElement("div",{className:"zavi-clock__time"},s),o.a.createElement("div",{className:"zavi-clock__date"},a))}}var Xi=qi;const Ji=[{icon:"fa-icn-meetinglist",textKey:"STR_MEETING_LIST",id:"invite-meeting"}];class Qi extends o.a.Component{constructor(e){super(e)}componentWillReceiveProps(e){}shouldComponentUpdate(e,t){return this.props.zaviState.user!==e.zaviState.user}_getZaviSidebarItems(){let e=[];return Ji.forEach((t=>{e.push(new W.b(Object(a.a)({height:72},t)))})),e}_mapFunction(e){switch(e){case"create-meeting":if(Vi.a.isCalling())return void R.a.createInfo(T.default.str("STR_CALL_IN_ANOTHER_CALL"));Ki.a.showPopup(Wi.a.CREATE_MEETING_POPUP);break;case"join-meeting":if(Vi.a.isCalling())return void R.a.createInfo(T.default.str("STR_CALL_IN_ANOTHER_CALL"));Ki.a.showPopup(Wi.a.JOIN_MEETING_POPUP)}}_renderItem(e,t,s){let a="zavi-sidebar-list-item "+(t.data&&t.data.className?t.data.className:""),n=this._mapFunction.bind(this,t.data.id);const i=!!this.props.zaviState.user;return o.a.createElement("div",{key:"zavi-"+t.data.id,className:a+(i?"":" disable"),onClick:n},o.a.createElement("i",{className:"fa "+t.data.icon}),t.data&&t.data.textKey?o.a.createElement(E.a,{textKey:t.data.textKey,className:"fr-conv-item-title truncate"}):null)}render(){const e=this._getZaviSidebarItems();return o.a.createElement("div",{className:"chat-info-mention"},o.a.createElement(Xi,null),o.a.createElement(W.d,{key:"",className:"",items:e,initialLength:3,renderItem:this._renderItem.bind(this),getItemKey:e=>e.data.id,focusedIndex:0,ref:e=>this._ScrollBars=e}))}}var $i=Qi,Zi=s("wzJ5");var eo=function(e){return o.a.createElement("div",{className:"chat-info-mention"},o.a.createElement(Zi.a,{zaviState:e.zaviState,dispatch:e.dispatch,confirm:e.confirm,compact:!0}))};const to="COUNTER",so="DOT",ao="VISIBLE";var no=e=>{const{show:t,count:s,type:a,anime:n}=e,[r,l]=Object(i.useState)(t),[c,h]=Object(i.useState)(0),u=Object(i.useRef)(0),_=Object(i.useRef)(null),m=Object(i.useRef)(null),p=Object(i.useCallback)((e=>{switch(a){case"COUNTER":const t=u.current<=5?`${u.current}`:"5plus ",s={display:"flex",fontSize:"15px",color:"var(--orange-300)",background:"var(--white-300)",borderRadius:"50%",marginLeft:"8px"};return o.a.createElement("span",Object(d.a)({style:s,className:e.animeClass},e,{ref:_}),o.a.createElement("i",{className:"fa fa-"+t}));case"DOT":return o.a.createElement("span",Object(d.a)({style:{marginLeft:"8px"},className:`noti-tab-btn-red-dot ${e.animeClass}`},e,{ref:m}));default:return null}}),[a]),g=Object(i.useCallback)((()=>{switch(n){case"VISIBLE":return"noti-tab-unread-fadeout";default:return""}}),[n]);Object(i.useEffect)((()=>{t&&l(!0)}),[t]),Object(i.useEffect)((()=>{s>0&&(u.current=s)}),[s]);const E=Object(i.useCallback)((e=>{e&&(e.style.removeProperty("transition"),e.style.removeProperty("transform"),e.style.removeProperty("position"),e.style.removeProperty("top"),e.style.removeProperty("left"))}),[]);Object(i.useEffect)((()=>{if(c<1)h(c+1);else if(t){const e=document.querySelectorAll(".noti-tab-btn ")[1];if(!e)return;e.style.left=e.getBoundingClientRect().left-14+"px",e.style.top=`${e.getBoundingClientRect().top}px`,e.style.position="fixed"}else{var e;const t=document.querySelectorAll(".noti-tab-btn ")[1];if(!t)return;const s=_.current?null===(e=_.current.parentElement)||void 0===e?void 0:e.getBoundingClientRect().width:0;t.style.left=t.getBoundingClientRect().left-14+"px",t.style.top=`${t.getBoundingClientRect().top}px`,t.style.position="fixed",t.style.transition="all 0.3s linear",t.style.transform=`translateX(${-s}px)`,t.addEventListener("transitionend",(()=>{E(t)}))}}),[t]),Object(i.useEffect)((()=>{if(c<1)h(c+1);else if(r){var e;const t=document.querySelectorAll(".noti-tab-btn ")[1];if(!t)return;const s=_.current?null===(e=_.current.parentElement)||void 0===e?void 0:e.getBoundingClientRect().width:0;t.style.transition="all 0.3s linear",t.style.transform=`translateX(${s}px)`,t.addEventListener("transitionend",(()=>{E(t)}))}}),[r]);const f={animeClass:t?"":g(),onAnimationEnd:()=>{t||l(!1)}};return r?p(f):null},io=s("oH3T");function oo(e,t){const{selected:s,onClick:a,className:n}=e,[r,l]=Object(i.useState)((io.b.getUnreadData()||{unread:0}).unread),c=e=>{var t;t=e.unread,l(t)},d=()=>{io.b.setUnreadCountView({unread:0})};Object(i.useEffect)((()=>(io.b.addUnreadListener(c),()=>{io.b.removeUnreadListener(c)})),[]),Object(i.useEffect)((()=>(setTimeout((()=>{d()}),300),()=>{setTimeout((()=>{d()}),300)})),[s]);return o.a.createElement("div",{ref:t,className:"noti-tab-btn "+(s?"selected ":"")+(n||""),"data-id":"div_TabNC_Focused",onClick:()=>{a(h.NOTIFICATION_TAB.IMPORTANT_TAB),I.e.logAction(1281301)}},o.a.createElement(E.a,{textKey:"STR_FOCUS_TAB",className:"tab__title"}),o.a.createElement("div",{className:"noti-tab-btn-unread-wrap"},o.a.createElement(no,{show:Boolean(r),count:r,type:to,anime:ao})))}var ro=Object(i.forwardRef)(oo);function lo(e,t){const{selected:s,onClick:a,className:n}=e,r=Object(i.useRef)(),[l,c]=Object(i.useState)(!!(io.b.getUnreadData()||{}).redDot),d=e=>{var t;t=e.redDot,c(t)},u=()=>{io.b.setUnreadCountView({redDot:!1})};Object(i.useEffect)((()=>(io.b.addUnreadListener(d),()=>{io.b.removeUnreadListener(d)})),[]),Object(i.useEffect)((()=>{if(r.current||s)return r.current=!0,setTimeout((()=>{u()}),300),()=>{setTimeout((()=>{u()}),300)}}),[s]);return o.a.createElement("div",{ref:t,className:"noti-tab-btn "+(s?"selected ":"")+(n||""),"data-id":"div_TabNC_Others",onClick:()=>{a(h.NOTIFICATION_TAB.OTHERS_TAB),I.e.logAction(1281302)}},o.a.createElement(E.a,{textKey:"STR_EMOTE_NOTIFICATION_TAB",className:"tab__title"}),o.a.createElement("div",{className:"noti-tab-btn-unread-wrap"},o.a.createElement(no,{show:l,type:so,anime:ao})))}var co=Object(i.forwardRef)(lo),ho=s("O8ue"),uo="assets/icon-solid-mention-noti-tab-background-2.dc8f62b1d27e970ed8dd976ae4230ed7.svg";const _o=[{textKey:"STR_ONLY_ME_NOTFICATION_TAB",filterKey:h.IMPORTANT_TAB_FILTER.MENTION_ME,actionLog:1281404},{textKey:"STR_ALL_NOTFICATION_TAB",filterKey:h.IMPORTANT_TAB_FILTER.MENTION_ALL,actionLog:1281403},{textKey:"STR_URGENT",filterKey:h.IMPORTANT_TAB_FILTER.URGENT_MSG,actionLog:1281401},{textKey:"STR_IMPORTANT",filterKey:h.IMPORTANT_TAB_FILTER.IMPORTANT_MSG,actionLog:1281402}],mo=[{textKey:"STR_ALL",filterKey:h.OTHERS_TAB_FILTERS.ALL,actionLog:1281501},{textKey:"STR_UNREAD_LABEL",filterKey:h.OTHERS_TAB_FILTERS.UNREAD,actionLog:1281502}];var po=function(e){const t=Object(i.useRef)(null),s=Object(i.useRef)(null),n=Object(i.useCallback)((()=>e.currentTab===h.NOTIFICATION_TAB.IMPORTANT_TAB?c.c.important_msg_config.disable?_o.filter((e=>-1===[h.IMPORTANT_TAB_FILTER.IMPORTANT_MSG,h.IMPORTANT_TAB_FILTER.URGENT_MSG].indexOf(e.filterKey))):_o:mo),[e.currentTab]),[r,l]=Object(i.useState)(!1),d=Object(i.useMemo)((()=>{let e={};return n().map((t=>e[t.filterKey]=!1)),e}),[n]),u=Object(i.useMemo)((()=>{let e={};return n().map((t=>e[t.filterKey]=!0)),e}),[]),[_,m]=Object(i.useState)(d),p=Object(i.useCallback)((e=>{switch(e){case h.IMPORTANT_TAB_FILTER.MENTION_ME:case h.IMPORTANT_TAB_FILTER.MENTION_ALL:return o.a.createElement("img",{src:uo,className:"noti-tab-icon-mention",style:{marginRight:"8px"}});case h.IMPORTANT_TAB_FILTER.URGENT_MSG:return o.a.createElement("div",{className:"noti-tab-icon important",style:{marginRight:"8px"}},o.a.createElement(D.a,{className:"icon-solid-urgent-noti-tab"}));case h.IMPORTANT_TAB_FILTER.IMPORTANT_MSG:return o.a.createElement("div",{className:"noti-tab-icon important",style:{marginRight:"8px"}},o.a.createElement(D.a,{className:"icon-solid-important-noti-tab"}));default:return null}}),[]),g=Object(i.useCallback)((t=>{const s=[];for(const e in t)t[e]&&s.push(Number(e));e.filter&&e.filter(s)}),[]),f=(e,t)=>{let s=Object(a.a)({},_);s[t.filterKey]=!s[t.filterKey],I.e.logAction(t.actionLog);let n=0;for(const a in s)s[a]&&n++;0===n?v():(m(s),g(s))},v=Object(i.useCallback)((()=>{m(d),g(u)}),[d,u]),{isIndeterminateFilterAll:R,selectedFilterNumber:S}=Object(i.useMemo)((()=>{let e=0;for(const t in _)_[t]&&e++;return{isIndeterminateFilterAll:0<e,selectedFilterNumber:e}}),[_]),O=Object(i.useCallback)((e=>{t.current&&(t.current.show(),l(!0),window.addEventListener("resize",N))}),[t.current]),N=Object(i.useCallback)((()=>{lt.a.closePopover({windowId:"1",name:h.PopoverIdentitiesDefine.NOTI_FILTER_BTN})}),[]),b=[];return n().forEach((e=>{b.push({html:o.a.createElement("div",{key:"filter_noti_"+e.filterKey,className:"zmenu-item noti-filter-menu-item "+(_[e.filterKey]?" selected":""),onClick:t=>{f(0,e)}},o.a.createElement(ho.a,{onChange:t=>f(0,e),checked:_[e.filterKey],shape:"square",className:"noti-filter__check-box"}),o.a.createElement("div",{className:"desc-wrap"},p(e.filterKey),o.a.createElement(E.a,{textKey:e.textKey,className:"truncate flx-1 option__text"})))})})),o.a.createElement("div",{ref:s,className:`flx noti-filter-btn ${R?"":"noti-tab-filter-empty-select "} ${r?"show-menu":""}`,"data-id":"div_TabNC_Filter",onClick:O},R?o.a.createElement(at.a,{size:"m",className:"noti-tab-filter-entry-text",title:T.default.trans("STR_NUMBER_FILTER_NOTIFICATION_TAB",[S]),text:T.default.trans("STR_NUMBER_FILTER_NOTIFICATION_TAB",[S]),icon:{post:{svg:"solid-close",onClick:e=>{e.preventDefault(),e.stopPropagation(),v()}}},preventHover:!0}):o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{textKey:"STR_FILTER_NOTIFICATION_TAB",className:Object(Te.a)(r&&"show-menu")}),o.a.createElement("div",{className:"noti-tab-filter-entry-icon"},o.a.createElement(D.a,{className:Object(Te.a)("icon-solid-filter-noti-tab",r&&"show-menu")}))),o.a.createElement(Za.default,{popoverProps:{identity:{windowId:"1",name:h.PopoverIdentitiesDefine.NOTI_FILTER_BTN},style:{width:"200px"},anchorEl:s.current,deltaPosition:{top:"10px"}},ref:t,items:b,onClose:()=>{l(!1),window.removeEventListener("resize",N)}}))},go=s("u0hE");class Eo extends o.a.Component{constructor(e){super(e)}shouldComponentUpdate(e,t){return this.props.message.msgId!==e.message.msgId}_getContentPrefix(e){switch(e.msgType){case h.MSG_PHOTO:case h.CLI_MSG_TYPE_PHOTO:return T.default.str("STR_PHOTO_MSG","[Hình ảnh]");case h.MSG_CONTACT:case h.CLI_MSG_TYPE_CONTACT:if("recommened.link"==e.message.action)return T.default.str("STR_LINK_MSG","[Link]");case h.MSG_GIF:case h.CLI_MSG_TYPE_GIF:return"[GIF]";case h.CLI_MSG_TYPE_LOCATION:case h.MSG_LOCATION:return T.default.str("STR_LOC_MSG","[Vị trí]");case h.MSG_VIDEO:case h.CLI_MSG_TYPE_VIDEO:return"[Video] ";case h.MSG_FILE:case h.CLI_MSG_TYPE_FILE:if(e.message&&e.message.params){let s=e.message.params;if(s&&"string"==typeof s)try{s=JSON.parse(s)}catch(t){}if(ds.a.isFolderParams(s))return T.default.str("STR_FOLDER_MSG","[Thư mục]")}return T.default.str("STR_FILE_MSG","[File]")}return""}_parseMessage(e){let t=[],s=e.mentions,a="";if(e.message&&e.message.constructor===String?a=e.message:e.message&&e.message.title&&(a=e.message.title),s&&s.length>0){let e=go.c.parse(a,s);for(let s=0;s<e.length;s++)if(e[s].type===m.a.NOT_MENTION_TOKEN){let a=go.e.parse(e[s].value,!1,!0,!1);t.push.apply(t,a)}else t.push(e[s])}else t=go.e.parse(a,!1,!0,!1);return t}_getMentionName(e){return"-1"===e.uid?"All":k.default.getDName(e.uid)||e.value}_buildHTMLContent(e){let t=this._parseMessage(e);return t&&t.length?t.map(((t,s)=>{let a=e.msgId+"-noti-content-"+s;return t.constructor===String?o.a.createElement("span",{key:a},t):t.type===m.a.EMOJI_TOKEN_V2?mn.a.renderUnicodeEmoji(t.value,a,{margin:"0px",marginBottom:"-3px",position:"relative",width:"16px",height:"16px"}):t.type===m.a.MENTION_TOKEN?o.a.createElement("a",{className:"mention-name ws-pre"},this._getMentionName(t)):o.a.createElement("span",{key:a},t.value)})):null}render(){let e=this.props.message,t=this._getContentPrefix(e),s=this._buildHTMLContent(e);return o.a.createElement("div",{className:"truncate"},t?o.a.createElement("span",null,`${t} `):null,s)}}var fo=Eo;const Io=1,To=2,vo="1",Ro=[{textKey:"STR_JUMP_TO_MESSAGE",action:Io},{textKey:"STR_DELETE_MSG",action:To}];var So=function(e){return t=>{const{conversations:s}=t,n=Object(ne.a)(t,["conversations"]),r=t.message||{},l=Object(pn.a)(),c=()=>{let e=(()=>{const e=r.toUid;if(s&&s.length)return s.find((t=>t.userId===e))||{};return{}})();if(e.userId&&!e.userId.startsWith(h.GROUPID_PREFIX)){let t=k.default.getMiniInfo(e.userId);return t&&t.dName?t.dName:""}return e.displayName||""},[d,u]=Object(i.useState)(c());Object(i.useEffect)((()=>{u(c())}),[r.toUid]);const _=Object(i.useCallback)(((e,t=h.FRIEND_REQUEST_SRC_GROUP_CHAT,s=null)=>{let a;s&&(s=g.default.getGroupIdFromConversationId(s),t===h.FRIEND_REQUEST_SRC_GROUP_CHAT?a={groupId:s}:t!==h.FRIEND_REQUEST_SRC_CHAT&&t!==h.FRIEND_REQUEST_SRC_ECARD||(a={toUid:s})),je.a.setFriendRequestSource(e,t,a),Q.default.setSelectConversationSource(178006),H.a.openModal({windowId:vo,name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:e})})),m=Object(i.useCallback)((()=>{let e=t.message,s=[];e.msgType===h.MSG_PHOTO_GROUP?(e=r.message[0],s=r.message.map((e=>e.msgId))):s=[""+e.msgId];const a=r.toUid;a?ka.a.jumpToMessage(e,a,l).then((e=>{const{conversationId:t}=e;let s={name:"message",userId:t};N.a.setOldTab(s)})).catch((t=>{H.a.openModal({windowId:vo,name:h.ModalIdentitiesDefine.MSG_DETAIL,params:{message:e}})})):H.a.openModal({windowId:vo,name:h.ModalIdentitiesDefine.MSG_DETAIL,params:{message:e}})}),[r.msgId]),E=Object(i.useCallback)((()=>{let e=t.message;if(t.deleteItem(e),!e)return;let s=e.toUid;s&&(e.msgType===h.MSG_PHOTO_GROUP?O.default.deletePhotoMessageInRange(e.message).then((e=>{null!=e.delConversationId?l({type:p.FetchActions.DELETE_CONVERSATION,payload:e.delConversationId}):e.msgIds&&l({type:p.ChatBoxActions.DELETE_MESSAGE,payload:{msgId:e.msgIds,conversation:e.conversation,updateConversation:e.updateConversation}})})):O.default.deleteMessageAndReconnectChatThread(e.msgId,e.sendDttm,e.cliMsgId,s,!1,!1).then((e=>{null!=e.delConversationId?l({type:p.FetchActions.DELETE_CONVERSATION,payload:e.delConversationId}):l({type:p.ChatBoxActions.DELETE_MESSAGE,payload:e})})))}),[r.msgId]);let f=Object(i.useMemo)((()=>{let e=[];const t=e=>{switch(e){case Io:return m;case To:return E}};return Ro.forEach((s=>{e.push(Object(a.a)(Object(a.a)({},s),{},{function:t(s.action)}))})),e}),[r.msgId]),I=Object(i.useMemo)((()=>o.a.createElement("div",{style:{overflow:"hidden",textOverflow:"ellipsis",lineHeight:"20px"}},o.a.createElement(fo,{message:r}))),[r.msgId]);const T=Object(a.a)({convName:d,clickAvatar:_,clickItem:m,msgContent:I,commonCtxMenuItems:f},n);return o.a.createElement(ae.a,null,o.a.createElement(e,T))}};const Oo=1;var No=So((function(e){const t=Object(i.useRef)(null),s=Object(i.useRef)(!1);let a=e.message;const n=()=>k.default.getMiniInfo(a.fromUid)||{},[r,l]=Object(i.useState)(!e.isUnreadMessage(a)),[d,m]=Object(i.useState)(n()),p=()=>{l(!e.isUnreadMessage(a))};Object(i.useEffect)((()=>(r||s.current?r&&s.current&&(io.b.removeUnreadListener(p),s.current=!1):(io.b.addUnreadListener(p),s.current=!0),()=>{s.current&&(io.b.removeUnreadListener(p),s.current=!1)})),[r,a.msgId]),Object(i.useEffect)((()=>{l(!e.isUnreadMessage(a))}),[a.msgId]),Object(i.useEffect)((()=>{m(n())}),[a.fromUid]),Object(i.useCallback)((e=>{t.current&&t.current.show(e)}),[t.current]);const g=Object(i.useCallback)((e=>{t.current&&t.current.close(e)}),[t.current]),f=Object(i.useCallback)((t=>{e.clickAvatar(a.fromUid),t.stopPropagation(),t.preventDefault()}),[a.fromUid]),T=Object(i.useCallback)((()=>{e.dismiss(a),l(!0)}),[a.msgId]),v=Object(i.useCallback)((()=>{1===c.c.noti_center_config.entry_position?r?a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ALL?I.e.logAction(1281013):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ME&&I.e.logAction(1281014):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ALL?I.e.logAction(1281008):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ME&&I.e.logAction(1281009):3===c.c.noti_center_config.entry_position?r?a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ALL?I.e.logAction(1281112):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ME&&I.e.logAction(1281113):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ALL?I.e.logAction(1281107):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ME&&I.e.logAction(1281108):2===c.c.noti_center_config.entry_position&&(r?a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ALL?I.e.logAction(1281214):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ME&&I.e.logAction(1281215):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ALL?I.e.logAction(1281209):a.notiType===h.CHAT_NOTIFICATION_TYPE.MENTION_ME&&I.e.logAction(1281210)),T(),e.clickItem(),e.setSelectedMsg(a.msgId)}),[a.msgId,a.notiType,r]);let R=_.a.getHourTimeFromMilisecond(a.sendDttm),S=d.avatar,O=d.dName;return Object(i.useMemo)((()=>o.a.createElement(u.b,{target:{avatar:S,displayName:O},size:"m",onClick:f})),[S,O]),Object(i.useMemo)((()=>{let t=[];return t=t.concat(e.commonCtxMenuItems),r||t.splice(1,0,{textKey:"STR_LABEL_MARK_READ",action:Oo,function:T}),t.map((e=>({html:o.a.createElement("div",{className:"zmenu-item",onClick:t=>{e.function(),g(t)}},o.a.createElement(E.a,{textKey:e.textKey,className:"truncate flx-1"}))})))}),[r,a.msgId,t.current]),o.a.createElement(o.a.Fragment,null,o.a.createElement(y,{itemProps:{id:`noti-mention-${a.msgId}`,className:"conv-item conv-rel "+(e.selectedMsg===a.msgId?"selected":""),onClick:v},conv:d,title:e.convName?`${e.convName}`:"",isUnread:!r},o.a.createElement("status",{className:"noti-tab-icon-wrap"},o.a.createElement("img",{src:uo,className:"noti-tab-icon-mention shadow"})),o.a.createElement("titleMore",null,R),o.a.createElement("message",null,o.a.createElement("div",{className:"conv-message truncate "+(r?"":" unread")},e.msgContent)),!r&&o.a.createElement("moreAction",{style:{display:"flex",alignItems:"center"}},o.a.createElement("span",{className:"noti-tab-btn-red-dot"}))))}));const bo=1;var Co=So((function(e){const t=Object(i.useRef)(null),s=Object(i.useRef)(!1);let a=e.message;const n=()=>"0"===a.fromUid?k.default.getMiniProfileMe()||{}:k.default.getMiniInfo(a.fromUid)||{},[r,l]=Object(i.useState)(!e.isUnreadMessage(a)),[d,m]=Object(i.useState)(n()),p=()=>{l(!e.isUnreadMessage(a))};Object(i.useEffect)((()=>(r||s.current?r&&s.current&&(io.b.removeUnreadListener(p),s.current=!1):(io.b.addUnreadListener(p),s.current=!0),()=>{s.current&&(io.b.removeUnreadListener(p),s.current=!1)})),[r,a.msgId]),Object(i.useEffect)((()=>{l(!e.isUnreadMessage(a))}),[a.msgId]),Object(i.useEffect)((()=>{m(n())}),[a.fromUid]),Object(i.useCallback)((e=>{t.current&&t.current.show(e)}),[t.current]);const g=Object(i.useCallback)((e=>{t.current&&t.current.close(e)}),[t.current]),f=Object(i.useCallback)((t=>{e.clickAvatar(a.fromUid),t.stopPropagation(),t.preventDefault()}),[a.fromUid]),T=Object(i.useCallback)((()=>{e.dismiss(a),l(!0)}),[a.msgId]),v=Object(i.useCallback)((()=>{1===c.c.noti_center_config.entry_position?r?a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?I.e.logAction(1281011):a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&I.e.logAction(1281012):a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?I.e.logAction(1281006):a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&I.e.logAction(1281007):3===c.c.noti_center_config.entry_position?r?a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?I.e.logAction(1281110):a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&I.e.logAction(1281111):a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?I.e.logAction(1281105):a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&I.e.logAction(1281106):2===c.c.noti_center_config.entry_position&&(r?a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?I.e.logAction(1281212):a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&I.e.logAction(1281213):a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?I.e.logAction(1281207):a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&I.e.logAction(1281208)),T(),e.clickItem(),e.setSelectedMsg(a.msgId)}),[a.msgId,r,a.notiType]);let R=_.a.getHourTimeFromMilisecond(a.sendDttm),S=d.avatar,O=d.dName;return Object(i.useMemo)((()=>o.a.createElement(u.b,{target:{avatar:S,displayName:O},size:"m",onClick:f})),[S,O]),Object(i.useMemo)((()=>{let t=[];return t=t.concat(e.commonCtxMenuItems),r||t.splice(1,0,{textKey:"STR_LABEL_MARK_READ",action:bo,function:T}),t.map((e=>({html:o.a.createElement("div",{className:"zmenu-item",onClick:t=>{e.function(),g(t)}},o.a.createElement(E.a,{textKey:e.textKey,className:"truncate flx-1"}))})))}),[r,a.msgId,t.current]),Object(i.useMemo)((()=>a.notiType===h.CHAT_NOTIFICATION_TYPE.IMPORTANT?"STR_IMPORTANT":"STR_URGENT"),[a.notiType]),Object(i.useMemo)((()=>{let e="fa fa-important";return a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT&&(e="fa fa-urgent"),o.a.createElement("div",{className:"noti-icon important"},o.a.createElement("i",{className:e}))}),[a.notiType]),Object(i.useMemo)((()=>a.toUid&&a.toUid.startsWith(h.GROUPID_PREFIX)),[a.msgId]),o.a.createElement(y,{itemProps:{id:`noti-important-${a.msgId}`,className:"conv-item conv-rel "+(e.selectedMsg===a.msgId?"selected":""),onClick:v},conv:d,title:e.convName?`${e.convName}`:"",isUnread:!r},o.a.createElement("status",{className:"noti-tab-icon-wrap"},o.a.createElement("div",{className:"noti-tab-icon important shadow"},o.a.createElement(D.a,{className:a.notiType===h.CHAT_NOTIFICATION_TYPE.URGENT?"icon-solid-urgent-noti-tab":"icon-solid-important-noti-tab"}))),o.a.createElement("titleMore",null,R),o.a.createElement("message",null,o.a.createElement("div",{className:"conv-message truncate "+(r?"":" unread")},e.msgContent)),!r&&o.a.createElement("moreAction",{style:{display:"flex",alignItems:"center"}},o.a.createElement("span",{className:"noti-tab-btn-red-dot"})))}));var Ao=function(e){class t extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"handleLanguageChange",(()=>{this.setState({forceUpdate:Math.random()})})),Object(n.a)(this,"shouldLoadMore",(e=>{const{scrollTop:t,scrollHeight:s,clientHeight:a}=e;return t>s-a-100})),Object(n.a)(this,"getItemKey",(e=>e.constructor===W.c?e.data.id:e.data.msgId)),Object(n.a)(this,"renderLabel",((e,t,s)=>t.data&&t.data.seperator?o.a.createElement("div",{className:"tab-date-separator"}):t.data&&t.data.time?o.a.createElement("div",{className:"tab-date"},te.a.contextDate(t.data.time,{format:"time-range-continuity"})):null)),Object(n.a)(this,"insertDate",(e=>{let t=[],s="0";for(let a=0;a<e.length;a++){let n=e[a].data;n.timeForSort&&!_.a.isSameDate(n.timeForSort,s)&&(s=parseInt(n.timeForSort),0!==a&&t.push(new W.c({seperator:1,id:`s_${a}`,height:8})),t.push(new W.c({time:s,id:`t_${a}`,height:35}))),t.push(e[a])}return t})),Object(n.a)(this,"sortAndDedup",(e=>{e.sort(((e,t)=>{const s=e.data&&e.data.timeForSort||0;return(t.data&&t.data.timeForSort||0)-s}));let t=0;for(;t<e.length-1;){let s=t+1,a=e[t],n=e[s];this.getItemKey(a)!==this.getItemKey(n)?t++:e.splice(t,1)}return e})),Object(n.a)(this,"setSelectedMsg",(e=>{this.selectedMsg=e})),this.state={forceUpdate:0}}componentDidMount(){T.default.callUpdate(this.handleLanguageChange)}componentWillUnmount(){T.default.removeUpdate(this.handleLanguageChange)}render(){const t=this.props,{forwardedRef:s}=t,n=Object(ne.a)(t,["forwardedRef"]),i=Object(a.a)({shouldLoadMore:this.shouldLoadMore,insertDate:this.insertDate,renderLabel:this.renderLabel,getItemKey:this.getItemKey,sortAndDedup:this.sortAndDedup,selectedMsg:this.selectedMsg,setSelectedMsg:this.setSelectedMsg},n);return o.a.createElement(e,Object(d.a)({},i,{ref:s}))}}return o.a.forwardRef(((e,s)=>o.a.createElement(t,Object(d.a)({},e,{forwardedRef:s}))))},yo=s("OONb"),Do="assets/icon-solid-noti-empty.b50a4a850f2ebb279257cc2a7648f11e.svg";const Mo=[h.IMPORTANT_TAB_FILTER.IMPORTANT_MSG,h.IMPORTANT_TAB_FILTER.URGENT_MSG,h.IMPORTANT_TAB_FILTER.MENTION_ME,h.IMPORTANT_TAB_FILTER.MENTION_ALL],Po=[h.CHAT_NOTIFICATION_TYPE.IMPORTANT,h.CHAT_NOTIFICATION_TYPE.URGENT,h.CHAT_NOTIFICATION_TYPE.MENTION_ME,h.CHAT_NOTIFICATION_TYPE.MENTION_ALL],wo=(Lo=Mo).length!=(ko=Po).length||0==Lo.length||0==ko.length?null:Object.assign(...Lo.map(((e,t)=>({[e]:ko[t]}))));var Lo,ko;class xo extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"isUnreadMessage",(e=>{const t=e.toUid;let s=this.props.conversations,a={};s&&s.length&&(a=s.find((e=>e.userId===t))||a);let n=!io.b.isDismissMessage(e.msgId,t)&&a.smsUnreadCount&&io.b.checkIsUnread(e);return n?this._unreadCheck[e.msgId]=!0:delete this._unreadCheck[e.msgId],n})),Object(n.a)(this,"_dismiss",(e=>{if(!this.isUnreadMessage(e))return;io.b.dismissMessage(e.msgId,e.toUid),delete this._unreadCheck[e.msgId];let t=io.b.getUnreadData().unread;t&&io.b.setUnreadCountView({unread:t-1}),this.state.filterKey.includes(h.IMPORTANT_TAB_FILTER.UNREAD)&&this.setState({triggerUpdateData:!this.state.triggerUpdateData})})),Object(n.a)(this,"_deleteItem",(e=>{this._onUpdateData([e],!0)})),Object(n.a)(this,"shouldLoadMore",(()=>{if(!this._dataList)return;const e=this._dataList.getScrollTop(),t=this._dataList.getClientHeight();return e>this._dataList.getScrollHeight()-t-100})),Object(n.a)(this,"_handleScroll",(e=>{this.shouldLoadMore()&&this.hasMoreBott&&this._loadMore()})),Object(n.a)(this,"onFilter",(e=>{this.setState({filterKey:e})})),this.state={triggerUpdateData:!1,dataLoaded:!1,filterKey:Mo,loadingMore:!1},this.isLoading=!0,this.hasMoreBott=!0,this.isDisplayedUnreadFilter=!1,this.dataList=[],this._displayedList=[],this._unreadCheck={},this._onUpdateData=this._onUpdateData.bind(this)}componentWillMount(){io.b.addUpdateImportantDataListener(this._onUpdateData),this._loadLatestData()}componentWillUnmount(){io.b.removeUpdateImportantDataListener(this._onUpdateData)}componentDidUpdate(){this._displayedList.length<100&&this.hasMoreBott&&this._loadMore(),this.isDisplayedUnreadFilter=this.state.filterKey.includes(h.IMPORTANT_TAB_FILTER.UNREAD)}_handleLoadlistData(e,t){this._addToDataList(e.data,t),this.mtnLoadPoint=e.mentionLoadPoint,this.imLoadPoint=e.importantMsgLoadPoint}_onUpdateData(e){switch(e.type){case io.a.UPDATE:{const t=e.data.map((e=>new W.b(Object(a.a)(Object(a.a)({},e),{},{timeForSort:e.sendDttm,height:h.NOTI_ITEM_HEIGHT}))));this.dataList=t.concat(this.dataList),this.props.sortAndDedup(this.dataList),this.setState({triggerUpdateData:!this.state.triggerUpdateData});break}case io.a.DEL_MSG:{let t=!1,s=e.data.msgId,a=this.dataList.findIndex((e=>e.data&&e.data.msgId===s+""));a>-1&&(t=!0,this.dataList.splice(a,1)),t&&this.setState({triggerUpdateData:!this.state.triggerUpdateData});break}case io.a.DEL_CONV:{let t=e.data.conversationId,s=this.dataList.length;this.dataList=this.dataList.filter((e=>e.data.toUid!==t)),s!==this.dataList.length&&this.setState({triggerUpdateData:!this.state.triggerUpdateData});break}}}_addToDataList(e,t){e&&e.length&&(e.forEach((e=>{let t=new W.b(Object(a.a)(Object(a.a)({},e),{},{timeForSort:e.sendDttm,height:h.NOTI_ITEM_HEIGHT}));this.dataList.push(t)})),t&&this.props.sortAndDedup(this.dataList))}_loadLatestData(){io.b.loadLocal().then((e=>{this.isLoading&&!this.state.dataLoaded&&(this._addToDataList(e,!0),this.setState({triggerUpdateData:!this.state.triggerUpdateData,dataLoaded:!0}))})).catch((e=>{})),this.isLoading=!0,io.b.loadLatestData().then((e=>{this.dataList=[],this._handleLoadlistData(e,!0),this.setState({triggerUpdateData:!this.state.triggerUpdateData,dataLoaded:!0}),this.isLoading=!1})).catch((e=>{this.setState({triggerUpdateData:!this.state.triggerUpdateData,dataLoaded:!0}),this.isLoading=!1}))}renderItem(e,t,s){if(!t||!t.data)return null;if(t.constructor===W.c)return this.props.renderLabel(e,t,s);if(t.data.loadingSpinner)return o.a.createElement(yo.a,{style:{marginTop:"20px"}});const a={message:t.data,isUnreadMessage:this.isUnreadMessage,conversations:this.props.conversations,dismiss:this._dismiss,deleteItem:this._deleteItem,"data-id":"div_TabNC_FocusedItem",selectedMsg:this.props.selectedMsg,setSelectedMsg:this.props.setSelectedMsg};switch(t.data.notiType){case h.CHAT_NOTIFICATION_TYPE.MENTION_ALL:case h.CHAT_NOTIFICATION_TYPE.MENTION_ME:return o.a.createElement(No,a);case h.CHAT_NOTIFICATION_TYPE.URGENT:case h.CHAT_NOTIFICATION_TYPE.IMPORTANT:return o.a.createElement(Co,a)}}_isLoadOldDB(){let e=!1;return e=this.state.filterKey.every((function(e){if(e!==h.IMPORTANT_TAB_FILTER.IMPORTANT_MSG&&e!==h.IMPORTANT_TAB_FILTER.URGENT_MSG)return!0})),e}_loadMore(){if(this.isLoading)return;this.setState({loadingMore:!0}),this.isLoading=!0;let e={imLoadPoint:this.imLoadPoint,mtnLoadPoint:this.mtnLoadPoint},t=this._isLoadOldDB();io.b.loadMoreData(e,t).then((e=>{this._handleLoadlistData(e,!1),this.isLoading=!1,this.hasMoreBott=!!e.data.length,this.setState({triggerUpdateData:!this.state.triggerUpdateData,loadingMore:!1})})).catch((e=>{this.isLoading=!1,this.hasMoreBott=!1,this.setState({loadingMore:!1})})),I.e.logAction(1281601)}_filter(){let e=[];return e=Array.isArray(this.state.filterKey)&&0===this.state.filterKey.length?[]:this.dataList.filter((e=>{for(let t=0;t<this.state.filterKey.length;t++)if(e.data.notiType===wo[this.state.filterKey[t]])return!0;return!1})),e=this.props.insertDate(e),e}render(){let e=this._filter();if(!this.state.dataLoaded||this.state.loadingMore)e.push(new W.b({loadingSpinner:!0,height:60}));else if(this._displayedList.length){let e=this._displayedList[this._displayedList.length-1];e&&e.data&&e.data.loadingSpinner&&this._displayedList.pop()}return(!this.isDisplayedUnreadFilter||this._displayedList.length<e.length)&&(this._displayedList=e),this.state.dataLoaded&&!this._displayedList.length?o.a.createElement("div",{className:"media-empty-text"},o.a.createElement("div",null,o.a.createElement("img",{src:Do,className:"noti-tab-empty-icon-wrap "})),o.a.createElement("p",{style:{color:"var(--neutral-500)",fontSize:"14px",paddingLeft:"26px",paddingRight:"26px"},className:"media-empty-text__not-pictured"},o.a.createElement(E.a,{textKey:this.dataList.length?"STR_NOTI_FILTER_EMPTY_MESSAGE":"STR_IMPORTANT_TAB_EMPTY_NOTICE"}))):o.a.createElement("div",{className:"noti-list-item","data-id":"div_TabNC_FocusedList"},o.a.createElement(W.d,{key:"notification-center-list",className:"",items:[...this._displayedList],initialLength:40,renderItem:this.renderItem.bind(this),focusedIndex:0,onScroll:this._handleScroll,ref:e=>this._dataList=e,getItemKey:this.props.getItemKey}))}}var Uo=Ao(xo);const Fo=1;var Go=So((function(e){const t=Object(i.useRef)(null),s=Object(i.useRef)(!1);let a=e.message,n=a.reacts;const r=Object(i.useCallback)((()=>"0"===n.lastSender?k.default.getUidMe():n.lastSender),[n.lastSender]),[l,d]=Object(i.useState)(r()),[u,m]=Object(i.useState)((p=l,k.default.getMiniInfo(p)||{}));var p;const[g,f]=Object(i.useState)(e.isReadReact(e.message)),T=e=>{if(e.convId===a.toUid){let t=parseInt(e.lastSeenReactId||0)>=parseInt(n.lastReceiveReactId||0);f(t)}};Object(i.useEffect)((()=>(g||s.current?g&&s.current&&(rs.a.removeClearReactUnreadListener(T),s.current=!1):(rs.a.addClearReactUnreadListener(T),s.current=!0),()=>{g||(rs.a.removeClearReactUnreadListener(T),s.current=!1)})),[g,a.msgId,n.lastReceiveReactId]),Object(i.useEffect)((()=>{f(e.isReadReact(e.message))}),[n.lastReceiveReactId]),Object(i.useEffect)((()=>{let e=r();d(e),m(k.default.getMiniInfo(e)||{})}),[n.lastSender]);const v=Object(i.useCallback)((e=>{t.current&&t.current.show(e)}),[t.current]),R=Object(i.useCallback)((e=>{t.current&&t.current.close(e)}),[t.current]),S=Object(i.useCallback)((t=>{e.clickAvatar(l),t.stopPropagation(),t.preventDefault()}),[l]),O=Object(i.useCallback)((()=>{1===c.c.noti_center_config.entry_position?g?I.e.logAction(1281015):I.e.logAction(1281010):3===c.c.noti_center_config.entry_position?g?I.e.logAction(1281114):I.e.logAction(1281109):2===c.c.noti_center_config.entry_position&&(g?I.e.logAction(1281216):I.e.logAction(1281211)),N(),e.clickItem(),e.setSelectedMsg(a.msgId)}),[n.lastReceiveReactId]),N=Object(i.useCallback)((()=>{e.disMiss(e.message),f(!0)}),[n.lastReceiveReactId]);let b=Object(i.useMemo)((()=>{let t=[];return t=t.concat(e.commonCtxMenuItems),g||t.splice(1,0,{textKey:"STR_LABEL_MARK_READ",action:Fo,function:N}),t.map((e=>({html:o.a.createElement("div",{className:"zmenu-item",onClick:t=>{e.function(),R(t)}},o.a.createElement(E.a,{textKey:e.textKey,className:"truncate flx-1"}))})))}),[g,t.current,n.lastReceiveReactId]),C=Object(i.useMemo)((()=>_.a.getHourTimeFromMilisecond(n.lastUpdate)),[n.lastUpdate]),A=u.avatar,D=u.dName,M=(Object(i.useMemo)((()=>o.a.createElement(ci.a,{target:{avatar:A,displayName:D},size:"xs",onClick:S})),[A,D]),Object(i.useMemo)((()=>{let e=rs.a.getIconMap()[n.lastReactIcon];return te.a.getHtmlFromText(e)}),[n.lastReactIcon])),P=Object.keys(n.reactions).length,w=Object(i.useMemo)((()=>a.toUid&&a.toUid.startsWith(h.GROUPID_PREFIX)),[a.msgId]);return Object(i.useMemo)((()=>w&&P>1?o.a.createElement(E.a,{textKey:"STR_MULTIPLE_REACT_NOTI",textArguments:[P]}):o.a.createElement(E.a,{textKey:"STR_REACT_NOTI_1_1"})),[w,P]),o.a.createElement(o.a.Fragment,null,o.a.createElement(y,{itemProps:{id:`noti-mention-${a.msgId}`,className:"conv-item conv-rel "+(e.selectedMsg===a.msgId?"selected":""),"data-id":"div_TabNC_OthersItem",onClick:O},conv:{avatar:A,displayName:D},title:e.convName,isUnread:!g},o.a.createElement("status",{className:"noti-tab-icon-wrap"},o.a.createElement("div",{className:"noti-tab-icon shadow reaction"},M)),o.a.createElement("titleMore",null,C||""),o.a.createElement("message",null,o.a.createElement("div",{className:"conv-message truncate "+(g?"":" unread")},e.msgContent)),o.a.createElement("moreAction",{className:"hasOption",style:{display:"flex",alignItems:"center"}},o.a.createElement("div",{className:"noti-more-icon",onClick:v},o.a.createElement("i",{className:"fa fa-tab-icon-more"})),!g&&o.a.createElement("span",{className:"noti-tab-btn-red-dot"}))),o.a.createElement(Za.default,{ref:t,items:b}))}));class Bo extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"_handleEventBus",(e=>{e===p.ChatBoxActions.UNDO_DELETE_MESSAGES&&this._loadLatestData()})),Object(n.a)(this,"_deleteItem",(e=>{this._onUpdateData([e],!0)})),Object(n.a)(this,"shouldLoadMore",(()=>{if(!this._dataList)return;const e=this._dataList.getScrollTop(),t=this._dataList.getClientHeight();return e>this._dataList.getScrollHeight()-t-100})),Object(n.a)(this,"_handleScroll",(e=>{this.shouldLoadMore()&&this.reactionLoadPoint&&this._loadMore()})),Object(n.a)(this,"onFilter",(e=>{this.setState({filterKey:e})})),Object(n.a)(this,"isReadReact",(e=>{let t=rs.a.getUnread(e.toUid),s=e.reacts,a=!0;if(t){const t=e.toUid;let n=this.props.conversations,i={};n&&n.length&&(i=n.find((e=>e.userId===t))||i);let o=parseInt(i.lastSeenReactId||0),r=parseInt(s.lastReceiveReactId||0);a=io.b.isDismissReaction(r,t)||o>=r}return a?delete this._unreadCheck[e.msgId]:this._unreadCheck[e.msgId]=!0,a})),this.state={triggerUpdateData:!1,dataLoaded:!1,filterKey:h.OTHERS_TAB_FILTERS.ALL},this.isLoading=!0,this.dataList=[],this._displayedList=[],this._isInDataList={},this._unreadCheck={},this.reactionLoadPoint=null,this.isDisplayedUnreadFilter=!1,this._onUpdateData=this._onUpdateData.bind(this),this._dismiss=this._dismiss.bind(this)}componentWillMount(){io.b.addUpdateLowPriorityDataListener(this._onUpdateData);let e=io.b.getPreviousOtherTabView();this._addToDataList(e),this._loadLatestData()}componentWillUnmount(){io.b.removeLowPriorityDataListener(this._onUpdateData);let e=this.dataList.map((e=>(this._dismiss(e.data),e.data)));io.b.cachePreviouOtherTabView(e),v.default.unsubscribe(this._handleEventBus)}componentDidMount(){v.default.subscribe(this._handleEventBus)}componentDidUpdate(){this.isDisplayedUnreadFilter=this.state.filterKey===h.OTHERS_TAB_FILTERS.UNREAD}_handleLoadlistData(e){this._addToDataList(e.data),this.reactionLoadPoint=e.reactionLoadPoint}_onUpdateData(e){if(e)switch(e.type){case io.a.UPDATE:this._addToDataList(e.data),this.setState({triggerUpdateData:!this.state.triggerUpdateData});break;case io.a.DEL_MSG:{let t=!1,s=e.data.msgId;if(!this._isInDataList[s])return;let a=this.dataList.findIndex((e=>e.data&&e.data.msgId===s+""));a>-1&&(t=!0,this.dataList.splice(a,1),delete this._isInDataList[s]),t&&this.setState({triggerUpdateData:!this.state.triggerUpdateData});break}case io.a.DEL_CONV:{let t=e.data.conversationId,s=this.dataList.length;this.dataList=this.dataList.filter((e=>e.data.toUid!==t)),s!==this.dataList.length&&this.setState({triggerUpdateData:!this.state.triggerUpdateData});break}}}_addToDataList(e){e&&e.length&&e.forEach((e=>{let t=!g.default.mapHasItem(e.reacts.reactions),s=m.b.isGroupPhoto(e)||e.msgId;if(this._isInDataList[s]){for(let n=0;n<this.dataList.length;n++){let i=this.dataList[n].data;if(i.msgId===s){if(t)this.dataList.splice(n,1),delete this._isInDataList[s];else if(e.reacts.lastUpdate-i.reacts.lastUpdate>=3e5){this.dataList.splice(n,1);let t=new W.b(Object(a.a)(Object(a.a)({},e),{},{timeForSort:e.reacts.lastUpdate,height:h.NOTI_ITEM_HEIGHT}));this.dataList.unshift(t)}else{let t=i.reacts.lastUpdate;e.reacts.lastUpdate=t;let s=new W.b(Object(a.a)(Object(a.a)({},e),{},{timeForSort:e.reacts.lastUpdate,height:h.NOTI_ITEM_HEIGHT}));this.dataList[n]=s}break}}return}if(t)return;this._isInDataList[s]=!0;let n=this.dataList[0]?this.dataList[0].data:null,i=new W.b(Object(a.a)(Object(a.a)({},e),{},{timeForSort:e.reacts.lastUpdate,height:h.NOTI_ITEM_HEIGHT}));!n||n.reacts.lastUpdate<=e.reacts.lastUpdate?this.dataList.unshift(i):this.dataList.push(i)}))}_loadLatestData(){this.isLoading=!0,io.b.loadLowPriorityLatestData().then((e=>{this.dataList=[],this._isInDataList={},this._handleLoadlistData(e),this.setState({triggerUpdateData:!this.state.triggerUpdateData,dataLoaded:!0}),this.isLoading=!1}))}_dismiss(e){if(this.isReadReact(e))return;let t=e.reacts,s=parseInt(t.lastReceiveReactId||0);io.b.disMissReaction(s,e.toUid),delete this._unreadCheck[e.msgId],g.default.mapHasItem(this._unreadCheck)||io.b.setUnreadCountView({redDot:!1}),this.state.filterKey===h.OTHERS_TAB_FILTERS.UNREAD&&this.setState({triggerUpdateData:this.state.triggerUpdateData})}renderItem(e,t,s){if(!t||!t.data)return null;if(t.constructor===W.c)return this.props.renderLabel(e,t,s);const a={message:t.data,conversations:this.props.conversations,dispatch:this.props.dispatch,deleteItem:this._deleteItem,selectedMsg:this.props.selectedMsg,setSelectedMsg:this.props.setSelectedMsg};switch(t.data.notiType){case h.CHAT_NOTIFICATION_TYPE.REACTION:return o.a.createElement(Go,Object(d.a)({disMiss:this._dismiss,isReadReact:this.isReadReact},a))}}_loadMore(){if(this.isLoading)return;this.isLoading=!0;let e={reactionLoadPoint:this.reactionLoadPoint};io.b.loadMoreLowPriorityData(e).then((e=>{this._handleLoadlistData(e),this.setState({triggerUpdateData:!this.state.triggerUpdateData}),this.isLoading=!1}))}_filter(){let e=[];switch(this.state.filterKey){case h.OTHERS_TAB_FILTERS.ALL:e=this.dataList.map((e=>e));break;case h.OTHERS_TAB_FILTERS.UNREAD:e=this.dataList.filter((e=>!this.isReadReact(e.data)))}return e=this.props.insertDate(e),e}render(){let e=this._filter();return(!this.isDisplayedUnreadFilter||this._displayedList.length<e.length)&&(this._displayedList=e),this.state.dataLoaded&&!this._displayedList.length?o.a.createElement("div",{className:"media-empty-text"},o.a.createElement("div",null,o.a.createElement("img",{src:Do,className:"noti-tab-empty-icon-wrap "})),o.a.createElement("p",{style:{color:"var(--neutral-500)",fontSize:"14px",paddingLeft:"26px",paddingRight:"26px"},className:"media-empty-text__not-pictured"},o.a.createElement(E.a,{textKey:this.dataList.length?"STR_NOTI_FILTER_EMPTY_MESSAGE":"STR_OTHER_TAB_EMPTY_NOTICE"}))):o.a.createElement("div",{className:"noti-list-item","data-id":"div_TabNC_OthersList"},o.a.createElement(W.d,{key:"notification-center-list",className:"",items:[...this._displayedList],initialLength:40,renderItem:this.renderItem.bind(this),focusedIndex:0,getItemKey:this.props.getItemKey,ref:e=>this._dataList=e,onScroll:this._handleScroll}))}}var Ho=Ao(Bo);class jo extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"_changeTab",(e=>{this.dataList=[],this.setState({currentTab:e,dataLoaded:!1})})),this.state={currentTab:this._getCurrentTab()},this._tab=o.a.createRef(null),this._onFilter=this._onFilter.bind(this),this.tabContainer=o.a.createRef(),this.tabIndicatorRef=o.a.createRef(),this.focusedTabRef=o.a.createRef(),this.otherTabRef=o.a.createRef()}componentDidMount(){io.b.setNotiChildTab(h.NOTIFICATION_TAB.IMPORTANT_TAB),this._updateIndicatorStyles()}shouldComponentUpdate(e,t){return this.state.currentTab!==t.currentTab||this.props.conversations!==e.conversations}componentDidUpdate(e){e.currentTab!==this.state.currentTab&&this._updateIndicatorStyles()}_getCurrentTab(e){return io.b.getNotiChildTab()}renderSeparator(){return o.a.createElement("hr",{style:{height:"1px",border:"0px",marginTop:"0px",marginBottom:"0px",backgroundColor:"var(--black-300)",opacity:"0.08"}})}_onFilter(e){this._tab&&this._tab.current&&this._tab.current.onFilter&&this._tab.current.onFilter(e)}_updateIndicatorStyles(){if(!(this.tabContainer.current&&this.tabIndicatorRef.current&&this.focusedTabRef.current&&this.otherTabRef.current))return;const{left:e=0}=this.tabContainer.current.getBoundingClientRect();if(this.state.currentTab===h.NOTIFICATION_TAB.IMPORTANT_TAB){const{width:t=0,left:s=0}=this.focusedTabRef.current.getBoundingClientRect();this.tabIndicatorRef.current.style.width=`${t}px`,this.tabIndicatorRef.current.style.left=s-e+"px"}if(this.state.currentTab===h.NOTIFICATION_TAB.OTHERS_TAB){const{width:t,left:s}=this.otherTabRef.current.getBoundingClientRect();this.tabIndicatorRef.current.style.width=`${t}px`,this.tabIndicatorRef.current.style.left=s-e+"px"}}render(){let e=null;switch(this.state.currentTab){case h.NOTIFICATION_TAB.IMPORTANT_TAB:e=o.a.createElement(Uo,Object(d.a)({},this.props,{ref:this._tab}));break;case h.NOTIFICATION_TAB.OTHERS_TAB:e=o.a.createElement(Ho,Object(d.a)({},this.props,{ref:this._tab}))}return o.a.createElement("div",{className:"noti-center-container"},o.a.createElement("div",{className:"noti-tab-title"},o.a.createElement(E.a,{textKey:"STR_CONFIG_NOTI"})),o.a.createElement("div",{className:"flx"},o.a.createElement("div",{className:"flx",style:{position:"relative"},ref:this.tabContainer},o.a.createElement(ro,{textKey:"STR_IMPORTANT",onClick:this._changeTab,selected:this.state.currentTab===h.NOTIFICATION_TAB.IMPORTANT_TAB,ref:this.focusedTabRef}),o.a.createElement(co,{onClick:this._changeTab,selected:this.state.currentTab===h.NOTIFICATION_TAB.OTHERS_TAB,ref:this.otherTabRef}),o.a.createElement("div",{ref:this.tabIndicatorRef,className:"noti-tab-indicator"})),this.state.currentTab===h.NOTIFICATION_TAB.IMPORTANT_TAB&&o.a.createElement(po,{currentTab:this.state.currentTab,filter:this._onFilter})),this.renderSeparator(),e)}}var Vo=jo;var Ko=function(e){if(c.c.noti_center_config.disable)return null;const[t,s]=Object(i.useState)(0),[a,n]=Object(i.useState)(!1),r=e=>{s(e.unread),c.c.noti_center_config.show_red_dot&&n(e.redDot)};return Object(i.useEffect)((()=>{let e=io.b.getUnreadData();return r(e),io.b.addUnreadListener(r),()=>{io.b.removeUnreadListener(r)}}),[]),e.renderEntry({titleKey:"STR_CONFIG_NOTI",tabValue:e.tabValue,icon:{active:"notitab-24-act",normal:"notitab-24-inact"},onClick:()=>{let s=h.NOTIFICATION_TAB.IMPORTANT_TAB;!t&&a&&(s=h.NOTIFICATION_TAB.OTHERS_TAB),1===c.c.noti_center_config.entry_position?(!t&&a&&I.e.logAction(1281001),t&&I.e.logAction(1281002),t||a||I.e.logAction(1281003)):3===c.c.noti_center_config.entry_position?(!t&&a&&I.e.logAction(1281101),t&&I.e.logAction(1281102),t||a||I.e.logAction(1281103)):2===c.c.noti_center_config.entry_position&&(!t&&a&&I.e.logAction(1281201),t&&I.e.logAction(1281202),t||a||I.e.logAction(1281203)),e.onClick(s)},unreadCount:t,unreadColor:"orange",otherChildren:o.a.createElement("div",{className:"absolute w100 h100"},o.a.createElement(ee.c,{position:ee.b.RIGHT,vDelta:9,hDelta:70,aDelta:16,reddotPos:{top:2,left:-20},tipKey:"client.sidebar.noti_center"}),t?null:o.a.createElement("span",{className:"noti-tab-red-dot "+(a?"":"noti-fadeout")},o.a.createElement("i",{className:"fa fa-N "})))})},Wo=s("6tnf"),Yo=s("29Tt"),zo=s("OlUt"),qo=s("B8k8"),Xo=s("eSGF"),Jo=s("sVMT"),Qo=s("LgUr");const $o=!s("5KmB").g&&s("Dprd").default;v.default.subscribe(((e,t)=>{e===p.FetchActions.DOWNLOAD_DONE&&(Number(null==t?void 0:t.noSuccess)<1||er(t))}));const Zo=(e,t)=>()=>{if(I.e.logAction(106323),qo.a.closeByKey(t),e){let t=e.folderPath||e.localPath;$o.fileExists(t).then((e=>{e?$o.showInFolder(t):R.a.createWarning(T.default.str("STR_TOAST_FILE_NOT_FOUND"))}))}},er=(e=[])=>Object(Xo.a)(e).forEach((e=>{const t=Object(Jo.a)(10);qo.a.show({key:t,type:Qo.b.SUCCESS,subType:Qo.a.INLINE,duration:6e3,title:"STR_DOWNLOAD_DONE",buttons:{primary:{textKey:"STR_OPEN_FOLDER",onClick:Zo(e,t)}}})}));s("TMZd");var tr=s("4prX"),sr=s("Da1s"),ar=s("EBvW");const nr={SINGLE:0,MULTI:1},ir={INLINE:0,CHIP:1};function or(e,t){let{type:s=nr.SINGLE,format:n=ir.INLINE,identity:i,items:r,text:l,textKey:c,textArguments:h=[],onChange:u,onClear:_,selectedTextKey:m,selectedTextArgs:p,previewRenderer:g=null,enableSearchInList:f=!1,title:I="",onShow:T,onClose:v,preventScroll:R=!0,previewClassName:S="",clearValue:O,popoverProps:N}=e,b=Object(ne.a)(e,["type","format","identity","items","text","textKey","textArguments","onChange","onClear","selectedTextKey","selectedTextArgs","previewRenderer","enableSearchInList","title","onShow","onClose","preventScroll","previewClassName","clearValue","popoverProps"]);const[C,A]=o.a.useState(!1),[y,M]=o.a.useState([]),P=o.a.useRef(),w=o.a.useRef();o.a.useImperativeHandle(t,(()=>({clear:()=>{U()},close:()=>{lt.a.closePopover(i)},setValues:e=>{(function(e,t){if(!e&&!t)return!1;if(e&&!t)return!0;if(!e&&t)return!0;if(e.length!==t.length)return!0;for(let s=0;s<e.length;s++)if(-1===t.indexOf(e[s]))return!0;return!1})(e,y)&&(w.current=!1,M(e))}}))),o.a.useEffect((()=>(lt.a.on("afterOpen",i,L),lt.a.on("beforeClose",i,k),()=>{lt.a.removeListener("afterOpen",i,L),lt.a.removeListener("beforeClose",i,k)})),[]),o.a.useEffect((()=>{let e=[],t=[];for(let s=0;s<y.length;s++){let a=y[s];B.hasOwnProperty(a)&&(e.push(B[a]),t.push(a))}u&&w.current&&(u(e,t),w.current=!1),s===nr.MULTI&&C&&requestAnimationFrame((()=>{var e;null==P||null===(e=P.current)||void 0===e||e.reopen()}))}),[y]);const L=o.a.useCallback((()=>{A(!0),T&&T()})),k=o.a.useCallback((()=>{A(!1),v&&v()})),x=o.a.useCallback((e=>{if(s===nr.SINGLE)return e===O?void U():-1!==y.indexOf(e)?F([]):F([e]);let t=[...y],a=t.indexOf(e);-1!==a?t.splice(a,1):t.push(e),F(t)}),[y,s]),U=o.a.useCallback(((e,t=null)=>{e&&(e.preventDefault(),e.stopPropagation()),F([]),_&&_(t)})),F=o.a.useCallback((e=>{w.current=!0,M(e)})),G=o.a.useMemo((()=>r.map((e=>{let t=-1!==(null==y?void 0:y.indexOf(e.value))||!!e.checked||!!e.multi,n=Object(a.a)({},e);return null!=e&&e.onClick||(n=Object(a.a)(Object(a.a)({},n),{},{onClick:t=>x(e.value)})),s===nr.SINGLE?n=Object(a.a)(Object(a.a)({},n),{},{isActive:t}):s===nr.MULTI&&(n=Object(a.a)(Object(a.a)({},n),{},{multi:t})),n}))),[r,y]),B=o.a.useMemo((()=>r.reduce(((e,t)=>{if(t){let{value:s}=t;e[s]=t}return e}),{})),[r]);return o.a.createElement(ar.a,Object(d.a)({},b,{popoverProps:Object(a.a)({identity:i,placement:"bottom-left"},N),enableSearchInList:f,previewRenderer:function(){if(g)return g;let e=null,t=b["data-id-info"]||{},{preview:a,closeBtn:i}=t;if((null==y?void 0:y.length)>0)if(s===nr.SINGLE){let t=y[0],s=null;for(let e=0;e<r.length;e++){var d;if(t===(null===(d=r[e])||void 0===d?void 0:d.value)){s=r[e];break}}if(s){let{text:t,textKey:a,textArguments:n,textPreviewKey:i}=s||{};t?e=o.a.createElement("div",{tilte:I},t):(i||a)&&(e=o.a.createElement(E.a,{textKey:i||a,tagName:"div",textArguments:n,tilte:I}))}}else e=o.a.createElement(E.a,{textKey:m||"STR_FILTER_N",tagName:"div",textArguments:p||[y.length],tilte:I});else e=l?o.a.createElement("div",{tilte:I},l):c?o.a.createElement(E.a,{textKey:c,tagName:"div",textArguments:h,tilte:I}):o.a.createElement(E.a,{textKey:"STR_FILTER",tagName:"div",tilte:I});return o.a.createElement("div",{className:"flx flx-al-c filter-preview-v2"+(C?" m-shown":"")+((null==y?void 0:y.length)>0?" mc-selected":"")+(n===ir.CHIP?" shape-chip":"")+` ${S}`,"data-id":a},e,o.a.createElement(D.a,{className:(y.length<=0?"icon-solid-down":"solid-close close")+" rel",onClick:e=>y.length>0?U(e,"x"):null,"data-id":y.length>0?i:""}))},options:G,preventScroll:R,ref:P}))}var rr=o.a.forwardRef(or);function lr(e){let{identity:t,items:s,textKey:a,textArguments:n=[],onChange:i,value:r,menuStyle:l,selectedTextKey:c,selectedTextArgs:h,useDefaultFriends:_=!1,useDefaultGroups:m=!1,previewClassName:p=""}=e,E=Object(ne.a)(e,["identity","items","textKey","textArguments","onChange","value","menuStyle","selectedTextKey","selectedTextArgs","useDefaultFriends","useDefaultGroups","previewClassName"]);const[f,I]=o.a.useState([]);o.a.useEffect((()=>{T(s)}),[]),o.a.useEffect((()=>{T(s)}),[s]);const T=o.a.useCallback((e=>{if(!_&&!m)return void I(e);let{contacts:t,groups:s}=E.state.conversation,a=[];if(_&&t){for(let n in t)if(t.hasOwnProperty(n)){let e=t[n];e&&a.push(e)}}else if(m&&s)for(let n in s)if(s.hasOwnProperty(n)){let e=s[n];e&&a.push(e)}a.sort(((e,t)=>{let s=k.default.getDName(g.default.getUserId(e))||e.displayName||"",a=k.default.getDName(g.default.getUserId(t))||t.displayName||"";return s.localeCompare(a)})),I(a)}),[m,_]),v=o.a.useMemo((()=>!f||f.length<=0?[]:f.map((e=>{if(!e)return null;let{isGroup:t}=e,s=g.default.getUserId(e),a=t?e.displayName:k.default.getDName(s);return{text:a,title:a,keySearch:a,value:s,icon:{html:o.a.createElement(u.b,{target:e,size:"xs",outline:!1,showUnread:!1})}}})).filter((e=>!!e))),[f]);return o.a.createElement(rr,Object(d.a)({},E,{items:v,format:ir.CHIP,identity:t,enableSearchInList:!0,preventScroll:!1}))}Object(L.sidebarConnect)((e=>({state:{conversation:Object(w.oldConversationSelector)(e)}})),void 0,void 0,{forwardRef:!0})(o.a.forwardRef(lr));var cr=s("fP8I");s("cUwv");function dr(e,t){let{identity:s,labels:a,filters:n,currentFilter:i,onClear:r,onItemClicked:l=(()=>{}),onMultiFilter:c}=e;Object(ne.a)(e,["identity","labels","filters","currentFilter","onClear","onItemClicked","onMultiFilter"]);const d=o.a.useRef(),[u,_]=o.a.useState(O.default.getConvUXMultiLabel()),[m,p]=o.a.useState(n),f=o.a.useRef();f.current={filters:n,multiSelect:u};const v=o.a.useRef(),R=o.a.useCallback((e=>{v.current||(v.current={}),v.current.inEditting=e}));o.a.useImperativeHandle(t,(()=>({isMultiSelect:()=>u}))),o.a.useEffect((()=>{M()}),[]),o.a.useEffect((()=>{M()}),[n]);const S=o.a.useCallback((e=>{if(e){let{value:t}=e;if(t==aa)return aa;for(let e=0;e<a.length;e++){let s=a[e];if(s.id==t)return s}}return null})),N=o.a.useCallback((e=>{e&&(e.preventDefault(),e.stopPropagation()),H.a.openModal({windowId:"1",name:h.ModalIdentitiesDefine.MANAGE_LABEL,params:!0}),I.e.logAction(14524)})),b=o.a.useCallback((e=>{_(e),null!=d&&d.current&&!e&&d.current.clear(),O.default.setConvUXMultiLabel(!!e),e?I.e.logAction(1453202):I.e.logAction(1453203)})),C=o.a.useCallback((e=>{p(e.reduce(((e,t)=>{let s=S(t);return s.constructor===Object?null!=s&&s.id&&(e[s.id]=s):e[s]=s,e}),{}))})),A=o.a.useMemo((()=>{let e=m;u||(e=n);let t=[];for(let s in e)e.hasOwnProperty(s)&&t.push(s);return t.length}),[n,m]),y=o.a.useMemo((()=>{let e=[];return a.length>0&&(e.push({html:o.a.createElement("div",{className:"flx flx-al-c zmenu-item",style:{minWidth:"200px"},onClick:e=>{e&&(e.preventDefault(),e.stopPropagation()),b(!u)}},o.a.createElement(E.a,{textKey:"STR_MULTIPLE_SELECT",tagName:"div"}),o.a.createElement("div",{className:"flx-1"}),o.a.createElement(cr.a,{onChange:b,checked:u,size:"m","data-id":"div_MiniLabel_MultiSelect"})),preventHtmlClick:!0,preventCloseAfterClicked:!0},{type:Za.MENU_ITEM_TYPE.SEPARATE}),e.push(...a.map((e=>({text:e.text,textKey:e.textKey,value:e.id,icon:u?null:{name:"solid-tag",style:{color:g.default._verifyColor(e.color)}},preventCloseAfterClicked:u,"data-id-info":{label:"div_MiniLabelList_Label",checkbox:"div_MiniLabelList_LabelCheckbox",body:"div_DetailLabelList_Label"}}))))),e.push({textKey:"STR_STRANGER_MESSAGE",textPreviewKey:"STR_STRANGERS",value:aa,icon:u?null:"ic_Stranger_Solid_24",preventCloseAfterClicked:u,"data-id-info":{body:"div_DetailLabelList_StrangerMessage"}}),u?e.push({html:o.a.createElement("div",{className:"flx flx-al-c",style:{margin:"12px 8px 4px"}},o.a.createElement("div",{className:"flx-1"}),o.a.createElement(st.a,{size:"small",type:"tertiary",textKey:"STR_UNSELECT",className:"margin-right-4",onClick:e=>{e&&(e.preventDefault(),e.stopPropagation()),null!=d&&d.current&&d.current.clear(),I.e.logAction(1453211)},disabled:A<=0,"data-id":"btn_MiniLabelList_Cancel"}),o.a.createElement(st.a,{size:"small",textKey:"STR_CONFIRM",onClick:e=>{if(R(!1),e&&(e.preventDefault(),e.stopPropagation()),c&&c(m),null!=d&&d.current&&d.current.close(),g.default.isEmptyObject(m))I.e.logAction(1453205);else{I.e.logAction(1453204);let e=g.default.countAttrObject(m);e>=5?I.e.logAction(1453210):I.e.logAction(1453205+e)}},"data-id":"btn_MiniLabelList_Ok"})),preventHtmlClick:!0,preventCloseAfterClicked:!0}):e.push({type:Za.MENU_ITEM_TYPE.SEPARATE},{textKey:"STR_LABEL_MANAGE",icon:"icon-outline-setting",onClick:N,"data-id-info":{body:"div_DetailLabelList_MngLabel"}}),e}),[a,n,m,u]),D=o.a.useMemo((()=>{if(!u)for(let t in n){var e;if(n.hasOwnProperty(t))return{text:(null===(e=n[t])||void 0===e?void 0:e.text)||T.default.str(n[t].textKey)}}return null}),[n,u]),M=o.a.useCallback((()=>{let{filters:e={}}=f.current,t=[];for(let s in e)e.hasOwnProperty(s)&&t.push(parseInt(s));null!=d&&d.current&&d.current.setValues(t)}),[n]);return o.a.createElement(rr,{identity:s,items:y,format:ir.INLINE,type:u?nr.MULTI:nr.SINGLE,textKey:A<=0?"STR_LABEL_CLASS_2":null,selectedTextKey:A<=0?void 0:!u&&null!=D&&D.textKey?D.textKey:A<=1?"STR_1_LABEL":"STR_N_LABELS",selectedTextArgs:[A],text:A>0?null==D?void 0:D.text:void 0,ref:d,onChange:e=>{if(R(!0),u)return C(e);if(l){let t=e[0];if(l(S(t)),t){let{value:e}=t;e===aa?I.e.logAction(14510):I.e.logAction(14530)}}},onClear:e=>{let{multiSelect:t,filters:s}=f.current;g.default.isEmptyObject(s)||(t?c&&c({}):l&&l(null),"x"===e&&I.e.logAction(1453212))},onShow:()=>{R(!1),M(),I.e.logAction(1453201)},onClose:()=>{var e;let{multiSelect:t}=f.current;!0===(null===(e=v.current)||void 0===e?void 0:e.inEditting)&&t&&M()},previewClassName:"label-filter-preview","data-id-info":{preview:"div_MiniLabel_OpenLabelList",closeBtn:"btn_MiniLabel_CloseSelectLabel"}})}var hr=o.a.forwardRef(dr);function ur(e,t){let{type:s,format:a,size:n,modifier:i,icon:r,disabled:l,items:c,identity:h,placement:u}=e,_=Object(ne.a)(e,["type","format","size","modifier","icon","disabled","items","identity","placement"]);const m={items:c},p={identity:h,placement:u},g={type:s,format:a,size:n,modifier:i,icon:r,disabled:l},[E,f]=o.a.useState(!1),I=o.a.useRef(null),T=o.a.useCallback((e=>{var t;e&&(e.stopPropagation(),e.preventDefault()),null==I||null===(t=I.current)||void 0===t||t.show(e)})),{button:v,menu:R}=_["data-id-info"]||{};return o.a.createElement(o.a.Fragment,null,o.a.createElement(st.a,Object(d.a)({},g,{onClick:T,isActive:E,"data-id":v})),o.a.createElement(Za.default,Object(d.a)({},m,{popoverProps:p,ref:I,onShow:()=>{f(!0)},onClose:()=>{f(!1)}})))}var _r=o.a.forwardRef(ur);function mr(e,t){let{size:s="large",type:a="default",textKey:n,textArguments:i,text:r,onChange:l,children:c,title:d,initState:h}=e;Object(ne.a)(e,["size","type","textKey","textArguments","text","onChange","children","title","initState"]);const[u,_]=o.a.useState(void 0===h||h);o.a.useImperativeHandle(t,(()=>({set:e=>{_(e)}})));const m=o.a.useCallback((()=>r?o.a.createElement("div",{title:d},r):o.a.createElement(E.a,{tagName:"div",textKey:n,textArguments:i,title:d})),[r,i,n,d]),p=o.a.useCallback((()=>"default"===a?null:o.a.createElement(D.a,{className:(u?"solid-right-1":"solid-down-1")+" margin-right-4 custom-icon"})),[a,u]),g=o.a.useCallback((()=>"custom"===a?null:o.a.createElement(D.a,{className:u?"icon-solid-down":"icon-solid-up"})),[a,u]);return o.a.createElement("div",{className:"collapse-container"},o.a.createElement("div",{className:"coll-title flx flx-al-c w100 "+s,onClick:()=>{let e=!u;_(e),l&&l(e)}},p(),m(),o.a.createElement("div",{className:"flx-1"}),g()),u?null:o.a.createElement("div",{className:"coll-content"},c))}mr.propTypes={size:l.a.oneOf(["small","medium","large"]),type:l.a.oneOf(["default","custom"])};var pr=o.a.forwardRef(mr),gr=s("02c9");const Er=o.a.lazy((()=>s.e(17).then(s.bind(null,"l2EW")))),fr=(window.location.host,c.c.domain,g.default.isWeb());let Ir,Tr;fr||(Ir=s("Dprd").default,Tr=s("J0iE").default);zt.a;const vr="message",Rr="contact",Sr="more",Or="shop",Nr="noti",br="mention",Cr="file",Ar="star",yr="eventTab",Dr="todo",Mr="zavi",Pr="setting",wr="toolTab",Lr="catalogTab",kr="z_sendtome_bubbledot_",xr={searchText:"",searchResult:{},searching:!1,conversation:null},Ur="ztypsp_",Fr=new g.LocalId;let Gr=null;const Br={windowId:"1",name:"pop_tabs"},Hr="1";class jr extends o.a.Component{constructor(e){super(e),Object(n.a)(this,"_shouldFocusAfterSendMsg",(e=>{var t,s;return!((null==e||null===(t=e.messages)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.upSrc)&h.FILE_UP_SRC.TextEditor)})),this._searchDelay=this._getSearchDelaySetting(),this._innerSearchFunc=(e,t)=>{Fr.valid(t)&&(this.state.currentTab===Cr?this.filterFiles(e):this.state.search.conversation?this.filterByConversation(e,this.state.search.conversation):this._searchGlobal(e))},this.functionSearchByName=g.default.throttle(this._innerSearchFunc,this._searchDelay),this.dispatch=e.dispatch,this.countQuery=Fr.next(),this.numMoreTab=0,this.state={migrating:!1,syncMsgFromMobile:h.SYNC_MOBILE_MESSAGE.DONT_SYNC,currentTab:vr,tmpCurrentTab:"",search:xr,highlightId:null,selectedId:null,newFriends:null,notifications:{friendListUserIds:[]},showStarTooltip:!1,updateDisplayName:null,arrFileDonwloadDone:[],showUpdateBtn:!1,showDownloadUpdateBtn:!1,updateInfo:{},sidebarPopupItems:[],filterTags:[],currentLabelId:sa,friendRequests:[],checkNotiNewFriend:!0,user_mode:-1,needRefresh:!1,addFriendSuggestion:!1,refreshSuggest:!1,todoUnread:0,exportImportFinished:!0,exportImportProgressError:!1,refreshIconHiddenChat:!1,isAnimHiddenChat:!1,showMsgDetailPopup:null,leftbarTopStack:0,numberMoreTabs:0,filter:h.CONV_FILTER.ALL,theme:zo.a.default,convUXVer:O.default.getConvUXVersion(),filters:{},convUxEntryPoint:O.default.getConvEntryPointCheck()||!1},this.eventHandler=(e,t)=>{switch(e){case p.ChatBoxActions.SEND_MSG:this.state.currentTab!==Dr&&this._shouldFocusAfterSendMsg(t)&&this._selectTabOnMessageSent();break;case p.ChatBoxActions.SEARCH_CHAT_CONTENT:this.filterByConversation(this.state.search.searchText,t),this._focusSearchBox();break;case p.ChatBoxActions.SELECT_FRIEND:this._selectConversationForFriend(t);break;case p.FriendListActions.NOTIFICATIONS_CHANGED:this._handleFriendListNotificationsChange(t);break;case p.FocusActions.FOCUS_OUT_APP:{let e=this.getRecentSeacrchItems();this._searchInput&&this._searchInput.blur(),e.length>0&&(this.setRecentSearchFocusState(!1),this.setState({needRefresh:!this.state.needRefresh}));break}case p.SideBarActions.SHOW_FILE_MANAGER:this.setState({currentTab:Cr});break;case p.ChatBoxActions.SEND_FRIEND_REQUEST:{const e=this.state.notifications.friendListUserIds.filter((e=>e!==t));let s=null;e.length!==this.state.notifications.friendListUserIds.length&&(O.default.removeFriend(t),g.default.logCoreError("[reddot-check] SEND_FRIEND_REQUEST: "+JSON.stringify(t)),s={notifications:Object(a.a)(Object(a.a)({},this.state.notifications),{},{friendListUserIds:e})});break}case p.SideBarActions.CLEAR_UNREAD_NOTIFY_FRIEND_CENTER:this.setState({notifications:Object(a.a)(Object(a.a)({},this.state.notifications),{},{friendListUserIds:[]})});break;case p.SideBarActions.FOCUS_SEARCH_INPUT:this._focusSearchBox();break;case p.SideBarActions.SELECT_TAB_MSG:this._selectTab(vr);break;case p.SideBarActions.SELECT_ZAVI_TAB:this._selectTab(Mr);break;case p.FetchActions.FRIENDS_REMOVED:t&&this._onRemoveSearchResult(t,!1);break;case p.FetchActions.UPDATE_NAME:g.default.logCoreError("UPDATE_NAME"),t&&this._onUpdateDisplayName(t);break;case p.FetchActions.GROUP_LEAVE:case p.PopupActions.DID_LEAVE_GROUP:t&&this._onRemoveSearchResult(t,!0);break;case p.FetchActions.USERID_FETCHED:if(t){let e=!1,s=k.default.getMiniInfo(g.default.getMostRecentLoggedInUserId());s&&t.avatar&&(s.avatar!=t.avatar||s.displayName!=t.displayName&&t.avatar.indexOf("default")>0)&&(e=!0),e&&v.default.send(p.GeneralActions.CHANGE_PROFILE_ME,{avatar:t.avatar})}break;case p.ConversationListActions.SELECT_CONVERSATION:this.lastTabInFullMode="",this.state.currentTab!==Or&&this.state.currentTab!==Cr&&this.state.currentTab!==Mr&&this.state.currentTab!==Lr||this._selectTab(vr),t.userId&&this.setState({highlightId:t.userId}),!0===t.fromNotify&&this.state.currentLabelId!==sa&&this._onFilterTagsItemClicked(null);break;case p.ChatBoxActions.JUMP_TO_MESSAGE_SEARCH_HIDDEN_CHAT:case p.ChatBoxActions.JUMP_TO_MESSAGE_SEARCH:this.state.currentTab==Cr&&this._selectTab(vr);break;case p.MessageActions.ADD_STAR:case p.MessageActions.UNDO_DEL_STAR:this.starTooltipTimer>=0&&(clearTimeout(this.starTooltipTimer),this.starTooltipTimer=-1),e!==p.MessageActions.UNDO_DEL_STAR&&this.setState({showStarTooltip:!0}),this.starTooltipTimer=setTimeout((()=>{this.setState({showStarTooltip:!1})}),3e3);break;case p.SideBarActions.SEARCH_FILE_DONE:this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searching:!1})});break;case p.SideBarActions.SELECT_TAB_ZALO_SHOP:this.selectZaloShopTab();break;case p.SideBarActions.CLEAR_SEARCH:this._clearSearch();break;case p.SideBarActions.JUST_OPENED_FILES:{let e=!1,s=0,a=0;const n=new Date,i="z_sendtome_suggest_limit_"+this.props.user.userId,o=window.localStorage.getItem(i);if(o){const t=o.split("_");if(s=+t[0],s<9){const s=new Date(+t[1]);(new Date).getDate()===s.getDate()?(a=+t[2],a<3&&(e=!0)):e=!0}}else e=!0;e?(s++,a++,window.localStorage.setItem(i,`${s}_${n.getTime()}_${a}`)):g.default.log("check-just-open over limit",o),e&&(fn.a.removeDataCache(),v.default.send(p.FetchActions.NEW_SUGGEST_SEND,null),this.setState({sidebarPopupItems:[t]}));break}case p.ConversationListActions.TAG_UPDATE:this._updateLabelId(t);break;case p.PopupActions.UPDATE_LABELS:if(t&&t.remove){let e=t.remove.map((e=>e.id));for(let t=0;t<e.length;t++){var s;let a=e[t];if(null!==(s=this.state.filters)&&void 0!==s&&s.hasOwnProperty(a)){this._onFilterTagsItemClicked(null);break}}}b.b.getAll(null,!1).then((e=>{this.setState({filterTags:e})}));break;case p.FetchActions.FRIENDS_FETCHED:for(let e in t)if(t.hasOwnProperty(e)){const t=this.state.friendRequests.slice();for(let s=0;s<t.length;s++)if(t[s].userId===e){t.splice(s,1);break}t.length!==this.state.friendRequests.length&&this.setState({friendRequests:t})}break;case p.FetchActions.FRIEND_REQUESTS_FETCHED:{g.default.log("friendNotificationAction: friend requests fetched",t);const e=this.state.friendRequests.reduce(((e,t)=>{const s=t.userId;return e[s]||(e[s]=!0),e}),{}),s=this.state.friendRequests.slice();for(let a of t)e[a.userId]||s.unshift(a);this.setState({friendRequests:s});break}case p.FetchActions.FRIEND_REQUESTS_REMOVED:{g.default.log("friendNotificationAction: friend requests removed",t);const e=this.state.friendRequests.filter((e=>-1===t.indexOf(e.userId)));e.length!==this.state.friendRequests.length&&this.setState({friendRequests:e}),this._handleFriendListNotificationsChange({action:"remove",ids:t});break}case p.FetchActions.SYNC_LABEL:this._processSyncLabel(!0);break;case p.GeneralActions.NETWORK_STATUS_CHANGED:!0===t&&(!0===b.b.needRetry()&&(b.b._syncLabel(),b.b.clearRetry()),!0===this.fetchLabelNoNetwork&&(this.fetchLabelNoNetwork=!1,this._processSyncLabel()));break;case p.ChatBoxActions.ACCEPT_FRIEND_REQUEST:t&&(this.props.state.conversation.currentConv&&this.props.state.conversation.currentConv.userId!==h.FAKE_CONVERSATION_ID.FRIEND_CENTER&&O.default.getAcceptNewFriend(this.props.state.conversation.currentConv),this._acceptFriendRequest(t,!0));break;case p.SideBarActions.REJECT_FRIENDS:t&&this._rejectFriendRequest(t,!0);break;case p.PopupActions.MARK_READ:t&&this._onMarkAsRead(null,t);break;case p.PopupActions.SHOW_POPUP_SYNC_MSG:t&&!t.showPopup&&(this.state.syncMsgFromMobile===h.SYNC_MOBILE_MESSAGE.WAIT_FOR_DATA&&t.step===h.SYNC_MOBILE_MESSAGE.DONE?setTimeout((()=>{this.setState({syncMsgFromMobile:t.step})}),2e3):this.state.syncMsgFromMobile!==h.SYNC_MOBILE_MESSAGE.DONE&&this.setState({syncMsgFromMobile:t.step}));break;case p.FetchActions.UPDATE_PROFILE_MODE:if(t&&(O.default.updateFriend(t,"user_mode").then((e=>{})).catch((e=>{})),this.props.user.userId===t.userId&&1===c.c.enable_busy_mode)){0;let e=t.user_mode;this.setState({user_mode:g.default.verifyUserMode(e)})}break;case p.PopupActions.BUSY_STATS_POPUP:this.userStatusRef&&this.userStatusRef.close();break;case p.PopupActions.SHOW_UPDATE_BTN:t&&(t.updateType!==h.REQUIRED_UPDATE&&t.updateType!==h.OPTIONAL_UPDATE?this.closeUpdateModal():this.showUpdateModal(t),this.setState({showUpdateBtn:t.notify,updateInfo:t}));break;case p.PopupActions.SHOW_MANUAL_UPDATE_BTN:t&&(this.closeUpdateModal(),this.setState({showManualUpdateBtn:t.notify,updateInfo:t}));break;case p.PopupActions.SHOW_DOWNLOAD_UPDATE_BTN:t?(t.updateType!==h.REQUIRED_UPDATE&&t.updateType!==h.OPTIONAL_UPDATE?this.closeDownloadUpdateModal():this.showDownloadUpdateModal(t),this.setState({showDownloadUpdateBtn:t.notify,updateInfo:t})):(this.closeDownloadUpdateModal(),this.setState({showDownloadUpdateBtn:!1}));break;case p.PopupActions.SHOW_UPDATE_MODAL:this.state.showUpdateBtn&&this.state.updateInfo&&this.showUpdateModal(this.state.updateInfo);break;case p.PopupActions.SHOW_ERROR_PIN_CONVERSATION:t&&this.showPopupErrorPinConv(t);break;case p.FetchActions.NEW_SUGGEST_SEND:this.setState({refreshSuggest:!this.state.refreshSuggest});break;case p.TodoActions.OPEN_TODO_LIST:this.todoView?this.todoView.onCheckOpenTab():this._selectTab(Dr);break;case p.GeneralActions.SHOW_STATUS_TASKBAR:t&&this.countOnTaskbar>=0&&(this.showStatusTaskbar=wt.f.getShowStatusTaskbar(this.props.user.userId),this.setUnreadBadge(this.countOnTaskbar));break;case p.TodoActions.SHOw_TODO_FILTER_BY_CONV_V2:this._openTodoSumaryv2(t);break;case p.TodoActions.SHOW_TODO_REMIND_SUMMARY_LIST:this._onOpenTodoRemindSummary(t);break;case p.TodoActions.CREATE_TODO:case p.TodoActions.UPDATE_TODO:case p.TodoActions.REMOVE_TODO:case p.TodoActions.CLEAR_TODO_UNREAD:case p.TodoActions.MSG_CLEAR_UNREAD:this.updateTodoUnread();break;case p.ActionList.ACT_OPEN_TAB_CHAT:this._onSelectTabMessage();break;case p.ActionList.ACT_OPEN_TAB_CONTACT:this._selectTab(Rr);break;case p.ActionList.ACT_OPEN_GROUPLIST:{let e={name:Rr,userId:h.FAKE_CONVERSATION_ID.GROUP_CENTER};N.a.setOldTab(e),this.state.currentTab===Rr?this._contactList&&this._contactList.onJumpGroupCenter():this._selectTab(Rr);break}case Ta.b.EXPORT_IMPORT_START:this.setState({exportImportFinished:!1,exportImportProgressError:!1});break;case Ta.b.EXPORT_IMPORT_FINISHED:this.setState({exportImportFinished:!0,exportImportProgressError:!1});break;case Ta.b.IMPORT_DB_PROGRESS:case Ta.b.IMPORT_PROGRESS:case Ta.b.EXPORT_PROGRESS:case Ta.b.EXPORT_DB_PROGRESS:t&&t.error&&this.setState({exportImportProgressError:!0});break;case p.ConversationListActions.SHOW_UNREAD_HIDDEN_CHAT:this.setState({refreshIconHiddenChat:!this.state.refreshIconHiddenChat,isAnimHiddenChat:!0}),Gr||(Gr=setTimeout((()=>{Gr=null,this.setState({isAnimHiddenChat:!1})}),1500));break;case p.GeneralActions.UPDATE_HIDDEN_CHAT:case p.ConversationListActions.BLOCK_CONVERSATION:this.setState({needRefresh:!this.state.needRefresh});break;case p.ConversationListActions.MUTE_CONVERSATION:t.userId&&se.a.isThreadHidden(t.userId)&&se.a.checkShowUnreadHiddenChat(t.userId);break;case p.FetchActions.CLEAR_UNREAD:case p.ChatBoxActions.READ_CONVERSATION:t.conversationId&&se.a.isThreadHidden(t.conversationId)&&se.a.checkShowUnreadHiddenChat(t.conversationId)}},this._onDoubleClickTabHeader=this._onDoubleClickTabHeader.bind(this),this._selectConversationForFriend=this._selectConversationForFriend.bind(this),this._onFocusFirstItem=this._onFocusFirstItem.bind(this),this._focusSearchBox=this._focusSearchBox.bind(this),this._onFocusComposeBtn=this._onFocusComposeBtn.bind(this),this.handleResize=this.handleResize.bind(this),this._getConversationFromId=this._getConversationFromId.bind(this),this.isIgnoreUsingShortcut=!1,this.isFireFoxBrowser=this.isFireFox(),this.retryClearSelection=!1,this.starTooltipTimer=-1,this._removeSidebarPopupItem=this._removeSidebarPopupItem.bind(this),this._acceptFriendRequest=this._acceptFriendRequest.bind(this),this._rejectFriendRequest=this._rejectFriendRequest.bind(this),this._showUserInfo=this._showUserInfo.bind(this),this._openCPUPerf=this._openCPUPerf.bind(this),this._handleFriendListNotificationsChange=this._handleFriendListNotificationsChange.bind(this),this._getAllFriendRequests=this._getAllFriendRequests.bind(this),this._onChangeUserMode=this._onChangeUserMode.bind(this),this._closeSuggestContact=this._closeSuggestContact.bind(this),this.getCurrentTab=this.getCurrentTab.bind(this),this._onSelectionSearchChange=this._onSelectionSearchChange.bind(this),this.onShowMsgSrc=this.onShowMsgSrc.bind(this),this._onSearchKeyword=this._onSearchKeyword.bind(this),this.tabRef=o.a.createRef(null),this.collapseRef=o.a.createRef(null),Jt.a.subscribe(this.listenEventCatalog.bind(this))}listenEventCatalog(e){this._selectTab(Lr)}selectZaloShopTab(){0!==In.a.linkOpen().length?this._selectTab(Or):g.default.logCoreError("Link open zaloshop empty")}_openCPUPerf(){H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.TOGGLE_POPUP_CPU_PERF,params:!0})}_cancelSyncMobile(e){Nn.a.removeSyncMsgInfo(),this.setState({syncMsgFromMobile:h.SYNC_MOBILE_MESSAGE.DONE}),I.e.logAction(14408)}_retrySyncMobile(){this.props.syncFromMobileFunc?(this.setState({syncMsgFromMobile:h.SYNC_MOBILE_MESSAGE.WAIT_MOBILE_CONFIRM}),this.props.syncFromMobileFunc()):this.setState({syncMsgFromMobile:h.SYNC_MOBILE_MESSAGE.DONE}),I.e.logAction(14407)}inUserTag(){let{currentLabelId:e,filter:t}=this.state;return e!==sa&&t!==h.CONV_FILTER.UNREAD&&t!==h.CONV_FILTER.STRANGER}_removeItemNotifyDownload(e){if(e)for(let t=0;t<this.state.arrFileDonwloadDone.length;++t){let s=this.state.arrFileDonwloadDone[t];if(e.msgId===s.msgId&&e.localPath===s.localPath){let e=this.state.arrFileDonwloadDone.slice();e.splice(t,1),this.setState({arrFileDonwloadDone:e})}}}_getAllFriendRequests(){return this.state.friendRequests.reduce(((e,t)=>(t&&t.userId&&(e[t.userId]=t),e)),{})}_getBackgroundSidbar(){return c.c.leftMenu&&c.c.leftMenu.actionContent&&c.c.leftMenu.actionContent.sidebarBack&&c.c.leftMenu.actionContent.sidebarStyle?{background:['url("'+c.c.leftMenu.actionContent.sidebarBack+'")',c.c.leftMenu.actionContent.sidebarStyle]}:this.props.colorSidebar?{background:this.props.colorSidebar}:{backgroundImage:"linear-gradient(rgb(72, 198, 239), rgb(111, 134, 214))"}}_handleDownloadDone(e){const{noSuccess:t}=e;if(!isNaN(t)&&Number(t)<1)return;let s=this.state.arrFileDonwloadDone.slice();s.push(e),this.setState({arrFileDonwloadDone:s})}_setSearchDelaySetting(e){try{window.localStorage.setItem(Ur,e)}catch(t){}}_showMyProfile(){H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:this.props.user.userId})}_onUpdateProfile(){H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.UPDATE_PROFILE,params:{showCloseButton:!0}}),this.userStatusRef&&this.userStatusRef.close()}_onAvatarClicked(){I.e.logAction(1460105),this._showMyProfile()}_onOpenUserMode(e){this.userStatusRef&&this.userStatusRef.show(e,this.avatarContainerRef),I.e.logAction(14409)}_syncDbLogout(){Tr.removePasswordRemember(),Tr.removeWrongPasswordDelay()}_onLogOut(){if(this.userStatusRef&&this.userStatusRef.close(),Sn.c.isCalling())return void R.a.createWarning(T.default.str("STR_SIGNOUT_WITH_CALL"));let e="STR_LOGOUT_CONFIRM",t=+On.a.isUploading();if(!t&&Ir&&Ir.isDownloading()&&(t=2),t>0){const s=1===t?T.default.str("STR_TITLE_BAR_SEND"):T.default.str("STR_TITLE_BAR_RECEIVE");e=T.default.str("STR_LOGOUT_CANCEL_FILE")+` ${s} `+T.default.str("STR_TITLE_BAR_EXIT_ZALO_P2")}Nn.a.getLogoutToken(),P.a.openConfirm({windowId:Hr,name:h.MODAL_CONFIRM.confirmIdentities,params:{message:T.default.str(e),okText:T.default.str("STR_LOGOUT_YES"),cancelText:T.default.str("STR_LOGOUT_NO"),onOk:e=>{e&&e.del_history?wt.f.setClearData(this.props.user.userId,1):wt.f.setClearData(this.props.user.userId,0),Tr&&this._syncDbLogout(),Nn.a.logout().catch((e=>{e.error_code&&18032===e.error_code&&H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.CHANGE_PW})}))},options:[{default_val:wt.f.isSetClearData(this.props.user.userId),key:"del_history",title:"STR_LOGOUT_DEL_HISTORY"}],"data-id":{confirmBtn:"btn_Logout_Logout",cancelBtn:"btn_Logout_No"}}})}_onChangeUserMode(e,t,s){if(1!==c.c.enable_busy_mode)return;let n=g.default.verifyUserMode(e),i=this.props.user;if(i){let e=i.userId;e&&k.default.getProfileFriendById(e).then((e=>{e&&(this.changeModeTimer&&(clearTimeout(this.changeModeTimer),this.changeModeTimer=null),this.changeModeTimer=setTimeout((()=>{B.default.updateUserMode(n).then((s=>{t&&t(),O.default.addFriends([Object(a.a)(Object(a.a)({},e),{},{user_mode:n})]),this.setState({user_mode:n})})).catch((e=>{s&&s()}))}),1e3))})).catch((e=>{Lt.Kha.error("[busy] cannot get my profile: "+JSON.stringify(e))}))}}onInviteFriend(e=null,t=null){this.userStatusRef&&this.userStatusRef.close();let s=[{message:{action:"recommened.link",childnumber:0,description:"Zalo cho máy tính gửi file cực nhanh, chụp màn hình tiện lợi, trò chuyện nhóm không giới hạn.",href:`https://${c.c.CONFIG_DOMAIN}/may-tinh?utm_source=chatview&utm_campaign=reinstallpc&utm_medium=web`,params:`{"mediaTitle":"Zalo cho máy tính – Windows, Mac, Ubuntu","artist":"","src":"${c.c.CONFIG_DOMAIN}","stream_icon":"","streamUrl":"","type":0}`,thumb:"https://stc-chat.zdn.vn/images/banner/zalo-thumb-link.png",title:"Zalo cho máy tính – Windows, Mac, Ubuntu",type:"",copyLinkActionCode:e,confirmActionCode:t},msgType:6}];H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.SHARE_MSG_COMPOSE,params:{messages:s,title:T.default.str("STR_INVITE_FRIEND_1"),disableGroup:!0,disablePcUser:!0,callback:(e,t)=>{v.default.send(p.SideBarActions.SEND_INVITATION,{target:e,message:(null==t?void 0:t.length)>0?t[0]:"",link:`https://${c.c.CONFIG_DOMAIN}/may-tinh`})}}})}onWhatNew(){this.userStatusRef&&this.userStatusRef.close(),H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.APP_UPDATE_INFO,params:{data:O.default.getCacheRecentUpdate(),isManual:!0}})}_getSearchDelaySetting(){try{let e=window.localStorage.getItem(Ur);if(e=parseInt(e),e&&!isNaN(e))return e}catch(e){g.default.logCoreError(e)}finally{return 70}}_onFocusComposeBtn(){this._composeBtn&&this._composeBtn.focus()}componentDidUpdate(){this._needUpdateSearchFunc&&this._resetSearchFunction(),(this.needClearSelection||this.retryClearSelection)&&(this.clearAllSelection(),setTimeout((()=>{this.retryClearSelection&&(this.clearAllSelection(),this.retryClearSelection=!1)}),1),this.needClearSelection=!1,this.retryClearSelection=!this.retryClearSelection),this.filterScroll&&requestAnimationFrame((()=>{let e=this.fitlerTagsContent.offsetHeight;this.filterContent.style.height=e<140?e-10+"px":"140px"})),1===c.c.enable_busy_mode&&(this.retryLoadUserMode||(this.retryLoadUserMode=0),this.retryLoadUserMode<3&&(this.retryLoadUserModeTimer&&(clearTimeout(this.retryLoadUserModeTimer),this.retryLoadUserModeTimer=null),this.retryLoadUserModeTimer=setTimeout((()=>{this.retryLoadUserMode++,O.default.getCurrentMode().then((e=>{let t=g.default.verifyUserMode(e);Lt.Kha.error("[busy] loadMode: "+t),null!=e&&this.setState({user_mode:t})})).catch((e=>{Lt.Kha.error("[busy] load current mode: "+JSON.stringify(e))}))}),1500)));let e=!0,t=N.a.getOldTab();if(t&&void 0!==t[this.state.currentTab]){let s=t[this.state.currentTab];s.name===this.state.currentTab&&void 0!==s.userId&&(e=!1)}!0===this.needTopOpenSuggest&&1==e&&(this.updateContactListTimer&&(clearTimeout(this.updateContactListTimer),this.updateContactListTimer=null),this.updateContactListTimer=setTimeout((()=>{this._contactList&&(this.needTopOpenSuggest=!1,this._contactList.onJumpFriendCenter(!0))}),0));-1!==document.body.className.indexOf("mobile-v2 web-window ")&&document.getElementById("contact-suggestion")&&(document.getElementById("contact-suggestion").style.display="none"),Number.isNaN(c.c.core_conf.off_log_dev)||c.c.core_conf.off_log_dev===this.__updateOffLogVal||(this.__updateOffLogVal=c.c.core_conf.off_log_dev,Lt.setOffLog(this.__updateOffLogVal),this.ipc),this._searchInput&&document.addEventListener("selectionchange",this._onSelectionSearchChange)}componentDidMount(){var e,t;Ra.a.registerFunc(h.CmdOrCtrl+h.K_F,(()=>{I.e.logAction(12308),this._focusSearchBox()})),Ra.a.registerFunc(h.Alt+h.K_1,(()=>{this.isIgnoreUsingShortcut||this._selectTab(vr)})),Ra.a.registerFunc(h.Alt+h.K_2,(()=>{this.isIgnoreUsingShortcut||this._selectTab(Rr)})),Ra.a.registerFunc(h.Alt+h.K_3,(()=>{if(!this.isIgnoreUsingShortcut){let e={name:Rr,userId:h.FAKE_CONVERSATION_ID.GROUP_CENTER};N.a.setOldTab(e),this.state.currentTab===Rr?this._contactList&&this._contactList.onJumpGroupCenter():this._selectTab(Rr)}})),Ra.a.registerFunc(h.CmdOrCtrl+h.K_PAGEUP,(()=>{let e=this._conversationList;e&&e.selectNextConversation(-1)})),Ra.a.registerFunc(h.CmdOrCtrl+h.K_PAGEDOWN,(()=>{let e=this._conversationList;e&&e.selectNextConversation(1)})),Z.b.register(4,this._focusSearchBox),Z.b.register(5,this._onFocusComposeBtn),Z.b.register(6,this._onFocusFirstItem),this._processSyncLabel(),window.addEventListener("resize",this.handleResize),v.default.subscribe(this.eventHandler),1===c.c.enable_busy_mode&&O.default.getCurrentMode().then((e=>{let t=g.default.verifyUserMode(e);null!=t&&this.setState({user_mode:t})})).catch((e=>{})),this.updateTodoUnread();const s=()=>{this.updateConversationTimer&&(clearTimeout(this.updateContactListTimer),this.updateContactListTimer=null);let e=c.c.update_conv_time||0;e>0&&(this.updateContactListTimer=setTimeout((()=>{e>0&&(e=c.c.update_conv_time,this._onUpdateConversationTime(),s())}),e))};s(),this.adjustLeftBar(),this.reloadLabel=()=>{this.setState({needRefresh:!this.state.needRefresh})},b.b.bindUpdater(this.reloadLabel,"sidebar"),lt.a.on("beforeClose",{windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_MOREMENU},(()=>{this.onMorePopupClose()})),lt.a.on("beforeClose",{windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_TOOLSMENU},(()=>{this.onToolsPopupClose()})),H.a.addModal({windowId:Hr,name:h.ModalIdentitiesDefine.MSG_DETAIL}),H.a.subscribeTriggers({windowId:Hr,name:h.ModalIdentitiesDefine.MSG_DETAIL,trigger:e=>{this.setState({showMsgDetailPopup:e})}}),null===(e=this.collapseRef)||void 0===e||null===(t=e.current)||void 0===t||t.set(O.default.getCollapseLabelState())}_processSyncLabel(e=!1){const t=()=>{this.syncLabelTimer&&(clearTimeout(this.syncLabelTimer),this.syncLabelTimer=null),this.syncLabelTimer=setTimeout((()=>{b.b.getAll(null,e).then((e=>{if(this.needRetryLabel=0,!e)return void R.a.createError(T.default.str("STR_CTX_SHARE_ERR_UNF"));this.setState({filterTags:[...e]},(()=>{var e;if((null===(e=this.state.filterTags)||void 0===e?void 0:e.length)>0&&void 0===O.default.getConvEntryPointCheck()){O.default.setConvEntryPointCheck(!1);for(let e=0;e<this.state.filterTags.length;e++){let t=this.state.filterTags[e];if(t){let{conversations:e}=t;if((null==e?void 0:e.length)>0){this.setState({convUxEntryPoint:!0},(()=>{O.default.setConvEntryPointCheck(!0),I.e.logAction(1453403)}));break}}}}})),this._onFilterTagsItemClicked(null,!0);let t=[];for(let s=0;s<e.length;s++){let a=e[s];if(a){let e=a.conversations;if(e&&e.length>0)for(let s=0;s<e.length;s++){let n=e[s];t.push({userId:n,label:a.id})}}}this.props.dispatch({type:p.ConversationListActions.TAG_CONV,payload:{data:t,inner:!0}})})).catch((e=>{g.default.logCoreError("[label] _processSyncLabel error:"+JSON.stringify(e)),e&&(212===e.error_code||-69==e.error_code||"ERR_CONNECTION_TIMED_OUT"===e.code&&(this.fetchLabelNoNetwork=!0,g.default.logCoreError("[label] _processSyncLabel error:no_network ----"),this.needRetryLabel||(this.needRetryLabel=0),this.needRetryLabel++,this.needRetryLabel<=3?setTimeout((()=>{t()}),3e3):this.needRetryLabel=0))}))}),1e3)};this.needRetryLabel=0,t();let s=O.default.getLastUsedLabelTime();if(s>0){var a,n;if(Date.now()-s>6048e5)null===(a=this.collapseRef)||void 0===a||null===(n=a.current)||void 0===n||n.set(!1),O.default.setCollapseLabelState(!1)}}_upSearchDelay(){let e=this._searchDelay;this._searchDelay=Math.min(400,Math.round(1.1*this._searchDelay+10*Math.random())),this._needUpdateSearchFunc=e!=this._searchDelay}_downSearchDelay(){let e=this._searchDelay;this._searchDelay=Math.max(70,Math.round(.9*this._searchDelay+10*Math.random())),this._needUpdateSearchFunc=e!=this._searchDelay}_resetSearchFunction(){g.default.logCoreError("__rssf__",this._searchDelay),this._needUpdateSearchFunc=!1,this.functionSearchByName=g.default.throttle(this._innerSearchFunc,this._searchDelay)}componentWillUnmount(){Ra.a.unregister(h.CmdOrCtrl+h.K_F),Ra.a.unregister(h.Alt+h.K_1),Ra.a.unregister(h.Alt+h.K_2),Ra.a.unregister(h.Alt+h.K_3),Ra.a.unregister(h.CmdOrCtrl+h.K_PAGEDOWN),Ra.a.unregister(h.CmdOrCtrl+h.K_PAGEUP),Z.b.unregister(this._focusSearchBox),Z.b.unregister(this._onFocusComposeBtn),Z.b.unregister(this._onFocusFirstItem),window.removeEventListener("resize",this.handleResize),v.default.unsubscribe(this.eventHandler),b.b.unbindUpdater("sidebar"),document.removeEventListener("selectionchange",this._onSelectionSearchChange),lt.a.removeListener("beforeClose",{windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_MOREMENU},(()=>{this.onMorePopupClose()}))}shouldComponentUpdate(e,t){return this.state.search!==t.search||this.state.currentTab!==t.currentTab||this.state.tmpCurrentTab!==t.tmpCurrentTab||this.state.highlightId!==t.highlightId||this.props.user!==e.user||this.state.migrating!==t.migrating&&!1||this.state.notifications.friendListUserIds!==t.notifications.friendListUserIds||this.props.state.conversation.currentId!==e.state.conversation.currentId||this.props.state.conversation.firstFetchDone!==e.state.conversation.firstFetchDone||this.props.state.conversation.conversations!==e.state.conversation.conversations||this.props.state.conversation.toggleDraftSorted!==e.state.conversation.toggleDraftSorted||this.props.state.conversation.groupSuggestions!==e.state.conversation.groupSuggestions||this.state.showStarTooltip!==t.showStarTooltip||this.state.updateDisplayName!==t.updateDisplayName||this.state.arrFileDonwloadDone!==t.arrFileDonwloadDone||this.state.sidebarPopupItems!==t.sidebarPopupItems||this.state.filterTags!==t.filterTags||this.state.currentLabelId!==t.currentLabelId||this.state.filter!==t.filter||this.state.syncMsgFromMobile!==t.syncMsgFromMobile||this.state.friendRequests!==t.friendRequests||this.state.user_mode!==t.user_mode||this.state.showUpdateBtn!==t.showUpdateBtn||this.state.showDownloadUpdateBtn!==t.showDownloadUpdateBtn||this.state.updateInfo.updateType!==t.updateInfo.updateType||this.state.needRefresh!==t.needRefresh||this.state.addFriendSuggestion!==t.addFriendSuggestion||this.state.refreshSuggest!==t.refreshSuggest||this.state.todoUnread!==t.todoUnread||this.state.exportImportFinished!==t.exportImportFinished||this.state.exportImportProgressError!==t.exportImportProgressError||this.props.isShowExportImportProgress!==e.isShowExportImportProgress||this.state.refreshIconHiddenChat!==t.refreshIconHiddenChat||this.state.isAnimHiddenChat!==t.isAnimHiddenChat||this.state.showMsgDetailPopup!==t.showMsgDetailPopup||this.props.msgSrc!==e.msgSrc||this.props.syncDbState!==e.syncDbState||this.props.zaviState!==e.zaviState||this.props.status.privacySettings!==e.status.privacySettings||this.state.leftbarTopStack!==t.leftbarTopStack||this.state.numberMoreTabs!==t.numberMoreTabs||this.state.tmpCurrentTab!==t.tmpCurrentTab||this.props.compactLv!==e.compactLv||this.props.showChat!==e.showChat||this.state.theme!==t.theme||this.state.convUXVer!==t.convUXVer||this.state.filters!==t.filters}componentWillMount(){setTimeout((()=>{this._getFriendRequests()}),2e3),He.a.initData()}_getFriendRequests(){g.default.log("sidebar: _getFriendRequests"),O.default.getFriends(null,!0).then((e=>{if(e){const t=e.filter((e=>e&&!!e.friendRequestType));(t.length>0||this.state.friendRequests>0)&&this.setState({friendRequests:t});const s=O.default.getLastContactListOpenTime(),a=e.filter((e=>e&&!!e.friendRequestType&&e.friendRequestFetchTime>s)).map((e=>e.userId));a.length&&this._handleFriendListNotificationsChange({action:"add",ids:a})}}))}handleResize(){this.adjustLeftBar(),this.myProfile&&this.myProfile.close()}_onFocusFirstItem(){let e=this._conversationList||this._contactList||this._groupList||this._searchResultList;if(e&&e.getRefOfDataListComponent){let t=e.getRefOfDataListComponent();t&&t.focusFirstItem&&t.focusFirstItem()&&e.focusList&&e.focusList()}}_onUpdateDisplayName(e){K.a.updateInfoCache(e),this.setState({updateDisplayName:e,needRefresh:!this.state.needRefresh})}_onUpdateConversationTime(){this.setState({needRefresh:!this.state.needRefresh})}_handleFriendListNotificationsChange(e){if(!e.ids||!e.ids.length)return void("clear"===e.action&&this.setState({notifications:Object(a.a)(Object(a.a)({},this.state.notifications),{},{friendListUserIds:[]})}));let t=this.state.notifications.friendListUserIds;if("remove"===e.action)t=t.filter((t=>-1===e.ids.indexOf(t)));else if("add"===e.action){const s=[];for(let a of e.ids)-1===t.indexOf(a)&&s.push(a);s.length&&(t=t.concat(s))}t.length!==this.state.notifications.friendListUserIds.length&&(g.default.logCoreError("[reddot-check] _handleFriendListNotificationsChange: "+JSON.stringify(e)),this.setState({notifications:Object(a.a)(Object(a.a)({},this.state.notifications),{},{friendListUserIds:t})}))}_onRemoveSearchResult(e,t){if(this.state.search.searchText&&!this.state.search.conversation&&this.state.search.searchResult)if(t){if(this.state.search.searchResult.groups){let t=[...this.state.search.searchResult.groups],s=!1;for(let a=0;a<t.length;a++)if(t[a].userId==e){t.splice(a,1),s=!0;break}s&&this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchResult:Object(a.a)(Object(a.a)({},this.state.search.searchResult),{},{groups:t})})})}}else if(this.state.search.searchResult.friends){let t=[...this.state.search.searchResult.friends],s=!1;for(let a=0;a<t.length;a++)if(t[a].userId==e){t.splice(a,1),s=!0;break}s&&this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchResult:Object(a.a)(Object(a.a)({},this.state.search.searchResult),{},{friends:t})})})}}_showCompose(){I.e.logAction(1020202),At.c.markStart(At.a.CREATE_GROUP,At.b.Group.CREATE_GR_HEADER_ICON),H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.CREATE_GROUP_COMPOSE,params:!0})}_resetCacheResultSearch(){this.curQuery=null,this.cacheResSearch=null,this.trackSearch=!1,this.trackSearchVietnamese=!1}_searchGlobal(e){var t,s,n,i,o,r;let l=2,d=0,u={},_=this.props.state.conversation.conversations,m=g.default.simpleStripVietnamese(e,!1);const p=(t,s,n)=>{let i;if(3!==s&&2!==s&&l--,i=!!(l>1||1==l&&0===s&&0==d),this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchResult:t,searching:i})},n),0===s&&(T(),c.c.tabbedGlobalSearchResult&&Z.b.setMode(Z.a.SEARCHING),c.c.enableFileGlobalSearch&&f()),0==l&&e==this._lastTextSearch){let e=Date.now()-this._lastTextSearchTs;e>2e3?this._upSearchDelay():e<600&&this._downSearchDelay()}},E=()=>!(!this.state.search.searchText||this.state.search.searchText===e),f=()=>{if(c.c.adminConfig&&c.c.adminConfig.offglobalSearchMessage)return setTimeout((()=>{this.state.search&&this.state.search.searchText===e&&p(this.state.search.searchResult,2)}),100);const t=t=>{if(e!=this.state.search.searchText)return;let s=t.map((e=>e.msgId));O.default.getFilesByMsgIds(s.slice(0,20)).then((t=>{if(e!=this.state.search.searchText)return;let n=[],i=0,o=0;for(let e in t)t.hasOwnProperty(e)&&t[e]?(n.push(t[e]),i++):o++;c.c.global_search_v3&&n.sort(((e,t)=>t.sendDttm-e.sendDttm));let r=this.state.search.searchResult;g.default.log("search files: cur = "+r.searchKey+" this query = "+e,n.length),r=r?Object(a.a)({},r):{},r.files=n,r.realFileLen=s.length-o,r.rawFileResult=s,r.lastFileOffset=20,r.searchKey=e,d+=i,p(r,2)})).catch((t=>{g.default.logCoreError("doSearchFiles "+t),this.state.search&&this.state.search.searchText===e&&p(this.state.search.searchResult,2)}))};ot.a.search(e,null,{msgType:h.MSG_FILE},t).then(t)},T=()=>{if(c.c.adminConfig&&c.c.adminConfig.offglobalSearchMessage)return setTimeout((()=>{this.state.search&&this.state.search.searchText===e&&p(this.state.search.searchResult,1)}),100);const t=t=>{if(this.state.search.searchText===e&&t){let s=[],n=0;t&&t.listConv&&t.arr&&(_.forEach((e=>{let s=t.listConv.indexOf(e.userId);if(s>=0&&!g.default.isOAType(e)&&!se.a.isThreadHidden(e.userId))for(let a=s;t.listConv[a]==e.userId&&a<t.listConv.length;++a)t.arr[a].conversation=e,n+=1})),t.arr.forEach((e=>{Object.keys(e.conversation).length>1&&s.push(e)})));let i=this.state.search.searchResult,o=s;t.page&&i.messages&&(o=i.messages.slice(),Array.prototype.push.apply(o,s)),i=i?Object(a.a)({},i):{},i.messages=o,i.searchKey=e,d+=n,p(i,1)}},s=t=>{if(this.pageLoad=0,this.timeouResetDataMsg&&clearTimeout(this.timeouResetDataMsg),this.state.search.searchText===e&&t){let s=[],n=0;t&&t.listConv&&t.arr&&_.forEach((e=>{let a=t.listConv.indexOf(e.userId);if(a>=0&&!se.a.isThreadHidden(e.userId))for(let i=a;i<t.listConv.length;++i)t.listConv[i]==e.userId&&(t.arr[i].conversation=e,n+=1,s.push(t.arr[i]))})),s.sort(((e,t)=>t.message.sendDttm-e.message.sendDttm)),g.default.log("[Global search] check First data",e,s.length);let i=this.state.search.searchResult,o=s;t.page&&i.messages&&(o=i.messages.slice(),Array.prototype.push.apply(o,s)),i=i?Object(a.a)({},i):{},i.messages=o,i.searchKey=e,d+=n,p(i,1)}};if(c.c.global_search_v3){let t=null;this._searchResultList&&(this.timeouResetDataMsg||(this.timeouResetDataMsg=setTimeout((()=>{this.timeouResetDataMsg=!1,this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchResult:Object(a.a)(Object(a.a)({},this.state.search.searchResult),{},{messages:null,files:null})})})}),1e3)),this._searchResultList.resetDataSearch()),ot.a.searchGlobalMessagesV3(e,E,void 0,s,c.c.limit_result_msg_search+1,t).then(s).catch((t=>{if(g.default.logCoreError("searchGlobalMsg "+t),this.state.search&&this.state.search.searchText===e){this._searchResultList&&this._searchResultList.forceStopSearch();let e=this.state.search.searchResult;e.messages=[],p(e,1)}}))}else ot.a.searchGlobalMessagesV2(e,E,_,void 0,t,c.c.limit_result_msg_search+1).then(t).catch((t=>{g.default.logCoreError("searchGlobalMsg "+t),this.state.search&&this.state.search.searchText===e&&p(this.state.search.searchResult,1)}))};if(this.curQuery&&0!==e.indexOf(this.curQuery)&&this._resetCacheResultSearch(),!this.cacheResSearch){const e=e=>{for(const t of e)t&&!u[t.userId]&&(t.infoSearch&&delete t.infoSearch,t.isDirectory&&delete t.isDirectory,u[t.userId]=t)};this.props.state.conversation&&this.props.state.conversation.conversations&&e(this.props.state.conversation.conversations),e(k.default.getFriendsSync()),e(rt.a.getGroupsListSync())}K.a.search(e,this.cacheResSearch?this.cacheResSearch:u,{hasSection:!0,suggestGroupWithMember:!0,searchFriendInGroup:!0,isCalc:!this.cacheResSearch,updateLastChat:!this.cacheResSearch,searchPb:!0,searchZName:!0,searchNumPhone:!0,filterHidden:se.a.isKeyPIN(e)}).then((t=>{let s=this.state.search.searchResult;if(this.state.search.searchText===e){{var n;let i=[];if(se.a.isKeyPIN(e)){I.e.logAction(1970601);const e=se.a.getUidsHiddenChat();if(e.length)for(let t of e){let e=!1;for(let s of this.props.state.conversation.conversations)if(s&&s.userId==t){i.push(Object(a.a)(Object(a.a)({},s),{},{infoSearch:{}})),e=!0;break}if(!e){let e=null;e=t.startsWith(h.GROUPID_PREFIX)?rt.a.getGroupByIdSync(t):k.default.getProfileFriendSync(t),e&&(e.lastMessageTime||(e.lastMessageTime=0),i.push(Object(a.a)(Object(a.a)({},e),{},{infoSearch:{}})))}}}this.curQuery||(this.curQuery=e),!this.cacheResSearch&&t.orderAll&&t.orderAll.constructor==Array&&t.orderAll.length>0&&(this.cacheResSearch={},t.orderAll.forEach((e=>{if(!e)return;let t=e.userId;this.cacheResSearch[t]||(this.cacheResSearch[t]=e)}))),null!==(n=t.phone)&&void 0!==n&&n.length&&(t.phone=t.phone.filter((e=>e.userId))),s=s?Object(a.a)({},s):{},s.recentChat=t.recentChat,s.groups=t.groups,s.friends=t.friends,s.oa=t.oa,s.directory=t.directory,s.searchKey=e,s.phone=t.phone,s.hiddenChat=i,s.all=t.all,s.orderAll=t.orderAll,d+=(s.groups?s.groups.length:0)+(s.friends?s.friends.length:0)+(s.oa?s.oa.length:0),d+=(s.recentChat?s.recentChat.length:0)+s.hiddenChat.length}p(s,0)}})).catch((e=>{g.default.logCoreError(e)})),0==(null===(t=this.state.search.searchResult)||void 0===t||null===(s=t.messages)||void 0===s?void 0:s.length)&&0==(null===(n=this.state.search.searchResult)||void 0===n||null===(i=n.all)||void 0===i?void 0:i.length)&&0==(null===(o=this.state.search.searchResult)||void 0===o||null===(r=o.files)||void 0===r?void 0:r.length)&&I.e.logAction(1232201),m===e||this.trackSearchVietnamese||(this.trackSearchVietnamese=!0,I.e.logAction(1232010))}_checkOnAdminMode(e){let t=this.__checkOnAdminMode(e);t&&(1===t?(this._clearAdminMode&&clearTimeout(this._clearAdminMode),c.c.adminMode=!0,this._clearAdminMode=setTimeout((()=>{this._clearAdminMode=void 0,c.c.adminMode=void 0}),216e5)):2===t&&(this._clearAdminMode&&(clearTimeout(this._clearAdminMode),this._clearAdminMode=void 0),c.c.adminMode=!1))}__checkOnAdminMode(e){if(e&&"string"==typeof e&&e.startsWith("$##")){return e.substring(3)===c.c.zAminKey?1:2}return 0}_onSearchNameChange(e,t=null){this.countQuery=Fr.next();let s=null;s=!e&&t?t:e.target.value,s&&(s=g.default.ZSafeFunction((()=>s.normalize()),s)),this.countTimeUseGlobalSearch||(this.countTimeUseGlobalSearch=Date.now(),this.countSelectTopRes=0),s&&""!=s||this._resetCacheResultSearch(),s?(g.default.log("searching: true"),c.c.stagingAccount&&this._checkOnAdminMode(s),this.trackSearch||(this.trackSearch=!0,I.e.logAction(12318)),this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchText:s,searching:!0}),highlightId:null}),this._lastTextSearch=s,this._lastTextSearchTs=Date.now(),this.functionSearchByName(s,this.countQuery)):(ot.a.abortSearch(),this.state.search.conversation?this._clearSearch(!1):this._clearSearch())}_clearSearch(e=!0,t=!0){if(this._resetCacheResultSearch(),e){if(Z.b.setMode(Z.a.NORMAL),this.setState({search:Object(a.a)({},xr)}),this.state.currentTab==Cr)return void this.functionSearchByName(null,this.countQuery)}else this._searchInput.value="",this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchText:"",searching:!0}),highlightId:null}),this.functionSearchByName("",this.countQuery)}_getConversationFromId(e){let t=this.props.state.conversation.conversations;for(let s=0;s<t.length;s++)if(t[s].userId==e)return t[s];return null}_selectConversationForFriend(e,t=!1){if(!e)return void g.default.logCoreError("friend null");if(this.props.dispatch&&this.props.dispatch({type:p.ConversationListActions.SELECT_CONV_MINOR,payload:e}),e.userId==this.props.user.userId)return void this._showMyProfile();let s=this.props.state.conversation.conversations,n=null,i=!1,o=!0;{for(let t=0;t<s.length;t++)if(s[t].userId==e.userId){n=Object(a.a)({},s[t]),i=!0;break}if(!n){let t=t=>{t&&t.hasOwnProperty(e.userId)&&(n=Object(a.a)({},t[e.userId]))};n||t(this.props.state.conversation.contacts),n||t(this.props.state.conversation.groups),n||(n={}),o=!1,Object.assign(n,e),n.isFr=n.isFr||0,n.type=n.type||h.FRIEND_TYPE_NORMAL,n.smsUnreadCount=n.smsUnreadCount||0}e.byPassPIN?n.byPassPIN=1:n.byPassPIN&&delete n.byPassPIN;let r={highlightId:e.userId,selectedId:e.userId};setTimeout((()=>{this.props.dispatch({type:p.ConversationListActions.SELECT_CONVERSATION,payload:n})}),0),!0===t&&(r.currentTab=i?vr:Rr,r.currentTab===Rr&&(g.default.log("sidebar: select from search, should highlight thread"),this._changeTabFromSearch=!0),this._onCloseSearch()),!0===t&&(r.search=Object(a.a)({},xr),!e.userId||!e.byPassPIN&&se.a.isThreadHidden(e.userId)||setTimeout((()=>{v.default.send(p.ChatBoxActions.FOCUS_INPUT,{userId:e.userId})}),0)),this.setState(r)}e&&e.userId===c.c.sendToMeId&&(wt.f.getFlag(this.props.user.userId,kr)||(Q.default.getHasShownSendToMeTip()?wt.f.setFlag(this.props.user.userId,kr,1):setTimeout((()=>{v.default.send(p.ConversationListActions.SHOW_BUBBLE_DOT),Q.default.setHasShownSendToMeTip(!0)}),144e5)),I.e.logAction(13901))}_selectResult(e,t=!1,s=!1,a=!1){var n;const i=this.state.search.searchText;let o=!!this.state.search.conversation;ka.a.jumpToMessage(e.message,null===(n=e.conversation)||void 0===n?void 0:n.userId,this.props.dispatch).then((s=>{var a;g.default.ZSafeFunction((()=>{if(s)for(let t=0;t<s.length;t++)if(s[t].msgId==e.message.msgId)return void(s[t].searchKeyWord=i)}),null),null!==(a=this.state.search)&&void 0!==a&&a.searchText&&He.a.addCacheKeyword(this.state.search.searchText),this.props.dispatch({type:p.ChatBoxActions.JUMP_TO_MESSAGE_SEARCH,payload:{messages:s,focusId:[""+e.message.msgId],conversation:e.conversation}}),o||!t||c.c.global_search_v3||this.filterByConversation(this.state.search.searchText,e.conversation)})).catch((t=>{g.default.logCoreError(t),R.a.createWarning(T.default.str("STR_MESSAGE_NOT_FOUND")),a||this.props.dispatch({type:p.ChatBoxActions.JUMP_TO_MESSAGE_SEARCH,payload:{messages:[],focusId:[],conversation:e.conversation}})})),o?(s&&this._focusSearchBox(),this.setState({highlightId:e.message.msgId})):t||this.setState({highlightId:e.message.msgId})}updateHighLightId(e){e&&this.setState({highlightId:e})}_onFileSelect(e){var t;null!=e&&e.msgId&&(this.updateHighLightId(e.msgId),null!==(t=this.state.search)&&void 0!==t&&t.searchText&&He.a.addCacheKeyword(this.state.search.searchText))}_clearConvFilter(){if(this.state.search.conversation){g.default.log("sidebar: clear conv filter");let e=Object(a.a)(Object(a.a)({},this.state.search),{},{conversation:null});this.setState({search:e,highlightId:null}),this.state.search.searchText&&this._searchGlobal(this.state.search.searchText)}}_loadMoreMessages(){this.state.search.searchResult}_loadMessagesV2(e,t=!1,s){let n=this.state.search.searchResult,i=null;if(this.state.search.searchText&&(i=this.state.search.searchText,n&&n.messages&&!this._loadingMore)){this._loadingMore=!0;const o=e=>{let o=[];if(this._loadingMore=!1,i===this.state.search.searchText){if(e&&e.listConv&&e.arr){this.props.recentContact.forEach((t=>{let s=e.listConv.indexOf(t.userId);if(s>=0&&!se.a.isThreadHidden(t.userId))for(let a=s;a<e.listConv.length;++a)e.listConv[a]==t.userId&&(e.arr[a].conversation=t)})),e.arr.forEach((e=>{Object.keys(e.conversation).length>1&&o.push(e)}));let i=[...o];i.length&&this.pageLoad++,t&&(o=n.messages.concat(o)),this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchResult:Object(a.a)(Object(a.a)({},this.state.search.searchResult),{},{messages:o}),searching:!1})},(()=>{s&&s(i,this.pageLoad)}))}}else this.pageLoad++};ot.a.searchGlobalMessagesV3(i,false,void 0,o,c.c.limit_result_msg_search+1,e).then().catch((e=>{this._loadingMore=!1,g.default.logCoreError("searchGlobalMsg v2 "+e)}))}}_loadMoreFiles(){let e=this.state.search.searchResult;e&&e.rawFileResult&&e.files&&e.rawFileResult.length>e.lastFileOffset&&!this._loadingMoreFiles&&(this._loadingMoreFiles=!0,O.default.getFilesByMsgIds(e.rawFileResult.slice(e.lastFileOffset,e.lastFileOffset+20)).then((t=>{this._loadingMoreFiles=!1;let s=[];for(let e in t)t.hasOwnProperty(e)&&t[e]&&s.push(t[e]);let n=g.default.ZSafeFunction((()=>Math.max(0,e.rawFileResult.length-e.lastFileOffset-20)+e.files.length+s.length),e.realFileLen),i=this.state.search.searchResult.files.concat(s);c.c.global_search_v3&&i.sort(((e,t)=>t.sendDttm-e.sendDttm)),this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{searchResult:Object(a.a)(Object(a.a)({},this.state.search.searchResult),{},{files:i,realFileLen:n,lastFileOffset:e.lastFileOffset+20})})})})).catch((e=>{this._loadingMoreFiles=!1,g.default.logCoreError("_loadMoreFiles ",e)})))}filterFiles(e){v.default.send(p.SideBarActions.SEARCH_FILE,{term:e})}filterByConversation(e,t){if(e){let s=(s,n=!1)=>{this.state.search.searchText==e?(!n||s&&0!=s.length)&&ot.a.getMessageOfConversation(s,t.userId,20).then((i=>{if(this.state.search.searchText!=e)return void g.default.logCoreError("search: abort filtermode 2",this.state.search.searchText,e);let o=i.list;if(n&&(!o||0===o.length))return;let r=o.length<20&&s.length>20;o.length>0?(this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{conversation:t,searchResult:{messageList:o.map((e=>({message:e,conversation:t}))),realLen:i.len,rawSearchResult:s,lastOffset:20,progress:n},searching:!1}),highlightId:o[0].msgId},(()=>{n||(this._focusSearchBox(),r&&this._loadMoreMessages())})),!n&&this._searchResultList&&this._searchResultList.scrollToTop&&this._searchResultList.scrollToTop()):this.setState({search:Object(a.a)(Object(a.a)({},this.state.search),{},{conversation:t,searchResult:{messageList:[],realLen:0,lastOffset:0,progress:!1},searching:!1,highlightId:null})},(()=>{this._focusSearchBox(),!n&&r&&this._loadMoreMessages()}))})):g.default.logCoreError("search: abort filtermode 1",this.state.search.searchText,e)};ot.a.search(e,null,{convId:t.userId+""},(e=>{s(e,!0)})).then((e=>{s(e)}))}else this.setState({search:Object(a.a)(Object(a.a)({},xr),{},{conversation:t,searching:!1,highlightId:null})})}_onKeyPressInput(e){if(this.selectAllSearchText&&c.c.global_search_v3&&this._searchResultList&&this._searchResultList.openTabAll(),e.which==h.K_BACK_SPACE&&this.state.search&&this.state.search.searchText&&""!==this.state.search.searchText&&I.e.logAction(12307),e.which==h.K_ESC)!0===this.isShowRecentSearch&&(this.isFocusOnRecentSearch=!1,this.isFocusSearchBox=!1,this._searchInput&&this._searchInput.blur(),this._onCloseSearch()),""!=this._searchInput.value&&this.state.search.conversation?this._clearSearch(!1):this._clearSearch(!0),this._conversationList&&this._conversationList.pressEsc&&this._conversationList.pressEsc();else if(e.which==h.K_ENTER){let e=this._conversationList||this._contactList||this._groupList||this._searchResultList||this._recentSearchList;if(e){let t=e.selectFocusedConversation(!0);setTimeout((()=>{this.state.search.conversation?this._focusSearchBox():se.a.isThreadHidden(t)||v.default.send(p.ChatBoxActions.FOCUS_INPUT,{userId:t})}),0)}}else if(e.which==h.K_UP||e.which==h.K_DOWN){this._searchResultList&&I.e.logAction(12317);let t=this._conversationList||this._contactList||this._groupList||this._searchResultList||this._recentSearchList;t&&(e.stopPropagation(),e.preventDefault(),e.which==h.K_UP?t.moveUp():t.moveDown())}}_selectTabOnMessageSent(){this.state.currentTab!=Lr&&(this.state.currentTab!==vr||this.state.search&&this.state.search.searchText?(this.setState({currentTab:vr,selectedId:g.default.ZSafeFunction((()=>this.props.state.conversation.currentId),null)},(()=>{this._scrollToTop(),this.props.dispatch({type:p.SideBarActions.SHOW_CHAT_VIEW})})),this.state.search&&this.state.search.searchText&&I.e.logAction(1232007),this._clearSearch()):this.state.currentTab==vr&&this._scrollToTop())}clearAllSelection(){var e=window.getSelection();e&&(e.removeAllRanges(),g.default.log("clear all selection"))}isFireFox(){return null!=this.isFireFoxBrowser?this.isFireFoxBrowser:navigator.userAgent.search("Firefox")>-1}_selectTab(e,t=null){switch(Q.default.setZaloTab(e),Q.default.resetGlobalSearchMode(),e){case vr:I.e.logAction(12801);break;case Rr:I.e.logAction(12802),3===c.c.noti_center_config.entry_position&&I.e.logAction(1281205);break;case br:I.e.logAction(12805);break;case Ar:I.e.logAction(12806);break;case Cr:I.e.logAction(133);break;case Or:case"mp3":case yr:break;case Dr:3===c.c.noti_center_config.entry_position&&I.e.logAction(1281206);break;case Mr:I.e.logAction(20701)}if(this.props.onChangeTab&&this.props.onChangeTab(e),e===vr||this.lastHadFilter||this.state.filter===h.CONV_FILTER.ALL&&g.default.isEmptyObject(this.state.filters)||(this.lastHadFilter=!0),this.state.currentTab!==e||this.state.search&&this.state.search.searchText&&""!=this.state.search.searchText){this.isFocusOnRecentSearch=!1;let s=this.props.state.conversation.currentId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER?-1:g.default.ZSafeFunction((()=>this.props.state.conversation.currentId),null);if(this.setState({currentTab:e,selectedId:s,showStarTooltip:!!this.state.showStarTooltip&&!(e===Ar),currentLabelId:sa,filter:h.CONV_FILTER.ALL,search:xr,filters:{}},(()=>{var e;t&&t(),null!==(e=this.tabRef)&&void 0!==e&&e.current&&this.tabRef.current.focus(0)})),this.state.search&&this.state.search.searchText&&""!=this.state.search.searchText&&(this._clearSearch(),this._onCloseSearch()),this.isFireFox()&&(this.needClearSelection=!0),e===vr&&(setTimeout((()=>{this._conversationList&&this._conversationList.viewGroup("",null)}),0),this.props.compactLv!==h.COMPACT_LEVEL.COMPACT)){let t=N.a.getOldTab();if(t&&void 0!==t[e]){se.a.setIdChatBoxViewCurrent(t[e].userId);let s=this._getConversationFromId(t[e].userId);s&&!se.a.isThreadHidden(s.userId)&&this._selectConversationForFriend(s)}else this.props.dispatch({type:p.ChatBoxActions.NO_CONVERSATION})}}else this.state.currentTab==e&&e==vr&&this._conversationList&&this._conversationList.pressEsc&&this._conversationList.pressEsc(),this._conversationList&&this._conversationList.viewGroup("",null),this.setState({currentLabelId:sa,filter:h.CONV_FILTER.ALL,filters:{},search:xr},(()=>{this.tabRef&&this.tabRef.current&&this.tabRef.current.focus(0)}));e===Or?0===In.a.linkOpen().length?g.default.logCoreError("Link open zaloshop empty"):this.props.dispatch({type:p.SideBarActions.SHOW_ZALO_SHOP,payload:{linkOpen:In.a.linkOpen(),parentOrigin:In.a.linkOpen()}}):e==Lr?this.props.dispatch({type:p.SideBarActions.SHOW_CATALOG_VIEW}):e===Rr?this.props.compactLv&&(this.needTopOpenSuggest=!0):e===Mr?this.props.dispatch({type:p.SideBarActions.SELECT_ZAVI}):this.state.currentTab===e&&e===Dr?this.todoView&&this.todoView.showList():this.props.dispatch({type:p.SideBarActions.SHOW_CHAT_VIEW}),lt.a.isVisible({windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_MOREMENU})&&lt.a.closePopover({windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_MOREMENU}),lt.a.isVisible({windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_TOOLSMENU})&&lt.a.closePopover({windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_TOOLSMENU})}_onSelectTabMessage(e,t){this._selectTab(vr),1===c.c.noti_center_config.entry_position&&(e||t?I.e.logAction(1281004):I.e.logAction(1281005)),this.state.filter===h.CONV_FILTER.ALL&&g.default.isEmptyObject(this.state.filters)&&!this.lastHadFilter||I.e.logAction(1453213),this.lastHadFilter&&delete this.lastHadFilter}_onSelectTabTodo(){this._selectTab(Dr),I.e.logAction(171),wn.i.setViewPopupTodoSrc(wn.d.TAB_ICON)}_scrollToTop(){let e=this._conversationList||this._contactList||this._groupList;e&&e.scrollToTop()}_onDoubleClickTabHeader(){let e=this._conversationList||this._contactList||this._groupList;e&&e.scrollToTop()}setUnreadBadge(e){!0===Q.default.getDidLogOut()&&(e=0),g.default.log("badge:",e);let t=h.USER_MODE.AVAILABLE;1===c.c.enable_busy_mode&&(t=this.state.user_mode),ss.a.setCount(e,t)}_clickCloseSearch(){Q.default.resetGlobalSearchMode(),this.state.search.conversation&&I.e.logAction(12314),this._resetCacheResultSearch(),this._clearSearch(!this.state.search.conversation),this._focusSearchBox(),I.e.logAction(1232006)}_focusAndSelectAllInputSearch(){this._focusSearchBox(!0)}_clickIconSearch(){I.e.logAction(1970606),se.a.setStateShowUnreadHiddenChat(!1),this._focusSearchBox()}_focusSearchBox(e=!1){this._searchInput&&(this._searchInput.focus(),e&&setTimeout((()=>{this._searchInput.select()}),0))}_focusInSearchBoxEvent(){this._searchInput&&""!==this._searchInput.value&&this._searchInput.select(),this.isFocusSearchBox=!0,this.setState({needRefresh:!this.state.needRefresh}),I.e.logAction(1232001),this.wasLogFocusSearch||(this.wasLogFocusSearch=!0,I.e.logAction(1232002))}_qosLogSearch(){this.countTimeUseGlobalSearch&&(tr.a.increaseSuccess(97111,0,Date.now()-this.countTimeUseGlobalSearch),this.countTimeUseGlobalSearch=0),c.c.global_search_v3&&this.countSelectTopRes>=0&&(tr.a.increaseSuccess(97112,0,this.countSelectTopRes),this.countSelectTopRes=-1)}_blurOutSearchBoxEvent(e){setTimeout((()=>{this.isFocusSearchBox=!1,this._searchInput&&""==this._searchInput.value&&this._qosLogSearch(),this.setState({needRefresh:!this.state.needRefresh})}),20)}_onKeyDownComposeBtn(e){if(e.keyCode==h.K_ENTER){if(e.ctrlKey||e.metaKey||e.altKey)return!0;this._showCompose()}}_renderUnreadV3({totalUnread:e,color:t="red",size:s=-1,unreadMark:a}){if(!e&&!a)return null;let n="";return"N"===e?n=`N leftbar-unread unread-${t}`:!isNaN(e)&&e?(n=e<=5?`${e}`:"5plus",n+=` leftbar-unread unread-${t}`+(e<=5?"":" many")):a&&(n=" leftbar-mark-unread"),o.a.createElement(D.a,{className:"num"+n,style:s>0?{fontSize:"7px",height:s+"px",width:e?null:s+"px",minWidth:s+"px"}:null})}_onMenuClicked(e){I.e.logAction(12807),this.myProfile&&this.myProfile.show(e,this.tabRefs.setting)}_getSearchTextPlaceholder(){let e=null;return e=this.state.currentTab==Cr?"STR_SEARCH_FILES":this.state.search.conversation?"STR_SEARCH_MESSAGES":"STR_SEARCH",o.a.createElement(E.a,{className:"flx-al-c fake-textholder truncate"+(this.state.search.searchText?" hide":"")+" fk-normal",textKey:e,style:{display:"flex",height:"90%"}})}_recommendPC(){H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.SCREENCAP,params:2})}_removeSidebarPopupItem(e){this.setState({sidebarPopupItems:this.state.sidebarPopupItems.filter((t=>t!==e))})}_findFriend(){I.e.logAction(1020203),I.e.logAction(12316),H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.FIND_FRIEND})}_addConversation(e,t){let s=b.b.getItem(t);e&&H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.MANAGE_LABEL,params:{view:Vs.b.ADD_CONVERSATION,info:s}})}_onFilterTagsItemClicked(e,t=!1){if(!0===t)return;let s="";e&&(s="label"),this._conversationList&&this._conversationList.viewGroup(s,e);let a={};if(e&&(a[e.id]=e),this.setState({currentLabelId:e?e.id:sa,filter:h.CONV_FILTER.ALL,filters:a}),e){let t="";t=e.textKey?T.default.str(e.textKey):e.text,t&&t.length>0&&I.e.logLabel(14524,t),I.e.logAction(14530);(()=>{let{filterTags:e}=this.state,t=!1;e.forEach((e=>{e&&e.conversations&&e.conversations.length>0&&(t=!0)})),t||b.b.getLabelIntroState()||(H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.LABEL_INTRO,params:!0}),b.b.setLabelIntroState())})()}O.default.setLastUsedLabelTime()}_onFilterTagsItemClickedv3(e,t=!0){const s=()=>{this._conversationList&&this._conversationList.viewGroup(this.state.filter,this.state.filters)};if(!e)return void this.setState({filters:{}},s);let{id:n}=e||{};e.constructor!==Object&&(n=e);let i={};t&&(i=Object(a.a)({},this.state.filters)),i.hasOwnProperty(n)?delete i[n]:i[n]=e,this.setState({filters:i},s)}_onFilterTagsItemsClickedv3(e){if(!e)return;let t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);this.setState({filters:t},(()=>{this._conversationList&&this._conversationList.viewGroup(this.state.filter,this.state.filters)}))}_onAllFilterClicked(){this._onGeneralFilerClicked(h.CONV_FILTER.ALL),O.default.setLastUsedLabelTime(),3===this.state.convUXVer&&I.e.logAction(1453101)}_onUnreadFilterClicked(){this._onGeneralFilerClicked(h.CONV_FILTER.UNREAD),I.e.logAction(14509)}_onChangeFilterTabs(e){if(gr.a.onChangeTab(e),0===e)this._onAllFilterClicked();else if(1===e&&(this._onUnreadFilterClicked(),!g.default.isEmptyObject(this.state.filters))){Object.values(this.state.filters).length>1?I.e.logAction(1453215):I.e.logAction(1453214)}}_onGeneralFilerClicked(e){let t=O.default.getConvUXVersion(),s={filter:e},n=Object(a.a)({},this.state.filters);if(2===t){for(let e in n)if(n.hasOwnProperty(e)){parseInt(e)<0&&delete n[e]}s=Object(a.a)(Object(a.a)({},s),{},{filters:n})}this.setState(s,(()=>{this._conversationList&&this._conversationList.viewGroup(this.state.filter,this.state.filters)}))}_updateLabelId(e){e&&this.setState({currentLabelId:e.id})}_onStrangerClicked(){const e=()=>{this._onFilterTagsItemClickedv3(aa)};2===O.default.getConvUXVersion()?this.setState({filter:h.CONV_FILTER.ALL},e):e(),I.e.logAction(14510)}_onLabelManagerClicked(e){this.refs.popover2&&this.refs.popover2.close(),H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.MANAGE_LABEL,params:!0}),O.default.setLastUsedLabelTime(),e&&(e.preventDefault(),e.stopPropagation()),I.e.logAction(14524)}_onMarkAsRead(e,t=null,s=!1){e&&(e.preventDefault(),e.stopPropagation()),this.refs.popover2&&this.refs.popover2.close(),I.e.logAction(164);let a=O.default.isShowMarkAsReadAgain();const n=()=>{let e=[],s=g.default.isEmptyObject(this.state.filters);for(let a=0;a<this.props.state.conversation.conversations.length;a++){let n=this.props.state.conversation.conversations[a];if(n&&(n.smsUnreadCount>0||n.unreadMark)){if(t&&!t.hasOwnProperty(n.userId)||n.userId===h.FAKE_CONVERSATION_ID.FRIEND_CENTER)continue;let a=b.b.getLabelObjByConversaionId(n.userId)||{};(s||this.state.filters.hasOwnProperty(a.id)||g.default.isInStrangerBox(n)&&this.state.filters.hasOwnProperty(aa))&&e.push(n)}}e.length>0&&(this.props.dispatch({type:p.SideBarActions.MARK_AS_READ,payload:{conversations:e}}),I.e.logAction(1453304))};!0===a?P.a.openConfirm({windowId:Hr,name:h.MODAL_CONFIRM.confirmIdentities,params:{message:T.default.str("STR_MARK_READ_CONFIRM_TEXT"),okText:T.default.str("STR_CONFIRM"),okType:"primary",cancelText:T.default.str("STR_LOGOUT_NO"),onOk:e=>{O.default.setShowMarkAsReadAgain(!(e&&e.dont_show_mark_as_read)),n()},options:[{default_val:!1,key:"dont_show_mark_as_read",title:"STR_DONT_SHOW_AGAIN"}]}}):n()}_onBackMessageFullList(){this.setState({currentLabelId:sa,filter:h.CONV_FILTER.ALL}),this.filterScroll&&this.filterScroll.scrollTop(0)}_onEditLabel(e,t){e&&(e.preventDefault(),e.stopPropagation(),O.default.setLastUsedLabelTime(),H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.MANAGE_LABEL,params:{view:Vs.b.EDIT,info:t}}))}onShowListExtLabel(e){this.filterMenu&&this.filterMenu.show(e),e.preventDefault(),e.stopPropagation()}onShowMsgSrc(e){this.msgSrcRef&&this.msgSrcRef.show(e),e.preventDefault(),e.stopPropagation()}onShowListManagerLabel(e){this.refs.popover2&&this.refs.popover2.showAction(),e.preventDefault(),e.stopPropagation()}onExtLabelClicked(e){e&&(e.preventDefault(),e.stopPropagation())}_handleFailure(e){g.default.logCoreError(e),e&&e.error_message&&R.a.createError(e.error_message)}_handleFailureFriendRq(e){if(g.default.logCoreError(e),e&&e.error_message){let t=e.error_message;[224,251].includes(e.error_code)&&(t=T.default.trans(`STR_FRIEND_REQUEST_FAIL_${e.error_code}`,c.c.limitFriends)),R.a.createMessage(t,3e3)}}_acceptFriendRequest(e,t){const s=this.state.friendRequests.filter((t=>t.userId===e));if(!s.length)return void je.a.acceptAddFriend(e);let n;const i=s[0];if(null!=i&&this.setState({newFriends:i}),i.friendRequestType===h.FRIEND_REQUEST_TYPE_SUGGEST){if(i.requested)return this._selectConversationForFriend(i),n=this.state.currentTab===Rr?104097:103097,void(t||I.e.logAction(n));const s=T.default.trans("STR_MSG_DEFAULT_REQ_ADD_FR",this.props.user.zaloName);je.a.requestAddFriend(e,s,i.friendRequestSource).then((()=>{R.a.createSuccess(T.default.str("STR_REQ_FR_SUCCESS")),O.default.removeFriend(e);const t=this.state.friendRequests.slice(),s=t.indexOf(i);t[s]=Object(a.a)(Object(a.a)({},i),{},{requested:!0}),v.default.send(p.SideBarActions.SENT_FRIEND_REQUEST,e),this.setState({friendRequests:t}),this._handleFriendListNotificationsChange({action:"remove",ids:[e]}),this.props.dispatch({type:p.ConversationListActions.FRIEND_CENTER_CHANGE,payload:{data:e,act:"remove_request"}})})).catch(this._handleFailureFriendRq),n=this.state.currentTab===Rr?104096:103096}else je.a.acceptAddFriend(e).then((()=>{const t=this.state.friendRequests.filter((e=>e!==i));this.setState({friendRequests:t}),this._handleFriendListNotificationsChange({action:"remove",ids:[e]}),this.props.dispatch({type:p.ConversationListActions.FRIEND_CENTER_CHANGE,payload:{data:e,act:"remove_request"}}),S.a.getUser(e).then((t=>{this.props.dispatch({type:p.FetchActions.FRIENDS_FETCHED,payload:{[e]:Object(a.a)(Object(a.a)({},g.default.reformatConversationFromFriend(t)),{},{isFr:1})}})}))})).catch(this._handleFailureFriendRq),n=this.state.currentTab===Rr?104095:103095;!t&&n&&I.e.logAction(n)}_showUserInfo(e,t){je.a.setFriendRequestSource(e,h.FRIEND_REQUEST_SRC_CONTACT_LIST_SUGGESTION),Q.default.setSelectConversationSource(178012),H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.FRIEND_PROFILE,params:e});const s=this.state.friendRequests.filter((t=>t.userId===e))[0];s&&!s.friendRequestRead&&(s.friendRequestRead=!0,O.default.addFriends([s]),this._handleFriendListNotificationsChange({action:"remove",ids:[s.userId]})),t||(this.state.currentTab===Rr?I.e.logAction(104093):I.e.logAction(103093))}_rejectFriendRequest(e,t){const s=()=>{O.default.removeFriend(e),R.a.createSuccess(T.default.str("STR_TOAST_REJECT_REQUEST"))},a=this.state.friendRequests.filter((t=>t.userId===e))[0];a&&a.friendRequestSrc?B.default.removeRecommendedFriend(e,a.friendRequestSrc).then(s).catch(this._handleFailure):je.a.rejectRequestAddFriend(e).then(s).catch(this._handleFailure);const n=this.state.friendRequests.filter((t=>t.userId!==e));this.setState({friendRequests:n}),this._handleFriendListNotificationsChange({action:"remove",ids:[e]});let i={data:e,act:"remove_request"};this.props.rejectRequest&&this.props.rejectRequest(i),t||(this.state.currentTab===Rr?I.e.logAction(104094):I.e.logAction(103094))}clickedZaloShopTab(){I.e.logAction(1063104),In.a.setLinkOpen(In.a.getLinkZaloShop()),0!==In.a.linkOpen().length?this._selectTab(Or):g.default.error("Link open zaloshop empty")}_clickNotifyTab(e){io.b.setNotiChildTab(e),this._selectTab(Nr)}onUpdateTitle(e,t=!1){if(t)switch(e){case h.CONV_FILTER.STRANGER:this.setState({currentLabelId:aa,filter:h.CONV_FILTER.ALL})}else this.setState({filter:e})}onCloseUserStatus(){this.userStatusRef&&this.userStatusRef.close()}onUpdateUserModeIfNeed(e){this.state.user_mode!==e&&1===c.c.enable_busy_mode&&this.setState({user_mode:g.default.verifyUserMode(e)})}showPopupErrorPinConv(e){if(!this.props.state.conversation)return;let t=this.props.state.conversation,s=[],n=e=>{if((e=>(e+="").startsWith("g"))(e)){if(t.groups&&t.groups.constructor==Object&&t.groups.hasOwnProperty(e)&&t.groups[e])return Object(a.a)({},t.groups[e])}else if(t.contacts&&t.contacts.constructor==Object&&t.contacts.hasOwnProperty(e)&&t.contacts[e])return Object(a.a)({},t.contacts[e]);return null},i=n(e);if(!i)return;let o=cs.a.getListPinnedConversation();if(o.length>0)for(let a=0;a<o.length;++a){let e=n(o[a]);e&&s.push(e)}this.props.showPopupPinnedConvs&&this.props.showPopupPinnedConvs({newItem:i,listPinned:s})}onSidebarCapture(){I.e.logAction(12808),this.props.dispatch&&this.props.dispatch({type:p.ChatBoxActions.SIDEBAR_CAPTURE}),2===c.c.noti_center_config.entry_position&&I.e.logAction(1281104)}renderSuggestBroadcast(e,t){return e&&e.id&&t[e.id]?o.a.createElement("span",{className:"broadcast-tag-tip"}):null}_addFriend(e,t,s=null){let a=s||this.dataContact;if(!a||e)return;const n=a.userId||a.uid;g.default.userIdIsValid(n)&&(S.a.doAddFriend(n,null,this.props.dispatch).then((e=>{this.setState({addFriendSuggestion:!0}),fn.a.deleteCachedProfileByPhone(a.phone||a.phoneNumber),fn.a.stopTimeout(),setTimeout((()=>{this._closeSuggestContact(),this.setState({addFriendSuggestion:!1})}),3e3)})).catch((e=>{this._closeSuggestContact()})),t&&(t.stopPropagation(),t.preventDefault()))}_shareContact(){if(!this.dataContact)return;let e={message:{action:"recommened.user",params:this.dataContact.userId||this.dataContact.uid,thumb:this.dataContact.avatar,title:this.dataContact.dName||this.dataContact.display_name,phone:this.dataContact.phone||this.dataContact.phoneNumber},msgType:h.MSG_CONTACT};fn.a.stopTimeout(),fn.a.startTimeout(),this.props.shareMessage([e],null,(e=>{this._closeSuggestContact()}),h.SHARE_FROM_MESSAGE)}_rejectRequest(){this.state.addFriendSuggestion||(this.props.dispatch({type:p.SideBarActions.REJECT_FRIENDS,payload:this.dataContact.userId||this.dataContact.uid}),this._closeSuggestContact())}_enterFriendRequest(){this.state.addFriendSuggestion||je.a.acceptAddFriend(this.dataContact.userId||this.dataContact.uid).then((()=>{fn.a.deleteCachedProfileByPhone(this.dataContact.phone||this.dataContact.phoneNumber),R.a.createSuccess(T.default.str("STR_ADD_FRIEND_SUCCESSFULLY")),this._closeSuggestContact()})).catch((e=>{g.default.logCoreError("_enterFriendRequest error:",e),e&&e.error_message&&R.a.createError(e.error_message)}))}_onChat(e){S.a.doSendMessage(this.dataContact.userId||this.dataContact.uid,this.props.dispatch).then((e=>{})).catch((e=>{})),e&&(e.stopPropagation(),e.preventDefault()),this._closeSuggestContact()}_closeSuggestContact(){this.dataContact=null,fn.a.removeDataCache(),this.setState({refreshSuggest:!this.state.refreshSuggest})}getCurrentTab(){return this.state.currentTab}updateTodoUnread(){let e=wn.i.getUnreadTodoCount();if(e>0){let t=wn.i.getNewItem();if(e=0,t)for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];if(a&&a.constructor===Object&&!g.default.isEmptyObject(a)){e=1;break}}}else e=0;this.setState({todoUnread:e})}_openTodoSumaryv2(e){e&&(wn.i.setSummaryTodoInitInfo(e),this.todoView?this.todoView.showTodoSumaryV2(e):this._selectTab(Dr))}_onOpenTodoRemindSummary(e){e&&(this.todoView?this.todoView.showRemindSummary(e):(wn.i.setRemindSummary(e),this._selectTab(Dr)))}onTodoTipClicked(e){if(e&&e.constructor===String){let t=e.split(".");if(t&&t.length>=2)if("tab"===t[1]){if(t.length>=3){let e=t[2];wn.i.setViewTodoIdCache(null),wn.i.setViewTodoTabCache(e),this.todoView?this.todoView.onCheckOpenTab():this._selectTab(Dr)}}else if("remindTab"===t[1]){if(t.length>3){let e=t[2],s=t[3];this.todoView?this.todoView.onCheckOpenRemindTab({eType:e,num:s}):(this._selectTab(Dr),this.todoView&&this.todoView.onCheckOpenRemindTab({eType:e,num:s}))}}else{let e=t[1];wn.i.setViewTodoIdCache(e),this.todoView?this.todoView.onCheckOpenTab():this._selectTab(Dr)}}}setRecentSearchFocusState(e,t=!1){this.isFocusOnRecentSearch!==e&&(this.isFocusOnRecentSearch=e,!this.isFocusSearchBox&&t||this.setState({needRefresh:!this.state.needRefresh}))}getRecentSeacrchItems(){if(0===c.c.recent_search.is_enable)return[];let e=He.a.getLocalRecentSearchList();if(e){let t=rt.a.getGroupsListSync(),s=t||[];e=e.filter((e=>{if(e&&e.userId&&!se.a.isThreadHidden(e.userId)){if(e.userId.startsWith(h.GROUPID_PREFIX)||1===e.type){let t=!1;1!==e.type||e.userId.startsWith(h.GROUPID_PREFIX)||(e.userId=h.GROUPID_PREFIX+e.userId);for(let a of s)if(a.userId&&e.userId==a.userId){t=!0;break}return!!t||(He.a.removeLocalRecentSearchList(e.userId),!1)}return!0}return!1}))}return e}getRecentKeyword(){return He.a.getLocalKeywordList()}onOpenFileTransfer(){let e=c.c.sendToMeId;e&&(N.a.setOldTab({name:"message",userId:e}),this.setState({currentTab:vr},(()=>{S.a.gotoConversation(e,this.props.dispatch,!0)}))),I.e.logAction(12817)}verifyLeftbar(){let e=window.innerHeight-100-6-250-0,t=4;for(let s=0;s<4;s++)if(e>240-60*s){t=s+(s>0?1:0);break}this.setState({leftbarTopStack:t,tmpCurrentTab:""})}adjustLeftBar(){var e;const t=document.querySelector(".nav__tabs__top"),s=document.querySelector(".nav__tabs__bottom"),a=null==t||null===(e=t.firstElementChild)||void 0===e?void 0:e.getBoundingClientRect().height;if(!t||!s||!a)return void(this.verifyLeftbar&&this.verifyLeftbar());const{bottom:n}=t.getBoundingClientRect(),{top:i}=s.getBoundingClientRect();if(i-n<70){const e=Math.ceil((70-i+n)/a);let t=this.state.numberMoreTabs+e>=2?2:this.state.numberMoreTabs+e;t=t>=2?t:0,this.setState({numberMoreTabs:t,tmpCurrentTab:""})}if(i-n>70+a){const e=Math.ceil((i-n-70)/a);let t=this.state.numberMoreTabs-e<0?0:this.state.numberMoreTabs-e;t=t>=2?t:0,this.setState({numberMoreTabs:t,tmpCurrentTab:""})}}renderTab(e){if(!e)return null;let{icon:t,titleKey:s,tabValue:a,onClick:n,id:i,onDoubleClick:r=null,otherChildren:l=null,unreadCount:c=0,unreadColor:d="red",unreadMark:h=0}=e,u=this.state.currentTab===a||this.state.tmpCurrentTab===a,_=null;if(u||a!=wr||this.state.currentTab!=Ar&&this.state.currentTab!=Lr||(u=!0),t){let e="",s="";t.constructor===Object?(s=t.active,e=t.normal):t.constructor===String&&(e=t),_=o.a.createElement(D.a,{className:(u&&s||e)+" internal-icon"})}this.tabRefs||(this.tabRefs={});let m=o.a.createElement(E.a,{className:"lb-tab-title truncate",tagName:"div",textKey:s});return o.a.createElement(f.a,{tagName:"div",textKey:s,key:`tab-${a}`,className:"clickable leftbar-tab flx flx-col flx-al-c flx-center rel"+(u?" selected":""),onClick:n,onDoubleClick:r,refer:e=>this.tabRefs[a]=e,id:i,"data-id":e["data-id"]},_,m,this._renderUnreadV3({totalUnread:c,color:d,unreadMark:h}),l,e.showReddot?o.a.createElement("i",{className:"fa fa-red_dot",style:{position:"absolute",color:"var(--red-300)",fontSize:"4px",zIndex:1,top:"13px",right:"10px"}}):null,e.showBetaMark?o.a.createElement("div",{className:"beta-mark",style:{position:"absolute",fontSize:"7px",padding:" 0 2px",top:"3px",right:"4px"}},"BETA"):null)}renderShortcut(e){return this.renderTab(e)}onShowMorePopup(e){lt.a.openPopover({windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_MOREMENU,anchorEvent:e}),this.setState({tmpCurrentTab:Sr})}onShowToolsPopup(e){lt.a.openPopover({windowId:Hr,name:h.PopoverIdentitiesDefine.LEFTBAR_TOOLSMENU,anchorEvent:e}),this.setState({tmpCurrentTab:wr}),1==Qt.b.checkShowReddotSidebar()&&Qt.b.setShowReddotSidebar(2)}onToolsPopupClose(){this.setState({tmpCurrentTab:""})}closeMorePopup(){lt.a.closePopover(Object(a.a)({},Br))}onMorePopupClose(){this.setState({tmpCurrentTab:""})}_onDeleteLabel(e,t){P.a.openConfirm({windowId:Hr,name:h.MODAL_CONFIRM.confirmIdentities,params:{title:T.default.str("STR_LABEL_REMOVE_CONFIRM_TITLE"),message:T.default.trans("STR_LABEL_REMOVE_CONFIRM_CONTENT",[t.text?t.text:T.default.str(t.textKey)]),okText:T.default.str("STR_ACCEPT"),cancelText:T.default.str("STR_CANCEL"),onOk:()=>{b.b.remove([t]).then((()=>{v.default.send(p.PopupActions.UPDATE_LABELS,{remove:[t]})})),I.e.logAction(14515)},onCancel:()=>{I.e.logAction(14514)}}}),e&&(e.preventDefault(),e.stopPropagation()),I.e.logAction(14512)}onChangeTheme(e){this.setState({theme:e})}_onSelectionSearchChange(){if(this._searchInput){let e=this._searchInput.selectionStart,t=this._searchInput.selectionEnd;this._searchInput.value.length&&0==e&&t==this._searchInput.value.length?this.selectAllSearchText=!0:this.selectAllSearchText=!1}}_onCloseSearch(){var e,t;I.e.logAction(1232004),0==(null===(e=this.state.search.searchResult)||void 0===e||null===(t=e.messages)||void 0===t?void 0:t.length)&&I.e.logAction(1232202),this._qosLogSearch()}selectTopRes(){this.countSelectTopRes>=0&&this.countSelectTopRes++}onShowActionMenu(e){this.convActionMenu&&this.convActionMenu.show(e)}onTryNewUIVersion(e){this.setState({filter:h.CONV_FILTER.ALL,filters:{},convUXVer:3},(()=>{O.default.setConvUXVersion(this.state.convUXVer),this._conversationList&&this._conversationList.viewGroup(this.state.filter,this.state.filters)})),I.e.logAction(1453401)}onBackOldUIVersion(e){this.setState({filter:h.CONV_FILTER.ALL,filters:{},convUXVer:2},(()=>{O.default.setConvUXVersion(this.state.convUXVer),this._conversationList&&this._conversationList.viewGroup(this.state.filter,this.state.filters)})),I.e.logAction(1453402)}onBroadCastMsg(e){var t;let s=!0;if(!0!==(null===(t=this.labelFilterRef)||void 0===t?void 0:t.isMultiSelect())){for(let e in this.state.filters)if(this.state.filters.hasOwnProperty(e)&&(s=b.b.getItem(e),s))break;s||(s=!0)}H.a.openModal({windowId:Hr,name:h.ModalIdentitiesDefine.BROADCAST_COMPSE,params:s}),I.e.logAction(1453102)}getLabelFilterUI(){const e=()=>{this.setState({filters:{}},(()=>{this._conversationList&&this._conversationList.viewGroup(this.state.filter)}))};return o.a.createElement(hr,{labels:this.state.filterTags,filters:this.state.filters,onClear:e,onItemClicked:e=>{this._onFilterTagsItemClickedv3(e,!1),e&&this.state.filter===h.CONV_FILTER.UNREAD&&I.e.logAction(1453214)},onMultiFilter:t=>{if(t){if(Object.values(t).length>1&&this.state.filter===h.CONV_FILTER.UNREAD&&I.e.logAction(1453215),g.default.isEmptyObject(t))return e();this._onFilterTagsItemsClickedv3(t)}},identity:{windowId:Hr,name:h.PopoverIdentitiesDefine.CONV_LABEL_MENU},ref:e=>this.labelFilterRef=e})}_onSearchKeyword(e){"string"==typeof e&&this._searchInput&&(this._searchInput.value=e,this._onSearchNameChange(null,e),He.a.addCacheKeyword(e))}_onRemoveKeyword(e){"string"==typeof e&&He.a.removeCacheKeyword(e)}_onclickCloseSearchButton(e){this.setRecentSearchFocusState(!1),this._resetCacheResultSearch(),this._clearSearch(!this.state.search.conversation),I.e.logAction(1232003),this._onCloseSearch(),e.stopPropagation(),e.preventDefault()}render(){let e=this.props.state.conversation.conversations,t=0,s=0,a=Wo.a.getTotalUnread(),n=0,i=0,r=0,l=0,d={all:0,pin:0},_=!1,m={},p={},f=-1,T=-1;const v=this.props.status?this.props.status.privacySettings:null;if(e&&e.length>0)for(let o=0;o<e.length;o++){let a,u=e[o];if(se.a.isThreadHidden(u.userId))!_&&parseInt(u.smsUnreadCount)>0&&(_=!0);else if(u.userId!==h.FAKE_CONVERSATION_ID.FRIEND_CENTER)if(u&&(a=b.b.getLabelObjByConversaionId(u.userId),a=a?a.id:void 0),g.default.isInMediaBox(u)){let e=parseInt(u.smsUnreadCount);i+=e,m[-300]=i,t+=e}else{if(!isNaN(u.smsUnreadCount)){let e=parseInt(u.smsUnreadCount);t+=e,u.muted&&(d.all+=e)}if(!u.muted&&!g.default.isOAType(u)&&!isNaN(u.smsUnreadCount)){if(g.default.isInStrangerBox(u))u.strangerUnreadCount&&!isNaN(u.strangerUnreadCount)&&(n+=parseInt(u.strangerUnreadCount),m[-400]=n,s=n,f=Math.max(f,u.lastMessageTime),a&&(c.c.draw_unread_icon?u.smsUnreadCount&&(m[a]=(m[a]?m[a]:0)+1):m[a]=(m[a]?m[a]:0)+u.smsUnreadCount));else{let e=0;u.smsUnreadCount&&u.smsUnreadNotCount?(e=Math.max(parseInt(u.smsUnreadCount)-parseInt(u.smsUnreadNotCount),0),e&&r++):parseInt(u.smsUnreadCount)>0&&(r++,e=parseInt(u.smsUnreadCount)),s+=e,f=Math.max(f,u.lastMessageTime),a&&(c.c.draw_unread_icon?u.smsUnreadCount&&(m[a]=(m[a]?m[a]:0)+1):m[a]=(m[a]?m[a]:0)+u.smsUnreadCount)}c.c.draw_unread_icon?m[-100]=r:m[-100]=s}!u.muted&&u.unreadMark&&(l++,a&&(p[a]=1),p[-100]=1)}else u.smsUnreadCount>0&&(T=u.lastMessageTime)}n>0&&r++,this.state.user_mode===h.USER_MODE.BUSY&&1===c.c.enable_busy_mode?this.setUnreadBadge(0):c.c.draw_unread_icon?this.setUnreadBadge(r):this.setUnreadBadge(s+0);let R=this.state.todoUnread;const S=e=>o.a.createElement(Ko,{onClick:this._clickNotifyTab.bind(this),renderEntry:e=>this.renderTab(e),tabValue:Nr,key:e});let N=[c.c.noti_center_config&&1===c.c.noti_center_config.entry_position?S("tab-noti-1"):this.renderTab(null),this.renderTab({icon:{active:"ChatSolid",normal:"ChatOutline"},titleKey:"STR_TAB_MESSAGE",tabValue:vr,onClick:this._onSelectTabMessage.bind(this,r,s),onDoubleClick:this._onDoubleClickTabHeader,unreadCount:c.c.draw_unread_icon?r:s,"data-id":"div_Main_TabMsg",unreadMark:l}),this.renderTab({icon:{active:"ContactSolid",normal:"ContactOutline"},titleKey:"STR_TAB_CONTACT",tabValue:Rr,onClick:()=>this._selectTab(Rr),onDoubleClick:this._onDoubleClickTabHeader,unreadCount:this.state.notifications.friendListUserIds.length?"N":null,"data-id":"div_Main_TabCT"}),this.renderTab(c.c.noti_center_config.disable?{icon:{active:"NotiSolid",normal:"NotiOutline"},titleKey:"STR_MENTIONED_YOU_CONVERSATION",tabValue:br,onClick:()=>this._selectTab(br),otherChildren:o.a.createElement(ee.c,{position:ee.b.RIGHT,vDelta:-6,hDelta:60,aDelta:16,reddotPos:{top:0,left:-16},tipKey:"leftmenu.notif"}),unreadCount:a,unreadColor:"orange","data-id":"div_Main_TabNC"}:null),c.c.noti_center_config&&2===c.c.noti_center_config.entry_position?S("tab-noti-2"):this.renderTab(null),this.renderTab(wn.i.isEnableEntryPoint(wn.h.TAB)?{icon:{active:"TodoSolid",normal:"TodoOutline"},id:"todo-tab",titleKey:"STR_TODO",tabValue:Dr,onClick:this._onSelectTabTodo.bind(this),otherChildren:o.a.createElement(ee.c,{position:ee.b.RIGHT,vDelta:9,hDelta:70,aDelta:16,reddotPos:{top:2,left:-20},tipKey:"todo.notify",style:{width:"250px"},tipBackgroundColor:"var(--neutral-400)",onAction:this.onTodoTipClicked.bind(this)}),unreadCount:R>0?"N":null,"data-id":"div_Main_TabToDo"}:null),this.renderTab(null),this.renderTab(c.c.link_event?{titleKey:"KEY_TIP_ICON_EVENT",tabValue:yr,onClick:()=>this._selectTab(yr),otherChildren:c.c.icon_event?o.a.createElement("img",{src:this.state.currentTab==yr?c.c.icon_event.selected:c.c.icon_event.normal}):null}:null),this.renderTab(null)];N=N.filter((e=>!!e));let C=[];if(this.state.leftbarTopStack>0){let e=this.state.leftbarTopStack+1,t=N.length-e;C=N.splice(t,e).filter((e=>!!e)),C.length>0&&N.push(this.renderTab({icon:"solid-more",titleKey:"STR_MORE",tabValue:Sr,onClick:e=>this.onShowMorePopup(e,this.tabRefs.more)}))}if(this.state.numberMoreTabs>0){let e=this.state.numberMoreTabs,t=N.length-e;C=N.splice(t,e).filter((e=>!!e)),C.length>0&&N.push(this.renderTab({icon:"solid-more",titleKey:"STR_MORE",tabValue:Sr,onClick:e=>this.onShowMorePopup(e,this.tabRefs.more)}))}let A=null,y=null,D=this.state.search.searchText||this.state.search.conversation||!(!this.isFocusSearchBox&&!this.isFocusOnRecentSearch)&&(A=this.getRecentSeacrchItems())&&A.length>0,M=null,P=!D&&this.state.currentTab==vr,w="WEB".toLowerCase();D||(this.wasLogFocusSearch=!1,this._resetCacheResultSearch());const L=(e,t,s,a=null,n=null,i=0)=>{if(!e)return null;let r,l=!1;e.constructor===Object?r=e.id:"number"==typeof e&&(r=e,l=!0);let c=p[r],d=i||m[r];this.labelMenuRef||(this.labelMenuRef={});return o.a.createElement(st.a,{isActive:this.state.currentLabelId==r,size:"small",type:"tertiary",format:"full-rounded",key:`filter-item-${r}`,className:"filter-tag-item"+(r<0?" default-tag":""),onClick:s,title:t||a,onContextMenu:e=>{r<0||this.labelMenuRef&&this.labelMenuRef[r]&&this.labelMenuRef[r].show(e)},"data-id":"div_Main_FilteredLabelItem"},t?o.a.createElement("div",{className:"truncate"},t):o.a.createElement(E.a,{textKey:a,className:"truncate",tagName:"div"}),l?null:o.a.createElement("div",{className:"edit-button",onClick:t=>this._onEditLabel(t,e),"data-id":"btn_Label_Edit"},o.a.createElement("i",{className:"fa fa-edit filter-tag-item-edit"})),d>0||c?o.a.createElement("div",{className:"unread-div"},this._renderUnreadV3({totalUnread:d,size:d?13:11,unreadMark:c})):n?this.renderSuggestBroadcast(e,n):null,r>0?o.a.createElement(Za.default,{popoverProps:{identity:{windowId:Hr,name:`${h.PopoverIdentitiesDefine.FILTER_LABEL}-${r}`},placement:"bottom-left"},ref:e=>this.labelMenuRef[r]=e,items:[{textKey:"STR_ADD_CONVERSATION_TO_LABEL_TITLE",onclick:e=>this._addConversation(e,r)},{textKey:"STR_RENAME_LABEL",onclick:t=>this._onEditLabel(t,e)},{type:Za.MENU_ITEM_TYPE.SEPARATE},{type:Za.MENU_ITEM_TYPE.DANGER,textKey:"STR_REMOVE_LABEL",onclick:t=>this._onDeleteLabel(t,e)}]}):null)};let k=null,x=null;const U=o.a.createElement(ji,{isShowExportImportProgress:this.props.isShowExportImportProgress,dispatch:this.props.dispatch});if(P){if(2===this.state.convUXVer&&this.state.filterTags){let e=[],t={},a=!1;!Cn.b.checkTipDisapear("client.broadcast_1")&&c.c.broadcast&&c.c.broadcast.isEnable&&(this.state.filterTags.forEach((e=>{O.default.canBroadcast(e,!0,!0)&&!a&&(t[e.id]=!0,a=!0)})),a||this.state.filterTags[0]&&this.state.filterTags[0].id&&(t[this.state.filterTags[0].id]=!0)),e.push(L(sa,"",this._onFilterTagsItemClicked.bind(this,null),"STR_ALL_LABEL",null,s));for(let s=0;s<this.state.filterTags.length;s++){let a=this.state.filterTags[s];a&&e.push(L(a,a.text,this._onFilterTagsItemClicked.bind(this,a),a.textKey,t))}e.push(o.a.createElement(st.a,{type:"tertiary",onClick:this._onLabelManagerClicked.bind(this),icon:"icon-outline-setting",format:"full-rounded",size:"small",className:"filter-tag-item","data-id":"btn_Main_MNGELabel"})),k=o.a.createElement(pr,{ref:this.collapseRef,textKey:"STR_LABEL_CLASS_2",size:"small",type:"custom",initState:O.default.getCollapseLabelState(),onChange:e=>{O.default.setCollapseLabelState(e),e?I.e.logAction(14508):I.e.logAction(14507),O.default.setLastUsedLabelTime()}},o.a.createElement("div",{ref:e=>this.filterContent=e,"data-id":"div_Main_FilteredLabel"},o.a.createElement("div",{className:"filter-tags",id:"filter-tags-sb",ref:e=>this.fitlerTagsContent=e},e)))}let e=[{textKey:"STR_SHOW_ALL_MESSAGES",onclick:this._onAllFilterClicked.bind(this),checked:this.state.filter!==h.CONV_FILTER.UNREAD&&this.state.filter!==h.CONV_FILTER.STRANGER&&!this.state.filters.hasOwnProperty(aa)},{textKey:"STR_UNREAD_MESSAGE_ONLY",onclick:this._onUnreadFilterClicked.bind(this),checked:this.state.filter===h.CONV_FILTER.UNREAD&&!this.state.filters.hasOwnProperty(aa)},{textKey:"STR_STRANGER_MESSAGE_ONLY",onclick:this._onStrangerClicked.bind(this),checked:this.state.filters.hasOwnProperty(aa)}],t="STR_ALL_MESSAGES";this.state.filters.hasOwnProperty(aa)?t="STR_STRANGER_MESSAGE":this.state.filter===h.CONV_FILTER.UNREAD&&(t="STR_UNREAD_MESSAGE"),x=o.a.createElement("div",{className:"msg-filters-bar flx flx-al-c"+(2===this.state.convUXVer?"":" ver3")},2===this.state.convUXVer?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{onClick:e=>this.onShowListExtLabel(e)},o.a.createElement("div",{className:"conv-label-title flx flx-al-c"},o.a.createElement(E.a,{textKey:t,className:"truncate sb-label__filter "}),o.a.createElement("i",{className:"fa fa-solid-down",style:{padding:"0 5px",fontSize:"14px"}})),o.a.createElement(Za.default,{popoverProps:{identity:{windowId:Hr,name:h.PopoverIdentitiesDefine.SHOW_ALL_MESSAGE},placement:"bottom-left"},ref:e=>this.filterMenu=e,items:e})),o.a.createElement("div",{className:"flx-1"}),o.a.createElement(E.a,{textKey:"STR_ACTION",tagName:"div",onClick:e=>this.onShowActionMenu(e),className:"conv-action","data-id":"btn_SwitchNewUI_Action"}),o.a.createElement(Za.default,{popoverProps:{identity:{windowId:Hr,name:h.PopoverIdentitiesDefine.CONV_ACTION_MENU},placement:"bottom-left"},ref:e=>this.convActionMenu=e,items:[{textKey:"STR_MARK_AS_READ",onclick:e=>this._onMarkAsRead(e)},{textKey:"STR_BROADCAST_MSG",onclick:e=>this.onBroadCastMsg(e),"data-id-info":{body:"div_SwitchNewUI_SpamMessage"}},{type:Za.MENU_ITEM_TYPE.SEPARATE},{textKey:"STR_TRY_NEW_VER",onclick:e=>this.onTryNewUIVersion(e),"data-id-info":{body:"div_SwitchNewUI_Back2New"}}]})):o.a.createElement(ct.a,{tabs:[{textKey:"STR_ALL"},{textKey:"STR_UNREAD_LABEL"}],onChange:this._onChangeFilterTabs.bind(this),size:"small",padding:16,ref:this.tabRef,value:"unread"===this.state.filter?1:0,extra:o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"flx-1"}),this.getLabelFilterUI(),o.a.createElement(_r,{icon:"solid-more",type:"tertiary",modifier:"chatbar",size:"small",format:"full-rounded",identity:{windowId:Hr,name:h.PopoverIdentitiesDefine.CONV_ACTION_MENU},placement:"bottom-left","data-id-info":{button:"div_SwitchUI_CX"},items:[{textKey:"STR_MARK_AS_READ",onclick:e=>this._onMarkAsRead(e)},{textKey:"STR_BROADCAST_MSG",onclick:e=>this.onBroadCastMsg(e),"data-id-info":{body:"div_SwitchUICX_SpamMessage"}},{type:Za.MENU_ITEM_TYPE.SEPARATE},c.c.conv_ux_switcher&&!0===this.state.convUxEntryPoint?{textKey:"STR_BACK_OLD_VER",onclick:e=>this.onBackOldUIVersion(e),"data-id-info":{body:"div_SwitchUICX_Back2Classic"}}:null].filter((e=>!!e))}))}))}M=o.a.createElement(ha,{key:"conversation_list",ref:e=>{this._conversationList=P?e:null},user:this.props.user,isEnable:P,selectedId:this.state.selectedId,className:w,confirm:this.props.confirm,dispatch:this.props.dispatch,nameTab:Rr,currentTab:this.state.currentTab,selectConversationForFriend:this._selectConversationForFriend,state:this.props.state.conversation,broadCastMessage:this.props.broadCastMessage,sendDirectMsgToSendToMe:this.props.sendDirectMsgToSendToMe,onBackMessageFullList:this._onBackMessageFullList.bind(this),friendRequests:this.state.friendRequests,acceptFriendRequest:this._acceptFriendRequest,rejectFriendRequest:this._rejectFriendRequest,showUserInfo:this._showUserInfo,handleFriendListNotificationsChange:this._handleFriendListNotificationsChange,getConversationFromId:this._getConversationFromId,onMarkRead:this._onMarkAsRead.bind(this),needRefresh:this.state.needRefresh,selectZaloShopTab:this.selectZaloShopTab.bind(this),onUpdateTitle:this.onUpdateTitle.bind(this),showEditAlias:this.props.showEditAlias,compactLv:this.props.compactLv,onDrillIntoGroup:this._onFilterTagsItemClickedv3.bind(this)});let F=!1,G=!1;if(D&&this.state.currentTab!=Cr)!this.isFocusSearchBox&&!this.isFocusOnRecentSearch||this.state.search.searchText||this.state.search.conversation?(g.default.log("sidebar: conv filter = "+this.state.search.conversation),F=!this.state.search.conversation,y=c.c.global_search_v3?o.a.createElement(bt,{searchText:this.state.search.searchText,className:w,recentContact:this.props.state.conversation.conversations,searching:this.state.search.searching,focusInputSearch:this._focusAndSelectAllInputSearch.bind(this),highlightId:this.state.highlightId,dispatch:this.props.dispatch,ref:e=>this._searchResultList=e,user:this.props.user,confirm:this.props.confirm,selectConversation:this._selectConversationForFriend,selectResult:this._selectResult.bind(this),onFileSelect:this._onFileSelect.bind(this),conversation:this.state.search.conversation,clearConvFilter:this._clearSearch.bind(this),loadMoreMessages:this._loadMessagesV2.bind(this),loadMoreFiles:this._loadMoreFiles.bind(this),getConversationFromId:this._getConversationFromId,result:this.state.search.searchResult,showEditAlias:this.props.showEditAlias,showMediaAction:this.props.showMediaAction,showShareAction:this.props.showShareAction,shareSend2me:this.props.shareSend2me,currentTab:this.state.currentTab,showUserInfo:this._showUserInfo,compactLv:this.props.compactLv,contacts:this.props.contacts,refInput:this._searchInput,pageLoad:this.pageLoad,selectTopRes:this.selectTopRes.bind(this),currentId:this.props.state.conversation.currentId}):o.a.createElement(tt,{searc